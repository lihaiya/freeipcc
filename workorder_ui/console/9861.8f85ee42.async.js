(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[9861],{35099:function(Ja,ji,vt){"use strict";var rr=vt(67294),Ft=vt(62630),x=vt(59153),Jr=vt(4322),tt=vt(24770),Tr=vt(89182),rt=function(Xe,Kt){var hr={};for(var jt in Xe)Object.prototype.hasOwnProperty.call(Xe,jt)&&Kt.indexOf(jt)<0&&(hr[jt]=Xe[jt]);if(Xe!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ar=0,jt=Object.getOwnPropertySymbols(Xe);ar<jt.length;ar++)Kt.indexOf(jt[ar])<0&&Object.prototype.propertyIsEnumerable.call(Xe,jt[ar])&&(hr[jt[ar]]=Xe[jt[ar]]);return hr},fr=(0,rr.forwardRef)(function(Xe,Kt){var hr=Xe.chartRef,jt=Xe.style,ar=jt===void 0?{height:"inherit"}:jt,ur=Xe.className,Ir=Xe.loading,Kn=Xe.loadingTemplate,On=Xe.errorTemplate,an=rt(Xe,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),Pi=(0,x.Z)(Ft.Gauge,an),ri=Pi.chart,me=Pi.container;return(0,rr.useEffect)(function(){(0,Jr.J)(hr,ri.current)},[ri.current]),(0,rr.useImperativeHandle)(Kt,function(){return{getChart:function(){return ri.current}}}),rr.createElement(tt.Z,{errorTemplate:On},Ir&&rr.createElement(Tr.Z,{loadingTemplate:Kn,theme:Xe.theme}),rr.createElement("div",{className:ur,style:ar,ref:me}))});ji.Z=fr},65337:function(Ja,ji,vt){"use strict";var rr=vt(67294),Ft=vt(62630),x=vt(59153),Jr=vt(4322),tt=vt(24770),Tr=vt(89182),rt=function(Xe,Kt){var hr={};for(var jt in Xe)Object.prototype.hasOwnProperty.call(Xe,jt)&&Kt.indexOf(jt)<0&&(hr[jt]=Xe[jt]);if(Xe!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ar=0,jt=Object.getOwnPropertySymbols(Xe);ar<jt.length;ar++)Kt.indexOf(jt[ar])<0&&Object.prototype.propertyIsEnumerable.call(Xe,jt[ar])&&(hr[jt[ar]]=Xe[jt[ar]]);return hr},fr=(0,rr.forwardRef)(function(Xe,Kt){var hr=Xe.chartRef,jt=Xe.style,ar=jt===void 0?{height:"inherit"}:jt,ur=Xe.className,Ir=Xe.loading,Kn=Xe.loadingTemplate,On=Xe.errorTemplate,an=rt(Xe,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),Pi=(0,x.Z)(Ft.Liquid,an),ri=Pi.chart,me=Pi.container;return(0,rr.useEffect)(function(){(0,Jr.J)(hr,ri.current)},[ri.current]),(0,rr.useImperativeHandle)(Kt,function(){return{getChart:function(){return ri.current}}}),rr.createElement(tt.Z,{errorTemplate:On},Ir&&rr.createElement(Tr.Z,{loadingTemplate:Kn,theme:Xe.theme}),rr.createElement("div",{className:ur,style:ar,ref:me}))});ji.Z=fr},81138:function(Ja,ji,vt){"use strict";var rr=vt(67294),Ft=vt(62630),x=vt(59153),Jr=vt(4322),tt=vt(24770),Tr=vt(89182),rt=function(Xe,Kt){var hr={};for(var jt in Xe)Object.prototype.hasOwnProperty.call(Xe,jt)&&Kt.indexOf(jt)<0&&(hr[jt]=Xe[jt]);if(Xe!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ar=0,jt=Object.getOwnPropertySymbols(Xe);ar<jt.length;ar++)Kt.indexOf(jt[ar])<0&&Object.prototype.propertyIsEnumerable.call(Xe,jt[ar])&&(hr[jt[ar]]=Xe[jt[ar]]);return hr},fr=(0,rr.forwardRef)(function(Xe,Kt){var hr=Xe.chartRef,jt=Xe.style,ar=jt===void 0?{height:"inherit"}:jt,ur=Xe.className,Ir=Xe.loading,Kn=Xe.loadingTemplate,On=Xe.errorTemplate,an=rt(Xe,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),Pi=(0,x.Z)(Ft.WordCloud,an),ri=Pi.chart,me=Pi.container;return(0,rr.useEffect)(function(){(0,Jr.J)(hr,ri.current)},[ri.current]),(0,rr.useImperativeHandle)(Kt,function(){return{getChart:function(){return ri.current}}}),rr.createElement(tt.Z,{errorTemplate:On},Ir&&rr.createElement(Tr.Z,{loadingTemplate:Kn,theme:Xe.theme}),rr.createElement("div",{className:ur,style:ar,ref:me}))});ji.Z=fr},33863:function(Ja,ji,vt){"use strict";vt.d(ji,{zP:function(){return Kk},JE:function(){return uk},ns:function(){return $k}});var rr=vt(67294),Ft=(0,rr.createContext)({});function x(){return(0,rr.useContext)(Ft)}var Jr={},tt={},Tr=function(a){return tt[a]},rt=function(a,t){tt[a]=t},fr=function(a){return Jr[a]},Xe=function(a,t){Jr[a]=t},Kt={},hr={},jt=34,ar=10,ur=13;function Ir(e){return new Function("d","return {"+e.map(function(a,t){return JSON.stringify(a)+": d["+t+'] || ""'}).join(",")+"}")}function Kn(e,a){var t=Ir(e);return function(i,r){return a(t(i),r,e)}}function On(e){var a=Object.create(null),t=[];return e.forEach(function(i){for(var r in i)r in a||t.push(a[r]=r)}),t}function an(e,a){var t=e+"",i=t.length;return i<a?new Array(a-i+1).join(0)+t:t}function Pi(e){return e<0?"-"+an(-e,6):e>9999?"+"+an(e,6):an(e,4)}function ri(e){var a=e.getUTCHours(),t=e.getUTCMinutes(),i=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Pi(e.getUTCFullYear(),4)+"-"+an(e.getUTCMonth()+1,2)+"-"+an(e.getUTCDate(),2)+(r?"T"+an(a,2)+":"+an(t,2)+":"+an(i,2)+"."+an(r,3)+"Z":i?"T"+an(a,2)+":"+an(t,2)+":"+an(i,2)+"Z":t||a?"T"+an(a,2)+":"+an(t,2)+"Z":"")}function me(e){var a=new RegExp('["'+e+`
\r]`),t=e.charCodeAt(0);function i(T,O){var F,U,j=r(T,function(K,ae){if(F)return F(K,ae-1);U=K,F=O?Kn(K,O):Ir(K)});return j.columns=U||[],j}function r(T,O){var F=[],U=T.length,j=0,K=0,ae,ve=U<=0,ke=!1;T.charCodeAt(U-1)===ar&&--U,T.charCodeAt(U-1)===ur&&--U;function qe(){if(ve)return hr;if(ke)return ke=!1,Kt;var _t,Ot=j,Xt;if(T.charCodeAt(Ot)===jt){for(;j++<U&&T.charCodeAt(j)!==jt||T.charCodeAt(++j)===jt;);return(_t=j)>=U?ve=!0:(Xt=T.charCodeAt(j++))===ar?ke=!0:Xt===ur&&(ke=!0,T.charCodeAt(j)===ar&&++j),T.slice(Ot+1,_t-1).replace(/""/g,'"')}for(;j<U;){if((Xt=T.charCodeAt(_t=j++))===ar)ke=!0;else if(Xt===ur)ke=!0,T.charCodeAt(j)===ar&&++j;else if(Xt!==t)continue;return T.slice(Ot,_t)}return ve=!0,T.slice(Ot,U)}for(;(ae=qe())!==hr;){for(var ct=[];ae!==Kt&&ae!==hr;)ct.push(ae),ae=qe();O&&(ct=O(ct,K++))==null||F.push(ct)}return F}function o(T,O){return T.map(function(F){return O.map(function(U){return E(F[U])}).join(e)})}function u(T,O){return O==null&&(O=On(T)),[O.map(E).join(e)].concat(o(T,O)).join(`
`)}function p(T,O){return O==null&&(O=On(T)),o(T,O).join(`
`)}function v(T){return T.map(g).join(`
`)}function g(T){return T.map(E).join(e)}function E(T){return T==null?"":T instanceof Date?ri(T):a.test(T+="")?'"'+T.replace(/"/g,'""')+'"':T}return{parse:i,parseRows:r,format:u,formatBody:p,formatRows:v,formatRow:g,formatValue:E}}var _i=me(","),Rr=_i.parse,ir=_i.parseRows,zr=_i.format,st=_i.formatBody,en=_i.formatRows,Wn=_i.formatRow,ce=_i.formatValue,Ee=vt(93433),Z=vt(1413),Ze=vt(38163),Pe=vt.n(Ze),ft=63710088e-1,It={centimeters:ft*100,centimetres:ft*100,degrees:ft/111325,feet:ft*3.28084,inches:ft*39.37,kilometers:ft/1e3,kilometres:ft/1e3,meters:ft,metres:ft,miles:ft/1609.344,millimeters:ft*1e3,millimetres:ft*1e3,nauticalmiles:ft/1852,radians:1,yards:ft*1.0936},qt={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/ft,yards:1.0936133},yt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function cr(e,a,t){t===void 0&&(t={});var i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=a||{},i.geometry=e,i}function Xn(e,a,t){switch(t===void 0&&(t={}),e){case"Point":return Vn(a).geometry;case"LineString":return Ba(a).geometry;case"Polygon":return ai(a).geometry;case"MultiPoint":return xi(a).geometry;case"MultiLineString":return Ca(a).geometry;case"MultiPolygon":return Hi(a).geometry;default:throw new Error(e+" is invalid")}}function Vn(e,a,t){if(t===void 0&&(t={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!We(e[0])||!We(e[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:e};return cr(i,a,t)}function Gi(e,a,t){return t===void 0&&(t={}),Ti(e.map(function(i){return Vn(i,a)}),t)}function ai(e,a,t){t===void 0&&(t={});for(var i=0,r=e;i<r.length;i++){var o=r[i];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var p={type:"Polygon",coordinates:e};return cr(p,a,t)}function Rn(e,a,t){return t===void 0&&(t={}),Ti(e.map(function(i){return ai(i,a)}),t)}function Ba(e,a,t){if(t===void 0&&(t={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:e};return cr(i,a,t)}function oa(e,a,t){return t===void 0&&(t={}),Ti(e.map(function(i){return Ba(i,a)}),t)}function Ti(e,a){a===void 0&&(a={});var t={type:"FeatureCollection"};return a.id&&(t.id=a.id),a.bbox&&(t.bbox=a.bbox),t.features=e,t}function Ca(e,a,t){t===void 0&&(t={});var i={type:"MultiLineString",coordinates:e};return cr(i,a,t)}function xi(e,a,t){t===void 0&&(t={});var i={type:"MultiPoint",coordinates:e};return cr(i,a,t)}function Hi(e,a,t){t===void 0&&(t={});var i={type:"MultiPolygon",coordinates:e};return cr(i,a,t)}function vi(e,a,t){t===void 0&&(t={});var i={type:"GeometryCollection",geometries:e};return cr(i,a,t)}function mi(e,a){if(a===void 0&&(a=0),a&&!(a>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,a||0);return Math.round(e*t)/t}function ss(e,a){a===void 0&&(a="kilometers");var t=It[a];if(!t)throw new Error(a+" units is invalid");return e*t}function Po(e,a){a===void 0&&(a="kilometers");var t=It[a];if(!t)throw new Error(a+" units is invalid");return e/t}function ao(e,a){return pe(Po(e,a))}function bt(e){var a=e%360;return a<0&&(a+=360),a}function pe(e){var a=e%(2*Math.PI);return a*180/Math.PI}function ie(e){var a=e%360;return a*Math.PI/180}function Ce(e,a,t){if(a===void 0&&(a="kilometers"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("length must be a positive number");return ss(Po(e,a),t)}function V(e,a,t){if(a===void 0&&(a="meters"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("area must be a positive number");var i=yt[a];if(!i)throw new Error("invalid original units");var r=yt[t];if(!r)throw new Error("invalid final units");return e/i*r}function We(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Gt(e){return!!e&&e.constructor===Object}function Vr(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(a){if(!We(a))throw new Error("bbox must only contain numbers")})}function Mr(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function Yn(e,a,t){if(e!==null)for(var i,r,o,u,p,v,g,E=0,T=0,O,F=e.type,U=F==="FeatureCollection",j=F==="Feature",K=U?e.features.length:1,ae=0;ae<K;ae++){g=U?e.features[ae].geometry:j?e.geometry:e,O=g?g.type==="GeometryCollection":!1,p=O?g.geometries.length:1;for(var ve=0;ve<p;ve++){var ke=0,qe=0;if(u=O?g.geometries[ve]:g,u!==null){v=u.coordinates;var ct=u.type;switch(E=t&&(ct==="Polygon"||ct==="MultiPolygon")?1:0,ct){case null:break;case"Point":if(a(v,T,ae,ke,qe)===!1)return!1;T++,ke++;break;case"LineString":case"MultiPoint":for(i=0;i<v.length;i++){if(a(v[i],T,ae,ke,qe)===!1)return!1;T++,ct==="MultiPoint"&&ke++}ct==="LineString"&&ke++;break;case"Polygon":case"MultiLineString":for(i=0;i<v.length;i++){for(r=0;r<v[i].length-E;r++){if(a(v[i][r],T,ae,ke,qe)===!1)return!1;T++}ct==="MultiLineString"&&ke++,ct==="Polygon"&&qe++}ct==="Polygon"&&ke++;break;case"MultiPolygon":for(i=0;i<v.length;i++){for(qe=0,r=0;r<v[i].length;r++){for(o=0;o<v[i][r].length-E;o++){if(a(v[i][r][o],T,ae,ke,qe)===!1)return!1;T++}qe++}ke++}break;case"GeometryCollection":for(i=0;i<u.geometries.length;i++)if(Yn(u.geometries[i],a,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Fi(e,a,t,i){var r=t;return Yn(e,function(o,u,p,v,g){u===0&&t===void 0?r=o:r=a(r,o,u,p,v,g)},i),r}function Qn(e,a){var t;switch(e.type){case"FeatureCollection":for(t=0;t<e.features.length&&a(e.features[t].properties,t)!==!1;t++);break;case"Feature":a(e.properties,0);break}}function Bn(e,a,t){var i=t;return Qn(e,function(r,o){o===0&&t===void 0?i=r:i=a(i,r,o)}),i}function Fn(e,a){if(e.type==="Feature")a(e,0);else if(e.type==="FeatureCollection")for(var t=0;t<e.features.length&&a(e.features[t],t)!==!1;t++);}function eo(e,a,t){var i=t;return Fn(e,function(r,o){o===0&&t===void 0?i=r:i=a(i,r,o)}),i}function va(e){var a=[];return Yn(e,function(t){a.push(t)}),a}function Yi(e,a){var t,i,r,o,u,p,v,g,E,T,O=0,F=e.type==="FeatureCollection",U=e.type==="Feature",j=F?e.features.length:1;for(t=0;t<j;t++){for(p=F?e.features[t].geometry:U?e.geometry:e,g=F?e.features[t].properties:U?e.properties:{},E=F?e.features[t].bbox:U?e.bbox:void 0,T=F?e.features[t].id:U?e.id:void 0,v=p?p.type==="GeometryCollection":!1,u=v?p.geometries.length:1,r=0;r<u;r++){if(o=v?p.geometries[r]:p,o===null){if(a(null,O,g,E,T)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(a(o,O,g,E,T)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<o.geometries.length;i++)if(a(o.geometries[i],O,g,E,T)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}O++}}function Lo(e,a,t){var i=t;return Yi(e,function(r,o,u,p,v){o===0&&t===void 0?i=r:i=a(i,r,o,u,p,v)}),i}function to(e,a){Yi(e,function(t,i,r,o,u){var p=t===null?null:t.type;switch(p){case null:case"Point":case"LineString":case"Polygon":return a(cr(t,r,{bbox:o,id:u}),i,0)===!1?!1:void 0}var v;switch(p){case"MultiPoint":v="Point";break;case"MultiLineString":v="LineString";break;case"MultiPolygon":v="Polygon";break}for(var g=0;g<t.coordinates.length;g++){var E=t.coordinates[g],T={type:v,coordinates:E};if(a(cr(T,r),i,g)===!1)return!1}})}function So(e,a,t){var i=t;return to(e,function(r,o,u){o===0&&u===0&&t===void 0?i=r:i=a(i,r,o,u)}),i}function Ji(e,a){to(e,function(t,i,r){var o=0;if(!!t.geometry){var u=t.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var p,v=0,g=0,E=0;if(Yn(t,function(T,O,F,U,j){if(p===void 0||i>v||U>g||j>E){p=T,v=i,g=U,E=j,o=0;return}var K=lineString([p,T],t.properties);if(a(K,i,r,j,o)===!1)return!1;o++,p=T})===!1)return!1}}})}function ro(e,a,t){var i=t,r=!1;return Ji(e,function(o,u,p,v,g){r===!1&&t===void 0?i=o:i=a(i,o,u,p,v,g),r=!0}),i}function hi(e,a){if(!e)throw new Error("geojson is required");to(e,function(t,i,r){if(t.geometry!==null){var o=t.geometry.type,u=t.geometry.coordinates;switch(o){case"LineString":if(a(t,i,r,0,0)===!1)return!1;break;case"Polygon":for(var p=0;p<u.length;p++)if(a(lineString(u[p],t.properties),i,r,p)===!1)return!1;break}}})}function fa(e,a,t){var i=t;return hi(e,function(r,o,u,p){o===0&&t===void 0?i=r:i=a(i,r,o,u,p)}),i}function $(e,a){if(a=a||{},!isObject(a))throw new Error("options is invalid");var t=a.featureIndex||0,i=a.multiFeatureIndex||0,r=a.geometryIndex||0,o=a.segmentIndex||0,u=a.properties,p;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),u=u||e.features[t].properties,p=e.features[t].geometry;break;case"Feature":u=u||e.properties,p=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":p=e;break;default:throw new Error("geojson is invalid")}if(p===null)return null;var v=p.coordinates;switch(p.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=v.length+o-1),lineString([v[o],v[o+1]],u,a);case"Polygon":return r<0&&(r=v.length+r),o<0&&(o=v[r].length+o-1),lineString([v[r][o],v[r][o+1]],u,a);case"MultiLineString":return i<0&&(i=v.length+i),o<0&&(o=v[i].length+o-1),lineString([v[i][o],v[i][o+1]],u,a);case"MultiPolygon":return i<0&&(i=v.length+i),r<0&&(r=v[i].length+r),o<0&&(o=v[i][r].length-o-1),lineString([v[i][r][o],v[i][r][o+1]],u,a)}throw new Error("geojson is invalid")}function ne(e,a){if(a=a||{},!isObject(a))throw new Error("options is invalid");var t=a.featureIndex||0,i=a.multiFeatureIndex||0,r=a.geometryIndex||0,o=a.coordIndex||0,u=a.properties,p;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),u=u||e.features[t].properties,p=e.features[t].geometry;break;case"Feature":u=u||e.properties,p=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":p=e;break;default:throw new Error("geojson is invalid")}if(p===null)return null;var v=p.coordinates;switch(p.type){case"Point":return point(v,u,a);case"MultiPoint":return i<0&&(i=v.length+i),point(v[i],u,a);case"LineString":return o<0&&(o=v.length+o),point(v[o],u,a);case"Polygon":return r<0&&(r=v.length+r),o<0&&(o=v[r].length+o),point(v[r][o],u,a);case"MultiLineString":return i<0&&(i=v.length+i),o<0&&(o=v[i].length+o),point(v[i][o],u,a);case"MultiPolygon":return i<0&&(i=v.length+i),r<0&&(r=v[i].length+r),o<0&&(o=v[i][r].length-o),point(v[i][r][o],u,a)}throw new Error("geojson is invalid")}function he(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function be(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ne(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Ne(e[0]);throw new Error("coordinates must only contain numbers")}function Ye(e,a,t){if(!a||!t)throw new Error("type and name required");if(!e||e.type!==a)throw new Error("Invalid input to "+t+": must be a "+a+", given "+e.type)}function lt(e,a,t){if(!e)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!e.geometry||e.geometry.type!==a)throw new Error("Invalid input to "+t+": must be a "+a+", given "+e.geometry.type)}function _e(e,a,t){if(!e)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(var i=0,r=e.features;i<r.length;i++){var o=r[i];if(!o||o.type!=="Feature"||!o.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!o.geometry||o.geometry.type!==a)throw new Error("Invalid input to "+t+": must be a "+a+", given "+o.geometry.type)}}function je(e){return e.type==="Feature"?e.geometry:e}function Mt(e,a){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function Sr(e,a){var t=a.x,i=a.y,r=a.x1,o=a.y1,u=a.coordinates,p=a.geometry,v=[];if(!Array.isArray(e))return{dataArray:[]};for(var g=function(F){var U=e[F];if(p){var j=(0,Z.Z)({},U[p]),K=Pe()(j,!0);return to(K,function(Xt){var yr=be(Xt),Pr=(0,Z.Z)((0,Z.Z)({},U),{},{_id:F,coordinates:yr});v.push(Pr)}),"continue"}var ae=[];if(u){var ve="Polygon";Array.isArray(u[0])||(ve="Point"),Array.isArray(u[0])&&!Array.isArray(u[0][0])&&(ve="LineString");var ke={type:ve,coordinates:(0,Ee.Z)(U[u])},qe=Pe()(ke,!0);ae=qe.coordinates}else if(t&&i&&r&&o){var ct=[parseFloat(U[t]),parseFloat(U[i])],_t=[parseFloat(U[r]),parseFloat(U[o])];ae=[ct,_t]}else t&&i&&(ae=[parseFloat(U[t]),parseFloat(U[i])]);var Ot=(0,Z.Z)((0,Z.Z)({},U),{},{_id:F,coordinates:ae});v.push(Ot)},E=0;E<e.length;E++)var T=g(E);return{dataArray:v}}function zt(e,a){var t=Rr(e);return Sr(t,a)}function Yt(e){for(var a=e.toString(),t=5381,i=a.length;i;)t=t*33^a.charCodeAt(--i);return t>>>0}function Lr(e,a){return a===void 0?null:a==="id"&&e.id?e.id:e[a]?e[a]:e.properties&&e.properties[a]?Yt(e.properties[a]+"")%1000019:null}function $n(e,a){var t=[],i={};return e.features?(e.features=e.features.filter(function(r){var o=r.geometry;return r!=null&&o&&o.type&&o.coordinates&&o.coordinates.length>0}),Pe()(e,!0),e.features.length===0?{dataArray:[],featureKeys:i}:(to(e,function(r,o){var u=Lr(r,a==null?void 0:a.featureId);u===null&&(u=o);var p=u,v=be(r),g=(0,Z.Z)((0,Z.Z)({},r.properties),{},{coordinates:v,_id:p});t.push(g)}),{dataArray:t,featureKeys:i})):(e.features=[],{dataArray:[]})}function vn(e){var a=131,t=137,i=0;e+="x";for(var r=Math.floor(9007199254740991/t),o=0;o<e.length;o++)i>r&&(i=Math.floor(i/t)),i=i*a+e.charCodeAt(o);return i}function Nt(e){e=e.toString();for(var a=5381,t=e.length;t;)a=a*33^e.charCodeAt(--t);return a>>>0}var pr=vt(29439),on="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function cn(e){this.message=e}cn.prototype=new Error,cn.prototype.name="InvalidCharacterError";function $i(e){var a=String(e).replace(/=+$/,"");if(a.length%4===1)throw new cn("'atob' failed: The string to be decoded is not correctly encoded.");for(var t="",i=0,r,o,u=0;o=a.charAt(u++);~o&&(r=i%4?r*64+o:o,i++%4)?t+=String.fromCharCode(255&r>>(-2*i&6)):0)o=on.indexOf(o);return t}function Cn(e){e=String(e);for(var a,t,i,r,o="",u=0,p=e.length%3;u<e.length;){if((t=e.charCodeAt(u++))>255||(i=e.charCodeAt(u++))>255||(r=e.charCodeAt(u++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");a=t<<16|i<<8|r,o+=on.charAt(a>>18&63)+on.charAt(a>>12&63)+on.charAt(a>>6&63)+on.charAt(a&63)}return p?o.slice(0,p-3)+"===".substring(p):o}var xt=vt(15671),St=vt(43144),qi=function(){function e(a,t){(0,xt.Z)(this,e),this.buffers=a,this.type=t}return(0,St.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(t,i,r){throw new Error("not implemented")}}]),e}(),na,ea=function(){return na||(na=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof vt.g<"u"?vt.g:{})};na=ea();var oi;typeof window>"u"?oi={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(a){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(a){return null},clearMeasures:function(a){return null},clearMarks:function(a){return null},measure:function(a,t,i){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(a){return!0},Event:function(a,t){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:oi=window;var Zi=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,fo=Zi?my.getSystemInfoSync().pixelRatio:oi.devicePixelRatio,mr=vt(60136),lr=vt(82963),nt=vt(61120),Ya=(0,St.Z)(function e(a,t){(0,xt.Z)(this,e),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=a,this.timeStamp=Date.now()}),dt=vt(97326);function wo(e,a){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=qa(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function qa(e,a){if(!!e){if(typeof e=="string")return lu(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return lu(e,a)}}function lu(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var No=new WeakMap,Li=function(){function e(){(0,xt.Z)(this,e),No.set(this,{})}return(0,St.Z)(e,[{key:"addEventListener",value:function(t,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=No.get(this);o||(o={}),o[t]||(o[t]=[]),o[t].push(i),No.set(this,o),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=No.get(this);if(o){var u=o[t];if(u&&u.length>0){for(var p=u.length;p--;p>0)if(u[p]===i){u.splice(p,1);break}}}}},{key:"dispatchEvent",value:function(t){var i=No.get(this)[t.type];if(i){var r=wo(i),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u(t)}}catch(p){r.e(p)}finally{r.f()}}}}]),e}();function ic(e){var a=Aa();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function Aa(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ao=function(e){(0,mr.Z)(t,e);var a=ic(t);function t(){var i;return(0,xt.Z)(this,t),i=a.call(this),i.childNodes=[],i}return(0,St.Z)(t,[{key:"appendChild",value:function(r){this.childNodes.push(r)}},{key:"cloneNode",value:function(){var r=Object.create(this);return Object.assign(r,this),r}},{key:"removeChild",value:function(r){var o=this.childNodes.findIndex(function(u){return u===r});return o>-1?this.childNodes.splice(o,1):null}}]),t}(Li);function Ho(e){var a=pa();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function pa(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ws=function(e){(0,mr.Z)(t,e);var a=Ho(t);function t(){var i;return(0,xt.Z)(this,t),i=a.call(this),i.className="",i.children=[],i}return(0,St.Z)(t,[{key:"setAttribute",value:function(r,o){this[r]=o}},{key:"getAttribute",value:function(r){return this[r]}},{key:"setAttributeNS",value:function(r,o){this[r]=o}},{key:"getAttributeNS",value:function(r){return this[r]}}]),t}(Ao),Vs=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,gl,oo,ms,Oa;if(Vs){var Ro=my.getSystemInfoSync();gl=Ro.screenWidth,oo=Ro.screenHeight,ms=Ro.windowWidth,Oa=Ro.windowHeight}else{var Ps=oi.innerWidth,zo=oi.innerHeight;gl=Ps,oo=zo,ms=Ps,Oa=zo}var yu={width:gl,height:oo,availWidth:ms,availHeight:Oa,availLeft:0,availTop:0},el=yu.availWidth,Wo=yu.availHeight,fe={style:[]};function Me(e,a){if(!("parentNode"in e)){var t;a===0?t=function(){return null}:a===1?t=function(){return fe}:t=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:t})}if(!("parentElement"in e)){var i;a===0?i=function(){return null}:a===1?i=function(){return fe}:i=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:i})}}function ut(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:el+"px",height:Wo+"px",margin:"0px",padding:"0px"})}function Zt(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=el,e.clientHeight=Wo),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var a={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return a})}function sn(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=el,e.offsetHeight=Wo)}function jn(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=el,e.scrollHeight=Wo)}function ua(e){var a=function(){return!0};e.classList=[],e.classList.add=a,e.classList.remove=a,e.classList.contains=a,e.classList.toggle=a}function Jo(e){var a=Ta();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function Ta(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function so(){}var xo=function(e){(0,mr.Z)(t,e);var a=Jo(t);function t(){var i,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return(0,xt.Z)(this,t),i=a.call(this),i.className="",i.children=[],i.focus=so,i.blur=so,i.insertBefore=so,i.appendChild=so,i.removeChild=so,i.remove=so,i.innerHTML="",i.tagName=r.toUpperCase(),Me((0,dt.Z)(i),o),ut((0,dt.Z)(i)),ua((0,dt.Z)(i)),Zt((0,dt.Z)(i)),sn((0,dt.Z)(i)),jn((0,dt.Z)(i)),i}return(0,St.Z)(t)}(ws);function To(e){var a=Ls();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function Ls(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var js=function(e){(0,mr.Z)(t,e);var a=To(t);function t(i){return(0,xt.Z)(this,t),a.call(this,i)}return(0,St.Z)(t,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),t}(xo);function _u(e){var a=xu();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function xu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Mu=function(e){(0,mr.Z)(t,e);var a=_u(t);function t(){return(0,xt.Z)(this,t),a.call(this,"video")}return(0,St.Z)(t)}(js),Uo={},Zo={};function Fa(e,a){Uo=e,Uo.id=a,"tagName"in Uo||(Uo.tagName="CANVAS"),Uo.type="canvas",Mixin.parentNode(Uo),Mixin.style(Uo),Mixin.classList(Uo),Mixin.clientRegion(Uo),Mixin.offsetRegion(Uo),Uo.focus=function(){},Uo.blur=function(){}}function As(e,a){var t=1024,i=1024;Zo={width:t,height:i,clientWidth:t/devicePixelRatio,clientHeight:i/devicePixelRatio,id:a,type:"canvas"},"tagName"in Zo||(Zo.tagName="CANVAS"),Mixin.parentNode(Zo),Mixin.style(Zo),Mixin.classList(Zo),Mixin.clientRegion(Zo),Mixin.offsetRegion(Zo),Zo.getContext=function(r){if(r==="2d")return e},Zo.focus=function(){},Zo.blur=function(){}}function Hu(){return Uo}function Zh(){return Zo}var Cc=(0,St.Z)(function e(){(0,xt.Z)(this,e);var a=Hu(),t=a.createImage&&a.createImage()||{};return"tagName"in t||(t.tagName="IMG",t.__proto__=e.prototype),Me(t),ua(t),Object.assign(t,{addEventListener:function(r,o){t["on".concat(r)]=o.bind(t)},removeEventListener:function(r){t["on".concat(r)]=null}}),t}),Xf={href:"",protocol:"",host:""};function yl(e){var a=Hc();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function Hc(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _l=function(e){(0,mr.Z)(t,e);var a=yl(t);function t(){return(0,xt.Z)(this,t),a.call(this,"body",0)}return(0,St.Z)(t,[{key:"addEventListener",value:function(r,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(r,o,u){}},{key:"dispatchEvent",value:function(r){}}]),t}(xo),gf=function(e){(0,mr.Z)(t,e);var a=yl(t);function t(){return(0,xt.Z)(this,t),a.call(this,"html",0)}return(0,St.Z)(t,[{key:"addEventListener",value:function(r,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(r,o){}},{key:"dispatchEvent",value:function(r){}}]),t}(xo),b={},I={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Xf,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(a){return a=a.toLowerCase(),a==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):a==="img"?new Cc:a==="video"?new Mu:new xo(a)},createElementNS:function(a,t){return this.createElement(t)},createTextNode:function(a){return a},getElementById:function(a){return null},getElementsByTagName:function(a){return a=a.toLowerCase(),[]},getElementsByTagNameNS:function(a,t){return this.getElementsByTagName(t)},getElementsByName:function(a){return[]},querySelector:function(a){return null},querySelectorAll:function(a){return[]},addEventListener:function(a,t,i){b[a]||(b[a]=[]),b[a].push(t)},removeEventListener:function(a,t){var i=b[a];if(i&&i.length>0){for(var r=i.length;r--;r>0)if(i[r]===t){i.splice(r,1);break}}},dispatchEvent:function(a){var t=a.type,i=b[t];if(i)for(var r=0;r<i.length;r++)i[r](a);a.target&&typeof a.target["on"+t]=="function"&&a.target["on"+t](a)},createEvent:function(a){return new Ya(a)}};I.documentElement=new gf,I.head=new xo("head"),I.body=new _l;var G=Object,D=vt(71002),re=function(){function e(){(0,xt.Z)(this,e);var a=arguments.length;if(a===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else a===3&&(0,D.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,St.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),Te=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,it,ht,Tt;if(Te){var _r=my.getSystemInfoSync();it=_r.system,ht=_r.platform,Tt=_r.language}else{var br={versions:function(){var e=oi.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(oi.navigator.browserLanguage||oi.navigator.language).toLowerCase()};br.versions.android?ht="android":br.versions.trident?ht="IE":br.versions.presto?ht="Opera":br.versions.webKit?ht="webKit":br.versions.gecko?ht="Firefox":br.versions.mobile?ht="mobile":br.versions.ios?ht="ios":br.versions.iPhone?ht="iPhone":br.versions.iPad?ht="ipad":br.versions.webApp?ht="webApp":br.versions.weixin?ht="weixin":br.versions.qq&&(ht="qq"),it=oi.navigator.userAgent,Tt=br.language}var si=it.toLowerCase().indexOf("android")!==-1,Ni=si?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Di="Mozilla/5.0 (".concat(Ni,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Tt),ia={platform:ht,language:Tt,appVersion:"5.0 (".concat(Ni,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Di},Ga={mark:function(a){return null},clearMeasures:function(a){return null},clearMarks:function(a){return null},measure:function(a,t,i){return{duration:0}},now:function(){}},uo=0,ga=0;function Ks(e){var a=Date.now(),t=Math.max(uo+23,a);return ga=setTimeout(function(){e(uo=t)},t-a),ga}function Zl(e){var a=Hu();return a.requestAnimationFrame?a.requestAnimationFrame(e):Ks(e)}function Wc(e){var a=Hu();return a.cancelAnimationFrame?a.cancelAnimationFrame(e):clearTimeout(e)}var Xc=function(){function e(a){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,xt.Z)(this,e),a.indexOf("http://")==0||a.indexOf("https://")==0){this.href=a;return}this.href=t+a}return(0,St.Z)(e,null,[{key:"createObjectURL",value:function(t){var i=t.buffers[0],r=t.type,o=Sc(i),u="data:".concat(r,";base64, ");return u+o}}]),e}();function Sc(e){for(var a="",t=new Uint8Array(e),i=t.byteLength,r=0;r<i;r++)a+=String.fromCharCode(t[r]);return Cn(a)}var wc={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},ku={};function Vl(e){var a=xl();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function xl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Oo=new Map,Vh=new Map,jh=new Map,Iu={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function fh(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,a)}function ac(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,fh.call(this,"readystatechange",a)}var Rs=function(e){(0,mr.Z)(t,e);var a=Vl(t);function t(){var i;return(0,xt.Z)(this,t),i=a.call(this),i.onabort=null,i.onerror=null,i.onload=null,i.onloadstart=null,i.onprogress=null,i.ontimeout=null,i.onloadend=null,i.onreadystatechange=null,i.readyState=0,i.response=null,i.responseText=null,i._responseType="text",i.responseXML=null,i.status=0,i.statusText="",i.upload={},i.withCredentials=!1,Oo.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),i}return(0,St.Z)(t,[{key:"responseType",set:function(r){this._responseType=r}},{key:"abort",value:function(){var r=jh.get("requestTask");r&&r.abort()}},{key:"getAllResponseHeaders",value:function(){var r=Vh.get("responseHeader");return Object.keys(r).map(function(o){return"".concat(o,": ").concat(r[o])}).join(`
`)}},{key:"getResponseHeader",value:function(r){return Vh.get("responseHeader")[r]}},{key:"open",value:function(r,o,u){this._method=r,this._url=o}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(r,o){var u=Oo.get("requestHeader");u[r]=o,Oo.set("requestHeader",u)}},{key:"addEventListener",value:function(r,o){var u=this;typeof o=="function"&&(this["on"+r]=function(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};p.target=p.target||u,o.call(u,p)})}},{key:"removeEventListener",value:function(r,o){this["on"+r]===o&&(this["on"+r]=null)}}]),t}(Li);Rs.UNSEND=0,Rs.OPENED=1,Rs.HEADERS_RECEIVED=2,Rs.LOADING=3,Rs.DONE=4;function hh(e){var a=bl();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function bl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var no=function(e){(0,mr.Z)(t,e);var a=hh(t);function t(i){var r;return(0,xt.Z)(this,t),r=a.call(this,i),r.touches=[],r.targetTouches=[],r.changedTouches=[],r.target=Hu(),r.currentTarget=Hu(),r}return(0,St.Z)(t)}(Ya);function Pu(e){var a=e||{},t=a.x,i=t===void 0?0:t,r=a.y,o=r===void 0?0:r,u=a.clientX,p=u===void 0?0:u,v=a.clientY,g=v===void 0?0:v;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=i,e.pageY=e.clientY=o):(e.x=p,e.y=g)}function Yf(e){return function(a){var t=new no(e);t.changedTouches=a.changedTouches,t.touches=a.touches,t.targetTouches=Array.prototype.slice.call(a.touches),t.timeStamp=a.timeStamp,t.changedTouches.forEach(function(i){return Pu(i)}),t.touches.forEach(function(i){return Pu(i)}),t.targetTouches.forEach(function(i){return Pu(i)}),I.dispatchEvent(t)}}function El(e){return function(a){a.type=e,I.dispatchEvent(a)}}var od=Yf("touchstart"),i0=Yf("touchmove"),sd=Yf("touchend"),ph=El("mapCameaParams");function Yc(e){var a=yf();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function yf(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ac=function(e){(0,mr.Z)(t,e);var a=Yc(t);function t(i){var r;return(0,xt.Z)(this,t),r=a.call(this,i),r.target=Hu(),r.currentTarget=Hu(),r}return(0,St.Z)(t)}(Ya),qc=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Tc=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],_f="touch";function oc(e,a,t){for(var i=new Ac(e),r=0;r<qc.length;r++){var o=qc[r];i[o]=a[o]||Tc[r]}return i.type=e,i.target=Hu(),i.currentTarget=Hu(),i.buttons=cu(e),i.which=i.buttons,i.pointerId=(a.identifier||0)+2,i.bubbles=!0,i.cancelable=!0,i.button=0,i.width=(a.radiusX||.5)*2,i.height=(a.radiusY||.5)*2,i.pressure=a.force||.5,i.isPrimary=qf(a),i.pointerType=_f,i.altKey=t.altKey,i.ctrlKey=t.ctrlKey,i.metaKey=t.metaKey,i.shiftKey=t.shiftKey,t.preventDefault&&(i.preventDefault=function(){t.preventDefault()}),i}function cu(e){var a=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(a=1),a}var sc=null;function qf(e){return sc===e.identifier}function Gh(e){sc===null&&(sc=e.identifier)}function Mc(e){sc===e.identifier&&(sc=null)}function Cl(e){return function(a){for(var t=a.changedTouches,i=0;i<t.length;i++){var r=t[i];i===0&&e==="pointerdown"?Gh(r):(e==="pointerup"||e==="pointercancel")&&Mc(r);var o=oc(e,r,a);I.dispatchEvent(o)}}}var uc=Cl("pointerdown"),xf=Cl("pointermove"),kc=Cl("pointerup");function Hh(e){var a=bf();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function bf(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ic=function(e){(0,mr.Z)(t,e);var a=Hh(t);function t(i){return(0,xt.Z)(this,t),a.call(this,i)}return(0,St.Z)(t)}(Ya);function Ef(e){return function(a){a.type=e,I.dispatchEvent(a)}}var Wh=Ef("mousedown"),Cf=Ef("mousemove"),ud=Ef("mouseup"),wp=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,dh=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u"),Ts=wp||dh,Ap={atob:$i,btoa:Cn,devicePixelRatio:fo,Blob:qi,document:I,Element:ws,Event:Ya,EventTarget:Li,HTMLCanvasElement:G,HTMLElement:xo,HTMLMediaElement:js,HTMLVideoElement:Mu,Image:Cc,ImageData:re,navigator:ia,Node:Ao,requestAnimationFrame:Zl,cancelAnimationFrame:Wc,screen:yu,XMLHttpRequest:Rs,performance:Ga,URL:Xc,WebGLRenderingContext:wc,WebGL2RenderingContext:ku,addEventListener:function(a,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};I.addEventListener(a,t,i)},removeEventListener:function(a,t,i){I.removeEventListener(a,t)},dispatchEvent:function(a){I.dispatchEvent(a)},innerWidth:yu.availWidth,innerHeight:yu.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},Ia=Ts?Ap:oi,bo=Ts?Rs:oi.XMLHttpRequest,$f=Ts?Xf:oi.location;function $c(e){var a=e;return typeof e=="string"&&(a=Ia.document.getElementById(e)),a}function tl(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function ya(e){return tl(e).split(/\s+/)}function ho(e){var a,t,i=Ia==null||(a=Ia.document)===null||a===void 0||(t=a.documentElement)===null||t===void 0?void 0:t.style;if(!i)return e[0];for(var r in e)if(e[r]&&e[r]in i)return e[r];return e[0]}function ka(e,a,t){var i=Ia.document.createElement(e);return i.className=a||"",t&&t.appendChild(i),i}function jl(e){var a=e.parentNode;a&&a.removeChild(e)}function bu(e,a){if(e.classList!==void 0)for(var t=ya(a),i=0,r=t.length;i<r;i++)e.classList.add(t[i]);else if(!rl(e,a)){var o=Sf(e);Tp(e,(o?o+" ":"")+a)}}function Pc(e,a){e.classList!==void 0?e.classList.remove(a):Tp(e,tl((" "+Sf(e)+" ").replace(" "+a+" "," ")))}function rl(e,a){if(e.classList!==void 0)return e.classList.contains(a);var t=Sf(e);return t.length>0&&new RegExp("(^|\\s)"+a+"(\\s|$)").test(t)}function Tp(e,a){e instanceof HTMLElement?e.className=a:e.className.baseVal=a}function Sf(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Kf(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var lc=ho(["transform","WebkitTransform"]);function us(e,a){e.style[lc]=a}function Sl(){if(typeof Event=="function")Ia.dispatchEvent(new Event("resize"));else{var e=Ia.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,Ia,0),Ia.dispatchEvent(e)}}function vh(e){var a=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,a.join(""))}function Vo(){var e,a=Ia.document.querySelector('meta[name="viewport"]');if(!a)return 1;var t=(e=a.content)===null||e===void 0?void 0:e.split(","),i=t.find(function(r){var o=r.split("="),u=(0,pr.Z)(o,2),p=u[0],v=u[1];return p==="initial-scale"});return i?i.split("=")[1]*1:1}var tn=Vo()<1?1:Ia.devicePixelRatio;function Xo(e){if(e.length===0)throw new Error("max requires at least one data point");for(var a=e[0],t=1;t<e.length;t++)e[t]>a&&(a=e[t]);return a*1}function Lc(e){if(e.length===0)throw new Error("min requires at least one data point");for(var a=e[0],t=1;t<e.length;t++)e[t]<a&&(a=e[t]);return a*1}function Kc(e){if(e.length===0)return 0;for(var a=e[0]*1,t=1;t<e.length;t++)a+=e[t]*1;return a}function Wu(e){if(e.length===0)throw new Error("mean requires at least one data point");return Kc(e)/e.length}function Lu(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var a=e[0],t=NaN,i=0,r=1,o=1;o<e.length+1;o++)e[o]!==a?(r>i&&(i=r,t=a),r=1,a=e[o]):r++;return t*1}var Gl={min:Lc,max:Xo,mean:Wu,sum:Kc,mode:Lu};function mn(e,a){return e.map(function(t){return t[a]})}function wf(e,a){return Gl[e](a)}var Sa=vt(15861),Hl=vt(89611);function po(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var fu=vt(78814);function Qc(e,a,t){return(0,fu.Z)()?Qc=Reflect.construct.bind():Qc=function(r,o,u){var p=[null];p.push.apply(p,o);var v=Function.bind.apply(r,p),g=new v;return u&&(0,Hl.Z)(g,u.prototype),g},Qc.apply(null,arguments)}function wl(e){var a=typeof Map=="function"?new Map:void 0;return wl=function(i){if(i===null||!po(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a<"u"){if(a.has(i))return a.get(i);a.set(i,r)}function r(){return Qc(i,arguments,(0,nt.Z)(this).constructor)}return r.prototype=Object.create(i.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),(0,Hl.Z)(r,i)},wl(e)}var Eu=vt(64687),zn=vt.n(Eu);function Mp(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap}function Qf(){return typeof importScripts=="function"}var ld=Qf()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href};function Xh(e){var a=nl();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function nl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Os=function(e){(0,mr.Z)(t,e);var a=Xh(t);function t(i,r,o,u){var p;return(0,xt.Z)(this,t),p=a.call(this,"AJAXError: ".concat(r," (").concat(i,"): ").concat(o)),p.status=i,p.statusText=r,p.url=o,p.body=u,p}return(0,St.Z)(t)}(wl(Error));function aa(e,a){var t=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:getReferrer(),signal:e==null?void 0:e.signal});return e.type==="json"&&t.headers.set("Accept","application/json"),fetch(t).then(function(i){return i.ok?(e.type==="arrayBuffer"?i.arrayBuffer():e.type==="json"?i.json():i.text()).then(function(r){a(null,r,i.headers.get("Cache-Control"),i.headers.get("Expires"))}).catch(function(r){a(new Error(r.message))}):i.blob().then(function(r){return a(new Os(i.status,i.statusText,e.url,r))})}).catch(function(i){a(new Error(i.message))})}function il(e,a){var t=new bo;t.open(e.method||"GET",e.url,!0),e.type==="arrayBuffer"&&(t.responseType="arraybuffer");for(var i in e.headers)e.headers.hasOwnProperty(i)&&t.setRequestHeader(i,e.headers[i]);return e.type==="json"&&(t.responseType="text",t.setRequestHeader("Accept","application/json")),t.withCredentials=e.credentials==="include",t.onerror=function(){a(new Error(t.statusText))},t.onload=function(){if((t.status>=200&&t.status<300||t.status===0)&&t.response!==null){var r=t.response;if(e.type==="json")try{r=JSON.parse(t.response)}catch(u){return a(u)}a(null,r,t.getResponseHeader("Cache-Control"),t.getResponseHeader("Expires"))}else{var o=new Blob([t.response],{type:t.getResponseHeader("Content-Type")});a(new Os(t.status,t.statusText,e.url,o))}},t.send(e.body),t}function Gs(e,a){return il(e,a)}var Qs=function(a,t){return Gs(_objectSpread(_objectSpread({},a),{},{type:"json"}),t)},cc=function(a,t){return Gs((0,Z.Z)((0,Z.Z)({},a),{},{type:"arrayBuffer"}),t)},Jc=function(a,t){return Gs(_objectSpread(_objectSpread({},a),{},{method:"POST"}),t)};function al(e){var a=$window.document.createElement("a");return a.href=e,a.protocol===$window.document.location.protocol&&a.host===$window.document.location.host}var Hs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Al(e,a){var t=new Ia.Image,i=Ia.URL||Ia.webkitURL;t.crossOrigin="anonymous",t.onload=function(){a(null,t),i.revokeObjectURL(t.src),t.onload=null,window.requestAnimationFrame(function(){t.src=Hs})},t.onerror=function(){return a(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var r=new Blob([new Uint8Array(e)],{type:"image/png"});t.src=e.byteLength?i.createObjectURL(r):Hs}function ci(e,a){var t=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(t).then(function(i){a(null,i)}).catch(function(i){a(new Error("Could not load image because of ".concat(i.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var ti=function(a,t){return cc(a,function(i,r){if(i)t(i);else if(r){var o=typeof createImageBitmap=="function";o?ci(r,t):Al(r,t)}})},mh=function(){var e=(0,Sa.Z)(zn().mark(function a(t,i,r){var o,u,p,v,g,E;return zn().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.prev=0,O.next=3,r(t);case 3:o=O.sent,u=o.rasterData,p=o.width,v=o.height,g=0,E=8e3,i(null,{data:u,width:p,height:v,min:g,max:E}),O.next=15;break;case 12:O.prev=12,O.t0=O.catch(0),i(null,new Error(""+O.t0));case 15:case"end":return O.stop()}},a,null,[[0,12]])}));return function(t,i,r){return e.apply(this,arguments)}}(),Fs=function(a,t,i){return cc(a,function(r,o){r?t(r):o&&mh(o,t,i)})};function Ru(e){return typeof e=="number"}var Yo=2*Math.PI*6378137/2;function Tl(e){var a=[1/0,1/0,-1/0,-1/0];return e.forEach(function(t){var i=t.coordinates;Jf(a,i)}),a}function Jf(e,a){return Array.isArray(a[0])?a.forEach(function(t){Jf(e,t)}):(e[0]>a[0]&&(e[0]=a[0]),e[1]>a[1]&&(e[1]=a[1]),e[2]<a[0]&&(e[2]=a[0]),e[3]<a[1]&&(e[3]=a[1])),e}function Yh(e,a){return Na(e,a)}function Na(e,a){return Array.isArray(e[0])?e.map(function(t){return Na(t,a)}):a(e)}function io(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=kl(e,a);var i=e[0],r=e[1],o=i*Yo/180,u=Math.log(Math.tan((90+r)*Math.PI/360))/(Math.PI/180);return u=u*Yo/180,t.enable&&(o=Number(o.toFixed(t.decimal)),u=Number(u.toFixed(t.decimal))),e.length===3?[o,u,e[2]]:[o,u]}function kp(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,t=e[0],i=e[1],r=t/Yo*180,o=i/Yo*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),a!=null&&(r=Number(r.toFixed(a)),o=Number(o.toFixed(a))),e.length===3?[r,o,e[2]]:[r,o]}function Af(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Ml(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function kl(e,a){if(a===!1)return e;var t=Af(e[0]),i=Ml(e[1]);return i>85&&(i=85),i<-85&&(i=-85),e.length===3?[t,i,e[2]]:[t,i]}function za(e){var a=85.0511287798,t=Math.max(Math.min(a,e[1]),-a),i=256<<20,r=Math.PI/180,o=e[0]*r,u=t*r;u=Math.log(Math.tan(Math.PI/4+u/2));var p=.5/Math.PI,v=.5,g=-.5/Math.PI;return r=.5,o=i*(p*o+v),u=i*(g*u+r),[Math.floor(o),Math.floor(u)]}function Il(e){var a=.5/Math.PI,t=.5,i=-.5/Math.PI,r=.5,o=256<<20,u=_slicedToArray(e,2),p=u[0],v=u[1];p=(p/o-t)/a,v=(v/o-r)/i,v=(Math.atan(Math.pow(Math.E,v))-Math.PI/4)*2,r=Math.PI/180;var g=v/r,E=p/r;return[E,g]}function fc(e,a){var t=85.0511287798,i=Math.PI/180,r=6378137;return a=Math.max(Math.min(t,a),-t),e*=i,a*=i,a=Math.log(Math.tan(Math.PI/4+a/2)),[e*r,a*r]}function qh(e,a){var t=Math.PI/180,i=6378137,r=e/i/t,o=2*(Math.atan(Math.exp(a/i))-Math.PI/4)/t;return[r,o]}function Rc(e,a,t){var i=ie(a[1]-e[1]),r=ie(a[0]-e[0]),o=ie(e[1]),u=ie(a[1]),p=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(r/2),2)*Math.cos(o)*Math.cos(u);return ss(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t="meters")}function gh(e){var a=Math.PI/180,t=85.0511287798,i=6378137,r=Math.max(Math.min(t,e[1]),-t),o=Math.sin(r*a),u=i*e[0]*a,p=i*Math.log((1+o)/(1-o))/2;return[u,p]}function hc(e,a){var t=Math.abs(e[1][1]-e[0][1])*a,i=Math.abs(e[1][0]-e[0][0])*a;return[[e[0][0]-i,e[0][1]-t],[e[1][0]+i,e[1][1]+t]]}function pc(e,a){return e[0][0]<=a[0][0]&&e[0][1]<=a[0][1]&&e[1][0]>=a[1][0]&&e[1][1]>=a[1][1]}function Wl(e){return[[e[0],e[1]],[e[2],e[3]]]}function eh(e){var a=dc(e,[0,0]);return[e[0]/a,e[1]/a]}function dc(e,a){return Math.sqrt(Math.pow(e[0]-a[0],2)+Math.pow(e[1]-a[1],2))}function vc(e,a){return e[0]*a[0]+e[1]*a[1]}function th(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function ef(e,a){return Math.acos(vc(e,a)/(th(e)*th(a)))*180/Math.PI}function ol(e,a){return a[0]>0?a[1]>0?90-Math.atan(a[1]/a[0])*180/Math.PI:90+Math.atan(-a[1]/a[0])*180/Math.PI:a[1]<0?180+(90-Math.atan(a[1]/a[0])*180/Math.PI):270+Math.atan(a[1]/-a[0])*180/Math.PI}function rh(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var t=[0,1],i=0,r=[],o=0;o<e.length-1;o++){var u=e[o],p=e[o+1],v=dc(u,p);i+=v;var g=[u[0]-p[0],u[1]-p[1]],E=ol(t,g);if(o>0){var T=r[o-1].rotation;T-E>360-T+E&&(E=E+360)}r.push({start:u,end:p,dis:v,rotation:E,duration:0})}return r.map(function(O){O.duration=a*(O.dis/i)}),r}}function hu(e){if(Ru(e[0]))return e;if(Ru(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Ru(e[0][0][0])){var a=e,t=0,i=0,r=0;return a.forEach(function(o){o.forEach(function(u){t+=u[0],i+=u[1],r++})}),[t/r,i/r,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function Ip(e){for(var a=e[0],t=e[1],i=e[0],r=e[1],o=0,u=0,p=0,v=0;v<e.length;v+=2){var g=e[v],E=e[v+1];g&&E&&(a=Math.max(g,a),t=Math.max(E,t),i=Math.min(g,i),r=Math.min(E,r),o+=g,u+=E,p++)}return{center:[o/p,u/p],radius:Math.sqrt(Math.pow(a-i,2)+Math.pow(t-r,2))/2}}var tf=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;(0,xt.Z)(this,e),this.limit=a,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}return(0,St.Z)(e,[{key:"clear",value:function(){var t=this;this.order.forEach(function(i){t.delete(i)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var i=this.cache[t];return i&&(this.deleteOrder(t),this.appendOrder(t)),i}},{key:"set",value:function(t,i){this.cache[t]?(this.delete(t),this.cache[t]=i,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=i,this.appendOrder(t))}},{key:"delete",value:function(t){var i=this.cache[t];i&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(i,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var i=this.order.findIndex(function(r){return r===t});i>=0&&this.order.splice(i,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,i){return null}}]),e}();function c(e,a){e.forEach(function(t){!a[t]||(a[t]=a[t].bind(a))})}var h=null,f=vt(2650);function m(e){return typeof e=="string"?!!f.ZP(e):!1}function S(e){var a=f.ZP(e),t=[0,0,0,0];return a!=null&&(t[0]=a.r/255,t[1]=a.g/255,t[2]=a.b/255,t[3]=a.opacity),t}function k(e){var a=e&&e[0],t=e&&e[1],i=e&&e[2],r=a+t*256+i*65536-1;return r}function P(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function N(e){var a=Ia.document.createElement("canvas"),t=a.getContext("2d");a.width=256,a.height=1;var i=null;if(e.weights){var r=0;e.weights.map(function(O,F){var U=e.colors[F]||"rgba(0, 0, 0, 0)",j=r+O;t.fillStyle=U,t.fillRect(r*256,0,j*256,1),r=j})}else{for(var o=t.createLinearGradient(0,0,256,1),u=e.positions[0],p=e.positions[e.positions.length-1],v=0;v<e.colors.length;++v){var g=(e.positions[v]-u)/(p-u);o.addColorStop(g,e.colors[v])}t.fillStyle=o,t.fillRect(0,0,256,1)}if(Ts)return i=new Uint8ClampedArray(t.getImageData(0,0,256,1).data),a=null,t=null,{data:i,width:256,height:1};i=t.getImageData(0,0,256,1).data;for(var E=t.createImageData(256,1),T=0;T<E.data.length;T+=4)E.data[T+0]=i[T+0],E.data[T+1]=i[T+1],E.data[T+2]=i[T+2],E.data[T+3]=i[T+3];return a=null,t=null,E}var Y;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(Y||(Y={}));var te={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ye(e,a,t){var i=e.classList;for(var r in te)te.hasOwnProperty(r)&&i.remove("l7-".concat(t,"-anchor-").concat(r));i.add("l7-".concat(t,"-anchor-").concat(a))}function le(e,a){return{enable:e,mask:255,func:{cmp:514,ref:a?1:0,mask:255}}}function xe(e,a){if(!e)throw new Error(a||"web worker helper assertion failed.")}var ze={self:typeof self<"u"&&self,window:typeof window<"u"&&window,document:typeof document<"u"&&document},Ue=ze.self||ze.window||{},Je=ze.window||ze.self||{},Fe=ze.self||ze.window||{},et=ze.document||{},pt=typeof importScripts=="function",kt=typeof window<"u"&&typeof window.orientation<"u",Qt=function(){function e(a,t){var i=this;this.name=a,this.workerThread=t,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(r,o){i.resolve=r,i.reject=o})}return e.prototype.postMessage=function(a,t){this.workerThread.postMessage({source:"Main thread",type:a,payload:t})},e.prototype.done=function(a){xe(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(a)},e.prototype.error=function(a){xe(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(a)},e}(),Bt=Qt,nr=new Map;function Or(e){xe(e.source&&!e.url||!e.source&&e.url);var a=nr.get(e.source||e.url);return a||(e.url&&(a=un(e.url),nr.set(e.url,a)),e.source&&(a=rn(e.source),nr.set(e.source,a))),xe(a),a}function un(e){if(!e.startsWith("http"))return e;var a=Pn(e);return rn(a)}function rn(e){var a=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(a)}function Pn(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function ui(e,a,t){a===void 0&&(a=!0);var i=t||new Set;if(e){if(gi(e))i.add(e);else if(gi(e.buffer))i.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(a&&typeof e=="object")for(var r in e)ui(e[r],a,i)}}return t===void 0?Array.from(i):[]}function gi(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}var fi=function(){},_a=function(){function e(a){this.terminated=!1,this.loadableURL="";var t=a.name,i=a.source,r=a.url;xe(i||r),this.name=t,this.source=i,this.url=r,this.onMessage=fi,this.onError=function(o){return console.log(o)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker<"u"},e.prototype.destroy=function(){this.onMessage=fi,this.onError=fi,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(a,t){t=t||ui(a),this.worker.postMessage(a,t)},e.prototype.getErrorFromErrorEvent=function(a){var t="Failed to load ";return t+="worker "+this.name+" from "+this.url+". ",a.message&&(t+=a.message+" in "),a.lineno&&(t+=":"+a.lineno+":"+a.colno),new Error(t)},e.prototype.createBrowserWorker=function(){var a=this;this.loadableURL=Or({source:this.source,url:this.url});var t=new Worker(this.loadableURL,{name:this.name});return t.onmessage=function(i){i.data?a.onMessage(i.data):a.onError(new Error("No data received"))},t.onerror=function(i){a.onError(a.getErrorFromErrorEvent(i)),a.terminated=!0},t.onmessageerror=function(i){return console.error("worker "+a.name+", message error: "+i)},t},e}(),Dn=_a,Ii=function(){return Ii=Object.assign||function(e){for(var a,t=1,i=arguments.length;t<i;t++){a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},Ii.apply(this,arguments)},Wi=function(e,a,t,i){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function p(E){try{g(i.next(E))}catch(T){u(T)}}function v(E){try{g(i.throw(E))}catch(T){u(T)}}function g(E){E.done?o(E.value):r(E.value).then(p,v)}g((i=i.apply(e,a||[])).next())})},Bi=function(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,u;return u={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function p(g){return function(E){return v([g,E])}}function v(g){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,r&&(o=g[0]&2?r.return:g[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,g[1])).done)return o;switch(r=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return t.label++,{value:g[1],done:!1};case 5:t.label++,r=g[1],g=[0];continue;case 7:g=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){t=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){t.label=g[1];break}if(g[0]===6&&t.label<o[1]){t.label=o[1],o=g;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(g);break}o[2]&&t.ops.pop(),t.trys.pop();continue}g=a.call(e,t)}catch(E){g=[6,E],r=0}finally{i=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},wi=function(){function e(a){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=a.source,this.url=a.url,this.setProps(a)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(a){return a.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(a){this.props=Ii(Ii({},this.props),a),a.name!==void 0&&(this.name=a.name),a.maxConcurrency!==void 0&&(this.maxConcurrency=a.maxConcurrency),a.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=a.maxMobileConcurrency),a.reuseWorkers!==void 0&&(this.reuseWorkers=a.reuseWorkers),a.onDebug!==void 0&&(this.onDebug=a.onDebug)},e.prototype.startJob=function(a,t,i){return t===void 0&&(t=function(r,o,u){return r.done(u)}),i===void 0&&(i=function(r,o){return r.error(o)}),Wi(this,void 0,void 0,function(){var r,o=this;return Bi(this,function(u){switch(u.label){case 0:return r=new Promise(function(p){return o.jobQueue.push({name:a,onMessage:t,onError:i,onStart:p}),o}),this.startQueuedJob(),[4,r];case 1:return[2,u.sent()]}})})},e.prototype.startQueuedJob=function(){return Wi(this,void 0,void 0,function(){var a,t,i;return Bi(this,function(r){switch(r.label){case 0:if(!this.jobQueue.length)return[2];if(a=this.getAvailableWorker(),!a)return[2];if(t=this.jobQueue.shift(),!t)return[3,4];this.onDebug({message:"Starting job",name:t.name,backlog:this.jobQueue.length,workerThread:a}),i=new Bt(t.name,a),a.onMessage=function(o){return t.onMessage(i,o.type,o.payload)},a.onError=function(o){return t.onError(i,o)},t.onStart(i),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,i.result];case 2:return r.sent(),[3,4];case 3:return this.returnWorkerToQueue(a),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(a){var t=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();t?(a.destroy(),this.count--):this.idleQueue.push(a),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var a=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Dn({name:a,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return kt?this.maxMobileConcurrency:this.maxConcurrency},e}(),Ki=wi,Ci=function(){return Ci=Object.assign||function(e){for(var a,t=1,i=arguments.length;t<i;t++){a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},Ci.apply(this,arguments)},Si=function(e){var a=typeof Symbol=="function"&&Symbol.iterator,t=a&&e[a],i=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")},gs={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},qo=function(){function e(a){this.workerPools=new Map,this.props=Ci({},gs),this.setProps(a),this.workerPools=new Map}return e.isSupported=function(){return Dn.isSupported()},e.getWorkerFarm=function(a){return a===void 0&&(a={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(a),e.workerFarm},e.prototype.destroy=function(){var a,t;try{for(var i=Si(this.workerPools.values()),r=i.next();!r.done;r=i.next()){var o=r.value;o.destroy()}}catch(u){a={error:u}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(a)throw a.error}}},e.prototype.setProps=function(a){var t,i;this.props=Ci(Ci({},this.props),a);try{for(var r=Si(this.workerPools.values()),o=r.next();!o.done;o=r.next()){var u=o.value;u.setProps(this.getWorkerPoolProps())}}catch(p){t={error:p}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}},e.prototype.getWorkerPool=function(a){var t=a.name,i=a.source,r=a.url,o=this.workerPools.get(t);return o||(o=new Ki({name:t,source:i,url:r}),o.setProps(this.getWorkerPoolProps()),this.workerPools.set(t,o)),o},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),Ds=qo,es=new Map,vo=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(a){self.onmessage=function(t){if(!!pu(t)){var i=t.data,r=i.type,o=i.payload;a(r,o)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(a){var t=es.get(a);t||(t=function(i){if(!!pu(i)){var r=i.data,o=r.type,u=r.payload;a(o,u)}}),self.addEventListener("message",t)},e.removeEventListener=function(a){var t=es.get(a);es.delete(a),self.removeEventListener("message",t)},e.postMessage=function(a,t){if(self){var i={source:"Worker thread",type:a,payload:t},r=ui(t);self.postMessage(i,r)}},e}(),lo=vo;function pu(e){var a=e.type,t=e.data;return a==="message"&&t&&typeof t.source=="string"&&t.source==="Main thread"}function Js(e){return JSON.parse(Xl(e))}function Xl(e){var a=new Set;return JSON.stringify(e,function(t,i){if(typeof i=="object"&&i!==null){if(a.has(i))try{return JSON.parse(JSON.stringify(i))}catch{return}a.add(i)}return i})}function du(e){return""+e.name}function Xu(e,a){a===void 0&&(a={});var t=a[e.id]||{},i=e.name+".worker.js",r=t.workerUrl;return a._workerType==="test"&&(r=e.module+"/dist/"+i),r||(r="https://unpkg.com/"+e.module+"/dist/"+i),assert(r),r}var eu=function(e,a,t,i){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function p(E){try{g(i.next(E))}catch(T){u(T)}}function v(E){try{g(i.throw(E))}catch(T){u(T)}}function g(E){E.done?o(E.value):r(E.value).then(p,v)}g((i=i.apply(e,a||[])).next())})},Tf=function(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,u;return u={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function p(g){return function(E){return v([g,E])}}function v(g){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,r&&(o=g[0]&2?r.return:g[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,g[1])).done)return o;switch(r=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return t.label++,{value:g[1],done:!1};case 5:t.label++,r=g[1],g=[0];continue;case 7:g=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){t=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){t.label=g[1];break}if(g[0]===6&&t.label<o[1]){t.label=o[1],o=g;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(g);break}o[2]&&t.ops.pop(),t.trys.pop();continue}g=a.call(e,t)}catch(E){g=[6,E],r=0}finally{i=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};function rf(e,a){return WorkerFarm.isSupported()?e.worker&&(a==null?void 0:a.worker):!1}function Yl(e,a,t,i){return t===void 0&&(t={}),i===void 0&&(i={}),eu(this,void 0,void 0,function(){var r,o,u,p,v,g,E,T;return Tf(this,function(O){switch(O.label){case 0:return r=getWorkerName(e),o=getWorkerURL(e,t),u=WorkerFarm.getWorkerFarm(t),p=u.getWorkerPool({name:r,url:o}),v=t.jobName||e.name,[4,p.startJob(v,sl.bind(null,i))];case 1:return g=O.sent(),E=removeNontransferableOptions(t),g.postMessage("process",{input:a,options:E}),[4,g.result];case 2:return T=O.sent(),[2,T.result]}})})}function sl(e,a,t,i){return eu(this,void 0,void 0,function(){var r,o,u,p,v,g,E;return Tf(this,function(T){switch(T.label){case 0:switch(r=t,r){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return a.done(i),[3,9];case 2:return a.error(new Error(i.error)),[3,9];case 3:o=i.id,u=i.input,p=i.options,T.label=4;case 4:return T.trys.push([4,6,,7]),e.process?[4,e.process(u,p)]:(a.postMessage("error",{id:o,error:"Worker not set up to process on main thread"}),[2]);case 5:return v=T.sent(),a.postMessage("done",{id:o,result:v}),[3,7];case 6:return g=T.sent(),E=g instanceof Error?g.message:"unknown error",a.postMessage("error",{id:o,error:E}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+t),T.label=9;case 9:return[2]}})})}var Mf=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(a){return this.enqueue(a)},e.prototype.enqueue=function(a){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();a instanceof Error?t.reject(a):t.resolve({value:a})}else this._values.push(a)},e.prototype.close=function(){for(;this._settlers.length>0;){var a=this._settlers.shift();a.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var a=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(i,r){a._settlers.push({resolve:i,reject:r})})},e}(),ul=Mf,mc=function(e,a,t,i){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function p(E){try{g(i.next(E))}catch(T){u(T)}}function v(E){try{g(i.throw(E))}catch(T){u(T)}}function g(E){E.done?o(E.value):r(E.value).then(p,v)}g((i=i.apply(e,a||[])).next())})},ql=function(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,u;return u={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function p(g){return function(E){return v([g,E])}}function v(g){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,r&&(o=g[0]&2?r.return:g[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,g[1])).done)return o;switch(r=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return t.label++,{value:g[1],done:!1};case 5:t.label++,r=g[1],g=[0];continue;case 7:g=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){t=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){t.label=g[1];break}if(g[0]===6&&t.label<o[1]){t.label=o[1],o=g;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(g);break}o[2]&&t.ops.pop(),t.trys.pop();continue}g=a.call(e,t)}catch(E){g=[6,E],r=0}finally{i=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},ls=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=e[Symbol.asyncIterator],t;return a?a.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=e[o]&&function(u){return new Promise(function(p,v){u=e[o](u),r(p,v,u.done,u.value)})}}function r(o,u,p,v){Promise.resolve(v).then(function(g){o({value:g,done:p})},u)}},Pl=0,Ll,tu;function Pa(e,a){var t=this;if(!(typeof self>"u")){var i={process:Ou};lo.onmessage=function(r,o){return mc(t,void 0,void 0,function(){var u,p,v,g,E,T,O,F,U,j,K;return ql(this,function(ae){switch(ae.label){case 0:switch(ae.trys.push([0,19,,20]),u=r,u){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(o.input,o.options||{},i)];case 2:return p=ae.sent(),lo.postMessage("done",{result:p}),[3,18];case 3:if(!a)throw new Error("Worker does not support batched processing");Ll=new ul,tu=o.options||{},v=a(Ll,tu,i),ae.label=4;case 4:ae.trys.push([4,9,10,15]),g=ls(v),ae.label=5;case 5:return[4,g.next()];case 6:if(E=ae.sent(),!!E.done)return[3,8];T=E.value,lo.postMessage("output-batch",{result:T}),ae.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return O=ae.sent(),j={error:O},[3,15];case 10:return ae.trys.push([10,,13,14]),E&&!E.done&&(K=g.return)?[4,K.call(g)]:[3,12];case 11:ae.sent(),ae.label=12;case 12:return[3,14];case 13:if(j)throw j.error;return[7];case 14:return[7];case 15:return lo.postMessage("done",{}),[3,18];case 16:return Ll.push(o.input),[3,18];case 17:return Ll.close(),[3,18];case 18:return[3,20];case 19:return F=ae.sent(),U=F instanceof Error?F.message:"",lo.postMessage("error",{error:U}),[3,20];case 20:return[2]}})})}}}function Ou(e,a){return a===void 0&&(a={}),new Promise(function(t,i){var r=Pl++,o=function(p,v){if(v.id===r)switch(p){case"done":lo.removeEventListener(o),t(v.result);break;case"error":lo.removeEventListener(o),i(v.error);break;default:}};lo.addEventListener(o);var u={id:r,input:e,options:a};lo.postMessage("process",u)})}var Bs=function(e,a,t,i){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function p(E){try{g(i.next(E))}catch(T){u(T)}}function v(E){try{g(i.throw(E))}catch(T){u(T)}}function g(E){E.done?o(E.value):r(E.value).then(p,v)}g((i=i.apply(e,a||[])).next())})},gc=function(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,u;return u={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function p(g){return function(E){return v([g,E])}}function v(g){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,r&&(o=g[0]&2?r.return:g[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,g[1])).done)return o;switch(r=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return t.label++,{value:g[1],done:!1};case 5:t.label++,r=g[1],g=[0];continue;case 7:g=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){t=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){t.label=g[1];break}if(g[0]===6&&t.label<o[1]){t.label=o[1],o=g;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(g);break}o[2]&&t.ops.pop(),t.trys.pop();continue}g=a.call(e,t)}catch(E){g=[6,E],r=0}finally{i=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},kf={};function $h(e,a,t){return a===void 0&&(a=null),t===void 0&&(t={}),Bs(this,void 0,void 0,function(){return gc(this,function(i){switch(i.label){case 0:return a&&(e=Kh(e,a,t)),kf[e]=kf[e]||Yu(e),[4,kf[e]];case 1:return[2,i.sent()]}})})}function Kh(e,a,t){if(e.startsWith("http"))return e;var i=t.modules||{};return i[e]?i[e]:t.CDN?(assert(t.CDN.startsWith("http")),t.CDN+"/"+a+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+a+"/src/libs/"+e}function Yu(e){return Bs(this,void 0,void 0,function(){var a,t,i;return gc(this,function(r){switch(r.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return a=r.sent(),[4,a.arrayBuffer()];case 2:return[2,r.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return t=r.sent(),[4,t.text()];case 5:return i=r.sent(),[2,Oc(i,e)]}})})}function Oc(e,a){if(isWorker)return eval.call(global,e),null;var t=document.createElement("script");t.id=a;try{t.appendChild(document.createTextNode(e))}catch{t.text=e}return document.body.appendChild(t),null}var Fu="0.0.3",If={id:"null",name:"null",module:"web-worker-helper",options:{}},Pf=vt(75174),$l=vt.n(Pf);function ys(e,a){var t=e.color;return!t||!t.length?[1,1,1,1]:t}function Lf(e,a,t){return t.length===2?[t[0],t[1],0]:[t[0],t[1],t[2]]}function Rl(e,a){var t=e.filter;return t?[1]:[0]}function yh(e,a,t,i){return[a]}var Cu=vt(9187),vu=vt.n(Cu),ee=vt(4942),Ur=vt(31437),Rf=Ur.Ue(),cd=Ur.Ue(),Ws=Ur.Ue(),mu=Ur.Ue(),Kl=Ur.Ue();function Pp(e,a,t,i,r){Ur.IH(e,t,i),Ur.Fv(e,e),a=Ur.al(-e[1],e[0]);var o=Ur.al(-t[1],t[0]);return[r/Ur.AK(a,o),a]}function Of(e,a){return Ur.t8(e,-a[1],a[0])}function ru(e,a,t){return Ur.lu(e,a,t),Ur.Fv(e,e),e}function ll(e,a){return e[0]===a[0]&&e[1]===a[1]}function lv(e){for(var a=new Map,t=0;t<e.length;t++){var i=e[0].toString()+"-"+e[1].toString();a.get(i)?(e.splice(t,1),t++):a.set(i,i)}return e}var Dd=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,xt.Z)(this,e),(0,ee.Z)(this,"lastFlip",-1),(0,ee.Z)(this,"miter",Ur.al(0,0)),(0,ee.Z)(this,"started",!1),(0,ee.Z)(this,"dash",!1),(0,ee.Z)(this,"totalDistance",0),(0,ee.Z)(this,"currentIndex",0),this.join=a.join||"miter",this.cap=a.cap||"butt",this.miterLimit=a.miterLimit||10,this.thickness=a.thickness||1,this.dash=a.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,St.Z)(e,[{key:"extrude_gaode2",value:function(t,i){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,p=1;p<o;p++){var v,g,E,T=t[p-1];T.push((v=i[p-1][2])!==null&&v!==void 0?v:0);var O=i[p-1],F=t[p];F.push((g=i[p][2])!==null&&g!==void 0?g:0);var U=i[p],j=p<t.length-1?[].concat((0,Ee.Z)(t[p+1]),[(E=i[p+1][2])!==null&&E!==void 0?E:0]):null,K=p<i.length-1?i[p+1]:null,ae=this.segment_gaode2(r,u,T,F,j,O,U,K);u+=ae}if(this.dash)for(var ve=0;ve<r.positions.length/6;ve++)r.positions[ve*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,i){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,p=1;p<o;p++){var v,g,E,T=t[p-1];T.push((v=i[p-1][2])!==null&&v!==void 0?v:0);var O=i[p-1],F=t[p];F.push((g=i[p][2])!==null&&g!==void 0?g:0);var U=i[p],j=p<t.length-1?[].concat((0,Ee.Z)(t[p+1]),[(E=i[p+1][2])!==null&&E!==void 0?E:0]):null,K=p<i.length-1?i[p+1]:null,ae=this.simpleSegment(r,u,T,F,j,O,U,K);u+=ae}if(this.dash)for(var ve=0;ve<r.positions.length/6;ve++)r.positions[ve*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=i.startIndex,u=1;u<r;u++){var p=t[u-1],v=t[u],g=u<t.length-1?t[u+1]:null,E=this.segment(i,o,p,v,g);o+=E}if(this.dash)for(var T=0;T<i.positions.length/6;T++)i.positions[T*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude",value:function(t){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=i.startIndex,u=1;u<r;u++){var p=t[u-1],v=t[u],g=u<t.length-1?t[u+1]:null,E=this.simpleSegment(i,o,p,v,g);o+=E}if(this.dash)for(var T=0;T<i.positions.length/6;T++)i.positions[T*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"segment_gaode2",value:function(t,i,r,o,u,p,v,g){var E=0,T=t.indices,O=t.positions,F=t.normals,U=this.cap==="square",j=this.join==="bevel",K=za([v[0],v[1]]),ae=za([p[0],p[1]]);ru(Ws,o,r);var ve=0;if(this.dash&&(ve=this.lineSegmentDistance(K,ae),this.totalDistance+=ve),this.normal||(this.normal=Ur.Ue(),Of(this.normal,Ws)),!this.started)if(this.started=!0,U){var ke=Ur.Ue(),qe=Ur.Ue();Ur.IH(ke,this.normal,Ws),Ur.IH(qe,this.normal,Ws),F.push(qe[0],qe[1],0),F.push(ke[0],ke[1],0),O.push(r[0],r[1],r[2]|0,this.totalDistance-ve,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),O.push(r[0],r[1],r[2]|0,this.totalDistance-ve,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(O,F,r,this.normal,this.thickness,this.totalDistance-ve);if(T.push(i+0,i+1,i+2),u){ll(o,u)&&Ur.IH(u,o,Ur.Fv(u,Ur.$X(u,o,r))),ru(mu,u,o);var Ot=Pp(Kl,Ur.Ue(),Ws,mu,this.thickness),Xt=(0,pr.Z)(Ot,2),yr=Xt[0],Pr=Xt[1],xr=Ur.AK(Kl,this.normal)<0?-1:1,An=j;if(!An&&this.join==="miter"){var ii=yr;ii>this.miterLimit&&(An=!0)}An?(F.push(this.normal[0],this.normal[1],0),F.push(Pr[0],Pr[1],0),O.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*xr,o[2]|0),this.complex.indexes.push(this.currentIndex),O.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*xr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,T.push.apply(T,(0,Ee.Z)(this.lastFlip!==-xr?[i,i+2,i+3]:[i+2,i+1,i+3])),T.push(i+2,i+3,i+4),Of(Rf,mu),Ur.JG(this.normal,Rf),F.push(this.normal[0],this.normal[1],0),O.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*xr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,E+=3):(this.extrusions(O,F,o,Pr,yr,this.totalDistance),T.push.apply(T,(0,Ee.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),xr=-1,Ur.JG(this.normal,Pr),E+=2),this.lastFlip=xr}else{if(Of(this.normal,Ws),U){var ct=Ur.Ue(),_t=Ur.Ue();Ur.lu(_t,Ws,this.normal),Ur.IH(ct,Ws,this.normal),F.push(_t[0],_t[1],0),F.push(ct[0],ct[1],0),O.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),O.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(O,F,o,this.normal,this.thickness,this.totalDistance);T.push.apply(T,(0,Ee.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),E+=2}return E}},{key:"simpleSegment",value:function(t,i,r,o,u){var p=0,v=t.indices,g=t.positions,E=t.normals,T=za([o[0],o[1]]),O=za([r[0],r[1]]);ru(Ws,T,O);var F=0;if(this.dash&&(F=this.lineSegmentDistance(T,O),this.totalDistance+=F),this.normal||(this.normal=Ur.Ue(),Of(this.normal,Ws)),this.started||(this.started=!0,this.extrusions(g,E,r,this.normal,this.thickness,this.totalDistance-F)),v.push(i+0,i+1,i+2),!u)Of(this.normal,Ws),this.extrusions(g,E,o,this.normal,this.thickness,this.totalDistance),v.push.apply(v,(0,Ee.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),p+=2;else{var U=za([u[0],u[1]]);ll(T,U)&&Ur.IH(U,T,Ur.Fv(U,Ur.$X(U,T,O))),ru(mu,U,T);var j=Pp(Kl,Ur.Ue(),Ws,mu,this.thickness),K=(0,pr.Z)(j,2),ae=K[0],ve=K[1],ke=Ur.AK(Kl,this.normal)<0?-1:1;this.extrusions(g,E,o,ve,ae,this.totalDistance),v.push.apply(v,(0,Ee.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),ke=-1,Ur.JG(this.normal,ve),p+=2,this.lastFlip=ke}return p}},{key:"segment",value:function(t,i,r,o,u){var p=0,v=t.indices,g=t.positions,E=t.normals,T=this.cap==="square",O=this.join==="bevel",F=za([o[0],o[1]]),U=za([r[0],r[1]]);ru(Ws,F,U);var j=0;if(this.dash&&(j=this.lineSegmentDistance(F,U),this.totalDistance+=j),this.normal||(this.normal=Ur.Ue(),Of(this.normal,Ws)),!this.started)if(this.started=!0,T){var K=Ur.Ue(),ae=Ur.Ue();Ur.IH(K,this.normal,Ws),Ur.IH(ae,this.normal,Ws),E.push(ae[0],ae[1],0),E.push(K[0],K[1],0),g.push(r[0],r[1],r[2]|0,this.totalDistance-j,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),g.push(r[0],r[1],r[2]|0,this.totalDistance-j,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(g,E,r,this.normal,this.thickness,this.totalDistance-j);if(v.push(i+0,i+1,i+2),u){var qe=za([u[0],u[1]]);ll(F,qe)&&Ur.IH(qe,F,Ur.Fv(qe,Ur.$X(qe,F,U))),ru(mu,qe,F);var ct=Pp(Kl,Ur.Ue(),Ws,mu,this.thickness),_t=(0,pr.Z)(ct,2),Ot=_t[0],Xt=_t[1],yr=Ur.AK(Kl,this.normal)<0?-1:1,Pr=O;if(!Pr&&this.join==="miter"){var xr=Ot;xr>this.miterLimit&&(Pr=!0)}Pr?(E.push(this.normal[0],this.normal[1],0),E.push(Xt[0],Xt[1],0),g.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*yr,o[2]|0),this.complex.indexes.push(this.currentIndex),g.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*yr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,v.push.apply(v,(0,Ee.Z)(this.lastFlip!==-yr?[i,i+2,i+3]:[i+2,i+1,i+3])),v.push(i+2,i+3,i+4),Of(Rf,mu),Ur.JG(this.normal,Rf),E.push(this.normal[0],this.normal[1],0),g.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*yr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p+=3):(this.extrusions(g,E,o,Xt,Ot,this.totalDistance),v.push.apply(v,(0,Ee.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),yr=-1,Ur.JG(this.normal,Xt),p+=2),this.lastFlip=yr}else{if(Of(this.normal,Ws),T){var ve=Ur.Ue(),ke=Ur.Ue();Ur.lu(ke,Ws,this.normal),Ur.IH(ve,Ws,this.normal),E.push(ke[0],ke[1],0),E.push(ve[0],ve[1],0),g.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),g.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(g,E,o,this.normal,this.thickness,this.totalDistance);v.push.apply(v,(0,Ee.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),p+=2}return p}},{key:"extrusions",value:function(t,i,r,o,u,p){i.push(o[0],o[1],0),i.push(o[0],o[1],0),t.push(r[0],r[1],r[2]|0,p,-u,r[2]|0),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],r[2]|0,p,u,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,i){var r=i[0]-t[0],o=i[1]-t[1];return Math.sqrt(r*r+o*o)}}]),e}();function Lp(e){var a=e.coordinates,t=e.originCoordinates,i=e.version,r=new Dd({dash:!0,join:"bevel"});if(i==="GAODE2.x"){var o=a;Array.isArray(o[0][0])||(o=[a]);var u=t;Array.isArray(u[0][0])||(u=[t]);for(var p=0;p<o.length;p++){var v=o[p],g=u[p];r.extrude_gaode2(v,g)}}else{var E=a;E[0]&&!Array.isArray(E[0][0])&&(E=[a]),E.forEach(function(O){r.extrude(O)})}var T=r.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,indexes:T.indexes,size:6}}function nh(e){var a=hu(e.coordinates);return{vertices:[].concat((0,Ee.Z)(a),(0,Ee.Z)(a),(0,Ee.Z)(a),(0,Ee.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function nf(e){var a=e.coordinates,t=vu().flatten(a),i=t.vertices,r=t.dimensions,o=t.holes;return{indices:vu()(i,o,r),vertices:i,size:r}}var _h=function(){var e=(0,Sa.Z)(zn().mark(function a(t){var i,r,o,u,p,v,g,E,T;return zn().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return i=t.descriptors,r=t.features,o=t.enablePicking,u=t.iconMap,p={a_Color:ys,a_Position:Lf,filter:Rl,a_vertexId:yh,a_PickingColor:function(j,K){var ae=j.id;return o?P(ae):[0,0,0]},a_DistanceAndIndex:function(j,K,ae,ve,ke,qe){return qe===void 0?[ae[3],10]:[ae[3],qe]},a_Total_Distance:function(j,K,ae,ve){return[ae[5]]},a_Size:function(j,K,ae,ve){var ke=j.size,qe=ke===void 0?1:ke;return Array.isArray(qe)?[qe[0],qe[1]]:[qe,0]},a_Normal:function(j,K,ae,ve,ke){return ke},a_Miter:function(j,K,ae,ve){return[ae[4]]},a_iconMapUV:function(j,K,ae,ve){var ke=j.texture,qe=u[ke]||{x:0,y:0},ct=qe.x,_t=qe.y;return[ct,_t]}},v={sizePerElement:0,elements:[]},g=0,E=[],T=3,r.forEach(function(U,j){var K=Lp(U),ae=K.indices,ve=K.vertices,ke=K.normals,qe=K.size,ct=K.indexes;ae.forEach(function(yr){E.push(yr+g)}),T=qe;var _t=ve.length/qe;v.sizePerElement=T,v.elements.push({featureIdx:j,vertices:ve,normals:ke,offset:g}),g+=_t;for(var Ot=function(Pr){var xr=(ke==null?void 0:ke.slice(Pr*3,Pr*3+3))||[],An=ve.slice(Pr*qe,Pr*qe+qe),ii=0;ct&&ct[Pr]!==void 0&&(ii=ct[Pr]),i.forEach(function(sa,Io){if(sa&&p[sa.name]){var _o;(_o=sa.buffer.data).push.apply(_o,(0,Ee.Z)(p[sa.name](U,j,An,Pr,xr,ii)))}})},Xt=0;Xt<_t;Xt++)Ot(Xt)}),F.abrupt("return",{descriptors:i,featureLayout:v,indices:E});case 8:case"end":return F.stop()}},a)}));return function(t){return e.apply(this,arguments)}}(),Ff=function(){var e=(0,Sa.Z)(zn().mark(function a(t){var i,r,o,u,p,v,g,E,T;return zn().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return i=t.descriptors,r=t.features,o=t.enablePicking,u=t.shape2d,p={a_Color:ys,a_Position:Lf,filter:Rl,a_vertexId:yh,a_PickingColor:function(j,K){var ae=j.id;return o?P(ae):[0,0,0]},a_Shape:function(j,K,ae,ve){var ke=j.shape,qe=ke===void 0?2:ke,ct=u.indexOf(qe);return[ct]},a_Extrude:function(j,K,ae,ve){var ke=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],qe=ve%4*3;return[ke[qe],ke[qe+1],ke[qe+2]]},a_Size:function(j,K,ae,ve){var ke=j.size,qe=ke===void 0?5:ke;return Array.isArray(qe)?[qe[0]]:[qe]}},v={sizePerElement:0,elements:[]},g=0,E=[],T=3,r.forEach(function(U,j){var K=nh(U),ae=K.indices,ve=K.vertices,ke=K.normals,qe=K.size,ct=K.indexes;ae.forEach(function(yr){E.push(yr+g)}),T=qe;var _t=ve.length/qe;v.sizePerElement=T,v.elements.push({featureIdx:j,vertices:ve,normals:ke,offset:g}),g+=_t;for(var Ot=function(Pr){var xr=(ke==null?void 0:ke.slice(Pr*3,Pr*3+3))||[],An=ve.slice(Pr*qe,Pr*qe+qe),ii=0;ct&&ct[Pr]!==void 0&&(ii=ct[Pr]),i.forEach(function(sa,Io){if(sa&&p[sa.name]){var _o;(_o=sa.buffer.data).push.apply(_o,(0,Ee.Z)(p[sa.name](U,j,An,Pr,xr,ii)))}})},Xt=0;Xt<_t;Xt++)Ot(Xt)}),F.abrupt("return",{descriptors:i,featureLayout:v,indices:E});case 8:case"end":return F.stop()}},a)}));return function(t){return e.apply(this,arguments)}}(),cs=function(){var e=(0,Sa.Z)(zn().mark(function a(t){var i,r,o,u,p,v,g,E;return zn().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return i=t.descriptors,r=t.features,o=t.enablePicking,u={a_Color:ys,a_Position:Lf,filter:Rl,a_vertexId:yh,a_PickingColor:function(U,j){var K=U.id;return o?P(K):[0,0,0]}},p={sizePerElement:0,elements:[]},v=0,g=[],E=3,r.forEach(function(F,U){var j=nf(F),K=j.indices,ae=j.vertices,ve=j.normals,ke=j.size,qe=j.indexes;K.forEach(function(Xt){g.push(Xt+v)}),E=ke;var ct=ae.length/ke;p.sizePerElement=E,p.elements.push({featureIdx:U,vertices:ae,normals:ve,offset:v}),v+=ct;for(var _t=function(yr){var Pr=(ve==null?void 0:ve.slice(yr*3,yr*3+3))||[],xr=ae.slice(yr*ke,yr*ke+ke),An=0;qe&&qe[yr]!==void 0&&(An=qe[yr]),i.forEach(function(ii,sa){if(ii&&u[ii.name]){var Io;(Io=ii.buffer.data).push.apply(Io,(0,Ee.Z)(u[ii.name](F,U,xr,yr,Pr,An)))}})},Ot=0;Ot<ct;Ot++)_t(Ot)}),O.abrupt("return",{descriptors:i,featureLayout:p,indices:g});case 8:case"end":return O.stop()}},a)}));return function(t){return e.apply(this,arguments)}}(),Qh={pointFill:Ff,line:_h,polygonFill:cs},fd=(0,Z.Z)({},Qh);function Ui(e){return Jh.apply(this,arguments)}function Jh(){return Jh=(0,Sa.Z)(zn().mark(function e(a){var t,i;return zn().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(t=a.workerType,i=a.data,!fd[t]){o.next=3;break}return o.abrupt("return",fd[t](i));case 3:return o.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(t,'" non-existent.'))));case 4:case"end":return o.stop()}},e)})),Jh.apply(this,arguments)}Pa(Ui);var ep=new Map;function af(e,a){ep.set(e,a)}function Rp(e){var a=ep.get(e);return a}var Su="l7-worker",tp=3,of=!0;function hd(e){af(Su,e)}function ih(){var e=Rp(Su);if(!e)throw new Error("get worker failed by workerName: ".concat(Su,"."));return e}function yc(e,a){return xh.apply(this,arguments)}function xh(){return xh=(0,Sa.Z)(zn().mark(function e(a,t){var i,r,o,u,p;return zn().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return i=ih(),r=Ds.getWorkerFarm({maxConcurrency:tp,reuseWorkers:of}),o=r.getWorkerPool({name:Su,source:i}),g.next=5,o.startJob(Su,function(E,T,O){return E.done(O)});case 5:return u=g.sent,u.postMessage("process",{input:{workerType:a,data:t}}),g.next=9,u.result;case 9:return p=g.sent,g.abrupt("return",p.result);case 11:case"end":return g.stop()}},e)})),xh.apply(this,arguments)}hd($l());var sf={BACK:1029,FRONT:1028};function uf(e){switch(e){case"GAODE1.x":return sf.BACK;case"GAODE2.x":return sf.BACK;case"MAPBOX":return sf.FRONT;case"SIMPLE":return sf.FRONT;case"GLOBEL":return sf.BACK;case"L7MAP":return sf.FRONT;default:return sf.FRONT}}function Op(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function Du(e,a){if(!e||!e.length)throw new Error("url is not allowed to be empty");var t=a.x,i=a.y,r=a.z;if(Array.isArray(e)){var o=Math.abs(t+i)%e.length;e=e[o]}return e.replace(/\{x\}/g,t.toString()).replace(/\{y\}/g,i.toString()).replace(/\{z\}/g,r.toString()).replace(/\{-y\}/g,(Math.pow(2,r)-i-1).toString())}var Fc;(function(e){e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace"})(Fc||(Fc={}));var Bu;(function(e){e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled"})(Bu||(Bu={}));function Fp(e,a){a===void 0&&(a={});var t=Number(e[0]),i=Number(e[1]),r=Number(e[2]),o=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var u=[t,i],p=[t,o],v=[r,o],g=[r,i];return ai([[u,g,v,p,u]],a.properties,{bbox:e,id:a.id})}var Df=0,Dp=1,Ql=2;function bh(e){e.forEach(function(a){a.isCurrent&&(a.isVisible=a.isLoaded)})}function Bd(e){e.forEach(function(a){a.properties.state=Df}),e.forEach(function(a){a.isCurrent&&!pd(a)&&Jl(a)}),e.forEach(function(a){a.isVisible=Boolean(a.properties.state&Ql)})}function Bf(e){e.forEach(function(t){t.properties.state=Df}),e.forEach(function(t){t.isCurrent&&pd(t)});var a=e.slice().sort(function(t,i){return t.z-i.z});a.forEach(function(t){t.isVisible=Boolean(t.properties.state&Ql),t.children.length&&(t.isVisible||t.properties.state&Dp)?t.children.forEach(function(i){i.properties.state=Dp}):t.isCurrent&&Jl(t)})}function pd(e){for(;e;){if(e.isLoaded)return e.properties.state|=Ql,!0;e=e.parent}return!1}function Jl(e){e.children.forEach(function(a){a.isLoaded?a.properties.state|=Ql:Jl(a)})}var cl,Nu=256,Dc=[-1/0,-1/0,1/0,1/0],lf=.2,Eh=5,Bc=(cl={},(0,ee.Z)(cl,Fc.Realtime,bh),(0,ee.Z)(cl,Fc.Overlap,Bd),(0,ee.Z)(cl,Fc.Replace,Bf),cl),Bp=function(){};function Nd(e,a,t){var i=Math.floor((e+180)/360*Math.pow(2,t)),r=Math.floor((1-Math.log(Math.tan(a*Math.PI/180)+1/Math.cos(a*Math.PI/180))/Math.PI)/2*Math.pow(2,t));return[i,r]}function Nc(e,a,t){var i=e/Math.pow(2,t)*360-180,r=Math.PI-2*Math.PI*a/Math.pow(2,t),o=180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)));return[i,o]}var Ch=function(a,t,i){var r=Nc(a,t,i),o=(0,pr.Z)(r,2),u=o[0],p=o[1],v=Nc(a+1,t+1,i),g=(0,pr.Z)(v,2),E=g[0],T=g[1];return[u,T,E,p]};function ah(e){var a=e.zoom,t=e.latLonBounds,i=e.maxZoom,r=i===void 0?1/0:i,o=e.minZoom,u=o===void 0?0:o,p=e.zoomOffset,v=p===void 0?0:p,g=e.extent,E=g===void 0?Dc:g,T=Math.ceil(a)+v;if(Number.isFinite(u)&&T<u)return[];Number.isFinite(r)&&T>r&&(T=r);for(var O=(0,pr.Z)(t,4),F=O[0],U=O[1],j=O[2],K=O[3],ae=[Math.max(F,E[0]),Math.max(U,E[1]),Math.min(j,E[2]),Math.min(K,E[3])],ve=[],ke=Nd(ae[0],ae[1],T),qe=(0,pr.Z)(ke,2),ct=qe[0],_t=qe[1],Ot=Nd(ae[2],ae[3],T),Xt=(0,pr.Z)(Ot,2),yr=Xt[0],Pr=Xt[1],xr=ct;xr<=yr;xr++)for(var An=Pr;An<=_t;An++)ve.push({x:xr,y:An,z:T});var ii=(yr+ct)/2,sa=(_t+Pr)/2,Io=function(Gu,ml){return Math.abs(Gu-ii)+Math.abs(ml-sa)};return ve.sort(function(_o,Gu){return Io(_o.x,_o.y)-Io(Gu.x,Gu.y)}),ve}var Nf=function(a,t,i){var r=Math.pow(2,i),o=r-1,u=r,p=a,v=t;return p<0?p=p+u:p>o&&(p=p%u),{warpX:p,warpY:v}},zd=function(){function e(a){(0,xt.Z)(this,e),(0,ee.Z)(this,"tileSize",256),(0,ee.Z)(this,"isVisible",!1),(0,ee.Z)(this,"isCurrent",!1),(0,ee.Z)(this,"isVisibleChange",!1),(0,ee.Z)(this,"parentLayerIDList",[]),(0,ee.Z)(this,"layerIDList",[]),(0,ee.Z)(this,"parent",null),(0,ee.Z)(this,"children",[]),(0,ee.Z)(this,"data",null),(0,ee.Z)(this,"properties",{}),(0,ee.Z)(this,"loadDataId",0);var t=a.x,i=a.y,r=a.z,o=a.tileSize;this.x=t,this.y=i,this.z=r,this.tileSize=o}return(0,St.Z)(e,[{key:"isLoading",get:function(){return this.loadStatus===Bu.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Bu.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Bu.Failure}},{key:"isCancelled",get:function(){return this.loadStatus===Bu.Cancelled}},{key:"isDone",get:function(){return[Bu.Loaded,Bu.Cancelled,Bu.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return Ch(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var t=(0,pr.Z)(this.bounds,4),i=t[0],r=t[1],o=t[2],u=t[3],p=[(o-i)/2,(u-r)/2],v=Fp(this.bounds,{properties:{key:this.key,bbox:this.bounds,center:p,meta:`
      `.concat(this.key,`
      `)}});return v}},{key:"key",get:function(){var t="".concat(this.x,",").concat(this.y,",").concat(this.z);return t}},{key:"loadData",value:function(){var a=(0,Sa.Z)(zn().mark(function i(r){var o,u,p,v,g,E,T,O,F,U,j,K,ae,ve,ke,qe;return zn().wrap(function(_t){for(;;)switch(_t.prev=_t.next){case 0:return o=r.getData,u=r.onLoad,p=r.onError,this.loadDataId++,v=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Bu.Loading,g=null,_t.prev=7,T=this.x,O=this.y,F=this.z,U=this.bounds,j=this.tileSize,K=Nf(T,O,F),ae=K.warpX,ve=K.warpY,ke=this.abortController.signal,qe={x:ae,y:ve,z:F,bounds:U,tileSize:j,signal:ke},_t.next=14,o(qe,this);case 14:g=_t.sent,_t.next=20;break;case 17:_t.prev=17,_t.t0=_t.catch(7),E=_t.t0;case 20:if(v===this.loadDataId){_t.next=22;break}return _t.abrupt("return");case 22:if(!(this.isCancelled&&!g)){_t.next=24;break}return _t.abrupt("return");case 24:if(!(E||!g)){_t.next=28;break}return this.loadStatus=Bu.Failure,p(E,this),_t.abrupt("return");case 28:this.loadStatus=Bu.Loaded,this.data=g,u(this);case 31:case"end":return _t.stop()}},i,this,[[7,17]])}));function t(i){return a.apply(this,arguments)}return t}()},{key:"reloadData",value:function(t){this.isLoading&&this.abortLoad(),this.loadData(t)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Bu.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),e}(),fl=vt(26729),Sh=vt.n(fl),Ud=function(a,t){var i=Wl(a),r=hc(i,t),o=360*3-180,u=85.0511287798065,p=[Math.max(r[0][0],-o),Math.max(r[0][1],-u),Math.min(r[1][0],o),Math.min(r[1][1],u)];return p},$a=function(a,t){var i=Wl(a),r=Wl(t),o=pc(i,r);return o};function wu(e,a){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Fo(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function Fo(e,a){if(!!e){if(typeof e=="string")return Ms(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ms(e,a)}}function Ms(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function Zd(e){var a=dd();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function dd(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var a0=function(e){(0,mr.Z)(t,e);var a=Zd(t);function t(i){var r;return(0,xt.Z)(this,t),r=a.call(this),(0,ee.Z)((0,dt.Z)(r),"currentTiles",[]),(0,ee.Z)((0,dt.Z)(r),"cacheTiles",new Map),(0,ee.Z)((0,dt.Z)(r),"onTileLoad",function(o){r.emit("tile-loaded",o),r.updateTileVisible()}),(0,ee.Z)((0,dt.Z)(r),"onTileError",function(o,u){r.emit("tile-error",{error:o,tile:u}),r.updateTileVisible()}),(0,ee.Z)((0,dt.Z)(r),"onTileUnload",function(o){r.emit("tile-unload",o)}),r.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:Dc,getTileData:Bp,updateStrategy:Fc.Replace},r.updateOptions(i),r}return(0,St.Z)(t,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(r){return r.isDone})}},{key:"tiles",get:function(){var r=Array.from(this.cacheTiles.values()).sort(function(o,u){return o.z-u.z});return r}},{key:"updateOptions",value:function(r){var o=r.minZoom===void 0?this.options.minZoom:Math.ceil(r.minZoom),u=r.maxZoom===void 0?this.options.maxZoom:Math.floor(r.maxZoom);this.options=(0,Z.Z)((0,Z.Z)((0,Z.Z)({},this.options),r),{},{minZoom:o,maxZoom:u})}},{key:"update",value:function(r,o){var u=this,p=Math.ceil(r);if(!(this.lastViewStates&&this.lastViewStates.zoom===p&&$a(this.lastViewStates.latLonBoundsBuffer,o))){var v=Ud(o,lf);this.lastViewStates={zoom:p,latLonBounds:o,latLonBoundsBuffer:v};var g=!1,E=this.getTileIndices(p,v);this.currentTiles=E.map(function(T){var O=T.x,F=T.y,U=T.z,j=u.getTile(O,F,U);if(j){var K,ae,ve=((K=j)===null||K===void 0?void 0:K.isFailure)||((ae=j)===null||ae===void 0?void 0:ae.isCancelled);return ve&&j.loadData({getData:u.options.getTileData,onLoad:u.onTileLoad,onError:u.onTileError}),j}return j=u.createTile(O,F,U),g=!0,j}),g&&(this.resizeCacheTiles(),this.rebuildTileTree()),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var r=wu(this.cacheTiles),o;try{for(r.s();!(o=r.n()).done;){var u=(0,pr.Z)(o.value,2),p=u[0],v=u[1];this.currentTiles.includes(v)||(this.cacheTiles.delete(p),this.onTileUnload(v)),this.onTileUnload(v),v.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(g){r.e(g)}finally{r.f()}}},{key:"pruneRequests",value:function(){var r=[],o=wu(this.cacheTiles.values()),u;try{for(o.s();!(u=o.n()).done;){var p=u.value;p.isLoading&&!p.isCurrent&&!p.isVisible&&r.push(p)}}catch(g){o.e(g)}finally{o.f()}for(;r.length>0;){var v=r.shift();v.abortLoad()}}},{key:"destroy",value:function(){var r=wu(this.cacheTiles.values()),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u.isLoading&&u.abortLoad()}}catch(p){r.e(p)}finally{r.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var r=this.options.updateStrategy,o=new Map,u=wu(this.cacheTiles.values()),p;try{for(u.s();!(p=u.n()).done;){var v=p.value;o.set(v.key,v.isVisible),v.isCurrent=!1,v.isVisible=!1}}catch(U){u.e(U)}finally{u.f()}var g=wu(this.currentTiles),E;try{for(g.s();!(E=g.n()).done;){var T=E.value;T.isCurrent=!0,T.isVisible=!0}}catch(U){g.e(U)}finally{g.f()}var O=Array.from(this.cacheTiles.values());typeof r=="function"?r(O):Bc[r](O);var F=!1;Array.from(this.cacheTiles.values()).forEach(function(U){U.isVisible!==o.get(U.key)?(U.isVisibleChange=!0,F=!0):U.isVisibleChange=!1}),F&&this.emit("tile-update")}},{key:"getTileIndices",value:function(r,o){var u=this.options,p=u.tileSize,v=u.extent,g=u.zoomOffset,E=Math.floor(this.options.maxZoom),T=Math.ceil(this.options.minZoom),O=ah({maxZoom:E,minZoom:T,zoomOffset:g,tileSize:p,zoom:r,latLonBounds:o,extent:v});return O}},{key:"getTileId",value:function(r,o,u){var p="".concat(r,",").concat(o,",").concat(u);return p}},{key:"getTile",value:function(r,o,u){var p=this.getTileId(r,o,u),v=this.cacheTiles.get(p);return v}},{key:"createTile",value:function(r,o,u){var p=this.getTileId(r,o,u),v=new zd({x:r,y:o,z:u,tileSize:this.options.tileSize});return this.cacheTiles.set(p,v),v.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),v}},{key:"resizeCacheTiles",value:function(){var r=Eh*this.currentTiles.length,o=this.cacheTiles.size>r;if(o){var u=wu(this.cacheTiles),p;try{for(u.s();!(p=u.n()).done;){var v=(0,pr.Z)(p.value,2),g=v[0],E=v[1];if(!E.isVisible&&!this.currentTiles.includes(E)&&(this.cacheTiles.delete(g),this.onTileUnload(E)),this.cacheTiles.size<=r)break}}catch(T){u.e(T)}finally{u.f()}}}},{key:"rebuildTileTree",value:function(){var r=wu(this.cacheTiles.values()),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u.parent=null,u.children.length=0}}catch(T){r.e(T)}finally{r.f()}var p=wu(this.cacheTiles.values()),v;try{for(p.s();!(v=p.n()).done;){var g=v.value,E=this.getNearestAncestor(g.x,g.y,g.z);g.parent=E,E!=null&&E.children&&E.children.push(g)}}catch(T){p.e(T)}finally{p.f()}}},{key:"getNearestAncestor",value:function(r,o,u){for(;u>this.options.minZoom;){r=Math.floor(r/2),o=Math.floor(o/2),u=u-1;var p=this.getTile(r,o,u);if(p)return p}return null}}]),t}(Sh()),Vd;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(Vd||(Vd={}));function jd(e,a,t,i,r){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,p=t;return u&&(p=Math.round(t*(o-1))/(o-1)),i?rp(e,a,p,i,r):rp(e,a,p,.314,r)}function wh(e,a){var t=1-a;return(e[0]*t+e[1]*a)*t+(e[1]*t+e[2]*a)*a}function o0(e,a){return Math.sqrt(Math.pow(e[0]-a[0],2)+Math.pow(e[1]-a[1],2))}function s0(e,a,t){var i=[a[0]-e[0],a[1]-e[1]],r=o0(i,[0,0]),o=Math.atan2(i[1],i[0]),u=r/2/Math.cos(t),p=o+t,v=[u*Math.cos(p)+e[0],u*Math.sin(p)+e[1]];return v}function rp(e,a,t,i,r){if(r===Version["GAODE2.x"]){var o=amap2Project(e[0],e[1]),u=amap2Project(a[0],a[1]),p=s0(o,u,i),v=[o[0],p[0],u[0]],g=[o[1],p[1],u[1]];return[].concat(_toConsumableArray(amap2UnProject(wh(v,t),wh(g,t))),[0])}else{var E=s0(e,a,i),T=[e[0],E[0],a[0]],O=[e[1],E[1],a[1]];return[wh(T,t),wh(O,t),0]}}function F0(e,a,t,i,r){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,p=t;return u&&(p=Math.round(t*29)/29),vd(e,a,p,r)}function u0(e,a){var t=[a[0]-e[0],a[1]-e[1]],i=calDistance(t,[0,0]),r=Math.atan2(t[1],t[0]),o=.314,u=i/2/Math.cos(o),p=r+o,v=[u*Math.cos(p)+e[0],u*Math.sin(p)+e[1]];return v}function zf(e,a){var t=1-a;return(e[0]*t+e[1]*a)*t+(e[1]*t+e[2]*a)*a}function Eo(e,a){var t=[e[0]-a[0],e[1]-a[1]],i=[Math.sin(t[0]/2),Math.sin(t[1]/2)],r=i[1]*i[1]+Math.cos(e[1])*Math.cos(a[1])*i[0]*i[0];return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))}function vd(e,a,t,i){var r=[degreesToRadians(e[0]),degreesToRadians(e[1])],o=[degreesToRadians(a[0]),degreesToRadians(a[1])];if(i==="GAODE2.x"){var u=u0(r,o),p=[r[0],u[0],o[0]],v=[r[1],u[1],o[1]];return[zf(p,t),zf(v,t),0]}else{var g=Eo(r,o);if(Math.abs(g-Math.PI)<.001)return[(1-t)*r[0]+t*o[0],(1-t)*r[1]+t*o[1]];var E=Math.sin((1-t)*g)/Math.sin(g),T=Math.sin(t*g)/Math.sin(g),O=[Math.sin(r[0]),Math.sin(r[1])],F=[Math.cos(r[0]),Math.cos(r[1])],U=[Math.sin(o[0]),Math.sin(o[1])],j=[Math.cos(o[0]),Math.cos(o[1])],K=E*F[1]*F[0]+T*j[1]*j[0],ae=E*F[1]*O[0]+T*j[1]*U[0],ve=E*O[1]+T*U[1];return[radiansToDegrees(Math.atan2(ae,K)),radiansToDegrees(Math.atan2(ve,Math.sqrt(K*K+ae*ae)))]}}function cf(e,a){for(var t=0,i=[],r=0;r<e.length-1;r++){var o=e[r],u=e[r+1],p=Gd(o,u),v=t;t+=p,i.push({p1:o,p2:u,totalDistance:t,distance:p,lastTotalDistance:v})}for(var g=t*a,E,T,O=0;O<i.length;O++){var F=i[O].totalDistance;if(F>g){var U=i[O].p1,j=i[O].p2,K=(g-i[O].lastTotalDistance)/i[O].distance,ae=Ah(j,U,K);E=ae[0],T=ae[1];break}}return{_lng:E,_lat:T,_height:0}}function Ah(e,a,t){return[e[0]*t+a[0]*(1-t),e[1]*t+a[1]*(1-t)]}function Gd(e,a){return Math.sqrt(Math.pow(e[0]-a[0],2)+Math.pow(e[1]-a[1],2))}function Np(e,a){var t=a.featureId,i=e.data.dataArray;return typeof t=="number"&&(i=i.filter(function(r){var o=r._id;return o===t})),i.map(function(r){var o=Se(r,a);return _objectSpread(_objectSpread({},r),o)})}function H(e,a){return new Promise(function(t,i){e.inited?t(Np(e,a)):e.once("sourceUpdate",function(){t(Np(e,a))})})}function Se(e,a){var t=a.offset,i=a.shape,r=a.thetaOffset,o=a.mapVersion,u=a.segmentNumber,p=u===void 0?30:u,v=a.autoFit,g=v===void 0?!0:v,E=e.coordinates;if(i==="line")return pathLineAtOffset(E,t);var T=E[0],O=E[1],F;typeof r=="string"?F=e[r]||0:F=r;var U;switch(i){case"arc":U=arcLineAtOffset;break;case"greatcircle":U=greatCircleLineAtOffset;break;default:U=arcLineAtOffset}var j=U(T,O,t,F,o,p,g),K=_slicedToArray(j,3),ae=K[0],ve=K[1],ke=K[2];return{_lng:ae,_lat:ve,_height:ke}}function He(e,a){var t=a.extent,i=t===void 0?[121.168,30.2828,121.384,30.4219]:t,r=new Promise(function(u){e instanceof HTMLImageElement||Mp(e)?u([e]):Ht(e,function(p){u(p)})}),o={originData:e,images:r,_id:1,dataArray:[{_id:0,coordinates:[[i[0],i[1]],[i[2],i[3]]]}]};return o}function Ht(e,a){var t=e,i=[];if(typeof t=="string")ti({url:t},function(u,p){p&&(i.push(p),a(i))});else{var r=t.length,o=0;t.forEach(function(u){ti({url:u},function(p,v){o++,v&&i.push(v),o===r&&a(i)})})}return He}var Er=vt(38929),Vt=vt(3614),sr=vt.n(Vt),kr={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},Dr=512;function jr(e,a,t){var i=e/Math.pow(2,t)*360-180,r=Math.PI-2*Math.PI*a/Math.pow(2,t),o=180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)));return[i,o]}function qr(e){for(var a=0,t=0,i=e.length,r=i-1,o,u;t<i;r=t++)o=e[t],u=e[r],a+=(u.x-o.x)*(o.y+u.y);return a}function $r(e){var a=e.length;if(a<=1)return[e];for(var t=[],i,r,o=0;o<a;o++){var u=qr(e[o]);u!==0&&(r===void 0&&(r=u<0),r===u<0?(i&&t.push(i),i=[e[o]]):i.push(e[o]))}return i&&t.push(i),t}var gn=["Unknown","Point","LineString","Polygon"];function Zr(e,a){var t=a.extent,i=a.loadGeometry(),r=a.type,o=a.properties,u=a.id,p=t*Math.pow(2,e),v=gn[r],g,E;function T(U){for(var j=0;j<U.length;j++){var K=U[j];U[j]=[K.x/p*Dr,K.y/p*Dr]}}switch(r){case 1:var O=[];for(g=0;g<i.length;g++)O[g]=i[g][0];i=O,T(i);break;case 2:for(g=0;g<i.length;g++)T(i[g]);break;case 3:for(i=$r(i),g=0;g<i.length;g++)for(E=0;E<i[g].length;E++)T(i[g][E]);break}i.length===1?i=i[0]:v="Multi"+v;var F={type:"Feature",geometry:{type:v,coordinates:i},properties:o,id:u,tileOrigin:[0,0],coord:""};return F}var Xr=function(){var e=(0,Sa.Z)(zn().mark(function a(t,i,r,o){var u;return zn().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return u=Du(t,i),v.abrupt("return",new Promise(function(g){var E=cc({url:u},function(T,O){if(T||!O)g({layers:{}});else{for(var F=new Er.VectorTile(new(sr())(O)),U=jr(i.x,i.y,i.z),j=i.z,K=0,ae=Object.keys(F.layers);K<ae.length;K++){for(var ve=ae[K],ke=[],qe=F.layers[ve],ct=0;ct<F.layers[ve].length;ct++){var _t=F.layers[ve].feature(ct),Ot=void 0;o==="lnglat"?Ot=_t.toGeoJSON(i.x,i.y,i.z):(Ot=Zr(j,_t),qe.l7TileOrigin=U,qe.l7TileCoord=o),ke.push(Ot)}qe.features=ke}g(F)}});r.xhrCancel=function(){return E.abort()}}));case 2:case"end":return v.stop()}},a)}));return function(t,i,r,o){return e.apply(this,arguments)}}();function Ct(e,a){var t=(a==null?void 0:a.coord)||"lnglat",i=function(u,p){return Xr(e,u,p,t)},r=(0,Z.Z)((0,Z.Z)((0,Z.Z)({},kr),a),{},{getTileData:i});return{data:e,dataArray:[],tilesetOptions:r,isTile:!0}}function er(e,a,t,i){for(var r=i,o=t-a>>1,u=t-a,p,v=e[a],g=e[a+1],E=e[t],T=e[t+1],O=a+3;O<t;O+=3){var F=Gr(e[O],e[O+1],v,g,E,T);if(F>r)p=O,r=F;else if(F===r){var U=Math.abs(O-o);U<u&&(p=O,u=U)}}r>i&&(p-a>3&&er(e,a,p,i),e[p+2]=r,t-p>3&&er(e,p,t,i))}function Gr(e,a,t,i,r,o){var u=r-t,p=o-i;if(u!==0||p!==0){var v=((e-t)*u+(a-i)*p)/(u*u+p*p);v>1?(t=r,i=o):v>0&&(t+=u*v,i+=p*v)}return u=e-t,p=a-i,u*u+p*p}function fn(e,a,t,i){var r={id:typeof e>"u"?null:e,type:a,geometry:t,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return wr(r),r}function wr(e){var a=e.geometry,t=e.type;if(t==="Point"||t==="MultiPoint"||t==="LineString")Kr(e,a);else if(t==="Polygon"||t==="MultiLineString")for(var i=0;i<a.length;i++)Kr(e,a[i]);else if(t==="MultiPolygon")for(i=0;i<a.length;i++)for(var r=0;r<a[i].length;r++)Kr(e,a[i][r])}function Kr(e,a){for(var t=0;t<a.length;t+=3)e.minX=Math.min(e.minX,a[t]),e.minY=Math.min(e.minY,a[t+1]),e.maxX=Math.max(e.maxX,a[t]),e.maxY=Math.max(e.maxY,a[t+1])}function Mn(e,a){var t=[];if(e.type==="FeatureCollection")for(var i=0;i<e.features.length;i++)pi(t,e.features[i],a,i);else e.type==="Feature"?pi(t,e,a):pi(t,{geometry:e},a);return t}function pi(e,a,t,i){if(!!a.geometry){var r=a.geometry.coordinates,o=a.geometry.type,u=Math.pow(t.tolerance/((1<<t.maxZoom)*t.extent),2),p=[],v=a.id;if(t.promoteId?v=a.properties[t.promoteId]:t.generateId&&(v=i||0),o==="Point")or(r,p);else if(o==="MultiPoint")for(var g=0;g<r.length;g++)or(r[g],p);else if(o==="LineString")dr(r,p,u,!1);else if(o==="MultiLineString")if(t.lineMetrics){for(g=0;g<r.length;g++)p=[],dr(r[g],p,u,!1),e.push(fn(v,"LineString",p,a.properties));return}else qn(r,p,u,!1);else if(o==="Polygon")qn(r,p,u,!0);else if(o==="MultiPolygon")for(g=0;g<r.length;g++){var E=[];qn(r[g],E,u,!0),p.push(E)}else if(o==="GeometryCollection"){for(g=0;g<a.geometry.geometries.length;g++)pi(e,{id:v,geometry:a.geometry.geometries[g],properties:a.properties},t,i);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(fn(v,o,p,a.properties))}}function or(e,a){a.push(xn(e[0])),a.push(Hr(e[1])),a.push(0)}function dr(e,a,t,i){for(var r,o,u=0,p=0;p<e.length;p++){var v=xn(e[p][0]),g=Hr(e[p][1]);a.push(v),a.push(g),a.push(0),p>0&&(i?u+=(r*g-v*o)/2:u+=Math.sqrt(Math.pow(v-r,2)+Math.pow(g-o,2))),r=v,o=g}var E=a.length-3;a[2]=1,er(a,0,E,t),a[E+2]=1,a.size=Math.abs(u),a.start=0,a.end=a.size}function qn(e,a,t,i){for(var r=0;r<e.length;r++){var o=[];dr(e[r],o,t,i),a.push(o)}}function xn(e){return e/360+.5}function Hr(e){var a=Math.sin(e*Math.PI/180),t=.5-.25*Math.log((1+a)/(1-a))/Math.PI;return t<0?0:t>1?1:t}function pn(e,a,t,i,r,o,u,p){if(t/=a,i/=a,o>=t&&u<i)return e;if(u<t||o>=i)return null;for(var v=[],g=0;g<e.length;g++){var E=e[g],T=E.geometry,O=E.type,F=r===0?E.minX:E.minY,U=r===0?E.maxX:E.maxY;if(F>=t&&U<i){v.push(E);continue}else if(U<t||F>=i)continue;var j=[];if(O==="Point"||O==="MultiPoint")kn(T,j,t,i,r);else if(O==="LineString")Qi(T,j,t,i,r,!1,p.lineMetrics);else if(O==="MultiLineString")yn(T,j,t,i,r,!1);else if(O==="Polygon")yn(T,j,t,i,r,!0);else if(O==="MultiPolygon")for(var K=0;K<T.length;K++){var ae=[];yn(T[K],ae,t,i,r,!0),ae.length&&j.push(ae)}if(j.length){if(p.lineMetrics&&O==="LineString"){for(K=0;K<j.length;K++)v.push(fn(E.id,O,j[K],E.tags));continue}(O==="LineString"||O==="MultiLineString")&&(j.length===1?(O="LineString",j=j[0]):O="MultiLineString"),(O==="Point"||O==="MultiPoint")&&(O=j.length===3?"Point":"MultiPoint"),v.push(fn(E.id,O,j,E.tags))}}return v.length?v:null}function kn(e,a,t,i,r){for(var o=0;o<e.length;o+=3){var u=e[o+r];u>=t&&u<=i&&(a.push(e[o]),a.push(e[o+1]),a.push(e[o+2]))}}function Qi(e,a,t,i,r,o,u){for(var p=Ri(e),v=r===0?Ai:Xi,g=e.start,E,T,O=0;O<e.length-3;O+=3){var F=e[O],U=e[O+1],j=e[O+2],K=e[O+3],ae=e[O+4],ve=r===0?F:U,ke=r===0?K:ae,qe=!1;u&&(E=Math.sqrt(Math.pow(F-K,2)+Math.pow(U-ae,2))),ve<t?ke>t&&(T=v(p,F,U,K,ae,t),u&&(p.start=g+E*T)):ve>i?ke<i&&(T=v(p,F,U,K,ae,i),u&&(p.start=g+E*T)):bn(p,F,U,j),ke<t&&ve>=t&&(T=v(p,F,U,K,ae,t),qe=!0),ke>i&&ve<=i&&(T=v(p,F,U,K,ae,i),qe=!0),!o&&qe&&(u&&(p.end=g+E*T),a.push(p),p=Ri(e)),u&&(g+=E)}var ct=e.length-3;F=e[ct],U=e[ct+1],j=e[ct+2],ve=r===0?F:U,ve>=t&&ve<=i&&bn(p,F,U,j),ct=p.length-3,o&&ct>=3&&(p[ct]!==p[0]||p[ct+1]!==p[1])&&bn(p,p[0],p[1],p[2]),p.length&&a.push(p)}function Ri(e){var a=[];return a.size=e.size,a.start=e.start,a.end=e.end,a}function yn(e,a,t,i,r,o){for(var u=0;u<e.length;u++)Qi(e[u],a,t,i,r,o,!1)}function bn(e,a,t,i){e.push(a),e.push(t),e.push(i)}function Ai(e,a,t,i,r,o){var u=(o-a)/(i-a);return e.push(o),e.push(t+(r-t)*u),e.push(1),u}function Xi(e,a,t,i,r,o){var u=(o-t)/(r-t);return e.push(a+(i-a)*u),e.push(o),e.push(1),u}function xa(e,a){var t=a.buffer/a.extent,i=e,r=pn(e,1,-1-t,t,0,-1,2,a),o=pn(e,1,1-t,2+t,0,-1,2,a);return(r||o)&&(i=pn(e,1,-t,1+t,0,-1,2,a)||[],r&&(i=$o(r,1).concat(i)),o&&(i=i.concat($o(o,-1)))),i}function $o(e,a){for(var t=[],i=0;i<e.length;i++){var r=e[i],o=r.type,u;if(o==="Point"||o==="MultiPoint"||o==="LineString")u=Ko(r.geometry,a);else if(o==="MultiLineString"||o==="Polygon"){u=[];for(var p=0;p<r.geometry.length;p++)u.push(Ko(r.geometry[p],a))}else if(o==="MultiPolygon")for(u=[],p=0;p<r.geometry.length;p++){for(var v=[],g=0;g<r.geometry[p].length;g++)v.push(Ko(r.geometry[p][g],a));u.push(v)}t.push(fn(r.id,o,u,r.tags))}return t}function Ko(e,a){var t=[];t.size=e.size,e.start!==void 0&&(t.start=e.start,t.end=e.end);for(var i=0;i<e.length;i+=3)t.push(e[i]+a,e[i+1],e[i+2]);return t}function ma(e,a){if(e.transformed)return e;var t=1<<e.z,i=e.x,r=e.y,o,u,p;for(o=0;o<e.features.length;o++){var v=e.features[o],g=v.geometry,E=v.type;if(v.geometry=[],E===1)for(u=0;u<g.length;u+=2)v.geometry.push(Xs(g[u],g[u+1],a,t,i,r));else for(u=0;u<g.length;u++){var T=[];for(p=0;p<g[u].length;p+=2)T.push(Xs(g[u][p],g[u][p+1],a,t,i,r));v.geometry.push(T)}}return e.transformed=!0,e}function Xs(e,a,t,i,r,o){return[Math.round(t*(e*i-r)),Math.round(t*(a*i-o))]}function Mo(e,a,t,i,r){for(var o=a===r.maxZoom?0:r.tolerance/((1<<a)*r.extent),u={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:t,y:i,z:a,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},p=0;p<e.length;p++){u.numFeatures++,Ns(u,e[p],o,r);var v=e[p].minX,g=e[p].minY,E=e[p].maxX,T=e[p].maxY;v<u.minX&&(u.minX=v),g<u.minY&&(u.minY=g),E>u.maxX&&(u.maxX=E),T>u.maxY&&(u.maxY=T)}return u}function Ns(e,a,t,i){var r=a.geometry,o=a.type,u=[];if(o==="Point"||o==="MultiPoint")for(var p=0;p<r.length;p+=3)u.push(r[p]),u.push(r[p+1]),e.numPoints++,e.numSimplified++;else if(o==="LineString")rs(u,r,e,t,!1,!1);else if(o==="MultiLineString"||o==="Polygon")for(p=0;p<r.length;p++)rs(u,r[p],e,t,o==="Polygon",p===0);else if(o==="MultiPolygon")for(var v=0;v<r.length;v++){var g=r[v];for(p=0;p<g.length;p++)rs(u,g[p],e,t,!0,p===0)}if(u.length){var E=a.tags||null;if(o==="LineString"&&i.lineMetrics){E={};for(var T in a.tags)E[T]=a.tags[T];E.mapbox_clip_start=r.start/r.size,E.mapbox_clip_end=r.end/r.size}var O={geometry:u,type:o==="Polygon"||o==="MultiPolygon"?3:o==="LineString"||o==="MultiLineString"?2:1,tags:E};a.id!==null&&(O.id=a.id),e.features.push(O)}}function rs(e,a,t,i,r,o){var u=i*i;if(i>0&&a.size<(r?u:i)){t.numPoints+=a.length/3;return}for(var p=[],v=0;v<a.length;v+=3)(i===0||a[v+2]>u)&&(t.numSimplified++,p.push(a[v]),p.push(a[v+1])),t.numPoints++;r&&Ys(p,o),e.push(p)}function Ys(e,a){for(var t=0,i=0,r=e.length,o=r-2;i<r;o=i,i+=2)t+=(e[i]-e[o])*(e[i+1]+e[o+1]);if(t>0===a)for(i=0,r=e.length;i<r/2;i+=2){var u=e[i],p=e[i+1];e[i]=e[r-2-i],e[i+1]=e[r-1-i],e[r-2-i]=u,e[r-1-i]=p}}function zs(e,a){return new Us(e,a)}function Us(e,a){a=this.options=ta(Object.create(this.options),a);var t=a.debug;if(t&&console.time("preprocess data"),a.maxZoom<0||a.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(a.promoteId&&a.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=Mn(e,a);this.tiles={},this.tileCoords=[],t&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",a.indexMaxZoom,a.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),i=xa(i,a),i.length&&this.splitTile(i,0,0,0),t&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}Us.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Us.prototype.splitTile=function(e,a,t,i,r,o,u){for(var p=[e,a,t,i],v=this.options,g=v.debug;p.length;){i=p.pop(),t=p.pop(),a=p.pop(),e=p.pop();var E=1<<a,T=Qo(a,t,i),O=this.tiles[T];if(!O&&(g>1&&console.time("creation"),O=this.tiles[T]=Mo(e,a,t,i,v),this.tileCoords.push({z:a,x:t,y:i}),g)){g>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",a,t,i,O.numFeatures,O.numPoints,O.numSimplified),console.timeEnd("creation"));var F="z"+a;this.stats[F]=(this.stats[F]||0)+1,this.total++}if(O.source=e,r){if(a===v.maxZoom||a===r)continue;var U=1<<r-a;if(t!==Math.floor(o/U)||i!==Math.floor(u/U))continue}else if(a===v.indexMaxZoom||O.numPoints<=v.indexMaxPoints)continue;if(O.source=null,e.length!==0){g>1&&console.time("clipping");var j=.5*v.buffer/v.extent,K=.5-j,ae=.5+j,ve=1+j,ke,qe,ct,_t,Ot,Xt;ke=qe=ct=_t=null,Ot=pn(e,E,t-j,t+ae,0,O.minX,O.maxX,v),Xt=pn(e,E,t+K,t+ve,0,O.minX,O.maxX,v),e=null,Ot&&(ke=pn(Ot,E,i-j,i+ae,1,O.minY,O.maxY,v),qe=pn(Ot,E,i+K,i+ve,1,O.minY,O.maxY,v),Ot=null),Xt&&(ct=pn(Xt,E,i-j,i+ae,1,O.minY,O.maxY,v),_t=pn(Xt,E,i+K,i+ve,1,O.minY,O.maxY,v),Xt=null),g>1&&console.timeEnd("clipping"),p.push(ke||[],a+1,t*2,i*2),p.push(qe||[],a+1,t*2,i*2+1),p.push(ct||[],a+1,t*2+1,i*2),p.push(_t||[],a+1,t*2+1,i*2+1)}}},Us.prototype.getTile=function(e,a,t){var i=this.options,r=i.extent,o=i.debug;if(e<0||e>24)return null;var u=1<<e;a=(a%u+u)%u;var p=Qo(e,a,t);if(this.tiles[p])return ma(this.tiles[p],r);o>1&&console.log("drilling down to z%d-%d-%d",e,a,t);for(var v=e,g=a,E=t,T;!T&&v>0;)v--,g=Math.floor(g/2),E=Math.floor(E/2),T=this.tiles[Qo(v,g,E)];return!T||!T.source?null:(o>1&&console.log("found parent tile z%d-%d-%d",v,g,E),o>1&&console.time("drilling down"),this.splitTile(T.source,v,g,E,e,a,t),o>1&&console.timeEnd("drilling down"),this.tiles[p]?ma(this.tiles[p],r):null)};function Qo(e,a,t){return((1<<e)*t+a)*32+e}function ta(e,a){for(var t in a)e[t]=a[t];return e}var ks={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function La(e){for(var a=0,t=0,i=e.length,r=i-1,o,u;t<i;r=t++)o=e[t],u=e[r],a+=(u.x-o.x)*(o.y+u.y);return a}function nu(e){var a=e.length;if(a<=1)return[e];for(var t=[],i,r,o=0;o<a;o++){var u=La(e[o]);u!==0&&(r===void 0&&(r=u<0),r===u<0?(i&&t.push(i),i=[e[o]]):i.push(e[o]))}return i&&t.push(i),t}var zi=["Unknown","Point","LineString","Polygon"];function ba(e,a,t,i,r){var o=r.geometry,u=r.type,p=r.tags,v=r.id,g=e*Math.pow(2,i),E=e*a,T=e*t,O=zi[u],F,U;function j(ve){for(var ke=0;ke<ve.length;ke++){var qe=ve[ke];if(qe[3])break;var ct=180-(qe[1]+T)*360/g,_t=(qe[0]+E)*360/g-180,Ot=360/Math.PI*Math.atan(Math.exp(ct*Math.PI/180))-90;ve[ke]=[_t,Ot,0,1]}}switch(u){case 1:var K=[];for(F=0;F<o.length;F++)K[F]=o[F][0];o=K,j(o);break;case 2:for(F=0;F<o.length;F++)j(o[F]);break;case 3:for(o=nu(o),F=0;F<o.length;F++)for(U=0;U<o[F].length;U++)j(o[F][U]);break}o.length===1?o=o[0]:O="Multi"+O;var ae={type:"Feature",geometry:{type:O,coordinates:o},properties:p,id:v,tileOrigin:[0,0],coord:""};return ae}var Ha=function(){var e=(0,Sa.Z)(zn().mark(function a(t,i,r,o){return zn().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",new Promise(function(v){var g=i.getTile(t.z,t.x,t.y),E=[];g.features.map(function(O){var F=ba(o,r.x,r.y,r.z,O);E.push(F)});var T={layers:{geojsonvt:{features:E}}};v(T)}));case 1:case"end":return p.stop()}},a)}));return function(t,i,r,o){return e.apply(this,arguments)}}();function _s(e){var a={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions>"u"||(e.geojsonvtOptions.maxZoom&&(a.maxZoom=e.geojsonvtOptions.maxZoom),e.geojsonvtOptions.indexMaxZoom&&(a.indexMaxZoom=e.geojsonvtOptions.indexMaxZoom),e.geojsonvtOptions.indexMaxPoints&&(a.indexMaxPoints=e.geojsonvtOptions.indexMaxPoints),e.geojsonvtOptions.tolerance&&(a.tolerance=e.geojsonvtOptions.tolerance),e.geojsonvtOptions.extent&&(a.extent=e.geojsonvtOptions.extent),e.geojsonvtOptions.buffer&&(a.buffer=e.geojsonvtOptions.buffer),e.geojsonvtOptions.lineMetrics&&(a.lineMetrics=e.geojsonvtOptions.lineMetrics),e.geojsonvtOptions.promoteId&&(a.promoteId=e.geojsonvtOptions.promoteId),e.geojsonvtOptions.generateId&&(a.generateId=e.geojsonvtOptions.generateId),e.geojsonvtOptions.debug&&(a.debug=e.geojsonvtOptions.debug)),a}function ff(e,a){var t=_s(a),i=t.extent||4096,r=zs(e,t),o=function(v,g){return Ha(g,r,v,i)},u=(0,Z.Z)((0,Z.Z)((0,Z.Z)({},ks),a),{},{getTileData:o});return{data:e,dataArray:[],tilesetOptions:u,isTile:!0}}function De(e,a){var t=a.extent,i=a.width,r=a.height,o=a.min,u=a.max,p={_id:1,dataArray:[{_id:1,data:Array.from(e),width:i,height:r,min:o,max:u,coordinates:[[t[0],t[1]],[t[2],t[3]]]}]};return p}var Wt;(function(e){e.IMAGE="image",e.ARRAYBUFFER="arraybuffer"})(Wt||(Wt={}));var Lt=function(){var e=(0,Sa.Z)(zn().mark(function a(t,i,r,o){var u;return zn().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return u=Du(t,i),v.abrupt("return",new Promise(function(g,E){var T=Fs({url:u},function(O,F){O?E(O):F&&g(F)},o);r.xhrCancel=function(){return T.abort()}}));case 2:case"end":return v.stop()}},a)}));return function(t,i,r,o){return e.apply(this,arguments)}}(),Un=function(){var e=(0,Sa.Z)(zn().mark(function a(t,i,r){var o;return zn().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return o=Du(t,i),p.abrupt("return",new Promise(function(v,g){var E=ti({url:o},function(T,O){T?g(T):O&&v(O)});r.xhrCancel=function(){return E.abort()}}));case 2:case"end":return p.stop()}},a)}));return function(t,i,r){return e.apply(this,arguments)}}(),Ea=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},Re={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function ge(e,a){var t=(a==null?void 0:a.dataType)||Wt.IMAGE,i=function(u,p){return t===Wt.IMAGE?Un(e,u,p):Lt(e,u,p,(a==null?void 0:a.format)||Ea)},r=(0,Z.Z)((0,Z.Z)((0,Z.Z)({},Re),a),{},{getTileData:i});return{data:e,dataArray:[],tilesetOptions:r,isTile:!0}}var Qe={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},wt=function(){var e=(0,Sa.Z)(zn().mark(function a(t){return zn().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise(function(o){var u=(0,pr.Z)(t.bounds,4),p=u[0],v=u[1],g=u[2],E=u[3],T={layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,textLng:(p+g)/2,textLat:(v+E)/2},geometry:{type:"LineString",coordinates:[[g,E],[g,v],[p,v],[p,v]]}}]}}};o(T)}));case 1:case"end":return r.stop()}},a)}));return function(t){return e.apply(this,arguments)}}();function Ut(e,a){var t=function(o){return wt(o)},i=(0,Z.Z)((0,Z.Z)((0,Z.Z)({},Qe),a),{},{getTileData:t});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}}var ot=vt(34155);function Ge(e,a,t,i){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function p(E){try{g(i.next(E))}catch(T){u(T)}}function v(E){try{g(i.throw(E))}catch(T){u(T)}}function g(E){E.done?o(E.value):r(E.value).then(p,v)}g((i=i.apply(e,a||[])).next())})}function mt(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,u;return u={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function p(g){return function(E){return v([g,E])}}function v(g){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,r&&(o=g[0]&2?r.return:g[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,g[1])).done)return o;switch(r=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return t.label++,{value:g[1],done:!1};case 5:t.label++,r=g[1],g=[0];continue;case 7:g=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){t=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){t.label=g[1];break}if(g[0]===6&&t.label<o[1]){t.label=o[1],o=g;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(g);break}o[2]&&t.ops.pop(),t.trys.pop();continue}g=a.call(e,t)}catch(E){g=[6,E],r=0}finally{i=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}function we(e,a){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var i=t.call(e),r,o=[],u;try{for(;(a===void 0||a-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(p){u={error:p}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(u)throw u.error}}return o}function Ke(){for(var e=[],a=0;a<arguments.length;a++)e=e.concat(we(arguments[a]));return e}function Ie(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function gt(e,a){return a={exports:{}},e(a,a.exports),a.exports}var Pt=gt(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=t;function t(i){return i&&typeof i.length=="number"&&i.length>=0&&i.length%1===0}e.exports=a.default});Ie(Pt);var Ar=gt(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(t){return function(){for(var i=[],r=arguments.length;r--;)i[r]=arguments[r];var o=i.pop();return t.call(this,i,o)}},e.exports=a.default});Ie(Ar);var ln=gt(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.fallback=r,a.wrap=o;var t=a.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,i=a.hasNextTick=typeof ot=="object"&&typeof ot.nextTick=="function";function r(p){setTimeout(p,0)}function o(p){return function(v){for(var g=[],E=arguments.length-1;E-- >0;)g[E]=arguments[E+1];return p(function(){return v.apply(void 0,g)})}}var u;t?u=setImmediate:i?u=ot.nextTick:u=r,a.default=o(u)});Ie(ln);var _n=ln.fallback,Ln=ln.wrap,dn=ln.hasSetImmediate,ni=ln.hasNextTick,In=gt(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=o;var t=r(Ar),i=r(ln);function r(v){return v&&v.__esModule?v:{default:v}}function o(v){return(0,En.isAsync)(v)?function(){for(var g=[],E=arguments.length;E--;)g[E]=arguments[E];var T=g.pop(),O=v.apply(this,g);return u(O,T)}:(0,t.default)(function(g,E){var T;try{T=v.apply(this,g)}catch(O){return E(O)}if(T&&typeof T.then=="function")return u(T,E);E(null,T)})}function u(v,g){return v.then(function(E){p(g,null,E)},function(E){p(g,E&&E.message?E:new Error(E))})}function p(v,g,E){try{v(g,E)}catch(T){(0,i.default)(function(O){throw O},T)}}e.exports=a.default});Ie(In);var En=gt(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.isAsyncIterable=a.isAsyncGenerator=a.isAsync=void 0;var t=i(In);function i(v){return v&&v.__esModule?v:{default:v}}function r(v){return v[Symbol.toStringTag]==="AsyncFunction"}function o(v){return v[Symbol.toStringTag]==="AsyncGenerator"}function u(v){return typeof v[Symbol.asyncIterator]=="function"}function p(v){if(typeof v!="function")throw new Error("expected a function");return r(v)?(0,t.default)(v):v}a.default=p,a.isAsync=r,a.isAsyncGenerator=o,a.isAsyncIterable=u});Ie(En);var Jn=En.isAsyncIterable,Gn=En.isAsyncGenerator,Oi=En.isAsync,Ma=gt(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=t;function t(i,r){if(r===void 0&&(r=i.length),!r)throw new Error("arity is undefined");function o(){for(var u=this,p=[],v=arguments.length;v--;)p[v]=arguments[v];return typeof p[r-1]=="function"?i.apply(this,p):new Promise(function(g,E){p[r-1]=function(T){for(var O=[],F=arguments.length-1;F-- >0;)O[F]=arguments[F+1];if(T)return E(T);g(O.length>1?O:O[0])},i.apply(u,p)})}return Object.defineProperty(o,"name",{configurable:!0,value:"awaitable("+i.name+")"}),o}e.exports=a.default});Ie(Ma);var Is=gt(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=o(Pt),i=o(En),r=o(Ma);function o(u){return u&&u.__esModule?u:{default:u}}a.default=(0,r.default)(function(u,p,v){var g=(0,t.default)(p)?[]:{};u(p,function(E,T,O){(0,i.default)(E)(function(F){for(var U,j=[],K=arguments.length-1;K-- >0;)j[K]=arguments[K+1];j.length<2&&(U=j,j=U[0]),g[T]=j,O(F)})},function(E){return v(E,g)})},3),e.exports=a.default});Ie(Is);var co=gt(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=t;function t(i){function r(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(i!==null){var p=i;i=null,p.apply(this,o)}}return Object.assign(r,i),r}e.exports=a.default});Ie(co);var Ua=gt(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},e.exports=a.default});Ie(Ua);var zc=gt(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=v;var t=r(Pt),i=r(Ua);function r(g){return g&&g.__esModule?g:{default:g}}function o(g){var E=-1,T=g.length;return function(){return++E<T?{value:g[E],key:E}:null}}function u(g){var E=-1;return function(){var O=g.next();return O.done?null:(E++,{value:O.value,key:E})}}function p(g){var E=g?Object.keys(g):[],T=-1,O=E.length;return function(){var U=E[++T];return T<O?{value:g[U],key:U}:null}}function v(g){if((0,t.default)(g))return o(g);var E=(0,i.default)(g);return E?u(E):p(g)}e.exports=a.default});Ie(zc);var iu=gt(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=t;function t(i){return function(){for(var r=[],o=arguments.length;o--;)r[o]=arguments[o];if(i===null)throw new Error("Callback was already called.");var u=i;i=null,u.apply(this,r)}}e.exports=a.default});Ie(iu);var hl=gt(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t={};a.default=t,e.exports=a.default});Ie(hl);var Ol=gt(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=r;var t=i(hl);function i(o){return o&&o.__esModule?o:{default:o}}function r(o,u,p,v){var g=!1,E=!1,T=!1,O=0,F=0;function U(){O>=u||T||g||(T=!0,o.next().then(function(ae){var ve=ae.value,ke=ae.done;if(!(E||g)){if(T=!1,ke){g=!0,O<=0&&v(null);return}O++,p(ve,F,j),F++,U()}}).catch(K))}function j(ae,ve){if(O-=1,!E){if(ae)return K(ae);if(ae===!1){g=!0,E=!0;return}if(ve===t.default||g&&O<=0)return g=!0,v(null);U()}}function K(ae){E||(T=!1,g=!0,v(ae))}U()}e.exports=a.default});Ie(Ol);var Th=gt(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=p(co),i=p(zc),r=p(iu),o=p(Ol),u=p(hl);function p(v){return v&&v.__esModule?v:{default:v}}a.default=function(v){return function(g,E,T){if(T=(0,t.default)(T),v<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!g)return T(null);if((0,En.isAsyncGenerator)(g))return(0,o.default)(g,v,E,T);if((0,En.isAsyncIterable)(g))return(0,o.default)(g[Symbol.asyncIterator](),v,E,T);var O=(0,i.default)(g),F=!1,U=!1,j=0,K=!1;function ae(ke,qe){if(!U)if(j-=1,ke)F=!0,T(ke);else if(ke===!1)F=!0,U=!0;else{if(qe===u.default||F&&j<=0)return F=!0,T(null);K||ve()}}function ve(){for(K=!0;j<v&&!F;){var ke=O();if(ke===null){F=!0,j<=0&&T(null);return}j+=1,E(ke.value,ke.key,(0,r.default)(ae))}K=!1}ve()}},e.exports=a.default});Ie(Th);var pl=gt(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=o(Th),i=o(En),r=o(Ma);function o(p){return p&&p.__esModule?p:{default:p}}function u(p,v,g,E){return(0,t.default)(v)(p,(0,i.default)(g),E)}a.default=(0,r.default)(u,4),e.exports=a.default});Ie(pl);var Uf=gt(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=r(pl),i=r(Ma);function r(u){return u&&u.__esModule?u:{default:u}}function o(u,p,v){return(0,t.default)(u,1,p,v)}a.default=(0,i.default)(o,3),e.exports=a.default});Ie(Uf);var np=gt(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=o;var t=r(Is),i=r(Uf);function r(u){return u&&u.__esModule?u:{default:u}}function o(u,p){return(0,t.default)(i.default,u,p)}e.exports=a.default}),Hd=Ie(np),Do=function(){function e(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];return this.args=t,Hd(this.tasks)},e.prototype.tap=function(a,t){var i=this;this.tasks.push(function(r){t.apply(void 0,Ke(i.args)),r(null,a)})},e}(),qs=gt(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=g(Pt),i=g(hl),r=g(pl),o=g(co),u=g(iu),p=g(En),v=g(Ma);function g(F){return F&&F.__esModule?F:{default:F}}function E(F,U,j){j=(0,o.default)(j);var K=0,ae=0,ve=F.length,ke=!1;ve===0&&j(null);function qe(ct,_t){ct===!1&&(ke=!0),ke!==!0&&(ct?j(ct):(++ae===ve||_t===i.default)&&j(null))}for(;K<ve;K++)U(F[K],K,(0,u.default)(qe))}function T(F,U,j){return(0,r.default)(F,1/0,U,j)}function O(F,U,j){var K=(0,t.default)(F)?E:T;return K(F,(0,p.default)(U),j)}a.default=(0,v.default)(O,3),e.exports=a.default});Ie(qs);var oh=gt(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=o;var t=r(qs),i=r(Is);function r(u){return u&&u.__esModule?u:{default:u}}function o(u,p){return(0,i.default)(t.default,u,p)}e.exports=a.default}),md=Ie(oh),gd=function(){function e(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];this.tasks=[]}return e.prototype.promise=function(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];return md(this.tasks)},e.prototype.tapPromise=function(a,t){var i=this;this.tasks.push(function(r){return Ge(i,void 0,void 0,function(){return mt(this,function(o){switch(o.label){case 0:return[4,t()];case 1:return o.sent(),r(null,a),[2]}})})})},e}(),D0=gt(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=u(co),i=u(iu),r=u(En),o=u(Ma);function u(v){return v&&v.__esModule?v:{default:v}}function p(v,g){if(g=(0,t.default)(g),!Array.isArray(v))return g(new Error("First argument to waterfall must be an array of functions"));if(!v.length)return g();var E=0;function T(F){var U=(0,r.default)(v[E++]);U.apply(void 0,F.concat([(0,i.default)(O)]))}function O(F){for(var U=[],j=arguments.length-1;j-- >0;)U[j]=arguments[j+1];if(F!==!1){if(F||E===v.length)return g.apply(void 0,[F].concat(U));T(U)}}T([])}a.default=(0,o.default)(p),e.exports=a.default}),yd=Ie(D0),Mh=function(){function e(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];this.tasks=[]}return e.prototype.call=function(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];return yd(this.tasks)},e.prototype.tap=function(a,t){this.tasks.length===0?this.tasks.push(function(i){var r=t();i(r?null:!1,r)}):this.tasks.push(function(i,r){var o=t();r(o?null:!1,a)})},e}(),l0=function(){function e(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];this.tasks=[]}return e.prototype.call=function(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];return Hd(this.tasks)},e.prototype.tap=function(a,t){this.tasks.push(function(i){var r=t();i(r,a)})},e}(),Br=vt(96486),Hv=vt(69848),au=vt.n(Hv);function kh(e,a){var t=a.radius,i=t===void 0?40:t,r=a.maxZoom,o=r===void 0?18:r,u=a.minZoom,p=u===void 0?0:u,v=a.zoom,g=v===void 0?2:v;if(e.pointIndex){var E=e.pointIndex.getClusters(e.extent,Math.floor(g));return e.dataArray=Wd(E),e}var T=new(au())({radius:i,minZoom:p,maxZoom:o}),O={type:"FeatureCollection",features:[]};return O.features=e.dataArray.map(function(F){return{type:"Feature",geometry:{type:"Point",coordinates:F.coordinates},properties:(0,Z.Z)({},F)}}),T.load(O.features),T}function Wd(e){return e.map(function(a,t){return(0,Z.Z)({coordinates:a.geometry.coordinates,_id:t+1},a.properties)})}function n(e){if(e.length===0)throw new Error("max requires at least one data point");for(var a=e[0],t=1;t<e.length;t++)e[t]>a&&(a=e[t]);return a}function s(e){if(e.length===0)throw new Error("min requires at least one data point");for(var a=e[0],t=1;t<e.length;t++)e[t]<a&&(a=e[t]);return a}function l(e){if(e.length===0)return 0;for(var a=e[0],t=0,i,r=1;r<e.length;r++)i=a+e[r]*1,Math.abs(a)>=Math.abs(e[r])?t+=a-i+e[r]:t+=e[r]-i+a,a=i;return a+t*1}function d(e){if(e.length===0)throw new Error("mean requires at least one data point");return l(e)/e.length}var _={min:s,max:n,mean:d,sum:l};function C(e,a){return e.map(function(t){return t[a]*1})}function A(e){var a=L();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function L(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function z(e,a){if(Array.isArray(a))return a}var W=function(e){(0,mr.Z)(t,e);var a=A(t);function t(i,r){var o;return(0,xt.Z)(this,t),o=a.call(this),(0,ee.Z)((0,dt.Z)(o),"inited",!1),(0,ee.Z)((0,dt.Z)(o),"hooks",{init:new Do}),(0,ee.Z)((0,dt.Z)(o),"parser",{type:"geojson"}),(0,ee.Z)((0,dt.Z)(o),"transforms",[]),(0,ee.Z)((0,dt.Z)(o),"cluster",!1),(0,ee.Z)((0,dt.Z)(o),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,ee.Z)((0,dt.Z)(o),"invalidExtent",!1),(0,ee.Z)((0,dt.Z)(o),"dataArrayChanged",!1),(0,ee.Z)((0,dt.Z)(o),"cfg",{}),o.originData=i,o.initCfg(r),o.init(),o}return(0,St.Z)(t,[{key:"getClusters",value:function(r){return this.clusterIndex.getClusters(this.caculClusterExtent(2),r)}},{key:"getClustersLeaves",value:function(r){return this.clusterIndex.getLeaves(r,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(r){var o=this,u=this.clusterOptions,p=u.method,v=p===void 0?"sum":p,g=u.field,E=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(r));this.clusterOptions.zoom=r,E.forEach(function(T){T.id||(T.properties.point_count=1)}),(g||(0,Br.isFunction)(v))&&(E=E.map(function(T){var O=T.id;if(O){var F=o.clusterIndex.getLeaves(O,1/0),U=F.map(function(ae){return ae.properties}),j;if((0,Br.isString)(v)&&g){var K=C(U,g);j=_[v](K)}(0,Br.isFunction)(v)&&(j=v(U)),T.properties.stat=j}else T.properties.point_count=1;return T})),this.data=Tr("geojson")({type:"FeatureCollection",features:E}),this.executeTrans()}},{key:"getFeatureById",value:function(r){var o=this.parser.type,u=o===void 0?"geojson":o;if(u==="geojson"&&!this.cluster){var p=r<this.originData.features.length?this.originData.features[r]:"null",v=(0,Br.cloneDeep)(p);if(v!=null&&v.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var g=this.data.dataArray.find(function(E){return E._id===r});v.properties=g}return v}else return r<this.data.dataArray.length?this.data.dataArray[r]:"null"}},{key:"updateFeaturePropertiesById",value:function(r,o){this.data.dataArray=this.data.dataArray.map(function(u){return u._id===r?(0,Z.Z)((0,Z.Z)({},u),o):u}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(r,o){var u=this.data.dataArray.find(function(p){return p[r]===o});return u==null?void 0:u._id}},{key:"setData",value:function(r,o){this.originData=r,this.dataArrayChanged=!1,this.initCfg(o),this.init()}},{key:"destroy",value:function(){var r;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(r=this.tileset)===null||r===void 0||r.destroy()}},{key:"handleData",value:function(){var r=this;return new Promise(function(o,u){try{r.excuteParser(),r.initCluster(),r.executeTrans(),o({})}catch(p){u(p)}})}},{key:"initCfg",value:function(r){this.cfg=(0,Br.mergeWith)(this.cfg,r,z);var o=this.cfg;o&&(o.parser&&(this.parser=o.parser),o.transforms&&(this.transforms=o.transforms),this.cluster=o.cluster||!1,o.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,Z.Z)((0,Z.Z)({},this.clusterOptions),o.clusterOptions)))}},{key:"init",value:function(){var r=this;this.inited=!1,this.handleData().then(function(){r.inited=!0,r.emit("sourceUpdate")})}},{key:"excuteParser",value:function(){var r=this.parser,o=r.type||"geojson",u=Tr(o);this.data=u(this.originData,r),this.extent=Tl(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3],this.tileset=this.initTileset()}},{key:"setCenter",value:function(r){this.center=[(r[0]+r[2])/2,(r[1]+r[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var r=this.data.tilesetOptions;if(!!r){if(this.tileset)return this.tileset.updateOptions(r),this.tileset;var o=new a0((0,Z.Z)({},r));return o}}},{key:"executeTrans",value:function(){var r=this,o=this.transforms;o.forEach(function(u){var p=u.type,v=fr(p)(r.data,u);Object.assign(r.data,v)})}},{key:"initCluster",value:function(){if(!!this.cluster){var r=this.clusterOptions||{};this.clusterIndex=kh(this.data,r)}}},{key:"caculClusterExtent",value:function(r){var o=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(o=hc(Wl(this.extent),r)),o[0].concat(o[1])}}]),t}(fl.EventEmitter);function q(e,a){var t=a.callback;return t&&(e.dataArray=e.dataArray.filter(t)),e}function J(e,a){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=se(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function se(e,a){if(!!e){if(typeof e=="string")return de(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return de(e,a)}}function de(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var Be=6378e3;function Ve(e,a){var t=e.dataArray,i=a.size,r=i===void 0?10:i,o=r/(2*Math.PI*Be)*(256<<20)/2,u=at(t,r),p=u.gridHash,v=u.gridOffset,g=Jt(p,v,a);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:g}}function at(e,a){var t=1/0,i=-1/0,r,o=J(e),u;try{for(o.s();!(u=o.n()).done;){var p=u.value;r=p.coordinates[1],Number.isFinite(r)&&(t=r<t?r:t,i=r>i?r:i)}}catch(ke){o.e(ke)}finally{o.f()}var v=(t+i)/2,g=$e(a,v);if(g.xOffset<=0||g.yOffset<=0)return{gridHash:{},gridOffset:g};var E={},T=J(e),O;try{for(T.s();!(O=T.n()).done;){var F=O.value,U=F.coordinates[1],j=F.coordinates[0];if(Number.isFinite(U)&&Number.isFinite(j)){var K=Math.floor((U+90)/g.yOffset),ae=Math.floor((j+180)/g.xOffset),ve="".concat(K,"-").concat(ae);E[ve]=E[ve]||{count:0,points:[]},E[ve].count+=1,E[ve].points.push(F)}}}catch(ke){T.e(ke)}finally{T.f()}return{gridHash:E,gridOffset:g}}function $e(e,a){var t=Et(e),i=Rt(a,e);return{yOffset:t,xOffset:i}}function Et(e){return e/Be*(180/Math.PI)}function Rt(e,a){return a/Be*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Jt(e,a,t){return Object.keys(e).reduce(function(i,r,o){var u=r.split("-"),p=parseInt(u[0],10),v=parseInt(u[1],10),g={};if(t.field&&t.method){var E=mn(e[r].points,t.field);g[t.method]=Gl[t.method](E)}return Object.assign(g,{_id:o,coordinates:za([-180+a.xOffset*(v+.5),-90+a.yOffset*(p+.5)]),rawData:e[r].points,count:e[r].count}),i.push(g),i},[])}var $t=Math.PI/3,Cr=[0,$t,2*$t,3*$t,4*$t,5*$t];function Yr(e){return e[0]}function Sn(e){return e[1]}function yi(){var e=0,a=0,t=1,i=1,r=Yr,o=Sn,u,p,v;function g(T){var O={},F=[],U,j=T.length;for(U=0;U<j;++U)if(!(isNaN(ae=+r.call(null,K=T[U],U,T))||isNaN(ve=+o.call(null,K,U,T)))){var K,ae,ve,ke=Math.round(ve=ve/v),qe=Math.round(ae=ae/p-(ke&1)/2),ct=ve-ke;if(Math.abs(ct)*3>1){var _t=ae-qe,Ot=qe+(ae<qe?-1:1)/2,Xt=ke+(ve<ke?-1:1),yr=ae-Ot,Pr=ve-Xt;_t*_t+ct*ct>yr*yr+Pr*Pr&&(qe=Ot+(ke&1?1:-1)/2,ke=Xt)}var xr=qe+"-"+ke,An=O[xr];An?An.push(K):(F.push(An=O[xr]=[K]),An.x=(qe+(ke&1)/2)*p,An.y=ke*v)}return F}function E(T){var O=0,F=0;return Cr.map(function(U){var j=Math.sin(U)*T,K=-Math.cos(U)*T,ae=j-O,ve=K-F;return O=j,F=K,[ae,ve]})}return g.hexagon=function(T){return"m"+E(T==null?u:+T).join("l")+"z"},g.centers=function(){for(var T=[],O=Math.round(a/v),F=Math.round(e/p),U=O*v;U<i+u;U+=v,++O)for(var j=F*p+(O&1)*p/2;j<t+p/2;j+=p)T.push([j,U]);return T},g.mesh=function(){var T=E(u).slice(0,4).join("l");return g.centers().map(function(O){return"M"+O+"m"+T}).join("")},g.x=function(T){return arguments.length?(r=T,g):r},g.y=function(T){return arguments.length?(o=T,g):o},g.radius=function(T){return arguments.length?(u=+T,p=u*2*Math.sin($t),v=u*1.5,g):u},g.size=function(T){return arguments.length?(e=a=0,t=+T[0],i=+T[1],g):[t-e,i-a]},g.extent=function(T){return arguments.length?(e=+T[0][0],a=+T[0][1],t=+T[1][0],i=+T[1][1],g):[[e,a],[t,i]]},g.radius(1)}var Zn=6378e3;function bi(e,a){var t=e.dataArray,i=a.size,r=i===void 0?10:i,o=a.method,u=o===void 0?"sum":o,p=r/(2*Math.PI*Zn)*(256<<20)/2,v=t.map(function(O){var F=za(O.coordinates),U=(0,pr.Z)(F,2),j=U[0],K=U[1];return(0,Z.Z)((0,Z.Z)({},O),{},{coordinates:[j,K]})}),g=yi().radius(p).x(function(O){return O.coordinates[0]}).y(function(O){return O.coordinates[1]}),E=g(v),T={dataArray:E.map(function(O,F){var U;if(a.field&&u){var j=mn(O,a.field);O[u]=Gl[u](j)}return U={},(0,ee.Z)(U,a.method,O[u]),(0,ee.Z)(U,"count",O.length),(0,ee.Z)(U,"rawData",O),(0,ee.Z)(U,"coordinates",[O.x,O.y]),(0,ee.Z)(U,"_id",F),U}),radius:p,xOffset:p,yOffset:p,type:"hexagon"};return T}function Nn(e,a){var t=a.sourceField,i=a.targetField,r=a.data,o={};return r.forEach(function(u){o[u[t]]=u}),e.dataArray=e.dataArray.map(function(u){var p=u[i];return(0,Z.Z)((0,Z.Z)({},u),o[p])}),e}function la(e,a){var t=a.callback;return t&&(e.dataArray=e.dataArray.map(t)),e}rt("rasterTile",ge),rt("mvt",Ct),rt("geojsonvt",ff),rt("testTile",Ut),rt("geojson",$n),rt("image",He),rt("csv",zt),rt("json",Sr),rt("raster",De),Xe("cluster",kh),Xe("filter",q),Xe("join",Nn),Xe("map",la),Xe("grid",Ve),Xe("hexagon",bi);var Mi=W,li=vt(28660),vr=vt(86700),ra=vt(84879),At={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Ei=vt(31745),Wa=vt.n(Ei);function jo(e,a){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=fs(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function fs(e,a){if(!!e){if(typeof e=="string")return ns(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ns(e,a)}}function ns(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var mo=30;function xs(e){var a=e.characterSet,t=e.getFontWidth,i=e.fontHeight,r=e.buffer,o=e.maxCanvasWidth,u=e.mapping,p=u===void 0?{}:u,v=e.xOffset,g=v===void 0?0:v,E=e.yOffset,T=E===void 0?0:E,O=0,F=g;Array.from(a).forEach(function(j,K){if(!p[j]){var ae=t(j,K);F+mo>o&&(F=0,O++),p[j]={x:F,y:T+O*mo,width:mo,height:mo,advance:ae},F+=mo}});var U=i+r*2;return{mapping:p,xOffset:F,yOffset:T+O*U,canvasHeight:zu(T+(O+1)*U)}}function ou(e,a,t){var i=0,r=0,o=0,u=[],p={},v=jo(e),g;try{for(v.s();!(g=v.n()).done;){var E=g.value;if(!p[E.id]){var T=E.size;i+T+a>t&&($s(p,u,r),i=0,r=o+r+a,o=0,u=[]),u.push({icon:E,xOffset:i}),i=i+T+a,o=Math.max(o,T)}}}catch(F){v.e(F)}finally{v.f()}u.length>0&&$s(p,u,r);var O=zu(o+r+a);return{mapping:p,canvasHeight:O}}function $s(e,a,t){var i=jo(a),r;try{for(i.s();!(r=i.n()).done;){var o=r.value,u=o.icon,p=o.xOffset;e[u.id]=(0,Z.Z)((0,Z.Z)({},u),{},{x:p,y:t,image:u.image,width:u.width,height:u.height})}}catch(v){i.e(v)}finally{i.f()}}function zu(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var hs,Au;function bs(e,a){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=su(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function su(e,a){if(!!e){if(typeof e=="string")return wa(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return wa(e,a)}}function wa(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var Co=Es(),go="sans-serif",Za="normal",dl=24,Tu=3,Go=.25,Zs=8,gu=1024,Da=1,vl=1,_c=3,Fl=null;function Es(){for(var e=[],a=32;a<128;a++)e.push(String.fromCharCode(a));return e}function xc(e,a,t,i){e.font="".concat(i," ").concat(t,"px ").concat(a),e.fillStyle="black",e.textBaseline="middle"}function Uc(e,a){for(var t=0;t<e.length;t++)a.data[4*t+3]=e[t]}var _d=(hs=(0,vr.b2)(),hs(Au=function(){function e(){(0,xt.Z)(this,e),(0,ee.Z)(this,"fontAtlas",void 0),(0,ee.Z)(this,"iconFontMap",void 0),(0,ee.Z)(this,"iconFontGlyphs",{}),(0,ee.Z)(this,"fontOptions",void 0),(0,ee.Z)(this,"key",void 0),(0,ee.Z)(this,"cache",new tf(_c))}return(0,St.Z)(e,[{key:"scale",get:function(){return vl}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:go,fontWeight:Za,characterSet:Co,fontSize:dl,buffer:Tu,sdf:!0,cutoff:Go,radius:Zs,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var i=this;t.forEach(function(r){i.iconFontGlyphs[r.name]=r.unicode})}},{key:"addIconFont",value:function(t,i){this.iconFontMap.set(t,i)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=(0,Z.Z)((0,Z.Z)({},this.fontOptions),t),this.key=this.getKey();var i=this.getNewChars(this.key,this.fontOptions.characterSet),r=this.cache.get(this.key);if(!(r&&i.length===0)){var o=this.generateFontAtlas(this.key,i,r);this.fontAtlas=o,this.cache.set(this.key,o)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,i,r){var o=this.fontOptions,u=o.fontFamily,p=o.fontWeight,v=o.fontSize,g=o.buffer,E=o.sdf,T=o.radius,O=o.cutoff,F=o.iconfont,U=r&&r.data;U||(U=Ia.document.createElement("canvas"),U.width=gu);var j=U.getContext("2d");xc(j,u,v,p);var K=xs((0,Z.Z)({getFontWidth:function(Gu){return j.measureText(Gu).width},fontHeight:v*vl,buffer:g,characterSet:i,maxCanvasWidth:gu},r&&{mapping:r.mapping,xOffset:r.xOffset,yOffset:r.yOffset})),ae=K.mapping,ve=K.canvasHeight,ke=K.xOffset,qe=K.yOffset,ct=j.getImageData(0,0,U.width,U.height);if(U.height=ve,j.putImageData(ct,0,0),xc(j,u,v,p),E){var _t=new(Wa())(v,g,T,O,u,p),Ot=j.getImageData(0,0,_t.size,_t.size),Xt=bs(i),yr;try{for(Xt.s();!(yr=Xt.n()).done;){var Pr=yr.value;if(F){var xr=String.fromCharCode(parseInt(Pr.replace("&#x","").replace(";",""),16)),An=_t.draw(xr);Uc(An,Ot)}else Uc(_t.draw(Pr),Ot);j.putImageData(Ot,ae[Pr].x,ae[Pr].y)}}catch(_o){Xt.e(_o)}finally{Xt.f()}}else{var ii=bs(i),sa;try{for(ii.s();!(sa=ii.n()).done;){var Io=sa.value;j.fillText(Io,ae[Io].x,ae[Io].y+v*Da)}}catch(_o){ii.e(_o)}finally{ii.f()}}return{xOffset:ke,yOffset:qe,mapping:ae,data:U,width:U.width,height:U.height}}},{key:"getKey",value:function(){return"key";var t,i,r,o,u,p,v,g}},{key:"getNewChars",value:function(t,i){var r=this.cache.get(t);if(!r)return i;var o=[],u=r.mapping,p=new Set(Object.keys(u)),v=new Set(i);return v.forEach(function(g){p.has(g)||o.push(g)}),o}}]),e}())||Au),ip,zp;function Ih(e){var a=xd();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function xd(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Up=3,ap=1024,Zf=64,op=(ip=(0,vr.b2)(),ip(zp=function(e){(0,mr.Z)(t,e);var a=Ih(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"canvasHeight",128),(0,ee.Z)((0,dt.Z)(i),"texture",void 0),(0,ee.Z)((0,dt.Z)(i),"canvas",void 0),(0,ee.Z)((0,dt.Z)(i),"iconData",void 0),(0,ee.Z)((0,dt.Z)(i),"iconMap",void 0),(0,ee.Z)((0,dt.Z)(i),"ctx",void 0),(0,ee.Z)((0,dt.Z)(i),"loadingImageCount",0),i}return(0,St.Z)(t,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=Ia.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(r,o){var u=this,p=new Image;if(this.loadingImageCount++,this.hasImage(r))throw new Error("Image Id already exists");this.iconData.push({id:r,size:Zf}),this.updateIconMap(),this.loadImage(o).then(function(v){p=v;var g=u.iconData.find(function(E){return E.id===r});g&&(g.image=p,g.width=p.width,g.height=p.height),u.update()})}},{key:"addImageMini",value:function(r,o,u){var p=this,v=u.getSceneConfig().canvas,g=v.createImage();if(this.loadingImageCount++,this.hasImage(r))throw new Error("Image Id already exists");this.iconData.push({id:r,size:Zf}),this.updateIconMap(),this.loadImageMini(o,v).then(function(E){g=E;var T=p.iconData.find(function(O){return O.id===r});T&&(T.image=g,T.width=g.width,T.height=g.height),p.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(r){return this.iconMap.hasOwnProperty(r)}},{key:"removeImage",value:function(r){this.hasImage(r)&&(this.iconData=this.iconData.filter(function(o){return o.id!==r}),delete this.iconMap[r],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(r){return new Promise(function(o,u){if(r instanceof HTMLImageElement){o(r);return}var p=new Image;p.crossOrigin="anonymous",p.onload=function(){o(p)},p.onerror=function(){u(new Error("Could not load image at "+r))},p.src=r instanceof File?URL.createObjectURL(r):r})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var r=this;this.canvas.width=ap,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(o){var u=r.iconMap[o],p=u.x,v=u.y,g=u.image,E=u.width,T=E===void 0?64:E,O=u.height,F=O===void 0?64:O,U=Math.max(T,F),j=U/Zf,K=F/j,ae=T/j;g&&r.ctx.drawImage(g,p+(Zf-ae)/2,v+(Zf-K)/2,ae,K)})}},{key:"updateIconMap",value:function(){var r=ou(this.iconData,Up,ap),o=r.mapping,u=r.canvasHeight;this.iconMap=o,this.canvasHeight=u}},{key:"loadImageMini",value:function(r,o){return new Promise(function(u,p){var v=o.createImage();v.crossOrigin="anonymous",v.onload=function(){u(v)},v.onerror=function(){p(new Error("Could not load image at "+r))},v.src=r})}}]),t}(fl.EventEmitter))||zp),Ra=vt(85975),Zc,bd,Zp=(Zc=(0,vr.b2)(),Zc(bd=function(){function e(){(0,xt.Z)(this,e),(0,ee.Z)(this,"viewport",void 0),(0,ee.Z)(this,"overridedViewProjectionMatrix",void 0),(0,ee.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,ee.Z)(this,"jitteredProjectionMatrix",void 0),(0,ee.Z)(this,"viewMatrixInverse",void 0),(0,ee.Z)(this,"cameraPosition",void 0)}return(0,St.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=Ra.create(),Ra.invert(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),i=(0,pr.Z)(t,2),r=i[0],o=i[1];return[r,o]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,i){return this.viewport.projectFlat(t,i)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,i){var r=Ra.fromTranslation(Ra.create(),[t,i,0]);this.jitteredProjectionMatrix=Ra.multiply(Ra.create(),r,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Ra.multiply(Ra.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||bd),Ph,Vf;function Xd(e,a){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Vp(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function Vp(e,a){if(!!e){if(typeof e=="string")return jp(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return jp(e,a)}}function jp(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var Ed=(Ph=(0,vr.b2)(),Ph(Vf=function(){function e(){(0,xt.Z)(this,e),(0,ee.Z)(this,"container",void 0),(0,ee.Z)(this,"controlCorners",void 0),(0,ee.Z)(this,"controlContainer",void 0),(0,ee.Z)(this,"scene",void 0),(0,ee.Z)(this,"mapsService",void 0),(0,ee.Z)(this,"controls",[]),(0,ee.Z)(this,"unAddControls",[])}return(0,St.Z)(e,[{key:"init",value:function(t,i){this.container=t.container,this.scene=i,this.mapsService=i.get(At.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,i){var r=i.get(At.IMapService);r.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(i){return i.controlOption.name===t})}},{key:"removeControl",value:function(t){var i=this.controls.indexOf(t);return i>-1&&this.controls.splice(i,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(i){i.addTo(t.scene),t.controls.push(i)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t=Xd(this.controls),i;try{for(t.s();!(i=t.n()).done;){var r=i.value;r.remove()}}catch(o){t.e(o)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},i="l7-",r=this.controlContainer=ka("div",i+"control-container",this.container);function o(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],p=u.map(function(v){return i+v}).join(" ");t[u.join("")]=ka("div",p,r)}o(["top","left"]),o(["top","right"]),o(["bottom","left"]),o(["bottom","right"]),o(["top","center"]),o(["right","center"]),o(["left","center"]),o(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&jl(this.controlCorners[t]);this.controlContainer&&jl(this.controlContainer)}}]),e}())||Vf),Gp,Hp,Wp=(Gp=(0,vr.b2)(),Gp(Hp=function(){function e(){(0,xt.Z)(this,e),(0,ee.Z)(this,"container",void 0),(0,ee.Z)(this,"scene",void 0),(0,ee.Z)(this,"mapsService",void 0),(0,ee.Z)(this,"markers",[]),(0,ee.Z)(this,"markerLayers",[]),(0,ee.Z)(this,"unAddMarkers",[]),(0,ee.Z)(this,"unAddMarkerLayers",[])}return(0,St.Z)(e,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var i=this.markerLayers.indexOf(t);i>-1&&this.markerLayers.splice(i,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(i){i.addTo(t.scene),t.markers.push(i)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(i){t.markerLayers.push(i),i.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var i=this.markers.indexOf(t);i>-1&&this.markers.splice(i,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(At.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),e}())||Hp),Xp,Yp,sp=(Xp=(0,vr.b2)(),Xp(Yp=function(){function e(){(0,xt.Z)(this,e),(0,ee.Z)(this,"scene",void 0),(0,ee.Z)(this,"popup",void 0),(0,ee.Z)(this,"mapsService",void 0),(0,ee.Z)(this,"unAddPopup",void 0)}return(0,St.Z)(e,[{key:"removePopup",value:function(t){t.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(t){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(t.addTo(this.scene),this.popup=t):this.unAddPopup=t}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(At.IMapService)}}]),e}())||Yp),Cd={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},up=Cd,lp,hf,Sd={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},wd={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Ad=(lp=(0,vr.b2)(),lp(hf=function(){function e(){(0,xt.Z)(this,e),(0,ee.Z)(this,"sceneConfigCache",{}),(0,ee.Z)(this,"layerConfigCache",{})}return(0,St.Z)(e,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return up[t]}},{key:"setSceneConfig",value:function(t,i){this.sceneConfigCache[t]=(0,Z.Z)((0,Z.Z)({},Sd),i)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,i,r){this.layerConfigCache[i]=(0,Z.Z)({},(0,Br.merge)({},this.sceneConfigCache[t],wd,r))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||hf),da=vt(43269),ca=vt(53229),cp=vt(98333),fp=Math.PI/180,c0=512,qp=4003e4;function ps(e){var a=e.latitude,t=a===void 0?0:a,i=e.zoom,r=i===void 0?0:i,o=e.scale,u=e.highPrecision,p=u===void 0?!1:u,v=e.flipY,g=v===void 0?!1:v;o=o!==void 0?o:Math.pow(2,r);var E={},T=c0*o,O=Math.cos(t*fp),F=T/360,U=F/O,j=T/qp/O;if(E.pixelsPerMeter=[j,-j,j],E.metersPerPixel=[1/j,-1/j,1/j],E.pixelsPerDegree=[F,-U,j],E.degreesPerPixel=[1/F,-1/U,1/j],p){var K=fp*Math.tan(t*fp)/O,ae=F*K/2,ve=T/qp*K,ke=ve/U*j;E.pixelsPerDegree2=[0,-ae,ve],E.pixelsPerMeter2=[ke,0,ke],g&&(E.pixelsPerDegree2[1]=-E.pixelsPerDegree2[1],E.pixelsPerMeter2[1]=-E.pixelsPerMeter2[1])}return g&&(E.pixelsPerMeter[1]=-E.pixelsPerMeter[1],E.metersPerPixel[1]=-E.metersPerPixel[1],E.pixelsPerDegree[1]=-E.pixelsPerDegree[1],E.degreesPerPixel[1]=-E.degreesPerPixel[1]),E}var qu;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(qu||(qu={}));var $p={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Lh,f0,h0,jf,ec,p0=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Yd=(Lh=(0,vr.b2)(),f0=(0,vr.f3)(At.ICameraService),Lh(h0=(jf=function(){function e(){(0,xt.Z)(this,e),(0,ee.Z)(this,"needRefresh",!0),(0,da.Z)(this,"cameraService",ec,this),(0,ee.Z)(this,"coordinateSystem",void 0),(0,ee.Z)(this,"viewportCenter",void 0),(0,ee.Z)(this,"viewportCenterProjection",void 0),(0,ee.Z)(this,"pixelsPerDegree",void 0),(0,ee.Z)(this,"pixelsPerDegree2",void 0),(0,ee.Z)(this,"pixelsPerMeter",void 0)}return(0,St.Z)(e,[{key:"refresh",value:function(t){var i=this.cameraService.getZoom(),r=this.cameraService.getZoomScale(),o=t||this.cameraService.getCenter(),u=ps({latitude:o[1],zoom:i}),p=u.pixelsPerMeter,v=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=p,this.pixelsPerDegree=v,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===qu.LNGLAT||this.coordinateSystem===qu.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===qu.LNGLAT_OFFSET?this.calculateLnglatOffset(o,i):this.coordinateSystem===qu.P20_OFFSET&&this.calculateLnglatOffset(o,i,r,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,i,r,o){var u=ps({latitude:t[1],zoom:i,scale:r,flipY:o,highPrecision:!0}),p=u.pixelsPerMeter,v=u.pixelsPerDegree,g=u.pixelsPerDegree2,E=this.cameraService.getViewMatrix(),T=this.cameraService.getProjectionMatrix(),O=Ra.multiply([],T,E),F=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,i));this.viewportCenterProjection=cp.fF([],[F[0],F[1],0,1],O),E=this.cameraService.getViewMatrixUncentered()||E,O=Ra.multiply([],T,E),O=Ra.multiply([],O,p0),this.cameraService.setViewProjectionMatrix(O),this.pixelsPerMeter=p,this.pixelsPerDegree=v,this.pixelsPerDegree2=g}}]),e}(),ec=(0,ca.Z)(jf.prototype,"cameraService",[f0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jf))||h0),d0=vt(20396),hp=vt.n(d0),Uu;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(Uu||(Uu={}));var B0,Td,Kp,Md,qd;function Dl(e){var a=N0();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function N0(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var bc={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},v0=(B0=(0,vr.b2)(),Td=(0,vr.f3)(At.IMapService),B0(Kp=(Md=function(e){(0,mr.Z)(t,e);var a=Dl(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"indragging",!1),(0,da.Z)((0,dt.Z)(i),"mapService",qd,(0,dt.Z)(i)),(0,ee.Z)((0,dt.Z)(i),"hammertime",void 0),(0,ee.Z)((0,dt.Z)(i),"lastClickTime",0),(0,ee.Z)((0,dt.Z)(i),"lastClickXY",[-1,-1]),(0,ee.Z)((0,dt.Z)(i),"clickTimer",void 0),(0,ee.Z)((0,dt.Z)(i),"$containter",void 0),(0,ee.Z)((0,dt.Z)(i),"onDrag",function(p){var v=i.interactionEvent(p);v.type=bc[v.type],v.type==="dragging"?i.indragging=!0:i.indragging=!1,i.emit(Uu.Drag,v)}),(0,ee.Z)((0,dt.Z)(i),"onHammer",function(p){p.srcEvent.stopPropagation();var v=i.interactionEvent(p);i.emit(Uu.Hover,v)}),(0,ee.Z)((0,dt.Z)(i),"onTouch",function(p){var v=p.touches[0];i.onHover({x:v.pageX,y:v.pageY,type:"touch"})}),(0,ee.Z)((0,dt.Z)(i),"onHover",function(p){var v=p.clientX,g=p.clientY,E=v,T=g,O=p.type,F=i.mapService.getMapContainer();if(F)if(Ts)E=E-F.left-0,T=T-F.top-0;else{var U=F.getBoundingClientRect(),j=U.top,K=U.left;E=E-K-F.clientLeft,T=T-j-F.clientTop}var ae=i.mapService.containerToLngLat([E,T]);if(O==="click"){if(!Ts&&"ontouchstart"in document.documentElement)return;i.isDoubleTap(E,T,ae);return}if(O==="touch"){i.isDoubleTap(E,T,ae);return}O!=="click"&&O!=="dblclick"&&i.emit(Uu.Hover,{x:E,y:T,lngLat:ae,type:O,target:p})}),i}return(0,St.Z)(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Uu.Hover)}},{key:"triggerHover",value:function(r){var o=r.x,u=r.y;this.emit(Uu.Hover,{x:o,y:u})}},{key:"triggerSelect",value:function(r){this.emit(Uu.Select,{featureId:r})}},{key:"triggerActive",value:function(r){this.emit(Uu.Active,{featureId:r})}},{key:"handleMiniEvent",value:function(r){this.onHover({clientX:r.touches[0].pageX,clientY:r.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var r=this.mapService.getMapContainer();if(r)if(Ts)Ia.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var o=new(hp()).Manager(r);o.add(new(hp()).Tap({event:"dblclick",taps:2})),o.add(new(hp()).Tap({event:"click"})),o.add(new(hp()).Pan({threshold:0,pointers:0})),o.add(new(hp()).Press({})),o.on("dblclick click",this.onHammer),o.on("panstart panmove panend pancancel",this.onDrag),r.addEventListener("mousemove",this.onHover),r.addEventListener("mousedown",this.onHover,!0),r.addEventListener("mouseup",this.onHover),r.addEventListener("contextmenu",this.onHover),this.hammertime=o}}},{key:"removeEventListenerOnMap",value:function(){if(Ts)Ia.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var r=this.mapService.getMapContainer();r&&(r.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),r.removeEventListener("mousedown",this.onHover),r.removeEventListener("mouseup",this.onHover),r.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(r){var o=r.type,u=r.pointerType,p,v;u==="touch"?(v=Math.floor(r.pointers[0].clientY),p=Math.floor(r.pointers[0].clientX)):(v=Math.floor(r.srcEvent.y),p=Math.floor(r.srcEvent.x));var g=this.mapService.getMapContainer();if(g){var E=g.getBoundingClientRect(),T=E.top,O=E.left;p-=O,v-=T}var F=this.mapService.containerToLngLat([p,v]);return{x:p,y:v,lngLat:F,type:o,target:r.srcEvent}}},{key:"isDoubleTap",value:function(r,o,u){var p=this,v=new Date().getTime(),g="click";v-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-r)<10&&Math.abs(this.lastClickXY[1]-o)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),g="dblclick",this.emit(Uu.Hover,{x:r,y:o,lngLat:u,type:g})):(this.lastClickTime=v,this.lastClickXY=[r,o],this.clickTimer=setTimeout(function(){g="click",p.emit(Uu.Hover,{x:r,y:o,lngLat:u,type:g})},400))}}]),t}(Sh()),qd=(0,ca.Z)(Md.prototype,"mapService",[Td],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Md))||Kp),cv=0;function pf(e){if(Ts)return null;var a=e;if(typeof e=="string"&&(a=document.getElementById(e)),a){var t=document.createElement("div");return t.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,t.id="l7-scene-".concat(cv++),t.classList.add("l7-scene"),a.appendChild(t),t}return null}function Vc(e){var a,t,i=!0;return e==null||(a=e.target)===null||a===void 0||(t=a.path)===null||t===void 0||t.map(function(r){if(r!=null&&r.classList){var o;r==null||(o=r.classList)===null||o===void 0||o.forEach(function(u){(u==="l7-marker"||u==="l7-popup")&&(i=!1)})}}),i}var X;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(X||(X={}));var Rh,pp,Oh,Qp,Jp,z0,U0,sh,m0,g0,jc,uh,Z0,y0=(Rh=(0,vr.b2)(),pp=(0,vr.f3)(At.IMapService),Oh=(0,vr.f3)(At.IRendererService),Qp=(0,vr.f3)(At.IGlobalConfigService),Jp=(0,vr.f3)(At.IInteractionService),z0=(0,vr.f3)(At.ILayerService),Rh(U0=(sh=function(){function e(){var a=this;(0,xt.Z)(this,e),(0,ee.Z)(this,"pickedColors",void 0),(0,ee.Z)(this,"pickedTileLayers",[]),(0,da.Z)(this,"mapService",m0,this),(0,da.Z)(this,"rendererService",g0,this),(0,da.Z)(this,"configService",jc,this),(0,da.Z)(this,"interactionService",uh,this),(0,da.Z)(this,"layerService",Z0,this),(0,ee.Z)(this,"pickingFBO",void 0),(0,ee.Z)(this,"width",0),(0,ee.Z)(this,"height",0),(0,ee.Z)(this,"alreadyInPicking",!1),(0,ee.Z)(this,"pickBufferScale",1),(0,ee.Z)(this,"pickedLayers",[]),(0,ee.Z)(this,"pickFromPickingFBO",function(t,i){var r=i.x,o=i.y,u=i.lngLat,p=i.type,v=i.target,g=!1,E=a.rendererService,T=E.readPixels,O=E.getContainer,F=a.getContainerSize(O()),U=F.width,j=F.height;U*=tn,j*=tn;var K=t.getLayerConfig(),ae=K.enableHighlight,ve=K.enableSelect,ke=r*tn,qe=o*tn;if(ke>U-1*tn||ke<0||qe>j-1*tn||qe<0)return!1;var ct=T({x:Math.floor(ke/a.pickBufferScale),y:Math.floor((j-(o+1)*tn)/a.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:a.pickingFBO});if(a.pickedColors=ct,ct[0]!==0||ct[1]!==0||ct[2]!==0){var _t=k(ct),Ot=t.getSource().getFeatureById(_t);_t!==t.getCurrentPickId()&&p==="mousemove"&&(p="mouseenter");var Xt={x:r,y:o,type:p,lngLat:u,featureId:_t,feature:Ot,target:v};Ot&&(g=!0,t.setCurrentPickId(_t),a.pickedLayers=[t],a.triggerHoverOnLayer(t,Xt))}else{var yr={x:r,y:o,lngLat:u,type:t.getCurrentPickId()!==null&&p==="mousemove"?"mouseout":"un"+p,featureId:null,target:v,feature:null};a.triggerHoverOnLayer(t,(0,Z.Z)((0,Z.Z)({},yr),{},{type:"unpick"})),a.triggerHoverOnLayer(t,yr),t.setCurrentPickId(null),a.pickedLayers=[]}if(ae&&a.highlightPickedFeature(t,ct),ve&&p==="click"&&(ct==null?void 0:ct.toString())!==[0,0,0,0].toString()){var Pr=k(ct);t.getCurrentSelectedId()===null||Pr!==t.getCurrentSelectedId()?(a.selectFeature(t,ct),t.setCurrentSelectedId(Pr)):(a.selectFeature(t,new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null)),t.isVector||a.layerService.getLayers().filter(function(xr){return xr.tileLayer}).map(function(xr){xr.tileLayer.clearPickState()})}return g})}return(0,St.Z)(e,[{key:"init",value:function(t){var i=this.rendererService,r=i.createTexture2D,o=i.createFramebuffer,u=i.getContainer,p=this.getContainerSize(u()),v=p.width,g=p.height;v*=tn,g*=tn,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=o({color:r({width:Math.round(v/this.pickBufferScale),height:Math.round(g/this.pickBufferScale),wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})}),this.interactionService.on(Uu.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var a=(0,Sa.Z)(zn().mark(function i(r,o,u){var p=this,v,g,E,T;return zn().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:v=this.rendererService,g=v.useFramebuffer,E=v.clear,T=v.getContainer,this.resizePickingFBO(),g(this.pickingFBO,function(){E({framebuffer:p.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),r.hooks.beforePickingEncode.call(),r.renderModels(),r.hooks.afterPickingEncode.call();var U=p.pickBox(r,o);u(U)});case 3:case"end":return F.stop()}},i,this)}));function t(i,r,o){return a.apply(this,arguments)}return t}()},{key:"pickBox",value:function(t,i){var r=this,o=i.map(function(Pr){var xr=Pr<0?0:Pr;return Math.floor(xr*tn/r.pickBufferScale)}),u=(0,pr.Z)(o,4),p=u[0],v=u[1],g=u[2],E=u[3],T=this.rendererService,O=T.readPixels,F=T.getContainer,U=this.getContainerSize(F()),j=U.width,K=U.height;if(j*=tn,K*=tn,p>(j-1)*tn/this.pickBufferScale||g<0||v>(K-1)*tn/this.pickBufferScale||E<0)return[];for(var ae=Math.min(j/this.pickBufferScale,g)-p,ve=Math.min(K/this.pickBufferScale,E)-v,ke=O({x:p,y:Math.floor(K/this.pickBufferScale-(E+1)),width:ae,height:ve,data:new Uint8Array(ae*ve*4),framebuffer:this.pickingFBO}),qe=[],ct={},_t=0;_t<ke.length/4;_t=_t+1){var Ot=ke.slice(_t*4,_t*4+4),Xt=k(Ot);if(Xt!==-1&&!ct[Xt]){var yr=t.getSource().getFeatureById(Xt);qe.push((0,Z.Z)((0,Z.Z)({},yr),{},{pickedFeatureIdx:Xt})),ct[Xt]=!0}}return qe}},{key:"handleCursor",value:function(t,i){var r=t.getLayerConfig(),o=r.cursor,u=o===void 0?"":o,p=r.cursorEnabled;if(p){var v=this.mapService.version,g=v==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),E=g==null?void 0:g.style.getPropertyValue("cursor");i==="unmousemove"&&E!==""?g==null||g.style.setProperty("cursor",""):i==="mousemove"&&(g==null||g.style.setProperty("cursor",u))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/tn,height:t.height/tn}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var a=(0,Sa.Z)(zn().mark(function i(r){return zn().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){u.next=2;break}return u.abrupt("return");case 2:return this.alreadyInPicking=!0,u.next=5,this.pickingLayers(r);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return u.stop()}},i,this)}));function t(i){return a.apply(this,arguments)}return t}()},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,i=this.getContainerSize(t()),r=i.width,o=i.height;r*=tn,o*=tn,(this.width!==r||this.height!==o)&&(this.pickingFBO.resize({width:Math.round(r/this.pickBufferScale),height:Math.round(o/this.pickBufferScale)}),this.width=r,this.height=o)}},{key:"pickingLayers",value:function(){var a=(0,Sa.Z)(zn().mark(function i(r){var o=this,u,p,v,g,E;return zn().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:u=this.rendererService,p=u.getViewportSize,v=u.useFramebuffer,g=u.clear,E=u.getContainer,this.resizePickingFBO(),v(this.pickingFBO,function(){var F=o.layerService.getRenderList();F.filter(function(U){return U.needPick(r.type)}).reverse().some(function(U){if(g({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.pickedLayers.filter(function(K){return!K.isVector}).map(function(K){o.selectFeature(K,new Uint8Array([0,0,0,0]))}),o.pickedTileLayers.map(function(K){var ae;return(ae=K.tileLayer)===null||ae===void 0?void 0:ae.clearPick(r.type)}),U.tileLayer)return U.tileLayer.pickLayers(r);U.hooks.beforePickingEncode.call(),U.masks.length>0&&U.masks.map(function(K){K.hooks.beforeRenderData.call(),K.hooks.beforeRender.call(),K.render(),K.hooks.afterRender.call()}),U.renderModels(!0),U.hooks.afterPickingEncode.call();var j=o.pickFromPickingFBO(U,r);return o.layerService.pickedLayerId=j?+U.id:-1,j&&!U.getLayerConfig().enablePropagation})});case 3:case"end":return O.stop()}},i,this)}));function t(i){return a.apply(this,arguments)}return t}()},{key:"triggerHoverOnLayer",value:function(t,i){Vc(i)&&(this.handleCursor(t,i.type),t.emit(i.type,i))}},{key:"highlightPickedFeature",value:function(t,i){var r=(0,pr.Z)(i,3),o=r[0],u=r[1],p=r[2];t.hooks.beforeHighlight.call([o,u,p])}},{key:"selectFeature",value:function(t,i){var r=(0,pr.Z)(i,3),o=r[0],u=r[1],p=r[2];t.hooks.beforeSelect.call([o,u,p])}}]),e}(),m0=(0,ca.Z)(sh.prototype,"mapService",[pp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g0=(0,ca.Z)(sh.prototype,"rendererService",[Oh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jc=(0,ca.Z)(sh.prototype,"configService",[Qp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uh=(0,ca.Z)(sh.prototype,"interactionService",[Jp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z0=(0,ca.Z)(sh.prototype,"layerService",[z0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sh))||U0),$d=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,xt.Z)(this,e),(0,ee.Z)(this,"autoStart",void 0),(0,ee.Z)(this,"startTime",0),(0,ee.Z)(this,"oldTime",0),(0,ee.Z)(this,"running",!1),(0,ee.Z)(this,"elapsedTime",0),this.autoStart=a}return(0,St.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance>"u"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var i=(typeof performance>"u"?Date:performance).now();t=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=t}return t}}]),e}(),V0,_0,Kd,Qd,kd,dp,vp,j0,mp;function fv(e,a){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=gp(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function gp(e,a){if(!!e){if(typeof e=="string")return Id(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Id(e,a)}}function Id(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var Wv=(V0=(0,vr.b2)(),_0=(0,vr.f3)(At.IRendererService),Kd=(0,vr.f3)(At.IMapService),Qd=(0,vr.f3)(At.IGlobalConfigService),V0(kd=(dp=function(){function e(){(0,xt.Z)(this,e),(0,ee.Z)(this,"pickedLayerId",-1),(0,ee.Z)(this,"clock",new $d),(0,ee.Z)(this,"alreadyInRendering",!1),(0,ee.Z)(this,"layers",[]),(0,ee.Z)(this,"layerList",[]),(0,ee.Z)(this,"layerRenderID",void 0),(0,ee.Z)(this,"sceneInited",!1),(0,ee.Z)(this,"animateInstanceCount",0),(0,ee.Z)(this,"shaderPicking",!0),(0,ee.Z)(this,"enableRender",!0),(0,da.Z)(this,"renderService",vp,this),(0,da.Z)(this,"mapService",j0,this),(0,da.Z)(this,"configService",mp,this)}return(0,St.Z)(e,[{key:"add",value:function(t){this.sceneInited&&t.init(),this.layers.push(t),this.updateLayerRenderList()}},{key:"addMask",value:function(t){this.sceneInited&&t.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(t){t.inited||t.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find(function(i){return i.id===t})}},{key:"getLayerByName",value:function(t){return this.layers.find(function(i){return i.name===t})}},{key:"cleanRemove",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this.layers.indexOf(t);r>-1&&this.layers.splice(r,1),i&&(this.updateLayerRenderList(),this.renderLayers())}},{key:"remove",value:function(t,i){if(i){var r=i.layerChildren.indexOf(t);r>-1&&i.layerChildren.splice(r,1)}else{var o=this.layers.indexOf(t);o>-1&&this.layers.splice(o,1)}this.updateLayerRenderList(),t.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:function(){var a=(0,Sa.Z)(zn().mark(function i(){var r,o,u;return zn().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){v.next=2;break}return v.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),r=fv(this.layerList),v.prev=5,r.s();case 7:if((o=r.n()).done){v.next=21;break}if(u=o.value,u.hooks.beforeRenderData.call(),u.hooks.beforeRender.call(),u.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),u.masks.map(function(g){g.hooks.beforeRenderData.call(),g.hooks.beforeRender.call(),g.render(),g.hooks.afterRender.call()})),!u.getLayerConfig().enableMultiPassRenderer){v.next=17;break}return v.next=15,u.renderMultiPass();case 15:v.next=18;break;case 17:u.render();case 18:u.hooks.afterRender.call();case 19:v.next=7;break;case 21:v.next=26;break;case 23:v.prev=23,v.t0=v.catch(5),r.e(v.t0);case 26:return v.prev=26,r.f(),v.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return v.stop()}},i,this,[[5,23,26,29]])}));function t(){return a.apply(this,arguments)}return t}()},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter(function(i){return i.inited}).filter(function(i){return i.isVisible()}).sort(function(i,r){return i.zIndex-r.zIndex}).forEach(function(i){t.layerList.push(i)})}},{key:"destroy",value:function(){this.layers.forEach(function(t){t.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++===0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount===0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var t=S(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=Ia.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){Ia.cancelAnimationFrame(this.layerRenderID)}}]),e}(),vp=(0,ca.Z)(dp.prototype,"renderService",[_0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j0=(0,ca.Z)(dp.prototype,"mapService",[Kd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mp=(0,ca.Z)(dp.prototype,"configService",[Qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dp))||kd),yp=vt(44925),Xv=function(){function e(a){var t=this;(0,xt.Z)(this,e),(0,ee.Z)(this,"name",void 0),(0,ee.Z)(this,"type",void 0),(0,ee.Z)(this,"scale",void 0),(0,ee.Z)(this,"descriptor",void 0),(0,ee.Z)(this,"featureBufferLayout",[]),(0,ee.Z)(this,"needRescale",!1),(0,ee.Z)(this,"needRemapping",!1),(0,ee.Z)(this,"needRegenerateVertices",!1),(0,ee.Z)(this,"featureRange",{startIndex:0,endIndex:1/0}),(0,ee.Z)(this,"vertexAttribute",void 0),(0,ee.Z)(this,"defaultCallback",function(i){if(i.length===0){var r;return((r=t.scale)===null||r===void 0?void 0:r.defaultValues)||[]}return i.map(function(o,u){var p,v=(p=t.scale)===null||p===void 0?void 0:p.scalers[u].func,g=v(o);return g})}),this.setProps(a)}return(0,St.Z)(e,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var i;if((i=this.scale)!==null&&i!==void 0&&i.callback){var r,o=(r=this.scale)===null||r===void 0?void 0:r.callback.apply(r,(0,Ee.Z)(t));if(!(0,Br.isNil)(o))return[o]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Yv=["modelType"],qv=["buffer","update","name"],$v=["buffer","update","name"],Kv=["buffer","update","name"],Bl,Jd,_p,Pd,Cs,G0;function Bg(e){return new Promise(function(a){return setTimeout(a,e)})}var hv=(Bl={},(0,ee.Z)(Bl,X.FLOAT,4),(0,ee.Z)(Bl,X.UNSIGNED_BYTE,1),(0,ee.Z)(Bl,X.UNSIGNED_SHORT,2),Bl),pv=(Jd=(0,vr.b2)(),_p=(0,vr.f3)(At.IRendererService),Jd(Pd=(Cs=function(){function e(){(0,xt.Z)(this,e),(0,ee.Z)(this,"attributesAndIndices",void 0),(0,da.Z)(this,"rendererService",G0,this),(0,ee.Z)(this,"attributes",[]),(0,ee.Z)(this,"triangulation",void 0),(0,ee.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,St.Z)(e,[{key:"registerStyleAttribute",value:function(t){var i=this.getLayerStyleAttribute(t.name||"");return i?i.setProps(t):(i=new Xv(t),this.attributes.push(i)),i}},{key:"updateStyleAttribute",value:function(t,i,r){var o=this.getLayerStyleAttribute(t);o||(o=this.registerStyleAttribute((0,Z.Z)((0,Z.Z)({},i),{},{name:t})));var u=i.scale;u&&o&&(o.scale=u,o.needRescale=!0,o.needRemapping=!0,o.needRegenerateVertices=!0,r&&r.featureRange&&(o.featureRange=r.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(i){return i.name===t})}},{key:"getLayerAttributeScale",value:function(t){var i,r=this.getLayerStyleAttribute(t),o=r==null||(i=r.scale)===null||i===void 0?void 0:i.scalers;return o&&o[0]?o[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,u=this.attributes.find(function(qe){return qe.name===t});if(u&&u.descriptor){var p=u.descriptor,v=p.update,g=p.buffer,E=p.size,T=E===void 0?0:E,O=hv[g.type||X.FLOAT];if(v){var F=this.featureLayout,U=F.elements,j=F.sizePerElement,K=U.slice(r,o);if(!K.length)return;var ae=K[0].offset,ve=ae*T*O,ke=K.map(function(qe,ct){for(var _t=qe.featureIdx,Ot=qe.vertices,Xt=qe.normals,yr=Ot.length/j,Pr=[],xr=0;xr<yr;xr++){var An=Xt?Xt.slice(xr*3,xr*3+3):[];Pr.push.apply(Pr,(0,Ee.Z)(v(i[_t],_t,Ot.slice(xr*j,xr*j+j),ct,An)))}return Pr}).reduce(function(qe,ct){return qe.push.apply(qe,(0,Ee.Z)(ct)),qe},[]);u.vertexAttribute.updateBuffer({data:ke,offset:ve})}}}},{key:"createAttributesAndIndicesAscy",value:function(t,i,r){var o=this;this.featureLayout={sizePerElement:0,elements:[]};var u=this.attributes.map(function(U){return U.resetDescriptor(),U.descriptor}).filter(function(U){return U}),p=r.modelType,v=(0,yp.Z)(r,Yv),g=this.rendererService,E=g.createAttribute,T=g.createBuffer,O=g.createElements,F={};return new Promise(function(U,j){yc(p,(0,Z.Z)({descriptors:o.getDescriptorsWithOutFunc(u),features:t,segmentNumber:i},v)).then(function(K){K.descriptors.forEach(function(ve,ke){if(ve){var qe=ve.buffer,ct=ve.update,_t=ve.name,Ot=(0,yp.Z)(ve,qv),Xt=E((0,Z.Z)({buffer:T(qe)},Ot));F[ve.name||""]=Xt,o.attributes[ke].vertexAttribute=Xt}}),o.featureLayout=K.featureLayout;var ae=O({data:K.indices,type:X.UNSIGNED_INT,count:K.indices.length});o.attributesAndIndices={attributes:F,elements:ae,count:null},U(o.attributesAndIndices)}).catch(function(K){console.warn(K),j(K)})})}},{key:"createAttributesAndIndices",value:function(t,i,r){var o=this;this.featureLayout={sizePerElement:0,elements:[]},i&&(this.triangulation=i);var u=this.attributes.map(function(ke){return ke.resetDescriptor(),ke.descriptor}),p=0,v=0,g=[],E=[],T=[],O=3;t.forEach(function(ke,qe){var ct=o.triangulation(ke,r),_t=ct.indices,Ot=ct.vertices,Xt=ct.normals,yr=ct.size,Pr=ct.indexes,xr=ct.count;typeof xr=="number"&&(v+=xr),_t.forEach(function(Io){E.push(Io+p)}),O=yr;var An=Ot.length/yr;o.featureLayout.sizePerElement=O,o.featureLayout.elements.push({featureIdx:qe,vertices:Ot,normals:Xt,offset:p}),p+=An;for(var ii=function(_o){var Gu=(Xt==null?void 0:Xt.slice(_o*3,_o*3+3))||[],ml=Ot.slice(_o*yr,_o*yr+yr),Ju=0;Pr&&Pr[_o]!==void 0&&(Ju=Pr[_o]),u.forEach(function(mf,L0){if(mf&&mf.update){var R0;(R0=mf.buffer.data).push.apply(R0,(0,Ee.Z)(mf.update(ke,qe,ml,_o,Gu,Ju)))}})},sa=0;sa<An;sa++)ii(sa)});var F=this.rendererService,U=F.createAttribute,j=F.createBuffer,K=F.createElements,ae={};u.forEach(function(ke,qe){if(ke){var ct=ke.buffer,_t=ke.update,Ot=ke.name,Xt=(0,yp.Z)(ke,$v),yr=U((0,Z.Z)({buffer:j(ct)},Xt));ae[ke.name||""]=yr,o.attributes[qe].vertexAttribute=yr}});var ve=K({data:E,type:X.UNSIGNED_INT,count:E.length});return this.attributesAndIndices={attributes:ae,elements:ve,count:v},this.attributesAndIndices}},{key:"createAttributes",value:function(t,i){var r=this;this.featureLayout={sizePerElement:0,elements:[]},i&&(this.triangulation=i);var o=this.attributes.map(function(F){return F.resetDescriptor(),F.descriptor}),u=0,p=[],v=3;t.forEach(function(F,U){var j=r.triangulation(F),K=j.indices,ae=j.vertices,ve=j.normals,ke=j.size,qe=j.indexes;K.forEach(function(Xt){p.push(Xt+u)}),v=ke;var ct=ae.length/ke;r.featureLayout.sizePerElement=v,r.featureLayout.elements.push({featureIdx:U,vertices:ae,normals:ve,offset:u}),u+=ct;for(var _t=function(yr){var Pr=(ve==null?void 0:ve.slice(yr*3,yr*3+3))||[],xr=ae.slice(yr*ke,yr*ke+ke),An=0;qe&&qe[yr]!==void 0&&(An=qe[yr]),o.forEach(function(ii,sa){if(ii&&ii.update){var Io;(Io=ii.buffer.data).push.apply(Io,(0,Ee.Z)(ii.update(F,U,xr,yr,Pr,An)))}})},Ot=0;Ot<ct;Ot++)_t(Ot)});var g=this.rendererService,E=g.createAttribute,T=g.createBuffer,O={};return o.forEach(function(F,U){if(F){var j=F.buffer,K=F.update,ae=F.name,ve=(0,yp.Z)(F,Kv),ke=E((0,Z.Z)({buffer:T(j)},ve));O[F.name||""]=ke,r.attributes[U].vertexAttribute=ke}}),{attributes:O}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(i){i.vertexAttribute&&i.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}},{key:"getDescriptorsWithOutFunc",value:function(t){return t.map(function(i){return{buffer:i.buffer,name:i.name,size:i.size}})}}]),e}(),G0=(0,ca.Z)(Cs.prototype,"rendererService",[_p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cs))||Pd),x0=vt(67709),Fm=vt.n(x0),Qv,b0,dv,vv,Jv,em,H0,Dm,Bm,mv,Nm,zm,Um,Zm,Vm,ed,gv,tc,jm,W0,Gm,Hm,X0,e0,tm,yv,Wm,Xm,rm,nm,_v,im,E0;function C0(e){var a=S0();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function S0(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var am=(Qv=(0,vr.b2)(),b0=(0,vr.f3)(At.SceneID),dv=(0,vr.f3)(At.IIconService),vv=(0,vr.f3)(At.IFontService),Jv=(0,vr.f3)(At.IControlService),em=(0,vr.f3)(At.IGlobalConfigService),H0=(0,vr.f3)(At.IMapService),Dm=(0,vr.f3)(At.ICoordinateSystemService),Bm=(0,vr.f3)(At.IRendererService),mv=(0,vr.f3)(At.ILayerService),Nm=(0,vr.f3)(At.ICameraService),zm=(0,vr.f3)(At.IInteractionService),Um=(0,vr.f3)(At.IPickingService),Zm=(0,vr.f3)(At.IShaderModuleService),Vm=(0,vr.f3)(At.IMarkerService),ed=(0,vr.f3)(At.IPopupService),Qv(gv=(tc=function(e){(0,mr.Z)(t,e);var a=C0(t);function t(){var i;return(0,xt.Z)(this,t),i=a.call(this),(0,ee.Z)((0,dt.Z)(i),"destroyed",!1),(0,ee.Z)((0,dt.Z)(i),"loaded",!1),(0,ee.Z)((0,dt.Z)(i),"loadFont",!1),(0,ee.Z)((0,dt.Z)(i),"fontFamily",""),(0,da.Z)((0,dt.Z)(i),"id",jm,(0,dt.Z)(i)),(0,da.Z)((0,dt.Z)(i),"iconService",W0,(0,dt.Z)(i)),(0,da.Z)((0,dt.Z)(i),"fontService",Gm,(0,dt.Z)(i)),(0,da.Z)((0,dt.Z)(i),"controlService",Hm,(0,dt.Z)(i)),(0,da.Z)((0,dt.Z)(i),"configService",X0,(0,dt.Z)(i)),(0,da.Z)((0,dt.Z)(i),"map",e0,(0,dt.Z)(i)),(0,da.Z)((0,dt.Z)(i),"coordinateSystemService",tm,(0,dt.Z)(i)),(0,da.Z)((0,dt.Z)(i),"rendererService",yv,(0,dt.Z)(i)),(0,da.Z)((0,dt.Z)(i),"layerService",Wm,(0,dt.Z)(i)),(0,da.Z)((0,dt.Z)(i),"cameraService",Xm,(0,dt.Z)(i)),(0,da.Z)((0,dt.Z)(i),"interactionService",rm,(0,dt.Z)(i)),(0,da.Z)((0,dt.Z)(i),"pickingService",nm,(0,dt.Z)(i)),(0,da.Z)((0,dt.Z)(i),"shaderModuleService",_v,(0,dt.Z)(i)),(0,da.Z)((0,dt.Z)(i),"markerService",im,(0,dt.Z)(i)),(0,da.Z)((0,dt.Z)(i),"popupService",E0,(0,dt.Z)(i)),(0,ee.Z)((0,dt.Z)(i),"inited",!1),(0,ee.Z)((0,dt.Z)(i),"initPromise",void 0),(0,ee.Z)((0,dt.Z)(i),"rendering",!1),(0,ee.Z)((0,dt.Z)(i),"$container",void 0),(0,ee.Z)((0,dt.Z)(i),"canvas",void 0),(0,ee.Z)((0,dt.Z)(i),"markerContainer",void 0),(0,ee.Z)((0,dt.Z)(i),"hooks",void 0),(0,ee.Z)((0,dt.Z)(i),"handleWindowResized",function(){i.emit("resize"),i.$container&&(i.initContainer(),Sl(),i.coordinateSystemService.needRefresh=!0,i.render())}),(0,ee.Z)((0,dt.Z)(i),"handleMapCameraChanged",function(r){i.cameraService.update(r),i.render()}),i.hooks={init:new gd},i}return(0,St.Z)(t,[{key:"init",value:function(r){var o=this;this.configService.setSceneConfig(this.id,r),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Sa.Z)(zn().mark(function u(){return zn().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,new Promise(function(g){o.map.onCameraChanged(function(E){o.cameraService.init(),o.cameraService.update(E),o.map.version!=="GAODE2.x"&&g()}),o.map.version!=="GAODE2.x"?o.map.init():g()});case 2:if(!(o.map.version==="GAODE2.x"&&o.map.initViewPort)){v.next=6;break}return v.next=5,o.map.init();case 5:o.map.initViewPort();case 6:o.map.onCameraChanged(o.handleMapCameraChanged),o.map.addMarkerContainer(),o.markerService.addMarkers(),o.markerService.addMarkerLayers(),o.popupService.initPopup(),o.interactionService.init(),o.interactionService.on(Uu.Drag,o.addSceneEvent.bind(o));case 13:case"end":return v.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,Sa.Z)(zn().mark(function u(){var p,v;return zn().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(p=pf(o.configService.getSceneConfig(o.id).id||""),o.$container=p,!p){E.next=12;break}return o.canvas=ka("canvas","",p),o.setCanvas(),E.next=7,o.rendererService.init(o.canvas,o.configService.getSceneConfig(o.id),r.gl);case 7:o.initContainer(),Fm()(o.$container,o.handleWindowResized),Ia.matchMedia&&((v=Ia.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||v===void 0||v.addListener(o.handleWindowResized)),E.next=13;break;case 12:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 13:o.pickingService.init(o.id);case 14:case"end":return E.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(r){var o=this;this.configService.setSceneConfig(this.id,r),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Sa.Z)(zn().mark(function u(){return zn().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,new Promise(function(g){o.map.onCameraChanged(function(E){o.cameraService.init(),o.cameraService.update(E),o.map.version!=="GAODE2.x"&&g()}),o.map.initMiniMap()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.interactionService.init(),o.interactionService.on(Uu.Drag,o.addSceneEvent.bind(o));case 5:case"end":return v.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,Sa.Z)(zn().mark(function u(){var p;return zn().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(p=r.canvas,o.$container=p||null,!o.$container){g.next=7;break}return g.next=5,o.rendererService.init(r.canvas,o.configService.getSceneConfig(o.id),void 0);case 5:g.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:o.pickingService.init(o.id);case 9:case"end":return g.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(r){this.layerService.sceneService=this,this.layerService.add(r)}},{key:"addMask",value:function(r){this.layerService.sceneService=this,this.layerService.addMask(r)}},{key:"render",value:function(){var i=(0,Sa.Z)(zn().mark(function o(){return zn().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(!(this.rendering||this.destroyed)){p.next=2;break}return p.abrupt("return");case 2:if(this.rendering=!0,this.inited){p.next=23;break}return p.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){p.next=18;break}return p.prev=8,p.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:p.next=18;break;case 13:p.prev=13,p.t0=p.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(p.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return p.stop()}},o,this,[[8,13]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"addFontFace",value:function(r,o){this.fontFamily=r;var u=document.createElement("style");u.type="text/css",u.innerText=`
        @font-face{
            font-family: '`.concat(r,`';
            src: url('`).concat(o,`') format('woff2'),
            url('`).concat(o,`') format('woff'),
            url('`).concat(o,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(u),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(r){var o,u=(o=this.$container)===null||o===void 0?void 0:o.getElementsByTagName("canvas")[0];this.render();var p=r==="jpg"?u==null?void 0:u.toDataURL("image/jpeg"):u==null?void 0:u.toDataURL("image/png");return p}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var r=this.$container.parentElement;r!==null&&(this.markerContainer=ka("div","l7-marker-container",r))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var r=this,o,u;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var v;(v=r.$container)===null||v===void 0||v.removeChild(r.canvas),r.canvas=null,r.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(o=this.$container)===null||o===void 0||(u=o.parentNode)===null||u===void 0||u.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,x0.unbind)(this.$container,this.handleWindowResized),Ia.matchMedia){var p;(p=Ia.matchMedia("screen and (min-resolution: 2dppx)"))===null||p===void 0||p.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var r,o,u=tn,p=((r=this.$container)===null||r===void 0?void 0:r.clientWidth)||400,v=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,g=this.canvas;g&&(g.width=p*u,g.height=v*u),this.rendererService.viewport({x:0,y:0,width:u*p,height:u*v})}},{key:"setCanvas",value:function(){var r,o,u=tn,p=((r=this.$container)===null||r===void 0?void 0:r.clientWidth)||400,v=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,g=this.canvas;g.width=p*u,g.height=v*u,g.style.width="100%",g.style.height="100%"}},{key:"addSceneEvent",value:function(r){this.emit(r.type,r)}}]),t}(fl.EventEmitter),jm=(0,ca.Z)(tc.prototype,"id",[b0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W0=(0,ca.Z)(tc.prototype,"iconService",[dv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gm=(0,ca.Z)(tc.prototype,"fontService",[vv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hm=(0,ca.Z)(tc.prototype,"controlService",[Jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X0=(0,ca.Z)(tc.prototype,"configService",[em],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e0=(0,ca.Z)(tc.prototype,"map",[H0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tm=(0,ca.Z)(tc.prototype,"coordinateSystemService",[Dm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yv=(0,ca.Z)(tc.prototype,"rendererService",[Bm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wm=(0,ca.Z)(tc.prototype,"layerService",[mv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xm=(0,ca.Z)(tc.prototype,"cameraService",[Nm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rm=(0,ca.Z)(tc.prototype,"interactionService",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nm=(0,ca.Z)(tc.prototype,"pickingService",[Um],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_v=(0,ca.Z)(tc.prototype,"shaderModuleService",[Zm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),im=(0,ca.Z)(tc.prototype,"markerService",[Vm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E0=(0,ca.Z)(tc.prototype,"popupService",[ed],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tc))||gv);function Ym(e){var a=0;switch(e){case"vec2":case"ivec2":a=2;break;case"vec3":case"ivec3":a=3;break;case"vec4":case"ivec4":case"mat2":a=4;break;case"mat3":a=9;break;case"mat4":a=16;break;default:}return a}var Ng=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function xv(e){var a={};return e=e.replace(Ng,function(t,i,r){var o=r.split(":"),u=o[0].trim(),p="";switch(o.length>1&&(p=o[1].trim()),i){case"bool":p=p==="true";break;case"float":case"int":p=Number(p);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":p?p=p.replace("[","").replace("]","").split(",").reduce(function(v,g){return v.push(Number(g.trim())),v},[]):p=new Array(Ym(i)).fill(0);break;default:}return a[u]=p,"uniform ".concat(i," ").concat(u,`;
`)}),{content:e,uniforms:a}}var td,om,qm="#define PI 3.14159265359",zg=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,$m=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Ug=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,Km=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,Zg=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Vg=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,sm=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,$u=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,um=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,Y0=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,xp=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,bv=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,q0=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,Ev=/precision\s+(high|low|medium)p\s+float/,jg=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,lm=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,Cv=(td=(0,vr.b2)(),td(om=function(){function e(){(0,xt.Z)(this,e),(0,ee.Z)(this,"moduleCache",{}),(0,ee.Z)(this,"rawContentCache",{})}return(0,St.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:qm,fs:qm}),this.registerModule("decode",{vs:zg,fs:""}),this.registerModule("projection",{vs:sm,fs:""}),this.registerModule("project",{vs:Vg,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:$u}),this.registerModule("lighting",{vs:Ug,fs:""}),this.registerModule("light",{vs:$m,fs:""}),this.registerModule("picking",{vs:Zg,fs:Km}),this.registerModule("styleMapping",{vs:um,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:q0,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:Y0,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:xp,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:bv,fs:""})}},{key:"registerModule",value:function(t,i){if(!this.rawContentCache[t]){var r=i.vs,o=i.fs,u=i.uniforms,p=xv(r),v=p.content,g=p.uniforms,E=xv(o),T=E.content,O=E.uniforms;this.rawContentCache[t]={fs:T,uniforms:(0,Z.Z)((0,Z.Z)((0,Z.Z)({},g),O),u),vs:v}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var i=this;if(this.moduleCache[t])return this.moduleCache[t];var r=this.rawContentCache[t].vs,o=this.rawContentCache[t].fs,u=this.processModule(r,[],"vs"),p=u.content,v=u.includeList,g=this.processModule(o,[],"fs"),E=g.content,T=g.includeList,O=E,F=(0,Br.uniq)(v.concat(T).concat(t)).reduce(function(U,j){return(0,Z.Z)((0,Z.Z)({},U),i.rawContentCache[j].uniforms)},{});return Ev.test(E)||(O=jg+E),this.moduleCache[t]={fs:O.trim(),uniforms:F,vs:p.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,i,r){var o=this,u=t.replace(lm,function(p,v){var g=v.split(" "),E=g[0].replace(/"/g,"");if(i.indexOf(E)>-1)return"";var T=o.rawContentCache[E][r];i.push(E);var O=o.processModule(T,i,r),F=O.content;return F});return{content:u,includeList:i}}}]),e}())||om);function Ku(e,a){for(;!Object.prototype.hasOwnProperty.call(e,a)&&(e=(0,nt.Z)(e),e!==null););return e}function df(){return typeof Reflect<"u"&&Reflect.get?df=Reflect.get.bind():df=function(a,t,i){var r=Ku(a,t);if(!!r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?a:i):o.value}},df.apply(this,arguments)}var Gf;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Gf||(Gf={}));var Sv,rd,nd=(Sv=(0,vr.b2)(),Sv(rd=function(){function e(){(0,xt.Z)(this,e),(0,ee.Z)(this,"shaderModuleService",void 0),(0,ee.Z)(this,"rendererService",void 0),(0,ee.Z)(this,"cameraService",void 0),(0,ee.Z)(this,"mapService",void 0),(0,ee.Z)(this,"interactionService",void 0),(0,ee.Z)(this,"layerService",void 0),(0,ee.Z)(this,"config",void 0)}return(0,St.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Gf.Normal}},{key:"init",value:function(t,i){this.config=i,this.rendererService=t.getContainer().get(At.IRendererService),this.cameraService=t.getContainer().get(At.ICameraService),this.mapService=t.getContainer().get(At.IMapService),this.interactionService=t.getContainer().get(At.IInteractionService),this.layerService=t.getContainer().get(At.ILayerService),this.shaderModuleService=t.getContainer().get(At.IShaderModuleService)}},{key:"render",value:function(t){}}]),e}())||rd),wv,Qm;function Gg(e){var a=Hg();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function Hg(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Wg=(wv=(0,vr.b2)(),wv(Qm=function(e){(0,mr.Z)(t,e);var a=Gg(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(r,o){df((0,nt.Z)(t.prototype),"init",this).call(this,r,o)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),t}(nd))||Qm),Jm,cm,fm,Av,hm;function y(e,a){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=w(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function w(e,a){if(!!e){if(typeof e=="string")return M(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return M(e,a)}}function M(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var R=(Jm=(0,vr.b2)(),cm=(0,vr.f3)(At.IPostProcessor),Jm(fm=(Av=function(){function e(){(0,xt.Z)(this,e),(0,ee.Z)(this,"passes",[]),(0,da.Z)(this,"postProcessor",hm,this),(0,ee.Z)(this,"layer",void 0),(0,ee.Z)(this,"renderFlag",void 0),(0,ee.Z)(this,"width",0),(0,ee.Z)(this,"height",0)}return(0,St.Z)(e,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var a=(0,Sa.Z)(zn().mark(function i(){var r,o,u;return zn().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:r=y(this.passes),v.prev=1,r.s();case 3:if((o=r.n()).done){v.next=9;break}return u=o.value,v.next=7,u.render(this.layer);case 7:v.next=3;break;case 9:v.next=14;break;case 11:v.prev=11,v.t0=v.catch(1),r.e(v.t0);case 14:return v.prev=14,r.f(),v.finish(14);case 17:return v.next=19,this.postProcessor.render(this.layer);case 19:case"end":return v.stop()}},i,this,[[1,11,14,17]])}));function t(){return a.apply(this,arguments)}return t}()},{key:"resize",value:function(t,i){(this.width!==t||this.height!==i)&&(this.postProcessor.resize(t,i),this.width=t,this.height=i)}},{key:"add",value:function(t,i){t.getType()===Gf.PostProcessing?this.postProcessor.add(t,this.layer,i):(t.init(this.layer,i),this.passes.push(t))}},{key:"insert",value:function(t,i,r){t.init(this.layer,i),this.passes.splice(r,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),hm=(0,ca.Z)(Av.prototype,"postProcessor",[cm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Av))||fm),B,Q;function ue(e){var a=oe();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function oe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ae=(B=(0,vr.b2)(),B(Q=function(e){(0,mr.Z)(t,e);var a=ue(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"pickingFBO",void 0),(0,ee.Z)((0,dt.Z)(i),"layer",void 0),(0,ee.Z)((0,dt.Z)(i),"width",0),(0,ee.Z)((0,dt.Z)(i),"height",0),(0,ee.Z)((0,dt.Z)(i),"alreadyInRendering",!1),(0,ee.Z)((0,dt.Z)(i),"pickFromPickingFBO",function(p){var v=p.x,g=p.y,E=p.lngLat,T=p.type;if(!(!i.layer.isVisible()||!i.layer.needPick(T))){var O=i.rendererService,F=O.getViewportSize,U=O.readPixels,j=O.useFramebuffer,K=F(),ae=K.width,ve=K.height,ke=i.layer.getLayerConfig(),qe=ke.enableHighlight,ct=ke.enableSelect,_t=v*tn,Ot=g*tn;if(!(_t>ae||_t<0||Ot>ve||Ot<0)){var Xt;j(i.pickingFBO,function(){var yr;if(Xt=U({x:Math.round(_t),y:Math.round(ve-(g+1)*tn),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),Xt[0]!==0||Xt[1]!==0||Xt[2]!==0){var Pr=k(Xt),xr=i.layer.getSource().getFeatureById(Pr),An={x:v,y:g,type:T,lngLat:E,featureId:Pr,feature:xr};xr&&(i.layer.setCurrentPickId(Pr),i.triggerHoverOnLayer(An))}else{var ii={x:v,y:g,lngLat:E,type:i.layer.getCurrentPickId()===null?"un"+T:"mouseout",featureId:null,feature:null};i.triggerHoverOnLayer((0,Z.Z)((0,Z.Z)({},ii),{},{type:"unpick"})),i.triggerHoverOnLayer(ii),i.layer.setCurrentPickId(null)}qe&&i.highlightPickedFeature(Xt),ct&&T==="click"&&((yr=Xt)===null||yr===void 0?void 0:yr.toString())!==[0,0,0,0].toString()&&i.selectFeature(Xt)})}}}),i}return(0,St.Z)(t,[{key:"getType",value:function(){return Gf.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(r,o){df((0,nt.Z)(t.prototype),"init",this).call(this,r,o),this.layer=r;var u=this.rendererService,p=u.createTexture2D,v=u.createFramebuffer,g=u.getViewportSize,E=g(),T=E.width,O=E.height;this.pickingFBO=v({color:p({width:T,height:O,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})}),this.interactionService.on(Uu.Hover,this.pickFromPickingFBO),this.interactionService.on(Uu.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Uu.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(r){var o=this;if(!this.alreadyInRendering){var u=this.rendererService,p=u.getViewportSize,v=u.useFramebuffer,g=u.clear,E=p(),T=E.width,O=E.height;this.alreadyInRendering=!0,(this.width!==T||this.height!==O)&&(this.pickingFBO.resize({width:T,height:O}),this.width=T,this.height=O),v(this.pickingFBO,function(){g({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var F=o.layer.multiPassRenderer.getRenderFlag();o.layer.multiPassRenderer.setRenderFlag(!1),r.hooks.beforePickingEncode.call(),r.render(),r.hooks.afterPickingEncode.call(),o.layer.multiPassRenderer.setRenderFlag(F),o.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(r){this.layer.emit(r.type,r)}},{key:"highlightPickedFeature",value:function(r){var o=(0,pr.Z)(r,3),u=o[0],p=o[1],v=o[2];this.layer.hooks.beforeHighlight.call([u,p,v]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(r){var o=(0,pr.Z)(r,3),u=o[0],p=o[1],v=o[2];this.layer.hooks.beforeSelect.call([u,p,v]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(r){var o=r.featureId,u=P(o);this.selectFeature(new Uint8Array(u))}},{key:"highlightFeatureHandle",value:function(r){var o=r.featureId,u=P(o);this.highlightPickedFeature(new Uint8Array(u))}}]),t}(nd))||Q),Oe,Le,Dt,tr,gr,Fr=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Qr=(Oe=(0,vr.b2)(),Le=(0,vr.f3)(At.IShaderModuleService),Oe(Dt=(tr=function(){function e(){(0,xt.Z)(this,e),(0,da.Z)(this,"shaderModuleService",gr,this),(0,ee.Z)(this,"rendererService",void 0),(0,ee.Z)(this,"config",void 0),(0,ee.Z)(this,"quad",Fr),(0,ee.Z)(this,"enabled",!0),(0,ee.Z)(this,"renderToScreen",!1),(0,ee.Z)(this,"model",void 0),(0,ee.Z)(this,"name",void 0),(0,ee.Z)(this,"optionsToUpdate",{})}return(0,St.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return Gf.PostProcessing}},{key:"init",value:function(t,i){this.config=i,this.rendererService=t.getContainer().get(At.IRendererService),this.shaderModuleService=t.getContainer().get(At.IShaderModuleService);var r=this.rendererService,o=r.createAttribute,u=r.createBuffer,p=r.createModel,v=this.setupShaders(),g=v.vs,E=v.fs,T=v.uniforms;this.model=p({vs:g,fs:E,attributes:{a_Position:o({buffer:u({data:[-4,-4,4,-4,0,4],type:X.FLOAT}),size:2})},uniforms:(0,Z.Z)((0,Z.Z)({u_Texture:null},T),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(t,i){var r=this,o=t.multiPassRenderer.getPostProcessor(),u=this.rendererService,p=u.useFramebuffer,v=u.getViewportSize,g=u.clear,E=v(),T=E.width,O=E.height;p(this.renderToScreen?null:o.getWriteFBO(),function(){g({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var F=(0,Z.Z)({u_BloomFinal:0,u_Texture:o.getReadFBO(),u_ViewportSize:[T,O]},r.convertOptionsToUniforms(r.optionsToUpdate));i&&(F.u_BloomFinal=1,F.u_Texture2=i),r.model.draw({uniforms:F})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=(0,Z.Z)((0,Z.Z)({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var i={};return Object.keys(t).forEach(function(r){(0,Br.isNil)(t[r])||(i["u_".concat((0,Br.upperFirst)((0,Br.camelCase)(r)))]=t[r])}),i}}]),e}(),gr=(0,ca.Z)(tr.prototype,"shaderModuleService",[Le],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tr))||Dt),hn,wn;function nn(e){var a=Hn();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function Hn(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var di=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,yo=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ka=(hn=(0,vr.b2)(),hn(wn=function(e){(0,mr.Z)(t,e);var a=nn(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:yo,fs:di});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,p=r.uniforms,v=this.rendererService.getViewportSize(),g=v.width,E=v.height;return{vs:o,fs:u,uniforms:(0,Z.Z)((0,Z.Z)({},p),{},{u_ViewportSize:[g,E]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,Br.isNil)(r.bloomRadius)||(o.u_radius=r.bloomRadius),(0,Br.isNil)(r.bloomIntensity)||(o.u_intensity=r.bloomIntensity),(0,Br.isNil)(r.bloomBaseRadio)||(o.u_baseRadio=r.bloomBaseRadio),o}}]),t}(Qr))||wn),Va,Xa;function Qa(e){var a=Nr();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function Nr(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Wr=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,ki=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ja=(Va=(0,vr.b2)(),Va(Xa=function(e){(0,mr.Z)(t,e);var a=Qa(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:ki,fs:Wr});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,p=r.uniforms,v=this.rendererService.getViewportSize(),g=v.width,E=v.height;return{vs:o,fs:u,uniforms:(0,Z.Z)((0,Z.Z)({},p),{},{u_ViewportSize:[g,E]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,Br.isNil)(r.blurRadius)||(o.u_BlurDir=[r.blurRadius,0]),o}}]),t}(Qr))||Xa),ha,Qu;function Nl(e){var a=ds();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function ds(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var zl=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Ss=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Fh=(ha=(0,vr.b2)(),ha(Qu=function(e){(0,mr.Z)(t,e);var a=Nl(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Ss,fs:zl});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,p=r.uniforms,v=this.rendererService.getViewportSize(),g=v.width,E=v.height;return{vs:o,fs:u,uniforms:(0,Z.Z)((0,Z.Z)({},p),{},{u_ViewportSize:[g,E]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,Br.isNil)(r.blurRadius)||(o.u_BlurDir=[0,r.blurRadius]),o}}]),t}(Qr))||Qu),bp,Zu;function vs(e){var a=rc();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function rc(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Vu=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,nc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,lh=(bp=(0,vr.b2)(),bp(Zu=function(e){(0,mr.Z)(t,e);var a=vs(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:nc,fs:Vu});var r=this.shaderModuleService.getModule("colorhalftone-pass"),o=r.vs,u=r.fs,p=r.uniforms,v=this.rendererService.getViewportSize(),g=v.width,E=v.height;return{vs:o,fs:u,uniforms:(0,Z.Z)((0,Z.Z)({},p),{},{u_ViewportSize:[g,E]})}}}]),t}(Qr))||Zu),id,pm;function Tv(e){var a=dm();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function dm(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var D2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,B2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,N2=(id=(0,vr.b2)(),id(pm=function(e){(0,mr.Z)(t,e);var a=Tv(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:B2,fs:D2}),this.shaderModuleService.getModule("copy-pass")}}]),t}(Qr))||pm),Wy,Xy;function z2(e){var a=U2();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function U2(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Z2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,V2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,j2=(Wy=(0,vr.b2)(),Wy(Xy=function(e){(0,mr.Z)(t,e);var a=z2(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:V2,fs:Z2});var r=this.shaderModuleService.getModule("hexagonalpixelate-pass"),o=r.vs,u=r.fs,p=r.uniforms,v=this.rendererService.getViewportSize(),g=v.width,E=v.height;return{vs:o,fs:u,uniforms:(0,Z.Z)((0,Z.Z)({},p),{},{u_ViewportSize:[g,E]})}}}]),t}(Qr))||Xy),Yy,qy;function G2(e){var a=H2();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function H2(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var W2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,X2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Y2=(Yy=(0,vr.b2)(),Yy(qy=function(e){(0,mr.Z)(t,e);var a=G2(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:X2,fs:W2});var r=this.shaderModuleService.getModule("ink-pass"),o=r.vs,u=r.fs,p=r.uniforms,v=this.rendererService.getViewportSize(),g=v.width,E=v.height;return{vs:o,fs:u,uniforms:(0,Z.Z)((0,Z.Z)({},p),{},{u_ViewportSize:[g,E]})}}}]),t}(Qr))||qy),$y,Ky;function q2(e){var a=$2();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function $2(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var K2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,Q2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,J2=($y=(0,vr.b2)(),$y(Ky=function(e){(0,mr.Z)(t,e);var a=q2(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:Q2,fs:K2}),this.shaderModuleService.getModule("noise-pass")}}]),t}(Qr))||Ky),Qy,Jy;function eE(e){var a=tE();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function tE(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var rE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,nE=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,iE=(Qy=(0,vr.b2)(),Qy(Jy=function(e){(0,mr.Z)(t,e);var a=eE(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:rE,fs:nE}),this.shaderModuleService.getModule("sepia-pass")}}]),t}(Qr))||Jy),e_,t_,r_,n_,Mv,i_,aE=(e_=(0,vr.b2)(),t_=(0,vr.f3)(At.IRendererService),r_=(0,vr.zY)(),e_(n_=(Mv=function(){function e(){(0,xt.Z)(this,e),(0,da.Z)(this,"rendererService",i_,this),(0,ee.Z)(this,"passes",[]),(0,ee.Z)(this,"readFBO",void 0),(0,ee.Z)(this,"writeFBO",void 0)}return(0,St.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,i=t.getViewportSize,r=t.createTexture2D,o=i(),u=o.width,p=o.height;return r({x:0,y:0,width:u,height:p,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,i=this.rendererService.useFramebuffer;return new Promise(function(r,o){i(t.readFBO,(0,Sa.Z)(zn().mark(function u(){return zn().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:r(t.getCurrentFBOTex());case 1:case"end":return v.stop()}},u)})))})}},{key:"renderBloomPass",value:function(){var a=(0,Sa.Z)(zn().mark(function i(r,o){var u,p;return zn().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.getReadFBOTex();case 2:u=g.sent,p=0;case 4:if(!(p<4)){g.next=11;break}return g.next=7,o.render(r,u);case 7:this.swap(),p++,g.next=4;break;case 11:case"end":return g.stop()}},i,this)}));function t(i,r){return a.apply(this,arguments)}return t}()},{key:"render",value:function(){var a=(0,Sa.Z)(zn().mark(function i(r){var o,u;return zn().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:o=0;case 1:if(!(o<this.passes.length)){v.next=15;break}if(u=this.passes[o],u.setRenderToScreen(this.isLastEnabledPass(o)),u.getName()!=="bloom"){v.next=9;break}return v.next=7,this.renderBloomPass(r,u);case 7:v.next=12;break;case 9:return v.next=11,u.render(r);case 11:o!==this.passes.length-1&&this.swap();case 12:o++,v.next=1;break;case 15:case"end":return v.stop()}},i,this)}));function t(i){return a.apply(this,arguments)}return t}()},{key:"resize",value:function(t,i){this.readFBO.resize({width:t,height:i}),this.writeFBO.resize({width:t,height:i})}},{key:"add",value:function(t,i,r){t.init(i,r),this.passes.push(t)}},{key:"insert",value:function(t,i,r,o){t.init(r,o),this.passes.splice(i,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(i){return i.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,i=t.createFramebuffer,r=t.createTexture2D;this.readFBO=i({color:r({width:1,height:1,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})}),this.writeFBO=i({color:r({width:1,height:1,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var i=t+1;i<this.passes.length;i++)if(this.passes[i].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),e}(),i_=(0,ca.Z)(Mv.prototype,"rendererService",[t_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,ca.Z)(Mv.prototype,"init",[r_],Object.getOwnPropertyDescriptor(Mv.prototype,"init"),Mv.prototype),Mv))||n_),a_,o_;function oE(e){var a=sE();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function sE(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var uE=(a_=(0,vr.b2)(),a_(o_=function(e){(0,mr.Z)(t,e);var a=oE(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getType",value:function(){return Gf.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(r,o){df((0,nt.Z)(t.prototype),"init",this).call(this,r,o)}},{key:"render",value:function(r){var o=this.rendererService,u=o.useFramebuffer,p=o.clear,v=r.multiPassRenderer.getPostProcessor().getReadFBO();u(v,function(){p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:v}),r.multiPassRenderer.setRenderFlag(!1),r.models.forEach(function(g){g.draw({uniforms:r.layerModel.getUninforms()})}),r.multiPassRenderer.setRenderFlag(!0)})}}]),t}(nd))||o_),s_,u_,l_,Xg,c_;function lE(e){var a=cE();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function cE(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var fE=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,f_=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,hE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function h_(e,a){for(var t=0,i=1/a,r=e;r>0;)t=t+i*(r%a),r=Math.floor(r/a),i=i/a;return t}var pE=1,dE=(s_=(0,vr.b2)(),u_=(0,vr.f3)(At.IShaderModuleService),s_(l_=(Xg=function(e){(0,mr.Z)(t,e);var a=lE(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,da.Z)((0,dt.Z)(i),"shaderModuleService",c_,(0,dt.Z)(i)),(0,ee.Z)((0,dt.Z)(i),"haltonSequence",[]),(0,ee.Z)((0,dt.Z)(i),"accumulatingId",0),(0,ee.Z)((0,dt.Z)(i),"frame",0),(0,ee.Z)((0,dt.Z)(i),"timer",void 0),(0,ee.Z)((0,dt.Z)(i),"sampleRenderTarget",void 0),(0,ee.Z)((0,dt.Z)(i),"prevRenderTarget",void 0),(0,ee.Z)((0,dt.Z)(i),"outputRenderTarget",void 0),(0,ee.Z)((0,dt.Z)(i),"copyRenderTarget",void 0),(0,ee.Z)((0,dt.Z)(i),"blendModel",void 0),(0,ee.Z)((0,dt.Z)(i),"outputModel",void 0),(0,ee.Z)((0,dt.Z)(i),"copyModel",void 0),i}return(0,St.Z)(t,[{key:"getType",value:function(){return Gf.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(r,o){df((0,nt.Z)(t.prototype),"init",this).call(this,r,o);var u=this.rendererService,p=u.createFramebuffer,v=u.createTexture2D;this.sampleRenderTarget=p({color:v({width:1,height:1,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})}),this.prevRenderTarget=p({color:v({width:1,height:1,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})}),this.outputRenderTarget=p({color:v({width:1,height:1,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})}),this.copyRenderTarget=p({color:v({width:1,height:1,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE})});for(var g=0;g<30;g++)this.haltonSequence.push([h_(g,2),h_(g,3)]);this.blendModel=this.createTriangleModel("blend-pass",fE),this.outputModel=this.createTriangleModel("copy-pass",f_,{blend:{enable:!0,func:{srcRGB:X.ONE,dstRGB:X.ONE_MINUS_SRC_ALPHA,srcAlpha:X.ONE,dstAlpha:X.ONE_MINUS_SRC_ALPHA},equation:{rgb:X.FUNC_ADD,alpha:X.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",f_)}},{key:"render",value:function(r){var o=this,u=this.rendererService,p=u.clear,v=u.getViewportSize,g=u.useFramebuffer,E=v(),T=E.width,O=E.height;this.sampleRenderTarget.resize({width:T,height:O}),this.prevRenderTarget.resize({width:T,height:O}),this.outputRenderTarget.resize({width:T,height:O}),this.copyRenderTarget.resize({width:T,height:O}),this.resetFrame(),this.stopAccumulating();var F=r.multiPassRenderer.getPostProcessor().getReadFBO();g(F,function(){p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:F}),r.multiPassRenderer.setRenderFlag(!1),r.render(),r.multiPassRenderer.setRenderFlag(!0)});var U=function j(K){!o.accumulatingId||K!==o.accumulatingId||o.isFinished()||(o.doRender(r),Ia.requestAnimationFrame(function(){j(K)}))};this.accumulatingId=pE++,this.timer=Ia.setTimeout(function(){U(o.accumulatingId)},50)}},{key:"doRender",value:function(r){var o=this,u=this.rendererService,p=u.clear,v=u.getViewportSize,g=u.useFramebuffer,E=v(),T=E.width,O=E.height,F=r.getLayerConfig(),U=F.jitterScale,j=U===void 0?1:U,K=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((K[0]*2-1)/T*j,(K[1]*2-1)/O*j),r.multiPassRenderer.setRenderFlag(!1),r.hooks.beforeRender.call(),g(this.sampleRenderTarget,function(){p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.sampleRenderTarget}),r.render()}),r.hooks.afterRender.call(),r.multiPassRenderer.setRenderFlag(!0);var ae=r.getLayerConfig();g(this.outputRenderTarget,function(){o.blendModel.draw({uniforms:{u_opacity:ae.opacity||1,u_MixRatio:o.frame===0?1:.9,u_Diffuse1:o.sampleRenderTarget,u_Diffuse2:o.frame===0?r.multiPassRenderer.getPostProcessor().getReadFBO():o.prevRenderTarget}})}),this.frame===0&&p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(g(this.copyRenderTarget,function(){o.outputModel.draw({uniforms:{u_Texture:o.outputRenderTarget}})}),g(r.multiPassRenderer.getPostProcessor().getReadFBO(),function(){o.copyModel.draw({uniforms:{u_Texture:o.copyRenderTarget}})}),r.multiPassRenderer.getPostProcessor().render(r));var ve=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=ve,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,Ia.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(r,o,u){this.shaderModuleService.registerModule(r,{vs:hE,fs:o});var p=this.shaderModuleService.getModule(r),v=p.vs,g=p.fs,E=p.uniforms,T=this.rendererService,O=T.createAttribute,F=T.createBuffer,U=T.createModel;return U((0,Z.Z)({vs:v,fs:g,attributes:{a_Position:O({buffer:F({data:[-4,-4,4,-4,0,4],type:X.FLOAT}),size:2})},uniforms:(0,Z.Z)({},E),depth:{enable:!1},count:3},u))}}]),t}(nd),c_=(0,ca.Z)(Xg.prototype,"shaderModuleService",[u_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xg))||l_),vm=new vr.W2;vm.bind(At.IGlobalConfigService).to(Ad).inSingletonScope(),(0,vr.GW)((0,vr.b2)(),fl.EventEmitter),vm.bind(At.IEventEmitter).to(fl.EventEmitter);var p_=(0,ra.Z)(vm,!1),Yg=function(a){var t=p_.lazyInject(a);return function(i,r,o){t.call(this,i,r),o&&(o.initializer=function(){return i[r]})}},pI=function(a){var t=p_.lazyMultiInject(a);return function(i,r,o){t.call(this,i,r),o&&(o.initializer=function(){return i[r]})}},Dh=vm,vE=0;function mE(){var e=new vr.W2;return e.parent=vm,e.bind(At.SceneID).toConstantValue("".concat(vE++)),e.bind(At.IShaderModuleService).to(Cv).inSingletonScope(),e.bind(At.ILayerService).to(Wv).inSingletonScope(),e.bind(At.ISceneService).to(am).inSingletonScope(),e.bind(At.ICameraService).to(Zp).inSingletonScope(),e.bind(At.ICoordinateSystemService).to(Yd).inSingletonScope(),e.bind(At.IInteractionService).to(v0).inSingletonScope(),e.bind(At.IPickingService).to(y0).inSingletonScope(),e.bind(At.IControlService).to(Ed).inSingletonScope(),e.bind(At.IMarkerService).to(Wp).inSingletonScope(),e.bind(At.IIconService).to(op).inSingletonScope(),e.bind(At.IFontService).to(_d).inSingletonScope(),e.bind(At.IPopupService).to(sp).inSingletonScope(),e.bind(At.INormalPass).to(Wg).whenTargetNamed("clear"),e.bind(At.INormalPass).to(Ae).whenTargetNamed("pixelPicking"),e.bind(At.INormalPass).to(uE).whenTargetNamed("render"),e.bind(At.INormalPass).to(dE).whenTargetNamed("taa"),e.bind(At.IFactoryNormalPass).toFactory(function(a){return function(t){return a.container.getNamed(At.INormalPass,t)}}),e.bind(At.IPostProcessingPass).to(N2).whenTargetNamed("copy"),e.bind(At.IPostProcessingPass).to(Ka).whenTargetNamed("bloom"),e.bind(At.IPostProcessingPass).to(ja).whenTargetNamed("blurH"),e.bind(At.IPostProcessingPass).to(Fh).whenTargetNamed("blurV"),e.bind(At.IPostProcessingPass).to(J2).whenTargetNamed("noise"),e.bind(At.IPostProcessingPass).to(iE).whenTargetNamed("sepia"),e.bind(At.IPostProcessingPass).to(lh).whenTargetNamed("colorHalftone"),e.bind(At.IPostProcessingPass).to(j2).whenTargetNamed("hexagonalPixelate"),e.bind(At.IPostProcessingPass).to(Y2).whenTargetNamed("ink"),e.bind(At.IFactoryPostProcessingPass).toFactory(function(a){return function(t){var i=a.container.getNamed(At.IPostProcessingPass,t);return i.setName(t),i}}),e}function qg(e){var a=new vr.W2;return a.parent=e,a.bind(At.IStyleAttributeService).to(pv).inSingletonScope(),a.bind(At.IMultiPassRenderer).to(R).inSingletonScope(),a.bind(At.IPostProcessor).to(aE).inSingletonScope(),a}var gE=null;function dI(e){return gE.indexOf(e)}var yE=2,vI=4,_E=64,mI=128,xE=256,bE=512,gI=8192,yI=16384,_I=32768,EE=null,d_=131072,xI=262144,CE=524288,bI=1048576,SE=2097152,EI=4194304,wE=8388608,AE=16777216,TE=null;function eg(e,a){return e=clamp(Math.floor(e),0,255),a=clamp(Math.floor(a),0,255),256*e+a}function CI(e){var a=e.color,t=e.radius,i=e.tileX,r=e.tileY,o=e.shape,u=e.opacity,p=e.stroke,v=e.strokeWidth,g=e.strokeOpacity,E=[],T=[],O=[],F=[eg(a[0],a[1]),eg(a[2],a[3])],U=[eg(p[0],p[1]),eg(p[2],p[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(j){var K=_slicedToArray(j,2),ae=K[0],ve=K[1];E.push([].concat(F,[(ae+1)*wE+(ve+1)*SE+getShapeIndex(o)*d_+t,(i+512)*CE+(r+512)*_E])),T.push([].concat(U,[v,g])),O.push([u,0,0,0])}),{packedBuffer:E,packedBuffer2:T,packedBuffer3:O}}function SI(e,a){if(e===0&&!a)return 0;if(e===1&&a)return 4294967295;var t=a?1:0,i=Math.floor(e*127);return i*TE+t*AE+i*d_+t*EE+i*bE+t*xE+i*yE+t}var Bh;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(Bh||(Bh={}));var is;(function(e){e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging"})(is||(is={}));var w0;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(w0||(w0={}));var Tn;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(Tn||(Tn={}));var ME=["mapload","mapchange","mapAfterFrameChange"],$0={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},$g=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],A0;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(A0||(A0={}));function kE(e){var a=IE();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function IE(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var PE=0,tg=function(e){(0,mr.Z)(t,e);var a=kE(t);function t(i){var r;return(0,xt.Z)(this,t),r=a.call(this),r.controlOption=(0,Z.Z)((0,Z.Z)({},r.getDefault()),i||{}),r}return(0,St.Z)(t,[{key:"getDefault",value:function(){return{position:A0.TOPRIGHT,name:"".concat(PE++)}}},{key:"setPosition",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:A0.BOTTOMRIGHT,o=this.controlService;return o&&o.removeControl(this),this.controlOption.position=r,o&&o.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(r){this.mapsService=r.get(At.IMapService),this.renderService=r.get(At.IRendererService),this.layerService=r.get(At.ILayerService),this.controlService=r.get(At.IControlService),this.sceneContainer=r,this.isShow=!0,this.container=this.onAdd();var o=this.container,u=this.controlOption.position,p=this.controlService.controlCorners[u];return bu(o,"l7-control"),u.indexOf("bottom")!==-1?p.insertBefore(o,p.firstChild):p.appendChild(o),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var r=this.container;bu(r,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var r=this.container;Pc(r,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;jl(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(r){if(this.mapsService&&r&&r.screenX>0&&r.screenY>0){var o=this.mapsService.getContainer();o!==null&&o.focus()}}}]),t}(fl.EventEmitter);function LE(e){var a=RE();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function RE(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var wI=function(e){(0,mr.Z)(t,e);var a=LE(t);function t(i){var r;return(0,xt.Z)(this,t),r=a.call(this,i),r.layerControlInputs=[],r.layers=[],r.lastZIndex=0,r.handlingClick=!1,r.initLayers(),c(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,dt.Z)(r)),r}return(0,St.Z)(t,[{key:"getDefault",value:function(){return{collapsed:!0,position:A0.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var r=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(o){o.layer.on("remove",r.onLayerChange),o.layer.on("add",r.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(r,o){return this.addLayer(r,o,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var r=this.renderService.getViewportSize(),o=r.height;bu(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var u=o-(this.container.offsetTop+50);return u<this.form.clientHeight?(bu(this.form,"l7-control-layers-scrollbar"),this.form.style.height=u+"px"):Pc(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Pc(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var r=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(o){o.layer.off("remove",r.onLayerChange),o.layer.off("add",r.onLayerChange)}))}},{key:"initLayout",value:function(){var r="l7-control-layers",o=this.container=ka("div",r),u=this.controlOption.collapsed;o.setAttribute("aria-haspopup","true");var p=this.form=ka("form",r+"-list");u&&(this.mapsService.on("click",this.collapse),o.addEventListener("mouseenter",this.expand),o.addEventListener("mouseleave",this.collapse)),this.layersLink=ka("a",r+"-toggle",o);var v=this.layersLink;v.title="Layers",u||this.expand(),this.baseLayersList=ka("div",r+"-base",p),this.separator=ka("div",r+"-separator",p),this.overlaysList=ka("div",r+"-overlays",p),o.appendChild(p)}},{key:"initLayers",value:function(){var r=this,o=this.controlOption,u=o.baseLayers,p=u===void 0?{}:u,v=o.overlayers,g=v===void 0?{}:v;Object.keys(p).forEach(function(E,T){r.addLayer(p[E],E,!1)}),Object.keys(g).forEach(function(E,T){r.addLayer(g[E],E,!0)})}},{key:"update",value:function(){if(!this.container)return this;Kf(this.baseLayersList),Kf(this.overlaysList),this.layerControlInputs=[];var r,o,u,p,v=0;for(u=0;u<this.layers.length;u++)p=this.layers[u],this.addItem(p),o=o||p.overlay,r=r||!p.overlay,v+=p.overlay?0:1;return this.controlOption.hideSingleBase&&(r=r&&v>1,this.baseLayersList.style.display=r?"":"none"),this.separator.style.display=o&&r?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var r=this.layerControlInputs,o,u,p=this.mapsService.getZoom(),v=r.length-1;v>=0;v--)if(o=r[v],u=this.layerService.getLayer(o.layerId),u&&u.inited){var g=u.getMinZoom(),E=u.getMaxZoom();o.disabled=p<g||p>E}}},{key:"addLayer",value:function(r,o,u){this.mapsService&&(r.on("add",this.onLayerChange),r.on("remove",this.onLayerChange)),this.layers.push({layer:r,name:o,overlay:u});var p=this.controlOption,v=p.sortLayers,g=p.sortFunction,E=p.autoZIndex;v&&this.layers.sort(function(T,O){return g(T.layer,O.layer,T.name,O.name)}),E&&r.setZIndex&&(this.lastZIndex++,r.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(r){this.handlingClick||this.update();var o=this.layerService.getLayer(r.target.layerId),u=o!=null&&o.overlay?r.type==="add"?"overlayadd":"overlayremove":r.type==="add"?"baselayerchange":null;u&&this.emit(u,o)}},{key:"createRadioElement",value:function(r,o){var u='<input type="radio" class="l7-control-layers-selector" name="'+r+'"'+(o?' checked="checked"':"")+"/>",p=document.createElement("div");return p.innerHTML=u,p.firstChild}},{key:"addItem",value:function(r){var o=document.createElement("label"),u=this.layerService.getLayer(r.layer.id),p=u&&u.inited&&r.layer.isVisible(),v;r.overlay?(v=document.createElement("input"),v.type="checkbox",v.className="l7-control-layers-selector",v.defaultChecked=p):v=this.createRadioElement("l7-base-layers",p),this.layerControlInputs.push(v),v.layerId=r.layer.id,v.addEventListener("click",this.onInputClick);var g=document.createElement("span");g.innerHTML=" "+r.name;var E=document.createElement("div");o.appendChild(E),E.appendChild(v),E.appendChild(g);var T=r.overlay?this.overlaysList:this.baseLayersList;return T.appendChild(o),this.checkDisabledLayers(),o}},{key:"onInputClick",value:function(){var r=this.layerControlInputs,o,u,p=[],v=[];this.handlingClick=!0;for(var g=r.length-1;g>=0;g--)o=r[g],u=this.layerService.getLayer(o.layerId),o.checked?p.push(u):o.checked||v.push(u);v.forEach(function(E){E.hide()}),p.forEach(function(E){E.show()}),this.handlingClick=!1}}]),t}(tg);function OE(e){var a=FE();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function FE(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var DE=function(e){(0,mr.Z)(t,e);var a=OE(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getDefault",value:function(){return{position:A0.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var r="l7-control-logo",o=ka("div",r),u=ka("a","l7-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://antv.alipay.com/l7",u.setAttribute("aria-label","AntV logo"),u.setAttribute("rel","noopener nofollow"),o.appendChild(u),o}},{key:"onRemove",value:function(){return null}}]),t}(tg);function BE(e){var a=NE();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function NE(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var AI=function(e){(0,mr.Z)(t,e);var a=BE(t);function t(i){var r;return(0,xt.Z)(this,t),r=a.call(this,i),c(["update"],(0,dt.Z)(r)),r}return(0,St.Z)(t,[{key:"getDefault",value:function(){return{position:A0.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var r="l7-control-scale",o=ka("div",r);this.addScales(r+"-line",o);var u=this.controlOption.updateWhenIdle;return this.mapsService.on(u?"moveend":"mapmove",this.update),this.mapsService.on(u?"zoomend":"zoomchange",this.update),this.update(),o}},{key:"onRemove",value:function(){var r=this.controlOption.updateWhenIdle;this.mapsService.off(r?"zoomend":"zoomchange",this.update),this.mapsService.off(r?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var r=this.mapsService,o=this.controlOption.maxWidth,u=r.getSize()[1]/2,p=r.containerToLngLat([0,u]),v=r.containerToLngLat([o,u]),g=Rc([p.lng,p.lat],[v.lng,v.lat]);this.updateScales(g)}},{key:"updateScales",value:function(r){var o=this.controlOption,u=o.metric,p=o.imperial;u&&r&&this.updateMetric(r),p&&r&&this.updateImperial(r)}},{key:"updateMetric",value:function(r){var o=this.getRoundNum(r),u=o<1e3?o+" m":o/1e3+" km";this.updateScale(this.mScale,u,o/r)}},{key:"updateImperial",value:function(r){var o=r*3.2808399,u,p,v;o>5280?(u=o/5280,p=this.getRoundNum(u),this.updateScale(this.iScale,p+" mi",p/u)):(v=this.getRoundNum(o),this.updateScale(this.iScale,v+" ft",v/o))}},{key:"updateScale",value:function(r,o,u){var p=this.controlOption.maxWidth;r.style.width=Math.round(p*u)+"px",r.innerHTML=o}},{key:"getRoundNum",value:function(r){var o=Math.pow(10,(Math.floor(r)+"").length-1),u=r/o;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:1,o*u}},{key:"addScales",value:function(r,o){var u=this.controlOption,p=u.metric,v=u.imperial;p&&(this.mScale=ka("div",r,o)),v&&(this.iScale=ka("div",r,o))}}]),t}(tg);function zE(e){var a=UE();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function UE(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var TI=function(e){(0,mr.Z)(t,e);var a=zE(t);function t(i){var r;return(0,xt.Z)(this,t),r=a.call(this,i),c(["updateDisabled","zoomIn","zoomOut"],(0,dt.Z)(r)),r}return(0,St.Z)(t,[{key:"getDefault",value:function(){return{position:A0.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var r="l7-control-zoom",o=ka("div",r+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,r+"-in",o,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,r+"-out",o,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),o}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(r,o,u,p,v){var g=ka("a",u,p);return g.innerHTML=r,g.title=o,g.href="javascript:void(0)",g.addEventListener("click",v),g}},{key:"updateDisabled",value:function(){var r=this.mapsService,o="l7-disabled";Pc(this.zoomInButton,o),Pc(this.zoomOutButton,o),(this.disabled||r.getZoom()<=r.getMinZoom())&&bu(this.zoomOutButton,o),(this.disabled||r.getZoom()>=r.getMaxZoom())&&bu(this.zoomInButton,o)}}]),t}(tg);function ZE(e){var a=VE();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function VE(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var v_=function(e){(0,mr.Z)(t,e);var a=ZE(t);function t(i){var r;return(0,xt.Z)(this,t),r=a.call(this),(0,ee.Z)((0,dt.Z)(r),"added",!1),(0,ee.Z)((0,dt.Z)(r),"eventHandle",function(o){r.emit(o.type,{target:o,data:r.markerOption.extData,lngLat:r.lngLat})}),r.markerOption=(0,Z.Z)((0,Z.Z)({},r.getDefault()),i),c(["update","onMove","onUp","addDragHandler","onMapClick"],(0,dt.Z)(r)),r.init(),r}return(0,St.Z)(t,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:Y.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(r){this.scene=r,this.mapsService=r.get(At.IMapService),this.sceneSerive=r.get(At.ISceneService);var o=this.markerOption,u=o.element,p=o.draggable;return this.mapsService.getMarkerContainer().appendChild(u),this.registerMarkerEvent(u),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var r=this.markerOption.element;return r&&jl(r),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(r){return this.lngLat=r,Array.isArray(r)&&(this.lngLat={lng:r[0],lat:r[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(r){var o=this;if(!this.added)return this.once("added",function(){o.setElement(r)}),this;var u=this.markerOption.element;return u&&jl(u),this.markerOption.element=r,this.init(),this.mapsService.getMarkerContainer().appendChild(r),this.registerMarkerEvent(r),this.update(),this}},{key:"openPopup",value:function(){var r=this;if(!this.added)return this.once("added",function(){r.openPopup()}),this;var o=this.popup;return o?(o.isOpen()||o.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var r=this;this.added||this.once("added",function(){r.closePopup()});var o=this.popup;return o&&o.remove(),this}},{key:"setPopup",value:function(r){return this.popup=r,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var r=this.popup;if(r)r.isOpen()?r.remove():r.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(r){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(r){this.markerOption.extData=r}},{key:"update",value:function(){if(!!this.mapsService){var r=this.markerOption,o=r.element,u=r.anchor;this.updatePosition(),us(o,"".concat(te[u]))}}},{key:"onMapClick",value:function(r){var o=this.markerOption.element;this.popup&&o&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var r=this.mapsService.getContainer();return{containerHeight:(r==null?void 0:r.scrollHeight)||0,containerWidth:(r==null?void 0:r.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var r=this.markerOption,o=r.element,u=r.offsets,p=this.lngLat,v=p.lng,g=p.lat,E=this.mapsService.lngLatToContainer([v,g]);if(o){o.style.display="block",o.style.whiteSpace="nowrap";var T=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),O=T.containerHeight,F=T.containerWidth,U=T.bounds;if(!U)return;if(Math.abs(U[0][0])>180||Math.abs(U[1][0])>180){if(E.x>F){var j=this.mapsService.lngLatToContainer([v-360,g]);E.x=j.x}if(E.x<0){var K=this.mapsService.lngLatToContainer([v+360,g]);E.x=K.x}}(E.x>F||E.x<0||E.y>O||E.y<0)&&(o.style.display="none"),o.style.left=E.x+u[0]+"px",o.style.top=E.y-u[1]+"px"}}}},{key:"init",value:function(){var r=this,o=this.markerOption.element,u=this.markerOption,p=u.color,v=u.anchor;if(!o){this.defaultMarker=!0,o=ka("div"),this.markerOption.element=o;var g=document.createElementNS("http://www.w3.org/2000/svg","svg");g.setAttributeNS(null,"display","block"),g.setAttributeNS(null,"height","48px"),g.setAttributeNS(null,"width","48px"),g.setAttributeNS(null,"viewBox","0 0 1024 1024");var E=document.createElementNS("http://www.w3.org/2000/svg","path");E.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),E.setAttributeNS(null,"fill",p),g.appendChild(E),o.appendChild(g)}bu(o,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(T){var O,F,U=((O=r.markerOption)===null||O===void 0?void 0:O.style)&&((F=r.markerOption)===null||F===void 0?void 0:F.style[T]);o&&(o.style[T]=U)}),o.addEventListener("click",function(T){r.onMapClick(T)}),o.addEventListener("click",this.eventHandle),ye(o,v,"marker")}},{key:"registerMarkerEvent",value:function(r){r.addEventListener("mousemove",this.eventHandle),r.addEventListener("click",this.eventHandle),r.addEventListener("mousedown",this.eventHandle),r.addEventListener("mouseup",this.eventHandle),r.addEventListener("dblclick",this.eventHandle),r.addEventListener("contextmenu",this.eventHandle),r.addEventListener("mouseover",this.eventHandle),r.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var r=this.getElement();r.removeEventListener("mousemove",this.eventHandle),r.removeEventListener("click",this.eventHandle),r.removeEventListener("mousedown",this.eventHandle),r.removeEventListener("mouseup",this.eventHandle),r.removeEventListener("dblclick",this.eventHandle),r.removeEventListener("contextmenu",this.eventHandle),r.removeEventListener("mouseover",this.eventHandle),r.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(r){throw new Error("Method not implemented.")}},{key:"onUp",value:function(r){throw new Error("Method not implemented.")}}]),t}(fl.EventEmitter);function jE(e){var a=GE();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function GE(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var MI=function(e){(0,mr.Z)(t,e);var a=jE(t);function t(i){var r,o;return(0,xt.Z)(this,t),o=a.call(this),(0,ee.Z)((0,dt.Z)(o),"markers",[]),(0,ee.Z)((0,dt.Z)(o),"points",[]),(0,ee.Z)((0,dt.Z)(o),"clusterMarkers",[]),o.markerLayerOption=(0,Br.merge)(o.getDefault(),i),c(["update"],(0,dt.Z)(o)),o.zoom=((r=o.markerLayerOption.clusterOption)===null||r===void 0?void 0:r.zoom)||-99,o}return(0,St.Z)(t,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(r){return this.scene=r,this.mapsService=r.get(At.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this}},{key:"setContainerSize",value:function(){if(!!this.mapsService){var r=this.mapsService.getContainer();this.containerSize={containerWidth:(r==null?void 0:r.scrollWidth)||0,containerHeight:(r==null?void 0:r.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(r){var o=this.markerLayerOption.cluster;if(r.getMarkerLayerContainerSize=this.getContainerSize.bind(this),o&&(this.addPoint(r,this.markers.length),this.mapsService)){var u=this.mapsService.getZoom(),p=this.mapsService.getBounds();this.bbox=hc(p,.5),this.zoom=Math.floor(u),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(r)}},{key:"removeMarker",value:function(r){this.markers.indexOf(r);var o=this.markers.indexOf(r);o>-1&&this.markers.splice(o,1)}},{key:"hide",value:function(){this.markers.map(function(r){r.getElement().style.opacity="0"}),this.clusterMarkers.map(function(r){r.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(r){r.getElement().style.opacity="1"}),this.clusterMarkers.map(function(r){r.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var r=this.markerLayerOption.cluster;return r?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var r=this;this.getMarkers().forEach(function(o){o.addTo(r.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(r){r.remove()}),this.clusterMarkers.forEach(function(r){r.remove()}),this.mapsService.off("camerachange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this)),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(r,o){var u=r.getLnglat(),p=u.lng,v=u.lat,g={geometry:{type:"Point",coordinates:[p,v]},properties:(0,Z.Z)((0,Z.Z)({},r.getExtData()),{},{marker_id:o})};this.points.push(g),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var r=this.markerLayerOption.clusterOption,o=r.radius,u=r.minZoom,p=u===void 0?0:u,v=r.maxZoom;this.clusterIndex=new(au())({radius:o,minZoom:p,maxZoom:v}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(r,o){var u=this,p=r[0].concat(r[1]),v=this.clusterIndex.getClusters(p,o);this.clusterMarkers.forEach(function(g){g.remove()}),this.clusterMarkers=[],v.forEach(function(g){var E,T=u.markerLayerOption.clusterOption,O=T.field,F=T.method;if(g.properties&&(E=g.properties)!==null&&E!==void 0&&E.cluster_id){var U,j=u.getLeaves((U=g.properties)===null||U===void 0?void 0:U.cluster_id);if(g.properties.clusterData=j,O&&F){var K=j==null?void 0:j.map(function(ct){var _t=(0,ee.Z)({},O,ct.properties[O]);return _t}),ae=mn(K,O),ve=wf(F,ae),ke="point_"+F;g.properties[ke]=ve.toFixed(2)}}var qe=u.clusterMarker(g);u.clusterMarkers.push(qe),qe.addTo(u.scene)})}},{key:"getLeaves",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1/0,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return r?this.clusterIndex.getLeaves(r,o,u):null}},{key:"clusterMarker",value:function(r){var o=this.markerLayerOption.clusterOption,u=o,p=u.element,v=p===void 0?this.generateElement.bind(this):p,g=new v_({element:v(r)}).setLnglat({lng:r.geometry.coordinates[0],lat:r.geometry.coordinates[1]});return g}},{key:"normalMarker",value:function(r){var o=r.properties.marker_id;return this.markers[o]}},{key:"update",value:function(){if(!!this.mapsService){var r=this.mapsService.getZoom(),o=this.mapsService.getBounds();(!this.bbox||Math.abs(r-this.zoom)>=1||!pc(this.bbox,o))&&(this.bbox=hc(o,.5),this.zoom=Math.floor(r),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(r){var o=ka("div","l7-marker-cluster"),u=ka("div","",o),p=ka("span","",u),v=this.markerLayerOption.clusterOption,g=v.field,E=v.method;r.properties.point_count=r.properties.point_count||1;var T=g&&E?r.properties["point_"+E]||r.properties[g]:r.properties.point_count;return p.textContent=T,o}}]),t}(fl.EventEmitter);function HE(e){var a=WE();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function WE(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var m_=function(e){(0,mr.Z)(t,e);var a=HE(t);function t(i){var r;return(0,xt.Z)(this,t),r=a.call(this),r.popupOption=(0,Z.Z)((0,Z.Z)({},r.getdefault()),i),c(["update","onClickClose","remove"],(0,dt.Z)(r)),r}return(0,St.Z)(t,[{key:"addTo",value:function(r){var o=this;return this.mapsService=r.get(At.IMapService),this.sceneSerive=r.get(At.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=r,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){o.mapsService.on("click",o.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(r){var o=window.document.createDocumentFragment(),u=window.document.createElement("body"),p;for(u.innerHTML=r;p=u.firstChild,!!p;)o.appendChild(p);return this.setDOMContent(o)}},{key:"setLnglat",value:function(r){return this.lngLat=r,Array.isArray(r)&&(this.lngLat={lng:r[0],lat:r[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(r){return this.setDOMContent(window.document.createTextNode(r))}},{key:"setMaxWidth",value:function(r){return this.popupOption.maxWidth=r,this.update(),this}},{key:"setDOMContent",value:function(r){return this.createContent(),this.content.appendChild(r),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&jl(this.content),this.content=ka("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=ka("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(r,o,u){var p=window.document.createElement(r);return o!==void 0&&(p.className=o),u&&u.appendChild(p),p}},{key:"removeDom",value:function(r){r.parentNode&&r.parentNode.removeChild(r)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Y.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(r){r.stopPropagation&&r.stopPropagation(),this.remove()}},{key:"update",value:function(){var r=this,o=this.lngLat,u=this.popupOption,p=u.className,v=u.maxWidth,g=u.anchor;if(!(!this.mapsService||!o||!this.content)){var E=this.mapsService.getMarkerContainer();if(!this.container&&E){this.container=this.creatDom("div","l7-popup",E),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),p&&p.split(" ").forEach(function(O){return r.container.classList.add(O)});var T=this.popupOption.stopPropagation;T&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(O){r.container.addEventListener(O,function(F){F.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}v&&this.container.style.maxWidth!==v&&(this.container.style.maxWidth=v),this.updatePosition(),us(this.container,"".concat(te[g])),ye(this.container,g,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var r=this.lngLat,o=r.lng,u=r.lat,p=this.popupOption.offsets,v=this.mapsService.lngLatToContainer([o,u]);this.container.style.left=v.x+p[0]+"px",this.container.style.top=v.y-p[1]+"px"}}}]),t}(fl.EventEmitter);function XE(e,a){var t=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(t||i)&&(a||(a=document),!!a)){var r=a.head||a.getElementsByTagName("head")[0];if(!r){r=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):a.documentElement.appendChild(r)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),r.appendChild(u),u}}XE(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
          box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var T0,Kg=(T0={},(0,ee.Z)(T0,Bh.additive,{enable:!0,func:{srcRGB:X.ONE,dstRGB:X.ONE,srcAlpha:1,dstAlpha:1}}),(0,ee.Z)(T0,Bh.none,{enable:!1}),(0,ee.Z)(T0,Bh.normal,{enable:!0,func:{srcRGB:X.SRC_ALPHA,dstRGB:X.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,ee.Z)(T0,Bh.subtractive,{enable:!0,func:{srcRGB:X.ONE,dstRGB:X.ONE,srcAlpha:X.ZERO,dstAlpha:X.ONE_MINUS_SRC_COLOR},equation:{rgb:X.FUNC_SUBTRACT,alpha:X.FUNC_SUBTRACT}}),(0,ee.Z)(T0,Bh.max,{enable:!0,func:{srcRGB:X.ONE,dstRGB:X.ONE},equation:{rgb:X.MAX_EXT}}),(0,ee.Z)(T0,Bh.min,{enable:!0,func:{srcRGB:X.ONE,dstRGB:X.ONE},equation:{rgb:X.MIN_EXT}}),T0),kI=1024;function Hf(e,a,t,i,r){a.updateStyleAttribute(e,t,i,r)}function YE(e,a){e.opacity&&rg("opacity",a,e.opacity),e.strokeWidth&&rg("strokeWidth",a,e.strokeWidth),e.strokeOpacity&&rg("strokeOpacity",a,e.strokeOpacity),e.stroke&&qE("stroke",a,e.stroke),e.offsets&&g_("offsets",a,e.offsets),e.textOffset&&g_("textOffset",a,e.textOffset),e.thetaOffset&&rg("thetaOffset",a,e.thetaOffset)}function rg(e,a,t){(0,Br.isString)(t)?Hf(e,a,t,function(i){return i}):(0,Br.isNumber)(t)?Hf(e,a,[t],void 0):Array.isArray(t)&&t.length===2?(0,Br.isString)(t[0])&&(0,Br.isFunction)(t[1])||(0,Br.isString)(t[0])&&Array.isArray(t[1])&&(0,Br.isNumber)(t[1][0])&&(0,Br.isNumber)(t[1][1])?Hf(e,a,t[0],t[1]):Hf(e,a,[1],void 0):Hf(e,a,[1],void 0)}function g_(e,a,t){(0,Br.isString)(t)?Hf(e,a,t,function(i){return i}):Array.isArray(t)&&t.length===2&&(0,Br.isString)(t[0])&&(0,Br.isFunction)(t[1])?Hf(e,a,t[0],t[1]):Array.isArray(t)&&t.length===2&&(0,Br.isNumber)(t[0])&&(0,Br.isNumber)(t[1])?Hf(e,a,t,void 0):Hf(e,a,[0,0],void 0)}function qE(e,a,t){(0,Br.isString)(t)?Hf(e,a,t,void 0):Array.isArray(t)&&t.length===2&&((0,Br.isString)(t[0])&&(0,Br.isFunction)(t[1])||(0,Br.isString)(t[0])&&Array.isArray(t[1])&&t[1].length>0)?Hf(e,a,t[0],t[1]):Hf(e,a,"#fff",void 0)}var ju;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(ju||(ju={}));function $E(e,a){var t=[a[0]-e[0],a[1]-e[1]],i=eh(t),r=[e[0]+i[0]*1e-4,e[1]+i[1]*1e-4];return r}function KE(e,a){var t=this;e.length>0&&a.version===ju["GAODE2.x"]&&(typeof e[0].coordinates[0]=="number"?e.filter(function(i){return!i.originCoordinates}).map(function(i){i.version=ju["GAODE2.x"],i.originCoordinates=cloneDeep(i.coordinates),i.coordinates=t.mapService.lngLatToCoord(i.coordinates)}):e.filter(function(i){return!i.originCoordinates}).map(function(i){i.version=ju["GAODE2.x"],i.originCoordinates=cloneDeep(i.coordinates),i.coordinates=t.mapService.lngLatToCoords(i.coordinates)}))}function QE(e,a){e.length>0&&a.version===ju.SIMPLE&&e.map(function(t){t.simpleCoordinate||(t.coordinates=JE(t.coordinates,a),t.simpleCoordinate=!0)})}function JE(e,a){if(typeof e[0]=="number")return a.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var t=[];return e.map(function(r){var o=[];r.map(function(u){o.push(a.simpleMapCoord.unproject(u))}),t.push(o)}),t}else{var i=[];return e.map(function(r){i.push(a.simpleMapCoord.unproject(r))}),i}}function eC(e,a,t){var i;if(!e.scale)return[];var r=(e==null||(i=e.scale)===null||i===void 0?void 0:i.scalers)||[],o=[];r.forEach(function(p){var v,g=p.field;(a.hasOwnProperty(g)||((v=e.scale)===null||v===void 0?void 0:v.type)==="variable")&&o.push(a[g])});var u=e.mapping?e.mapping(o):[];return e.name==="color"&&!m(u[0])?[t]:u}function tC(e,a,t,i,r,o){var u=o==null?void 0:o.getLayerConfig(),p=u.arrow,v=p===void 0?{enable:!1}:p,g=a.map(function(E){var T={id:E._id,coordinates:E.coordinates};if(e.filter(function(U){return U.scale!==void 0}).forEach(function(U){var j=eC(U,E,r);U.needRemapping=!1,U.name==="color"&&(j=j.map(function(K){return S(K)})),T[U.name]=Array.isArray(j)&&j.length===1?j[0]:j,U.name==="shape"&&(T.shape=t.getIconFontKey(T[U.name]))}),T.shape==="line"&&v.enable){var O=T.coordinates,F=$E(O[0],O[1]);T.coordinates.splice(1,0,F,F)}return T});return KE(g,i),QE(g,i),g}function rC(e,a,t,i,r,o){var u=new Mi(r,o),p=e.getBottomColor(),v=i.getLayerStyleAttributes()||[],g=u.data.dataArray,E=g,T=tC(v,E,a,t,p,e);return u.destroy(),T}function y_(e){return e.map(function(a){return typeof a=="string"&&(a=[a,{}]),a})}function __(e,a,t,i){var r=e.multiPassRenderer,o=e.getLayerConfig(),u=o.enablePicking,p=o.enableTAA;return p?r.add(i("taa")):r.add(i("render")),y_(a).forEach(function(v){var g=(0,pr.Z)(v,2),E=g[0],T=g[1];r.add(t(E),T)}),r.add(t("copy")),r}var nC=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function iC(e,a,t){if(typeof a=="string"&&typeof t=="string"&&a!==t){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}nC.map(function(i){if(i.includes(a)&&i.includes(t)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var aC=["passes"],oC=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber","workerEnabled","workerOptions"],x_,Qg,b_;function sC(e,a){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=uC(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function uC(e,a){if(!!e){if(typeof e=="string")return E_(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return E_(e,a)}}function E_(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function lC(e){var a=cC();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function cC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var C_=0,Ld=(x_=Yg(At.IGlobalConfigService),Qg=function(e){(0,mr.Z)(t,e);var a=lC(t);function t(){var i,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,xt.Z)(this,t),i=a.call(this),(0,ee.Z)((0,dt.Z)(i),"id","".concat(C_++)),(0,ee.Z)((0,dt.Z)(i),"name","".concat(C_)),(0,ee.Z)((0,dt.Z)(i),"visible",!0),(0,ee.Z)((0,dt.Z)(i),"zIndex",0),(0,ee.Z)((0,dt.Z)(i),"inited",!1),(0,ee.Z)((0,dt.Z)(i),"layerModelNeedUpdate",!1),(0,ee.Z)((0,dt.Z)(i),"pickedFeatureID",null),(0,ee.Z)((0,dt.Z)(i),"selectedFeatureID",null),(0,ee.Z)((0,dt.Z)(i),"styleNeedUpdate",!1),(0,ee.Z)((0,dt.Z)(i),"clusterZoom",0),(0,ee.Z)((0,dt.Z)(i),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,ee.Z)((0,dt.Z)(i),"hooks",{init:new l0,afterInit:new l0,beforeRender:new l0,beforeRenderData:new Mh,afterRender:new Do,beforePickingEncode:new Do,afterPickingEncode:new Do,beforeHighlight:new Do(["pickedColor"]),afterHighlight:new Do,beforeSelect:new Do(["pickedColor"]),afterSelect:new Do,beforeDestroy:new Do,afterDestroy:new Do}),(0,ee.Z)((0,dt.Z)(i),"models",[]),(0,ee.Z)((0,dt.Z)(i),"layerChildren",[]),(0,ee.Z)((0,dt.Z)(i),"masks",[]),(0,ee.Z)((0,dt.Z)(i),"isVector",!1),(0,da.Z)((0,dt.Z)(i),"configService",b_,(0,dt.Z)(i)),(0,ee.Z)((0,dt.Z)(i),"animateOptions",{enable:!1}),(0,ee.Z)((0,dt.Z)(i),"currentPickId",null),(0,ee.Z)((0,dt.Z)(i),"pendingStyleAttributes",[]),(0,ee.Z)((0,dt.Z)(i),"scaleOptions",{}),(0,ee.Z)((0,dt.Z)(i),"aniamateStatus",!1),(0,ee.Z)((0,dt.Z)(i),"bottomColor","rgba(0, 0, 0, 0)"),(0,ee.Z)((0,dt.Z)(i),"isDestroied",!1),(0,ee.Z)((0,dt.Z)(i),"sourceEvent",function(){i.dataState.dataSourceNeedUpdate=!0;var o=i.getLayerConfig();o&&o.autoFit&&i.fitBounds(o.fitBoundsOptions),i.reRender()}),i.name=r.name||i.id,i.zIndex=r.zIndex||0,i.rawConfig=r,i}return(0,St.Z)(t,[{key:"addMaskLayer",value:function(r){this.masks.push(r)}},{key:"removeMaskLayer",value:function(r){var o=this.masks.indexOf(r);o>-1&&this.masks.splice(o,1),r.destroy()}},{key:"getAttribute",value:function(r){return this.styleAttributeService.getLayerStyleAttribute(r)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(r){var o=this;if(Object.keys(r).map(function(p){p in o.rawConfig&&(o.rawConfig[p]=r[p])}),!this.inited)this.needUpdateConfig=(0,Z.Z)((0,Z.Z)({},this.needUpdateConfig),r);else{var u=this.container.get(At.SceneID);YE(r,this),this.configService.setLayerConfig(u,this.id,(0,Z.Z)((0,Z.Z)((0,Z.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),r)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(r,o){this.container=r,this.sceneContainer=o}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(r){this.bottomColor=r}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(r){return this.plugins.push(r),this}},{key:"init",value:function(){var r=this,o=this.container.get(At.SceneID);this.configService.setLayerConfig(o,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(At.IIconService),this.fontService=this.container.get(At.IFontService),this.rendererService=this.container.get(At.IRendererService),this.layerService=this.container.get(At.ILayerService),this.interactionService=this.container.get(At.IInteractionService),this.pickingService=this.container.get(At.IPickingService),this.mapService=this.container.get(At.IMapService);var u=this.getLayerConfig(),p=u.enableMultiPassRenderer,v=u.passes;p&&v!==null&&v!==void 0&&v.length&&v.length>0&&this.mapService.on("mapAfterFrameChange",function(){r.renderLayers()}),this.cameraService=this.container.get(At.ICameraService),this.coordinateService=this.container.get(At.ICoordinateSystemService),this.shaderModuleService=this.container.get(At.IShaderModuleService),this.postProcessingPassFactory=this.container.get(At.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(At.IFactoryNormalPass),this.styleAttributeService=this.container.get(At.IStyleAttributeService),this.multiPassRenderer=this.container.get(At.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(O){var F=O.attributeName,U=O.attributeField,j=O.attributeValues,K=O.updateOptions;r.styleAttributeService.updateStyleAttribute(F,{scale:(0,Z.Z)({field:U},r.splitValuesAndCallbackInAttribute(j,r.getLayerConfig()[F]))},K)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(At.ILayerPlugin);var g=sC(this.plugins),E;try{for(g.s();!(E=g.n()).done;){var T=E.value;T.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(O){g.e(O)}finally{g.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(r){r.attributes&&r.elements?this.models.map(function(o){o.updateAttributesAndElements(r.attributes,r.elements)}):console.warn("data error")}},{key:"createModelData",value:function(r,o){var u;if((u=this.layerModel)!==null&&u!==void 0&&u.createModelData)return this.layerModel.createModelData(o);var p=this.calculateEncodeData(r,o),v=this.triangulation;return p&&v?this.styleAttributeService.createAttributesAndIndices(p,v):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(r,o){return this.inited?rC(this,this.fontService,this.mapService,this.styleAttributeService,r,o):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig((0,Z.Z)((0,Z.Z)({},this.getDefaultConfig()),this.rawConfig));var r=this.getLayerConfig(),o=r.animateOption;o!=null&&o.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(r,o,u){return this.updateStyleAttribute("color",r,o,u),this}},{key:"texture",value:function(r,o,u){return this.updateStyleAttribute("texture",r,o,u),this}},{key:"rotate",value:function(r,o,u){return this.updateStyleAttribute("rotate",r,o,u),this}},{key:"size",value:function(r,o,u){return this.updateStyleAttribute("size",r,o,u),this}},{key:"filter",value:function(r,o,u){return this.updateStyleAttribute("filter",r,o,u),this}},{key:"shape",value:function(r,o,u){var p,v,g,E=(p=this.styleAttributeService)===null||p===void 0||(v=p.getLayerStyleAttribute("shape"))===null||v===void 0||(g=v.scale)===null||g===void 0?void 0:g.field,T=r;return this.shapeOption={field:r,values:o},this.updateStyleAttribute("shape",r,o,u),this.tileLayer||iC(this,E,T),this}},{key:"label",value:function(r,o,u){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:r,attributeValues:o,updateOptions:u}),this}},{key:"animate",value:function(r){var o={};return(0,Br.isObject)(r)?(o.enable=!0,o=(0,Z.Z)((0,Z.Z)({},o),r)):o.enable=r,this.updateLayerConfig({animateOption:o}),this}},{key:"source",value:function(r,o){return r!=null&&r.data?(this.setSource(r),this):(this.sourceOption={data:r,options:o},this.clusterZoom=0,this)}},{key:"setData",value:function(r,o){var u=this;return this.inited?this.layerSource.setData(r,o):this.on("inited",function(){var p=u.getSource();p?u.layerSource.setData(r,o):(u.source(new Mi(r,o)),u.sourceEvent())}),this}},{key:"style",value:function(r){var o=this,u=this.getLayerConfig(),p=r.passes,v=(0,yp.Z)(r,aC);return p&&y_(p).forEach(function(g){var E=o.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(g[0]);E&&E.updateOptions(g[1])}),this.rawConfig=(0,Z.Z)((0,Z.Z)({},this.rawConfig),v),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),u&&u.mask===!0&&r.mask===!1&&(this.clearModels(),this.layerModel.buildModels(function(g){o.models=g})),this}},{key:"scale",value:function(r,o){return(0,Br.isObject)(r)?this.scaleOptions=(0,Z.Z)((0,Z.Z)({},this.scaleOptions),r):this.scaleOptions[r]=o,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.tileLayer!==void 0?(this.tileLayer.render(),this):(this.getEncodedData()&&this.getEncodedData().length!==0&&this.renderModels(),this)}},{key:"renderMultiPass",value:function(){var i=(0,Sa.Z)(zn().mark(function o(){return zn().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(!(this.getEncodedData()&&this.getEncodedData().length!==0)){p.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){p.next=6;break}return p.next=4,this.multiPassRenderer.render();case 4:p.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return p.stop()}},o,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"active",value:function(r){var o={};return o.enableHighlight=(0,Br.isObject)(r)?!0:r,(0,Br.isObject)(r)?(o.enableHighlight=!0,r.color&&(o.highlightColor=r.color),r.mix&&(o.activeMix=r.mix)):o.enableHighlight=!!r,this.updateLayerConfig(o),this}},{key:"setActive",value:function(r,o){var u=this;if((0,Br.isObject)(r)){var p=r.x,v=p===void 0?0:p,g=r.y,E=g===void 0?0:g;this.updateLayerConfig({highlightColor:(0,Br.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,Br.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.pick({x:v,y:E})}else this.updateLayerConfig({pickedFeatureID:r,highlightColor:(0,Br.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,Br.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(P(r)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"select",value:function(r){var o={};return o.enableSelect=(0,Br.isObject)(r)?!0:r,(0,Br.isObject)(r)?(o.enableSelect=!0,r.color&&(o.selectColor=r.color),r.mix&&(o.selectMix=r.mix)):o.enableSelect=!!r,this.updateLayerConfig(o),this}},{key:"setSelect",value:function(r,o){var u=this;if((0,Br.isObject)(r)){var p=r.x,v=p===void 0?0:p,g=r.y,E=g===void 0?0:g;this.updateLayerConfig({selectColor:(0,Br.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,Br.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.pick({x:v,y:E})}else this.updateLayerConfig({pickedFeatureID:r,selectColor:(0,Br.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,Br.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(P(r)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"setBlend",value:function(r){return this.updateLayerConfig({blend:r}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.type==="CanvasLayer"&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(r){return this.zIndex=r,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(r){this.currentPickId=r}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(r){this.selectedFeatureID=r}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var r=this.mapService.getZoom(),o=this.getLayerConfig(),u=o.visible,p=o.minZoom,v=p===void 0?-1/0:p,g=o.maxZoom,E=g===void 0?1/0:g;return!!u&&r>=v&&r<=E}},{key:"setMultiPass",value:function(r,o){if(this.updateLayerConfig({enableMultiPassRenderer:r}),o&&this.updateLayerConfig({passes:o}),r){var u=this.getLayerConfig(),p=u.passes,v=p===void 0?[]:p;this.multiPassRenderer=__(this,v,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var g=this.rendererService.getViewportSize(),E=g.width,T=g.height;this.multiPassRenderer.resize(E,T)}return this}},{key:"setMinZoom",value:function(r){return this.updateLayerConfig({minZoom:r}),this}},{key:"getMinZoom",value:function(){var r=this.getLayerConfig(),o=r.minZoom;return o}},{key:"getMaxZoom",value:function(){var r=this.getLayerConfig(),o=r.maxZoom;return o}},{key:"get",value:function(r){var o=this.getLayerConfig();return o[r]}},{key:"setMaxZoom",value:function(r){return this.updateLayerConfig({maxZoom:r}),this}},{key:"setAutoFit",value:function(r){return this.updateLayerConfig({autoFit:r}),this}},{key:"fitBounds",value:function(r){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var o=this.getSource(),u=o.extent,p=u.some(function(v){return Math.abs(v)===1/0});return p?this:(this.mapService.fitBounds([[u[0],u[1]],[u[2],u[3]]],r),this)}},{key:"destroy",value:function(){var r,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isDestroied||(this.layerChildren.map(function(u){return u.destroy()}),this.layerChildren=[],this.masks.map(function(u){return u.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("sourceUpdate",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(r=this.layerModel)===null||r===void 0||r.clearModels(),this.models=[],this.layerService.cleanRemove(this,o),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var r;this.models.forEach(function(o){return o.destroy()}),(r=this.layerModel)===null||r===void 0||r.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(r){return r.needRescale||r.needRemapping||r.needRegenerateVertices}).length}},{key:"setSource",value:function(r){var o=this;if(this.layerSource&&this.layerSource.off("sourceUpdate",this.sourceEvent),this.layerSource=r,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("sourceUpdate",function(){o.sourceEvent()})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(r){this.encodedData=r}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(r){return this.styleAttributeService.getLayerAttributeScale(r)}},{key:"getLegendItems",value:function(r){var o=this.styleAttributeService.getLayerAttributeScale(r);if(!o)return[];if(o.invertExtent){var u=o.range().map(function(g){return(0,ee.Z)({value:o.invertExtent(g)},r,g)});return u}else if(o.ticks){var p=o.ticks().map(function(g){return(0,ee.Z)({value:g},r,o(g))});return p}else if(o!=null&&o.domain){var v=o.domain().filter(function(g){return!(0,Br.isUndefined)(g)}).map(function(g){return(0,ee.Z)({value:g},r,o(g))});return v}return[]}},{key:"pick",value:function(r){var o=r.x,u=r.y;this.interactionService.triggerHover({x:o,y:u})}},{key:"boxSelect",value:function(r,o){this.pickingService.boxPickLayer(this,r,o)}},{key:"buildLayerModel",value:function(r){var o=this,u=r.moduleName,p=r.vertexShader,v=r.fragmentShader,g=r.triangulation,E=r.segmentNumber,T=r.workerEnabled,O=T===void 0?!1:T,F=r.workerOptions,U=(0,yp.Z)(r,oC);this.shaderModuleService.registerModule(u,{vs:p,fs:v});var j=this.shaderModuleService.getModule(u),K=j.vs,ae=j.fs,ve=j.uniforms,ke=this.rendererService.createModel;return new Promise(function(qe,ct){if(F&&F.modelType in Qh&&O)o.styleAttributeService.createAttributesAndIndicesAscy(o.encodedData,E,F).then(function(An){var ii=An.attributes,sa=An.elements,Io=ke((0,Z.Z)({attributes:ii,uniforms:ve,fs:ae,vs:K,elements:sa,blend:Kg[Bh.normal]},U));qe(Io)}).catch(function(An){return ct(An)});else{var _t=o.styleAttributeService.createAttributesAndIndices(o.encodedData,g,E),Ot=_t.attributes,Xt=_t.elements,yr=_t.count,Pr=(0,Z.Z)({attributes:Ot,uniforms:ve,fs:ae,vs:K,elements:Xt,blend:Kg[Bh.normal]},U);yr&&(Pr.count=yr);var xr=ke(Pr);qe(xr)}})}},{key:"createAttrubutes",value:function(r){var o=r.triangulation,u=this.styleAttributeService.createAttributes(this.encodedData,o),p=u.attributes;return p}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(r){var o=this.getLayerConfig(),u=o.enableHighlight,p=u===void 0?!0:u,v=o.enableSelect,g=v===void 0?!0:v,E=this.eventNames().indexOf(r)!==-1||this.eventNames().indexOf("un"+r)!==-1;return(r==="click"||r==="dblclick")&&g&&(E=!0),r==="mousemove"&&(p||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(E=!0),this.isVisible()&&E}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var i=(0,Sa.Z)(zn().mark(function o(u){return zn().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,u.render();case 2:case"end":return v.stop()}},o)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"renderModels",value:function(r){var o=this;if(this.getEncodedData()&&this.getEncodedData().length>0){var u;this.layerModelNeedUpdate&&this.layerModel&&this.layerModel.buildModels(function(p){o.models=p,o.hooks.beforeRender.call(),o.layerModelNeedUpdate=!1}),this!==null&&this!==void 0&&(u=this.layerModel)!==null&&u!==void 0&&u.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(p){p.draw({uniforms:o.layerModel.getUninforms()},r)})}return this}},{key:"updateStyleAttribute",value:function(r,o,u,p){this.inited?this.styleAttributeService.updateStyleAttribute(r,{scale:(0,Z.Z)({field:o},this.splitValuesAndCallbackInAttribute(u,this.getLayerConfig()[o]))},p):this.pendingStyleAttributes.push({attributeName:r,attributeField:o,attributeValues:u,updateOptions:p})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(r){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(r,o){return{values:(0,Br.isFunction)(r)?void 0:r||o,callback:(0,Br.isFunction)(r)?r:void 0}}}]),t}(fl.EventEmitter),b_=(0,ca.Z)(Qg.prototype,"configService",[x_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qg),S_,Jg,w_;function fC(e,a){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=hC(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function hC(e,a){if(!!e){if(typeof e=="string")return A_(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return A_(e,a)}}function A_(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var ko=(S_=Yg(At.IGlobalConfigService),Jg=function(){function e(a){(0,xt.Z)(this,e),(0,da.Z)(this,"configService",w_,this),this.layer=a,this.rendererService=a.getContainer().get(At.IRendererService),this.pickingService=a.getContainer().get(At.IPickingService),this.shaderModuleService=a.getContainer().get(At.IShaderModuleService),this.styleAttributeService=a.getContainer().get(At.IStyleAttributeService),this.mapService=a.getContainer().get(At.IMapService),this.iconService=a.getContainer().get(At.IIconService),this.fontService=a.getContainer().get(At.IFontService),this.cameraService=a.getContainer().get(At.ICameraService),this.layerService=a.getContainer().get(At.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var t=this.rendererService.createTexture2D;this.createTexture2D=t,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:X.NEAREST,min:X.NEAREST,width:1,height:1}))}return(0,St.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(t){var i=!1;return(0,Br.isEqual)(t.thetaOffset,this.cacheStyleProperties.thetaOffset)||(i=!0,this.cacheStyleProperties.thetaOffset=t.thetaOffset),(0,Br.isEqual)(t.opacity,this.cacheStyleProperties.opacity)||(i=!0,this.cacheStyleProperties.opacity=t.opacity),(0,Br.isEqual)(t.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(i=!0,this.cacheStyleProperties.strokeOpacity=t.strokeOpacity),(0,Br.isEqual)(t.strokeWidth,this.cacheStyleProperties.strokeWidth)||(i=!0,this.cacheStyleProperties.strokeWidth=t.strokeWidth),(0,Br.isEqual)(t.stroke,this.cacheStyleProperties.stroke)||(i=!0,this.cacheStyleProperties.stroke=t.stroke),(0,Br.isEqual)(t.offsets,this.cacheStyleProperties.offsets)||(i=!0,this.cacheStyleProperties.offsets=t.offsets),this.dataTexture===void 0&&(i=!0),i}},{key:"judgeStyleAttributes",value:function(t){this.clearLastCalRes(),t.opacity!==void 0&&!(0,Br.isNumber)(t.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),t.strokeOpacity!==void 0&&!(0,Br.isNumber)(t.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),t.strokeWidth!==void 0&&!(0,Br.isNumber)(t.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),t.stroke!==void 0&&!this.isStaticColor(t.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),t.offsets!==void 0&&!this.isOffsetStatic(t.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),t.thetaOffset!==void 0&&!(0,Br.isNumber)(t.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(t){return(0,Br.isString)(t)?!!(0,f.ZP)(t):!1}},{key:"getStrokeColor",value:function(t){if(this.isStaticColor(t)){var i=S(t);return i[0]=i[0]?i[0]:0,i[1]=i[1]?i[1]:0,i[2]=i[2]?i[2]:0,i[3]=i[3]?i[3]:0,i}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(t){return!!(Array.isArray(t)&&t.length===2&&(0,Br.isNumber)(t[0])&&(0,Br.isNumber)(t[1]))}},{key:"patchMod",value:function(t,i){for(var r=0;r<i;r++)t.push(-1)}},{key:"patchData",value:function(t,i,r){var o=fC(r),u;try{for(o.s();!(u=o.n()).done;){var p=u.value,v=p.attr,g=p.count,E=i[v];E!==void 0?v==="stroke"?t.push.apply(t,(0,Ee.Z)(S(E))):v==="offsets"?this.isOffsetStatic(E)?t.push(-E[0],E[1]):t.push(0,0):t.push((0,Br.isNumber)(E)?E:1):this.patchMod(t,g)}}catch(T){o.e(T)}finally{o.f()}}},{key:"calDataFrame",value:function(t,i,r){for(var o=i.length,u=Math.ceil(o*t/this.DATA_TEXTURE_WIDTH),p=u*this.DATA_TEXTURE_WIDTH,v=[],g=0;g<o;g++){var E=i[g];this.patchData(v,E,r)}for(var T=v.length;T<p;T++)v.push(-1);return{data:v,width:this.DATA_TEXTURE_WIDTH,height:u}}},{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),i=t.blend,r=i===void 0?"normal":i;return Kg[Bh[r]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(t){throw new Error("Method not implemented.")}},{key:"initModels",value:function(t){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),i=t.animateOption;i.enable&&this.layer.setAnimateStartTime()}}]),e}(),w_=(0,ca.Z)(Jg.prototype,"configService",[S_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jg),ey=100,II=36,PI=40;function T_(e){return e/180*Math.acos(-1)}function M_(e){var a=T_(e[0])+Math.PI/2,t=T_(e[1]),i=ey+Math.random()*.4,r=i*Math.cos(t)*Math.cos(a),o=i*Math.cos(t)*Math.sin(a),u=i*Math.sin(t);return[o,u,r]}function LI(e,a){var t=mat4.create(),i=mat4.create(),r=vec3.fromValues(0,1,0),o=vec3.fromValues(0,0,0);a=a||{},e=typeof e<"u"?e:1;for(var u=typeof a.segments<"u"?a.segments:32,p=2+u,v=2*p,g=[],E=[],T=[],O=[],F=[],U=[],j=0;j<=p;j++){for(var K=j/p,ae=K*Math.PI,ve=0;ve<=v;ve++){var ke=ve/v,qe=ke*Math.PI*2;mat4.identity(i),mat4.rotateZ(i,i,-ae),mat4.identity(t),mat4.rotateY(t,t,qe),vec3.transformMat4(o,r,i),vec3.transformMat4(o,o,t),vec3.scale(o,o,-e),T.push(o.slice()),O.push.apply(O,_toConsumableArray(o.slice())),vec3.normalize(o,o),F.push.apply(F,_toConsumableArray(o.slice())),U.push([ke,1-K]),O.push(ke,1-K)}if(j>0)for(var ct=T.length,_t=ct-2*(v+1);_t+v+2<ct;_t++)g.push([_t,_t+1,_t+v+1]),E.push(_t,_t+1,_t+v+1),g.push([_t+v+1,_t+1,_t+v+2]),E.push(_t+v+1,_t+1,_t+v+2)}return{cells:g,positions:T,uvs:U,positionsArr:O,indicesArr:E,normalArr:F}}var ng=Ur.Ue(),RI=Ur.Ue(),Ul=Ur.Ue(),M0=Ur.Ue(),kv=Ur.Ue();function ty(e,a,t,i,r){Ur.IH(e,t,i),Ur.Fv(e,e),a=Ur.al(-e[1],e[0]);var o=Ur.al(-t[1],t[0]);return[r/Ur.AK(a,o),a]}function k0(e,a){return Ur.t8(e,-a[1],a[0])}function Iv(e,a,t){return Ur.lu(e,a,t),Ur.Fv(e,e),e}function ry(e,a){return e[0]===a[0]&&e[1]===a[1]}function OI(e){for(var a=new Map,t=0;t<e.length;t++){var i=e[0].toString()+"-"+e[1].toString();a.get(i)?(e.splice(t,1),t++):a.set(i,i)}return e}var pC=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,xt.Z)(this,e),(0,ee.Z)(this,"lastFlip",-1),(0,ee.Z)(this,"miter",Ur.al(0,0)),(0,ee.Z)(this,"started",!1),(0,ee.Z)(this,"dash",!1),(0,ee.Z)(this,"totalDistance",0),(0,ee.Z)(this,"currentIndex",0),this.join=a.join||"miter",this.cap=a.cap||"butt",this.miterLimit=a.miterLimit||10,this.thickness=a.thickness||1,this.dash=a.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,St.Z)(e,[{key:"simpleExtrude",value:function(t){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=i.startIndex,u=1;u<r;u++){var p=t[u-1],v=t[u],g=u<t.length-1?t[u+1]:null,E=this.simpleSegment(i,o,p,v,g);o+=E}if(this.dash)for(var T=0;T<i.positions.length/6;T++)i.positions[T*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude_gaode2",value:function(t,i){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,p=1;p<o;p++){var v,g,E,T=t[p-1];T.push((v=i[p-1][2])!==null&&v!==void 0?v:0);var O=i[p-1],F=t[p];F.push((g=i[p][2])!==null&&g!==void 0?g:0);var U=i[p],j=p<t.length-1?[].concat((0,Ee.Z)(t[p+1]),[(E=i[p+1][2])!==null&&E!==void 0?E:0]):null,K=p<i.length-1?i[p+1]:null,ae=this.simpleSegment(r,u,T,F,j,O,U,K);u+=ae}if(this.dash)for(var ve=0;ve<r.positions.length/6;ve++)r.positions[ve*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude_gaode2",value:function(t,i){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,p=1;p<o;p++){var v,g,E,T=t[p-1];T.push((v=i[p-1][2])!==null&&v!==void 0?v:0);var O=i[p-1],F=t[p];F.push((g=i[p][2])!==null&&g!==void 0?g:0);var U=i[p],j=p<t.length-1?[].concat((0,Ee.Z)(t[p+1]),[(E=i[p+1][2])!==null&&E!==void 0?E:0]):null,K=p<i.length-1?i[p+1]:null,ae=this.segment_gaode2(r,u,T,F,j,O,U,K);u+=ae}if(this.dash)for(var ve=0;ve<r.positions.length/6;ve++)r.positions[ve*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=i.startIndex,u=1;u<r;u++){var p=t[u-1],v=t[u],g=u<t.length-1?t[u+1]:null,E=this.segment(i,o,p,v,g);o+=E}if(this.dash)for(var T=0;T<i.positions.length/6;T++)i.positions[T*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleSegment",value:function(t,i,r,o,u){var p=0,v=t.indices,g=t.positions,E=t.normals,T=za([o[0],o[1]]),O=za([r[0],r[1]]);Iv(Ul,T,O);var F=0;if(this.dash&&(F=this.lineSegmentDistance(T,O),this.totalDistance+=F),this.normal||(this.normal=Ur.Ue(),k0(this.normal,Ul)),this.started||(this.started=!0,this.extrusions(g,E,r,this.normal,this.thickness,this.totalDistance-F)),v.push(i+0,i+1,i+2),!u)k0(this.normal,Ul),this.extrusions(g,E,o,this.normal,this.thickness,this.totalDistance),v.push.apply(v,(0,Ee.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),p+=2;else{var U=za([u[0],u[1]]);ry(T,U)&&Ur.IH(U,T,Ur.Fv(U,Ur.$X(U,T,O))),Iv(M0,U,T);var j=ty(kv,Ur.Ue(),Ul,M0,this.thickness),K=(0,pr.Z)(j,2),ae=K[0],ve=K[1],ke=Ur.AK(kv,this.normal)<0?-1:1;this.extrusions(g,E,o,ve,ae,this.totalDistance),v.push.apply(v,(0,Ee.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),ke=-1,Ur.JG(this.normal,ve),p+=2,this.lastFlip=ke}return p}},{key:"segment_gaode2",value:function(t,i,r,o,u,p,v,g){var E=0,T=t.indices,O=t.positions,F=t.normals,U=this.cap==="square",j=this.join==="bevel",K=za([v[0],v[1]]),ae=za([p[0],p[1]]);Iv(Ul,o,r);var ve=0;if(this.dash&&(ve=this.lineSegmentDistance(K,ae),this.totalDistance+=ve),this.normal||(this.normal=Ur.Ue(),k0(this.normal,Ul)),!this.started)if(this.started=!0,U){var ke=Ur.Ue(),qe=Ur.Ue();Ur.IH(ke,this.normal,Ul),Ur.IH(qe,this.normal,Ul),F.push(qe[0],qe[1],0),F.push(ke[0],ke[1],0),O.push(r[0],r[1],r[2]|0,this.totalDistance-ve,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),O.push(r[0],r[1],r[2]|0,this.totalDistance-ve,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(O,F,r,this.normal,this.thickness,this.totalDistance-ve);if(T.push(i+0,i+1,i+2),u){ry(o,u)&&Ur.IH(u,o,Ur.Fv(u,Ur.$X(u,o,r))),Iv(M0,u,o);var Ot=ty(kv,Ur.Ue(),Ul,M0,this.thickness),Xt=(0,pr.Z)(Ot,2),yr=Xt[0],Pr=Xt[1],xr=Ur.AK(kv,this.normal)<0?-1:1,An=j;if(!An&&this.join==="miter"){var ii=yr;ii>this.miterLimit&&(An=!0)}An?(F.push(this.normal[0],this.normal[1],0),F.push(Pr[0],Pr[1],0),O.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*xr,o[2]|0),this.complex.indexes.push(this.currentIndex),O.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*xr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,T.push.apply(T,(0,Ee.Z)(this.lastFlip!==-xr?[i,i+2,i+3]:[i+2,i+1,i+3])),T.push(i+2,i+3,i+4),k0(ng,M0),Ur.JG(this.normal,ng),F.push(this.normal[0],this.normal[1],0),O.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*xr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,E+=3):(this.extrusions(O,F,o,Pr,yr,this.totalDistance),T.push.apply(T,(0,Ee.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),xr=-1,Ur.JG(this.normal,Pr),E+=2),this.lastFlip=xr}else{if(k0(this.normal,Ul),U){var ct=Ur.Ue(),_t=Ur.Ue();Ur.lu(_t,Ul,this.normal),Ur.IH(ct,Ul,this.normal),F.push(_t[0],_t[1],0),F.push(ct[0],ct[1],0),O.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),O.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(O,F,o,this.normal,this.thickness,this.totalDistance);T.push.apply(T,(0,Ee.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),E+=2}return E}},{key:"segment",value:function(t,i,r,o,u){var p=0,v=t.indices,g=t.positions,E=t.normals,T=this.cap==="square",O=this.join==="bevel",F=za([o[0],o[1]]),U=za([r[0],r[1]]);Iv(Ul,F,U);var j=0;if(this.dash&&(j=this.lineSegmentDistance(F,U),this.totalDistance+=j),this.normal||(this.normal=Ur.Ue(),k0(this.normal,Ul)),!this.started)if(this.started=!0,T){var K=Ur.Ue(),ae=Ur.Ue();Ur.IH(K,this.normal,Ul),Ur.IH(ae,this.normal,Ul),E.push(ae[0],ae[1],0),E.push(K[0],K[1],0),g.push(r[0],r[1],r[2]|0,this.totalDistance-j,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),g.push(r[0],r[1],r[2]|0,this.totalDistance-j,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(g,E,r,this.normal,this.thickness,this.totalDistance-j);if(v.push(i+0,i+1,i+2),u){var qe=za([u[0],u[1]]);ry(F,qe)&&Ur.IH(qe,F,Ur.Fv(qe,Ur.$X(qe,F,U))),Iv(M0,qe,F);var ct=ty(kv,Ur.Ue(),Ul,M0,this.thickness),_t=(0,pr.Z)(ct,2),Ot=_t[0],Xt=_t[1],yr=Ur.AK(kv,this.normal)<0?-1:1,Pr=O;if(!Pr&&this.join==="miter"){var xr=Ot;xr>this.miterLimit&&(Pr=!0)}Pr?(E.push(this.normal[0],this.normal[1],0),E.push(Xt[0],Xt[1],0),g.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*yr,o[2]|0),this.complex.indexes.push(this.currentIndex),g.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*yr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,v.push.apply(v,(0,Ee.Z)(this.lastFlip!==-yr?[i,i+2,i+3]:[i+2,i+1,i+3])),v.push(i+2,i+3,i+4),k0(ng,M0),Ur.JG(this.normal,ng),E.push(this.normal[0],this.normal[1],0),g.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*yr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p+=3):(this.extrusions(g,E,o,Xt,Ot,this.totalDistance),v.push.apply(v,(0,Ee.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),yr=-1,Ur.JG(this.normal,Xt),p+=2),this.lastFlip=yr}else{if(k0(this.normal,Ul),T){var ve=Ur.Ue(),ke=Ur.Ue();Ur.lu(ke,Ul,this.normal),Ur.IH(ve,Ul,this.normal),E.push(ke[0],ke[1],0),E.push(ve[0],ve[1],0),g.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),g.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(g,E,o,this.normal,this.thickness,this.totalDistance);v.push.apply(v,(0,Ee.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),p+=2}return p}},{key:"extrusions",value:function(t,i,r,o,u,p){i.push(o[0],o[1],0),i.push(o[0],o[1],0),t.push(r[0],r[1],r[2]|0,p,-u,r[2]|0),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],r[2]|0,p,u,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,i){var r=i[0]-t[0],o=i[1]-t[1];return Math.sqrt(r*r+o*o)}}]),e}(),ts=vt(77160);function dC(e){var a=e[0][0],t=e[0][e[0].length-1];a[0]===t[0]&&a[1]===t[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,r=vu().flatten(e),o=r.vertices,u=r.dimensions,p=[],v=[],g=0;g<o.length/u;g++)u===2?p.push(o[g*2],o[g*2+1],1):p.push(o[g*3],o[g*3+1],1);var E=vu()(r.vertices,r.holes,r.dimensions);v.push.apply(v,(0,Ee.Z)(E));for(var T=function(U){var j=r.vertices.slice(U*u,(U+1)*u),K=r.vertices.slice((U+1)*u,(U+2)*u);K.length===0&&(K=r.vertices.slice(0,u));var ae=p.length/3;p.push(j[0],j[1],1,K[0],K[1],1,j[0],j[1],0,K[0],K[1],0),v.push.apply(v,(0,Ee.Z)([0,2,1,2,3,1].map(function(ve){return ve+ae})))},O=0;O<i;O++)T(O);return{positions:p,index:v}}function vC(e){var a=vu().flatten(e),t=vu()(a.vertices,a.holes,a.dimensions);return{positions:a.vertices,index:t}}function k_(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=e[0][0],i=e[0][e[0].length-1];t[0]===i[0]&&t[1]===i[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var r=e[0].length,o=vu().flatten(e),u=o.vertices,p=o.dimensions,v=[],g=[],E=[],T=0;T<u.length/p;T++)p===2?v.push(u[T*2],u[T*2+1],1,-1,-1):v.push(u[T*3],u[T*3+1],1,-1,-1),E.push(0,0,1);var O=vu()(o.vertices,o.holes,o.dimensions);g.push.apply(g,(0,Ee.Z)(O));for(var F=function(K){var ae=o.vertices.slice(K*p,(K+1)*p),ve=o.vertices.slice((K+1)*p,(K+2)*p);ve.length===0&&(ve=o.vertices.slice(0,p));var ke=v.length/5;v.push(ae[0],ae[1],1,0,0,ve[0],ve[1],1,.1,0,ae[0],ae[1],0,0,.8,ve[0],ve[1],0,.1,.8);var qe=mC([ve[0],ve[1],1],[ae[0],ae[1],0],[ae[0],ae[1],1],a);E.push.apply(E,(0,Ee.Z)(qe).concat((0,Ee.Z)(qe),(0,Ee.Z)(qe),(0,Ee.Z)(qe))),g.push.apply(g,(0,Ee.Z)([1,2,0,3,2,1].map(function(ct){return ct+ke})))},U=0;U<r;U++)F(U);return{positions:v,index:g,normals:E}}function mC(e,a,t){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,r=ts.create(),o=ts.create(),u=ts.create();i&&(e=io(e),a=io(a),t=io(t));var p=ts.fromValues.apply(ts,(0,Ee.Z)(e)),v=ts.fromValues.apply(ts,(0,Ee.Z)(a)),g=ts.fromValues.apply(ts,(0,Ee.Z)(t));ts.sub(r,g,v),ts.sub(o,p,v),ts.cross(u,r,o);var E=ts.create();return ts.normalize(E,u),E}var Ep,K0;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(K0||(K0={}));var Q0;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Q0||(Q0={}));function mm(e){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.PI*2/e,i=[],r=0;r<e;r++)i.push(t*r+a*Math.PI/12);var o=i.map(function(u){var p=Math.sin(u+Math.PI/4),v=Math.cos(u+Math.PI/4);return[p,v,0]});return o}function I_(){return mm(30)}function P_(){return mm(4)}function L_(){return mm(3)}function R_(){return mm(6,1)}function O_(){return mm(5)}var Pv=(Ep={},(0,ee.Z)(Ep,Q0.CIRCLE,I_),(0,ee.Z)(Ep,Q0.HEXAGON,R_),(0,ee.Z)(Ep,Q0.TRIANGLE,L_),(0,ee.Z)(Ep,Q0.SQUARE,P_),(0,ee.Z)(Ep,Q0.PENTAGON,O_),(0,ee.Z)(Ep,K0.CYLINDER,I_),(0,ee.Z)(Ep,K0.HEXAGONCOLUMN,R_),(0,ee.Z)(Ep,K0.TRIANGLECOLUMN,L_),(0,ee.Z)(Ep,K0.SQUARECOLUMN,P_),(0,ee.Z)(Ep,K0.PENTAGONCOLUMN,O_),Ep),ig={};function J0(e){var a=hu(e.coordinates);return{vertices:[].concat((0,Ee.Z)(a),(0,Ee.Z)(a),(0,Ee.Z)(a),(0,Ee.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function F_(e){var a=hu(e.coordinates),t=M_(a);return{vertices:[].concat((0,Ee.Z)(t),(0,Ee.Z)(t),(0,Ee.Z)(t),(0,Ee.Z)(t)),indices:[0,1,2,2,3,0],size:t.length}}function ny(e){var a=e.shape,t=EC(a,!1),i=t.positions,r=t.index,o=t.normals;return{vertices:i,indices:r,normals:o,size:5}}function gC(e){var a=hu(e.coordinates);return{vertices:(0,Ee.Z)(a),indices:[0],size:a.length}}function ev(e){var a=e.coordinates,t=e.originCoordinates,i=e.version,r=new pC({dash:!0,join:"bevel"});if(i==="GAODE2.x"){var o=a;Array.isArray(o[0][0])||(o=[a]);var u=t;Array.isArray(u[0][0])||(u=[t]);for(var p=0;p<o.length;p++){var v=o[p],g=u[p];r.extrude_gaode2(v,g)}}else{var E=a;E[0]&&!Array.isArray(E[0][0])&&(E=[a]),E.forEach(function(O){r.extrude(O)})}var T=r.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,indexes:T.indexes,size:6}}function yC(e){var a=e.coordinates,t=[],i=_C(a),r=i.results,o=i.totalDistance;return r.map(function(u){t.push(u[0],u[1],u[2],u[3],0,o)}),{vertices:t,indices:[],normals:[],size:6,count:r.length}}function D_(e,a){var t=a[0]-e[0],i=a[1]-e[1];return Math.sqrt(t*t+i*i)}function iy(e,a){return e.length<3&&e.push(0),e.push(a),e}function _C(e){var a=0;if(e.length<2)return{results:e,totalDistance:0};var t=[],i=iy(e[0],a);t.push(i);for(var r=1;r<e.length-1;r++){var o=D_(e[r-1],e[r]);a+=o;var u=iy(e[r],a);t.push(u),t.push(u)}var p=D_(e[e.length-2],e[e.length-1]);return a+=p,t.push(iy(e[e.length-1],a)),{results:t,totalDistance:a}}function gm(e){var a=e.coordinates,t=vu().flatten(a),i=t.vertices,r=t.dimensions,o=t.holes;return{indices:vu()(i,o,r),vertices:i,size:r}}function xC(e){var a=e.coordinates,t=vu().flatten(a),i=t.vertices,r=t.dimensions,o=t.holes;return{indices:vu()(i,o,r),vertices:bC(i),size:r+4}}function bC(e){for(var a=[],t=Ip(e),i=t.center,r=t.radius,o=0;o<e.length;o+=2){var u=e[o],p=e[o+1];a.push.apply(a,[u,p,0].concat((0,Ee.Z)(i),[r]))}return a}function B_(e){var a=e.coordinates,t=k_(a,!0),i=t.positions,r=t.index,o=t.normals;return{vertices:i,indices:r,normals:o,size:5}}function N_(e){var a=e.shape,t=SC(a),i=t.positions,r=t.index;return{vertices:i,indices:r,size:3}}function ay(e){var a=e.coordinates,t=[].concat((0,Ee.Z)(a[0]),[0,0,1,a[1][0],a[0][1],0,1,1],(0,Ee.Z)(a[1]),[0,1,0],(0,Ee.Z)(a[0]),[0,0,1],(0,Ee.Z)(a[1]),[0,1,0,a[0][0],a[1][1],0,0,0]),i=[0,1,2,3,4,5];return{vertices:t,indices:i,size:5}}function ag(e,a){for(var t=a||30,i=e.coordinates,r=[],o=[],u=function(g){r.push(g,1,g,i[0][0],i[0][1],i[1][0],i[1][1],g,-1,g,i[0][0],i[0][1],i[1][0],i[1][1]),g!==t-1&&o.push.apply(o,(0,Ee.Z)([0,1,2,1,3,2].map(function(E){return g*2+E})))},p=0;p<t;p++)u(p);return{vertices:r,indices:o,size:7}}function z_(e){var a=e.coordinates;a.length===2&&a.push(0);var t=e.size,i=og(-1,1),r=og(1,1),o=og(-1,-1),u=og(1,-1),p=[].concat((0,Ee.Z)(a),(0,Ee.Z)(i),(0,Ee.Z)(a),(0,Ee.Z)(o),(0,Ee.Z)(a),(0,Ee.Z)(u),(0,Ee.Z)(a),(0,Ee.Z)(r)),v=[0,1,2,3,0,2];return{vertices:p,indices:v,size:5}}function EC(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(ig&&ig[e])return ig[e];var t=Pv[e]?Pv[e]():Pv.cylinder(),i=k_([t],a);return ig[e]=i,i}function FI(e,a){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,r=new Float32Array(e.length/t*3),o,u,p,v=vec3.create(),g=vec3.create(),E=vec3.create(),T=0,O=a.length;T<O;T+=3){o=a[T+0]*3,u=a[T+1]*3,p=a[T+2]*3;var F=[e[o],e[o+1]],U=[e[u],e[u+1]],j=[e[p],e[p+1]];i&&(F=lngLatToMeters(F),U=lngLatToMeters(U),j=lngLatToMeters(j));var K=F,ae=_slicedToArray(K,2),ve=ae[0],ke=ae[1],qe=vec3.fromValues(ve,ke,e[o+2]),ct=U,_t=_slicedToArray(ct,2),Ot=_t[0],Xt=_t[1],yr=vec3.fromValues(Ot,Xt,e[u+2]),Pr=j,xr=_slicedToArray(Pr,2),An=xr[0],ii=xr[1],sa=vec3.fromValues(An,ii,e[p+2]);vec3.sub(v,sa,yr),vec3.sub(g,qe,yr),vec3.cross(E,v,g),r[o]+=v[0],r[o+1]+=v[1],r[o+2]+=v[2],r[u]+=v[0],r[u+1]+=v[1],r[u+2]+=v[2],r[p]+=v[0],r[p+1]+=v[1],r[p+2]+=v[2]}return CC(r),r}function CC(e){for(var a=0,t=e.length;a<t;a+=3){var i=vec3.fromValues(e[a],e[a+1],e[a+2]),r=vec3.create();vec3.normalize(r,i),e.set(r,a)}}function DI(e){var a=e[0][0],t=e[0][e[0].length-1];return a[0]===t[0]&&a[1]===t[1]}function SC(e){var a=["cylinder","triangleColumn","hexagonColumn","squareColumn"],t=Pv[e]?Pv[e]():Pv.circle(),i=a.indexOf(e)===-1?vC([t]):dC([t]);return i}function og(e,a){var t=(e+1)/2,i=(a+1)/2;return[t,i]}function BI(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),a=e.positionsArr,t=e.indicesArr,i=e.normalArr;return{vertices:a,indices:t,size:5,normals:i}}function NI(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),a=e.positionsArr,t=e.indicesArr,i=e.normalArr;return{vertices:a,indices:t,size:5,normals:i}}function wC(e){var a=AC();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function AC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var TC=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,MC=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,kC=function(e){(0,mr.Z)(t,e);var a=wC(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.baseColor,v=p===void 0?"rgb(16,16,16)":p,g=r.brightColor,E=g===void 0?"rgb(255,176,38)":g,T=r.windowColor,O=T===void 0?"rgb(30,60,89)":T,F=r.time,U=F===void 0?0:F,j=r.sweep,K=j===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:j;return{u_cityCenter:K.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*K.sweepRadius,u_circleSweep:K.enable?1:0,u_circleSweepColor:S(K.sweepColor).slice(0,3),u_circleSweepSpeed:K.sweepSpeed,u_opacity:u,u_baseColor:S(v),u_brightColor:S(E),u_windowColor:S(O),u_time:this.layer.getLayerAnimateTime()||U}}},{key:"calCityGeo",value:function(){var r=(0,pr.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],p=r[2],v=r[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(p+o)/2,(v+u)/2]);var g=this.mapService.lngLatToCoord([p,v]),E=this.mapService.lngLatToCoord([o,u]);this.cityMinSize=Math.sqrt(Math.pow(g[0]-E[0],2)+Math.pow(g[1]-E[1],2))/4}else{var T=p-o,O=v-u;this.cityCenter=[(p+o)/2,(v+u)/2],this.cityMinSize=Math.sqrt(Math.pow(T,2)+Math.pow(O,2))/4}}},{key:"initModels",value:function(r){this.calCityGeo(),this.startModelAnimate(),this.buildModels(r)}},{key:"buildModels",value:function(r){this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:MC,fragmentShader:TC,triangulation:B_,depth:{enable:!0},cull:{enable:!0,face:X.BACK}}).then(function(o){r([o])}).catch(function(o){console.warn(o),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Tn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,p,v,g){return g}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){var g=o.size,E=g===void 0?10:g;return Array.isArray(E)?[E[0]]:[E]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){var g=o.size;return[p[3],p[4]]}}})}}]),t}(ko);function IC(e){var a=PC();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function PC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var LC=function(e){(0,mr.Z)(t,e);var a=IC(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"type","CityBuildingLayer"),i}return(0,St.Z)(t,[{key:"buildModels",value:function(){var r=this;this.layerModel=new kC(this),this.layerModel.initModels(function(o){r.models=o,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"setLight",value:function(r){this.updateLayerConfig({time:r})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),t}(Ld);function RC(e){var a=OC();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function OC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var FC=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,DC=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,BC=function(e){(0,mr.Z)(t,e);var a=RC(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,p=r.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:p||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:FC,fragmentShader:DC,triangulation:N_,primitive:X.TRIANGLES,depth:{enable:!1},stencil:le(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Tn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u){var p=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[p[0],p[1],0]}}})}}]),t}(ko);function NC(e){var a=zC();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function zC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var UC=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,ZC=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,VC=function(e){(0,mr.Z)(t,e);var a=NC(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,p=r.angle;return{u_opacity:o||1,u_coverage:u||1,u_angle:p||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:UC,fragmentShader:ZC,triangulation:ny,primitive:X.TRIANGLES,depth:{enable:!0},blend:this.getBlend(),stencil:le(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){var g=o.size;return Array.isArray(g)?[g[0]]:[g]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Tn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,p,v,g){return g}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Tn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u){var p=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[p[0],p[1],0]}}})}}]),t}(ko);function jC(e,a){for(var t=[],i=[],r=[],o=e+1,u=a+1,p=e/2,v=a/2,g=0;g<u;g++)for(var E=g-v,T=0;T<o;T++){var O=T-p;i.push(O/p,-E/v,0),r.push(T/e),r.push(1-g/a)}for(var F=0;F<a;F++)for(var U=0;U<e;U++){var j=U+o*F,K=U+o*(F+1),ae=U+1+o*(F+1),ve=U+1+o*F;t.push(j,K,ve),t.push(K,ae,ve)}return{vertices:i,indices:t,uvs:r}}var U_,Z_;function GC(e){var a=HC();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function HC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var WC=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,XC=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,YC=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,qC=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,$C=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,KC=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,V_=(U_=(0,vr.b2)(),U_(Z_=function(e){(0,mr.Z)(t,e);var a=GC(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"render",value:function(){var r=this,o=this.rendererService,u=o.clear,p=o.useFramebuffer;p(this.heatmapFramerBuffer,function(){u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:r.heatmapFramerBuffer}),r.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var i=(0,Sa.Z)(zn().mark(function o(u){var p,v,g,E,T,O,F,U,j,K,ae,ve;return zn().wrap(function(qe){for(;;)switch(qe.prev=qe.next){case 0:return v=this.rendererService,g=v.createFramebuffer,E=v.clear,T=v.getViewportSize,O=v.createTexture2D,F=v.useFramebuffer,U=this.styleAttributeService.getLayerStyleAttribute("shape"),j=(U==null||(p=U.scale)===null||p===void 0?void 0:p.field)||"heatmap",this.shapeType=j,qe.next=6,this.buildHeatMapIntensity();case 6:this.intensityModel=qe.sent,this.colorModel=j==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap(),K=T(),ae=K.width,ve=K.height,this.heatmapFramerBuffer=g({color:O({width:Math.floor(ae/4),height:Math.floor(ve/4),wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE,min:X.LINEAR,mag:X.LINEAR}),depth:!1}),this.updateColorTexture(),u([this.intensityModel,this.colorModel]);case 12:case"end":return qe.stop()}},o,this)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"buildModels",value:function(r){this.initModels(r)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Tn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){return[p[3],p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){var g=o.size,E=g===void 0?1:g;return[E]}}})}},{key:"buildHeatMapIntensity",value:function(){var i=(0,Sa.Z)(zn().mark(function o(){var u;return zn().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.layer.triangulation=z_,v.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:KC,fragmentShader:$C,triangulation:z_,depth:{enable:!1},cull:{enable:!0,face:uf(this.mapService.version)},blend:{enable:!0,func:{srcRGB:X.ONE,srcAlpha:1,dstRGB:X.ONE,dstAlpha:1}}});case 3:return u=v.sent,v.abrupt("return",u);case 5:case"end":return v.stop()}},o,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"buildHeatmapColor",value:function(){var r=this.layer.getLayerConfig(),o=r.mask,u=o===void 0?!1:o,p=r.maskInside,v=p===void 0?!0:p;this.shaderModuleService.registerModule("heatmapColor",{vs:qC,fs:YC});var g=this.shaderModuleService.getModule("heatmapColor"),E=g.vs,T=g.fs,O=g.uniforms,F=this.rendererService,U=F.createAttribute,j=F.createElements,K=F.createBuffer,ae=F.createModel;return ae({vs:E,fs:T,attributes:{a_Position:U({buffer:K({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:X.FLOAT}),size:3}),a_Uv:U({buffer:K({data:[0,1,1,1,0,0,1,0],type:X.FLOAT}),size:2})},uniforms:(0,Z.Z)({},O),depth:{enable:!1},blend:this.getBlend(),elements:j({data:[0,2,1,2,3,1],type:X.UNSIGNED_INT,count:6}),stencil:le(u,v)})}},{key:"drawIntensityMode",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity,p=o.intensity,v=p===void 0?10:p,g=o.radius,E=g===void 0?5:g;(r=this.intensityModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_radius:E,u_intensity:v}})}},{key:"drawColorMode",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity;(r=this.colorModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity,p=Ra.create();Ra.invert(p,this.cameraService.getViewProjectionMatrixUncentered()),(r=this.colorModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Ee.Z)(p)}})}},{key:"build3dHeatMap",value:function(){var r=this.layer.getLayerConfig(),o=r.mask,u=o===void 0?!1:o,p=r.maskInside,v=p===void 0?!0:p,g=this.rendererService.getViewportSize,E=g(),T=E.width,O=E.height,F=jC(T/4,O/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:XC,fs:WC});var U=this.shaderModuleService.getModule("heatmap3dColor"),j=U.vs,K=U.fs,ae=U.uniforms,ve=this.rendererService,ke=ve.createAttribute,qe=ve.createElements,ct=ve.createBuffer,_t=ve.createModel;return _t({vs:j,fs:K,attributes:{a_Position:ke({buffer:ct({data:F.vertices,type:X.FLOAT}),size:3}),a_Uv:ke({buffer:ct({data:F.uvs,type:X.FLOAT}),size:2})},primitive:X.TRIANGLES,uniforms:(0,Z.Z)({},ae),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:X.SRC_ALPHA,srcAlpha:1,dstRGB:X.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:qe({data:F.indices,type:X.UNSIGNED_INT,count:F.indices.length}),stencil:le(u,v)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var r=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var o=this.layer.getLayerConfig(),u=o.rampColors,p=N(u);this.colorTexture=r({data:new Uint8Array(p.data),width:p.width,height:p.height,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE,min:X.NEAREST,mag:X.NEAREST,flipY:!1})}}]),t}(ko))||Z_);function QC(e){var a=JC();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function JC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var eS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,tS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,rS=function(e){(0,mr.Z)(t,e);var a=QC(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,p=r.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:p||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:tS,fragmentShader:eS,triangulation:N_,depth:{enable:!1},primitive:X.TRIANGLES,blend:this.getBlend(),stencil:le(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Tn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u){var p=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[p[0],p[1],0]}}})}}]),t}(ko),nS={heatmap:V_,heatmap3d:V_,grid:BC,grid3d:VC,hexagon:rS},iS=nS;function aS(e){var a=oS();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function oS(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var sS=function(e){(0,mr.Z)(t,e);var a=aS(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"type","HeatMapLayer"),i}return(0,St.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new iS[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"renderModels",value:function(){var r=this,o=this.getModelType();return o==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.layerModel.buildModels(function(u){return r.models=u}),this.layerModelNeedUpdate=!1),this.models.forEach(function(u){return u.draw({uniforms:r.layerModel.getUninforms()})}),this)}},{key:"updateModelData",value:function(r){r.attributes&&r.elements?this.models[0].updateAttributesAndElements(r.attributes,r.elements):console.warn("data error")}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var r,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=this.getLayerConfig(),p=u.shape3d,v=this.getSource(),g=v.data.type,E=(o==null||(r=o.scale)===null||r===void 0?void 0:r.field)||"heatmap";return E==="heatmap"||E==="heatmap3d"?"heatmap":g==="hexagon"?(p==null?void 0:p.indexOf(E))===-1?"hexagon":"grid3d":g==="grid"?(p==null?void 0:p.indexOf(E))===-1?"grid":"grid3d":"heatmap"}}]),t}(Ld);function uS(e){var a=lS();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function lS(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var cS=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;

uniform float u_pixelConstant;
uniform float u_pixelConstantR;
uniform float u_pixelConstantG;
uniform float u_pixelConstantB;
uniform float u_pixelConstantRGB;

void main() {
  vec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y));

  float r = baseColor.r;
  float g = baseColor.g;
  float b = baseColor.b;

  float value = u_pixelConstant + ((r * u_pixelConstantR + g * u_pixelConstantG + b * u_pixelConstantB) * u_pixelConstantRGB);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
    gl_FragColor = vec4(0, 0, 0, 0);
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,fS=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,hS=function(e){(0,mr.Z)(t,e);var a=uS(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.clampLow,p=u===void 0?!0:u,v=r.clampHigh,g=v===void 0?!0:v,E=r.noDataValue,T=E===void 0?-9999999:E,O=r.domain,F=O===void 0?[0,1]:O,U=r.rampColors,j=r.pixelConstant,K=j===void 0?0:j,ae=r.pixelConstantR,ve=ae===void 0?256*256:ae,ke=r.pixelConstantG,qe=ke===void 0?256:ke,ct=r.pixelConstantB,_t=ct===void 0?1:ct,Ot=r.pixelConstantRGB,Xt=Ot===void 0?.1:Ot;return(0,Br.isEqual)(this.rampColors,U)||(this.updateColorTexure(),this.rampColors=U),{u_opacity:o||1,u_texture:this.texture,u_pixelConstant:K,u_pixelConstantR:ve,u_pixelConstantG:qe,u_pixelConstantB:_t,u_pixelConstantRGB:Xt,u_domain:F,u_clampLow:p,u_clampHigh:typeof g<"u"?g:p,u_noDataValue:T,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(r){var o=this,u=this.layer.getLayerConfig(),p=u.mask,v=p===void 0?!1:p,g=u.maskInside,E=g===void 0?!0:g,T=u.rampColorsData,O=u.rampColors,F=this.layer.getSource(),U=this.rendererService.createTexture2D;if(this.texture=U({height:0,width:0}),Ts){var j=this.layerService.sceneService.getSceneConfig().canvas,K=j.createImage();K.crossOrigin="anonymous",K.src=F.data.originData,K.onload=function(){o.texture=U({data:K,width:K.width,height:K.height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()}}else F.data.images.then(function(ve){o.texture=U({data:ve[0],width:ve[0].width,height:ve[0].height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()});var ae=T||N(O);this.colorTexture=U({data:ae.data,width:ae.width,height:ae.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:fS,fragmentShader:cS,triangulation:ay,primitive:X.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:le(v,E)}).then(function(ve){r([ve])}).catch(function(ve){console.warn(ve),r([])})}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"buildModels",value:function(r){this.initModels(r)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){return[p[3],p[4]]}}})}},{key:"updateColorTexure",value:function(){var r=this.rendererService.createTexture2D,o=this.layer.getLayerConfig(),u=o.rampColors,p=N(u);this.colorTexture=r({data:p.data,width:p.width,height:p.height,flipY:!1})}}]),t}(ko);function pS(e){var a=dS();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function dS(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var vS=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,mS=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,gS=function(e){(0,mr.Z)(t,e);var a=pS(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity;return{u_opacity:o||1,u_texture:this.texture}}},{key:"initModels",value:function(r){var o=this,u=this.layer.getLayerConfig(),p=u.mask,v=p===void 0?!1:p,g=u.maskInside,E=g===void 0?!0:g,T=this.layer.getSource(),O=this.rendererService.createTexture2D;if(this.texture=O({height:0,width:0}),Ts){var F=this.layerService.sceneService.getSceneConfig().canvas,U=F.createImage();U.crossOrigin="anonymous",U.src=T.data.originData,U.onload=function(){o.texture=O({data:U,width:U.width,height:U.height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()}}else T.data.images.then(function(j){o.texture=O({data:j[0],width:j[0].width,height:j[0].height,mag:X.LINEAR,min:X.LINEAR}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()});this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:mS,fragmentShader:vS,triangulation:ay,primitive:X.TRIANGLES,blend:{enable:!0},depth:{enable:!1},stencil:le(v,E)}).then(function(j){r([j])}).catch(function(j){console.warn(j),r([])})}},{key:"clearModels",value:function(){var r;(r=this.texture)===null||r===void 0||r.destroy()}},{key:"buildModels",value:function(r){this.initModels(r)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){return[p[3],p[4]]}}})}}]),t}(ko),yS={image:gS,dataImage:hS},_S=yS;function xS(e){var a=bS();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function bS(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var j_=function(e){(0,mr.Z)(t,e);var a=xS(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"type","ImageLayer"),i}return(0,St.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new _S[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={image:{},dataImage:{}};return o[r]}},{key:"getModelType",value:function(){var r,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(r=o.scale)===null||r===void 0?void 0:r.field;return u==="dataImage"?"dataImage":(u==="image","image")}}]),t}(Ld);function ES(e){var a=CS();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function CS(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var SS=`uniform float u_opacity;
varying vec4 v_Color;

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
}
`,wS=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"

void main() {

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,AS=function(e){(0,mr.Z)(t,e);var a=ES(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?0:o;return{u_opacity:(0,Br.isNumber)(u)?u:0}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(){var i=(0,Sa.Z)(zn().mark(function o(u){return zn().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:this.layer.buildLayerModel({moduleName:"mask",vertexShader:wS,fragmentShader:SS,triangulation:gm,depth:{enable:!1},blend:this.getBlend(),stencil:{enable:!0,mask:255,func:{cmp:X.ALWAYS,ref:1,mask:255},opFront:{fail:X.REPLACE,zfail:X.REPLACE,zpass:X.REPLACE}}}).then(function(g){u([g])}).catch(function(g){console.warn(g),u([])});case 1:case"end":return v.stop()}},o,this)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),t}(ko),TS={fill:AS},MS=TS;function kS(e){var a=IS();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function IS(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var G_=function(e){(0,mr.Z)(t,e);var a=kS(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"type","MaskLayer"),i}return(0,St.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new MS[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),t}(Ld),PS=["mvt","geojsonvt","testTile"];function oy(e){return PS.indexOf(e)>=0}function sy(e,a){a.map(function(t){var i=qg(e.sceneContainer);t.setContainer(i,e.sceneContainer),t.init()})}function H_(e,a){var t,i=a.getAttribute("shape");if(i&&(t=i.scale)!==null&&t!==void 0&&t.field){var r;return((r=i.scale)===null||r===void 0?void 0:r.values)==="text"?[i.scale.field,i.scale.values]:i.scale.field}switch(e){case"PolygonLayer":return"fill";case"LineLayer":return"tileline";case"PointLayer":return"circle";case"RasterLayer":return"image";default:return""}}function LS(e,a){switch(e){case"PolygonLayer":return!0;case"LineLayer":return!0;case"PointLayer":return!1;case"RasterLayer":return a;default:return a}}function RS(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}function OS(e,a,t,i){var r,o,u,p,v=(e==null||(r=e.bboxPolygon)===null||r===void 0?void 0:r.bbox)||[0,0,10,-10],g=(0,pr.Z)(v,4),E=g[0],T=E===void 0?0:E,O=g[1],F=O===void 0?0:O,U=g[2],j=U===void 0?10:U,K=g[3],ae=K===void 0?-10:K,ve=a.lngLatToContainer([T,F]),ke=a.lngLatToContainer([j,ae]),qe=ke.x-ve.x,ct=ve.y-ke.y,_t=[(t-ve.x)/qe,(i-ke.y)/ct],Ot=(e==null||(o=e.data)===null||o===void 0?void 0:o.width)||1,Xt=(e==null||(u=e.data)===null||u===void 0?void 0:u.height)||1,yr=Math.floor(_t[0]*Ot),Pr=Math.floor(_t[1]*Xt),xr=Math.max(0,Pr-1)*Ot+yr,An=e==null||(p=e.data)===null||p===void 0?void 0:p.data[xr];return An}function zI(e,a,t){var i=t.readPixels,r=t.getContainer,o=e*DOM.DPR,u=a*DOM.DPR,p=RS(r()),v=p.width,g=p.height;if(v*=DOM.DPR,g*=DOM.DPR,o>v-1*DOM.DPR||o<0||u>g-1*DOM.DPR||u<0)return!1;var E=i({x:Math.floor(o),y:Math.floor(g-(a+1)*DOM.DPR),width:1,height:1,data:new Uint8Array(1*1*4)});return E}function FS(e){var a=DS();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function DS(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var BS=`#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6


  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,NS=`
attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform vec2 u_tileOrigin;
uniform float u_coord;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

if(u_coord > 0.0) {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }
} else {
  vec2 pointPos = a_Position.xy;
  vec4 tileWorld = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  tileWorld.xy += pointOffset;

  tileWorld.xy += offset;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    tileWorld.w *= u_PixelsPerMeter.z;
  }

  gl_Position = u_ViewProjectionMatrix * tileWorld + u_ViewportCenterProjection;
}


  setPickingColor(a_PickingColor);


}
`,uy=function(e){(0,mr.Z)(t,e);var a=FS(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.textureBlend,v=p===void 0?"normal":p,g=r.lineTexture,E=g===void 0?!1:g,T=r.iconStep,O=T===void 0?100:T,F=r.vertexHeightScale,U=F===void 0?20:F,j=r.borderWidth,K=j===void 0?0:j,ae=r.borderColor,ve=ae===void 0?"#ccc":ae,ke=r.heightfixed,qe=ke===void 0?!1:ke,ct=r.arrow,_t=ct===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:ct,Ot=r.coord,Xt=Ot===void 0?"lnglat":Ot,yr=r.tileOrigin;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Pr=this.layer.getEncodedData(),xr=this.calDataFrame(this.cellLength,Pr,this.cellProperties),An=xr.data,ii=xr.width,sa=xr.height;this.rowCount=sa,this.dataTexture=this.cellLength>0&&An.length>0?this.createTexture2D({flipY:!0,data:An,format:X.LUMINANCE,type:X.FLOAT,width:ii,height:sa}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_tileOrigin:yr||[0,0],u_coord:Xt==="lnglat"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(u),u_textureBlend:v==="normal"?0:1,u_texture:this.texture,u_line_texture:E?1:0,u_icon_step:O,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:K,u_borderColor:S(ve),u_heightfixed:Number(qe),u_vertexScale:U,u_arrow:Number(_t.enable),u_arrowHeight:_t.arrowHeight||3,u_arrowWidth:_t.arrowWidth||2,u_tailWidth:_t.tailWidth===void 0?1:_t.tailWidth}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var i=(0,Sa.Z)(zn().mark(function o(u){var p,v,g,E,T,O,F;return zn().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:p=this.layer.getLayerConfig(),v=p.mask,g=v===void 0?!1:v,E=p.maskInside,T=E===void 0?!0:E,O=p.depth,F=O===void 0?!1:O,this.layer.triangulation=ev,this.layer.buildLayerModel({moduleName:"lineTile",vertexShader:NS,fragmentShader:BS,triangulation:ev,blend:this.getBlend(),depth:{enable:F},stencil:le(g,T)}).then(function(K){u([K])}).catch(function(K){console.warn(K),u([])});case 3:case"end":return j.stop()}},o,this)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Tn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g,E,T){return T===void 0?[v[3],10]:[v[3],T]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Tn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=u.size,T=E===void 0?1:E;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Tn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,p,v,g,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Tn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){return[v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),T=u.texture,O=E[T]||{x:0,y:0},F=O.x,U=O.y;return[F,U]}}})}}]),t}(ko);function zS(e){var a=US();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function US(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ZS=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,VS=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];

  // styleMappingMat[3][0] \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = mix(u_sourceColor, u_targetColor, styleMappingMat[3][0]);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,W_=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  v_color = a_Color; 
  styleMappingMat[3][0] = a_Distance / a_Total_Distance;

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,X_=function(e){(0,mr.Z)(t,e);var a=zS(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.vertexHeightScale,E=g===void 0?20:g,T=0,O=[0,0,0,0],F=[0,0,0,0];if(p&&v&&(O=S(p),F=S(v),T=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var U=this.layer.getEncodedData(),j=this.calDataFrame(this.cellLength,U,this.cellProperties),K=j.data,ae=j.width,ve=j.height;this.rowCount=ve,this.dataTexture=this.cellLength>0&&K.length>0?this.createTexture2D({flipY:!0,data:K,format:X.LUMINANCE,type:X.FLOAT,width:ae,height:ve}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Br.isNumber)(u)?u:1,u_linearColor:T,u_sourceColor:O,u_targetColor:F,u_vertexScale:E}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:VS,vert:W_,type:"lineSimpleLinear"}:{frag:ZS,vert:W_,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v,E=this.getShaders(),T=E.frag,O=E.vert,F=E.type;this.layer.buildLayerModel({moduleName:F,vertexShader:O,fragmentShader:T,triangulation:yC,primitive:X.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:le(p,g)}).then(function(U){r([U])}).catch(function(U){console.warn(U),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:Tn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){return[p[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Tn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){var g=o.size,E=g===void 0?1:g;return Array.isArray(E)?[E[0],E[1]]:[E,0]}}})}}]),t}(ko);function jS(e,a){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=GS(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function GS(e,a){if(!!e){if(typeof e=="string")return Y_(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Y_(e,a)}}function Y_(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var HS=function(){function e(a,t,i){(0,xt.Z)(this,e),(0,ee.Z)(this,"boxCells",[]);var r=this.boxCells;this.xCellCount=Math.ceil(a/i),this.yCellCount=Math.ceil(t/i);for(var o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]);this.boxKeys=[],this.bboxes=[],this.width=a,this.height=t,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/t,this.boxUid=0}return(0,St.Z)(e,[{key:"insert",value:function(t,i,r,o,u){this.forEachCell(i,r,o,u,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(u)}},{key:"query",value:function(t,i,r,o,u){return this.queryHitTest(t,i,r,o,!1,u)}},{key:"hitTest",value:function(t,i,r,o,u){return this.queryHitTest(t,i,r,o,!0,u)}},{key:"insertBoxCell",value:function(t,i,r,o,u,p){this.boxCells[u].push(p)}},{key:"queryHitTest",value:function(t,i,r,o,u,p){if(r<0||t>this.width||o<0||i>this.height)return u?!1:[];var v=[];if(t<=0&&i<=0&&this.width<=r&&this.height<=o){if(u)return!0;for(var g=0;g<this.boxKeys.length;g++)v.push({key:this.boxKeys[g],x1:this.bboxes[g*4],y1:this.bboxes[g*4+1],x2:this.bboxes[g*4+2],y2:this.bboxes[g*4+3]});return p?v.filter(p):v}var E={hitTest:u,seenUids:{box:{},circle:{}}};return this.forEachCell(t,i,r,o,this.queryCell,v,E,p),u?v.length>0:v}},{key:"queryCell",value:function(t,i,r,o,u,p,v,g){var E=v.seenUids,T=this.boxCells[u];if(T!==null){var O=this.bboxes,F=jS(T),U;try{for(F.s();!(U=F.n()).done;){var j=U.value;if(!E.box[j]){E.box[j]=!0;var K=j*4;if(t<=O[K+2]&&i<=O[K+3]&&r>=O[K+0]&&o>=O[K+1]&&(!g||g(this.boxKeys[j]))){if(v.hitTest)return p.push(!0),!0;p.push({key:this.boxKeys[j],x1:O[K],y1:O[K+1],x2:O[K+2],y2:O[K+3]})}}}}catch(ae){F.e(ae)}finally{F.f()}}return!1}},{key:"forEachCell",value:function(t,i,r,o,u,p,v,g){for(var E=this.convertToXCellCoord(t),T=this.convertToYCellCoord(i),O=this.convertToXCellCoord(r),F=this.convertToYCellCoord(o),U=E;U<=O;U++)for(var j=T;j<=F;j++){var K=this.xCellCount*j+U;if(u.call(this,t,i,r,o,K,p,v,g))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),e}(),WS=HS,q_=function(){function e(a,t){(0,xt.Z)(this,e),(0,ee.Z)(this,"viewportPadding",100),this.width=a,this.height=t,this.viewportPadding=Math.max(a,t),this.grid=new WS(a+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=a+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=a+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}return(0,St.Z)(e,[{key:"placeCollisionBox",value:function(t){var i=t.x1+t.anchorPointX+this.viewportPadding,r=t.y1+t.anchorPointY+this.viewportPadding,o=t.x2+t.anchorPointX+this.viewportPadding,u=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(i,r,o,u)||this.grid.hitTest(i,r,o,u)?{box:[]}:{box:[i,r,o,u]}}},{key:"insertCollisionBox",value:function(t,i){var r={featureIndex:i};this.grid.insert(r,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,i,r){var o=cp.al(i,r,0,1),u=cp.Ue(),p=Ra.fromValues.apply(Ra,(0,Ee.Z)(t));return cp.fF(u,o,p),{x:(u[0]/u[3]+1)/2*this.width+this.viewportPadding,y:(-u[1]/u[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,i,r,o){return r>=0&&t<this.gridRightBoundary&&o>=0&&i<this.gridBottomBoundary}}]),e}();function $_(e,a){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=XS(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function XS(e,a){if(!!e){if(typeof e=="string")return K_(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return K_(e,a)}}function K_(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function Q_(e){var a=.5,t=.5;switch(e){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0;break;default:a=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0;break;default:t=.5}return{horizontalAlign:a,verticalAlign:t}}function J_(e,a,t,i,r){if(!!r){var o=e[i],u=o.glyph;if(u)for(var p=a[u].advance*o.scale,v=(e[i].x+p)*r,g=t;g<=i;g++)e[g].x-=v}}function ex(e,a,t,i,r,o,u){var p=(a-t)*r,v=(-i*u+.5)*o,g=$_(e),E;try{for(g.s();!(E=g.n()).done;){var T=E.value;T.x+=p,T.y+=v}}catch(O){g.e(O)}finally{g.f()}}function YS(e,a,t,i,r,o,u){var p=-8,v=0,g=p,E=0,T=e.positionedGlyphs,O=o==="right"?1:o==="left"?0:.5,F=T.length;t.forEach(function(ve){if(ve.split("").forEach(function(qe){var ct=a[qe],_t=0;ct&&(T.push({glyph:qe,x:v,y:g+_t,vertical:!1,scale:1,metrics:ct}),v+=ct.advance+u)}),T.length!==F){var ke=v-u;E=Math.max(ke,E),J_(T,a,F,T.length-1,O)}v=0,g-=i+5});var U=Q_(r),j=U.horizontalAlign,K=U.verticalAlign;ex(T,O,j,K,E,i,t.length);var ae=g-p;e.top+=-K*ae,e.bottom=e.top-ae,e.left+=-j*E,e.right=e.left+E}function qS(e,a,t,i,r,o,u){var p=-8,v=0,g=p,E=0,T=e.positionedGlyphs,O=o==="right"?1:o==="left"?0:.5,F=T.length;t.forEach(function(ve){var ke=a[ve],qe=0;if(ke&&(T.push({glyph:ve,x:ke.advance/2,y:g+qe,vertical:!1,scale:1,metrics:ke}),v+=ke.advance+u),T.length!==F){var ct=v-u;E=Math.max(ct,E),J_(T,a,F,T.length-1,O)}v=0,g-=i+5});var U=Q_(r),j=U.horizontalAlign,K=U.verticalAlign;ex(T,O,j,K,E,i,t.length);var ae=g-p;e.top+=-K*ae,e.bottom=e.top-ae,e.left+=-j*E,e.right=e.left+E}function tx(e,a,t,i,r,o){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],p=arguments.length>7?arguments[7]:void 0,v=e.split(`
`),g=[],E={positionedGlyphs:g,top:u[1],bottom:u[1],left:u[0],right:u[0],lineCount:v.length,text:e};return p?qS(E,a,v,t,i,r,o):YS(E,a,v,t,i,r,o),g.length?E:!1}function rx(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],t=arguments.length>2?arguments[2]:void 0,i=e.positionedGlyphs,r=i===void 0?[]:i,o=[],u=$_(r),p;try{for(u.s();!(p=u.n()).done;){var v=p.value,g=v.metrics,E=4,T=g.advance*v.scale/2,O=t?[v.x+T,v.y]:[0,0],F=t?[0,0]:[v.x+T+a[0],v.y+a[1]],U=(0-E)*v.scale-T+F[0],j=(0-E)*v.scale+F[1],K=U+g.width*v.scale,ae=j+g.height*v.scale,ve={x:U,y:j},ke={x:K,y:j},qe={x:U,y:ae},ct={x:K,y:ae};o.push({tl:ve,tr:ke,bl:qe,br:ct,tex:g,glyphOffset:O})}}catch(_t){u.e(_t)}finally{u.f()}return o}function $S(e,a){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=KS(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function KS(e,a){if(!!e){if(typeof e=="string")return nx(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return nx(e,a)}}function nx(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function QS(e){var a=JS();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function JS(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ix=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ax=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function ox(e){var a=this,t=e.id,i=[],r=[];if(!a.glyphInfoMap||!a.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var o=a.glyphInfoMap[t].centroid,u=o.length===2?[o[0],o[1],0]:o;return a.glyphInfoMap[t].glyphQuads.forEach(function(p,v){i.push.apply(i,(0,Ee.Z)(u).concat([p.tex.x,p.tex.y+p.tex.height,p.tl.x,p.tl.y],(0,Ee.Z)(u),[p.tex.x+p.tex.width,p.tex.y+p.tex.height,p.tr.x,p.tr.y],(0,Ee.Z)(u),[p.tex.x+p.tex.width,p.tex.y,p.br.x,p.br.y],(0,Ee.Z)(u),[p.tex.x,p.tex.y,p.bl.x,p.bl.y])),r.push(0+v*4,1+v*4,2+v*4,2+v*4,3+v*4,0+v*4)}),{vertices:i,indices:r,size:7}}var sx=function(e){(0,mr.Z)(t,e);var a=QS(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"glyphInfoMap",{}),(0,ee.Z)((0,dt.Z)(i),"currentZoom",-1),(0,ee.Z)((0,dt.Z)(i),"textureHeight",0),(0,ee.Z)((0,dt.Z)(i),"textCount",0),(0,ee.Z)((0,dt.Z)(i),"preTextStyle",{}),(0,ee.Z)((0,dt.Z)(i),"buildModels",function(){var p=(0,Sa.Z)(zn().mark(function v(g){var E,T,O,F,U;return zn().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:E=i.layer.getLayerConfig(),T=E.mask,O=T===void 0?!1:T,F=E.maskInside,U=F===void 0?!0:F,i.mapping(),i.layer.buildLayerModel({moduleName:"pointText",vertexShader:ax,fragmentShader:ix,triangulation:ox.bind((0,dt.Z)(i)),depth:{enable:!1},blend:i.getBlend(),stencil:le(O,U)}).then(function(ae){g([ae])}).catch(function(ae){console.warn(ae),g([])});case 3:case"end":return K.stop()}},v)}));return function(v){return p.apply(this,arguments)}}()),(0,ee.Z)((0,dt.Z)(i),"mapping",function(){i.initGlyph(),i.updateTexture(),i.filterGlyphs(),i.reBuildModel()}),i}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.stroke,v=p===void 0?"#fff":p,g=r.strokeWidth,E=g===void 0?0:g,T=r.textAnchor,O=T===void 0?"center":T,F=r.textAllowOverlap,U=F===void 0?!1:F,j=r.halo,K=j===void 0?.5:j,ae=r.gamma,ve=ae===void 0?2:ae,ke=r.raisingHeight,qe=ke===void 0?0:ke,ct=this.fontService,_t=ct.canvas,Ot=ct.mapping;if(Object.keys(Ot).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Ot).length),this.preTextStyle={textAnchor:O,textAllowOverlap:U},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeWidth:E,stroke:v})){this.judgeStyleAttributes({opacity:u,strokeWidth:E,stroke:v});var Xt=this.layer.getEncodedData(),yr=this.calDataFrame(this.cellLength,Xt,this.cellProperties),Pr=yr.data,xr=yr.width,An=yr.height;this.rowCount=An,this.dataTexture=this.cellLength>0&&Pr.length>0?this.createTexture2D({flipY:!0,data:Pr,format:X.LUMINANCE,type:X.FLOAT,width:xr,height:An}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(qe),u_opacity:(0,Br.isNumber)(u)?u:1,u_stroke_width:(0,Br.isNumber)(E)?E:1,u_stroke_color:this.getStrokeColor(v),u_sdf_map:this.texture,u_halo_blur:K,u_gamma_scale:ve,u_sdf_map_size:[_t.width,_t.height]}}},{key:"initModels",value:function(r){this.layer.on("remapping",this.mapping),this.extent=this.textExtent();var o=this.layer.getLayerConfig(),u=o.textAnchor,p=u===void 0?"center":u,v=o.textAllowOverlap,g=v===void 0?!0:v;this.preTextStyle={textAnchor:p,textAllowOverlap:g},this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Tn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){var g=o.rotate,E=g===void 0?0:g;return Array.isArray(E)?[E[0]]:[E]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Tn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){return[p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){var g=o.size,E=g===void 0?12:g;return Array.isArray(E)?[E[0]]:[E]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Tn.Attribute,descriptor:{name:"a_tex",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){return[p[3],p[4]]}}})}},{key:"textExtent",value:function(){var r=this.mapService.getBounds();return hc(r,.5)}},{key:"initTextFont",value:function(){var r=this.layer.getLayerConfig(),o=r.fontWeight,u=o===void 0?"400":o,p=r.fontFamily,v=p===void 0?"sans-serif":p,g=this.layer.getEncodedData(),E=[];g.forEach(function(T){var O=T.shape,F=O===void 0?"":O;F=F.toString();var U=$S(F),j;try{for(U.s();!(j=U.n()).done;){var K=j.value;E.indexOf(K)===-1&&E.push(K)}}catch(ae){U.e(ae)}finally{U.f()}}),this.fontService.setFontOptions({characterSet:E,fontWeight:u,fontFamily:v,iconfont:!1})}},{key:"initIconFontTex",value:function(){var r=this.layer.getLayerConfig(),o=r.fontWeight,u=o===void 0?"400":o,p=r.fontFamily,v=p===void 0?"sans-serif":p,g=this.layer.getEncodedData(),E=[];g.forEach(function(T){var O=T.shape,F=O===void 0?"":O;F="".concat(F),E.indexOf(F)===-1&&E.push(F)}),this.fontService.setFontOptions({characterSet:E,fontWeight:u,fontFamily:v,iconfont:!0})}},{key:"generateGlyphLayout",value:function(r){var o=this,u=this.fontService.mapping,p=this.layer.getLayerConfig(),v=p.spacing,g=v===void 0?2:v,E=p.textAnchor,T=E===void 0?"center":E,O=this.layer.getEncodedData();this.glyphInfo=O.map(function(F){var U=F.shape,j=U===void 0?"":U,K=F.id,ae=F.size,ve=ae===void 0?1:ae,ke=F.textOffset,qe=ke===void 0?[0,0]:ke,ct=tx(j.toString(),u,ve,T,"left",g,qe,r),_t=rx(ct,qe,!1);return F.shaping=ct,F.glyphQuads=_t,F.centroid=hu(F.coordinates),F.originCentroid=F.version==="GAODE2.x"?hu(F.originCoordinates):F.originCentroid=F.centroid,o.glyphInfoMap[K]={shaping:ct,glyphQuads:_t,centroid:hu(F.coordinates)},F})}},{key:"filterGlyphs",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.padding,p=u===void 0?[4,4]:u,v=o.textAllowOverlap,g=v===void 0?!1:v;if(!g){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var E=this.rendererService.getViewportSize(),T=E.width,O=E.height,F=new q_(T,O),U=this.glyphInfo.filter(function(j){var K=j.shaping,ae=j.id,ve=ae===void 0?0:ae,ke=j.version==="GAODE2.x"?j.originCentroid:j.centroid,qe=j.size,ct=qe/24,_t=r.mapService.lngLatToContainer(ke),Ot=F.placeCollisionBox({x1:K.left*ct-p[0],x2:K.right*ct+p[0],y1:K.top*ct-p[1],y2:K.bottom*ct+p[1],anchorPointX:_t.x,anchorPointY:_t.y}),Xt=Ot.box;return Xt&&Xt.length?(F.insertCollisionBox(Xt,ve),!0):!1});U.forEach(function(j){r.glyphInfoMap[j.id]=j})}}},{key:"initGlyph",value:function(){var r=this.layer.getLayerConfig(),o=r.iconfont,u=o===void 0?!1:o;u?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(u)}},{key:"updateTexture",value:function(){var r=this.rendererService.createTexture2D,o=this.fontService.canvas;this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=r({data:o,mag:X.LINEAR,min:X.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointTileText",vertexShader:ax,fragmentShader:ix,triangulation:ox.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:le(p,g)}).then(function(E){r.layer.models=[E],r.layer.renderLayers()}).catch(function(E){console.warn(E),r.layer.models=[]})}}]),t}(ko);function ew(e){var a=tw();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function tw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var rw=`uniform float u_additive;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,nw=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

uniform vec2 u_tileOrigin;
uniform float u_coord;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  v_color = a_Color;
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
  }

if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
  }
} else {
  gl_PointSize = 24.0;
  vec2 pointPos = a_Position.xy;
  vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  world.xy += offset;
  world.xy += pointOffset;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    world.w *= u_PixelsPerMeter.z;
  }

  gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
}

 
  setPickingColor(a_PickingColor);


}
`,sg=function(e){(0,mr.Z)(t,e);var a=ew(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"meter2coord",1),(0,ee.Z)((0,dt.Z)(i),"isMeter",!1),i}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.strokeOpacity,v=p===void 0?1:p,g=r.strokeWidth,E=g===void 0?0:g,T=r.stroke,O=T===void 0?"rgba(0,0,0,0)":T,F=r.offsets,U=F===void 0?[0,0]:F,j=r.blend,K=r.blur,ae=K===void 0?0:K,ve=r.coord,ke=ve===void 0?"lnglat":ve,qe=r.tileOrigin;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:v,strokeWidth:E,stroke:O,offsets:U})){this.judgeStyleAttributes({opacity:u,strokeOpacity:v,strokeWidth:E,stroke:O,offsets:U});var ct=this.layer.getEncodedData(),_t=this.calDataFrame(this.cellLength,ct,this.cellProperties),Ot=_t.data,Xt=_t.width,yr=_t.height;this.rowCount=yr,this.dataTexture=this.cellLength>0&&Ot.length>0?this.createTexture2D({flipY:!0,data:Ot,format:X.LUMINANCE,type:X.FLOAT,width:Xt,height:yr}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_tileOrigin:qe||[0,0],u_coord:ke==="lnglat"?1:0,u_isMeter:Number(this.isMeter),u_blur:ae,u_additive:j==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(u),u_stroke_opacity:Number(v),u_stroke_width:Number(E),u_stroke_color:this.getStrokeColor(O),u_offsets:this.isOffsetStatic(U)?U:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),J0)}},{key:"initModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.unit,p=u===void 0?"l7size":u,v=this.mapService.version;p==="meter"&&v!==ju.L7MAP&&v!==ju.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(r)}},{key:"calMeter2Coord",value:function(){var r=(0,pr.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],p=r[2],v=r[3],g=[(o+p)/2,(u+v)/2],E=this.mapService.version;if(E===ju.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:g[0],lat:g[1]},0),O=1,F=O*T.meterInMercatorCoordinateUnits(),U=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),j=U.toLngLat();this.meter2coord=g[0]-j.lng;return}var K=this.mapService.meterToCoord(g,[o,u]),ae=this.mapService.meterToCoord(g,[p===o?p+.1:p,v===u?u+.1:v]);this.meter2coord=(K+ae)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v,E=o.workerEnabled,T=E===void 0?!1:E;this.layer.triangulation=J0,this.layer.buildLayerModel({moduleName:"pointTile",vertexShader:nw,fragmentShader:rw,triangulation:J0,depth:{enable:!1},cull:{enable:!0,face:uf(this.mapService.version)},blend:this.getBlend(),stencil:le(p,g),workerEnabled:T,workerOptions:{modelType:"pointTile"}}).then(function(O){r([O])}).catch(function(O){console.warn(O),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Tn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,p,v,g){var E=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],T=g%4*3;return[E[T],E[T+1],E[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,T=E===void 0?5:E;return Array.isArray(T)?[T[0]*r.meter2coord]:[T*r.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Tn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.shape,T=E===void 0?2:E,O=r.layer.getLayerConfig().shape2d,F=O.indexOf(T);return[F]}}})}}]),t}(ko);function iw(e){var a=aw();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function aw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ow=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,sw=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;

uniform vec2 u_tileOrigin;
uniform float u_coord;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
  }

if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
} else {
    vec2 pointPos = a_Position.xy;
    vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

    vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
    
    world.xy += pointOffset;

    if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // Needs to be divided with project_uCommonUnitsPerMeter
      world.w *= u_PixelsPerMeter.z;
    }

    gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
}


  setPickingColor(a_PickingColor);
}

`,ux=function(e){(0,mr.Z)(t,e);var a=iw(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.tileOrigin,v=r.coord,g=v===void 0?"lnglat":v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var E=this.layer.getEncodedData(),T=this.calDataFrame(this.cellLength,E,this.cellProperties),O=T.data,F=T.width,U=T.height;this.rowCount=U,this.dataTexture=this.cellLength>0&&O.length>0?this.createTexture2D({flipY:!0,data:O,format:X.LUMINANCE,type:X.FLOAT,width:F,height:U}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_tileOrigin:p||[0,0],u_coord:g==="lnglat"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:u}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.triangulation=gm,this.layer.buildLayerModel({moduleName:"polygonTile",vertexShader:sw,fragmentShader:ow,triangulation:gm,primitive:X.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:le(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),t}(ko);function uw(e){var a=lw();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function lw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ly=function(e){(0,mr.Z)(t,e);var a=uw(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"isVector",!0),(0,ee.Z)((0,dt.Z)(i),"type",i.layerType),(0,ee.Z)((0,dt.Z)(i),"pickedID",null),i}return(0,St.Z)(t,[{key:"getPickID",value:function(){return this.pickedID}},{key:"setPickID",value:function(){return this.pickedID}},{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new o(this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getModelType",value:function(){switch(this.layerType){case"PolygonLayer":return ux;case"LineLayer":return this.getLineModel();case"PointLayer":return this.getPointModel();default:return sg}}},{key:"getLineModel",value:function(){var r,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(r=o.scale)===null||r===void 0?void 0:r.field;switch(u){case"tileline":case"line":return uy;case"simple":return X_;default:return uy}}},{key:"getPointModel",value:function(){var r=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,p=r.find(function(g){return g.hasOwnProperty("shape")});if(p){var v=p.shape;return(u==null?void 0:u.indexOf(v))!==-1?sg:sx}else return sg}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{}}}]),t}(Ld),cw=vt(32676);function fw(e,a,t){t===void 0&&(t={});var i=je(e),r=je(a),o=cw.union(i.coordinates,r.coordinates);return o.length===0?null:o.length===1?ai(o[0],t.properties):Hi(o,t.properties)}var hw=fw;function pw(e,a){a===void 0&&(a={});var t=je(e);switch(!a.properties&&e.type==="Feature"&&(a.properties=e.properties),t.type){case"Polygon":return dw(t,a);case"MultiPolygon":return vw(t,a);default:throw new Error("invalid poly")}}function dw(e,a){a===void 0&&(a={});var t=je(e),i=t.coordinates,r=a.properties?a.properties:e.type==="Feature"?e.properties:{};return lx(i,r)}function vw(e,a){a===void 0&&(a={});var t=je(e),i=t.coordinates,r=a.properties?a.properties:e.type==="Feature"?e.properties:{},o=[];return i.forEach(function(u){o.push(lx(u,r))}),Ti(o)}function lx(e,a){return e.length>1?Ca(e,a):Ba(e[0],a)}var Lv=function(){function e(a){(0,xt.Z)(this,e),(0,ee.Z)(this,"outSideEventTimer",null),(0,ee.Z)(this,"eventCache",{click:0,mousemove:0,mouseup:0,mousedown:0,contextmenu:0}),this.parentLayer=a.parent,this.mapService=a.mapService,this.rendererService=a.rendererService;var t=this.parentLayer.getSource();this.zoomOffset=t.parser.zoomOffset||0,this.tilesetManager=t.tileset}return(0,St.Z)(e,[{key:"createTile",value:function(t,i){return{layers:[],layerIDList:[]}}},{key:"getFeatureData",value:function(t,i){var r={features:[],featureId:null,vectorTileLayer:null,source:null},o=i.sourceLayer,u=i.featureId,p=i.transforms,v=i.layerType,g=i.shape;if(!o)return r;var E=t.data.layers[o],T=E==null?void 0:E.features;if(Array.isArray(T)&&T.length>0){var O=[];v==="LineLayer"&&g==="simple"?T.map(function(U){if(U.geometry.type==="MultiPolygon"){var j,K=pw(U).features;(j=O).push.apply(j,(0,Ee.Z)(K))}else U.geometry.type==="Polygon"&&(U.geometry.type="MultiLineString"),O.push(U)}):O=T;var F=new Mi({type:"FeatureCollection",features:O},{parser:{type:"geojson",featureId:u},transforms:p});return{features:O,featureId:u,vectorTileLayer:E,source:F}}else return r}},{key:"createLayer",value:function(t){var i=t.L7Layer,r=t.tile,o=t.initOptions,u=t.vectorTileLayer,p=t.source,v=o.mask,g=o.color,E=o.layerType,T=o.size,O=o.shape,F=i||ly,U=new F((0,Z.Z)({visible:r.isVisible,tileOrigin:u==null?void 0:u.l7TileOrigin,coord:u==null?void 0:u.l7TileCoord},this.getLayerInitOption(o)));U.isVector&&(this.emitEvent([U]),U.type=E,U.select(!0)),U.source(p),this.setScale(U),this.setStyleAttributeField(U,"shape",O),this.setStyleAttributeField(U,"color",g),this.setStyleAttributeField(U,"size",T);var j=[U];if(v&&U.isVector){var K=new G_().source({type:"FeatureCollection",features:[r.bboxPolygon]}).shape("fill");j.push(K),U.addMaskLayer(K)}return sy(this.parentLayer,j),this.layers=[U],U}},{key:"updateStyle",value:function(t){return""}},{key:"getDefautStyleAttributeField",value:function(t,i){switch(i){case"size":return 2;case"color":return"#fff";case"shape":return H_(this.parentLayer.type,t);default:return""}}},{key:"setStyleAttributeField",value:function(t,i,r){if(Array.isArray(r)){t[i].apply(t,(0,Ee.Z)(r));return}if(typeof r=="string"){t[i](r);return}var o=this.getDefautStyleAttributeField(t,i);if(!r)return t[i](o),t;var u=this.parseScaleValue(r,i);u.length===0?t[i](o):t[i].apply(t,(0,Ee.Z)(u))}},{key:"parseScaleValue",value:function(t,i){if(i==="shape")return typeof t=="string"?[t]:t!=null&&t.field?[t==null?void 0:t.field]:[];var r=t,o=r.field,u=r.values,p=r.callback;return o&&u&&Array.isArray(u)?[o,u]:o&&p?[o,p]:o?[o]:[]}},{key:"getTile",value:function(t,i){var r=this.mapService.getZoom(),o=Math.ceil(r)+this.zoomOffset,u=Nd(t,i,o),p=this.tilesetManager.tiles.filter(function(g){return g.key==="".concat(u[0],",").concat(u[1],",").concat(o)}),v=p[0];return v}},{key:"emitEvent",value:function(t,i){var r=this;t.map(function(o){o.once("inited",function(){o.on("click",function(u){if(r.eventCache.click=1,r.parentLayer.type==="RasterLayer"){var p=u.lngLat,v=p.lng,g=p.lat,E=r.getTile(v,g);r.getFeatureAndEmitEvent(o,"subLayerClick",u,i,E)}else r.getFeatureAndEmitEvent(o,"subLayerClick",u)}),o.on("mousemove",function(u){if(r.eventCache.mousemove=1,r.parentLayer.type==="RasterLayer"){var p=u.lngLat,v=p.lng,g=p.lat,E=r.getTile(v,g);r.getFeatureAndEmitEvent(o,"subLayerMouseMove",u,i,E)}else r.getFeatureAndEmitEvent(o,"subLayerMouseMove",u)}),o.on("mouseup",function(u){r.eventCache.mouseup=1,r.getFeatureAndEmitEvent(o,"subLayerMouseUp",u)}),o.on("mouseenter",function(u){if(r.parentLayer.type==="RasterLayer"){var p=u.lngLat,v=p.lng,g=p.lat,E=r.getTile(v,g);r.getFeatureAndEmitEvent(o,"subLayerMouseMove",u,i,E)}else r.getFeatureAndEmitEvent(o,"subLayerMouseEnter",u)}),o.on("mouseout",function(u){r.getFeatureAndEmitEvent(o,"subLayerMouseOut",u)}),o.on("mousedown",function(u){r.eventCache.mousedown=1,r.getFeatureAndEmitEvent(o,"subLayerMouseDown",u)}),o.on("contextmenu",function(u){r.eventCache.contextmenu=1,r.getFeatureAndEmitEvent(o,"subLayerContextmenu",u)}),o.on("unclick",function(u){return r.handleOutsideEvent("click","subLayerUnClick",o,u)}),o.on("unmouseup",function(u){return r.handleOutsideEvent("mouseup","subLayerUnMouseUp",o,u)}),o.on("unmousedown",function(u){return r.handleOutsideEvent("mousedown","subLayerUnMouseDown",o,u)}),o.on("uncontextmenu",function(u){return r.handleOutsideEvent("contextmenu","subLayerUnContextmenu",o,u)})})})}},{key:"getCombineFeature",value:function(t){var i=null,r=t[0];return t.map(function(o){var u=ai(o.coordinates);i===null&&(i=u),i=hw(i,u)}),r&&(i.properties=(0,Z.Z)({},r)),i}},{key:"getFeatureAndEmitEvent",value:function(t,i,r,o,u){if(o===!1)r.value=OS(u,this.mapService,r.x,r.y);else{var p=r.featureId,v=this.getAllFeatures(p);try{r.feature=this.getCombineFeature(v)}catch{console.warn("Combine Featuer Err! Return First Feature!"),r.feature=v[0]}}this.parentLayer.emit(i,r)}},{key:"setScale",value:function(t){var i=this.parentLayer.tileLayer.scaleField,r=Object.keys(i);r.map(function(o){t.scale(o,i[o])})}},{key:"getAllFeatures",value:function(t){var i=this.parentLayer.tileLayer.children,r=[];return i.map(function(o){var u=o.getSource();u.data.dataArray.map(function(p){p._id===t&&r.push(p)})}),r}},{key:"getLayerInitOption",value:function(t){var i=(0,Z.Z)({},t);return delete i.color,delete i.shape,delete i.size,delete i.coords,delete i.sourceLayer,delete i.coords,i}},{key:"handleOutsideEvent",value:function(t,i,r,o){var u=this;this.outSideEventTimer&&(clearTimeout(this.outSideEventTimer),this.outSideEventTimer=null),this.outSideEventTimer=setTimeout(function(){u.eventCache[t]>0?u.eventCache[t]=0:u.getFeatureAndEmitEvent(r,i,o)},64)}}]),e}();function mw(e){var a=gw();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function gw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var yw=function(e){(0,mr.Z)(t,e);var a=mw(t);function t(i){var r;return(0,xt.Z)(this,t),r=a.call(this,i),r.parentLayer=i.parent,r}return(0,St.Z)(t,[{key:"createTile",value:function(r,o){var u=this.getFeatureData(r,o),p=u.features,v=u.vectorTileLayer,g=u.source;if(p.length===0)return{layers:[],layerIDList:[]};var E=this.createLayer({tile:r,initOptions:o,vectorTileLayer:v,source:g});return{layers:[E],layerIDList:[E.id]}}}]),t}(Lv);function _w(e){var a=xw();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function xw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var bw=function(e){(0,mr.Z)(t,e);var a=_w(t);function t(i){var r;return(0,xt.Z)(this,t),r=a.call(this,i),r.parentLayer=i.parent,r}return(0,St.Z)(t,[{key:"createTile",value:function(r,o){var u=this.getFeatureData(r,o),p=u.features,v=u.vectorTileLayer,g=u.source;if(p.length===0)return{layers:[],layerIDList:[]};var E=this.createLayer({tile:r,initOptions:o,vectorTileLayer:v,source:g});return{layers:[E],layerIDList:[E.id]}}}]),t}(Lv);function Ew(e){var a=Cw();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function Cw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Sw=function(e){(0,mr.Z)(t,e);var a=Ew(t);function t(i){var r;return(0,xt.Z)(this,t),r=a.call(this,i),r.parentLayer=i.parent,r}return(0,St.Z)(t,[{key:"createTile",value:function(r,o){var u=this.getFeatureData(r,o),p=u.features,v=u.vectorTileLayer,g=u.source;if(p.length===0)return{layers:[],layerIDList:[]};var E=this.createLayer({tile:r,initOptions:o,vectorTileLayer:v,source:g});return{layers:[E],layerIDList:[E.id]}}}]),t}(Lv);function ww(e){var a=Aw();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function Aw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var cx=function(e){(0,mr.Z)(t,e);var a=ww(t);function t(i){var r;return(0,xt.Z)(this,t),r=a.call(this,i),r.parentLayer=i.parent,r}return(0,St.Z)(t,[{key:"createTile",value:function(r,o){var u=new Mi(r.data,{parser:{type:"image",extent:r.bounds}}),p=this.createLayer({L7Layer:j_,tile:r,initOptions:o,source:u});return{layers:[p],layerIDList:[p.id]}}}]),t}(Lv);function Tw(e){var a=Mw();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function Mw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var kw=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,Iw=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,cy=function(e){(0,mr.Z)(t,e);var a=Tw(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.clampLow,v=p===void 0?!0:p,g=r.clampHigh,E=g===void 0?!0:g,T=r.noDataValue,O=T===void 0?-9999999:T,F=r.domain,U=F===void 0?[0,1]:F,j=r.rampColors;return(0,Br.isEqual)(this.rampColors,j)||(this.updateColorTexure(),this.rampColors=j),{u_opacity:u||1,u_texture:this.texture,u_domain:U,u_clampLow:v,u_clampHigh:typeof E<"u"?E:v,u_noDataValue:O,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v,E=o.rampColorsData,T=o.rampColors,O=this.layer.getSource(),F=this.rendererService.createTexture2D,U=O.data.dataArray[0];this.texture=F({data:U.data,width:U.width,height:U.height,format:X.LUMINANCE,type:X.FLOAT});var j=E||N(T);this.colorTexture=F({data:j.data,width:j.width,height:j.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:Iw,fragmentShader:kw,triangulation:ay,primitive:X.TRIANGLES,depth:{enable:!1},stencil:le(p,g)}).then(function(K){r([K])}).catch(function(K){console.warn(K),r([])})}},{key:"buildModels",value:function(r){this.initModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){return[p[3],p[4]]}}})}},{key:"updateColorTexure",value:function(){var r=this.rendererService.createTexture2D,o=this.layer.getLayerConfig(),u=o.rampColors,p=N(u);this.colorTexture=r({data:p.data,width:p.width,height:p.height,flipY:!1})}}]),t}(ko);function Pw(e){var a=Lw();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function Lw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Rw=function(e){(0,mr.Z)(t,e);var a=Pw(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"type",i.layerType),i}return(0,St.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new o(this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getModelType",value:function(){return cy}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{}}}]),t}(Ld);function Ow(e){var a=Fw();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function Fw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Dw=function(e){(0,mr.Z)(t,e);var a=Ow(t);function t(i){var r;return(0,xt.Z)(this,t),r=a.call(this,i),r.parentLayer=i.parent,r}return(0,St.Z)(t,[{key:"createTile",value:function(r,o){var u=o.opacity,p=o.domain,v=o.clampHigh,g=o.clampLow,E=o.rampColors,T=o.rampColorsData,O=o.mask,F=r.data;if(!F.data)return console.warn("raster data not exist!"),{layers:[],layerIDList:[]};var U=new Rw({visible:r.isVisible,mask:O}).source(F.data,{parser:{type:"raster",width:F.width,height:F.height,extent:r.bboxPolygon.bbox}}).style({opacity:u,domain:p,clampHigh:v,clampLow:g,rampColors:E,rampColorsData:T});return this.emitEvent([U],!1),sy(this.parentLayer,[U]),{layers:[U],layerIDList:[U.id]}}}]),t}(Lv);function Bw(e){var a=Nw();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function Nw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var zw=function(e){(0,mr.Z)(t,e);var a=Bw(t);function t(i){var r;return(0,xt.Z)(this,t),r=a.call(this,i),r.parentLayer=i.parent,r}return(0,St.Z)(t,[{key:"createTile",value:function(r,o){var u=o.sourceLayer;if(!u)return{layers:[],layerIDList:[]};var p=r.data.layers[u],v=p==null?void 0:p.features;if(v.length===0)return{layers:[],layerIDList:[]};var g=v[0].properties,E=new ly({layerType:"PointLayer"}).source([g],{parser:{type:"json",x:"textLng",y:"textLat"}}).shape("key","text").size(20).color("#000").style({stroke:"#fff",strokeWidth:2}),T=new ly({layerType:"LineLayer"}).source({type:"FeatureCollection",features:v}).shape("simple").color("#000");return sy(this.parentLayer,[T,E]),{layers:[T,E],layerIDList:[T.id,E.id]}}}]),t}(Lv);function Uw(e,a){switch(e){case"PolygonLayer":return Sw;case"LineLayer":return yw;case"PointLayer":return bw;case"TileDebugLayer":return zw;case"RasterLayer":return a.dataType==="arraybuffer"?Dw:cx;default:return console.warn("Current Tile Not Exist!"),cx}}function Zw(e){var a=Vw();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function Vw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var jw=function(e){(0,mr.Z)(t,e);var a=Zw(t);function t(){var i;return(0,xt.Z)(this,t),i=a.call(this),(0,ee.Z)((0,dt.Z)(i),"checkConfigList",[]),i.cacheConfig=new Map,i}return(0,St.Z)(t,[{key:"setConfig",value:function(r,o){this.checkConfigList.includes(r)||this.checkConfigList.push(r),this.cacheConfig.set(r,o)}},{key:"removeConfig",value:function(r){var o=this.checkConfigList.indexOf(r);o>-1&&(this.cacheConfig.delete(r),this.checkConfigList.splice(o,1))}},{key:"checkConfig",value:function(r){var o=this;if(!!r.inited){var u=r.getLayerConfig(),p=[];this.checkConfigList.map(function(v){var g=o.cacheConfig.get(v),E;if(["color","size","shape"].includes(v)){var T;E=(T=r.getAttribute(v))===null||T===void 0?void 0:T.scale}else{if(!(v in u))return;E=u[v]}(0,Br.isEqual)(g,E)||(p.push(v),o.setConfig(v,E))}),p.length>0&&(console.warn("tile config cache update!",p),this.emit("updateConfig",p))}}},{key:"getAttributeScale",value:function(r,o){var u=r.getAttribute(o),p={field:void 0,values:void 0,callback:void 0};if(u&&u.scale){var v=u.scale,g=v.field,E=v.values,T=v.callback;p.field=g,p.values=E,p.callback=T}return p}}]),t}(Sh());function Gw(e){var a=Hw();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function Hw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ww=function(e){(0,mr.Z)(t,e);var a=Gw(t);function t(i,r,o,u,p){var v;return(0,xt.Z)(this,t),v=a.call(this),(0,ee.Z)((0,dt.Z)(v),"isLastPicked",!1),v.parent=i,v.rendererService=r,v.pickingService=o,v.layerService=p,v.children=u,v}return(0,St.Z)(t,[{key:"normalRender",value:function(r){var o=this;r.filter(function(u){return u.inited}).filter(function(u){return u.isVisible()}).map(function(u){u.hooks.beforeRenderData.call(),u.hooks.beforeRender.call(),u.masks.length>0&&(o.rendererService.clear({stencil:0,depth:1,framebuffer:null}),u.masks.map(function(p){p.hooks.beforeRenderData.call(),p.hooks.beforeRender.call(),p.render(),p.hooks.afterRender.call()})),u.render(),u.hooks.afterRender.call()})}},{key:"pickRender",value:function(r,o){var u=this;this.parent.type==="RasterLayer"&&this.renderMask(this.parent);var p=r.filter(function(v){return u.parent.needPick(o.type)&&v.inited&&v.isVisible()}).some(function(v){v.hooks.beforePickingEncode.call(),v.masks.length>0&&(u.rendererService.clear({stencil:0,depth:1,framebuffer:null}),v.masks.map(function(E){E.hooks.beforeRender.call(),E.render(),E.hooks.afterRender.call()})),v.renderModels(!0),v.hooks.afterPickingEncode.call();var g=u.pickingService.pickFromPickingFBO(v,o);return g&&u.parent.type!=="RasterLayer"&&(u.emit("pick",{type:o.type,pickedColors:u.pickingService.pickedColors,layer:v}),u.pickingService.pickedTileLayers=[u.parent]),g});return this.parent.type!=="RasterLayer"&&!p&&this.isLastPicked&&o.type!=="click"&&(this.pickingService.pickedTileLayers=[],this.emit("unpick",{}),this.beforeHighlight([0,0,0])),this.isLastPicked=p,p}},{key:"clearPick",value:function(){this.children.filter(function(r){return r.inited&&r.isVisible()}).map(function(r){r.hooks.beforeSelect.call([0,0,0])}),this.pickingService.pickedTileLayers=[]}},{key:"beforeHighlight",value:function(r){this.children.filter(function(o){return o.inited&&o.isVisible()}).map(function(o){o.hooks.beforeHighlight.call(r)})}},{key:"beforeSelect",value:function(r){this.children.filter(function(o){return o.inited&&o.isVisible()}).map(function(o){o.hooks.beforeSelect.call(r)})}},{key:"renderMask",value:function(r){r.inited&&r.isVisible()&&(r.hooks.beforeRender.call(),r.masks.length>0&&(this.rendererService.clear({stencil:0,depth:1,framebuffer:null}),r.masks.map(function(o){o.hooks.beforeRender.call(),o.render(),o.hooks.afterRender.call()})),r.hooks.afterRender.call())}}]),t}(fl.EventEmitter),Xw=function(){function e(a,t,i,r,o,u){(0,xt.Z)(this,e),this.parent=a,this.children=a.layerChildren,this.mapService=t,this.rendererService=i,this.transforms=u,this.tilePickManager=new Ww(a,i,r,this.children,o),this.tileConfigManager=new jw,this.setSubLayerInitOptipn(),this.setConfigListener(),this.initTileFactory()}return(0,St.Z)(e,[{key:"createTile",value:function(t){return this.tileFactory.createTile(t,this.initOptions)}},{key:"updateLayersConfig",value:function(t,i,r){t.map(function(o){i==="mask"?o.style({mask:r}):o.updateLayerConfig((0,ee.Z)({},i,r))})}},{key:"addChild",value:function(t){this.children.push(t)}},{key:"addChilds",value:function(t){var i;(i=this.children).push.apply(i,(0,Ee.Z)(t))}},{key:"removeChilds",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=[],o=[];this.children.filter(function(u){t.includes(u.id)?r.push(u):o.push(u)}),r.map(function(u){return u.destroy(i)}),this.children=o}},{key:"removeChild",value:function(t){var i=this.children.indexOf(t);i>-1&&this.children.splice(i,1),t.destroy()}},{key:"getChilds",value:function(t){return this.children.filter(function(i){return t.includes(i.id)})}},{key:"getChild",value:function(t){return this.children.filter(function(i){return i.id===t})[0]}},{key:"clearChild",value:function(){this.children.forEach(function(t){t.destroy()}),this.children.slice(0,this.children.length)}},{key:"hasChild",value:function(t){return this.children.includes(t)}},{key:"render",value:function(){var t,i;(t=this.tileConfigManager)===null||t===void 0||t.checkConfig(this.parent),(i=this.tilePickManager)===null||i===void 0||i.normalRender(this.children)}},{key:"pickLayers",value:function(t){var i;return(i=this.tilePickManager)===null||i===void 0?void 0:i.pickRender(this.children,t)}},{key:"setSubLayerInitOptipn",value:function(){var t,i=this.parent.getLayerConfig(),r=i.zIndex,o=r===void 0?0:r,u=i.opacity,p=u===void 0?1:u,v=i.mask,g=v===void 0?!1:v,E=i.stroke,T=E===void 0?"#fff":E,O=i.strokeWidth,F=O===void 0?0:O,U=i.strokeOpacity,j=U===void 0?1:U,K=i.clampLow,ae=K===void 0?!0:K,ve=i.clampHigh,ke=ve===void 0?!0:ve,qe=i.domain,ct=qe===void 0?[0,1]:qe,_t=i.rampColors,Ot=_t===void 0?{colors:["rgb(166,97,26)","rgb(223,194,125)","rgb(245,245,245)","rgb(128,205,193)","rgb(1,133,113)"],positions:[0,.25,.5,.75,1]}:_t,Xt=i.featureId,yr=Xt===void 0?"id":Xt,Pr=i.workerEnabled,xr=Pr===void 0?!1:Pr,An=i.sourceLayer,ii=i.pixelConstant,sa=ii===void 0?0:ii,Io=i.pixelConstantR,_o=Io===void 0?256*256:Io,Gu=i.pixelConstantG,ml=Gu===void 0?256:Gu,Ju=i.pixelConstantB,mf=Ju===void 0?1:Ju,L0=i.pixelConstantRGB,R0=L0===void 0?.1:L0,sv=this.tileConfigManager.getAttributeScale(this.parent,"color"),jv=this.tileConfigManager.getAttributeScale(this.parent,"size"),O0=this.parent.getSource(),Gv=(O0==null||(t=O0.data)===null||t===void 0?void 0:t.tilesetOptions)||{},Gy=Gv.coords,Hy=O0.getParserType(),Vi=H_(this.parent.type,this.parent);Ot&&(this.rampColorsData=N(Ot)),this.initOptions={layerType:this.parent.type,transforms:this.transforms,shape:Vi,zIndex:o,opacity:p,sourceLayer:this.getSourceLayer(Hy,An),coords:Gy,featureId:yr,color:sv,size:jv,mask:LS(this.parent.type,g),stroke:T,strokeWidth:F,strokeOpacity:j,clampLow:ae,clampHigh:ke,domain:ct,rampColors:Ot,rampColorsData:this.rampColorsData,workerEnabled:xr,pixelConstant:sa,pixelConstantR:_o,pixelConstantG:ml,pixelConstantB:mf,pixelConstantRGB:R0}}},{key:"getSourceLayer",value:function(t,i){return t==="geojsonvt"?"geojsonvt":t==="testTile"?"testTile":i}},{key:"setConfigListener",value:function(){var t=this;if(this.tileConfigManager.setConfig("opacity",this.initOptions.opacity),this.tileConfigManager.setConfig("zIndex",this.initOptions.zIndex),this.tileConfigManager.setConfig("mask",this.initOptions.mask),this.parent.type==="RasterLayer")this.tileConfigManager.setConfig("rampColors",this.initOptions.rampColors),this.tileConfigManager.setConfig("domain",this.initOptions.domain),this.tileConfigManager.setConfig("clampHigh",this.initOptions.clampHigh),this.tileConfigManager.setConfig("clampLow",this.initOptions.clampLow),this.tileConfigManager.setConfig("pixelConstant",this.initOptions.pixelConstant),this.tileConfigManager.setConfig("pixelConstantR",this.initOptions.pixelConstantR),this.tileConfigManager.setConfig("pixelConstantG",this.initOptions.pixelConstantG),this.tileConfigManager.setConfig("pixelConstantB",this.initOptions.pixelConstantB),this.tileConfigManager.setConfig("pixelConstantRGB",this.initOptions.pixelConstantRGB);else{var i,r,o;this.tileConfigManager.setConfig("stroke",this.initOptions.stroke),this.tileConfigManager.setConfig("strokeWidth",this.initOptions.strokeWidth),this.tileConfigManager.setConfig("strokeOpacity",this.initOptions.strokeOpacity),this.tileConfigManager.setConfig("color",(i=this.parent.getAttribute("color"))===null||i===void 0?void 0:i.scale),this.tileConfigManager.setConfig("shape",(r=this.parent.getAttribute("shape"))===null||r===void 0?void 0:r.scale),this.tileConfigManager.setConfig("size",(o=this.parent.getAttribute("size"))===null||o===void 0?void 0:o.scale)}this.tileConfigManager.on("updateConfig",function(u){u.map(function(p){return t.updateStyle(p),""})})}},{key:"updateStyle",value:function(t){var i=this,r=null;if(["size","color","shape"].includes(t)){var o,u=(o=this.parent.getAttribute(t))===null||o===void 0?void 0:o.scale;if(!u)return;r=u,this.children.map(function(g){return i.tileFactory.setStyleAttributeField(g,t,u),""})}else{var p=this.parent.getLayerConfig();if(!(t in p))return;var v=p[t];r=v,this.updateLayersConfig(this.children,t,v),t==="rampColors"&&v&&(this.rampColorsData=N(v))}this.initOptions[t]=r}},{key:"initTileFactory",value:function(){var t=this.parent.getSource(),i=Uw(this.parent.type,t.parser);this.tileFactory=new i({parent:this.parent,mapService:this.mapService,rendererService:this.rendererService})}}]),e}(),Yw=function(){function e(a){var t,i=a.parent,r=a.rendererService,o=a.mapService,u=a.layerService,p=a.pickingService,v=a.transforms;(0,xt.Z)(this,e),(0,ee.Z)(this,"type","baseTile"),(0,ee.Z)(this,"initedTileset",!1),(0,ee.Z)(this,"pickColors",{select:null,active:null});var g=i.getSource(),E=(g==null||(t=g.data)===null||t===void 0?void 0:t.tilesetOptions)||{},T=E.sourceLayer,O=E.coords,F=E.featureId;this.sourceLayer=T,this.parent=i,this.mapService=o,this.layerService=u,this.tileLayerManager=new Xw(i,o,r,p,u,v),this.initTileSetManager(),this.bindSubLayerEvent(),this.bindSubLayerPick(),this.scaleField=this.parent.getScaleOptions()}return(0,St.Z)(e,[{key:"children",get:function(){return this.tileLayerManager.children}},{key:"render",value:function(){this.tileLayerManager&&this.tileLayerManager.render()}},{key:"clearPick",value:function(t){t==="mousemove"&&this.tileLayerManager.tilePickManager.clearPick()}},{key:"clearPickState",value:function(){var t=this;this.children.filter(function(i){return i.inited&&i.isVisible()}).filter(function(i){return i.getCurrentSelectedId()!==null}).map(function(i){t.selectFeature(i,new Uint8Array([0,0,0,0])),i.setCurrentSelectedId(null)})}},{key:"pickLayers",value:function(t){return this.tileLayerManager.pickLayers(t)}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"tileUnLoad",value:function(t){this.tileLayerManager.removeChilds(t.layerIDList,!1)}},{key:"tileUpdate",value:function(){var t=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(i){return i.isLoaded}).map(function(i){if(i.layerIDList.length===0){var r=t.tileLayerManager.createTile(i),o=r.layers,u=r.layerIDList;i.layerIDList=u,t.tileLayerManager.addChilds(o)}else{if(!i.isVisibleChange)return;var p=t.tileLayerManager.getChilds(i.layerIDList);t.tileLayerManager.updateLayersConfig(p,"visible",i.isVisible)}}),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}},{key:"setPickState",value:function(t){var i=this;if(this.pickColors.select){var r=k(this.pickColors.select);t.map(function(u){i.selectFeature(u,i.pickColors.select),u.setCurrentSelectedId(r)})}if(this.pickColors.active){var o=k(this.pickColors.active);t.filter(function(u){return u.inited&&u.isVisible()}).map(function(u){u.hooks.beforeHighlight.call(i.pickColors.active),u.setCurrentPickId(o)})}}},{key:"bindSubLayerPick",value:function(){var t=this;this.tileLayerManager.tilePickManager.on("pick",function(i){var r=(0,pr.Z)(i.pickedColors,3),o=r[0],u=r[1],p=r[2];if(i.type==="click"){var v=t.children.filter(function(g){return g.inited&&g.isVisible()&&g.isVector}).filter(function(g){return g!==i.layer});t.setSelect(v,[o,u,p])}else t.setHighlight([o,u,p])}),this.tileLayerManager.tilePickManager.on("unpick",function(){t.pickColors.active=null})}},{key:"setHighlight",value:function(t){var i=k(t);this.pickColors.active=t,this.children.filter(function(r){return r.inited&&r.isVisible()&&r.isVector}).filter(function(r){return r.getPickID()!==i}).map(function(r){r.setPickID(i),r.hooks.beforeHighlight.call(t)})}},{key:"setSelect",value:function(t,i){var r=this,o=k(i);t.map(function(p){p.getCurrentSelectedId()===null||o!==p.getCurrentSelectedId()?(r.selectFeature(p,i),p.setCurrentSelectedId(o),r.pickColors.select=i):(r.selectFeature(p,new Uint8Array([0,0,0,0])),p.setCurrentSelectedId(null),r.pickColors.select=null)});var u=this.layerService.getRenderList();u.filter(function(p){return p.inited&&!p.isVector&&p.isVisible()&&p.needPick("click")}).filter(function(p){return p.getCurrentSelectedId()!==null}).map(function(p){r.selectFeature(p,new Uint8Array([0,0,0,0])),p.setCurrentSelectedId(null)})}},{key:"selectFeature",value:function(t,i){var r=(0,pr.Z)(i,3),o=r[0],u=r[1],p=r[2];t.hooks.beforeSelect.call([o,u,p])}},{key:"bindSubLayerEvent",value:function(){var t=this;this.parent.on("subLayerClick",function(i){t.parent.emit("click",(0,Z.Z)({},i))}),this.parent.on("subLayerMouseMove",function(i){return t.parent.emit("mousemove",(0,Z.Z)({},i))}),this.parent.on("subLayerMouseUp",function(i){return t.parent.emit("mouseup",(0,Z.Z)({},i))}),this.parent.on("subLayerMouseEnter",function(i){return t.parent.emit("mouseenter",(0,Z.Z)({},i))}),this.parent.on("subLayerMouseOut",function(i){return t.parent.emit("mouseout",(0,Z.Z)({},i))}),this.parent.on("subLayerMouseDown",function(i){return t.parent.emit("mousedown",(0,Z.Z)({},i))}),this.parent.on("subLayerContextmenu",function(i){return t.parent.emit("contextmenu",(0,Z.Z)({},i))}),this.parent.on("subLayerUnClick",function(i){return t.parent.emit("unclick",(0,Z.Z)({},i))}),this.parent.on("subLayerUnMouseMove",function(i){return t.parent.emit("unmousemove",(0,Z.Z)({},i))}),this.parent.on("subLayerUnMouseUp",function(i){return t.parent.emit("unmouseup",(0,Z.Z)({},i))}),this.parent.on("subLayerUnMouseDown",function(i){return t.parent.emit("unmousedown",(0,Z.Z)({},i))}),this.parent.on("subLayerUnContextmenu",function(i){return t.parent.emit("uncontextmenu",(0,Z.Z)({},i))})}},{key:"initTileSetManager",value:function(){var t,i=this.parent.getSource();this.tilesetManager=i.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var r=this.getCurrentView(),o=r.latLonBounds,u=r.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(u,o)}},{key:"mapchange",value:function(){var t,i=this.getCurrentView(),r=i.latLonBounds,o=i.zoom;if(this.mapService.version==="GAODE1.x"){var u=this.parent.getLayerConfig(),p=u.visible;o<3&&p?(this.parent.updateLayerConfig({visible:!1}),this.layerService.updateLayerRenderList()):o>=3&&!p&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.updateLayerRenderList())}this.lastViewStates&&this.lastViewStates.zoom===o&&this.lastViewStates.latLonBounds.toString()===r.toString()||(this.lastViewStates={zoom:o,latLonBounds:r},this.timer&&(clearTimeout(this.timer),this.timer=null),(t=this.tilesetManager)===null||t===void 0||t.update(o,r))}},{key:"bindTilesetEvent",value:function(){var t=this;!this.tilesetManager||(this.tilesetManager.on("tile-loaded",function(i){}),this.tilesetManager.on("tile-unload",function(i){t.tileUnLoad(i)}),this.tilesetManager.on("tile-error",function(i,r){t.tileError(i)}),this.tilesetManager.on("tile-update",function(){t.tileUpdate()}),this.mapService.on("zoomend",function(){return t.mapchange()}),this.mapService.on("moveend",function(){return t.mapchange()}))}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds(),i=[t[0][0],t[0][1],t[1][0],t[1][1]],r=this.mapService.getZoom();return{latLonBounds:i,zoom:r}}}]),e}();function qw(e){var a=$w();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function $w(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Kw=function(e){(0,mr.Z)(t,e);var a=qw(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"type","TMS"),i}return(0,St.Z)(t,[{key:"tileUnLoad",value:function(r){this.tileLayerManager.removeChilds(r.layerIDList,!1)}},{key:"tileUpdate",value:function(){var r=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(o){return o.isLoaded}).map(function(o){var u;if((u=o.data)!==null&&u!==void 0&&u.layers&&r.sourceLayer){var p=o.data.layers[r.sourceLayer],v=p==null?void 0:p.features;if(!(Array.isArray(v)&&v.length>0))return}if(o.parentLayerIDList.includes(r.parent.id)){if(!o.isVisibleChange)return;var F=r.tileLayerManager.getChilds(o.layerIDList);r.tileLayerManager.updateLayersConfig(F,"visible",o.isVisible),r.setPickState(F)}else{var g,E=r.tileLayerManager.createTile(o),T=E.layers,O=E.layerIDList;o.parentLayerIDList.push(r.parent.id),(g=o.layerIDList).push.apply(g,(0,Ee.Z)(O)),r.tileLayerManager.addChilds(T),r.setPickState(T)}}),this.parent.renderLayers(),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}}]),t}(Yw);function Qw(e){var a=Jw();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function Jw(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ug=function(e){(0,mr.Z)(t,e);var a=Qw(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getUninforms",value:function(){return{}}},{key:"initModels",value:function(){var r=this.layer.getSource();return r!=null&&r.data.isTile&&(this.layer.tileLayer=new Kw({parent:this.layer,rendererService:this.rendererService,mapService:this.mapService,layerService:this.layerService,pickingService:this.pickingService,transforms:r.transforms})),this.buildModels()}},{key:"buildModels",value:function(){return[]}},{key:"registerBuiltinAttributes",value:function(){}}]),t}(ko);function eA(e){var a=tA();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function tA(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var rA=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,nA=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,iA=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,aA=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
     return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  float arcThetaOffset = styleMappingMat[0][1];
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, arcThetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, arcThetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,oA=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,sA=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,uA={solid:0,dash:1},lA=function(e){(0,mr.Z)(t,e);var a=eA(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.textureBlend,E=g===void 0?"normal":g,T=r.lineType,O=T===void 0?"solid":T,F=r.dashArray,U=F===void 0?[10,5]:F,j=r.forward,K=j===void 0?!0:j,ae=r.lineTexture,ve=ae===void 0?!1:ae,ke=r.iconStep,qe=ke===void 0?100:ke,ct=r.segmentNumber,_t=ct===void 0?30:ct,Ot=r.thetaOffset,Xt=Ot===void 0?.314:Ot;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,thetaOffset:Xt})){this.judgeStyleAttributes({opacity:u,thetaOffset:Xt});var yr=this.layer.getEncodedData(),Pr=this.calDataFrame(this.cellLength,yr,this.cellProperties),xr=Pr.data,An=Pr.width,ii=Pr.height;this.rowCount=ii,this.dataTexture=this.cellLength>0&&xr.length>0?this.createTexture2D({flipY:!0,data:xr,format:X.LUMINANCE,type:X.FLOAT,width:An,height:ii}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}U.length===2&&U.push(0,0);var sa=0,Io=[0,0,0,0],_o=[0,0,0,0];return p&&v&&(Io=S(p),_o=S(v),sa=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:(0,Br.isNumber)(Xt)?Xt:0,u_opacity:(0,Br.isNumber)(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:_t,u_line_type:uA[O||"solid"],u_dash_array:U,u_blur:.9,u_lineDir:K?1:-1,u_texture:this.texture,u_line_texture:ve?1:0,u_icon_step:qe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:sa,u_sourceColor:Io,u_targetColor:_o}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor,p=r.lineType;return p==="dash"?{frag:rA,vert:nA,type:"Dash"}:o&&u?{frag:oA,vert:sA,type:"Linear"}:{frag:iA,vert:aA,type:""}}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.segmentNumber,p=u===void 0?30:u,v=o.mask,g=v===void 0?!1:v,E=o.maskInside,T=E===void 0?!0:E,O=this.getShaders(),F=O.frag,U=O.vert,j=O.type;this.layer.buildLayerModel({moduleName:"lineArc2d"+j,vertexShader:U,fragmentShader:F,triangulation:ag,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p,stencil:le(g,T)}).then(function(K){r([K])}).catch(function(K){console.warn(K),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,T=E===void 0?1:E;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Tn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:function(u,p,v,g){return[v[3],v[4],v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),T=u.texture,O=E[T]||{x:0,y:0},F=O.x,U=O.y;return[F,U]}}})}}]),t}(ko);function cA(e){var a=fA();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function fA(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var hA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,pA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,dA=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,vA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,mA={solid:0,dash:1},gA=function(e){(0,mr.Z)(t,e);var a=cA(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.textureBlend,E=g===void 0?"normal":g,T=r.lineType,O=T===void 0?"solid":T,F=r.dashArray,U=F===void 0?[10,5]:F,j=r.lineTexture,K=j===void 0?!1:j,ae=r.iconStep,ve=ae===void 0?100:ae,ke=r.segmentNumber,qe=ke===void 0?30:ke,ct=r.globalArcHeight,_t=ct===void 0?10:ct;U.length===2&&U.push(0,0);var Ot=0,Xt=[0,0,0,0],yr=[0,0,0,0];if(p&&v&&(Xt=S(p),yr=S(v),Ot=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Pr=this.layer.getEncodedData(),xr=this.calDataFrame(this.cellLength,Pr,this.cellProperties),An=xr.data,ii=xr.width,sa=xr.height;this.rowCount=sa,this.dataTexture=this.cellLength>0&&An.length>0?this.createTexture2D({flipY:!0,data:An,format:X.LUMINANCE,type:X.FLOAT,width:ii,height:sa}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:ey,u_global_height:_t,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Br.isNumber)(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:qe,u_line_type:mA[O]||0,u_dash_array:U,u_texture:this.texture,u_line_texture:K?1:0,u_icon_step:ve,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ot,u_sourceColor:Xt,u_targetColor:yr}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:dA,vert:vA,type:"Linear"}:{frag:hA,vert:pA,type:""}}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.segmentNumber,p=u===void 0?30:u,v=o.mask,g=v===void 0?!1:v,E=o.maskInside,T=E===void 0?!0:E,O=this.getShaders(),F=O.frag,U=O.vert,j=O.type;this.layer.buildLayerModel({moduleName:"lineArc3d"+j,vertexShader:U,fragmentShader:F,triangulation:ag,blend:this.getBlend(),segmentNumber:p,stencil:le(g,T)}).then(function(K){r([K])}).catch(function(K){console.warn(K),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,T=E===void 0?1:E;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Tn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:function(u,p,v,g){return[v[3],v[4],v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),T=u.texture,O=E[T]||{x:0,y:0},F=O.x,U=O.y;return[F,U]}}})}}]),t}(ko);function yA(e){var a=_A();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function _A(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,bA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,EA=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,CA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,SA={solid:0,dash:1},wA=function(e){(0,mr.Z)(t,e);var a=yA(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.textureBlend,E=g===void 0?"normal":g,T=r.lineType,O=T===void 0?"solid":T,F=r.dashArray,U=F===void 0?[10,5]:F,j=r.lineTexture,K=j===void 0?!1:j,ae=r.iconStep,ve=ae===void 0?100:ae,ke=r.segmentNumber,qe=ke===void 0?30:ke,ct=r.globalArcHeight,_t=ct===void 0?10:ct;U.length===2&&U.push(0,0);var Ot=0,Xt=[0,0,0,0],yr=[0,0,0,0];if(p&&v&&(Xt=S(p),yr=S(v),Ot=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Pr=this.layer.getEncodedData(),xr=this.calDataFrame(this.cellLength,Pr,this.cellProperties),An=xr.data,ii=xr.width,sa=xr.height;this.rowCount=sa,this.dataTexture=this.cellLength>0&&An.length>0?this.createTexture2D({flipY:!0,data:An,format:X.LUMINANCE,type:X.FLOAT,width:ii,height:sa}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_globel:1,u_globel_radius:ey,u_global_height:_t,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Br.isNumber)(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:qe,u_line_type:SA[O]||0,u_dash_array:U,u_texture:this.texture,u_line_texture:K?1:0,u_icon_step:ve,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ot,u_sourceColor:Xt,u_targetColor:yr}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:EA,vert:CA,type:"Linear"}:{frag:xA,vert:bA,type:""}}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.segmentNumber,p=u===void 0?30:u,v=o.mask,g=v===void 0?!1:v,E=o.maskInside,T=E===void 0?!0:E,O=this.getShaders(),F=O.frag,U=O.vert,j=O.type;this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+j,vertexShader:U,fragmentShader:F,triangulation:ag,depth:{enable:!0},blend:this.getBlend(),segmentNumber:p,stencil:le(g,T)}).then(function(K){r([K])}).catch(function(K){console.warn(K),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,T=E===void 0?1:E;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Tn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:function(u,p,v,g){return[v[3],v[4],v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),T=u.texture,O=E[T]||{x:0,y:0},F=O.x,U=O.y;return[F,U]}}})}}]),t}(ko);function AA(e){var a=TA();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function TA(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var MA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,kA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,IA={solid:0,dash:1},PA=function(e){(0,mr.Z)(t,e);var a=AA(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.textureBlend,E=g===void 0?"normal":g,T=r.lineType,O=T===void 0?"solid":T,F=r.dashArray,U=F===void 0?[10,5]:F,j=r.lineTexture,K=j===void 0?!1:j,ae=r.iconStep,ve=ae===void 0?100:ae,ke=r.segmentNumber,qe=ke===void 0?30:ke;U.length===2&&U.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var ct=0,_t=[0,0,0,0],Ot=[0,0,0,0];if(p&&v&&(_t=S(p),Ot=S(v),ct=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Xt=this.layer.getEncodedData(),yr=this.calDataFrame(this.cellLength,Xt,this.cellProperties),Pr=yr.data,xr=yr.width,An=yr.height;this.rowCount=An,this.dataTexture=this.cellLength>0&&Pr.length>0?this.createTexture2D({flipY:!0,data:Pr,format:X.LUMINANCE,type:X.FLOAT,width:xr,height:An}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Br.isNumber)(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:qe,u_line_type:IA[O]||0,u_dash_array:U,u_texture:this.texture,u_line_texture:K?1:0,u_icon_step:ve,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:ct,u_sourceColor:_t,u_targetColor:Ot}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:kA,fragmentShader:MA,triangulation:ag,depth:{enable:!1},blend:this.getBlend(),stencil:le(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,T=E===void 0?1:E;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Tn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:function(u,p,v,g){return[v[3],v[4],v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),T=u.texture,O=E[T]||{x:0,y:0},F=O.x,U=O.y;return[F,U]}}})}}]),t}(ko);function LA(e){var a=RA();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function RA(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var OA=`#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
uniform float u_CoordinateSystem;
varying vec4 v_color;
uniform float u_arrow: 0.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

varying mat4 styleMappingMat;
void main() {
  float distanceAndIndex = styleMappingMat[0][3];
  float miter = styleMappingMat[0][2];

  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B


  if(u_arrow > 0.0 && distanceAndIndex < 2.0) { // arrow
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) { 
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z < 0.0) { // amap
        discard;
      }
    } else { // amap2 mapbox map
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z > 0.0) { 
        discard;
      }
    }
  } else { // line body
    if(miter < 0.0) {
      discard;
    }
  }


  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,FA=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute vec4 a_dirPoints;
attribute vec3 a_DistanceAndIndex;

uniform vec4 u_lineDir;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - a_Miter - a_DistanceAndIndex
    0.0, 0.0, 0.0, 0.0, // originX - originY - vectorX - vectorY
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );
  styleMappingMat[0][3] = a_DistanceAndIndex.y;
  styleMappingMat[0][2] = a_Miter;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  // styleMappingMat[1].rg = a_Position.xy + offset;

  vec2 copyOffset = vec2(offset.x, offset.y);

  float lineDistance = a_DistanceAndIndex.x;
  float total_Distance = a_DistanceAndIndex.z;
  float currentLinePointRatio = lineDistance / total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z); // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }
  
  if(u_arrow > 0.0 && a_DistanceAndIndex.y < 2.0) {
    vec2 startPoint = a_dirPoints.rg;
    vec2 endPoint = a_dirPoints.ba;
    vec4 t1 = project_position(vec4(startPoint, 0, 1.0));
    vec4 t2 = project_position(vec4(endPoint, 0, 1.0));
    // TODO\uFF1A \u540E\u7EED\u4F18\u5316\u53EF\u4EE5\u628A\u4F4D\u7F6E\u8BA1\u7B97\u653E\u5728 cpu \u4E2D\u5B8C\u6210
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      vec2 p1 = (u_Mvp * vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = (u_Mvp * vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    } else {
      vec2 p1 = project_common_position_to_clipspace(vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = project_common_position_to_clipspace(vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    }
  }

  setPickingColor(a_PickingColor);
}
`,DA=function(e){(0,mr.Z)(t,e);var a=LA(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.arrow,E=g===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:g,T=0,O=[0,0,0,0],F=[0,0,0,0];if(p&&v&&(O=S(p),F=S(v),T=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var U=this.layer.getEncodedData(),j=this.calDataFrame(this.cellLength,U,this.cellProperties),K=j.data,ae=j.width,ve=j.height;this.rowCount=ve,this.dataTexture=this.cellLength>0&&K.length>0?this.createTexture2D({flipY:!0,data:K,format:X.LUMINANCE,type:X.FLOAT,width:ae,height:ve}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Br.isNumber)(u)?u:1,u_linearColor:T,u_sourceColor:O,u_targetColor:F,u_arrow:Number(E.enable),u_arrowHeight:E.arrowHeight||3,u_arrowWidth:E.arrowWidth||2,u_tailWidth:E.tailWidth===void 0?1:E.tailWidth}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"buildModels",value:function(){var i=(0,Sa.Z)(zn().mark(function o(u){var p,v,g,E,T,O,F,U,j,K;return zn().wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:p=this.layer.getLayerConfig(),v=p.mask,g=v===void 0?!1:v,E=p.maskInside,T=E===void 0?!0:E,O=p.depth,F=O===void 0?!1:O,U=this.getShaders(),j=U.frag,K=U.vert,this.layer.triangulation=ev,this.layer.buildLayerModel({moduleName:"lineHalf",vertexShader:K,fragmentShader:j,triangulation:ev,depth:{enable:F},blend:this.getBlend(),stencil:le(g,T)}).then(function(ke){u([ke])}).catch(function(ke){console.warn(ke),u([])});case 4:case"end":return ve.stop()}},o,this)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"getShaders",value:function(){return{frag:OA,vert:FA,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Tn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,p,v,g,E){return E===void 0?[p[3],10,p[5]]:[p[3],E,p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"dirPoints",type:Tn.Attribute,descriptor:{name:"a_dirPoints",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:4,update:function(o,u,p,v){var g=o.coordinates[0]||[0,0],E=o.coordinates[3]||[0,0];return[g[0],g[1],E[0],E[1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){var g=o.size,E=g===void 0?1:g;return Array.isArray(E)?[E[0],E[1]]:[E,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Tn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,p,v,g){return g}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Tn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){return[p[4]]}}})}}]),t}(ko),fx;(function(e){e[e.solid=0]="solid",e[e.dash=1]="dash"})(fx||(fx={}));var Rv;(function(e){e.VERTICAL="vertical",e.HORIZONTAL="horizontal"})(Rv||(Rv={}));var fy;(function(e){e.NORMAL="normal",e.REPLACE="replace"})(fy||(fy={}));var hx;(function(e){e.ALWAYS="always",e.DRAGEND="dragend"})(hx||(hx={}));function BA(e){var a=NA();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function NA(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var zA=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,UA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,ZA=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;

uniform vec3 u_blur;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = styleMappingMat[3][3];
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  

  gl_FragColor = filterColor(gl_FragColor);
}
`,px=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,VA=`varying vec4 v_color;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3][0]; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,jA={solid:0,dash:1},dx=function(e){(0,mr.Z)(t,e);var a=BA(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.textureBlend,E=g===void 0?"normal":g,T=r.lineType,O=T===void 0?"solid":T,F=r.dashArray,U=F===void 0?[10,5,0,0]:F,j=r.lineTexture,K=j===void 0?!1:j,ae=r.iconStep,ve=ae===void 0?100:ae,ke=r.vertexHeightScale,qe=ke===void 0?20:ke,ct=r.borderWidth,_t=ct===void 0?0:ct,Ot=r.borderColor,Xt=Ot===void 0?"#ccc":Ot,yr=r.raisingHeight,Pr=yr===void 0?0:yr,xr=r.heightfixed,An=xr===void 0?!1:xr,ii=r.linearDir,sa=ii===void 0?Rv.VERTICAL:ii,Io=r.blur,_o=Io===void 0?[1,1,1]:Io,Gu=r.arrow,ml=Gu===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:Gu;U.length===2&&U.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Ju=0,mf=[0,0,0,0],L0=[0,0,0,0];if(p&&v&&(mf=S(p),L0=S(v),Ju=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var R0=this.layer.getEncodedData(),sv=this.calDataFrame(this.cellLength,R0,this.cellProperties),jv=sv.data,O0=sv.width,Gv=sv.height;this.rowCount=Gv,this.dataTexture=this.cellLength>0&&jv.length>0?this.createTexture2D({flipY:!0,data:jv,format:X.LUMINANCE,type:X.FLOAT,width:O0,height:Gv}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Br.isNumber)(u)?u:1,u_textureBlend:E===fy.NORMAL?0:1,u_line_type:jA[O],u_dash_array:U,u_blur:_o,u_texture:this.texture,u_line_texture:K?1:0,u_icon_step:ve,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:_t,u_borderColor:S(Xt),u_linearDir:sa===Rv.VERTICAL?1:0,u_linearColor:Ju,u_sourceColor:mf,u_targetColor:L0,u_heightfixed:Number(An),u_vertexScale:qe,u_raisingHeight:Number(Pr),u_arrow:Number(ml.enable),u_arrowHeight:ml.arrowHeight||3,u_arrowWidth:ml.arrowWidth||2,u_tailWidth:ml.tailWidth===void 0?1:ml.tailWidth}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v,E=o.depth,T=E===void 0?!1:E,O=o.workerEnabled,F=O===void 0?!1:O,U=o.enablePicking,j=this.getShaders(),K=j.frag,ae=j.vert,ve=j.type;this.layer.triangulation=Lp,this.layer.buildLayerModel({moduleName:"line"+ve,vertexShader:ae,fragmentShader:K,triangulation:Lp,depth:{enable:T},blend:this.getBlend(),stencil:le(p,g),workerEnabled:F,workerOptions:{modelType:"line"+ve,enablePicking:U,iconMap:this.iconService.getIconMap()}}).then(function(ke){r([ke])}).catch(function(ke){console.warn(ke),r([])})}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor,p=r.lineType;return p==="dash"?{frag:zA,vert:UA,type:"Dash"}:o&&u?{frag:VA,vert:px,type:"Linear"}:{frag:ZA,vert:px,type:""}}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Tn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g,E,T){return T===void 0?[v[3],10]:[v[3],T]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Tn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=u.size,T=E===void 0?1:E;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Tn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,p,v,g,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Tn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){return[v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),T=u.texture,O=E[T]||{x:0,y:0},F=O.x,U=O.y;return[F,U]}}})}}]),t}(ko);function GA(e){var a=HA();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function HA(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var WA=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  gl_FragColor = texture2D(u_texture, vec2(linearRadio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,XA=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,YA=function(e){(0,mr.Z)(t,e);var a=GA(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;i.colorTexture&&i.colorTexture.destroy();var v=i.layer.getLayerConfig(),g=v.rampColors,E=N(g);i.colorTexture=p({data:new Uint8Array(E.data),width:E.width,height:E.height,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE,min:X.NEAREST,mag:X.NEAREST,flipY:!1})}),i}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.vertexHeightScale,v=p===void 0?20:p,g=r.raisingHeight,E=g===void 0?0:g,T=r.heightfixed,O=T===void 0?!1:T,F=r.linearDir,U=F===void 0?Rv.VERTICAL:F;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var j=this.layer.getEncodedData(),K=this.calDataFrame(this.cellLength,j,this.cellProperties),ae=K.data,ve=K.width,ke=K.height;this.rowCount=ke,this.dataTexture=this.cellLength>0&&ae.length>0?this.createTexture2D({flipY:!0,data:ae,format:X.LUMINANCE,type:X.FLOAT,width:ve,height:ke}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_linearDir:U===Rv.VERTICAL?1:0,u_opacity:(0,Br.isNumber)(u)?u:1,u_texture:this.colorTexture,u_heightfixed:Number(O),u_vertexScale:v,u_raisingHeight:Number(E)}}},{key:"initModels",value:function(r){this.updateTexture(),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.colorTexture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v,E=o.depth,T=E===void 0?!1:E;this.layer.triangulation=ev,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:XA,fragmentShader:WA,triangulation:ev,depth:{enable:T},blend:this.getBlend(),stencil:le(p,g)}).then(function(O){r([O])}).catch(function(O){console.warn(O),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Tn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v,g,E){return E===void 0?[p[3],10]:[p[3],E]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Tn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){var g=o.size,E=g===void 0?1:g;return Array.isArray(E)?[E[0],E[1]]:[E,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Tn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,p,v,g){return g}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Tn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){return[p[4]]}}})}}]),t}(ko);function qA(e){var a=$A();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function $A(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var KA=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,QA=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,JA=function(e){(0,mr.Z)(t,e);var a=qA(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:X.NEAREST,min:X.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.textureBlend,E=g===void 0?"normal":g,T=r.heightfixed,O=T===void 0?!1:T,F=r.lineTexture,U=F===void 0?!1:F,j=r.iconStep,K=j===void 0?100:j,ae=r.iconStepCount,ve=ae===void 0?1:ae;this.rendererService.getDirty()&&this.texture.bind();var ke=0,qe=[0,0,0,0],ct=[0,0,0,0];if(p&&v&&(qe=S(p),ct=S(v),ke=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var _t=this.layer.getEncodedData(),Ot=this.calDataFrame(this.cellLength,_t,this.cellProperties),Xt=Ot.data,yr=Ot.width,Pr=Ot.height;this.rowCount=Pr,this.dataTexture=this.cellLength>0&&Xt.length>0?this.createTexture2D({flipY:!0,data:Xt,format:X.LUMINANCE,type:X.FLOAT,width:yr,height:Pr}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_heightfixed:Number(O),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Br.isNumber)(u)?u:1,u_textureBlend:E==="normal"?0:1,u_texture:this.texture,u_line_texture:U?1:0,u_iconStepCount:ve,u_icon_step:K,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:ke,u_sourceColor:qe,u_targetColor:ct}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(r){this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:QA,fragmentShader:KA,triangulation:ev,depth:{enable:!1},blend:this.getBlend()}).then(function(o){r([o])}).catch(function(o){console.warn(o),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Tn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){return[v[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Tn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=u.size,T=E===void 0?1:E;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Tn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,p,v,g,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Tn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){return[v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),T=u.texture,O=E[T]||{x:0,y:0},F=O.x,U=O.y;return[F,U]}}})}}]),t}(ko),eT={arc:lA,arc3d:gA,greatcircle:PA,wall:JA,line:dx,halfLine:DA,simple:X_,linearline:YA,vectorline:ug,tileLine:uy,earthArc3d:wA},tT=eT;function rT(e){var a=nT();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function nT(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var iT=function(e){(0,mr.Z)(t,e);var a=rT(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"type","LineLayer"),(0,ee.Z)((0,dt.Z)(i),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),i}return(0,St.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new tT[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},vectorline:{},tileLine:{},halfLine:{},earthArc3d:{}};return o[r]}},{key:"getModelType",value:function(){var r;if(this.layerType)return this.layerType;var o=this.layerSource.getParserType();if(oy(o))return"vectorline";var u=this.styleAttributeService.getLayerStyleAttribute("shape"),p=u==null||(r=u.scale)===null||r===void 0?void 0:r.field;return p||"line"}}]),t}(Ld);function aT(e){var a=oT();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function oT(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var sT=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,uT=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,lT=function(e){(0,mr.Z)(t,e);var a=aT(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"raiseCount",0),(0,ee.Z)((0,dt.Z)(i),"raiserepeat",0),i}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,p=r.opacity,v=p===void 0?1:p,g=r.sourceColor,E=r.targetColor,T=r.pickLight,O=T===void 0?!1:T,F=r.heightfixed,U=F===void 0?!1:F,j=r.opacityLinear,K=j===void 0?{enable:!1,dir:"up"}:j,ae=r.lightEnable,ve=ae===void 0?!0:ae;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var ke=this.layer.getEncodedData(),qe=this.calDataFrame(this.cellLength,ke,this.cellProperties),ct=qe.data,_t=qe.width,Ot=qe.height;this.rowCount=Ot,this.dataTexture=this.cellLength>0&&ct.length>0?this.createTexture2D({flipY:!0,data:ct,format:X.LUMINANCE,type:X.FLOAT,width:_t,height:Ot}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}var Xt=0,yr=[0,0,0,0],Pr=[0,0,0,0];if(g&&E&&(yr=S(g),Pr=S(E),Xt=1),this.raiseCount<1&&this.raiserepeat>0&&u.enable){var xr=u.speed,An=xr===void 0?.01:xr,ii=u.repeat,sa=ii===void 0?!1:ii;this.raiseCount+=An,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(O),u_heightfixed:Number(U),u_r:u.enable&&this.raiserepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Br.isNumber)(v)?v:1,u_linearColor:Xt,u_sourceColor:yr,u_targetColor:Pr,u_opacitylinear:Number(K.enable),u_opacitylinear_dir:K.dir==="up"?1:0,u_lightEnable:Number(ve)}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.animateOption.repeat,p=u===void 0?1:u;this.raiserepeat=p,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:uT,fragmentShader:sT,triangulation:ny,depth:{enable:!0},cull:{enable:!0,face:uf(this.mapService.version)},blend:this.getBlend()}).then(function(v){r([v])}).catch(function(v){console.warn(v),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,p,v){var g=o.size;if(g){var E=[];return Array.isArray(g)&&(E=g.length===2?[g[0],g[0],g[1]]:g),Array.isArray(g)||(E=[g,g,g]),E}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Tn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,p,v,g){return g}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Tn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u){var p=hu(o.coordinates);return M_([p[0],p[1]])}}})}}]),t}(ko);function cT(e){var a=fT();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function fT(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var hT=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,pT=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);

  setPickingColor(a_PickingColor);
}
`,dT=function(e){(0,mr.Z)(t,e);var a=cT(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.strokeOpacity,v=p===void 0?1:p,g=r.strokeWidth,E=g===void 0?0:g,T=r.stroke,O=T===void 0?"rgba(0,0,0,0)":T,F=r.offsets,U=F===void 0?[0,0]:F,j=r.blend,K=r.blur,ae=K===void 0?0:K;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:v,strokeWidth:E,stroke:O,offsets:U})){this.judgeStyleAttributes({opacity:u,strokeOpacity:v,strokeWidth:E,stroke:O,offsets:U});var ve=this.layer.getEncodedData(),ke=this.calDataFrame(this.cellLength,ve,this.cellProperties),qe=ke.data,ct=ke.width,_t=ke.height;this.rowCount=_t,this.dataTexture=this.cellLength>0&&qe.length>0?this.createTexture2D({flipY:!0,data:qe,format:X.LUMINANCE,type:X.FLOAT,width:ct,height:_t}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_blur:ae,u_additive:j==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Br.isNumber)(u)?u:1,u_stroke_opacity:(0,Br.isNumber)(v)?v:1,u_stroke_width:(0,Br.isNumber)(E)?E:1,u_stroke_color:this.getStrokeColor(O),u_offsets:this.isOffsetStatic(U)?U:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){this.layer.triangulation=F_,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:pT,fragmentShader:hT,triangulation:F_,depth:{enable:!0},blend:this.getBlend()}).then(function(o){r([o])}).catch(function(o){console.warn(o),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Tn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,p,v,g){var E=(0,pr.Z)(v,3),T=E[0],O=E[1],F=E[2],U=ts.fromValues(0,0,1),j=ts.fromValues(T,0,F),K=T>=0?ts.angle(U,j):Math.PI*2-ts.angle(U,j),ae=Math.PI*2-Math.asin(O/100),ve=Ra.create();Ra.rotateY(ve,ve,K),Ra.rotateX(ve,ve,ae);var ke=ts.fromValues(1,1,0);ts.transformMat4(ke,ke,ve),ts.normalize(ke,ke);var qe=ts.fromValues(-1,1,0);ts.transformMat4(qe,qe,ve),ts.normalize(qe,qe);var ct=ts.fromValues(-1,-1,0);ts.transformMat4(ct,ct,ve),ts.normalize(ct,ct);var _t=ts.fromValues(1,-1,0);ts.transformMat4(_t,_t,ve),ts.normalize(_t,_t);var Ot=[].concat((0,Ee.Z)(ke),(0,Ee.Z)(qe),(0,Ee.Z)(ct),(0,Ee.Z)(_t)),Xt=g%4*3;return[Ot[Xt],Ot[Xt+1],Ot[Xt+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,T=E===void 0?5:E;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Tn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.shape,T=E===void 0?2:E,O=r.layer.getLayerConfig().shape2d,F=O.indexOf(T);return[F]}}})}}]),t}(ko);function vT(e){var a=mT();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function mT(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var gT=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,yT=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }

  setPickingColor(a_PickingColor);
}
`,vx=function(e){(0,mr.Z)(t,e);var a=vT(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"raiseCount",0),(0,ee.Z)((0,dt.Z)(i),"raiserepeat",0),i}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,p=r.opacity,v=p===void 0?1:p,g=r.sourceColor,E=r.targetColor,T=r.pickLight,O=T===void 0?!1:T,F=r.heightfixed,U=F===void 0?!1:F,j=r.opacityLinear,K=j===void 0?{enable:!1,dir:"up"}:j,ae=r.lightEnable,ve=ae===void 0?!0:ae;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var ke=this.layer.getEncodedData(),qe=this.calDataFrame(this.cellLength,ke,this.cellProperties),ct=qe.data,_t=qe.width,Ot=qe.height;this.rowCount=Ot,this.dataTexture=this.cellLength>0&&ct.length>0?this.createTexture2D({flipY:!0,data:ct,format:X.LUMINANCE,type:X.FLOAT,width:_t,height:Ot}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}var Xt=0,yr=[0,0,0,0],Pr=[0,0,0,0];if(g&&E&&(yr=S(g),Pr=S(E),Xt=1),this.raiseCount<1&&this.raiserepeat>0&&u.enable){var xr=u.speed,An=xr===void 0?.01:xr,ii=u.repeat,sa=ii===void 0?!1:ii;this.raiseCount+=An,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(O),u_heightfixed:Number(U),u_r:u.enable&&this.raiserepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Br.isNumber)(v)?v:1,u_linearColor:Xt,u_sourceColor:yr,u_targetColor:Pr,u_opacitylinear:Number(K.enable),u_opacitylinear_dir:K.dir==="up"?1:0,u_lightEnable:Number(ve)}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(){var i=(0,Sa.Z)(zn().mark(function o(u){var p,v,g,E,T;return zn().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:p=this.layer.getLayerConfig(),v=p.depth,g=v===void 0?!0:v,E=p.animateOption.repeat,T=E===void 0?1:E,this.raiserepeat=T,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:yT,fragmentShader:gT,triangulation:ny,blend:this.getBlend(),cull:{enable:!0,face:uf(this.mapService.version)},depth:{enable:g}}).then(function(U){u([U])}).catch(function(U){console.warn(U),u([])});case 3:case"end":return F.stop()}},o,this)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,p,v){var g=o.size;if(g){var E=[];return Array.isArray(g)&&(E=g.length===2?[g[0],g[0],g[1]]:g),Array.isArray(g)||(E=[g,g,g]),E}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Tn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u,p,v,g){return g}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Tn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(o,u){var p=hu(o.coordinates);return[p[0],p[1],0]}}})}}]),t}(ko);function _T(e){var a=xT();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function xT(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var mx=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,bT=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,hy=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_meter2coord;
uniform float u_meteryScale;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size) * u_meter2coord;
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    if(newSize * pow(2.0, u_Zoom) < 48.0) {
      antialiasblur = max(antialiasblur, -0.05);
    } else if(newSize * pow(2.0, u_Zoom) < 128.0) {
      antialiasblur = max(antialiasblur, -0.6/pow(u_Zoom, 2.0));
    } else {
      antialiasblur = max(antialiasblur, -0.8/pow(u_Zoom, 2.0));
    }
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.x += offset.x / u_meteryScale;
      aPosition.y += offset.y;
      offset = vec2(0.0);
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_raisingHeight;

  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }
 

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,gx=function(e){(0,mr.Z)(t,e);var a=_T(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"meter2coord",1),(0,ee.Z)((0,dt.Z)(i),"meteryScale",1),(0,ee.Z)((0,dt.Z)(i),"isMeter",!1),(0,ee.Z)((0,dt.Z)(i),"unit","l7size"),i}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.strokeOpacity,v=p===void 0?1:p,g=r.strokeWidth,E=g===void 0?0:g,T=r.stroke,O=T===void 0?"rgba(0,0,0,0)":T,F=r.offsets,U=F===void 0?[0,0]:F,j=r.blend,K=r.blur,ae=K===void 0?0:K,ve=r.raisingHeight,ke=ve===void 0?0:ve,qe=r.heightfixed,ct=qe===void 0?!1:qe,_t=r.unit,Ot=_t===void 0?"l7size":_t;if(this.updateUnit(Ot),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:v,strokeWidth:E,stroke:O,offsets:U})){this.judgeStyleAttributes({opacity:u,strokeOpacity:v,strokeWidth:E,stroke:O,offsets:U});var Xt=this.layer.getEncodedData(),yr=this.calDataFrame(this.cellLength,Xt,this.cellProperties),Pr=yr.data,xr=yr.width,An=yr.height;this.rowCount=An,this.dataTexture=this.cellLength>0&&Pr.length>0?this.createTexture2D({flipY:!0,data:Pr,format:X.LUMINANCE,type:X.FLOAT,width:xr,height:An}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(ke),u_heightfixed:Number(ct),u_meter2coord:this.meter2coord,u_meteryScale:this.meteryScale,u_isMeter:Number(this.isMeter),u_blur:ae,u_additive:j==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Br.isNumber)(u)?u:1,u_stroke_opacity:(0,Br.isNumber)(v)?v:1,u_stroke_width:(0,Br.isNumber)(E)?E:1,u_stroke_color:this.getStrokeColor(O),u_offsets:this.isOffsetStatic(U)?U:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),nh)}},{key:"initModels",value:function(r){this.updateUnit("l7size"),this.buildModels(r)}},{key:"calMeter2Coord",value:function(){var r=(0,pr.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],p=r[2],v=r[3],g=[(o+p)/2,(u+v)/2],E=this.mapService.version,T=Ia==null?void 0:Ia.mapboxgl;if(E===ju.MAPBOX&&T!==null&&T!==void 0&&T.MercatorCoordinate){var O=T.MercatorCoordinate.fromLngLat({lng:g[0],lat:g[1]},0),F=O.meterInMercatorCoordinateUnits(),U=new T.MercatorCoordinate(O.x-F,O.y,O.z),j=U.toLngLat(),K=new T.MercatorCoordinate(O.x,O.y-F,O.z),ae=K.toLngLat();this.meter2coord=g[0]-j.lng,this.meteryScale=(ae.lat-g[1])/this.meter2coord;return}var ve=this.mapService.meterToCoord(g,[o,u]),ke=this.mapService.meterToCoord(g,[p===o?p+.1:p,v===u?u+.1:v]);this.meter2coord=(ve+ke)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var i=(0,Sa.Z)(zn().mark(function o(u){var p,v,g,E,T,O,F,U,j,K,ae,ve,ke,qe,ct;return zn().wrap(function(Ot){for(;;)switch(Ot.prev=Ot.next){case 0:p=this.layer.getLayerConfig(),v=p.mask,g=v===void 0?!1:v,E=p.maskInside,T=E===void 0?!0:E,O=p.animateOption,F=O===void 0?{enable:!1}:O,U=p.workerEnabled,j=U===void 0?!1:U,K=p.enablePicking,ae=p.shape2d,ve=this.getShaders(F),ke=ve.frag,qe=ve.vert,ct=ve.type,this.layer.triangulation=nh,this.layer.buildLayerModel({moduleName:ct,vertexShader:qe,fragmentShader:ke,triangulation:nh,depth:{enable:!1},blend:this.getBlend(),stencil:le(g,T),workerEnabled:j,workerOptions:{modelType:ct,enablePicking:K,shape2d:ae}}).then(function(Xt){u([Xt])}).catch(function(Xt){console.warn(Xt),u([])});case 4:case"end":return Ot.stop()}},o,this)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"getShaders",value:function(r){if(r.enable)switch(r.type){case"wave":return{frag:mx,vert:hy,type:"pointWave"};default:return{frag:mx,vert:hy,type:"pointWave"}}else return{frag:bT,vert:hy,type:"pointFill"}}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Tn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,p,v,g){var E=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],T=g%4*3;return[E[T],E[T+1],E[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,T=E===void 0?5:E;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Tn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.shape,T=E===void 0?2:E,O=r.indexOf(T);return[O]}}})}},{key:"updateUnit",value:function(r){var o=this.mapService.version;this.unit!==r&&(this.unit!=="meter"&&r==="meter"&&o!==ju.L7MAP&&o!==ju.GLOBEL?(this.isMeter=!0,this.calMeter2Coord()):this.unit==="meter"&&r!=="meter"&&(this.isMeter=!1,this.meter2coord=1),this.unit=r)}}]),t}(ko);function ET(e){var a=CT();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function CT(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ST=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,wT=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,AT=function(e){(0,mr.Z)(t,e);var a=ET(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"meter2coord",1),(0,ee.Z)((0,dt.Z)(i),"isMeter",!1),(0,ee.Z)((0,dt.Z)(i),"radian",0),(0,ee.Z)((0,dt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),i.layer.renderLayers();return}i.texture=p({data:i.iconService.getCanvas(),mag:X.LINEAR,min:X.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128,mipmap:!0})}),i}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.offsets,v=p===void 0?[0,0]:p,g=r.rotation,E=r.raisingHeight,T=E===void 0?0:E,O=r.heightfixed,F=O===void 0?!1:O;this.rendererService.getDirty()&&this.texture.bind();var U=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(U=-1),this.radian=g!==void 0?U*Math.PI*g/180:U*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:v})){this.judgeStyleAttributes({opacity:u,offsets:v});var j=this.layer.getEncodedData(),K=this.calDataFrame(this.cellLength,j,this.cellProperties),ae=K.data,ve=K.width,ke=K.height;this.rowCount=ke,this.dataTexture=this.cellLength>0&&ae.length>0?this.createTexture2D({flipY:!0,data:ae,format:X.LUMINANCE,type:X.FLOAT,width:ve,height:ke}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(T),u_heightfixed:Number(F),u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,Br.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),J0)}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var o=this.layer.getLayerConfig(),u=o.unit,p=u===void 0?"l7size":u,v=this.mapService.version;p==="meter"&&v!==ju.L7MAP&&v!==ju.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(r)}},{key:"calMeter2Coord",value:function(){var r=(0,pr.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],p=r[2],v=r[3],g=[(o+p)/2,(u+v)/2],E=this.mapService.version;if(E===ju.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:g[0],lat:g[1]},0),O=1,F=O*T.meterInMercatorCoordinateUnits(),U=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),j=U.toLngLat();this.meter2coord=g[0]-j.lng;return}var K=this.mapService.meterToCoord(g,[o,u]),ae=this.mapService.meterToCoord(g,[p===o?p+.1:p,v===u?u+.1:v]);this.meter2coord=(K+ae)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:wT,fragmentShader:ST,triangulation:J0,depth:{enable:!1},blend:this.getBlend(),stencil:le(p,g),cull:{enable:!0,face:uf(this.mapService.version)}}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r,o;this.iconService.off("imageUpdate",this.updateTexture),(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Tn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.rotate,T=E===void 0?0:E;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),T=u.shape,O=E[T]||{x:0,y:0},F=O.x,U=O.y;return[F,U]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Tn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,p,v,g){var E=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],T=g%4*3;return[E[T],E[T+1],E[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,T=E===void 0?5:E;return Array.isArray(T)?[T[0]*r.meter2coord]:[T*r.meter2coord]}}})}}]),t}(ko);function TT(e){var a=MT();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function MT(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var kT=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,IT=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(textrueOffsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,yx=function(e){(0,mr.Z)(t,e);var a=TT(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),i.layer.renderLayers();return}i.texture=p({data:i.iconService.getCanvas(),mag:X.LINEAR,min:X.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128,mipmap:!0})}),i}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.offsets,v=p===void 0?[0,0]:p,g=r.raisingHeight,E=g===void 0?0:g,T=r.heightfixed,O=T===void 0?!1:T;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:v})){this.judgeStyleAttributes({opacity:u,offsets:v});var F=this.layer.getEncodedData(),U=this.calDataFrame(this.cellLength,F,this.cellProperties),j=U.data,K=U.width,ae=U.height;this.rowCount=ae,this.dataTexture=this.cellLength>0&&j.length>0?this.createTexture2D({flipY:!0,data:j,format:X.LUMINANCE,type:X.FLOAT,width:K,height:ae}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(E),u_heightfixed:Number(O),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,Br.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"initModels",value:function(r){this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:IT,fragmentShader:kT,triangulation:gC,depth:{enable:!1},primitive:X.POINTS,blend:this.getBlend(),stencil:le(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,T=E===void 0?5:E;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Tn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),T=u.shape,O=E[T]||{x:0,y:0},F=O.x,U=O.y;return[F,U]}}})}}]),t}(ko);function PT(e){var a=LT();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function LT(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var RT=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,OT=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function _x(e){var a=e.coordinates;return{vertices:(0,Ee.Z)(a),indices:[0],size:a.length}}var xx=function(e){(0,mr.Z)(t,e);var a=PT(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.offsets,v=p===void 0?[0,0]:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:v})){this.judgeStyleAttributes({opacity:u,offsets:v});var g=this.layer.getEncodedData(),E=this.calDataFrame(this.cellLength,g,this.cellProperties),T=E.data,O=E.width,F=E.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:X.LUMINANCE,type:X.FLOAT,width:O,height:F}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Br.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.triangulation=_x,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:OT,fragmentShader:RT,triangulation:_x,depth:{enable:!1},primitive:X.POINTS,blend:this.getBlend(),stencil:le(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){var g=o.size,E=g===void 0?1:g;return Array.isArray(E)?[E[0]]:[E]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Bh.additive}}}]),t}(ko);function FT(e){var a=DT();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function DT(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var BT=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,NT=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  vec2 offset = (extrude.xy * (newSize) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,zT=function(e){(0,mr.Z)(t,e);var a=FT(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"meter2coord",1),(0,ee.Z)((0,dt.Z)(i),"isMeter",!1),i}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.offsets,v=p===void 0?[0,0]:p,g=r.blend,E=r.speed,T=E===void 0?1:E;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:v})){this.judgeStyleAttributes({opacity:u,offsets:v});var O=this.layer.getEncodedData(),F=this.calDataFrame(this.cellLength,O,this.cellProperties),U=F.data,j=F.width,K=F.height;this.rowCount=K,this.dataTexture=this.cellLength>0&&U.length>0?this.createTexture2D({flipY:!0,data:U,format:X.LUMINANCE,type:X.FLOAT,width:j,height:K}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:T,u_additive:g==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Br.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),J0)}},{key:"initModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.unit,p=u===void 0?"l7size":u,v=this.mapService.version;p==="meter"&&v!==ju.L7MAP&&v!==ju.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(r)}},{key:"calMeter2Coord",value:function(){var r=(0,pr.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],p=r[2],v=r[3],g=[(o+p)/2,(u+v)/2],E=this.mapService.version;if(E===ju.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:g[0],lat:g[1]},0),O=1,F=O*T.meterInMercatorCoordinateUnits(),U=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),j=U.toLngLat();this.meter2coord=g[0]-j.lng;return}var K=this.mapService.meterToCoord(g,[o,u]),ae=this.mapService.meterToCoord(g,[p===o?p+.1:p,v===u?u+.1:v]);this.meter2coord=(K+ae)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:NT,fragmentShader:BT,triangulation:J0,depth:{enable:!1},blend:this.getBlend(),stencil:le(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Tn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(u,p,v,g){var E=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],T=g%4*3;return[E[T],E[T+1],E[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,T=E===void 0?5:E;return Array.isArray(T)?[T[0]*r.meter2coord]:[T*r.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Tn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(u,p,v,g){var E=u.shape,T=E===void 0?2:E,O=r.layer.getLayerConfig().shape2d,F=O.indexOf(T);return[F]}}})}}]),t}(ko);function UT(e){var a=ZT();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function ZT(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var VT=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,jT=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function bx(e){var a=e.coordinates;return{vertices:(0,Ee.Z)(a),indices:[0],size:a.length}}var GT=function(e){(0,mr.Z)(t,e);var a=UT(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.offsets,v=p===void 0?[0,0]:p,g=r.blend,E=r.strokeOpacity,T=E===void 0?1:E,O=r.strokeWidth,F=O===void 0?0:O,U=r.stroke,j=U===void 0?"#fff":U;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:v})){this.judgeStyleAttributes({opacity:u,offsets:v});var K=this.layer.getEncodedData(),ae=this.calDataFrame(this.cellLength,K,this.cellProperties),ve=ae.data,ke=ae.width,qe=ae.height;this.rowCount=qe,this.dataTexture=this.cellLength>0&&ve.length>0?this.createTexture2D({flipY:!0,data:ve,format:X.LUMINANCE,type:X.FLOAT,width:ke,height:qe}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_additive:g==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Br.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(v)?v:[0,0],u_stroke_opacity:(0,Br.isNumber)(T)?T:1,u_stroke_width:(0,Br.isNumber)(F)?F:1,u_stroke_color:this.getStrokeColor(j)}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.triangulation=bx,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:jT,fragmentShader:VT,triangulation:bx,depth:{enable:!1},primitive:X.POINTS,blend:this.getBlend(),stencil:le(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){var g=o.size,E=g===void 0?1:g;return Array.isArray(E)?[E[0]]:[E]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Bh.additive}}}]),t}(ko);function HT(e,a){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=WT(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function WT(e,a){if(!!e){if(typeof e=="string")return Ex(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ex(e,a)}}function Ex(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function XT(e){var a=YT();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function YT(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Cx=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Sx=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function Ax(e){var a=this,t=e.id,i=[],r=[];if(!a.glyphInfoMap||!a.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var o=a.glyphInfoMap[t].centroid,u=o.length===2?[o[0],o[1],0]:o;return a.glyphInfoMap[t].glyphQuads.forEach(function(p,v){i.push.apply(i,(0,Ee.Z)(u).concat([p.tex.x,p.tex.y+p.tex.height,p.tl.x,p.tl.y],(0,Ee.Z)(u),[p.tex.x+p.tex.width,p.tex.y+p.tex.height,p.tr.x,p.tr.y],(0,Ee.Z)(u),[p.tex.x+p.tex.width,p.tex.y,p.br.x,p.br.y],(0,Ee.Z)(u),[p.tex.x,p.tex.y,p.bl.x,p.bl.y])),r.push(0+v*4,1+v*4,2+v*4,2+v*4,3+v*4,0+v*4)}),{vertices:i,indices:r,size:7}}var Tx=function(e){(0,mr.Z)(t,e);var a=XT(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"glyphInfoMap",{}),(0,ee.Z)((0,dt.Z)(i),"currentZoom",-1),(0,ee.Z)((0,dt.Z)(i),"textureHeight",0),(0,ee.Z)((0,dt.Z)(i),"textCount",0),(0,ee.Z)((0,dt.Z)(i),"preTextStyle",{}),(0,ee.Z)((0,dt.Z)(i),"buildModels",function(){var p=(0,Sa.Z)(zn().mark(function v(g){var E,T,O,F,U;return zn().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:E=i.layer.getLayerConfig(),T=E.mask,O=T===void 0?!1:T,F=E.maskInside,U=F===void 0?!0:F,i.mapping(),i.layer.buildLayerModel({moduleName:"pointText",vertexShader:Sx,fragmentShader:Cx,triangulation:Ax.bind((0,dt.Z)(i)),depth:{enable:!1},blend:i.getBlend(),stencil:le(O,U)}).then(function(ae){g([ae])}).catch(function(ae){console.warn(ae),g([])});case 3:case"end":return K.stop()}},v)}));return function(v){return p.apply(this,arguments)}}()),(0,ee.Z)((0,dt.Z)(i),"mapping",function(){i.initGlyph(),i.updateTexture(),i.filterGlyphs(),i.reBuildModel()}),i}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.stroke,v=p===void 0?"#fff":p,g=r.strokeWidth,E=g===void 0?0:g,T=r.textAnchor,O=T===void 0?"center":T,F=r.textAllowOverlap,U=F===void 0?!1:F,j=r.halo,K=j===void 0?.5:j,ae=r.gamma,ve=ae===void 0?2:ae,ke=r.raisingHeight,qe=ke===void 0?0:ke,ct=this.fontService,_t=ct.canvas,Ot=ct.mapping;if(Object.keys(Ot).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Ot).length),this.preTextStyle={textAnchor:O,textAllowOverlap:U},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeWidth:E,stroke:v})){this.judgeStyleAttributes({opacity:u,strokeWidth:E,stroke:v});var Xt=this.layer.getEncodedData(),yr=this.calDataFrame(this.cellLength,Xt,this.cellProperties),Pr=yr.data,xr=yr.width,An=yr.height;this.rowCount=An,this.dataTexture=this.cellLength>0&&Pr.length>0?this.createTexture2D({flipY:!0,data:Pr,format:X.LUMINANCE,type:X.FLOAT,width:xr,height:An}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(qe),u_opacity:(0,Br.isNumber)(u)?u:1,u_stroke_width:(0,Br.isNumber)(E)?E:1,u_stroke_color:this.getStrokeColor(v),u_sdf_map:this.texture,u_halo_blur:K,u_gamma_scale:ve,u_sdf_map_size:[_t.width,_t.height]}}},{key:"initModels",value:function(r){this.layer.on("remapping",this.mapping),this.extent=this.textExtent();var o=this.layer.getLayerConfig(),u=o.textAnchor,p=u===void 0?"center":u,v=o.textAllowOverlap,g=v===void 0?!0:v;this.preTextStyle={textAnchor:p,textAllowOverlap:g},this.buildModels(r)}},{key:"needUpdate",value:function(){var r=this.layer.getLayerConfig(),o=r.textAllowOverlap,u=o===void 0?!1:o,p=this.mapService.getZoom(),v=this.mapService.getBounds(),g=pc(this.extent,v);return!u&&(Math.abs(this.currentZoom-p)>1||!g)||u!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Tn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){var g=o.rotate,E=g===void 0?0:g;return Array.isArray(E)?[E[0]]:[E]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Tn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){return[p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(o,u,p,v){var g=o.size,E=g===void 0?12:g;return Array.isArray(E)?[E[0]]:[E]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Tn.Attribute,descriptor:{name:"a_tex",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(o,u,p,v){return[p[3],p[4]]}}})}},{key:"textExtent",value:function(){var r=this.mapService.getBounds();return hc(r,.5)}},{key:"initTextFont",value:function(){var r=this.layer.getLayerConfig(),o=r.fontWeight,u=o===void 0?"400":o,p=r.fontFamily,v=p===void 0?"sans-serif":p,g=this.layer.getEncodedData(),E=[];g.forEach(function(T){var O=T.shape,F=O===void 0?"":O;F=F.toString();var U=HT(F),j;try{for(U.s();!(j=U.n()).done;){var K=j.value;E.indexOf(K)===-1&&E.push(K)}}catch(ae){U.e(ae)}finally{U.f()}}),this.fontService.setFontOptions({characterSet:E,fontWeight:u,fontFamily:v,iconfont:!1})}},{key:"initIconFontTex",value:function(){var r=this.layer.getLayerConfig(),o=r.fontWeight,u=o===void 0?"400":o,p=r.fontFamily,v=p===void 0?"sans-serif":p,g=this.layer.getEncodedData(),E=[];g.forEach(function(T){var O=T.shape,F=O===void 0?"":O;F="".concat(F),E.indexOf(F)===-1&&E.push(F)}),this.fontService.setFontOptions({characterSet:E,fontWeight:u,fontFamily:v,iconfont:!0})}},{key:"generateGlyphLayout",value:function(r){var o=this,u=this.fontService.mapping,p=this.layer.getLayerConfig(),v=p.spacing,g=v===void 0?2:v,E=p.textAnchor,T=E===void 0?"center":E,O=this.layer.getEncodedData();this.glyphInfo=O.map(function(F){var U=F.shape,j=U===void 0?"":U,K=F.id,ae=F.size,ve=ae===void 0?1:ae,ke=F.textOffset,qe=ke===void 0?[0,0]:ke,ct=tx(j.toString(),u,ve,T,"left",g,qe,r),_t=rx(ct,qe,!1);return F.shaping=ct,F.glyphQuads=_t,F.centroid=hu(F.coordinates),F.originCentroid=F.version==="GAODE2.x"?hu(F.originCoordinates):F.originCentroid=F.centroid,o.glyphInfoMap[K]={shaping:ct,glyphQuads:_t,centroid:hu(F.coordinates)},F})}},{key:"filterGlyphs",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.padding,p=u===void 0?[4,4]:u,v=o.textAllowOverlap,g=v===void 0?!1:v;if(!g){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var E=this.rendererService.getViewportSize(),T=E.width,O=E.height,F=new q_(T,O),U=this.glyphInfo.filter(function(j){var K=j.shaping,ae=j.id,ve=ae===void 0?0:ae,ke=j.version==="GAODE2.x"?j.originCentroid:j.centroid,qe=j.size,ct=qe/24,_t=r.mapService.lngLatToContainer(ke),Ot=F.placeCollisionBox({x1:K.left*ct-p[0],x2:K.right*ct+p[0],y1:K.top*ct-p[1],y2:K.bottom*ct+p[1],anchorPointX:_t.x,anchorPointY:_t.y}),Xt=Ot.box;return Xt&&Xt.length?(F.insertCollisionBox(Xt,ve),!0):!1});U.forEach(function(j){r.glyphInfoMap[j.id]=j})}}},{key:"initGlyph",value:function(){var r=this.layer.getLayerConfig(),o=r.iconfont,u=o===void 0?!1:o;u?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(u)}},{key:"updateTexture",value:function(){var r=this.rendererService.createTexture2D,o=this.fontService.canvas;this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=r({data:o,mag:X.LINEAR,min:X.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Sx,fragmentShader:Cx,triangulation:Ax.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:le(p,g)}).then(function(E){r.layer.models=[E],r.layer.renderLayers()}).catch(function(E){console.warn(E),r.layer.models=[]})}}]),t}(ko),qT={fillImage:AT,fill:gx,radar:zT,image:yx,normal:xx,simplePoint:GT,extrude:vx,text:Tx,vectorpoint:ug,tile:sg,tileText:sx,earthFill:dT,earthExtrude:lT},$T=qT;function KT(e,a){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=QT(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function QT(e,a){if(!!e){if(typeof e=="string")return Mx(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Mx(e,a)}}function Mx(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function JT(e){var a=e5();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function e5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var t5=function(e){(0,mr.Z)(t,e);var a=JT(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"type","PointLayer"),(0,ee.Z)((0,dt.Z)(i),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),i}return(0,St.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new $T[o](this),this.layerModel.initModels(function(u){r.models=u,r.layerService.updateLayerRenderList(),r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var r=this.shapeOption,o=r.field,u=r.values,p=this.getLayerConfig(),v=p.shape2d,g=this.iconService.getIconMap();if(o&&(v==null?void 0:v.indexOf(o))!==-1)return"fill";if(u&&u instanceof Array){var E=KT(u),T;try{for(E.s();!(T=E.n()).done;){var O=T.value;if(typeof O=="string"&&g.hasOwnProperty(O))return"image"}}catch(F){E.e(F)}finally{E.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},vectorpoint:{},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return o[r]}},{key:"getModelType",value:function(){var r=this.layerSource.getParserType();if(oy(r))return"vectorpoint";var o=this.getEncodedData(),u=this.getLayerConfig(),p=u.shape2d,v=u.shape3d,g=this.iconService.getIconMap(),E=o.find(function(O){return O.hasOwnProperty("shape")});if(E){var T=E.shape;return T==="dot"?"normal":T==="simple"?"simplePoint":T==="radar"?"radar":this.layerType==="fillImage"?"fillImage":(p==null?void 0:p.indexOf(T))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(v==null?void 0:v.indexOf(T))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":g.hasOwnProperty(T)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),t}(Ld);function r5(e){var a=n5();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function n5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var i5=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,a5=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,o5=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,s5=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,u5=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,l5=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,c5=function(e){(0,mr.Z)(t,e);var a=r5(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.heightfixed,v=p===void 0?!1:p,g=r.raisingHeight,E=g===void 0?0:g,T=r.topsurface,O=T===void 0?!0:T,F=r.sidesurface,U=F===void 0?!0:F,j=r.sourceColor,K=r.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var ae=this.layer.getEncodedData(),ve=this.calDataFrame(this.cellLength,ae,this.cellProperties),ke=ve.data,qe=ve.width,ct=ve.height;this.rowCount=ct,this.dataTexture=this.cellLength>0&&ke.length>0?this.createTexture2D({flipY:!0,data:ke,format:X.LUMINANCE,type:X.FLOAT,width:qe,height:ct}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}var _t=0,Ot=[1,1,1,1],Xt=[1,1,1,1];return j&&K&&(Ot=S(j),Xt=S(K),_t=1),{u_topsurface:Number(O),u_sidesurface:Number(U),u_heightfixed:Number(v),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(E),u_opacity:(0,Br.isNumber)(u)?u:1,u_linearColor:_t,u_sourceColor:Ot,u_targetColor:Xt,u_texture:this.texture}}},{key:"initModels",value:function(r){this.loadTexture(),this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v,E=this.getShaders(),T=E.frag,O=E.vert,F=E.type;this.layer.buildLayerModel({moduleName:F,vertexShader:O,fragmentShader:T,triangulation:B_,stencil:le(p,g)}).then(function(U){r([U])}).catch(function(U){console.warn(U),r([])})}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.pickLight,u=r.mapTexture;return u?{frag:o5,vert:s5,type:"polygonExtrudeTexture"}:o?{frag:u5,vert:l5,type:"polygonExtrudePickLight"}:{frag:i5,vert:a5,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var r,o;(r=this.dataTexture)===null||r===void 0||r.destroy(),(o=this.texture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,pr.Z)(r,4),u=o[0],p=o[1],v=o[2],g=o[3],E=v-u,T=g-p;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Tn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(F,U,j,K,ae){var ve=j[0],ke=j[1];return[(ve-u)/E,(ke-p)/T,j[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Tn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(F,U,j,K,ae){return ae}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Tn.Attribute,descriptor:{name:"a_Size",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(F,U,j,K){var ae=F.size,ve=ae===void 0?10:ae;return Array.isArray(ve)?[ve[0]]:[ve]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.mapTexture,p=this.rendererService.createTexture2D;if(this.texture=p({height:0,width:0}),u){var v=new Image;v.crossOrigin="",v.src=u,v.onload=function(){r.texture=p({data:v,width:v.width,height:v.height,wrapS:X.CLAMP_TO_EDGE,wrapT:X.CLAMP_TO_EDGE,min:X.LINEAR,mag:X.LINEAR}),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()}}}}]),t}(ko);function f5(e){var a=h5();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function h5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var p5=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,d5=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,v5=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,m5=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,g5=function(e){(0,mr.Z)(t,e);var a=f5(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.raisingHeight,u=o===void 0?0:o,p=r.opacity,v=p===void 0?1:p,g=r.opacityLinear,E=g===void 0?{enable:!1,dir:"in"}:g;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var T=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,T,this.cellProperties),F=O.data,U=O.width,j=O.height;this.rowCount=j,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:X.LUMINANCE,type:X.FLOAT,width:U,height:j}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(u),u_opacity:(0,Br.isNumber)(v)?v:1,u_opacitylinear:Number(E.enable),u_dir:E.dir==="in"?1:0}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.getModelParams(),u=o.frag,p=o.vert,v=o.triangulation,g=o.type,E=this.layer.getLayerConfig(),T=E.mask,O=T===void 0?!1:T,F=E.maskInside,U=F===void 0?!0:F,j=E.workerEnabled,K=j===void 0?!1:j,ae=E.enablePicking;this.layer.triangulation=v,this.layer.buildLayerModel({moduleName:g,vertexShader:p,fragmentShader:u,triangulation:v,primitive:X.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:le(O,U),workerEnabled:K,workerOptions:{modelType:g,enablePicking:ae}}).then(function(ve){r([ve])}).catch(function(ve){console.warn(ve),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getLayerConfig(),o=r.opacityLinear,u=o===void 0?{enable:!1,dir:"in"}:o;u.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Tn.Attribute,descriptor:{name:"a_linear",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:3,update:function(v,g,E,T,O){return[E[3],E[4],E[5]]}}})}},{key:"getModelParams",value:function(){var r=this.layer.getLayerConfig(),o=r.opacityLinear,u=o===void 0?{enable:!1}:o;return u.enable?{frag:d5,vert:v5,type:"polygonLinear",triangulation:xC}:{frag:p5,vert:m5,type:"polygonFill",triangulation:nf}}}]),t}(ko);function y5(e){var a=_5();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function _5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var x5=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);  
}
`,b5=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,E5=function(e){(0,mr.Z)(t,e);var a=y5(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.watercolor,v=p===void 0?"#6D99A8":p,g=r.watercolor2,E=g===void 0?"#0F121C":g;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var T=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,T,this.cellProperties),F=O.data,U=O.width,j=O.height;this.rowCount=j,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:X.LUMINANCE,type:X.FLOAT,width:U,height:j}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:S(v),u_watercolor2:S(E),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,Br.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.loadTexture(),this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:b5,fragmentShader:x5,triangulation:gm,primitive:X.TRIANGLES,depth:{enable:!1},stencil:le(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r,o,u,p;(r=this.texture1)===null||r===void 0||r.destroy(),(o=this.texture2)===null||o===void 0||o.destroy(),(u=this.texture3)===null||u===void 0||u.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,pr.Z)(r,4),u=o[0],p=o[1],v=o[2],g=o[3],E=v-u,T=g-p;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Tn.Attribute,descriptor:{name:"a_uv",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(F,U,j,K,ae){var ve=(0,pr.Z)(j,2),ke=ve[0],qe=ve[1];return[(ke-u)/E,(qe-p)/T]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.rendererService.createTexture2D,u={height:0,width:0};this.texture1=o(u),this.texture2=o(u),this.texture3=o(u),p(function(g){r.texture1=v(g[0]),r.texture2=v(g[1]),r.texture3=v(g[2]),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()});function p(g){var E=0,T=[],O=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];O.map(function(F){var U=new Image;U.crossOrigin="",U.src=F,T.push(U),U.onload=function(){E++,E===3&&g(T)}})}function v(g){return o({data:g,width:g.width,height:g.height,wrapS:X.MIRRORED_REPEAT,wrapT:X.MIRRORED_REPEAT,min:X.LINEAR,mag:X.LINEAR})}}}]),t}(ko);function C5(e){var a=S5();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function S5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var w5=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E


float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,A5=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,T5=function(e){(0,mr.Z)(t,e);var a=C5(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.speed,v=p===void 0?.5:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var g=this.layer.getEncodedData(),E=this.calDataFrame(this.cellLength,g,this.cellProperties),T=E.data,O=E.width,F=E.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:X.LUMINANCE,type:X.FLOAT,width:O,height:F}):this.createTexture2D({flipY:!0,data:[1],format:X.LUMINANCE,type:X.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:v,u_opacity:(0,Br.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.loadTexture(),this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:A5,fragmentShader:w5,triangulation:gm,primitive:X.TRIANGLES,depth:{enable:!1},stencil:le(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,pr.Z)(r,4),u=o[0],p=o[1],v=o[2],g=o[3],E=v-u,T=g-p;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Tn.Attribute,descriptor:{name:"a_uv",buffer:{usage:X.STATIC_DRAW,data:[],type:X.FLOAT},size:2,update:function(F,U,j,K,ae){var ve=(0,pr.Z)(j,2),ke=ve[0],qe=ve[1];return[(ke-u)/E,(qe-p)/T]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.waterTexture,p=this.rendererService.createTexture2D;this.texture=p({height:0,width:0});var v=new Image;v.crossOrigin="",u?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),v.src=u):v.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",v.onload=function(){r.texture=p({data:v,width:v.width,height:v.height,wrapS:X.MIRRORED_REPEAT,wrapT:X.MIRRORED_REPEAT,min:X.LINEAR,mag:X.LINEAR}),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()}}}]),t}(ko),M5={fill:g5,line:dx,extrude:c5,text:Tx,point_fill:gx,point_image:yx,point_normal:xx,point_extrude:vx,water:T5,ocean:E5,vectorpolygon:ug,tile:ux},k5=M5;function I5(e){var a=P5();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function P5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var kx=function(e){(0,mr.Z)(t,e);var a=I5(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"type","PolygonLayer"),i}return(0,St.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new k5[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var r,o=this.layerSource.getParserType();if(oy(o))return"vectorpolygon";var u=this.styleAttributeService.getLayerStyleAttribute("shape"),p=u==null||(r=u.scale)===null||r===void 0?void 0:r.field;return p==="fill"?"fill":p==="extrude"?"extrude":p==="water"?"water":p==="ocean"?"ocean":p==="line"?"line":p==="tile"?"tile":this.getPointModelType()}},{key:"getPointModelType",value:function(){var r=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,p=o.shape3d,v=this.iconService.getIconMap(),g=r.find(function(T){return T.hasOwnProperty("shape")});if(g){var E=g.shape;return E==="dot"?"point_normal":(u==null?void 0:u.indexOf(E))!==-1?"point_fill":(p==null?void 0:p.indexOf(E))!==-1?"point_extrude":v.hasOwnProperty(E)?"point_image":"text"}else return"fill"}}]),t}(Ld),L5={raster:cy,raster3d:cy,rasterTile:ug},R5=L5;function O5(e){var a=F5();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function F5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var D5=function(e){(0,mr.Z)(t,e);var a=O5(t);function t(){var i;(0,xt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,ee.Z)((0,dt.Z)(i),"type","RasterLayer"),i}return(0,St.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new R5[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={raster:{},raster3d:{},rasterTile:{}};return o[r]}},{key:"getModelType",value:function(){var r=this.layerSource.getParserType();switch(r){case"raster":return"raster";case"rasterTile":return"rasterTile";default:return"raster"}}}]),t}(Ld),Ix,Px,Lx,Rx,Ox,ym,Fx,Dx,Bx,B5=(Ix=(0,vr.b2)(),Px=(0,vr.f3)(At.IGlobalConfigService),Lx=(0,vr.f3)(At.IMapService),Rx=(0,vr.f3)(At.IFontService),Ix(Ox=(ym=function(){function e(){(0,xt.Z)(this,e),(0,da.Z)(this,"configService",Fx,this),(0,da.Z)(this,"mapService",Dx,this),(0,da.Z)(this,"fontService",Bx,this)}return(0,St.Z)(e,[{key:"apply",value:function(t,i){var r=this,o=i.styleAttributeService;t.hooks.init.tap("DataMappingPlugin",function(){var u=t.getSource();u.inited?r.generateMaping(t,{styleAttributeService:o}):u.once("sourceUpdate",function(){r.generateMaping(t,{styleAttributeService:o})})}),t.hooks.beforeRenderData.tap("DataMappingPlugin",function(){t.dataState.dataMappingNeedUpdate=!1;var u=t.getSource();return u.inited?r.generateMaping(t,{styleAttributeService:o}):u.once("sourceUpdate",function(){r.generateMaping(t,{styleAttributeService:o})}),!0}),t.hooks.beforeRender.tap("DataMappingPlugin",function(){var u=t.getSource();if(!(t.layerModelNeedUpdate||!u||!u.inited)){var p=t.getBottomColor(),v=o.getLayerStyleAttributes()||[],g=o.getLayerStyleAttribute("filter"),E=u.data.dataArray,T=v.filter(function(F){return F.needRemapping}),O=E;g!=null&&g.needRemapping&&g!==null&&g!==void 0&&g.scale&&(O=E.filter(function(F){return r.applyAttributeMapping(g,F,p)[0]})),T.length&&(g!=null&&g.needRemapping?(t.setEncodedData(r.mapping(t,v,O,void 0,p)),g.needRemapping=!1):t.setEncodedData(r.mapping(t,T,O,t.getEncodedData(),p)),t.emit("remapping",null))}})}},{key:"generateMaping",value:function(t,i){var r=this,o=i.styleAttributeService,u=t.getBottomColor(),p=o.getLayerStyleAttributes()||[],v=o.getLayerStyleAttribute("filter"),g=t.getSource().data.dataArray,E=g;v!=null&&v.scale&&(E=g.filter(function(T){return r.applyAttributeMapping(v,T,u)[0]})),t.setEncodedData(this.mapping(t,p,E,void 0,u)),t.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(t,i){var r=[i[0]-t[0],i[1]-t[1]],o=eh(r),u=[t[0]+o[0]*1e-4,t[1]+o[1]*1e-4];return u}},{key:"mapping",value:function(t,i,r,o,u){var p=this,v=t.getLayerConfig(),g=v.arrow,E=g===void 0?{enable:!1}:g,T=r.map(function(O,F){var U=o?o[F]:{},j=(0,Z.Z)({id:O._id,coordinates:O.coordinates},U);if(i.filter(function(ve){return ve.scale!==void 0}).forEach(function(ve){var ke=p.applyAttributeMapping(ve,O,u);ve.needRemapping=!1,ve.name==="color"&&(ke=ke.map(function(qe){return S(qe)})),j[ve.name]=Array.isArray(ke)&&ke.length===1?ke[0]:ke,ve.name==="shape"&&(j.shape=p.fontService.getIconFontKey(j[ve.name]))}),E.enable&&(j.shape==="line"||j.shape==="halfLine")){var K=j.coordinates,ae=p.getArrowPoints(K[0],K[1]);j.coordinates.splice(1,0,ae,ae)}return j});return this.adjustData2Amap2Coordinates(T,t),this.adjustData2SimpleCoordinates(T),T}},{key:"adjustData2Amap2Coordinates",value:function(t,i){var r=this;if(t.length>0&&this.mapService.version===ju["GAODE2.x"]){var o=this.getLayerCenter(i);typeof t[0].coordinates[0]=="number"?t.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=ju["GAODE2.x"],u.originCoordinates=(0,Br.cloneDeep)(u.coordinates),u.coordinates=r.mapService.lngLatToCoordByLayer(u.coordinates,o)}):t.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=ju["GAODE2.x"],u.originCoordinates=(0,Br.cloneDeep)(u.coordinates),u.coordinates=r.mapService.lngLatToCoordsByLayer(u.coordinates,o)})}}},{key:"getLayerCenter",value:function(t){var i=t.getSource();return i.center}},{key:"adjustData2SimpleCoordinates",value:function(t){var i=this;t.length>0&&this.mapService.version===ju.SIMPLE&&t.map(function(r){r.simpleCoordinate||(r.coordinates=i.unProjectCoordinates(r.coordinates),r.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(t){var i=this;if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var r=[];return t.map(function(u){var p=[];u.map(function(v){p.push(i.mapService.simpleMapCoord.unproject(v))}),r.push(p)}),r}else{var o=[];return t.map(function(u){o.push(i.mapService.simpleMapCoord.unproject(u))}),o}}},{key:"applyAttributeMapping",value:function(t,i,r){var o;if(!t.scale)return[];var u=(t==null||(o=t.scale)===null||o===void 0?void 0:o.scalers)||[],p=[];u.forEach(function(g){var E,T=g.field;(i.hasOwnProperty(T)||((E=t.scale)===null||E===void 0?void 0:E.type)==="variable")&&p.push(i[T])});var v=t.mapping?t.mapping(p):[];return t.name==="color"&&!m(v[0])?[r]:v}}]),e}(),Fx=(0,ca.Z)(ym.prototype,"configService",[Px],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dx=(0,ca.Z)(ym.prototype,"mapService",[Lx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bx=(0,ca.Z)(ym.prototype,"fontService",[Rx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ym))||Ox),Nx,zx,N5=(Nx=(0,vr.b2)(),Nx(zx=function(){function e(){(0,xt.Z)(this,e)}return(0,St.Z)(e,[{key:"apply",value:function(t){var i=this;this.mapService=t.getContainer().get(At.IMapService),t.hooks.init.tap("DataSourcePlugin",function(){var r=t.getSource();if(!r){var o=t.sourceOption||t.defaultSourceConfig,u=o.data,p=o.options;r=new Mi(u,p),t.setSource(r)}r.inited?i.updateClusterData(t):r.once("sourceUpdate",function(){i.updateClusterData(t)})}),t.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var r=i.updateClusterData(t),o=t.dataState.dataSourceNeedUpdate;return t.dataState.dataSourceNeedUpdate=!1,r||o})}},{key:"updateClusterData",value:function(t){var i=t.getSource(),r=i.cluster,o=i.clusterOptions.zoom,u=o===void 0?0:o,p=this.mapService.getZoom()-1,v=t.dataState.dataSourceNeedUpdate;return r&&v&&i.updateClusterData(Math.floor(p)),r&&Math.abs(t.clusterZoom-p)>=1?(u!==Math.floor(p)&&i.updateClusterData(Math.floor(p)),t.clusterZoom=p,!0):!1}}]),e}())||zx);function py(e,a){return e<a?-1:e>a?1:e>=a?0:NaN}function Ux(e){return e.length===1&&(e=z5(e)),{left:function(a,t,i,r){for(i==null&&(i=0),r==null&&(r=a.length);i<r;){var o=i+r>>>1;e(a[o],t)<0?i=o+1:r=o}return i},right:function(a,t,i,r){for(i==null&&(i=0),r==null&&(r=a.length);i<r;){var o=i+r>>>1;e(a[o],t)>0?r=o:i=o+1}return i}}}function z5(e){return function(a,t){return py(e(a),t)}}var Zx=Ux(py),U5=Zx.right,UI=Zx.left,lg=U5;function Vx(e,a){var t=e.length,i=-1,r,o,u;if(a==null){for(;++i<t;)if((r=e[i])!=null&&r>=r)for(o=u=r;++i<t;)(r=e[i])!=null&&(o>r&&(o=r),u<r&&(u=r))}else for(;++i<t;)if((r=a(e[i],i,e))!=null&&r>=r)for(o=u=r;++i<t;)(r=a(e[i],i,e))!=null&&(o>r&&(o=r),u<r&&(u=r));return[o,u]}var jx=Array.prototype,ZI=jx.slice,VI=jx.map,dy=Math.sqrt(50),vy=Math.sqrt(10),gy=Math.sqrt(2);function Gx(e,a,t){var i,r=-1,o,u,p;if(a=+a,e=+e,t=+t,e===a&&t>0)return[e];if((i=a<e)&&(o=e,e=a,a=o),(p=cg(e,a,t))===0||!isFinite(p))return[];if(p>0)for(e=Math.ceil(e/p),a=Math.floor(a/p),u=new Array(o=Math.ceil(a-e+1));++r<o;)u[r]=(e+r)*p;else for(e=Math.floor(e*p),a=Math.ceil(a*p),u=new Array(o=Math.ceil(e-a+1));++r<o;)u[r]=(e-r)/p;return i&&u.reverse(),u}function cg(e,a,t){var i=(a-e)/Math.max(0,t),r=Math.floor(Math.log(i)/Math.LN10),o=i/Math.pow(10,r);return r>=0?(o>=dy?10:o>=vy?5:o>=gy?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(o>=dy?10:o>=vy?5:o>=gy?2:1)}function yy(e,a,t){var i=Math.abs(a-e)/Math.max(0,t),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),o=i/r;return o>=dy?r*=10:o>=vy?r*=5:o>=gy&&(r*=2),a<e?-r:r}function jI(){var e=identity,a=extent,t=sturges;function i(r){var o,u=r.length,p,v=new Array(u);for(o=0;o<u;++o)v[o]=e(r[o],o,r);var g=a(v),E=g[0],T=g[1],O=t(v,E,T);Array.isArray(O)||(O=tickStep(E,T,O),O=range(Math.ceil(E/O)*O,T,O));for(var F=O.length;O[0]<=E;)O.shift(),--F;for(;O[F-1]>T;)O.pop(),--F;var U=new Array(F+1),j;for(o=0;o<=F;++o)j=U[o]=[],j.x0=o>0?O[o-1]:E,j.x1=o<F?O[o]:T;for(o=0;o<u;++o)p=v[o],E<=p&&p<=T&&U[bisect(O,p,0,F)].push(r[o]);return U}return i.value=function(r){return arguments.length?(e=typeof r=="function"?r:constant(r),i):e},i.domain=function(r){return arguments.length?(a=typeof r=="function"?r:constant([r[0],r[1]]),i):a},i.thresholds=function(r){return arguments.length?(t=typeof r=="function"?r:Array.isArray(r)?constant(slice.call(r)):constant(r),i):t},i}function GI(e,a,t){return e=map.call(e,number).sort(ascending),Math.ceil((t-a)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function Z5(e){return e===null?NaN:+e}function V5(e,a,t){if(t==null&&(t=Z5),!!(i=e.length)){if((a=+a)<=0||i<2)return+t(e[0],0,e);if(a>=1)return+t(e[i-1],i-1,e);var i,r=(i-1)*a,o=Math.floor(r),u=+t(e[o],o,e),p=+t(e[o+1],o+1,e);return u+(p-u)*(r-o)}}var j5=vt(87765),Cp="$";function fg(){}fg.prototype=Hx.prototype={constructor:fg,has:function(e){return Cp+e in this},get:function(e){return this[Cp+e]},set:function(e,a){return this[Cp+e]=a,this},remove:function(e){var a=Cp+e;return a in this&&delete this[a]},clear:function(){for(var e in this)e[0]===Cp&&delete this[e]},keys:function(){var e=[];for(var a in this)a[0]===Cp&&e.push(a.slice(1));return e},values:function(){var e=[];for(var a in this)a[0]===Cp&&e.push(this[a]);return e},entries:function(){var e=[];for(var a in this)a[0]===Cp&&e.push({key:a.slice(1),value:this[a]});return e},size:function(){var e=0;for(var a in this)a[0]===Cp&&++e;return e},empty:function(){for(var e in this)if(e[0]===Cp)return!1;return!0},each:function(e){for(var a in this)a[0]===Cp&&e(this[a],a.slice(1),this)}};function Hx(e,a){var t=new fg;if(e instanceof fg)e.each(function(p,v){t.set(v,p)});else if(Array.isArray(e)){var i=-1,r=e.length,o;if(a==null)for(;++i<r;)t.set(i,e[i]);else for(;++i<r;)t.set(a(o=e[i],i,e),o)}else if(e)for(var u in e)t.set(u,e[u]);return t}var _y=Hx;function HI(){var e=[],a=[],t,i,r;function o(p,v,g,E){if(v>=e.length)return t!=null&&p.sort(t),i!=null?i(p):p;for(var T=-1,O=p.length,F=e[v++],U,j,K=map(),ae,ve=g();++T<O;)(ae=K.get(U=F(j=p[T])+""))?ae.push(j):K.set(U,[j]);return K.each(function(ke,qe){E(ve,qe,o(ke,v,g,E))}),ve}function u(p,v){if(++v>e.length)return p;var g,E=a[v-1];return i!=null&&v>=e.length?g=p.entries():(g=[],p.each(function(T,O){g.push({key:O,values:u(T,v)})})),E!=null?g.sort(function(T,O){return E(T.key,O.key)}):g}return r={object:function(p){return o(p,0,G5,H5)},map:function(p){return o(p,0,Wx,Xx)},entries:function(p){return u(o(p,0,Wx,Xx),0)},key:function(p){return e.push(p),r},sortKeys:function(p){return a[e.length-1]=p,r},sortValues:function(p){return t=p,r},rollup:function(p){return i=p,r}}}function G5(){return{}}function H5(e,a,t){e[a]=t}function Wx(){return map()}function Xx(e,a,t){e.set(a,t)}function hg(){}var tv=_y.prototype;hg.prototype=W5.prototype={constructor:hg,has:tv.has,add:function(e){return e+="",this[Cp+e]=e,this},remove:tv.remove,clear:tv.clear,values:tv.keys,size:tv.size,empty:tv.empty,each:tv.each};function W5(e,a){var t=new hg;if(e instanceof hg)e.each(function(o){t.add(o)});else if(e){var i=-1,r=e.length;if(a==null)for(;++i<r;)t.add(e[i]);else for(;++i<r;)t.add(a(e[i],i,e))}return t}var WI=null,Yx=Array.prototype,pg=Yx.map,rv=Yx.slice;function I0(e,a){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(a).domain(e);break}return this}function qx(e,a){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(a).domain(e);break}return this}var $x={name:"implicit"};function dg(){var e=_y(),a=[],t=[],i=$x;function r(o){var u=o+"",p=e.get(u);if(!p){if(i!==$x)return i;e.set(u,p=a.push(o))}return t[(p-1)%t.length]}return r.domain=function(o){if(!arguments.length)return a.slice();a=[],e=_y();for(var u=-1,p=o.length,v,g;++u<p;)e.has(g=(v=o[u])+"")||e.set(g,a.push(v));return r},r.range=function(o){return arguments.length?(t=rv.call(o),r):t.slice()},r.unknown=function(o){return arguments.length?(i=o,r):i},r.copy=function(){return dg(a,t).unknown(i)},I0.apply(r,arguments),r}function Kx(){var e=ordinal().unknown(void 0),a=e.domain,t=e.range,i=[0,1],r,o,u=!1,p=0,v=0,g=.5;delete e.unknown;function E(){var T=a().length,O=i[1]<i[0],F=i[O-0],U=i[1-O];r=(U-F)/Math.max(1,T-p+v*2),u&&(r=Math.floor(r)),F+=(U-F-r*(T-p))*g,o=r*(1-p),u&&(F=Math.round(F),o=Math.round(o));var j=sequence(T).map(function(K){return F+r*K});return t(O?j.reverse():j)}return e.domain=function(T){return arguments.length?(a(T),E()):a()},e.range=function(T){return arguments.length?(i=[+T[0],+T[1]],E()):i.slice()},e.rangeRound=function(T){return i=[+T[0],+T[1]],u=!0,E()},e.bandwidth=function(){return o},e.step=function(){return r},e.round=function(T){return arguments.length?(u=!!T,E()):u},e.padding=function(T){return arguments.length?(p=Math.min(1,v=+T),E()):p},e.paddingInner=function(T){return arguments.length?(p=Math.min(1,T),E()):p},e.paddingOuter=function(T){return arguments.length?(v=+T,E()):v},e.align=function(T){return arguments.length?(g=Math.max(0,Math.min(1,T)),E()):g},e.copy=function(){return Kx(a(),i).round(u).paddingInner(p).paddingOuter(v).align(g)},initRange.apply(E(),arguments)}function Qx(e){var a=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Qx(a())},e}function XI(){return Qx(Kx.apply(null,arguments).paddingInner(1))}var X5=vt(21775),Y5=vt(73626);function q5(e,a){return e=+e,a=+a,function(t){return Math.round(e*(1-t)+a*t)}}function $5(e){return function(){return e}}function xy(e){return+e}var Jx=[0,1];function vf(e){return e}function by(e,a){return(a-=e=+e)?function(t){return(t-e)/a}:$5(isNaN(a)?NaN:.5)}function e1(e){var a=e[0],t=e[e.length-1],i;return a>t&&(i=a,a=t,t=i),function(r){return Math.max(a,Math.min(t,r))}}function K5(e,a,t){var i=e[0],r=e[1],o=a[0],u=a[1];return r<i?(i=by(r,i),o=t(u,o)):(i=by(i,r),o=t(o,u)),function(p){return o(i(p))}}function Q5(e,a,t){var i=Math.min(e.length,a.length)-1,r=new Array(i),o=new Array(i),u=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),a=a.slice().reverse());++u<i;)r[u]=by(e[u],e[u+1]),o[u]=t(a[u],a[u+1]);return function(p){var v=lg(e,p,1,i)-1;return o[v](r[v](p))}}function vg(e,a){return a.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Ey(){var e=Jx,a=Jx,t=X5.Z,i,r,o,u=vf,p,v,g;function E(){return p=Math.min(e.length,a.length)>2?Q5:K5,v=g=null,T}function T(O){return isNaN(O=+O)?o:(v||(v=p(e.map(i),a,t)))(i(u(O)))}return T.invert=function(O){return u(r((g||(g=p(a,e.map(i),Y5.Z)))(O)))},T.domain=function(O){return arguments.length?(e=pg.call(O,xy),u===vf||(u=e1(e)),E()):e.slice()},T.range=function(O){return arguments.length?(a=rv.call(O),E()):a.slice()},T.rangeRound=function(O){return a=rv.call(O),t=q5,E()},T.clamp=function(O){return arguments.length?(u=O?e1(e):vf,T):u!==vf},T.interpolate=function(O){return arguments.length?(t=O,E()):t},T.unknown=function(O){return arguments.length?(o=O,T):o},function(O,F){return i=O,r=F,E()}}function t1(e,a){return Ey()(e,a)}var J5=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function mg(e){if(!(a=J5.exec(e)))throw new Error("invalid format: "+e);var a;return new Cy({fill:a[1],align:a[2],sign:a[3],symbol:a[4],zero:a[5],width:a[6],comma:a[7],precision:a[8]&&a[8].slice(1),trim:a[9],type:a[10]})}mg.prototype=Cy.prototype;function Cy(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Cy.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function eM(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function gg(e,a){if((t=(e=a?e.toExponential(a-1):e.toExponential()).indexOf("e"))<0)return null;var t,i=e.slice(0,t);return[i.length>1?i[0]+i.slice(2):i,+e.slice(t+1)]}function Ov(e){return e=gg(Math.abs(e)),e?e[1]:NaN}function tM(e,a){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ov(a)/3)))*3-Ov(Math.abs(e)))}function rM(e,a){return function(t,i){for(var r=t.length,o=[],u=0,p=e[0],v=0;r>0&&p>0&&(v+p+1>i&&(p=Math.max(1,i-v)),o.push(t.substring(r-=p,r+p)),!((v+=p+1)>i));)p=e[u=(u+1)%e.length];return o.reverse().join(a)}}function nM(e){return function(a){return a.replace(/[0-9]/g,function(t){return e[+t]})}}function iM(e){e:for(var a=e.length,t=1,i=-1,r;t<a;++t)switch(e[t]){case".":i=r=t;break;case"0":i===0&&(i=t),r=t;break;default:if(!+e[t])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var r1;function aM(e,a){var t=gg(e,a);if(!t)return e+"";var i=t[0],r=t[1],o=r-(r1=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,u=i.length;return o===u?i:o>u?i+new Array(o-u+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+gg(e,Math.max(0,a+o-1))[0]}function n1(e,a){var t=gg(e,a);if(!t)return e+"";var i=t[0],r=t[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}var i1={"%":function(e,a){return(e*100).toFixed(a)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:eM,e:function(e,a){return e.toExponential(a)},f:function(e,a){return e.toFixed(a)},g:function(e,a){return e.toPrecision(a)},o:function(e){return Math.round(e).toString(8)},p:function(e,a){return n1(e*100,a)},r:n1,s:aM,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function a1(e){return e}var o1=Array.prototype.map,s1=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function oM(e){var a=e.grouping===void 0||e.thousands===void 0?a1:rM(o1.call(e.grouping,Number),e.thousands+""),t=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?a1:nM(o1.call(e.numerals,String)),u=e.percent===void 0?"%":e.percent+"",p=e.minus===void 0?"-":e.minus+"",v=e.nan===void 0?"NaN":e.nan+"";function g(T){T=mg(T);var O=T.fill,F=T.align,U=T.sign,j=T.symbol,K=T.zero,ae=T.width,ve=T.comma,ke=T.precision,qe=T.trim,ct=T.type;ct==="n"?(ve=!0,ct="g"):i1[ct]||(ke===void 0&&(ke=12),qe=!0,ct="g"),(K||O==="0"&&F==="=")&&(K=!0,O="0",F="=");var _t=j==="$"?t:j==="#"&&/[boxX]/.test(ct)?"0"+ct.toLowerCase():"",Ot=j==="$"?i:/[%p]/.test(ct)?u:"",Xt=i1[ct],yr=/[defgprs%]/.test(ct);ke=ke===void 0?6:/[gprs]/.test(ct)?Math.max(1,Math.min(21,ke)):Math.max(0,Math.min(20,ke));function Pr(xr){var An=_t,ii=Ot,sa,Io,_o;if(ct==="c")ii=Xt(xr)+ii,xr="";else{xr=+xr;var Gu=xr<0||1/xr<0;if(xr=isNaN(xr)?v:Xt(Math.abs(xr),ke),qe&&(xr=iM(xr)),Gu&&+xr==0&&U!=="+"&&(Gu=!1),An=(Gu?U==="("?U:p:U==="-"||U==="("?"":U)+An,ii=(ct==="s"?s1[8+r1/3]:"")+ii+(Gu&&U==="("?")":""),yr){for(sa=-1,Io=xr.length;++sa<Io;)if(_o=xr.charCodeAt(sa),48>_o||_o>57){ii=(_o===46?r+xr.slice(sa+1):xr.slice(sa))+ii,xr=xr.slice(0,sa);break}}}ve&&!K&&(xr=a(xr,1/0));var ml=An.length+xr.length+ii.length,Ju=ml<ae?new Array(ae-ml+1).join(O):"";switch(ve&&K&&(xr=a(Ju+xr,Ju.length?ae-ii.length:1/0),Ju=""),F){case"<":xr=An+xr+ii+Ju;break;case"=":xr=An+Ju+xr+ii;break;case"^":xr=Ju.slice(0,ml=Ju.length>>1)+An+xr+ii+Ju.slice(ml);break;default:xr=Ju+An+xr+ii;break}return o(xr)}return Pr.toString=function(){return T+""},Pr}function E(T,O){var F=g((T=mg(T),T.type="f",T)),U=Math.max(-8,Math.min(8,Math.floor(Ov(O)/3)))*3,j=Math.pow(10,-U),K=s1[8+U/3];return function(ae){return F(j*ae)+K}}return{format:g,formatPrefix:E}}var yg,Sy,u1;sM({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function sM(e){return yg=oM(e),Sy=yg.format,u1=yg.formatPrefix,yg}function uM(e,a){return e=Math.abs(e),a=Math.abs(a)-e,Math.max(0,Ov(a)-Ov(e))+1}function lM(e){return Math.max(0,-Ov(Math.abs(e)))}function cM(e,a,t,i){var r=yy(e,a,t),o;switch(i=mg(i??",f"),i.type){case"s":{var u=Math.max(Math.abs(e),Math.abs(a));return i.precision==null&&!isNaN(o=tM(r,u))&&(i.precision=o),u1(i,u)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(o=uM(r,Math.max(Math.abs(e),Math.abs(a))))&&(i.precision=o-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(o=lM(r))&&(i.precision=o-(i.type==="%")*2);break}}return Sy(i)}function Fv(e){var a=e.domain;return e.ticks=function(t){var i=a();return Gx(i[0],i[i.length-1],t??10)},e.tickFormat=function(t,i){var r=a();return cM(r[0],r[r.length-1],t??10,i)},e.nice=function(t){t==null&&(t=10);var i=a(),r=0,o=i.length-1,u=i[r],p=i[o],v;return p<u&&(v=u,u=p,p=v,v=r,r=o,o=v),v=cg(u,p,t),v>0?(u=Math.floor(u/v)*v,p=Math.ceil(p/v)*v,v=cg(u,p,t)):v<0&&(u=Math.ceil(u*v)/v,p=Math.floor(p*v)/v,v=cg(u,p,t)),v>0?(i[r]=Math.floor(u/v)*v,i[o]=Math.ceil(p/v)*v,a(i)):v<0&&(i[r]=Math.ceil(u*v)/v,i[o]=Math.floor(p*v)/v,a(i)),e},e}function l1(){var e=t1(vf,vf);return e.copy=function(){return vg(e,l1())},I0.apply(e,arguments),Fv(e)}function c1(e){var a;function t(i){return isNaN(i=+i)?a:i}return t.invert=t,t.domain=t.range=function(i){return arguments.length?(e=pg.call(i,xy),t):e.slice()},t.unknown=function(i){return arguments.length?(a=i,t):a},t.copy=function(){return c1(e).unknown(a)},e=arguments.length?pg.call(e,xy):[0,1],Fv(t)}function f1(e,a){e=e.slice();var t=0,i=e.length-1,r=e[t],o=e[i],u;return o<r&&(u=t,t=i,i=u,u=r,r=o,o=u),e[t]=a.floor(r),e[i]=a.ceil(o),e}function h1(e){return Math.log(e)}function p1(e){return Math.exp(e)}function fM(e){return-Math.log(-e)}function hM(e){return-Math.exp(-e)}function pM(e){return isFinite(e)?+("1e"+e):e<0?0:e}function dM(e){return e===10?pM:e===Math.E?Math.exp:function(a){return Math.pow(e,a)}}function vM(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(a){return Math.log(a)/e})}function d1(e){return function(a){return-e(-a)}}function mM(e){var a=e(h1,p1),t=a.domain,i=10,r,o;function u(){return r=vM(i),o=dM(i),t()[0]<0?(r=d1(r),o=d1(o),e(fM,hM)):e(h1,p1),a}return a.base=function(p){return arguments.length?(i=+p,u()):i},a.domain=function(p){return arguments.length?(t(p),u()):t()},a.ticks=function(p){var v=t(),g=v[0],E=v[v.length-1],T;(T=E<g)&&(O=g,g=E,E=O);var O=r(g),F=r(E),U,j,K,ae=p==null?10:+p,ve=[];if(!(i%1)&&F-O<ae){if(O=Math.round(O)-1,F=Math.round(F)+1,g>0){for(;O<F;++O)for(j=1,U=o(O);j<i;++j)if(K=U*j,!(K<g)){if(K>E)break;ve.push(K)}}else for(;O<F;++O)for(j=i-1,U=o(O);j>=1;--j)if(K=U*j,!(K<g)){if(K>E)break;ve.push(K)}}else ve=Gx(O,F,Math.min(F-O,ae)).map(o);return T?ve.reverse():ve},a.tickFormat=function(p,v){if(v==null&&(v=i===10?".0e":","),typeof v!="function"&&(v=Sy(v)),p===1/0)return v;p==null&&(p=10);var g=Math.max(1,i*p/a.ticks().length);return function(E){var T=E/o(Math.round(r(E)));return T*i<i-.5&&(T*=i),T<=g?v(E):""}},a.nice=function(){return t(f1(t(),{floor:function(p){return o(Math.floor(r(p)))},ceil:function(p){return o(Math.ceil(r(p)))}}))},a}function v1(){var e=mM(Ey()).domain([1,10]);return e.copy=function(){return vg(e,v1()).base(e.base())},I0.apply(e,arguments),e}function m1(e){return function(a){return Math.sign(a)*Math.log1p(Math.abs(a/e))}}function g1(e){return function(a){return Math.sign(a)*Math.expm1(Math.abs(a))*e}}function gM(e){var a=1,t=e(m1(a),g1(a));return t.constant=function(i){return arguments.length?e(m1(a=+i),g1(a)):a},linearish(t)}function yM(){var e=gM(transformer());return e.copy=function(){return copy(e,yM()).constant(e.constant())},initRange.apply(e,arguments)}function y1(e){return function(a){return a<0?-Math.pow(-a,e):Math.pow(a,e)}}function _M(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function xM(e){return e<0?-e*e:e*e}function bM(e){var a=e(vf,vf),t=1;function i(){return t===1?e(vf,vf):t===.5?e(_M,xM):e(y1(t),y1(1/t))}return a.exponent=function(r){return arguments.length?(t=+r,i()):t},Fv(a)}function wy(){var e=bM(Ey());return e.copy=function(){return vg(e,wy()).exponent(e.exponent())},I0.apply(e,arguments),e}function YI(){return wy.apply(null,arguments).exponent(.5)}function _1(){var e=[],a=[],t=[],i;function r(){var u=0,p=Math.max(1,a.length);for(t=new Array(p-1);++u<p;)t[u-1]=V5(e,u/p);return o}function o(u){return isNaN(u=+u)?i:a[lg(t,u)]}return o.invertExtent=function(u){var p=a.indexOf(u);return p<0?[NaN,NaN]:[p>0?t[p-1]:e[0],p<t.length?t[p]:e[e.length-1]]},o.domain=function(u){if(!arguments.length)return e.slice();e=[];for(var p=0,v=u.length,g;p<v;++p)g=u[p],g!=null&&!isNaN(g=+g)&&e.push(g);return e.sort(py),r()},o.range=function(u){return arguments.length?(a=rv.call(u),r()):a.slice()},o.unknown=function(u){return arguments.length?(i=u,o):i},o.quantiles=function(){return t.slice()},o.copy=function(){return _1().domain(e).range(a).unknown(i)},I0.apply(o,arguments)}function x1(){var e=0,a=1,t=1,i=[.5],r=[0,1],o;function u(v){return v<=v?r[lg(i,v,0,t)]:o}function p(){var v=-1;for(i=new Array(t);++v<t;)i[v]=((v+1)*a-(v-t)*e)/(t+1);return u}return u.domain=function(v){return arguments.length?(e=+v[0],a=+v[1],p()):[e,a]},u.range=function(v){return arguments.length?(t=(r=rv.call(v)).length-1,p()):r.slice()},u.invertExtent=function(v){var g=r.indexOf(v);return g<0?[NaN,NaN]:g<1?[e,i[0]]:g>=t?[i[t-1],a]:[i[g-1],i[g]]},u.unknown=function(v){return arguments.length&&(o=v),u},u.thresholds=function(){return i.slice()},u.copy=function(){return x1().domain([e,a]).range(r).unknown(o)},I0.apply(Fv(u),arguments)}function b1(){var e=[.5],a=[0,1],t,i=1;function r(o){return o<=o?a[lg(e,o,0,i)]:t}return r.domain=function(o){return arguments.length?(e=rv.call(o),i=Math.min(e.length,a.length-1),r):e.slice()},r.range=function(o){return arguments.length?(a=rv.call(o),i=Math.min(e.length,a.length-1),r):a.slice()},r.invertExtent=function(o){var u=a.indexOf(o);return[e[u-1],e[u]]},r.unknown=function(o){return arguments.length?(t=o,r):t},r.copy=function(){return b1().domain(e).range(a).unknown(t)},I0.apply(r,arguments)}var Ay=new Date,Ty=new Date;function Wf(e,a,t,i){function r(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return r.floor=function(o){return e(o=new Date(+o)),o},r.ceil=function(o){return e(o=new Date(o-1)),a(o,1),e(o),o},r.round=function(o){var u=r(o),p=r.ceil(o);return o-u<p-o?u:p},r.offset=function(o,u){return a(o=new Date(+o),u==null?1:Math.floor(u)),o},r.range=function(o,u,p){var v=[],g;if(o=r.ceil(o),p=p==null?1:Math.floor(p),!(o<u)||!(p>0))return v;do v.push(g=new Date(+o)),a(o,p),e(o);while(g<o&&o<u);return v},r.filter=function(o){return Wf(function(u){if(u>=u)for(;e(u),!o(u);)u.setTime(u-1)},function(u,p){if(u>=u)if(p<0)for(;++p<=0;)for(;a(u,-1),!o(u););else for(;--p>=0;)for(;a(u,1),!o(u););})},t&&(r.count=function(o,u){return Ay.setTime(+o),Ty.setTime(+u),e(Ay),e(Ty),Math.floor(t(Ay,Ty))},r.every=function(o){return o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?r.filter(i?function(u){return i(u)%o===0}:function(u){return r.count(0,u)%o===0}):r}),r}var My=Wf(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,a){e.setFullYear(e.getFullYear()+a)},function(e,a){return a.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});My.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Wf(function(a){a.setFullYear(Math.floor(a.getFullYear()/e)*e),a.setMonth(0,1),a.setHours(0,0,0,0)},function(a,t){a.setFullYear(a.getFullYear()+t*e)})};var Dv=My,qI=My.range,E1=Wf(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,a){e.setMonth(e.getMonth()+a)},function(e,a){return a.getMonth()-e.getMonth()+(a.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),EM=E1,$I=E1.range,_g=1e3,_m=6e4,C1=36e5,S1=864e5,w1=6048e5;function nv(e){return Wf(function(a){a.setDate(a.getDate()-(a.getDay()+7-e)%7),a.setHours(0,0,0,0)},function(a,t){a.setDate(a.getDate()+t*7)},function(a,t){return(t-a-(t.getTimezoneOffset()-a.getTimezoneOffset())*_m)/w1})}var ky=nv(0),xg=nv(1),CM=nv(2),SM=nv(3),Bv=nv(4),wM=nv(5),AM=nv(6),KI=ky.range,QI=xg.range,JI=CM.range,eP=SM.range,tP=Bv.range,rP=wM.range,nP=AM.range,A1=Wf(function(e){e.setHours(0,0,0,0)},function(e,a){e.setDate(e.getDate()+a)},function(e,a){return(a-e-(a.getTimezoneOffset()-e.getTimezoneOffset())*_m)/S1},function(e){return e.getDate()-1}),Iy=A1,iP=A1.range,T1=Wf(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*_g-e.getMinutes()*_m)},function(e,a){e.setTime(+e+a*C1)},function(e,a){return(a-e)/C1},function(e){return e.getHours()}),TM=T1,aP=T1.range,M1=Wf(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*_g)},function(e,a){e.setTime(+e+a*_m)},function(e,a){return(a-e)/_m},function(e){return e.getMinutes()}),MM=M1,oP=M1.range,k1=Wf(function(e){e.setTime(e-e.getMilliseconds())},function(e,a){e.setTime(+e+a*_g)},function(e,a){return(a-e)/_g},function(e){return e.getUTCSeconds()}),kM=k1,sP=k1.range,bg=Wf(function(){},function(e,a){e.setTime(+e+a)},function(e,a){return a-e});bg.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Wf(function(a){a.setTime(Math.floor(a/e)*e)},function(a,t){a.setTime(+a+t*e)},function(a,t){return(t-a)/e}):bg};var IM=bg,uP=bg.range;function iv(e){return Wf(function(a){a.setUTCDate(a.getUTCDate()-(a.getUTCDay()+7-e)%7),a.setUTCHours(0,0,0,0)},function(a,t){a.setUTCDate(a.getUTCDate()+t*7)},function(a,t){return(t-a)/w1})}var I1=iv(0),Eg=iv(1),PM=iv(2),LM=iv(3),Nv=iv(4),RM=iv(5),OM=iv(6),lP=I1.range,cP=Eg.range,fP=PM.range,hP=LM.range,pP=Nv.range,dP=RM.range,vP=OM.range,P1=Wf(function(e){e.setUTCHours(0,0,0,0)},function(e,a){e.setUTCDate(e.getUTCDate()+a)},function(e,a){return(a-e)/S1},function(e){return e.getUTCDate()-1}),L1=P1,mP=P1.range,Py=Wf(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,a){e.setUTCFullYear(e.getUTCFullYear()+a)},function(e,a){return a.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Py.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Wf(function(a){a.setUTCFullYear(Math.floor(a.getUTCFullYear()/e)*e),a.setUTCMonth(0,1),a.setUTCHours(0,0,0,0)},function(a,t){a.setUTCFullYear(a.getUTCFullYear()+t*e)})};var xm=Py,gP=Py.range;function Ly(e){if(0<=e.y&&e.y<100){var a=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return a.setFullYear(e.y),a}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Ry(e){if(0<=e.y&&e.y<100){var a=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return a.setUTCFullYear(e.y),a}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function bm(e,a,t){return{y:e,m:a,d:t,H:0,M:0,S:0,L:0}}function FM(e){var a=e.dateTime,t=e.date,i=e.time,r=e.periods,o=e.days,u=e.shortDays,p=e.months,v=e.shortMonths,g=Em(r),E=Cm(r),T=Em(o),O=Cm(o),F=Em(u),U=Cm(u),j=Em(p),K=Cm(p),ae=Em(v),ve=Cm(v),ke={a:Gu,A:ml,b:Ju,B:mf,c:null,d:N1,e:N1,f:i4,g:d4,G:m4,H:t4,I:r4,j:n4,L:z1,m:a4,M:o4,p:L0,q:R0,Q:H1,s:W1,S:s4,u:u4,U:l4,V:c4,w:f4,W:h4,x:null,X:null,y:p4,Y:v4,Z:g4,"%":G1},qe={a:sv,A:jv,b:O0,B:Gv,c:null,d:Z1,e:Z1,f:b4,g:P4,G:R4,H:y4,I:_4,j:x4,L:V1,m:E4,M:C4,p:Gy,q:Hy,Q:H1,s:W1,S:S4,u:w4,U:A4,V:T4,w:M4,W:k4,x:null,X:null,y:I4,Y:L4,Z:O4,"%":G1},ct={a:Pr,A:xr,b:An,B:ii,c:sa,d:D1,e:D1,f:KM,g:F1,G:O1,H:B1,I:B1,j:XM,L:$M,m:WM,M:YM,p:yr,q:HM,Q:JM,s:e4,S:qM,u:UM,U:ZM,V:VM,w:zM,W:jM,x:Io,X:_o,y:F1,Y:O1,Z:GM,"%":QM};ke.x=_t(t,ke),ke.X=_t(i,ke),ke.c=_t(a,ke),qe.x=_t(t,qe),qe.X=_t(i,qe),qe.c=_t(a,qe);function _t(Vi,Bo){return function(os){var ei=[],ch=-1,uu=0,zh=Vi.length,Uh,uv,F2;for(os instanceof Date||(os=new Date(+os));++ch<zh;)Vi.charCodeAt(ch)===37&&(ei.push(Vi.slice(uu,ch)),(uv=R1[Uh=Vi.charAt(++ch)])!=null?Uh=Vi.charAt(++ch):uv=Uh==="e"?" ":"0",(F2=Bo[Uh])&&(Uh=F2(os,uv)),ei.push(Uh),uu=ch+1);return ei.push(Vi.slice(uu,ch)),ei.join("")}}function Ot(Vi,Bo){return function(os){var ei=bm(1900,void 0,1),ch=Xt(ei,Vi,os+="",0),uu,zh;if(ch!=os.length)return null;if("Q"in ei)return new Date(ei.Q);if("s"in ei)return new Date(ei.s*1e3+("L"in ei?ei.L:0));if(Bo&&!("Z"in ei)&&(ei.Z=0),"p"in ei&&(ei.H=ei.H%12+ei.p*12),ei.m===void 0&&(ei.m="q"in ei?ei.q:0),"V"in ei){if(ei.V<1||ei.V>53)return null;"w"in ei||(ei.w=1),"Z"in ei?(uu=Ry(bm(ei.y,0,1)),zh=uu.getUTCDay(),uu=zh>4||zh===0?Eg.ceil(uu):Eg(uu),uu=L1.offset(uu,(ei.V-1)*7),ei.y=uu.getUTCFullYear(),ei.m=uu.getUTCMonth(),ei.d=uu.getUTCDate()+(ei.w+6)%7):(uu=Ly(bm(ei.y,0,1)),zh=uu.getDay(),uu=zh>4||zh===0?xg.ceil(uu):xg(uu),uu=Iy.offset(uu,(ei.V-1)*7),ei.y=uu.getFullYear(),ei.m=uu.getMonth(),ei.d=uu.getDate()+(ei.w+6)%7)}else("W"in ei||"U"in ei)&&("w"in ei||(ei.w="u"in ei?ei.u%7:"W"in ei?1:0),zh="Z"in ei?Ry(bm(ei.y,0,1)).getUTCDay():Ly(bm(ei.y,0,1)).getDay(),ei.m=0,ei.d="W"in ei?(ei.w+6)%7+ei.W*7-(zh+5)%7:ei.w+ei.U*7-(zh+6)%7);return"Z"in ei?(ei.H+=ei.Z/100|0,ei.M+=ei.Z%100,Ry(ei)):Ly(ei)}}function Xt(Vi,Bo,os,ei){for(var ch=0,uu=Bo.length,zh=os.length,Uh,uv;ch<uu;){if(ei>=zh)return-1;if(Uh=Bo.charCodeAt(ch++),Uh===37){if(Uh=Bo.charAt(ch++),uv=ct[Uh in R1?Bo.charAt(ch++):Uh],!uv||(ei=uv(Vi,os,ei))<0)return-1}else if(Uh!=os.charCodeAt(ei++))return-1}return ei}function yr(Vi,Bo,os){var ei=g.exec(Bo.slice(os));return ei?(Vi.p=E[ei[0].toLowerCase()],os+ei[0].length):-1}function Pr(Vi,Bo,os){var ei=F.exec(Bo.slice(os));return ei?(Vi.w=U[ei[0].toLowerCase()],os+ei[0].length):-1}function xr(Vi,Bo,os){var ei=T.exec(Bo.slice(os));return ei?(Vi.w=O[ei[0].toLowerCase()],os+ei[0].length):-1}function An(Vi,Bo,os){var ei=ae.exec(Bo.slice(os));return ei?(Vi.m=ve[ei[0].toLowerCase()],os+ei[0].length):-1}function ii(Vi,Bo,os){var ei=j.exec(Bo.slice(os));return ei?(Vi.m=K[ei[0].toLowerCase()],os+ei[0].length):-1}function sa(Vi,Bo,os){return Xt(Vi,a,Bo,os)}function Io(Vi,Bo,os){return Xt(Vi,t,Bo,os)}function _o(Vi,Bo,os){return Xt(Vi,i,Bo,os)}function Gu(Vi){return u[Vi.getDay()]}function ml(Vi){return o[Vi.getDay()]}function Ju(Vi){return v[Vi.getMonth()]}function mf(Vi){return p[Vi.getMonth()]}function L0(Vi){return r[+(Vi.getHours()>=12)]}function R0(Vi){return 1+~~(Vi.getMonth()/3)}function sv(Vi){return u[Vi.getUTCDay()]}function jv(Vi){return o[Vi.getUTCDay()]}function O0(Vi){return v[Vi.getUTCMonth()]}function Gv(Vi){return p[Vi.getUTCMonth()]}function Gy(Vi){return r[+(Vi.getUTCHours()>=12)]}function Hy(Vi){return 1+~~(Vi.getUTCMonth()/3)}return{format:function(Vi){var Bo=_t(Vi+="",ke);return Bo.toString=function(){return Vi},Bo},parse:function(Vi){var Bo=Ot(Vi+="",!1);return Bo.toString=function(){return Vi},Bo},utcFormat:function(Vi){var Bo=_t(Vi+="",qe);return Bo.toString=function(){return Vi},Bo},utcParse:function(Vi){var Bo=Ot(Vi+="",!0);return Bo.toString=function(){return Vi},Bo}}}var R1={"-":"",_:" ",0:"0"},Ec=/^\s*\d+/,DM=/^%/,BM=/[\\^$*+?|[\]().{}]/g;function as(e,a,t){var i=e<0?"-":"",r=(i?-e:e)+"",o=r.length;return i+(o<t?new Array(t-o+1).join(a)+r:r)}function NM(e){return e.replace(BM,"\\$&")}function Em(e){return new RegExp("^(?:"+e.map(NM).join("|")+")","i")}function Cm(e){for(var a={},t=-1,i=e.length;++t<i;)a[e[t].toLowerCase()]=t;return a}function zM(e,a,t){var i=Ec.exec(a.slice(t,t+1));return i?(e.w=+i[0],t+i[0].length):-1}function UM(e,a,t){var i=Ec.exec(a.slice(t,t+1));return i?(e.u=+i[0],t+i[0].length):-1}function ZM(e,a,t){var i=Ec.exec(a.slice(t,t+2));return i?(e.U=+i[0],t+i[0].length):-1}function VM(e,a,t){var i=Ec.exec(a.slice(t,t+2));return i?(e.V=+i[0],t+i[0].length):-1}function jM(e,a,t){var i=Ec.exec(a.slice(t,t+2));return i?(e.W=+i[0],t+i[0].length):-1}function O1(e,a,t){var i=Ec.exec(a.slice(t,t+4));return i?(e.y=+i[0],t+i[0].length):-1}function F1(e,a,t){var i=Ec.exec(a.slice(t,t+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),t+i[0].length):-1}function GM(e,a,t){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(a.slice(t,t+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),t+i[0].length):-1}function HM(e,a,t){var i=Ec.exec(a.slice(t,t+1));return i?(e.q=i[0]*3-3,t+i[0].length):-1}function WM(e,a,t){var i=Ec.exec(a.slice(t,t+2));return i?(e.m=i[0]-1,t+i[0].length):-1}function D1(e,a,t){var i=Ec.exec(a.slice(t,t+2));return i?(e.d=+i[0],t+i[0].length):-1}function XM(e,a,t){var i=Ec.exec(a.slice(t,t+3));return i?(e.m=0,e.d=+i[0],t+i[0].length):-1}function B1(e,a,t){var i=Ec.exec(a.slice(t,t+2));return i?(e.H=+i[0],t+i[0].length):-1}function YM(e,a,t){var i=Ec.exec(a.slice(t,t+2));return i?(e.M=+i[0],t+i[0].length):-1}function qM(e,a,t){var i=Ec.exec(a.slice(t,t+2));return i?(e.S=+i[0],t+i[0].length):-1}function $M(e,a,t){var i=Ec.exec(a.slice(t,t+3));return i?(e.L=+i[0],t+i[0].length):-1}function KM(e,a,t){var i=Ec.exec(a.slice(t,t+6));return i?(e.L=Math.floor(i[0]/1e3),t+i[0].length):-1}function QM(e,a,t){var i=DM.exec(a.slice(t,t+1));return i?t+i[0].length:-1}function JM(e,a,t){var i=Ec.exec(a.slice(t));return i?(e.Q=+i[0],t+i[0].length):-1}function e4(e,a,t){var i=Ec.exec(a.slice(t));return i?(e.s=+i[0],t+i[0].length):-1}function N1(e,a){return as(e.getDate(),a,2)}function t4(e,a){return as(e.getHours(),a,2)}function r4(e,a){return as(e.getHours()%12||12,a,2)}function n4(e,a){return as(1+Iy.count(Dv(e),e),a,3)}function z1(e,a){return as(e.getMilliseconds(),a,3)}function i4(e,a){return z1(e,a)+"000"}function a4(e,a){return as(e.getMonth()+1,a,2)}function o4(e,a){return as(e.getMinutes(),a,2)}function s4(e,a){return as(e.getSeconds(),a,2)}function u4(e){var a=e.getDay();return a===0?7:a}function l4(e,a){return as(ky.count(Dv(e)-1,e),a,2)}function U1(e){var a=e.getDay();return a>=4||a===0?Bv(e):Bv.ceil(e)}function c4(e,a){return e=U1(e),as(Bv.count(Dv(e),e)+(Dv(e).getDay()===4),a,2)}function f4(e){return e.getDay()}function h4(e,a){return as(xg.count(Dv(e)-1,e),a,2)}function p4(e,a){return as(e.getFullYear()%100,a,2)}function d4(e,a){return e=U1(e),as(e.getFullYear()%100,a,2)}function v4(e,a){return as(e.getFullYear()%1e4,a,4)}function m4(e,a){var t=e.getDay();return e=t>=4||t===0?Bv(e):Bv.ceil(e),as(e.getFullYear()%1e4,a,4)}function g4(e){var a=e.getTimezoneOffset();return(a>0?"-":(a*=-1,"+"))+as(a/60|0,"0",2)+as(a%60,"0",2)}function Z1(e,a){return as(e.getUTCDate(),a,2)}function y4(e,a){return as(e.getUTCHours(),a,2)}function _4(e,a){return as(e.getUTCHours()%12||12,a,2)}function x4(e,a){return as(1+L1.count(xm(e),e),a,3)}function V1(e,a){return as(e.getUTCMilliseconds(),a,3)}function b4(e,a){return V1(e,a)+"000"}function E4(e,a){return as(e.getUTCMonth()+1,a,2)}function C4(e,a){return as(e.getUTCMinutes(),a,2)}function S4(e,a){return as(e.getUTCSeconds(),a,2)}function w4(e){var a=e.getUTCDay();return a===0?7:a}function A4(e,a){return as(I1.count(xm(e)-1,e),a,2)}function j1(e){var a=e.getUTCDay();return a>=4||a===0?Nv(e):Nv.ceil(e)}function T4(e,a){return e=j1(e),as(Nv.count(xm(e),e)+(xm(e).getUTCDay()===4),a,2)}function M4(e){return e.getUTCDay()}function k4(e,a){return as(Eg.count(xm(e)-1,e),a,2)}function I4(e,a){return as(e.getUTCFullYear()%100,a,2)}function P4(e,a){return e=j1(e),as(e.getUTCFullYear()%100,a,2)}function L4(e,a){return as(e.getUTCFullYear()%1e4,a,4)}function R4(e,a){var t=e.getUTCDay();return e=t>=4||t===0?Nv(e):Nv.ceil(e),as(e.getUTCFullYear()%1e4,a,4)}function O4(){return"+0000"}function G1(){return"%"}function H1(e){return+e}function W1(e){return Math.floor(+e/1e3)}var zv,X1,F4,D4,B4;N4({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function N4(e){return zv=FM(e),X1=zv.format,F4=zv.parse,D4=zv.utcFormat,B4=zv.utcParse,zv}var Sm=1e3,wm=Sm*60,Am=wm*60,Tm=Am*24,z4=Tm*7,Y1=Tm*30,Oy=Tm*365;function U4(e){return new Date(e)}function Z4(e){return e instanceof Date?+e:+new Date(+e)}function q1(e,a,t,i,r,o,u,p,v){var g=t1(vf,vf),E=g.invert,T=g.domain,O=v(".%L"),F=v(":%S"),U=v("%I:%M"),j=v("%I %p"),K=v("%a %d"),ae=v("%b %d"),ve=v("%B"),ke=v("%Y"),qe=[[u,1,Sm],[u,5,5*Sm],[u,15,15*Sm],[u,30,30*Sm],[o,1,wm],[o,5,5*wm],[o,15,15*wm],[o,30,30*wm],[r,1,Am],[r,3,3*Am],[r,6,6*Am],[r,12,12*Am],[i,1,Tm],[i,2,2*Tm],[t,1,z4],[a,1,Y1],[a,3,3*Y1],[e,1,Oy]];function ct(Ot){return(u(Ot)<Ot?O:o(Ot)<Ot?F:r(Ot)<Ot?U:i(Ot)<Ot?j:a(Ot)<Ot?t(Ot)<Ot?K:ae:e(Ot)<Ot?ve:ke)(Ot)}function _t(Ot,Xt,yr,Pr){if(Ot==null&&(Ot=10),typeof Ot=="number"){var xr=Math.abs(yr-Xt)/Ot,An=Ux(function(ii){return ii[2]}).right(qe,xr);An===qe.length?(Pr=yy(Xt/Oy,yr/Oy,Ot),Ot=e):An?(An=qe[xr/qe[An-1][2]<qe[An][2]/xr?An-1:An],Pr=An[1],Ot=An[0]):(Pr=Math.max(yy(Xt,yr,Ot),1),Ot=p)}return Pr==null?Ot:Ot.every(Pr)}return g.invert=function(Ot){return new Date(E(Ot))},g.domain=function(Ot){return arguments.length?T(pg.call(Ot,Z4)):T().map(U4)},g.ticks=function(Ot,Xt){var yr=T(),Pr=yr[0],xr=yr[yr.length-1],An=xr<Pr,ii;return An&&(ii=Pr,Pr=xr,xr=ii),ii=_t(Ot,Pr,xr,Xt),ii=ii?ii.range(Pr,xr+1):[],An?ii.reverse():ii},g.tickFormat=function(Ot,Xt){return Xt==null?ct:v(Xt)},g.nice=function(Ot,Xt){var yr=T();return(Ot=_t(Ot,yr[0],yr[yr.length-1],Xt))?T(f1(yr,Ot)):g},g.copy=function(){return vg(g,q1(e,a,t,i,r,o,u,p,v))},g}function V4(){return I0.apply(q1(Dv,EM,ky,Iy,TM,MM,kM,IM,X1).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function yP(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Cg(){var e=0,a=1,t,i,r,o,u=vf,p=!1,v;function g(E){return isNaN(E=+E)?v:u(r===0?.5:(E=(o(E)-t)*r,p?Math.max(0,Math.min(1,E)):E))}return g.domain=function(E){return arguments.length?(t=o(e=+E[0]),i=o(a=+E[1]),r=t===i?0:1/(i-t),g):[e,a]},g.clamp=function(E){return arguments.length?(p=!!E,g):p},g.interpolator=function(E){return arguments.length?(u=E,g):u},g.unknown=function(E){return arguments.length?(v=E,g):v},function(E){return o=E,t=E(e),i=E(a),r=t===i?0:1/(i-t),g}}function Mm(e,a){return a.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function $1(){var e=Fv(Cg()(vf));return e.copy=function(){return Mm(e,$1())},qx.apply(e,arguments)}function j4(){var e=loggish(Cg()).domain([1,10]);return e.copy=function(){return Mm(e,j4()).base(e.base())},initInterpolator.apply(e,arguments)}function G4(){var e=symlogish(Cg());return e.copy=function(){return Mm(e,G4()).constant(e.constant())},initInterpolator.apply(e,arguments)}function K1(){var e=powish(Cg());return e.copy=function(){return Mm(e,K1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function _P(){return K1.apply(null,arguments).exponent(.5)}function H4(){var e=[],a=identity;function t(i){if(!isNaN(i=+i))return a((bisect(e,i)-1)/(e.length-1))}return t.domain=function(i){if(!arguments.length)return e.slice();e=[];for(var r=0,o=i.length,u;r<o;++r)u=i[r],u!=null&&!isNaN(u=+u)&&e.push(u);return e.sort(ascending),t},t.interpolator=function(i){return arguments.length?(a=i,t):a},t.copy=function(){return H4(a).domain(e)},initInterpolator.apply(t,arguments)}function Sg(){var e=0,a=.5,t=1,i,r,o,u,p,v=vf,g,E=!1,T;function O(F){return isNaN(F=+F)?T:(F=.5+((F=+g(F))-r)*(F<r?u:p),v(E?Math.max(0,Math.min(1,F)):F))}return O.domain=function(F){return arguments.length?(i=g(e=+F[0]),r=g(a=+F[1]),o=g(t=+F[2]),u=i===r?0:.5/(r-i),p=r===o?0:.5/(o-r),O):[e,a,t]},O.clamp=function(F){return arguments.length?(E=!!F,O):E},O.interpolator=function(F){return arguments.length?(v=F,O):v},O.unknown=function(F){return arguments.length?(T=F,O):T},function(F){return g=F,i=F(e),r=F(a),o=F(t),u=i===r?0:.5/(r-i),p=r===o?0:.5/(o-r),O}}function Q1(){var e=Fv(Sg()(vf));return e.copy=function(){return Mm(e,Q1())},qx.apply(e,arguments)}function W4(){var e=loggish(Sg()).domain([.1,1,10]);return e.copy=function(){return copy(e,W4()).base(e.base())},initInterpolator.apply(e,arguments)}function X4(){var e=symlogish(Sg());return e.copy=function(){return copy(e,X4()).constant(e.constant())},initInterpolator.apply(e,arguments)}function J1(){var e=powish(Sg());return e.copy=function(){return copy(e,J1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function xP(){return J1.apply(null,arguments).exponent(.5)}var Nh,eb,tb,rb,Fy,nb,Y4=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,q4=(Nh={},(0,ee.Z)(Nh,is.LINEAR,l1),(0,ee.Z)(Nh,is.POWER,wy),(0,ee.Z)(Nh,is.LOG,v1),(0,ee.Z)(Nh,is.IDENTITY,c1),(0,ee.Z)(Nh,is.SEQUENTIAL,$1),(0,ee.Z)(Nh,is.TIME,V4),(0,ee.Z)(Nh,is.QUANTILE,_1),(0,ee.Z)(Nh,is.QUANTIZE,x1),(0,ee.Z)(Nh,is.THRESHOLD,b1),(0,ee.Z)(Nh,is.CAT,dg),(0,ee.Z)(Nh,is.DIVERGING,Q1),Nh),$4=(eb=(0,vr.b2)(),tb=(0,vr.f3)(At.IGlobalConfigService),eb(rb=(Fy=function(){function e(){(0,xt.Z)(this,e),(0,da.Z)(this,"configService",nb,this),(0,ee.Z)(this,"scaleCache",{}),(0,ee.Z)(this,"scaleOptions",{})}return(0,St.Z)(e,[{key:"getSourceData",value:function(t,i){var r=t.getSource();r.inited?i(r.data):r.once("sourceUpdate",function(){i(r.data)})}},{key:"apply",value:function(t,i){var r=this,o=i.styleAttributeService;t.hooks.init.tap("FeatureScalePlugin",function(){r.scaleOptions=t.getScaleOptions();var u=o.getLayerStyleAttributes();r.getSourceData(t,function(p){var v=p.dataArray;Array.isArray(v)&&v.length===0||r.caculateScalesForAttributes(u||[],v)})}),t.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){r.scaleOptions=t.getScaleOptions();var u=o.getLayerStyleAttributes();return r.getSourceData(t,function(p){var v=p.dataArray;Array.isArray(v)&&v.length===0||(r.caculateScalesForAttributes(u||[],v),t.layerModelNeedUpdate=!0)}),!0}),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!t.layerModelNeedUpdate){r.scaleOptions=t.getScaleOptions();var u=o.getLayerStyleAttributes();u&&r.getSourceData(t,function(p){var v=p.dataArray;if(v.length!==0){var g=u.filter(function(E){return E.needRescale});g.length&&r.caculateScalesForAttributes(g,v)}})}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,i){var r=this;this.scaleCache={},t.forEach(function(o){if(o.scale){var u=o.scale;u.names=r.parseFields(o.scale.field||[]);var p=[];u.names.forEach(function(v){var g;p.push(r.createScale(v,o.name,(g=o.scale)===null||g===void 0?void 0:g.values,i))}),p.some(function(v){return v.type===w0.VARIABLE})?(u.type=w0.VARIABLE,p.forEach(function(v){var g;if(!u.callback&&u.values!=="text")switch((g=v.option)===null||g===void 0?void 0:g.type){case is.LOG:case is.LINEAR:case is.POWER:if(u.values&&u.values.length>2){var E=v.scale.ticks(u.values.length);v.scale.domain(E)}u.values?v.scale.range(u.values):v.scale.range(v.option.domain);break;case is.QUANTILE:case is.QUANTIZE:case is.THRESHOLD:v.scale.range(u.values);break;case is.CAT:u.values?v.scale.range(u.values):v.scale.range(v.option.domain);break;case is.DIVERGING:case is.SEQUENTIAL:v.scale.interpolator(j5.hD(u.values));break}if(u.values==="text"){var T;v.scale.range((T=v.option)===null||T===void 0?void 0:T.domain)}})):(u.type=w0.CONSTANT,u.defaultValues=p.map(function(v,g){return v.scale(u.names[g])})),u.scalers=p.map(function(v){return{field:v.field,func:v.scale,option:v.option}}),o.needRescale=!1}})}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:(0,Br.isString)(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,i,r,o){var u,p,v=this.scaleOptions[i]&&((u=this.scaleOptions[i])===null||u===void 0?void 0:u.field)===t?this.scaleOptions[i]:this.scaleOptions[t],g={field:t,scale:void 0,type:w0.VARIABLE,option:v};if(!o||!o.length)return v&&v.type?g.scale=this.createDefaultScale(v):(g.scale=dg([t]),g.type=w0.CONSTANT),g;var E=(p=o.find(function(F){return!(0,Br.isNil)(F[t])}))===null||p===void 0?void 0:p[t];if(this.isNumber(t)||(0,Br.isNil)(E)&&!v)g.scale=dg([t]),g.type=w0.CONSTANT;else{var T=v&&v.type||this.getDefaultType(E);r==="text"&&(T=is.CAT);var O=this.createScaleConfig(T,t,v,o);g.scale=this.createDefaultScale(O),g.option=O}return g}},{key:"getDefaultType",value:function(t){var i=is.LINEAR;return typeof t=="string"&&(i=Y4.test(t)?is.TIME:is.CAT),i}},{key:"createScaleConfig",value:function(t,i,r,o){var u={type:t},p=(o==null?void 0:o.map(function(E){return E[i]}))||[];if(r!=null&&r.domain)u.domain=r==null?void 0:r.domain;else if(t!==is.CAT&&t!==is.QUANTILE&&t!==is.DIVERGING)u.domain=Vx(p);else if(t===is.CAT)u.domain=(0,Br.uniq)(p);else if(t===is.QUANTILE)u.domain=p;else if(t===is.DIVERGING){var v=Vx(p),g=(r==null?void 0:r.neutral)!==void 0?r==null?void 0:r.neutral:(v[0]+v[1])/2;u.domain=[v[0],g,v[1]]}return(0,Z.Z)((0,Z.Z)({},u),r)}},{key:"createDefaultScale",value:function(t){var i=t.type,r=t.domain,o=t.unknown,u=t.clamp,p=t.nice,v=q4[i]();return r&&v.domain&&v.domain(r),o&&v.unknown(o),u!==void 0&&v.clamp&&v.clamp(u),p!==void 0&&v.nice&&v.nice(p),v}}]),e}(),nb=(0,ca.Z)(Fy.prototype,"configService",[tb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fy))||rb),ib,ab,ob,sb,wg,ub,lb,K4=(ib=(0,vr.b2)(),ab=(0,vr.f3)(At.ICameraService),ob=(0,vr.f3)(At.IRendererService),ib(sb=(wg=function(){function e(){(0,xt.Z)(this,e),(0,da.Z)(this,"cameraService",ub,this),(0,da.Z)(this,"rendererService",lb,this)}return(0,St.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){t.models.forEach(function(i){i.addUniforms((0,Z.Z)({},t.layerModel.getAnimateUniforms()))})})}}]),e}(),ub=(0,ca.Z)(wg.prototype,"cameraService",[ab],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lb=(0,ca.Z)(wg.prototype,"rendererService",[ob],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wg))||sb),cb,fb,Q4=(cb=(0,vr.b2)(),cb(fb=function(){function e(){(0,xt.Z)(this,e)}return(0,St.Z)(e,[{key:"initLayerModel",value:function(t){t.prepareBuildModel(),t.buildModels(),t.emit("modelLoaded",null),t.styleNeedUpdate=!1}},{key:"prepareLayerModel",value:function(t){t.prepareBuildModel(),t.clearModels(),t.buildModels(),t.emit("modelLoaded",null),t.layerModelNeedUpdate=!1}},{key:"apply",value:function(t){var i=this;t.hooks.init.tap("LayerModelPlugin",function(){t.inited=!0;var r=t.getSource();r.inited&&i.initLayerModel(t)}),t.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var r=t.getSource();return r.inited?i.prepareLayerModel(t):r.once("sourceUpdate",function(){i.prepareLayerModel(t)}),!1})}}]),e}())||fb),hb,pb,J4=(hb=(0,vr.b2)(),hb(pb=function(){function e(){(0,xt.Z)(this,e)}return(0,St.Z)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){t.updateLayerConfig({});var i=t.getLayerConfig(),r=i.autoFit,o=i.fitBoundsOptions;r&&setTimeout(function(){t.fitBounds(o)},100)})}}]),e}())||pb),db,vb,e3=["type"],mb={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},t3={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},r3={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},n3={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},bP=null;function i3(e){var a={u_DirectionalLights:new Array(3).fill((0,Z.Z)({},r3)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,Z.Z)({},n3)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[t3]),e.forEach(function(t,i){var r=t.type,o=r===void 0?"directional":r,u=(0,yp.Z)(t,e3),p=mb[o].lights,v=mb[o].num,g=a[v];a[p][g]=(0,Z.Z)((0,Z.Z)({},a[p][g]),u),a[v]++}),a}var a3=(db=(0,vr.b2)(),db(vb=function(){function e(){(0,xt.Z)(this,e)}return(0,St.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){var i=t.getLayerConfig(),r=i.enableLighting;r&&t.models.forEach(function(o){return o.addUniforms((0,Z.Z)({},i3()))})})}}]),e}())||vb),gb,yb,_b,Dy,xb,o3=(gb=(0,vr.b2)(),yb=(0,vr.f3)(At.IGlobalConfigService),gb(_b=(Dy=function(){function e(){(0,xt.Z)(this,e),(0,da.Z)(this,"configService",xb,this)}return(0,St.Z)(e,[{key:"apply",value:function(t,i){var r=this,o=i.rendererService,u=i.postProcessingPassFactory,p=i.normalPassFactory;t.hooks.init.tap("MultiPassRendererPlugin",function(){var v=t.getLayerConfig(),g=v.enableMultiPassRenderer,E=v.passes,T=E===void 0?[]:E;r.enabled=!!g&&t.getLayerConfig().enableMultiPassRenderer!==!1,r.enabled&&(t.multiPassRenderer=__(t,T,u,p),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(r.enabled){var v=o.getViewportSize(),g=v.width,E=v.height;t.multiPassRenderer.resize(g,E)}})}}]),e}(),xb=(0,ca.Z)(Dy.prototype,"configService",[yb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dy))||_b),bb,Eb,Ag={NONE:0,ENCODE:1,HIGHLIGHT:2},s3=(bb=(0,vr.b2)(),bb(Eb=function(){function e(){(0,xt.Z)(this,e)}return(0,St.Z)(e,[{key:"apply",value:function(t,i){var r=i.rendererService,o=i.styleAttributeService;t.hooks.init.tap("PixelPickingPlugin",function(){var u=t.getLayerConfig(),p=u.enablePicking,v=u.enableMultiPassRenderer;o.registerStyleAttribute({name:"pickingColor",type:Tn.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:X.FLOAT},size:3,update:function(E,T){var O=E.id;return p?P(O):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var u=t.getLayerConfig(),p=u.enablePicking;p&&t.isVisible()&&t.models.forEach(function(v){return v.addUniforms({u_PickingStage:Ag.ENCODE})})}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var u=t.getLayerConfig(),p=u.enablePicking;p&&t.isVisible()&&t.models.forEach(function(v){return v.addUniforms({u_PickingStage:Ag.HIGHLIGHT})})}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(u){var p=t.getLayerConfig(),v=p.highlightColor,g=p.activeMix,E=g===void 0?0:g,T=typeof v=="string"?S(v):v||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:k(new Uint8Array(u))}),t.models.forEach(function(O){return O.addUniforms({u_PickingStage:Ag.HIGHLIGHT,u_PickingColor:u,u_HighlightColor:T.map(function(F){return F*255}),u_activeMix:E})})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(u){var p=t.getLayerConfig(),v=p.selectColor,g=p.selectMix,E=g===void 0?0:g,T=typeof v=="string"?S(v):v||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:k(new Uint8Array(u))}),t.models.forEach(function(O){return O.addUniforms({u_PickingStage:Ag.HIGHLIGHT,u_PickingColor:u,u_HighlightColor:T.map(function(F){return F*255}),u_activeMix:E,u_CurrentSelectedId:u,u_SelectColor:T.map(function(F){return F*255}),u_EnableSelect:1})})})}}]),e}())||Eb),Cb,Sb,u3=(Cb=(0,vr.b2)(),Cb(Sb=function(){function e(){(0,xt.Z)(this,e)}return(0,St.Z)(e,[{key:"apply",value:function(t,i){var r=this,o=i.styleAttributeService;t.hooks.init.tap("RegisterStyleAttributePlugin",function(){r.registerBuiltinAttributes(o)})}},{key:"registerBuiltinAttributes",value:function(t){t.registerStyleAttribute({name:"position",type:Tn.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:X.FLOAT},size:3,update:function(r,o,u){return u.length===2?[u[0],u[1],0]:[u[0],u[1],u[2]]}}}),t.registerStyleAttribute({name:"filter",type:Tn.Attribute,descriptor:{name:"filter",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(r,o){var u=r.filter;return u?[1]:[0]}}}),t.registerStyleAttribute({name:"color",type:Tn.Attribute,descriptor:{name:"a_Color",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:4,update:function(r,o){var u=r.color;return!u||!u.length?[1,1,1,1]:u}}}),t.registerStyleAttribute({name:"vertexId",type:Tn.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:X.DYNAMIC_DRAW,data:[],type:X.FLOAT},size:1,update:function(r,o,u,p){return[o]}}})}}]),e}())||Sb),wb,Ab,Tb,Mb,kb,Ib,Uv,Pb,Lb,Rb,Ob,l3=(wb=(0,vr.b2)(),Ab=(0,vr.f3)(At.ICameraService),Tb=(0,vr.f3)(At.ICoordinateSystemService),Mb=(0,vr.f3)(At.IRendererService),kb=(0,vr.f3)(At.IMapService),wb(Ib=(Uv=function(){function e(){(0,xt.Z)(this,e),(0,da.Z)(this,"cameraService",Pb,this),(0,da.Z)(this,"coordinateSystemService",Lb,this),(0,da.Z)(this,"rendererService",Rb,this),(0,da.Z)(this,"mapService",Ob,this)}return(0,St.Z)(e,[{key:"apply",value:function(t){var i=this,r=this.mapService.version,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[0,0];t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var p=t.getLayerConfig().tileOrigin;if(i.coordinateSystemService.refresh(p),r==="GAODE2.x"){var v=i.getLayerCenter(t);i.mapService.map.customCoords.setCenter(v),i.mapService.setCustomCoordCenter(v),o=i.mapService.map.customCoords.getMVPMatrix(),u=i.mapService.getCustomCoordCenter()}var g=i.rendererService.getViewportSize(),E=g.width,T=g.height;t.models.forEach(function(O){var F;O.addUniforms((F={},(0,ee.Z)(F,$0.ProjectionMatrix,i.cameraService.getProjectionMatrix()),(0,ee.Z)(F,$0.ViewMatrix,i.cameraService.getViewMatrix()),(0,ee.Z)(F,$0.ViewProjectionMatrix,i.cameraService.getViewProjectionMatrix()),(0,ee.Z)(F,$0.Zoom,i.cameraService.getZoom()),(0,ee.Z)(F,$0.ZoomScale,i.cameraService.getZoomScale()),(0,ee.Z)(F,$0.FocalDistance,i.cameraService.getFocalDistance()),(0,ee.Z)(F,$0.CameraPosition,i.cameraService.getCameraPosition()),(0,ee.Z)(F,$p.CoordinateSystem,i.coordinateSystemService.getCoordinateSystem()),(0,ee.Z)(F,$p.ViewportCenter,i.coordinateSystemService.getViewportCenter()),(0,ee.Z)(F,$p.ViewportCenterProjection,i.coordinateSystemService.getViewportCenterProjection()),(0,ee.Z)(F,$p.PixelsPerDegree,i.coordinateSystemService.getPixelsPerDegree()),(0,ee.Z)(F,$p.PixelsPerDegree2,i.coordinateSystemService.getPixelsPerDegree2()),(0,ee.Z)(F,$p.PixelsPerMeter,i.coordinateSystemService.getPixelsPerMeter()),(0,ee.Z)(F,$p.Mvp,o),(0,ee.Z)(F,"u_SceneCenterMKT",u),(0,ee.Z)(F,"u_ViewportSize",[E,T]),(0,ee.Z)(F,"u_ModelMatrix",i.cameraService.getModelMatrix()),(0,ee.Z)(F,"u_DevicePixelRatio",Ia.devicePixelRatio),(0,ee.Z)(F,"u_PickingBuffer",t.getLayerConfig().pickingBuffer||0),(0,ee.Z)(F,"u_shaderPick",Number(t.getShaderPickStat())),F))})})}},{key:"getLayerCenter",value:function(t){var i=t.getSource();return i.center}}]),e}(),Pb=(0,ca.Z)(Uv.prototype,"cameraService",[Ab],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lb=(0,ca.Z)(Uv.prototype,"coordinateSystemService",[Tb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rb=(0,ca.Z)(Uv.prototype,"rendererService",[Mb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ob=(0,ca.Z)(Uv.prototype,"mapService",[kb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uv))||Ib),Fb,Db,c3=(Fb=(0,vr.b2)(),Fb(Db=function(){function e(){(0,xt.Z)(this,e)}return(0,St.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate()})}}]),e}())||Db),Bb,Nb,f3=(Bb=(0,vr.b2)(),Bb(Nb=function(){function e(){(0,xt.Z)(this,e)}return(0,St.Z)(e,[{key:"apply",value:function(t,i){var r=this,o=i.styleAttributeService;t.hooks.init.tap("UpdateStyleAttributePlugin",function(){r.initStyleAttribute(t,{styleAttributeService:o})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){t.layerModelNeedUpdate||r.updateStyleAtrribute(t,{styleAttributeService:o})})}},{key:"updateStyleAtrribute",value:function(t,i){var r=i.styleAttributeService,o=r.getLayerStyleAttributes()||[],u=r.getLayerStyleAttribute("filter"),p=r.getLayerStyleAttribute("shape");if(u&&u.needRegenerateVertices){t.layerModelNeedUpdate=!0,o.forEach(function(v){return v.needRegenerateVertices=!1});return}o.filter(function(v){return v.needRegenerateVertices}).forEach(function(v){r.updateAttributeByFeatureRange(v.name,t.getEncodedData(),v.featureRange.startIndex,v.featureRange.endIndex),v.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,i){var r=i.styleAttributeService,o=r.getLayerStyleAttributes()||[];o.filter(function(u){return u.needRegenerateVertices}).forEach(function(u){r.updateAttributeByFeatureRange(u.name,t.getEncodedData(),u.featureRange.startIndex,u.featureRange.endIndex),u.needRegenerateVertices=!1})}}]),e}())||Nb);Dh.bind(At.ILayerPlugin).to(N5).inRequestScope(),Dh.bind(At.ILayerPlugin).to(u3).inRequestScope(),Dh.bind(At.ILayerPlugin).to($4).inRequestScope(),Dh.bind(At.ILayerPlugin).to(B5).inRequestScope(),Dh.bind(At.ILayerPlugin).to(J4).inRequestScope(),Dh.bind(At.ILayerPlugin).to(f3).inRequestScope(),Dh.bind(At.ILayerPlugin).to(c3).inRequestScope(),Dh.bind(At.ILayerPlugin).to(o3).inRequestScope(),Dh.bind(At.ILayerPlugin).to(l3).inRequestScope(),Dh.bind(At.ILayerPlugin).to(K4).inRequestScope(),Dh.bind(At.ILayerPlugin).to(a3).inRequestScope(),Dh.bind(At.ILayerPlugin).to(s3).inRequestScope(),Dh.bind(At.ILayerPlugin).to(Q4).inRequestScope();var h3=vt(88307),p3=vt.n(h3),d3=function(){function e(a,t){(0,xt.Z)(this,e);var i=t.buffer,r=t.offset,o=t.stride,u=t.normalized,p=t.size,v=t.divisor;this.buffer=i,this.attribute={buffer:i.get(),offset:r||0,stride:o||0,normalized:u||!1,divisor:v||0},p&&(this.attribute.size=p)}return(0,St.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),t0,km,r0,Sp,Im,P0,Pm,Tg,Rd,av,Gc,Od,Fd,Mg,v3=(t0={},(0,ee.Z)(t0,X.POINTS,"points"),(0,ee.Z)(t0,X.LINES,"lines"),(0,ee.Z)(t0,X.LINE_LOOP,"line loop"),(0,ee.Z)(t0,X.LINE_STRIP,"line strip"),(0,ee.Z)(t0,X.TRIANGLES,"triangles"),(0,ee.Z)(t0,X.TRIANGLE_FAN,"triangle fan"),(0,ee.Z)(t0,X.TRIANGLE_STRIP,"triangle strip"),t0),zb=(km={},(0,ee.Z)(km,X.STATIC_DRAW,"static"),(0,ee.Z)(km,X.DYNAMIC_DRAW,"dynamic"),(0,ee.Z)(km,X.STREAM_DRAW,"stream"),km),By=(r0={},(0,ee.Z)(r0,X.BYTE,"int8"),(0,ee.Z)(r0,X.UNSIGNED_INT,"int16"),(0,ee.Z)(r0,X.INT,"int32"),(0,ee.Z)(r0,X.UNSIGNED_BYTE,"uint8"),(0,ee.Z)(r0,X.UNSIGNED_SHORT,"uint16"),(0,ee.Z)(r0,X.UNSIGNED_INT,"uint32"),(0,ee.Z)(r0,X.FLOAT,"float"),r0),m3=(Sp={},(0,ee.Z)(Sp,X.ALPHA,"alpha"),(0,ee.Z)(Sp,X.LUMINANCE,"luminance"),(0,ee.Z)(Sp,X.LUMINANCE_ALPHA,"luminance alpha"),(0,ee.Z)(Sp,X.RGB,"rgb"),(0,ee.Z)(Sp,X.RGBA,"rgba"),(0,ee.Z)(Sp,X.RGBA4,"rgba4"),(0,ee.Z)(Sp,X.RGB5_A1,"rgb5 a1"),(0,ee.Z)(Sp,X.RGB565,"rgb565"),(0,ee.Z)(Sp,X.DEPTH_COMPONENT,"depth"),(0,ee.Z)(Sp,X.DEPTH_STENCIL,"depth stencil"),Sp),g3=(Im={},(0,ee.Z)(Im,X.DONT_CARE,"dont care"),(0,ee.Z)(Im,X.NICEST,"nice"),(0,ee.Z)(Im,X.FASTEST,"fast"),Im),Ub=(P0={},(0,ee.Z)(P0,X.NEAREST,"nearest"),(0,ee.Z)(P0,X.LINEAR,"linear"),(0,ee.Z)(P0,X.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,ee.Z)(P0,X.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,ee.Z)(P0,X.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,ee.Z)(P0,X.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),P0),Zb=(Pm={},(0,ee.Z)(Pm,X.REPEAT,"repeat"),(0,ee.Z)(Pm,X.CLAMP_TO_EDGE,"clamp"),(0,ee.Z)(Pm,X.MIRRORED_REPEAT,"mirror"),Pm),y3=(Tg={},(0,ee.Z)(Tg,X.NONE,"none"),(0,ee.Z)(Tg,X.BROWSER_DEFAULT_WEBGL,"browser"),Tg),_3=(Rd={},(0,ee.Z)(Rd,X.NEVER,"never"),(0,ee.Z)(Rd,X.ALWAYS,"always"),(0,ee.Z)(Rd,X.LESS,"less"),(0,ee.Z)(Rd,X.LEQUAL,"lequal"),(0,ee.Z)(Rd,X.GREATER,"greater"),(0,ee.Z)(Rd,X.GEQUAL,"gequal"),(0,ee.Z)(Rd,X.EQUAL,"equal"),(0,ee.Z)(Rd,X.NOTEQUAL,"notequal"),Rd),Vb=(av={},(0,ee.Z)(av,X.FUNC_ADD,"add"),(0,ee.Z)(av,X.MIN_EXT,"min"),(0,ee.Z)(av,X.MAX_EXT,"max"),(0,ee.Z)(av,X.FUNC_SUBTRACT,"subtract"),(0,ee.Z)(av,X.FUNC_REVERSE_SUBTRACT,"reverse subtract"),av),kg=(Gc={},(0,ee.Z)(Gc,X.ZERO,"zero"),(0,ee.Z)(Gc,X.ONE,"one"),(0,ee.Z)(Gc,X.SRC_COLOR,"src color"),(0,ee.Z)(Gc,X.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,ee.Z)(Gc,X.SRC_ALPHA,"src alpha"),(0,ee.Z)(Gc,X.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,ee.Z)(Gc,X.DST_COLOR,"dst color"),(0,ee.Z)(Gc,X.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,ee.Z)(Gc,X.DST_ALPHA,"dst alpha"),(0,ee.Z)(Gc,X.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,ee.Z)(Gc,X.CONSTANT_COLOR,"constant color"),(0,ee.Z)(Gc,X.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,ee.Z)(Gc,X.CONSTANT_ALPHA,"constant alpha"),(0,ee.Z)(Gc,X.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,ee.Z)(Gc,X.SRC_ALPHA_SATURATE,"src alpha saturate"),Gc),x3=(Od={},(0,ee.Z)(Od,X.NEVER,"never"),(0,ee.Z)(Od,X.ALWAYS,"always"),(0,ee.Z)(Od,X.LESS,"less"),(0,ee.Z)(Od,X.LEQUAL,"lequal"),(0,ee.Z)(Od,X.GREATER,"greater"),(0,ee.Z)(Od,X.GEQUAL,"gequal"),(0,ee.Z)(Od,X.EQUAL,"equal"),(0,ee.Z)(Od,X.NOTEQUAL,"notequal"),Od),Zv=(Fd={},(0,ee.Z)(Fd,X.ZERO,"zero"),(0,ee.Z)(Fd,X.KEEP,"keep"),(0,ee.Z)(Fd,X.REPLACE,"replace"),(0,ee.Z)(Fd,X.INVERT,"invert"),(0,ee.Z)(Fd,X.INCR,"increment"),(0,ee.Z)(Fd,X.DECR,"decrement"),(0,ee.Z)(Fd,X.INCR_WRAP,"increment wrap"),(0,ee.Z)(Fd,X.DECR_WRAP,"decrement wrap"),Fd),b3=(Mg={},(0,ee.Z)(Mg,X.FRONT,"front"),(0,ee.Z)(Mg,X.BACK,"back"),Mg),E3=function(){function e(a,t){(0,xt.Z)(this,e);var i=t.data,r=t.usage,o=t.type;this.buffer=a.buffer({data:i,usage:zb[r||X.STATIC_DRAW],type:By[o||X.UNSIGNED_BYTE]})}return(0,St.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(t){var i=t.data,r=t.offset;this.buffer.subdata(i,r)}}]),e}(),C3=function(){function e(a,t){(0,xt.Z)(this,e);var i=t.data,r=t.usage,o=t.type,u=t.count;this.elements=a.elements({data:i,usage:zb[r||X.STATIC_DRAW],type:By[o||X.UNSIGNED_BYTE],count:u})}return(0,St.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var i=t.data;this.elements.subdata(i)}},{key:"destroy",value:function(){}}]),e}(),S3=function(){function e(a,t){(0,xt.Z)(this,e);var i=t.width,r=t.height,o=t.color,u=t.colors,p=t.depth,v=t.stencil,g={width:i,height:r};Array.isArray(u)&&(g.colors=u.map(function(E){return E.get()})),o&&typeof o!="boolean"&&(g.color=o.get()),this.framebuffer=a.framebuffer(g)}return(0,St.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var i=t.width,r=t.height;this.framebuffer.resize(i,r)}}]),e}(),w3=function(){function e(a,t){(0,xt.Z)(this,e),(0,ee.Z)(this,"destroyed",!1),(0,ee.Z)(this,"uniforms",{}),this.reGl=a;var i=t.vs,r=t.fs,o=t.attributes,u=t.uniforms,p=t.primitive,v=t.count,g=t.elements,E=t.depth,T=t.blend,O=t.stencil,F=t.cull,U=t.instances,j={};this.options=t,u&&(this.uniforms=this.extractUniforms(u),Object.keys(u).forEach(function(ke){j[ke]=a.prop(ke)}));var K={};Object.keys(o).forEach(function(ke){K[ke]=o[ke].get()});var ae={attributes:K,frag:r,uniforms:j,vert:i,blend:{},primitive:v3[p===void 0?X.TRIANGLES:p]};U&&(ae.instances=U),v?ae.count=v:g&&(ae.elements=g.get()),this.initDepthDrawParams({depth:E},ae),this.initBlendDrawParams({blend:T},ae),this.initStencilDrawParams({stencil:O},ae),this.initCullDrawParams({cull:F},ae),this.drawCommand=a(ae);var ve=(0,Br.cloneDeep)(ae);ve.blend=(0,Z.Z)((0,Z.Z)({},ve.blend),{},{enable:!1}),this.drawPickCommand=a(ve),this.drawParams=ae}return(0,St.Z)(e,[{key:"updateAttributesAndElements",value:function(t,i){var r={};Object.keys(t).forEach(function(u){r[u]=t[u].get()}),this.drawParams.attributes=r,this.drawParams.elements=i.get(),this.drawCommand=this.reGl(this.drawParams);var o=(0,Br.cloneDeep)(this.drawParams);o.blend=(0,Z.Z)((0,Z.Z)({},o.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(o)}},{key:"updateAttributes",value:function(t){var i={};Object.keys(t).forEach(function(o){i[o]=t[o].get()}),this.drawParams.attributes=i,this.drawCommand=this.reGl(this.drawParams);var r=(0,Br.cloneDeep)(this.drawParams);r.blend=(0,Z.Z)((0,Z.Z)({},r.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(r)}},{key:"addUniforms",value:function(t){this.uniforms=(0,Z.Z)((0,Z.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,i){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var r=(0,Z.Z)((0,Z.Z)({},this.uniforms),this.extractUniforms(t.uniforms||{})),o={};Object.keys(r).forEach(function(u){var p=(0,D.Z)(r[u]);p==="boolean"||p==="number"||Array.isArray(r[u])||r[u].BYTES_PER_ELEMENT?o[u]=r[u]:o[u]=r[u].get()}),i?this.drawPickCommand(o):this.drawCommand(o)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(t){t.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,i){var r=t.depth;r&&(i.depth={enable:r.enable===void 0?!0:!!r.enable,mask:r.mask===void 0?!0:!!r.mask,func:_3[r.func||X.LESS],range:r.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,i){var r=t.blend;if(r){var o=r.enable,u=r.func,p=r.equation,v=r.color,g=v===void 0?[0,0,0,0]:v;i.blend={enable:!!o,func:{srcRGB:kg[u&&u.srcRGB||X.SRC_ALPHA],srcAlpha:kg[u&&u.srcAlpha||X.SRC_ALPHA],dstRGB:kg[u&&u.dstRGB||X.ONE_MINUS_SRC_ALPHA],dstAlpha:kg[u&&u.dstAlpha||X.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Vb[p&&p.rgb||X.FUNC_ADD],alpha:Vb[p&&p.alpha||X.FUNC_ADD]},color:g}}}},{key:"initStencilDrawParams",value:function(t,i){var r=t.stencil;if(r){var o=r.enable,u=r.mask,p=u===void 0?-1:u,v=r.func,g=v===void 0?{cmp:X.ALWAYS,ref:0,mask:-1}:v,E=r.opFront,T=E===void 0?{fail:X.KEEP,zfail:X.KEEP,zpass:X.KEEP}:E,O=r.opBack,F=O===void 0?{fail:X.KEEP,zfail:X.KEEP,zpass:X.KEEP}:O;i.stencil={enable:!!o,mask:p,func:(0,Z.Z)((0,Z.Z)({},g),{},{cmp:x3[g.cmp]}),opFront:{fail:Zv[T.fail],zfail:Zv[T.zfail],zpass:Zv[T.zpass]},opBack:{fail:Zv[F.fail],zfail:Zv[F.zfail],zpass:Zv[F.zpass]}}}}},{key:"initCullDrawParams",value:function(t,i){var r=t.cull;if(r){var o=r.enable,u=r.face,p=u===void 0?X.BACK:u;i.cull={enable:!!o,face:b3[p]}}}},{key:"extractUniforms",value:function(t){var i=this,r={};return Object.keys(t).forEach(function(o){i.extractUniformsRecursively(o,t[o],r,"")}),r}},{key:"extractUniformsRecursively",value:function(t,i,r,o){var u=this;if(i===null||typeof i=="number"||typeof i=="boolean"||Array.isArray(i)&&typeof i[0]=="number"||(0,Br.isTypedArray)(i)||i===""||"resize"in i){r["".concat(o&&o+".").concat(t)]=i;return}(0,Br.isPlainObject)(i)&&Object.keys(i).forEach(function(p){u.extractUniformsRecursively(p,i[p],r,"".concat(o&&o+".").concat(t))}),Array.isArray(i)&&i.forEach(function(p,v){Object.keys(p).forEach(function(g){u.extractUniformsRecursively(g,p[g],r,"".concat(o&&o+".").concat(t,"[").concat(v,"]"))})})}}]),e}(),A3=function(){function e(a,t){(0,xt.Z)(this,e),(0,ee.Z)(this,"isDistroy",!1);var i=t.data,r=t.type,o=r===void 0?X.UNSIGNED_BYTE:r,u=t.width,p=t.height,v=t.flipY,g=v===void 0?!1:v,E=t.format,T=E===void 0?X.RGBA:E,O=t.mipmap,F=O===void 0?!1:O,U=t.wrapS,j=U===void 0?X.CLAMP_TO_EDGE:U,K=t.wrapT,ae=K===void 0?X.CLAMP_TO_EDGE:K,ve=t.aniso,ke=ve===void 0?0:ve,qe=t.alignment,ct=qe===void 0?1:qe,_t=t.premultiplyAlpha,Ot=_t===void 0?!1:_t,Xt=t.mag,yr=Xt===void 0?X.NEAREST:Xt,Pr=t.min,xr=Pr===void 0?X.NEAREST:Pr,An=t.colorSpace,ii=An===void 0?X.BROWSER_DEFAULT_WEBGL:An,sa=t.x,Io=sa===void 0?0:sa,_o=t.y,Gu=_o===void 0?0:_o,ml=t.copy,Ju=ml===void 0?!1:ml;this.width=u,this.height=p;var mf={width:u,height:p,type:By[o],format:m3[T],wrapS:Zb[j],wrapT:Zb[ae],mag:Ub[yr],min:Ub[xr],alignment:ct,flipY:g,colorSpace:y3[ii],premultiplyAlpha:Ot,aniso:ke,x:Io,y:Gu,copy:Ju};i&&(mf.data=i),typeof F=="number"?mf.mipmap=g3[F]:typeof F=="boolean"&&(mf.mipmap=F),this.texture=a.texture(mf)}return(0,St.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var i=t.width,r=t.height;this.texture.resize(i,r),this.width=i,this.height=r}},{key:"destroy",value:function(){if(!this.isDistroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDistroy=!0}}]),e}(),jb,Gb,T3=(jb=(0,vr.b2)(),jb(Gb=function(){function e(){var a=this;(0,xt.Z)(this,e),(0,ee.Z)(this,"createModel",function(t){return new w3(a.gl,t)}),(0,ee.Z)(this,"createAttribute",function(t){return new d3(a.gl,t)}),(0,ee.Z)(this,"createBuffer",function(t){return new E3(a.gl,t)}),(0,ee.Z)(this,"createElements",function(t){return new C3(a.gl,t)}),(0,ee.Z)(this,"createTexture2D",function(t){return new A3(a.gl,t)}),(0,ee.Z)(this,"createFramebuffer",function(t){return new S3(a.gl,t)}),(0,ee.Z)(this,"useFramebuffer",function(t,i){a.gl({framebuffer:t?t.get():null})(i)}),(0,ee.Z)(this,"clear",function(t){var i,r=t.color,o=t.depth,u=t.stencil,p=t.framebuffer,v=p===void 0?null:p,g={color:r,depth:o,stencil:u};g.framebuffer=v===null?v:v.get(),(i=a.gl)===null||i===void 0||i.clear(g)}),(0,ee.Z)(this,"viewport",function(t){var i=t.x,r=t.y,o=t.width,u=t.height;a.gl._gl.viewport(i,r,o,u),a.width=o,a.height=u,a.gl._refresh()}),(0,ee.Z)(this,"readPixels",function(t){var i=t.framebuffer,r=t.x,o=t.y,u=t.width,p=t.height,v={x:r,y:o,width:u,height:p};return i&&(v.framebuffer=i.get()),a.gl.read(v)}),(0,ee.Z)(this,"getViewportSize",function(){return{width:a.gl._gl.drawingBufferWidth,height:a.gl._gl.drawingBufferHeight}}),(0,ee.Z)(this,"getContainer",function(){if(Ts)return a.canvas;var t;return(t=a.canvas)===null||t===void 0?void 0:t.parentElement}),(0,ee.Z)(this,"getCanvas",function(){return a.canvas}),(0,ee.Z)(this,"getGLContext",function(){return a.gl._gl}),(0,ee.Z)(this,"destroy",function(){var t,i,r;a.canvas=null,(t=a.gl)===null||t===void 0||(i=t._gl)===null||i===void 0||(r=i.getExtension("WEBGL_lose_context"))===null||r===void 0||r.loseContext(),a.gl.destroy(),a.gl=null})}return(0,St.Z)(e,[{key:"init",value:function(){var a=(0,Sa.Z)(zn().mark(function i(r,o,u){var p=this;return zn().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(this.canvas=r,!u){g.next=5;break}this.gl=u,g.next=8;break;case 5:return g.next=7,new Promise(function(E,T){p3()({canvas:p.canvas,attributes:{alpha:!0,antialias:o.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:o.preserveDrawingBuffer,stencil:o.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(F,U){(F||!U)&&T(F),E(U)}})});case 7:this.gl=g.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return g.stop()}},i,this)}));function t(i,r,o){return a.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||Gb),M3=function(){function e(a){(0,xt.Z)(this,e);var t=a.id,i=a.map,r=a.canvas,o=a.hasBaseMap,u=mE();this.container=u,i.setContainer(u,t,r,o),u.bind(At.IRendererService).to(T3).inSingletonScope(),this.sceneService=u.get(At.ISceneService),this.mapService=u.get(At.IMapService),this.iconService=u.get(At.IIconService),this.fontService=u.get(At.IFontService),this.controlService=u.get(At.IControlService),this.layerService=u.get(At.ILayerService),this.markerService=u.get(At.IMarkerService),this.interactionService=u.get(At.IInteractionService),this.popupService=u.get(At.IPopupService),Ts?this.sceneService.initMiniScene(a):(this.initComponent(t),this.sceneService.init(a),this.initControl())}return(0,St.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(t){return this.sceneService.exportPng(t)}},{key:"exportMap",value:function(t){return this.sceneService.exportPng(t)}},{key:"registerRenderService",value:function(t){var i=this;if(this.sceneService.loaded){var r=new t(this);r.init()}else this.on("loaded",function(){var o=new t(i);o.init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var i=qg(this.container);t.setContainer(i,this.container),this.sceneService.addLayer(t);var r=t.getLayerConfig();if(r){var o=r.mask,u=r.maskfence,p=r.maskColor,v=p===void 0?"#000":p,g=r.maskOpacity,E=g===void 0?0:g;if(o&&u){var T=new G_().source(u).shape("fill").color(v).style({opacity:E});this.addMask(T,t.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(t,i){var r=this.getLayer(i);if(r){var o=qg(this.container);t.setContainer(o,this.container),r.addMaskLayer(t),this.sceneService.addLayer(t)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(t,i){this.layerService.remove(t,i)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,i){this.fontService.addIconFont(t,i)}},{key:"addIconFonts",value:function(t){var i=this;t.forEach(function(r){var o=(0,pr.Z)(r,2),u=o[0],p=o[1];i.fontService.addIconFont(u,p)})}},{key:"addFontFace",value:function(t,i){this.sceneService.addFontFace(t,i)}},{key:"addImage",value:function(t,i){Ts?this.iconService.addImageMini(t,i,this.sceneService):this.iconService.addImage(t,i)}},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,i){this.fontService.addIconGlyphs(i)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"on",value:function(t,i){$g.indexOf(t)===-1?this.mapService.on(t,i):this.sceneService.on(t,i)}},{key:"once",value:function(t,i){$g.indexOf(t)===-1?this.mapService.once(t,i):this.sceneService.once(t,i)}},{key:"off",value:function(t,i){$g.indexOf(t)===-1?this.mapService.off(t,i):this.sceneService.off(t,i)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,i){return this.mapService.setCenter(t,i)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,i){this.mapService.panBy(t,i)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,i){var r=this.sceneService.getSceneConfig(),o=r.fitBoundsOptions,u=r.animate;this.mapService.fitBounds(t,i||(0,Z.Z)((0,Z.Z)({},o),{},{animate:u}))}},{key:"setZoomAndCenter",value:function(t,i){this.mapService.setZoomAndCenter(t,i)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,i){this.container.bind(At.IPostProcessingPass).to(t).whenTargetNamed(i)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:$c(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),i=t.logoVisible,r=t.logoPosition;i&&this.addControl(new DE({position:r}))}}]),e}(),EP="2.9.26";function Hb(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,i)}return t}function CP(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?Hb(Object(t),!0).forEach(function(i){k3(e,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Hb(Object(t)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})}return e}function k3(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function SP(e,a){return R3(e)||L3(e,a)||P3(e,a)||I3()}function I3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function P3(e,a){if(!!e){if(typeof e=="string")return Wb(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Wb(e,a)}}function Wb(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function L3(e,a){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function R3(e){if(Array.isArray(e))return e}var wP=null,AP=null,Xb,Ny,Yb,O3=(Xb=Yg(At.IGlobalConfigService),Ny=function(){function e(a){(0,xt.Z)(this,e),(0,da.Z)(this,"configService",Yb,this),this.config=a}return(0,St.Z)(e,[{key:"setContainer",value:function(t,i,r,o){t.bind(At.MapConfig).toConstantValue((0,Z.Z)((0,Z.Z)({},this.config),{},{id:i,canvas:r,hasBaseMap:o})),t.bind(At.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),Yb=(0,ca.Z)(Ny.prototype,"configService",[Xb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ny),F3=vt(6158),Lm=vt.n(F3);function Rm(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Ig(e,a){var t=cp.fF([],a,e);return cp.bA(t,t,1/t[3]),t}function TP(e,a){var t=e%a;return t<0?a+t:t}function MP(e,a,t){return t*a+(1-t)*e}function ov(e,a){if(!e)throw new Error(a||"viewport-mercator-project: assertion failed.")}var ad=Math.PI,qb=ad/4,n0=ad/180,$b=180/ad,zy=512,Uy=4003e4,D3=1.5;function Kb(e){return Math.pow(2,e)}function B3(e){return Math.log2(e)}function Pg(e,a){var t=(0,pr.Z)(e,2),i=t[0],r=t[1];ov(Number.isFinite(i)&&Number.isFinite(a)),ov(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude"),a*=zy;var o=i*n0,u=r*n0,p=a*(o+ad)/(2*ad),v=a*(ad-Math.log(Math.tan(qb+u*.5)))/(2*ad);return[p,v]}function Zy(e,a){var t=(0,pr.Z)(e,2),i=t[0],r=t[1];a*=zy;var o=i/a*(2*ad)-ad,u=2*(Math.atan(Math.exp(ad-r/a*(2*ad)))-qb);return[o*$b,u*$b]}function kP(e){var a=e.latitude;assert(Number.isFinite(a));var t=Math.cos(a*n0);return B3(Uy*t)-9}function Qb(e){var a=e.latitude,t=e.longitude,i=e.zoom,r=e.scale,o=e.highPrecision,u=o===void 0?!1:o;r=r!==void 0?r:Kb(i),ov(Number.isFinite(a)&&Number.isFinite(t)&&Number.isFinite(r));var p={},v=zy*r,g=Math.cos(a*n0),E=v/360,T=E/g,O=v/Uy/g;if(p.pixelsPerMeter=[O,-O,O],p.metersPerPixel=[1/O,-1/O,1/O],p.pixelsPerDegree=[E,-T,O],p.degreesPerPixel=[1/E,-1/T,1/O],u){var F=n0*Math.tan(a*n0)/g,U=E*F/2,j=v/Uy*F,K=j/T*O;p.pixelsPerDegree2=[0,-U,j],p.pixelsPerMeter2=[K,0,K]}return p}function IP(e,a){var t=_slicedToArray(e,3),i=t[0],r=t[1],o=t[2],u=_slicedToArray(a,3),p=u[0],v=u[1],g=u[2],E=1,T=Qb({longitude:i,latitude:r,scale:E,highPrecision:!0}),O=T.pixelsPerMeter,F=T.pixelsPerMeter2,U=Pg(e,E);U[0]+=p*(O[0]+F[0]*v),U[1]+=v*(O[1]+F[1]*v);var j=Zy(U,E),K=(o||0)+(g||0);return Number.isFinite(o)||Number.isFinite(g)?[j[0],j[1],K]:j}function N3(e){var a=e.height,t=e.pitch,i=e.bearing,r=e.altitude,o=e.center,u=o===void 0?null:o,p=e.flipY,v=p===void 0?!1:p,g=Rm();return Ra.translate(g,g,[0,0,-r]),Ra.scale(g,g,[1,1,1/a]),Ra.rotateX(g,g,-t*n0),Ra.rotateZ(g,g,i*n0),v&&Ra.scale(g,g,[1,-1,1]),u&&Ra.translate(g,g,ts.negate([],u)),g}function z3(e){var a=e.width,t=e.height,i=e.altitude,r=i===void 0?D3:i,o=e.pitch,u=o===void 0?0:o,p=e.nearZMultiplier,v=p===void 0?1:p,g=e.farZMultiplier,E=g===void 0?1:g,T=u*n0,O=Math.atan(.5/r),F=Math.sin(O)*r/Math.sin(Math.PI/2-T-O),U=Math.cos(Math.PI/2-T)*F+r;return{fov:2*Math.atan(t/2/r),aspect:a/t,focalDistance:r,near:v,far:U*E}}function U3(e){var a=e.width,t=e.height,i=e.pitch,r=e.altitude,o=e.nearZMultiplier,u=e.farZMultiplier,p=z3({width:a,height:t,altitude:r,pitch:i,nearZMultiplier:o,farZMultiplier:u}),v=p.fov,g=p.aspect,E=p.near,T=p.far,O=Ra.perspective([],v,g,E,T);return O}function Z3(e,a){var t=(0,pr.Z)(e,3),i=t[0],r=t[1],o=t[2],u=o===void 0?0:o;return ov(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(u)),Ig(a,[i,r,u,1])}function Jb(e,a){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=(0,pr.Z)(e,3),r=i[0],o=i[1],u=i[2];if(ov(Number.isFinite(r)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(u)){var p=Ig(a,[r,o,u,1]);return p}var v=Ig(a,[r,o,0,1]),g=Ig(a,[r,o,1,1]),E=v[2],T=g[2],O=E===T?0:((t||0)-E)/(T-E);return Ur.t7([],v,g,O)}var e2=Rm(),V3=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=a.width,i=a.height,r=a.viewMatrix,o=r===void 0?e2:r,u=a.projectionMatrix,p=u===void 0?e2:u;(0,xt.Z)(this,e),this.width=t||1,this.height=i||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=p;var v=Rm();Ra.multiply(v,v,this.projectionMatrix),Ra.multiply(v,v,this.viewMatrix),this.viewProjectionMatrix=v;var g=Rm();Ra.scale(g,g,[this.width/2,-this.height/2,1]),Ra.translate(g,g,[1,-1,0]),Ra.multiply(g,g,this.viewProjectionMatrix);var E=Ra.invert(Rm(),g);if(!E)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=g,this.pixelUnprojectionMatrix=E,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,St.Z)(e,[{key:"equals",value:function(t){return t instanceof e?t.width===this.width&&t.height===this.height&&Ra.equals(t.projectionMatrix,this.projectionMatrix)&&Ra.equals(t.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=i.topLeft,o=r===void 0?!0:r,u=this.projectPosition(t),p=Z3(u,this.pixelProjectionMatrix),v=(0,pr.Z)(p,2),g=v[0],E=v[1],T=o?E:this.height-E;return t.length===2?[g,T]:[g,T,p[2]]}},{key:"unproject",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=i.topLeft,o=r===void 0?!0:r,u=i.targetZ,p=(0,pr.Z)(t,3),v=p[0],g=p[1],E=p[2],T=o?g:this.height-g,O=u&&u*this.pixelsPerMeter,F=Jb([v,T,E],this.pixelUnprojectionMatrix,O),U=this.unprojectPosition(F),j=(0,pr.Z)(U,3),K=j[0],ae=j[1],ve=j[2];return Number.isFinite(E)?[K,ae,ve]:Number.isFinite(u)?[K,ae,u]:[K,ae]}},{key:"projectPosition",value:function(t){var i=this.projectFlat(t),r=(0,pr.Z)(i,2),o=r[0],u=r[1],p=(t[2]||0)*this.pixelsPerMeter;return[o,u,p]}},{key:"unprojectPosition",value:function(t){var i=this.unprojectFlat(t),r=(0,pr.Z)(i,2),o=r[0],u=r[1],p=(t[2]||0)/this.pixelsPerMeter;return[o,u,p]}},{key:"projectFlat",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}}]),e}();function j3(e){var a=e.width,t=e.height,i=e.bounds,r=e.minExtent,o=r===void 0?0:r,u=e.maxZoom,p=u===void 0?24:u,v=e.padding,g=v===void 0?0:v,E=e.offset,T=E===void 0?[0,0]:E,O=(0,pr.Z)(i,2),F=(0,pr.Z)(O[0],2),U=F[0],j=F[1],K=(0,pr.Z)(O[1],2),ae=K[0],ve=K[1];if(Number.isFinite(g)){var ke=g;g={top:ke,bottom:ke,left:ke,right:ke}}else ov(Number.isFinite(g.top)&&Number.isFinite(g.bottom)&&Number.isFinite(g.left)&&Number.isFinite(g.right));var qe=new t2({width:a,height:t,longitude:0,latitude:0,zoom:0}),ct=qe.project([U,ve]),_t=qe.project([ae,j]),Ot=[Math.max(Math.abs(_t[0]-ct[0]),o),Math.max(Math.abs(_t[1]-ct[1]),o)],Xt=[a-g.left-g.right-Math.abs(T[0])*2,t-g.top-g.bottom-Math.abs(T[1])*2];ov(Xt[0]>0&&Xt[1]>0);var yr=Xt[0]/Ot[0],Pr=Xt[1]/Ot[1],xr=(g.right-g.left)/2/yr,An=(g.bottom-g.top)/2/Pr,ii=[(_t[0]+ct[0])/2+xr,(_t[1]+ct[1])/2+An],sa=qe.unproject(ii),Io=qe.zoom+Math.log2(Math.abs(Math.min(yr,Pr)));return{longitude:sa[0],latitude:sa[1],zoom:Math.min(Io,p)}}var t2=function(e){(0,mr.Z)(a,e);function a(){var t,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,o=i.height,u=i.latitude,p=u===void 0?0:u,v=i.longitude,g=v===void 0?0:v,E=i.zoom,T=E===void 0?0:E,O=i.pitch,F=O===void 0?0:O,U=i.bearing,j=U===void 0?0:U,K=i.altitude,ae=K===void 0?1.5:K,ve=i.nearZMultiplier,ke=i.farZMultiplier;(0,xt.Z)(this,a),r=r||1,o=o||1;var qe=Kb(T);ae=Math.max(.75,ae);var ct=Pg([g,p],qe);ct[2]=0;var _t=U3({width:r,height:o,pitch:F,bearing:j,altitude:ae,nearZMultiplier:ve||1/o,farZMultiplier:ke||1.01}),Ot=N3({height:o,center:ct,pitch:F,bearing:j,altitude:ae,flipY:!0});return t=(0,lr.Z)(this,(0,nt.Z)(a).call(this,{width:r,height:o,viewMatrix:Ot,projectionMatrix:_t})),t.latitude=p,t.longitude=g,t.zoom=T,t.pitch=F,t.bearing=j,t.altitude=ae,t.scale=qe,t.center=ct,t.pixelsPerMeter=Qb((0,dt.Z)((0,dt.Z)(t))).pixelsPerMeter[2],Object.freeze((0,dt.Z)((0,dt.Z)(t))),t}return(0,St.Z)(a,[{key:"projectFlat",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Pg(i,r)}},{key:"unprojectFlat",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Zy(i,r)}},{key:"getMapCenterByLngLatPosition",value:function(i){var r=i.lngLat,o=i.pos,u=Jb(o,this.pixelUnprojectionMatrix),p=Pg(r,this.scale),v=Ur.IH([],p,Ur.tk([],u)),g=Ur.IH([],this.center,v);return Zy(g,this.scale)}},{key:"getLocationAtPoint",value:function(i){var r=i.lngLat,o=i.pos;return this.getMapCenterByLngLatPosition({lngLat:r,pos:o})}},{key:"fitBounds",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,u=this.height,p=j3(Object.assign({width:o,height:u,bounds:i},r)),v=p.longitude,g=p.latitude,E=p.zoom;return new a({width:o,height:u,longitude:v,latitude:g,zoom:E})}}]),a}(V3),G3=function(){function e(){(0,xt.Z)(this,e)}return(0,St.Z)(e,[{key:"syncWithMapCamera",value:function(t){var i=t.center,r=t.zoom,o=t.pitch,u=t.bearing,p=t.viewportHeight,v=t.viewportWidth;this.viewport=new t2({width:v,height:p,longitude:i&&i[0],latitude:i&&i[1],zoom:r,pitch:o,bearing:u})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,i){return this.viewport.projectFlat(t,i)}}]),e}(),H3=function(){function e(a){(0,xt.Z)(this,e),(0,ee.Z)(this,"size",1e4),this.size=a||1e4}return(0,St.Z)(e,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var i=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90}},{key:"project",value:function(t){var i=this.mercatorXfromLng(t[0]),r=this.mercatorYfromLat(t[1]);return[i,r]}},{key:"unproject",value:function(t){var i=this.lngFromMercatorX(t[0]),r=this.latFromMercatorY(t[1]);return[i,r]}}]),e}(),r2={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},W3=["id","attributionControl","style","token","rotation","mapInstance"],n2,i2,a2,o2,s2,u2,Vv,l2,c2,f2,h2;function X3(e,a){var t=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(t||i)&&(a||(a=document),!!a)){var r=a.head||a.getElementsByTagName("head")[0];if(!r){r=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):a.documentElement.appendChild(r)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),r.appendChild(u),u}}X3(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Lm();var p2={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},Y3=0,q3=12,d2="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",$3=(n2=(0,vr.b2)(),i2=(0,vr.f3)(At.MapConfig),a2=(0,vr.f3)(At.IGlobalConfigService),o2=(0,vr.f3)(At.ICoordinateSystemService),s2=(0,vr.f3)(At.IEventEmitter),n2(u2=(Vv=function(){function e(){var a=this;(0,xt.Z)(this,e),(0,ee.Z)(this,"version",ju.MAPBOX),(0,ee.Z)(this,"simpleMapCoord",new H3),(0,ee.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),(0,da.Z)(this,"config",l2,this),(0,da.Z)(this,"configService",c2,this),(0,da.Z)(this,"coordinateSystemService",f2,this),(0,da.Z)(this,"eventEmitter",h2,this),(0,ee.Z)(this,"handleCameraChanged",function(){var t=a.map.getCenter().wrap(),i=t.lat,r=t.lng;a.emit("mapchange"),a.viewport.syncWithMapCamera({bearing:a.map.getBearing(),center:[r,i],viewportHeight:a.map.transform.height,pitch:a.map.getPitch(),viewportWidth:a.map.transform.width,zoom:a.map.getZoom(),cameraHeight:0});var o=a.config.offsetZoom,u=o===void 0?q3:o;a.viewport.getZoom()>u?a.coordinateSystemService.setCoordinateSystem(qu.LNGLAT_OFFSET):a.coordinateSystemService.setCoordinateSystem(qu.LNGLAT),a.cameraChangedCallback(a.viewport)})}return(0,St.Z)(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=ka("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,i){ME.indexOf(t)!==-1?this.eventEmitter.on(t,i):this.map.on(p2[t]||t,i)}},{key:"off",value:function(t,i){this.map.off(p2[t]||t,i),this.eventEmitter.off(t,i)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,i){this.map.zoomIn(t,i)}},{key:"zoomOut",value:function(t,i){this.map.zoomOut(t,i)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(t,i){this.panTo([t,i])}},{key:"fitBounds",value:function(t,i){this.map.fitBounds(t,i)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.rotateEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,i){this.map.flyTo({zoom:t,center:i})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyle(t))}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"lngLatToCoord",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},r=this.lngLatToMercator(t,0),o=r.x,u=r.y;return[o-i.x,u-i.y]}},{key:"lngLatToMercator",value:function(t,i){var r=window.mapboxgl.MercatorCoordinate.fromLngLat(t,i),o=r.x,u=o===void 0?0:o,p=r.y,v=p===void 0?0:p,g=r.z,E=g===void 0?0:g;return{x:u,y:v,z:E}}},{key:"getModelMatrix",value:function(t,i,r){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},p=window.mapboxgl.MercatorCoordinate.fromLngLat(t,i),v=p.meterInMercatorCoordinateUnits(),g=Ra.create();return Ra.translate(g,g,ts.fromValues(p.x-u.x,p.y-u.y,p.z||0-u.z)),Ra.scale(g,g,ts.fromValues(v*o[0],-v*o[1],v*o[2])),Ra.rotateX(g,g,r[0]),Ra.rotateY(g,g,r[1]),Ra.rotateZ(g,g,r[2]),g}},{key:"init",value:function(){var a=(0,Sa.Z)(zn().mark(function i(){var r,o,u,p,v,g,E,T,O,F,U,j,K;return zn().wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:r=this.config,o=r.id,u=o===void 0?"map":o,p=r.attributionControl,v=p===void 0?!1:p,g=r.style,E=g===void 0?"light":g,T=r.token,O=T===void 0?d2:T,F=r.rotation,U=F===void 0?0:F,j=r.mapInstance,K=(0,yp.Z)(r,W3),this.viewport=new G3,!j&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),O===d2&&E!=="blank"&&!window.mapboxgl.accessToken&&!j&&console.warn(this.configService.getSceneWarninfo("MapToken")),!j&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=O),j?(this.map=j,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(u),this.map=new window.mapboxgl.Map((0,Z.Z)({container:this.$mapContainer,style:this.getMapStyle(E),attributionControl:v,bearing:U},K))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return ve.stop()}},i,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,i;(t=this.$mapContainer)===null||t===void 0||(i=t.parentNode)===null||i===void 0||i.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var i,r=arguments.length,o=new Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];(i=this.eventEmitter).emit.apply(i,[t].concat(o))}},{key:"once",value:function(t){for(var i,r=arguments.length,o=new Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];(i=this.eventEmitter).once.apply(i,[t].concat(o))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,i){var r=new(Lm()).LngLat(t[0],t[1]),o=new(Lm()).LngLat(i[0],i[1]),u=r.distanceTo(o),p=Lm().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),v=Lm().MercatorCoordinate.fromLngLat({lng:i[0],lat:i[1]}),g=p.x,E=p.y,T=v.x,O=v.y,F=Math.sqrt(Math.pow(g-T,2)+Math.pow(E-O,2))*4194304*2;return F/u}},{key:"exportMap",value:function(t){var i=this.map.getCanvas(),r=t==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png");return r}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatAmapContainer",value:function(t){var i=t;typeof t=="string"&&(i=document.getElementById(t));var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,r.id="l7_mapbox_div"+Y3++,i.appendChild(r),r}},{key:"getMapStyle",value:function(t){return typeof t!="string"?t:r2[t]?r2[t]:t}}]),e}(),l2=(0,ca.Z)(Vv.prototype,"config",[i2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c2=(0,ca.Z)(Vv.prototype,"configService",[a2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f2=(0,ca.Z)(Vv.prototype,"coordinateSystemService",[o2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h2=(0,ca.Z)(Vv.prototype,"eventEmitter",[s2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vv))||u2);function K3(e){var a=Q3();return function(){var i=(0,nt.Z)(e),r;if(a){var o=(0,nt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,lr.Z)(this,r)}}function Q3(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function J3(e,a){var t=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(t||i)&&(a||(a=document),!!a)){var r=a.head||a.getElementsByTagName("head")[0];if(!r){r=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):a.documentElement.appendChild(r)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),r.appendChild(u),u}}J3(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var ek=function(e){(0,mr.Z)(t,e);var a=K3(t);function t(){return(0,xt.Z)(this,t),a.apply(this,arguments)}return(0,St.Z)(t,[{key:"getServiceConstructor",value:function(){return $3}}]),t}(O3);function v2(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,i)}return t}function m2(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?v2(Object(t),!0).forEach(function(i){tk(e,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):v2(Object(t)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})}return e}function tk(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function rk(e,a){return ok(e)||ak(e,a)||ik(e,a)||nk()}function nk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ik(e,a){if(!!e){if(typeof e=="string")return g2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return g2(e,a)}}function g2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function ak(e,a){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function ok(e){if(Array.isArray(e))return e}var sk=rr.memo(function(e){var a=e.style,t=e.className,i=e.map,r=e.option,o=e.onSceneLoaded,u=(0,rr.createRef)(),p=(0,rr.useState)(),v=rk(p,2),g=v[0],E=v[1];return(0,rr.useEffect)(function(){var T=new M3(m2(m2({id:u.current},r),{},{map:new ek(i)}));return T.on("loaded",function(){E(T),o&&o(T)}),function(){T.destroy()}},[]),(0,rr.useEffect)(function(){g&&i.style&&g.setMapStyle(i.style)},[JSON.stringify(i.style)]),(0,rr.useEffect)(function(){g&&i.zoom&&g.setZoom(i.zoom)},[i.zoom]),(0,rr.useEffect)(function(){g&&i.center&&g.setCenter(i.center)},[JSON.stringify(i.center)]),(0,rr.useEffect)(function(){g&&i.pitch!==void 0&&g.setPitch(i.pitch||0)},[i.pitch]),(0,rr.useEffect)(function(){g&&i.rotation&&g.setRotation(i.rotation)},[i.rotation]),rr.createElement(Ft.Provider,{value:g},(0,rr.createElement)("div",{ref:u,style:a,className:t},g&&e.children))}),uk=sk;function y2(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,i)}return t}function PP(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?y2(Object(t),!0).forEach(function(i){lk(e,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):y2(Object(t)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})}return e}function lk(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function LP(e,a){return pk(e)||hk(e,a)||fk(e,a)||ck()}function ck(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fk(e,a){if(!!e){if(typeof e=="string")return _2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _2(e,a)}}function _2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function hk(e,a){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function pk(e){if(Array.isArray(e))return e}var RP=null,OP=null;function x2(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,i)}return t}function FP(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?x2(Object(t),!0).forEach(function(i){dk(e,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):x2(Object(t)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})}return e}function dk(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function DP(e,a){return yk(e)||gk(e,a)||mk(e,a)||vk()}function vk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mk(e,a){if(!!e){if(typeof e=="string")return b2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return b2(e,a)}}function b2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function gk(e,a){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function yk(e){if(Array.isArray(e))return e}var BP=null,NP=null;function zP(e,a){return Ek(e)||bk(e,a)||xk(e,a)||_k()}function _k(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xk(e,a){if(!!e){if(typeof e=="string")return E2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return E2(e,a)}}function E2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function bk(e,a){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function Ek(e){if(Array.isArray(e))return e}var UP=null,ZP=null;function C2(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,i)}return t}function VP(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?C2(Object(t),!0).forEach(function(i){Ck(e,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):C2(Object(t)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})}return e}function Ck(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function jP(e,a){if(e==null)return{};var t=Sk(e,a),i,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)i=o[r],!(a.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,i)||(t[i]=e[i]))}return t}function Sk(e,a){if(e==null)return{};var t={},i=Object.keys(e),r,o;for(o=0;o<i.length;o++)r=i[o],!(a.indexOf(r)>=0)&&(t[r]=e[r]);return t}var GP=null,S2=vt(73935);function w2(e,a){return Mk(e)||Tk(e,a)||Ak(e,a)||wk()}function wk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ak(e,a){if(!!e){if(typeof e=="string")return A2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return A2(e,a)}}function A2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function Tk(e,a){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function Mk(e){if(Array.isArray(e))return e}var T2=rr.useEffect,M2=rr.useState,kk=/\B([A-Z])/g,Ik=function(a){return a.replace(kk,"-$1").toLowerCase()};function HP(e){var a=e.className,t=e.style,i=e.children,r=e.position,o=M2(),u=w2(o,2),p=u[0],v=u[1],g=useSceneValue(),E=M2(function(){return document.createElement("div")}),T=w2(E,1),O=T[0];return T2(function(){var F=new Control({position:r});return F.onAdd=function(){if(a&&(O.className=a),t){var U=Object.keys(t).map(function(j){return"".concat(Ik(j),":").concat(t[j])}).join(";");O.style.cssText=U}return O},F.onRemove=function(){},v(F),g.addControl(F),function(){g.removeControl(F)}},[]),T2(function(){p&&p.setPosition(r||"bottomleft")},[r]),createPortal(i,O)}var k2=(0,rr.createContext)({});function WP(){return useContext(k2)}var XP=rr.useEffect,Pk=rr.memo(function(a){var t=a.layer,i=a.active;return t.active(i.option),null},Br.isEqual),YP=rr.useEffect,Lk=rr.memo(function(a){var t=a.layer,i=a.animate;return t.animate(i),null},Br.isEqual),qP=rr.useEffect,Rk=rr.memo(function(a){var t=a.layer,i=a.color;return i.field?t.color(i.field,i.values):t.color(i.values),null},Br.isEqual),Ok=rr.memo(function(a){var t=a.layer,i=a.filter;return i.field&&t.filter(i.field,i.values),null},Br.isEqual),Fk=rr.memo(function(a){var t=a.layer,i=a.scale;return t.scale(i.values),null},Br.isEqual),$P=rr.useEffect,Dk=rr.memo(function(a){var t=a.layer,i=a.select;return t.select(i.option),null},Br.isEqual),Bk=rr.memo(function(a){var t=a.layer,i=a.shape;return i.field?t.shape(i.field,i.values):t.shape(i.values),null},Br.isEqual),Nk=rr.memo(function(a){var t=a.layer,i=a.size;return i.field?t.size(i.field,i.values):t.size(i.values),null},Br.isEqual),zk=["data"];function Uk(e,a){if(e==null)return{};var t=Zk(e,a),i,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)i=o[r],!(a.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,i)||(t[i]=e[i]))}return t}function Zk(e,a){if(e==null)return{};var t={},i=Object.keys(e),r,o;for(o=0;o<i.length;o++)r=i[o],!(a.indexOf(r)>=0)&&(t[r]=e[r]);return t}var Vk=rr.memo(function(a){var t=a.layer,i=a.source,r=i.data,o=Uk(i,zk);return t.inited?t.setData(r,o):t.source(r,o),o.autoFit&&t.fitBounds(o&&o.fitBoundsOptions),null},Br.isEqual),KP=rr.useEffect,jk=rr.memo(function(a){var t=a.layer,i=a.style;return t.style(i),null},Br.isEqual);function Gk(e,a){return Yk(e)||Xk(e,a)||Wk(e,a)||Hk()}function Hk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Wk(e,a){if(!!e){if(typeof e=="string")return I2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return I2(e,a)}}function I2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function Xk(e,a){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function Yk(e){if(Array.isArray(e))return e}var Om=rr.useEffect,qk=rr.useState;function P2(e,a){var t=a.source,i=a.color,r=a.shape,o=a.style,u=a.size,p=a.scale,v=a.active,g=a.select,E=a.filter,T=a.animate,O=a.options,F=a.onLayerLoaded,U=x(),j=qk(function(){var ve;switch(e){case"polygonLayer":ve=new kx(O);break;case"lineLayer":ve=new iT(O);break;case"pointLayer":ve=new t5(O);break;case"heatmapLayer":ve=new sS(O);break;case"rasterLayer":ve=new D5(O);break;case"imageLayer":ve=new j_(O);break;case"citybuildingLayer":ve=new LC(O);break;default:ve=new kx(O)}return ve.on("inited",function(){F&&F(ve,U)}),ve}),K=Gk(j,1),ae=K[0];return Om(function(){return U.addLayer(ae),function(){U.removeLayer(ae)}},[]),Om(function(){ae.inited&&O&&ae.updateLayerConfig(O)},[O==null?void 0:O.minZoom,O==null?void 0:O.maxZoom,O==null?void 0:O.visible]),Om(function(){ae.inited&&(O==null?void 0:O.zIndex)&&ae.setIndex(O.zIndex)},[O==null?void 0:O.zIndex]),Om(function(){ae.inited&&(O==null?void 0:O.blend)&&ae.setBlend(O.blend)},[O==null?void 0:O.blend]),Om(function(){U.render()}),rr.createElement(k2.Provider,{value:ae},rr.createElement(Vk,{layer:ae,source:t}),p&&rr.createElement(Fk,{layer:ae,scale:p}),i&&rr.createElement(Rk,{layer:ae,color:i}),u&&rr.createElement(Nk,{layer:ae,size:u}),r&&rr.createElement(Bk,{layer:ae,shape:r}),o&&rr.createElement(jk,{layer:ae,style:o}),v&&rr.createElement(Pk,{layer:ae,active:v}),g&&rr.createElement(Dk,{layer:ae,select:g}),E&&rr.createElement(Ok,{layer:ae,filter:E}),T&&rr.createElement(Lk,{layer:ae,animate:T}),a.children)}var QP=null,JP=null,$k=rr.memo(function(a){return P2("pointLayer",a)}),Kk=rr.memo(function(a){return P2("heatmapLayer",a)}),eL=null,tL=null,rL=null,nL=rr.useEffect,iL=null,aL=null;function Lg(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Lg=function(t){return typeof t}:Lg=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lg(e)}function L2(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,i)}return t}function Rg(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?L2(Object(t),!0).forEach(function(i){Qk(e,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):L2(Object(t)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})}return e}function Qk(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function Jk(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function R2(e,a){for(var t=0;t<a.length;t++){var i=a[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function eI(e,a,t){return a&&R2(e.prototype,a),t&&R2(e,t),e}function tI(e,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),a&&Vy(e,a)}function Vy(e,a){return Vy=Object.setPrototypeOf||function(i,r){return i.__proto__=r,i},Vy(e,a)}function rI(e){var a=aI();return function(){var i=Og(e),r;if(a){var o=Og(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return nI(this,r)}}function nI(e,a){if(a&&(Lg(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return iI(e)}function iI(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function aI(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Og(e){return Og=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Og(e)}var oL=function(e){tI(t,e);var a=rI(t);function t(i){var r;return Jk(this,t),r=a.call(this,i),r.el=void 0,r.scene=void 0,r.popup=void 0,r.el=document.createElement("div"),r}return eI(t,[{key:"componentDidMount",value:function(){var r,o=this.props,u=o.lnglat,p=o.children,v=o.option,g=o.lngLat,E=new m_(Rg(Rg({},v),{},{stopPropagation:(r=this.props.option)===null||r===void 0?void 0:r.stopPropagation}));u&&E.setLnglat(u),g&&E.setLnglat(g),p&&E.setDOMContent(this.el),this.popup=E,this.scene.addPopup(E)}},{key:"componentDidUpdate",value:function(r){var o,u,p,v,g,E,T=Array.isArray(r.lnglat)?r.lnglat:[r==null||(o=r.lnglat)===null||o===void 0?void 0:o.lng,r==null||(u=r.lnglat)===null||u===void 0?void 0:u.lat],O=Array.isArray(this.props.lnglat)?this.props.lnglat:[(p=this.props)===null||p===void 0||(v=p.lnglat)===null||v===void 0?void 0:v.lng,(g=this.props)===null||g===void 0||(E=g.lnglat)===null||E===void 0?void 0:E.lat],F=T.toString()!==O.toString();if(F){var U;this.popup.remove(),this.popup=new m_(Rg(Rg({},this.props.option),{},{stopPropagation:(U=this.props.option)===null||U===void 0?void 0:U.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var r=this;return rr.createElement(Ft.Consumer,{},function(o){return o&&(r.scene=o),(0,S2.createPortal)(r.props.children,r.el)})}}]),t}(rr.PureComponent);function Fg(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Fg=function(t){return typeof t}:Fg=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fg(e)}function oI(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function O2(e,a){for(var t=0;t<a.length;t++){var i=a[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function sI(e,a,t){return a&&O2(e.prototype,a),t&&O2(e,t),e}function uI(e,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),a&&jy(e,a)}function jy(e,a){return jy=Object.setPrototypeOf||function(i,r){return i.__proto__=r,i},jy(e,a)}function lI(e){var a=hI();return function(){var i=Dg(e),r;if(a){var o=Dg(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return cI(this,r)}}function cI(e,a){if(a&&(Fg(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return fI(e)}function fI(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hI(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Dg(e){return Dg=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Dg(e)}var sL=function(e){uI(t,e);var a=lI(t);function t(i){var r;return oI(this,t),r=a.call(this,i),r.el=void 0,r.scene=void 0,r.marker=void 0,r.el=document.createElement("div"),r}return sI(t,[{key:"componentDidMount",value:function(){var r=this.props,o=r.lnglat,u=r.children,p=r.option,v=r.onMarkerLoaded,g=new v_(p);o&&g.setLnglat(o),u&&g.setElement(this.el),this.marker=g,v&&v(g),this.scene.addMarker(g)}},{key:"componentDidUpdate",value:function(r){var o,u=(r==null?void 0:r.lnglat.toString())!==((o=this.props)===null||o===void 0?void 0:o.lnglat.toString());u&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var r=this;return rr.createElement(Ft.Consumer,{},function(o){return o&&(r.scene=o),(0,S2.createPortal)(r.props.children,r.el)})}}]),t}(rr.PureComponent),uL=rr.useEffect,lL=null,cL=null,fL=rr.useEffect,hL=null},75174:function(Ja,ji,vt){var rr=function(Ft){"use strict";function x(y,w){var M=Object.keys(y);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(y);w&&(R=R.filter(function(B){return Object.getOwnPropertyDescriptor(y,B).enumerable})),M.push.apply(M,R)}return M}function Jr(){Jr=function(){return y};var y={},w=Object.prototype,M=w.hasOwnProperty,R=typeof Symbol=="function"?Symbol:{},B=R.iterator||"@@iterator",Q=R.asyncIterator||"@@asyncIterator",ue=R.toStringTag||"@@toStringTag";function oe(Nr,Wr,ki){return Object.defineProperty(Nr,Wr,{value:ki,enumerable:!0,configurable:!0,writable:!0}),Nr[Wr]}try{oe({},"")}catch{oe=function(Wr,ki,ja){return Wr[ki]=ja}}function Ae(Nr,Wr,ki,ja){var ha=Wr&&Wr.prototype instanceof Dt?Wr:Dt,Qu=Object.create(ha.prototype),Nl=new Va(ja||[]);return Qu._invoke=function(ds,zl,Ss){var Fh="suspendedStart";return function(bp,Zu){if(Fh==="executing")throw new Error("Generator is already running");if(Fh==="completed"){if(bp==="throw")throw Zu;return Qa()}for(Ss.method=bp,Ss.arg=Zu;;){var vs=Ss.delegate;if(vs){var rc=di(vs,Ss);if(rc){if(rc===Le)continue;return rc}}if(Ss.method==="next")Ss.sent=Ss._sent=Ss.arg;else if(Ss.method==="throw"){if(Fh==="suspendedStart")throw Fh="completed",Ss.arg;Ss.dispatchException(Ss.arg)}else Ss.method==="return"&&Ss.abrupt("return",Ss.arg);Fh="executing";var Vu=Oe(ds,zl,Ss);if(Vu.type==="normal"){if(Fh=Ss.done?"completed":"suspendedYield",Vu.arg===Le)continue;return{value:Vu.arg,done:Ss.done}}Vu.type==="throw"&&(Fh="completed",Ss.method="throw",Ss.arg=Vu.arg)}}}(Nr,ki,Nl),Qu}function Oe(Nr,Wr,ki){try{return{type:"normal",arg:Nr.call(Wr,ki)}}catch(ja){return{type:"throw",arg:ja}}}y.wrap=Ae;var Le={};function Dt(){}function tr(){}function gr(){}var Fr={};oe(Fr,B,function(){return this});var Qr=Object.getPrototypeOf,hn=Qr&&Qr(Qr(Xa([])));hn&&hn!==w&&M.call(hn,B)&&(Fr=hn);var wn=gr.prototype=Dt.prototype=Object.create(Fr);function nn(Nr){["next","throw","return"].forEach(function(Wr){oe(Nr,Wr,function(ki){return this._invoke(Wr,ki)})})}function Hn(Nr,Wr){var ki;this._invoke=function(ja,ha){function Qu(){return new Wr(function(Nl,ds){(function zl(Ss,Fh,bp,Zu){var vs=Oe(Nr[Ss],Nr,Fh);if(vs.type!=="throw"){var rc=vs.arg,Vu=rc.value;return Vu&&typeof Vu=="object"&&M.call(Vu,"__await")?Wr.resolve(Vu.__await).then(function(nc){zl("next",nc,bp,Zu)},function(nc){zl("throw",nc,bp,Zu)}):Wr.resolve(Vu).then(function(nc){rc.value=nc,bp(rc)},function(nc){return zl("throw",nc,bp,Zu)})}Zu(vs.arg)})(ja,ha,Nl,ds)})}return ki=ki?ki.then(Qu,Qu):Qu()}}function di(Nr,Wr){var ki=Nr.iterator[Wr.method];if(ki===void 0){if(Wr.delegate=null,Wr.method==="throw"){if(Nr.iterator.return&&(Wr.method="return",Wr.arg=void 0,di(Nr,Wr),Wr.method==="throw"))return Le;Wr.method="throw",Wr.arg=new TypeError("The iterator does not provide a 'throw' method")}return Le}var ja=Oe(ki,Nr.iterator,Wr.arg);if(ja.type==="throw")return Wr.method="throw",Wr.arg=ja.arg,Wr.delegate=null,Le;var ha=ja.arg;return ha?ha.done?(Wr[Nr.resultName]=ha.value,Wr.next=Nr.nextLoc,Wr.method!=="return"&&(Wr.method="next",Wr.arg=void 0),Wr.delegate=null,Le):ha:(Wr.method="throw",Wr.arg=new TypeError("iterator result is not an object"),Wr.delegate=null,Le)}function yo(Nr){var Wr={tryLoc:Nr[0]};1 in Nr&&(Wr.catchLoc=Nr[1]),2 in Nr&&(Wr.finallyLoc=Nr[2],Wr.afterLoc=Nr[3]),this.tryEntries.push(Wr)}function Ka(Nr){var Wr=Nr.completion||{};Wr.type="normal",delete Wr.arg,Nr.completion=Wr}function Va(Nr){this.tryEntries=[{tryLoc:"root"}],Nr.forEach(yo,this),this.reset(!0)}function Xa(Nr){if(Nr){var Wr=Nr[B];if(Wr)return Wr.call(Nr);if(typeof Nr.next=="function")return Nr;if(!isNaN(Nr.length)){var ki=-1,ja=function ha(){for(;++ki<Nr.length;)if(M.call(Nr,ki))return ha.value=Nr[ki],ha.done=!1,ha;return ha.value=void 0,ha.done=!0,ha};return ja.next=ja}}return{next:Qa}}function Qa(){return{value:void 0,done:!0}}return tr.prototype=gr,oe(wn,"constructor",gr),oe(gr,"constructor",tr),tr.displayName=oe(gr,ue,"GeneratorFunction"),y.isGeneratorFunction=function(Nr){var Wr=typeof Nr=="function"&&Nr.constructor;return!!Wr&&(Wr===tr||(Wr.displayName||Wr.name)==="GeneratorFunction")},y.mark=function(Nr){return Object.setPrototypeOf?Object.setPrototypeOf(Nr,gr):(Nr.__proto__=gr,oe(Nr,ue,"GeneratorFunction")),Nr.prototype=Object.create(wn),Nr},y.awrap=function(Nr){return{__await:Nr}},nn(Hn.prototype),oe(Hn.prototype,Q,function(){return this}),y.AsyncIterator=Hn,y.async=function(Nr,Wr,ki,ja,ha){ha===void 0&&(ha=Promise);var Qu=new Hn(Ae(Nr,Wr,ki,ja),ha);return y.isGeneratorFunction(Wr)?Qu:Qu.next().then(function(Nl){return Nl.done?Nl.value:Qu.next()})},nn(wn),oe(wn,ue,"Generator"),oe(wn,B,function(){return this}),oe(wn,"toString",function(){return"[object Generator]"}),y.keys=function(Nr){var Wr=[];for(var ki in Nr)Wr.push(ki);return Wr.reverse(),function ja(){for(;Wr.length;){var ha=Wr.pop();if(ha in Nr)return ja.value=ha,ja.done=!1,ja}return ja.done=!0,ja}},y.values=Xa,Va.prototype={constructor:Va,reset:function(Nr){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(Ka),!Nr)for(var Wr in this)Wr.charAt(0)==="t"&&M.call(this,Wr)&&!isNaN(+Wr.slice(1))&&(this[Wr]=void 0)},stop:function(){this.done=!0;var Nr=this.tryEntries[0].completion;if(Nr.type==="throw")throw Nr.arg;return this.rval},dispatchException:function(Nr){if(this.done)throw Nr;var Wr=this;function ki(zl,Ss){return Qu.type="throw",Qu.arg=Nr,Wr.next=zl,Ss&&(Wr.method="next",Wr.arg=void 0),!!Ss}for(var ja=this.tryEntries.length-1;ja>=0;--ja){var ha=this.tryEntries[ja],Qu=ha.completion;if(ha.tryLoc==="root")return ki("end");if(ha.tryLoc<=this.prev){var Nl=M.call(ha,"catchLoc"),ds=M.call(ha,"finallyLoc");if(Nl&&ds){if(this.prev<ha.catchLoc)return ki(ha.catchLoc,!0);if(this.prev<ha.finallyLoc)return ki(ha.finallyLoc)}else if(Nl){if(this.prev<ha.catchLoc)return ki(ha.catchLoc,!0)}else{if(!ds)throw new Error("try statement without catch or finally");if(this.prev<ha.finallyLoc)return ki(ha.finallyLoc)}}}},abrupt:function(Nr,Wr){for(var ki=this.tryEntries.length-1;ki>=0;--ki){var ja=this.tryEntries[ki];if(ja.tryLoc<=this.prev&&M.call(ja,"finallyLoc")&&this.prev<ja.finallyLoc){var ha=ja;break}}ha&&(Nr==="break"||Nr==="continue")&&ha.tryLoc<=Wr&&Wr<=ha.finallyLoc&&(ha=null);var Qu=ha?ha.completion:{};return Qu.type=Nr,Qu.arg=Wr,ha?(this.method="next",this.next=ha.finallyLoc,Le):this.complete(Qu)},complete:function(Nr,Wr){if(Nr.type==="throw")throw Nr.arg;return Nr.type==="break"||Nr.type==="continue"?this.next=Nr.arg:Nr.type==="return"?(this.rval=this.arg=Nr.arg,this.method="return",this.next="end"):Nr.type==="normal"&&Wr&&(this.next=Wr),Le},finish:function(Nr){for(var Wr=this.tryEntries.length-1;Wr>=0;--Wr){var ki=this.tryEntries[Wr];if(ki.finallyLoc===Nr)return this.complete(ki.completion,ki.afterLoc),Ka(ki),Le}},catch:function(Nr){for(var Wr=this.tryEntries.length-1;Wr>=0;--Wr){var ki=this.tryEntries[Wr];if(ki.tryLoc===Nr){var ja=ki.completion;if(ja.type==="throw"){var ha=ja.arg;Ka(ki)}return ha}}throw new Error("illegal catch attempt")},delegateYield:function(Nr,Wr,ki){return this.delegate={iterator:Xa(Nr),resultName:Wr,nextLoc:ki},this.method==="next"&&(this.arg=void 0),Le}},y}function tt(y,w,M,R,B,Q,ue){try{var oe=y[Q](ue),Ae=oe.value}catch(Oe){return void M(Oe)}oe.done?w(Ae):Promise.resolve(Ae).then(R,B)}function Tr(y){return function(){var w=this,M=arguments;return new Promise(function(R,B){var Q=y.apply(w,M);function ue(Ae){tt(Q,R,B,ue,oe,"next",Ae)}function oe(Ae){tt(Q,R,B,ue,oe,"throw",Ae)}ue(void 0)})}}function rt(y,w){if(!(y instanceof w))throw new TypeError("Cannot call a class as a function")}function fr(y,w){for(var M=0;M<w.length;M++){var R=w[M];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(y,R.key,R)}}function Xe(y,w,M){return w&&fr(y.prototype,w),M&&fr(y,M),Object.defineProperty(y,"prototype",{writable:!1}),y}function Kt(y,w,M){return w in y?Object.defineProperty(y,w,{value:M,enumerable:!0,configurable:!0,writable:!0}):y[w]=M,y}function hr(y,w){if(typeof w!="function"&&w!==null)throw new TypeError("Super expression must either be null or a function");y.prototype=Object.create(w&&w.prototype,{constructor:{value:y,writable:!0,configurable:!0}}),Object.defineProperty(y,"prototype",{writable:!1}),w&&ar(y,w)}function jt(y){return(jt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(w){return w.__proto__||Object.getPrototypeOf(w)})(y)}function ar(y,w){return(ar=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(M,R){return M.__proto__=R,M})(y,w)}function ur(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}function Ir(y,w){if(w&&(typeof w=="object"||typeof w=="function"))return w;if(w!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ur(y)}function Kn(y){var w=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var M,R=jt(y);if(w){var B=jt(this).constructor;M=Reflect.construct(R,arguments,B)}else M=R.apply(this,arguments);return Ir(this,M)}}function On(y,w){return function(M){if(Array.isArray(M))return M}(y)||function(M,R){var B=M==null?null:typeof Symbol<"u"&&M[Symbol.iterator]||M["@@iterator"];if(B!=null){var Q,ue,oe=[],Ae=!0,Oe=!1;try{for(B=B.call(M);!(Ae=(Q=B.next()).done)&&(oe.push(Q.value),!R||oe.length!==R);Ae=!0);}catch(Le){Oe=!0,ue=Le}finally{try{Ae||B.return==null||B.return()}finally{if(Oe)throw ue}}return oe}}(y,w)||Pi(y,w)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function an(y){return function(w){if(Array.isArray(w))return ri(w)}(y)||function(w){if(typeof Symbol<"u"&&w[Symbol.iterator]!=null||w["@@iterator"]!=null)return Array.from(w)}(y)||Pi(y)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Pi(y,w){if(y){if(typeof y=="string")return ri(y,w);var M=Object.prototype.toString.call(y).slice(8,-1);return M==="Object"&&y.constructor&&(M=y.constructor.name),M==="Map"||M==="Set"?Array.from(y):M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M)?ri(y,w):void 0}}function ri(y,w){(w==null||w>y.length)&&(w=y.length);for(var M=0,R=new Array(w);M<w;M++)R[M]=y[M];return R}var me=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof vt.g<"u"?vt.g:typeof self<"u"?self:{};function _i(y,w){return y(w={exports:{}},w.exports),w.exports}var Rr,ir,zr=function(y){return y&&y.Math==Math&&y},st=zr(typeof globalThis=="object"&&globalThis)||zr(typeof window=="object"&&window)||zr(typeof self=="object"&&self)||zr(typeof me=="object"&&me)||function(){return this}()||Function("return this")(),en=Object.defineProperty,Wn=function(y,w){try{en(st,y,{value:w,configurable:!0,writable:!0})}catch{st[y]=w}return w},ce=st["__core-js_shared__"]||Wn("__core-js_shared__",{}),Ee=_i(function(y){(y.exports=function(w,M){return ce[w]||(ce[w]=M!==void 0?M:{})})("versions",[]).push({version:"3.24.1",mode:"global",copyright:"\xA9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.24.1/LICENSE",source:"https://github.com/zloirock/core-js"})}),Z=function(y){try{return!!y()}catch{return!0}},Ze=!Z(function(){var y=function(){}.bind();return typeof y!="function"||y.hasOwnProperty("prototype")}),Pe=Function.prototype,ft=Pe.bind,It=Pe.call,qt=Ze&&ft.bind(It,It),yt=Ze?function(y){return y&&qt(y)}:function(y){return y&&function(){return It.apply(y,arguments)}},cr=TypeError,Xn=function(y){if(y==null)throw cr("Can't call method on "+y);return y},Vn=Object,Gi=function(y){return Vn(Xn(y))},ai=yt({}.hasOwnProperty),Rn=Object.hasOwn||function(y,w){return ai(Gi(y),w)},Ba=0,oa=Math.random(),Ti=yt(1 .toString),Ca=function(y){return"Symbol("+(y===void 0?"":y)+")_"+Ti(++Ba+oa,36)},xi=function(y){return typeof y=="function"},Hi=function(y){return xi(y)?y:void 0},vi=function(y,w){return arguments.length<2?Hi(st[y]):st[y]&&st[y][w]},mi=vi("navigator","userAgent")||"",ss=st.process,Po=st.Deno,ao=ss&&ss.versions||Po&&Po.version,bt=ao&&ao.v8;bt&&(ir=(Rr=bt.split("."))[0]>0&&Rr[0]<4?1:+(Rr[0]+Rr[1])),!ir&&mi&&(!(Rr=mi.match(/Edge\/(\d+)/))||Rr[1]>=74)&&(Rr=mi.match(/Chrome\/(\d+)/))&&(ir=+Rr[1]);var pe=ir,ie=!!Object.getOwnPropertySymbols&&!Z(function(){var y=Symbol();return!String(y)||!(Object(y)instanceof Symbol)||!Symbol.sham&&pe&&pe<41}),Ce=ie&&!Symbol.sham&&typeof Symbol.iterator=="symbol",V=Ee("wks"),We=st.Symbol,Gt=We&&We.for,Vr=Ce?We:We&&We.withoutSetter||Ca,Mr=function(y){if(!Rn(V,y)||!ie&&typeof V[y]!="string"){var w="Symbol."+y;ie&&Rn(We,y)?V[y]=We[y]:V[y]=Ce&&Gt?Gt(w):Vr(w)}return V[y]},Yn={};Yn[Mr("toStringTag")]="z";var Fi=String(Yn)==="[object z]",Qn=!Z(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Bn=function(y){return typeof y=="object"?y!==null:xi(y)},Fn=st.document,eo=Bn(Fn)&&Bn(Fn.createElement),va=function(y){return eo?Fn.createElement(y):{}},Yi=!Qn&&!Z(function(){return Object.defineProperty(va("div"),"a",{get:function(){return 7}}).a!=7}),Lo=Qn&&Z(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),to=String,So=TypeError,Ji=function(y){if(Bn(y))return y;throw So(to(y)+" is not an object")},ro=Function.prototype.call,hi=Ze?ro.bind(ro):function(){return ro.apply(ro,arguments)},fa=yt({}.isPrototypeOf),$=Object,ne=Ce?function(y){return typeof y=="symbol"}:function(y){var w=vi("Symbol");return xi(w)&&fa(w.prototype,$(y))},he=String,be=function(y){try{return he(y)}catch{return"Object"}},Ne=TypeError,Ye=function(y){if(xi(y))return y;throw Ne(be(y)+" is not a function")},lt=function(y,w){var M=y[w];return M==null?void 0:Ye(M)},_e=TypeError,je=TypeError,Mt=Mr("toPrimitive"),Sr=function(y,w){if(!Bn(y)||ne(y))return y;var M,R=lt(y,Mt);if(R){if(w===void 0&&(w="default"),M=hi(R,y,w),!Bn(M)||ne(M))return M;throw je("Can't convert object to primitive value")}return w===void 0&&(w="number"),function(B,Q){var ue,oe;if(Q==="string"&&xi(ue=B.toString)&&!Bn(oe=hi(ue,B))||xi(ue=B.valueOf)&&!Bn(oe=hi(ue,B))||Q!=="string"&&xi(ue=B.toString)&&!Bn(oe=hi(ue,B)))return oe;throw _e("Can't convert object to primitive value")}(y,w)},zt=function(y){var w=Sr(y,"string");return ne(w)?w:w+""},Yt=TypeError,Lr=Object.defineProperty,$n=Object.getOwnPropertyDescriptor,vn={f:Qn?Lo?function(y,w,M){if(Ji(y),w=zt(w),Ji(M),typeof y=="function"&&w==="prototype"&&"value"in M&&"writable"in M&&!M.writable){var R=$n(y,w);R&&R.writable&&(y[w]=M.value,M={configurable:"configurable"in M?M.configurable:R.configurable,enumerable:"enumerable"in M?M.enumerable:R.enumerable,writable:!1})}return Lr(y,w,M)}:Lr:function(y,w,M){if(Ji(y),w=zt(w),Ji(M),Yi)try{return Lr(y,w,M)}catch{}if("get"in M||"set"in M)throw Yt("Accessors not supported");return"value"in M&&(y[w]=M.value),y}},Nt=Function.prototype,pr=Qn&&Object.getOwnPropertyDescriptor,on=Rn(Nt,"name"),cn={EXISTS:on,PROPER:on&&function(){}.name==="something",CONFIGURABLE:on&&(!Qn||Qn&&pr(Nt,"name").configurable)},$i=yt(Function.toString);xi(ce.inspectSource)||(ce.inspectSource=function(y){return $i(y)});var Cn,xt,St,qi=ce.inspectSource,na=st.WeakMap,ea=xi(na)&&/native code/.test(qi(na)),oi=function(y,w){return{enumerable:!(1&y),configurable:!(2&y),writable:!(4&y),value:w}},Zi=Qn?function(y,w,M){return vn.f(y,w,oi(1,M))}:function(y,w,M){return y[w]=M,y},fo=Ee("keys"),mr=function(y){return fo[y]||(fo[y]=Ca(y))},lr={},nt=st.TypeError,Ya=st.WeakMap;if(ea||ce.state){var dt=ce.state||(ce.state=new Ya),wo=yt(dt.get),qa=yt(dt.has),lu=yt(dt.set);Cn=function(y,w){if(qa(dt,y))throw new nt("Object already initialized");return w.facade=y,lu(dt,y,w),w},xt=function(y){return wo(dt,y)||{}},St=function(y){return qa(dt,y)}}else{var No=mr("state");lr[No]=!0,Cn=function(y,w){if(Rn(y,No))throw new nt("Object already initialized");return w.facade=y,Zi(y,No,w),w},xt=function(y){return Rn(y,No)?y[No]:{}},St=function(y){return Rn(y,No)}}var Li={set:Cn,get:xt,has:St,enforce:function(y){return St(y)?xt(y):Cn(y,{})},getterFor:function(y){return function(w){var M;if(!Bn(w)||(M=xt(w)).type!==y)throw nt("Incompatible receiver, "+y+" required");return M}}},ic=_i(function(y){var w=cn.CONFIGURABLE,M=Li.enforce,R=Li.get,B=Object.defineProperty,Q=Qn&&!Z(function(){return B(function(){},"length",{value:8}).length!==8}),ue=String(String).split("String"),oe=y.exports=function(Ae,Oe,Le){String(Oe).slice(0,7)==="Symbol("&&(Oe="["+String(Oe).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),Le&&Le.getter&&(Oe="get "+Oe),Le&&Le.setter&&(Oe="set "+Oe),(!Rn(Ae,"name")||w&&Ae.name!==Oe)&&(Qn?B(Ae,"name",{value:Oe,configurable:!0}):Ae.name=Oe),Q&&Le&&Rn(Le,"arity")&&Ae.length!==Le.arity&&B(Ae,"length",{value:Le.arity});try{Le&&Rn(Le,"constructor")&&Le.constructor?Qn&&B(Ae,"prototype",{writable:!1}):Ae.prototype&&(Ae.prototype=void 0)}catch{}var Dt=M(Ae);return Rn(Dt,"source")||(Dt.source=ue.join(typeof Oe=="string"?Oe:"")),Ae};Function.prototype.toString=oe(function(){return xi(this)&&R(this).source||qi(this)},"toString")}),Aa=function(y,w,M,R){R||(R={});var B=R.enumerable,Q=R.name!==void 0?R.name:w;if(xi(M)&&ic(M,Q,R),R.global)B?y[w]=M:Wn(w,M);else{try{R.unsafe?y[w]&&(B=!0):delete y[w]}catch{}B?y[w]=M:vn.f(y,w,{value:M,enumerable:!1,configurable:!R.nonConfigurable,writable:!R.nonWritable})}return y},Ao=yt({}.toString),Ho=yt("".slice),pa=function(y){return Ho(Ao(y),8,-1)},ws=Mr("toStringTag"),Vs=Object,gl=pa(function(){return arguments}())=="Arguments",oo=Fi?pa:function(y){var w,M,R;return y===void 0?"Undefined":y===null?"Null":typeof(M=function(B,Q){try{return B[Q]}catch{}}(w=Vs(y),ws))=="string"?M:gl?pa(w):(R=pa(w))=="Object"&&xi(w.callee)?"Arguments":R},ms=Fi?{}.toString:function(){return"[object "+oo(this)+"]"};Fi||Aa(Object.prototype,"toString",ms,{unsafe:!0});var Oa={}.propertyIsEnumerable,Ro=Object.getOwnPropertyDescriptor,Ps={f:Ro&&!Oa.call({1:2},1)?function(y){var w=Ro(this,y);return!!w&&w.enumerable}:Oa},zo=Object,yu=yt("".split),el=Z(function(){return!zo("z").propertyIsEnumerable(0)})?function(y){return pa(y)=="String"?yu(y,""):zo(y)}:zo,Wo=function(y){return el(Xn(y))},fe=Object.getOwnPropertyDescriptor,Me={f:Qn?fe:function(y,w){if(y=Wo(y),w=zt(w),Yi)try{return fe(y,w)}catch{}if(Rn(y,w))return oi(!hi(Ps.f,y,w),y[w])}},ut=Math.ceil,Zt=Math.floor,sn=Math.trunc||function(y){var w=+y;return(w>0?Zt:ut)(w)},jn=function(y){var w=+y;return w!=w||w===0?0:sn(w)},ua=Math.max,Jo=Math.min,Ta=function(y,w){var M=jn(y);return M<0?ua(M+w,0):Jo(M,w)},so=Math.min,xo=function(y){return y>0?so(jn(y),9007199254740991):0},To=function(y){return xo(y.length)},Ls=function(y){return function(w,M,R){var B,Q=Wo(w),ue=To(Q),oe=Ta(R,ue);if(y&&M!=M){for(;ue>oe;)if((B=Q[oe++])!=B)return!0}else for(;ue>oe;oe++)if((y||oe in Q)&&Q[oe]===M)return y||oe||0;return!y&&-1}},js={includes:Ls(!0),indexOf:Ls(!1)},_u=js.indexOf,xu=yt([].push),Mu=function(y,w){var M,R=Wo(y),B=0,Q=[];for(M in R)!Rn(lr,M)&&Rn(R,M)&&xu(Q,M);for(;w.length>B;)Rn(R,M=w[B++])&&(~_u(Q,M)||xu(Q,M));return Q},Uo=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Zo=Uo.concat("length","prototype"),Fa={f:Object.getOwnPropertyNames||function(y){return Mu(y,Zo)}},As={f:Object.getOwnPropertySymbols},Hu=yt([].concat),Zh=vi("Reflect","ownKeys")||function(y){var w=Fa.f(Ji(y)),M=As.f;return M?Hu(w,M(y)):w},Cc=function(y,w,M){for(var R=Zh(w),B=vn.f,Q=Me.f,ue=0;ue<R.length;ue++){var oe=R[ue];Rn(y,oe)||M&&Rn(M,oe)||B(y,oe,Q(w,oe))}},Xf=/#|\.prototype\./,yl=function(y,w){var M=_l[Hc(y)];return M==b||M!=gf&&(xi(w)?Z(w):!!w)},Hc=yl.normalize=function(y){return String(y).replace(Xf,".").toLowerCase()},_l=yl.data={},gf=yl.NATIVE="N",b=yl.POLYFILL="P",I=yl,G=Me.f,D=function(y,w){var M,R,B,Q,ue,oe=y.target,Ae=y.global,Oe=y.stat;if(M=Ae?st:Oe?st[oe]||Wn(oe,{}):(st[oe]||{}).prototype)for(R in w){if(Q=w[R],B=y.dontCallGetSet?(ue=G(M,R))&&ue.value:M[R],!I(Ae?R:oe+(Oe?".":"#")+R,y.forced)&&B!==void 0){if(typeof Q==typeof B)continue;Cc(Q,B)}(y.sham||B&&B.sham)&&Zi(Q,"sham",!0),Aa(M,R,Q,y)}},re=pa(st.process)=="process",Te=String,it=TypeError,ht=Object.setPrototypeOf||("__proto__"in{}?function(){var y,w=!1,M={};try{(y=yt(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(M,[]),w=M instanceof Array}catch{}return function(R,B){return Ji(R),function(Q){if(typeof Q=="object"||xi(Q))return Q;throw it("Can't set "+Te(Q)+" as a prototype")}(B),w?y(R,B):R.__proto__=B,R}}():void 0),Tt=vn.f,_r=Mr("toStringTag"),br=function(y,w,M){y&&!M&&(y=y.prototype),y&&!Rn(y,_r)&&Tt(y,_r,{configurable:!0,value:w})},si=Mr("species"),Ni=function(y){var w=vi(y),M=vn.f;Qn&&w&&!w[si]&&M(w,si,{configurable:!0,get:function(){return this}})},Di=TypeError,ia=function(y,w){if(fa(w,y))return y;throw Di("Incorrect invocation")},Ga=function(){},uo=[],ga=vi("Reflect","construct"),Ks=/^\s*(?:class|function)\b/,Zl=yt(Ks.exec),Wc=!Ks.exec(Ga),Xc=function(y){if(!xi(y))return!1;try{return ga(Ga,uo,y),!0}catch{return!1}},Sc=function(y){if(!xi(y))return!1;switch(oo(y)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Wc||!!Zl(Ks,qi(y))}catch{return!0}};Sc.sham=!0;var wc,ku,Vl,xl,Oo=!ga||Z(function(){var y;return Xc(Xc.call)||!Xc(Object)||!Xc(function(){y=!0})||y})?Sc:Xc,Vh=TypeError,jh=function(y){if(Oo(y))return y;throw Vh(be(y)+" is not a constructor")},Iu=Mr("species"),fh=function(y,w){var M,R=Ji(y).constructor;return R===void 0||(M=Ji(R)[Iu])==null?w:jh(M)},ac=Function.prototype,Rs=ac.apply,hh=ac.call,bl=typeof Reflect=="object"&&Reflect.apply||(Ze?hh.bind(Rs):function(){return hh.apply(Rs,arguments)}),no=yt(yt.bind),Pu=function(y,w){return Ye(y),w===void 0?y:Ze?no(y,w):function(){return y.apply(w,arguments)}},Yf=vi("document","documentElement"),El=yt([].slice),od=TypeError,i0=function(y,w){if(y<w)throw od("Not enough arguments");return y},sd=/(?:ipad|iphone|ipod).*applewebkit/i.test(mi),ph=st.setImmediate,Yc=st.clearImmediate,yf=st.process,Ac=st.Dispatch,qc=st.Function,Tc=st.MessageChannel,_f=st.String,oc=0,cu={};try{wc=st.location}catch{}var sc=function(y){if(Rn(cu,y)){var w=cu[y];delete cu[y],w()}},qf=function(y){return function(){sc(y)}},Gh=function(y){sc(y.data)},Mc=function(y){st.postMessage(_f(y),wc.protocol+"//"+wc.host)};ph&&Yc||(ph=function(y){i0(arguments.length,1);var w=xi(y)?y:qc(y),M=El(arguments,1);return cu[++oc]=function(){bl(w,void 0,M)},ku(oc),oc},Yc=function(y){delete cu[y]},re?ku=function(y){yf.nextTick(qf(y))}:Ac&&Ac.now?ku=function(y){Ac.now(qf(y))}:Tc&&!sd?(xl=(Vl=new Tc).port2,Vl.port1.onmessage=Gh,ku=Pu(xl.postMessage,xl)):st.addEventListener&&xi(st.postMessage)&&!st.importScripts&&wc&&wc.protocol!=="file:"&&!Z(Mc)?(ku=Mc,st.addEventListener("message",Gh,!1)):ku="onreadystatechange"in va("script")?function(y){Yf.appendChild(va("script")).onreadystatechange=function(){Yf.removeChild(this),sc(y)}}:function(y){setTimeout(qf(y),0)});var Cl,uc,xf,kc,Hh,bf,Ic,Ef,Wh={set:ph,clear:Yc},Cf=/ipad|iphone|ipod/i.test(mi)&&st.Pebble!==void 0,ud=/web0s(?!.*chrome)/i.test(mi),wp=Me.f,dh=Wh.set,Ts=st.MutationObserver||st.WebKitMutationObserver,Ap=st.document,Ia=st.process,bo=st.Promise,$f=wp(st,"queueMicrotask"),$c=$f&&$f.value;$c||(Cl=function(){var y,w;for(re&&(y=Ia.domain)&&y.exit();uc;){w=uc.fn,uc=uc.next;try{w()}catch(M){throw uc?kc():xf=void 0,M}}xf=void 0,y&&y.enter()},sd||re||ud||!Ts||!Ap?!Cf&&bo&&bo.resolve?((Ic=bo.resolve(void 0)).constructor=bo,Ef=Pu(Ic.then,Ic),kc=function(){Ef(Cl)}):re?kc=function(){Ia.nextTick(Cl)}:(dh=Pu(dh,st),kc=function(){dh(Cl)}):(Hh=!0,bf=Ap.createTextNode(""),new Ts(Cl).observe(bf,{characterData:!0}),kc=function(){bf.data=Hh=!Hh}));var tl=$c||function(y){var w={fn:y,next:void 0};xf&&(xf.next=w),uc||(uc=w,kc()),xf=w},ya=function(y){try{return{error:!1,value:y()}}catch(w){return{error:!0,value:w}}},ho=function(){this.head=null,this.tail=null};ho.prototype={add:function(y){var w={item:y,next:null};this.head?this.tail.next=w:this.head=w,this.tail=w},get:function(){var y=this.head;if(y)return this.head=y.next,this.tail===y&&(this.tail=null),y.item}};var ka,jl,bu,Pc=ho,rl=st.Promise,Tp=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Sf=!Tp&&!re&&typeof window=="object"&&typeof document=="object",Kf=(rl&&rl.prototype,Mr("species")),lc=!1,us=xi(st.PromiseRejectionEvent),Sl={CONSTRUCTOR:I("Promise",function(){var y=qi(rl),w=y!==String(rl);if(!w&&pe===66)return!0;if(!pe||pe<51||!/native code/.test(y)){var M=new rl(function(B){B(1)}),R=function(B){B(function(){},function(){})};if((M.constructor={})[Kf]=R,!(lc=M.then(function(){})instanceof R))return!0}return!w&&(Sf||Tp)&&!us}),REJECTION_EVENT:us,SUBCLASSING:lc},vh=function(y){var w,M;this.promise=new y(function(R,B){if(w!==void 0||M!==void 0)throw TypeError("Bad Promise constructor");w=R,M=B}),this.resolve=Ye(w),this.reject=Ye(M)},Vo={f:function(y){return new vh(y)}},tn=Wh.set,Xo=Sl.CONSTRUCTOR,Lc=Sl.REJECTION_EVENT,Kc=Sl.SUBCLASSING,Wu=Li.getterFor("Promise"),Lu=Li.set,Gl=rl&&rl.prototype,mn=rl,wf=Gl,Sa=st.TypeError,Hl=st.document,po=st.process,fu=Vo.f,Qc=fu,wl=!!(Hl&&Hl.createEvent&&st.dispatchEvent),Eu=function(y){var w;return!(!Bn(y)||!xi(w=y.then))&&w},zn=function(y,w){var M,R,B,Q=w.value,ue=w.state==1,oe=ue?y.ok:y.fail,Ae=y.resolve,Oe=y.reject,Le=y.domain;try{oe?(ue||(w.rejection===2&&nl(w),w.rejection=1),oe===!0?M=Q:(Le&&Le.enter(),M=oe(Q),Le&&(Le.exit(),B=!0)),M===y.promise?Oe(Sa("Promise-chain cycle")):(R=Eu(M))?hi(R,M,Ae,Oe):Ae(M)):Oe(Q)}catch(Dt){Le&&!B&&Le.exit(),Oe(Dt)}},Mp=function(y,w){y.notified||(y.notified=!0,tl(function(){for(var M,R=y.reactions;M=R.get();)zn(M,y);y.notified=!1,w&&!y.rejection&&ld(y)}))},Qf=function(y,w,M){var R,B;wl?((R=Hl.createEvent("Event")).promise=w,R.reason=M,R.initEvent(y,!1,!0),st.dispatchEvent(R)):R={promise:w,reason:M},!Lc&&(B=st["on"+y])?B(R):y==="unhandledrejection"&&function(Q,ue){var oe=st.console;oe&&oe.error&&(arguments.length==1?oe.error(Q):oe.error(Q,ue))}("Unhandled promise rejection",M)},ld=function(y){hi(tn,st,function(){var w,M=y.facade,R=y.value;if(Xh(y)&&(w=ya(function(){re?po.emit("unhandledRejection",R,M):Qf("unhandledrejection",M,R)}),y.rejection=re||Xh(y)?2:1,w.error))throw w.value})},Xh=function(y){return y.rejection!==1&&!y.parent},nl=function(y){hi(tn,st,function(){var w=y.facade;re?po.emit("rejectionHandled",w):Qf("rejectionhandled",w,y.value)})},Os=function(y,w,M){return function(R){y(w,R,M)}},aa=function(y,w,M){y.done||(y.done=!0,M&&(y=M),y.value=w,y.state=2,Mp(y,!0))},il=function(y,w,M){if(!y.done){y.done=!0,M&&(y=M);try{if(y.facade===w)throw Sa("Promise can't be resolved itself");var R=Eu(w);R?tl(function(){var B={done:!1};try{hi(R,w,Os(il,B,y),Os(aa,B,y))}catch(Q){aa(B,Q,y)}}):(y.value=w,y.state=1,Mp(y,!1))}catch(B){aa({done:!1},B,y)}}};if(Xo&&(wf=(mn=function(y){ia(this,wf),Ye(y),hi(ka,this);var w=Wu(this);try{y(Os(il,w),Os(aa,w))}catch(M){aa(w,M)}}).prototype,(ka=function(y){Lu(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new Pc,rejection:!1,state:0,value:void 0})}).prototype=Aa(wf,"then",function(y,w){var M=Wu(this),R=fu(fh(this,mn));return M.parent=!0,R.ok=!xi(y)||y,R.fail=xi(w)&&w,R.domain=re?po.domain:void 0,M.state==0?M.reactions.add(R):tl(function(){zn(R,M)}),R.promise}),jl=function(){var y=new ka,w=Wu(y);this.promise=y,this.resolve=Os(il,w),this.reject=Os(aa,w)},Vo.f=fu=function(y){return y===mn||y===void 0?new jl(y):Qc(y)},xi(rl)&&Gl!==Object.prototype)){bu=Gl.then,Kc||Aa(Gl,"then",function(y,w){var M=this;return new mn(function(R,B){hi(bu,M,R,B)}).then(y,w)},{unsafe:!0});try{delete Gl.constructor}catch{}ht&&ht(Gl,wf)}D({global:!0,constructor:!0,wrap:!0,forced:Xo},{Promise:mn}),br(mn,"Promise",!1),Ni("Promise");var Gs={},Qs=Mr("iterator"),cc=Array.prototype,Jc=function(y){return y!==void 0&&(Gs.Array===y||cc[Qs]===y)},al=Mr("iterator"),Hs=function(y){if(y!=null)return lt(y,al)||lt(y,"@@iterator")||Gs[oo(y)]},Al=TypeError,ci=function(y,w){var M=arguments.length<2?Hs(y):w;if(Ye(M))return Ji(hi(M,y));throw Al(be(y)+" is not iterable")},ti=function(y,w,M){var R,B;Ji(y);try{if(!(R=lt(y,"return"))){if(w==="throw")throw M;return M}R=hi(R,y)}catch(Q){B=!0,R=Q}if(w==="throw")throw M;if(B)throw R;return Ji(R),M},mh=TypeError,Fs=function(y,w){this.stopped=y,this.result=w},Ru=Fs.prototype,Yo=function(y,w,M){var R,B,Q,ue,oe,Ae,Oe,Le=M&&M.that,Dt=!(!M||!M.AS_ENTRIES),tr=!(!M||!M.IS_RECORD),gr=!(!M||!M.IS_ITERATOR),Fr=!(!M||!M.INTERRUPTED),Qr=Pu(w,Le),hn=function(nn){return R&&ti(R,"normal",nn),new Fs(!0,nn)},wn=function(nn){return Dt?(Ji(nn),Fr?Qr(nn[0],nn[1],hn):Qr(nn[0],nn[1])):Fr?Qr(nn,hn):Qr(nn)};if(tr)R=y.iterator;else if(gr)R=y;else{if(!(B=Hs(y)))throw mh(be(y)+" is not iterable");if(Jc(B)){for(Q=0,ue=To(y);ue>Q;Q++)if((oe=wn(y[Q]))&&fa(Ru,oe))return oe;return new Fs(!1)}R=ci(y,B)}for(Ae=tr?y.next:R.next;!(Oe=hi(Ae,R)).done;){try{oe=wn(Oe.value)}catch(nn){ti(R,"throw",nn)}if(typeof oe=="object"&&oe&&fa(Ru,oe))return oe}return new Fs(!1)},Tl=Mr("iterator"),Jf=!1;try{var Yh=0,Na={next:function(){return{done:!!Yh++}},return:function(){Jf=!0}};Na[Tl]=function(){return this},Array.from(Na,function(){throw 2})}catch{}var io=function(y,w){if(!w&&!Jf)return!1;var M=!1;try{var R={};R[Tl]=function(){return{next:function(){return{done:M=!0}}}},y(R)}catch{}return M},kp=Sl.CONSTRUCTOR||!io(function(y){rl.all(y).then(void 0,function(){})});D({target:"Promise",stat:!0,forced:kp},{all:function(y){var w=this,M=Vo.f(w),R=M.resolve,B=M.reject,Q=ya(function(){var ue=Ye(w.resolve),oe=[],Ae=0,Oe=1;Yo(y,function(Le){var Dt=Ae++,tr=!1;Oe++,hi(ue,w,Le).then(function(gr){tr||(tr=!0,oe[Dt]=gr,--Oe||R(oe))},B)}),--Oe||R(oe)});return Q.error&&B(Q.value),M.promise}});var Af=Sl.CONSTRUCTOR,Ml=rl&&rl.prototype;if(D({target:"Promise",proto:!0,forced:Af,real:!0},{catch:function(y){return this.then(void 0,y)}}),xi(rl)){var kl=vi("Promise").prototype.catch;Ml.catch!==kl&&Aa(Ml,"catch",kl,{unsafe:!0})}D({target:"Promise",stat:!0,forced:kp},{race:function(y){var w=this,M=Vo.f(w),R=M.reject,B=ya(function(){var Q=Ye(w.resolve);Yo(y,function(ue){hi(Q,w,ue).then(M.resolve,R)})});return B.error&&R(B.value),M.promise}}),D({target:"Promise",stat:!0,forced:Sl.CONSTRUCTOR},{reject:function(y){var w=Vo.f(this);return hi(w.reject,void 0,y),w.promise}});var za=Sl.CONSTRUCTOR;vi("Promise");function Il(y,w){if(!y)throw new Error(w||"web worker helper assertion failed.")}D({target:"Promise",stat:!0,forced:za},{resolve:function(y){return function(w,M){if(Ji(w),Bn(M)&&M.constructor===w)return M;var R=Vo.f(w);return(0,R.resolve)(M),R.promise}(this,y)}});var fc=typeof window<"u"&&window.orientation!==void 0,qh=function(){function y(w,M){var R=this;this.name=w,this.workerThread=M,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(B,Q){R.resolve=B,R.reject=Q})}return y.prototype.postMessage=function(w,M){this.workerThread.postMessage({source:"Main thread",type:w,payload:M})},y.prototype.done=function(w){Il(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(w)},y.prototype.error=function(w){Il(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(w)},y}(),Rc=new Map;function gh(y){Il(y.source&&!y.url||!y.source&&y.url);var w=Rc.get(y.source||y.url);return w||(y.url&&(w=function(M){if(!M.startsWith("http"))return M;return hc((R=M,`try {
  importScripts('`+R+`');
} catch (error) {
  console.error(error);
  throw error;
}`));var R}(y.url),Rc.set(y.url,w)),y.source&&(w=hc(y.source),Rc.set(y.source,w))),Il(w),w}function hc(y){var w=new Blob([y],{type:"application/javascript"});return URL.createObjectURL(w)}function pc(y,w,M){w===void 0&&(w=!0);var R=M||new Set;if(y){if(Wl(y))R.add(y);else if(Wl(y.buffer))R.add(y.buffer);else if(!ArrayBuffer.isView(y)){if(w&&typeof y=="object")for(var B in y)pc(y[B],w,R)}}return M===void 0?Array.from(R):[]}function Wl(y){return!!y&&(y instanceof ArrayBuffer||typeof MessagePort<"u"&&y instanceof MessagePort||typeof ImageBitmap<"u"&&y instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&y instanceof OffscreenCanvas)}var eh=function(){},dc=function(){function y(w){this.terminated=!1,this.loadableURL="";var M=w.name,R=w.source,B=w.url;Il(R||B),this.name=M,this.source=R,this.url=B,this.onMessage=eh,this.onError=function(Q){return console.log(Q)},this.worker=this.createBrowserWorker()}return y.isSupported=function(){return typeof Worker<"u"},y.prototype.destroy=function(){this.onMessage=eh,this.onError=eh,this.worker.terminate(),this.terminated=!0},Object.defineProperty(y.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),y.prototype.postMessage=function(w,M){M=M||pc(w),this.worker.postMessage(w,M)},y.prototype.getErrorFromErrorEvent=function(w){var M="Failed to load ";return M+="worker "+this.name+" from "+this.url+". ",w.message&&(M+=w.message+" in "),w.lineno&&(M+=":"+w.lineno+":"+w.colno),new Error(M)},y.prototype.createBrowserWorker=function(){var w=this;this.loadableURL=gh({source:this.source,url:this.url});var M=new Worker(this.loadableURL,{name:this.name});return M.onmessage=function(R){R.data?w.onMessage(R.data):w.onError(new Error("No data received"))},M.onerror=function(R){w.onError(w.getErrorFromErrorEvent(R)),w.terminated=!0},M.onmessageerror=function(R){return console.error("worker "+w.name+", message error: "+R)},M},y}(),vc=self&&self.__assign||function(){return(vc=Object.assign||function(y){for(var w,M=1,R=arguments.length;M<R;M++)for(var B in w=arguments[M])Object.prototype.hasOwnProperty.call(w,B)&&(y[B]=w[B]);return y}).apply(this,arguments)},th=self&&self.__awaiter||function(y,w,M,R){return new(M||(M=Promise))(function(B,Q){function ue(Oe){try{Ae(R.next(Oe))}catch(Le){Q(Le)}}function oe(Oe){try{Ae(R.throw(Oe))}catch(Le){Q(Le)}}function Ae(Oe){var Le;Oe.done?B(Oe.value):(Le=Oe.value,Le instanceof M?Le:new M(function(Dt){Dt(Le)})).then(ue,oe)}Ae((R=R.apply(y,w||[])).next())})},ef=self&&self.__generator||function(y,w){var M,R,B,Q,ue={label:0,sent:function(){if(1&B[0])throw B[1];return B[1]},trys:[],ops:[]};return Q={next:oe(0),throw:oe(1),return:oe(2)},typeof Symbol=="function"&&(Q[Symbol.iterator]=function(){return this}),Q;function oe(Ae){return function(Oe){return function(Le){if(M)throw new TypeError("Generator is already executing.");for(;ue;)try{if(M=1,R&&(B=2&Le[0]?R.return:Le[0]?R.throw||((B=R.return)&&B.call(R),0):R.next)&&!(B=B.call(R,Le[1])).done)return B;switch(R=0,B&&(Le=[2&Le[0],B.value]),Le[0]){case 0:case 1:B=Le;break;case 4:return ue.label++,{value:Le[1],done:!1};case 5:ue.label++,R=Le[1],Le=[0];continue;case 7:Le=ue.ops.pop(),ue.trys.pop();continue;default:if(B=ue.trys,!((B=B.length>0&&B[B.length-1])||Le[0]!==6&&Le[0]!==2)){ue=0;continue}if(Le[0]===3&&(!B||Le[1]>B[0]&&Le[1]<B[3])){ue.label=Le[1];break}if(Le[0]===6&&ue.label<B[1]){ue.label=B[1],B=Le;break}if(B&&ue.label<B[2]){ue.label=B[2],ue.ops.push(Le);break}B[2]&&ue.ops.pop(),ue.trys.pop();continue}Le=w.call(y,ue)}catch(Dt){Le=[6,Dt],R=0}finally{M=B=0}if(5&Le[0])throw Le[1];return{value:Le[0]?Le[1]:void 0,done:!0}}([Ae,Oe])}}},ol=function(){function y(w){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=w.source,this.url=w.url,this.setProps(w)}return y.prototype.destroy=function(){this.idleQueue.forEach(function(w){return w.destroy()}),this.isDestroyed=!0},y.prototype.setProps=function(w){this.props=vc(vc({},this.props),w),w.name!==void 0&&(this.name=w.name),w.maxConcurrency!==void 0&&(this.maxConcurrency=w.maxConcurrency),w.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=w.maxMobileConcurrency),w.reuseWorkers!==void 0&&(this.reuseWorkers=w.reuseWorkers),w.onDebug!==void 0&&(this.onDebug=w.onDebug)},y.prototype.startJob=function(w,M,R){return M===void 0&&(M=function(B,Q,ue){return B.done(ue)}),R===void 0&&(R=function(B,Q){return B.error(Q)}),th(this,void 0,void 0,function(){var B,Q=this;return ef(this,function(ue){switch(ue.label){case 0:return B=new Promise(function(oe){return Q.jobQueue.push({name:w,onMessage:M,onError:R,onStart:oe}),Q}),this.startQueuedJob(),[4,B];case 1:return[2,ue.sent()]}})})},y.prototype.startQueuedJob=function(){return th(this,void 0,void 0,function(){var w,M,R;return ef(this,function(B){switch(B.label){case 0:if(!this.jobQueue.length)return[2];if(!(w=this.getAvailableWorker()))return[2];if(!(M=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:M.name,backlog:this.jobQueue.length,workerThread:w}),R=new qh(M.name,w),w.onMessage=function(Q){return M.onMessage(R,Q.type,Q.payload)},w.onError=function(Q){return M.onError(R,Q)},M.onStart(R),B.label=1;case 1:return B.trys.push([1,,3,4]),[4,R.result];case 2:return B.sent(),[3,4];case 3:return this.returnWorkerToQueue(w),[7];case 4:return[2]}})})},y.prototype.returnWorkerToQueue=function(w){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(w.destroy(),this.count--):this.idleQueue.push(w),this.isDestroyed||this.startQueuedJob()},y.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var w=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new dc({name:w,source:this.source,url:this.url})}return null},y.prototype.getMaxConcurrency=function(){return fc?this.maxMobileConcurrency:this.maxConcurrency},y}(),rh=self&&self.__assign||function(){return(rh=Object.assign||function(y){for(var w,M=1,R=arguments.length;M<R;M++)for(var B in w=arguments[M])Object.prototype.hasOwnProperty.call(w,B)&&(y[B]=w[B]);return y}).apply(this,arguments)},hu=self&&self.__values||function(y){var w=typeof Symbol=="function"&&Symbol.iterator,M=w&&y[w],R=0;if(M)return M.call(y);if(y&&typeof y.length=="number")return{next:function(){return y&&R>=y.length&&(y=void 0),{value:y&&y[R++],done:!y}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")},Ip={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},tf=(function(){function y(w){this.workerPools=new Map,this.props=rh({},Ip),this.setProps(w),this.workerPools=new Map}y.isSupported=function(){return dc.isSupported()},y.getWorkerFarm=function(w){return w===void 0&&(w={}),y.workerFarm=y.workerFarm||new y({}),y.workerFarm.setProps(w),y.workerFarm},y.prototype.destroy=function(){var w,M;try{for(var R=hu(this.workerPools.values()),B=R.next();!B.done;B=R.next())B.value.destroy()}catch(Q){w={error:Q}}finally{try{B&&!B.done&&(M=R.return)&&M.call(R)}finally{if(w)throw w.error}}},y.prototype.setProps=function(w){var M,R;this.props=rh(rh({},this.props),w);try{for(var B=hu(this.workerPools.values()),Q=B.next();!Q.done;Q=B.next())Q.value.setProps(this.getWorkerPoolProps())}catch(ue){M={error:ue}}finally{try{Q&&!Q.done&&(R=B.return)&&R.call(B)}finally{if(M)throw M.error}}},y.prototype.getWorkerPool=function(w){var M=w.name,R=w.source,B=w.url,Q=this.workerPools.get(M);return Q||((Q=new ol({name:M,source:R,url:B})).setProps(this.getWorkerPoolProps()),this.workerPools.set(M,Q)),Q},y.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),c=function(){function y(){}return Object.defineProperty(y,"onmessage",{set:function(w){self.onmessage=function(M){if(h(M)){var R=M.data,B=R.type,Q=R.payload;w(B,Q)}}},enumerable:!1,configurable:!0}),y.addEventListener=function(w){var M=tf.get(w);M||(M=function(R){if(h(R)){var B=R.data,Q=B.type,ue=B.payload;w(Q,ue)}}),self.addEventListener("message",M)},y.removeEventListener=function(w){var M=tf.get(w);tf.delete(w),self.removeEventListener("message",M)},y.postMessage=function(w,M){if(self){var R={source:"Worker thread",type:w,payload:M},B=pc(M);self.postMessage(R,B)}},y}();function h(y){var w=y.type,M=y.data;return w==="message"&&M&&typeof M.source=="string"&&M.source==="Main thread"}self&&self.__awaiter,self&&self.__generator;var f,m,S=function(){function y(){this._values=[],this._settlers=[],this._closed=!1}return y.prototype[Symbol.asyncIterator]=function(){return this},y.prototype.push=function(w){return this.enqueue(w)},y.prototype.enqueue=function(w){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var M=this._settlers.shift();w instanceof Error?M.reject(w):M.resolve({value:w})}else this._values.push(w)},y.prototype.close=function(){for(;this._settlers.length>0;)this._settlers.shift().resolve({done:!0});this._closed=!0},y.prototype.next=function(){var w=this;if(this._values.length>0){var M=this._values.shift();return M instanceof Error?Promise.reject(M):Promise.resolve({done:!1,value:M})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(R,B){w._settlers.push({resolve:R,reject:B})})},y}(),k=self&&self.__awaiter||function(y,w,M,R){return new(M||(M=Promise))(function(B,Q){function ue(Oe){try{Ae(R.next(Oe))}catch(Le){Q(Le)}}function oe(Oe){try{Ae(R.throw(Oe))}catch(Le){Q(Le)}}function Ae(Oe){var Le;Oe.done?B(Oe.value):(Le=Oe.value,Le instanceof M?Le:new M(function(Dt){Dt(Le)})).then(ue,oe)}Ae((R=R.apply(y,w||[])).next())})},P=self&&self.__generator||function(y,w){var M,R,B,Q,ue={label:0,sent:function(){if(1&B[0])throw B[1];return B[1]},trys:[],ops:[]};return Q={next:oe(0),throw:oe(1),return:oe(2)},typeof Symbol=="function"&&(Q[Symbol.iterator]=function(){return this}),Q;function oe(Ae){return function(Oe){return function(Le){if(M)throw new TypeError("Generator is already executing.");for(;ue;)try{if(M=1,R&&(B=2&Le[0]?R.return:Le[0]?R.throw||((B=R.return)&&B.call(R),0):R.next)&&!(B=B.call(R,Le[1])).done)return B;switch(R=0,B&&(Le=[2&Le[0],B.value]),Le[0]){case 0:case 1:B=Le;break;case 4:return ue.label++,{value:Le[1],done:!1};case 5:ue.label++,R=Le[1],Le=[0];continue;case 7:Le=ue.ops.pop(),ue.trys.pop();continue;default:if(B=ue.trys,!((B=B.length>0&&B[B.length-1])||Le[0]!==6&&Le[0]!==2)){ue=0;continue}if(Le[0]===3&&(!B||Le[1]>B[0]&&Le[1]<B[3])){ue.label=Le[1];break}if(Le[0]===6&&ue.label<B[1]){ue.label=B[1],B=Le;break}if(B&&ue.label<B[2]){ue.label=B[2],ue.ops.push(Le);break}B[2]&&ue.ops.pop(),ue.trys.pop();continue}Le=w.call(y,ue)}catch(Dt){Le=[6,Dt],R=0}finally{M=B=0}if(5&Le[0])throw Le[1];return{value:Le[0]?Le[1]:void 0,done:!0}}([Ae,Oe])}}},N=self&&self.__asyncValues||function(y){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var w,M=y[Symbol.asyncIterator];return M?M.call(y):(y=typeof __values=="function"?__values(y):y[Symbol.iterator](),w={},R("next"),R("throw"),R("return"),w[Symbol.asyncIterator]=function(){return this},w);function R(B){w[B]=y[B]&&function(Q){return new Promise(function(ue,oe){(function(Ae,Oe,Le,Dt){Promise.resolve(Dt).then(function(tr){Ae({value:tr,done:Le})},Oe)})(ue,oe,(Q=y[B](Q)).done,Q.value)})}}},Y=0;function te(y,w){var M=this;if(typeof self<"u"){var R={process:ye};c.onmessage=function(B,Q){return k(M,void 0,void 0,function(){var ue,oe,Ae,Oe,Le,Dt,tr,gr,Fr,Qr;return P(this,function(hn){switch(hn.label){case 0:switch(hn.trys.push([0,19,,20]),B){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!y)throw new Error("Worker does not support atomic processing");return[4,y(Q.input,Q.options||{},R)];case 2:return ue=hn.sent(),c.postMessage("done",{result:ue}),[3,18];case 3:if(!w)throw new Error("Worker does not support batched processing");f=new S,m=Q.options||{},oe=w(f,m,R),hn.label=4;case 4:hn.trys.push([4,9,10,15]),Ae=N(oe),hn.label=5;case 5:return[4,Ae.next()];case 6:if((Oe=hn.sent()).done)return[3,8];Le=Oe.value,c.postMessage("output-batch",{result:Le}),hn.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return Dt=hn.sent(),Fr={error:Dt},[3,15];case 10:return hn.trys.push([10,,13,14]),Oe&&!Oe.done&&(Qr=Ae.return)?[4,Qr.call(Ae)]:[3,12];case 11:hn.sent(),hn.label=12;case 12:return[3,14];case 13:if(Fr)throw Fr.error;return[7];case 14:return[7];case 15:return c.postMessage("done",{}),[3,18];case 16:return f.push(Q.input),[3,18];case 17:return f.close(),[3,18];case 18:return[3,20];case 19:return tr=hn.sent(),gr=tr instanceof Error?tr.message:"",c.postMessage("error",{error:gr}),[3,20];case 20:return[2]}})})}}}function ye(y,w){return w===void 0&&(w={}),new Promise(function(M,R){var B=Y++,Q=function(oe,Ae){if(Ae.id===B)switch(oe){case"done":c.removeEventListener(Q),M(Ae.result);break;case"error":c.removeEventListener(Q),R(Ae.error)}};c.addEventListener(Q);var ue={id:B,input:y,options:w};c.postMessage("process",ue)})}self&&self.__awaiter,self&&self.__generator;var le={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},xe=va("span").classList,ze=xe&&xe.constructor&&xe.constructor.prototype,Ue=ze===Object.prototype?void 0:ze,Je=Array.isArray||function(y){return pa(y)=="Array"},Fe=Mr("species"),et=Array,pt=function(y,w){return new(function(M){var R;return Je(M)&&(R=M.constructor,(Oo(R)&&(R===et||Je(R.prototype))||Bn(R)&&(R=R[Fe])===null)&&(R=void 0)),R===void 0?et:R}(y))(w===0?0:w)},kt=yt([].push),Qt=function(y){var w=y==1,M=y==2,R=y==3,B=y==4,Q=y==6,ue=y==7,oe=y==5||Q;return function(Ae,Oe,Le,Dt){for(var tr,gr,Fr=Gi(Ae),Qr=el(Fr),hn=Pu(Oe,Le),wn=To(Qr),nn=0,Hn=Dt||pt,di=w?Hn(Ae,wn):M||ue?Hn(Ae,0):void 0;wn>nn;nn++)if((oe||nn in Qr)&&(gr=hn(tr=Qr[nn],nn,Fr),y))if(w)di[nn]=gr;else if(gr)switch(y){case 3:return!0;case 5:return tr;case 6:return nn;case 2:kt(di,tr)}else switch(y){case 4:return!1;case 7:kt(di,tr)}return Q?-1:R||B?B:di}},Bt={forEach:Qt(0),map:Qt(1),filter:Qt(2),some:Qt(3),every:Qt(4),find:Qt(5),findIndex:Qt(6),filterReject:Qt(7)},nr=function(y,w){var M=[][y];return!!M&&Z(function(){M.call(null,w||function(){return 1},1)})},Or=Bt.forEach,un=nr("forEach")?[].forEach:function(y){return Or(this,y,arguments.length>1?arguments[1]:void 0)},rn=function(y){if(y&&y.forEach!==un)try{Zi(y,"forEach",un)}catch{y.forEach=un}};for(var Pn in le)le[Pn]&&rn(st[Pn]&&st[Pn].prototype);rn(Ue);var ui=function(y,w,M){var R=zt(w);R in y?vn.f(y,R,oi(0,M)):y[R]=M},gi=Mr("species"),fi=function(y){return pe>=51||!Z(function(){var w=[];return(w.constructor={})[gi]=function(){return{foo:1}},w[y](Boolean).foo!==1})},_a=fi("slice"),Dn=Mr("species"),Ii=Array,Wi=Math.max;D({target:"Array",proto:!0,forced:!_a},{slice:function(y,w){var M,R,B,Q=Wo(this),ue=To(Q),oe=Ta(y,ue),Ae=Ta(w===void 0?ue:w,ue);if(Je(Q)&&(M=Q.constructor,(Oo(M)&&(M===Ii||Je(M.prototype))||Bn(M)&&(M=M[Dn])===null)&&(M=void 0),M===Ii||M===void 0))return El(Q,oe,Ae);for(R=new(M===void 0?Ii:M)(Wi(Ae-oe,0)),B=0;oe<Ae;oe++,B++)oe in Q&&ui(R,B,Q[oe]);return R.length=B,R}});var Bi=cn.EXISTS,wi=vn.f,Ki=Function.prototype,Ci=yt(Ki.toString),Si=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,gs=yt(Si.exec);Qn&&!Bi&&wi(Ki,"name",{configurable:!0,get:function(){try{return gs(Si,Ci(this))[1]}catch{return""}}});var qo=Bt.map,Ds=fi("map");D({target:"Array",proto:!0,forced:!Ds},{map:function(y){return qo(this,y,arguments.length>1?arguments[1]:void 0)}});var es,vo=Object.keys||function(y){return Mu(y,Uo)},lo={f:Qn&&!Lo?Object.defineProperties:function(y,w){Ji(y);for(var M,R=Wo(w),B=vo(w),Q=B.length,ue=0;Q>ue;)vn.f(y,M=B[ue++],R[M]);return y}},pu=mr("IE_PROTO"),Js=function(){},Xl=function(y){return"<script>"+y+"<\/script>"},du=function(y){y.write(Xl("")),y.close();var w=y.parentWindow.Object;return y=null,w},Xu=function(){try{es=new ActiveXObject("htmlfile")}catch{}var y,w;Xu=typeof document<"u"?document.domain&&es?du(es):((w=va("iframe")).style.display="none",Yf.appendChild(w),w.src=String("javascript:"),(y=w.contentWindow.document).open(),y.write(Xl("document.F=Object")),y.close(),y.F):du(es);for(var M=Uo.length;M--;)delete Xu.prototype[Uo[M]];return Xu()};lr[pu]=!0;var eu=Object.create||function(y,w){var M;return y!==null?(Js.prototype=Ji(y),M=new Js,Js.prototype=null,M[pu]=y):M=Xu(),w===void 0?M:lo.f(M,w)},Tf=vn.f,rf=Mr("unscopables"),Yl=Array.prototype;Yl[rf]==null&&Tf(Yl,rf,{configurable:!0,value:eu(null)});var sl,Mf,ul,mc=function(y){Yl[rf][y]=!0},ql=!Z(function(){function y(){}return y.prototype.constructor=null,Object.getPrototypeOf(new y)!==y.prototype}),ls=mr("IE_PROTO"),Pl=Object,Ll=Pl.prototype,tu=ql?Pl.getPrototypeOf:function(y){var w=Gi(y);if(Rn(w,ls))return w[ls];var M=w.constructor;return xi(M)&&w instanceof M?M.prototype:w instanceof Pl?Ll:null},Pa=Mr("iterator"),Ou=!1;[].keys&&("next"in(ul=[].keys())?(Mf=tu(tu(ul)))!==Object.prototype&&(sl=Mf):Ou=!0),(sl==null||Z(function(){var y={};return sl[Pa].call(y)!==y}))&&(sl={}),xi(sl[Pa])||Aa(sl,Pa,function(){return this});var Bs={IteratorPrototype:sl,BUGGY_SAFARI_ITERATORS:Ou},gc=Bs.IteratorPrototype,kf=function(){return this},$h=cn.PROPER,Kh=cn.CONFIGURABLE,Yu=Bs.IteratorPrototype,Oc=Bs.BUGGY_SAFARI_ITERATORS,Fu=Mr("iterator"),If=function(){return this},Pf=function(y,w,M,R,B,Q,ue){(function(wn,nn,Hn,di){var yo=nn+" Iterator";wn.prototype=eu(gc,{next:oi(+!di,Hn)}),br(wn,yo,!1),Gs[yo]=kf})(M,w,R);var oe,Ae,Oe,Le=function(wn){if(wn===B&&Qr)return Qr;if(!Oc&&wn in gr)return gr[wn];switch(wn){case"keys":case"values":case"entries":return function(){return new M(this,wn)}}return function(){return new M(this)}},Dt=w+" Iterator",tr=!1,gr=y.prototype,Fr=gr[Fu]||gr["@@iterator"]||B&&gr[B],Qr=!Oc&&Fr||Le(B),hn=w=="Array"&&gr.entries||Fr;if(hn&&(oe=tu(hn.call(new y)))!==Object.prototype&&oe.next&&(tu(oe)!==Yu&&(ht?ht(oe,Yu):xi(oe[Fu])||Aa(oe,Fu,If)),br(oe,Dt,!0)),$h&&B=="values"&&Fr&&Fr.name!=="values"&&(Kh?Zi(gr,"name","values"):(tr=!0,Qr=function(){return hi(Fr,this)})),B)if(Ae={values:Le("values"),keys:Q?Qr:Le("keys"),entries:Le("entries")},ue)for(Oe in Ae)(Oc||tr||!(Oe in gr))&&Aa(gr,Oe,Ae[Oe]);else D({target:w,proto:!0,forced:Oc||tr},Ae);return gr[Fu]!==Qr&&Aa(gr,Fu,Qr,{name:B}),Gs[w]=Qr,Ae},$l=vn.f,ys=Li.set,Lf=Li.getterFor("Array Iterator"),Rl=Pf(Array,"Array",function(y,w){ys(this,{type:"Array Iterator",target:Wo(y),index:0,kind:w})},function(){var y=Lf(this),w=y.target,M=y.kind,R=y.index++;return!w||R>=w.length?(y.target=void 0,{value:void 0,done:!0}):M=="keys"?{value:R,done:!1}:M=="values"?{value:w[R],done:!1}:{value:[R,w[R]],done:!1}},"values"),yh=Gs.Arguments=Gs.Array;if(mc("keys"),mc("values"),mc("entries"),Qn&&yh.name!=="values")try{$l(yh,"name",{value:"values"})}catch{}var Cu,vu,ee,Ur=typeof ArrayBuffer<"u"&&typeof DataView<"u",Rf=vn.f,cd=Li.enforce,Ws=Li.get,mu=st.Int8Array,Kl=mu&&mu.prototype,Pp=st.Uint8ClampedArray,Of=Pp&&Pp.prototype,ru=mu&&tu(mu),ll=Kl&&tu(Kl),lv=Object.prototype,Dd=st.TypeError,Lp=Mr("toStringTag"),nh=Ca("TYPED_ARRAY_TAG"),nf=Ur&&!!ht&&oo(st.opera)!=="Opera",_h=!1,Ff={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},cs={BigInt64Array:8,BigUint64Array:8},Qh=function(y){var w=tu(y);if(Bn(w)){var M=Ws(w);return M&&Rn(M,"TypedArrayConstructor")?M.TypedArrayConstructor:Qh(w)}},fd=function(y){if(!Bn(y))return!1;var w=oo(y);return Rn(Ff,w)||Rn(cs,w)};for(Cu in Ff)(ee=(vu=st[Cu])&&vu.prototype)?cd(ee).TypedArrayConstructor=vu:nf=!1;for(Cu in cs)(ee=(vu=st[Cu])&&vu.prototype)&&(cd(ee).TypedArrayConstructor=vu);if((!nf||!xi(ru)||ru===Function.prototype)&&(ru=function(){throw Dd("Incorrect invocation")},nf))for(Cu in Ff)st[Cu]&&ht(st[Cu],ru);if((!nf||!ll||ll===lv)&&(ll=ru.prototype,nf))for(Cu in Ff)st[Cu]&&ht(st[Cu].prototype,ll);if(nf&&tu(Of)!==ll&&ht(Of,ll),Qn&&!Rn(ll,Lp))for(Cu in _h=!0,Rf(ll,Lp,{get:function(){return Bn(this)?this[nh]:void 0}}),Ff)st[Cu]&&Zi(st[Cu],nh,Cu);var Ui={NATIVE_ARRAY_BUFFER_VIEWS:nf,TYPED_ARRAY_TAG:_h&&nh,aTypedArray:function(y){if(fd(y))return y;throw Dd("Target is not a typed array")},aTypedArrayConstructor:function(y){if(xi(y)&&(!ht||fa(ru,y)))return y;throw Dd(be(y)+" is not a typed array constructor")},exportTypedArrayMethod:function(y,w,M,R){if(Qn){if(M)for(var B in Ff){var Q=st[B];if(Q&&Rn(Q.prototype,y))try{delete Q.prototype[y]}catch{try{Q.prototype[y]=w}catch{}}}ll[y]&&!M||Aa(ll,y,M?w:nf&&Kl[y]||w,R)}},exportTypedArrayStaticMethod:function(y,w,M){var R,B;if(Qn){if(ht){if(M){for(R in Ff)if((B=st[R])&&Rn(B,y))try{delete B[y]}catch{}}if(ru[y]&&!M)return;try{return Aa(ru,y,M?w:nf&&ru[y]||w)}catch{}}for(R in Ff)!(B=st[R])||B[y]&&!M||Aa(B,y,w)}},getTypedArrayConstructor:Qh,isView:function(y){if(!Bn(y))return!1;var w=oo(y);return w==="DataView"||Rn(Ff,w)||Rn(cs,w)},isTypedArray:fd,TypedArray:ru,TypedArrayPrototype:ll},Jh=Ui.NATIVE_ARRAY_BUFFER_VIEWS,ep=st.ArrayBuffer,af=st.Int8Array,Rp=!Jh||!Z(function(){af(1)})||!Z(function(){new af(-1)})||!io(function(y){new af,new af(null),new af(1.5),new af(y)},!0)||Z(function(){return new af(new ep(2),1,void 0).length!==1}),Su=function(y,w,M){for(var R in w)Aa(y,R,w[R],M);return y},tp=RangeError,of=function(y){if(y===void 0)return 0;var w=jn(y),M=xo(w);if(w!==M)throw tp("Wrong length or index");return M},hd=Array,ih=Math.abs,yc=Math.pow,xh=Math.floor,sf=Math.log,uf=Math.LN2,Op=function(y,w,M){var R,B,Q,ue=hd(M),oe=8*M-w-1,Ae=(1<<oe)-1,Oe=Ae>>1,Le=w===23?yc(2,-24)-yc(2,-77):0,Dt=y<0||y===0&&1/y<0?1:0,tr=0;for((y=ih(y))!=y||y===1/0?(B=y!=y?1:0,R=Ae):(R=xh(sf(y)/uf),y*(Q=yc(2,-R))<1&&(R--,Q*=2),(y+=R+Oe>=1?Le/Q:Le*yc(2,1-Oe))*Q>=2&&(R++,Q/=2),R+Oe>=Ae?(B=0,R=Ae):R+Oe>=1?(B=(y*Q-1)*yc(2,w),R+=Oe):(B=y*yc(2,Oe-1)*yc(2,w),R=0));w>=8;)ue[tr++]=255&B,B/=256,w-=8;for(R=R<<w|B,oe+=w;oe>0;)ue[tr++]=255&R,R/=256,oe-=8;return ue[--tr]|=128*Dt,ue},Du=function(y,w){var M,R=y.length,B=8*R-w-1,Q=(1<<B)-1,ue=Q>>1,oe=B-7,Ae=R-1,Oe=y[Ae--],Le=127&Oe;for(Oe>>=7;oe>0;)Le=256*Le+y[Ae--],oe-=8;for(M=Le&(1<<-oe)-1,Le>>=-oe,oe+=w;oe>0;)M=256*M+y[Ae--],oe-=8;if(Le===0)Le=1-ue;else{if(Le===Q)return M?NaN:Oe?-1/0:1/0;M+=yc(2,w),Le-=ue}return(Oe?-1:1)*M*yc(2,Le-w)},Fc=function(y){for(var w=Gi(this),M=To(w),R=arguments.length,B=Ta(R>1?arguments[1]:void 0,M),Q=R>2?arguments[2]:void 0,ue=Q===void 0?M:Ta(Q,M);ue>B;)w[B++]=y;return w},Bu=Array,Fp=Math.max,Df=function(y,w,M){for(var R=To(y),B=Ta(w,R),Q=Ta(M===void 0?R:M,R),ue=Bu(Fp(Q-B,0)),oe=0;B<Q;B++,oe++)ui(ue,oe,y[B]);return ue.length=oe,ue},Dp=Fa.f,Ql=vn.f,bh=cn.PROPER,Bd=cn.CONFIGURABLE,Bf=Li.get,pd=Li.set,Jl=st.ArrayBuffer,cl=Jl,Nu=cl&&cl.prototype,Dc=st.DataView,lf=Dc&&Dc.prototype,Eh=Object.prototype,Bc=st.Array,Bp=st.RangeError,Nd=yt(Fc),Nc=yt([].reverse),Ch=Op,ah=Du,Nf=function(y){return[255&y]},zd=function(y){return[255&y,y>>8&255]},fl=function(y){return[255&y,y>>8&255,y>>16&255,y>>24&255]},Sh=function(y){return y[3]<<24|y[2]<<16|y[1]<<8|y[0]},Ud=function(y){return Ch(y,23,4)},$a=function(y){return Ch(y,52,8)},wu=function(y,w){Ql(y.prototype,w,{get:function(){return Bf(this)[w]}})},Fo=function(y,w,M,R){var B=of(M),Q=Bf(y);if(B+w>Q.byteLength)throw Bp("Wrong index");var ue=Bf(Q.buffer).bytes,oe=B+Q.byteOffset,Ae=Df(ue,oe,oe+w);return R?Ae:Nc(Ae)},Ms=function(y,w,M,R,B,Q){var ue=of(M),oe=Bf(y);if(ue+w>oe.byteLength)throw Bp("Wrong index");for(var Ae=Bf(oe.buffer).bytes,Oe=ue+oe.byteOffset,Le=R(+B),Dt=0;Dt<w;Dt++)Ae[Oe+Dt]=Le[Q?Dt:w-Dt-1]};if(Ur){var Zd=bh&&Jl.name!=="ArrayBuffer";if(Z(function(){Jl(1)})&&Z(function(){new Jl(-1)})&&!Z(function(){return new Jl,new Jl(1.5),new Jl(NaN),Zd&&!Bd}))Zd&&Bd&&Zi(Jl,"name","ArrayBuffer");else{(cl=function(y){return ia(this,Nu),new Jl(of(y))}).prototype=Nu;for(var dd,a0=Dp(Jl),Vd=0;a0.length>Vd;)(dd=a0[Vd++])in cl||Zi(cl,dd,Jl[dd]);Nu.constructor=cl}ht&&tu(lf)!==Eh&&ht(lf,Eh);var jd=new Dc(new cl(2)),wh=yt(lf.setInt8);jd.setInt8(0,2147483648),jd.setInt8(1,2147483649),!jd.getInt8(0)&&jd.getInt8(1)||Su(lf,{setInt8:function(y,w){wh(this,y,w<<24>>24)},setUint8:function(y,w){wh(this,y,w<<24>>24)}},{unsafe:!0})}else Nu=(cl=function(y){ia(this,Nu);var w=of(y);pd(this,{bytes:Nd(Bc(w),0),byteLength:w}),Qn||(this.byteLength=w)}).prototype,lf=(Dc=function(y,w,M){ia(this,lf),ia(y,Nu);var R=Bf(y).byteLength,B=jn(w);if(B<0||B>R)throw Bp("Wrong offset");if(B+(M=M===void 0?R-B:xo(M))>R)throw Bp("Wrong length");pd(this,{buffer:y,byteLength:M,byteOffset:B}),Qn||(this.buffer=y,this.byteLength=M,this.byteOffset=B)}).prototype,Qn&&(wu(cl,"byteLength"),wu(Dc,"buffer"),wu(Dc,"byteLength"),wu(Dc,"byteOffset")),Su(lf,{getInt8:function(y){return Fo(this,1,y)[0]<<24>>24},getUint8:function(y){return Fo(this,1,y)[0]},getInt16:function(y){var w=Fo(this,2,y,arguments.length>1?arguments[1]:void 0);return(w[1]<<8|w[0])<<16>>16},getUint16:function(y){var w=Fo(this,2,y,arguments.length>1?arguments[1]:void 0);return w[1]<<8|w[0]},getInt32:function(y){return Sh(Fo(this,4,y,arguments.length>1?arguments[1]:void 0))},getUint32:function(y){return Sh(Fo(this,4,y,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(y){return ah(Fo(this,4,y,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(y){return ah(Fo(this,8,y,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(y,w){Ms(this,1,y,Nf,w)},setUint8:function(y,w){Ms(this,1,y,Nf,w)},setInt16:function(y,w){Ms(this,2,y,zd,w,arguments.length>2?arguments[2]:void 0)},setUint16:function(y,w){Ms(this,2,y,zd,w,arguments.length>2?arguments[2]:void 0)},setInt32:function(y,w){Ms(this,4,y,fl,w,arguments.length>2?arguments[2]:void 0)},setUint32:function(y,w){Ms(this,4,y,fl,w,arguments.length>2?arguments[2]:void 0)},setFloat32:function(y,w){Ms(this,4,y,Ud,w,arguments.length>2?arguments[2]:void 0)},setFloat64:function(y,w){Ms(this,8,y,$a,w,arguments.length>2?arguments[2]:void 0)}});br(cl,"ArrayBuffer"),br(Dc,"DataView");var o0={ArrayBuffer:cl,DataView:Dc},s0=Math.floor,rp=Number.isInteger||function(y){return!Bn(y)&&isFinite(y)&&s0(y)===y},F0=RangeError,u0=RangeError,zf=function(y,w){var M=function(R){var B=jn(R);if(B<0)throw F0("The argument can't be less than 0");return B}(y);if(M%w)throw u0("Wrong offset");return M},Eo=Ui.aTypedArrayConstructor,vd=function(y){var w,M,R,B,Q,ue,oe=jh(this),Ae=Gi(y),Oe=arguments.length,Le=Oe>1?arguments[1]:void 0,Dt=Le!==void 0,tr=Hs(Ae);if(tr&&!Jc(tr))for(ue=(Q=ci(Ae,tr)).next,Ae=[];!(B=hi(ue,Q)).done;)Ae.push(B.value);for(Dt&&Oe>2&&(Le=Pu(Le,arguments[2])),M=To(Ae),R=new(Eo(oe))(M),w=0;M>w;w++)R[w]=Dt?Le(Ae[w],w):Ae[w];return R},cf=function(y,w,M){var R,B;return ht&&xi(R=w.constructor)&&R!==M&&Bn(B=R.prototype)&&B!==M.prototype&&ht(y,B),y},Ah=_i(function(y){var w=Fa.f,M=Bt.forEach,R=Li.get,B=Li.set,Q=Li.enforce,ue=vn.f,oe=Me.f,Ae=Math.round,Oe=st.RangeError,Le=o0.ArrayBuffer,Dt=Le.prototype,tr=o0.DataView,gr=Ui.NATIVE_ARRAY_BUFFER_VIEWS,Fr=Ui.TYPED_ARRAY_TAG,Qr=Ui.TypedArray,hn=Ui.TypedArrayPrototype,wn=Ui.aTypedArrayConstructor,nn=Ui.isTypedArray,Hn=function(Qa,Nr){wn(Qa);for(var Wr=0,ki=Nr.length,ja=new Qa(ki);ki>Wr;)ja[Wr]=Nr[Wr++];return ja},di=function(Qa,Nr){ue(Qa,Nr,{get:function(){return R(this)[Nr]}})},yo=function(Qa){var Nr;return fa(Dt,Qa)||(Nr=oo(Qa))=="ArrayBuffer"||Nr=="SharedArrayBuffer"},Ka=function(Qa,Nr){return nn(Qa)&&!ne(Nr)&&Nr in Qa&&rp(+Nr)&&Nr>=0},Va=function(Qa,Nr){return Nr=zt(Nr),Ka(Qa,Nr)?oi(2,Qa[Nr]):oe(Qa,Nr)},Xa=function(Qa,Nr,Wr){return Nr=zt(Nr),!(Ka(Qa,Nr)&&Bn(Wr)&&Rn(Wr,"value"))||Rn(Wr,"get")||Rn(Wr,"set")||Wr.configurable||Rn(Wr,"writable")&&!Wr.writable||Rn(Wr,"enumerable")&&!Wr.enumerable?ue(Qa,Nr,Wr):(Qa[Nr]=Wr.value,Qa)};Qn?(gr||(Me.f=Va,vn.f=Xa,di(hn,"buffer"),di(hn,"byteOffset"),di(hn,"byteLength"),di(hn,"length")),D({target:"Object",stat:!0,forced:!gr},{getOwnPropertyDescriptor:Va,defineProperty:Xa}),y.exports=function(Qa,Nr,Wr){var ki=Qa.match(/\d+$/)[0]/8,ja=Qa+(Wr?"Clamped":"")+"Array",ha="get"+Qa,Qu="set"+Qa,Nl=st[ja],ds=Nl,zl=ds&&ds.prototype,Ss={},Fh=function(Zu,vs){ue(Zu,vs,{get:function(){return function(rc,Vu){var nc=R(rc);return nc.view[ha](Vu*ki+nc.byteOffset,!0)}(this,vs)},set:function(rc){return function(Vu,nc,lh){var id=R(Vu);Wr&&(lh=(lh=Ae(lh))<0?0:lh>255?255:255&lh),id.view[Qu](nc*ki+id.byteOffset,lh,!0)}(this,vs,rc)},enumerable:!0})};gr?Rp&&(ds=Nr(function(Zu,vs,rc,Vu){return ia(Zu,zl),cf(Bn(vs)?yo(vs)?Vu!==void 0?new Nl(vs,zf(rc,ki),Vu):rc!==void 0?new Nl(vs,zf(rc,ki)):new Nl(vs):nn(vs)?Hn(ds,vs):hi(vd,ds,vs):new Nl(of(vs)),Zu,ds)}),ht&&ht(ds,Qr),M(w(Nl),function(Zu){Zu in ds||Zi(ds,Zu,Nl[Zu])}),ds.prototype=zl):(ds=Nr(function(Zu,vs,rc,Vu){ia(Zu,zl);var nc,lh,id,pm=0,Tv=0;if(Bn(vs)){if(!yo(vs))return nn(vs)?Hn(ds,vs):hi(vd,ds,vs);nc=vs,Tv=zf(rc,ki);var dm=vs.byteLength;if(Vu===void 0){if(dm%ki||(lh=dm-Tv)<0)throw Oe("Wrong length")}else if((lh=xo(Vu)*ki)+Tv>dm)throw Oe("Wrong length");id=lh/ki}else id=of(vs),nc=new Le(lh=id*ki);for(B(Zu,{buffer:nc,byteOffset:Tv,byteLength:lh,length:id,view:new tr(nc)});pm<id;)Fh(Zu,pm++)}),ht&&ht(ds,Qr),zl=ds.prototype=eu(hn)),zl.constructor!==ds&&Zi(zl,"constructor",ds),Q(zl).TypedArrayConstructor=ds,Fr&&Zi(zl,Fr,ja);var bp=ds!=Nl;Ss[ja]=ds,D({global:!0,constructor:!0,forced:bp,sham:!gr},Ss),"BYTES_PER_ELEMENT"in ds||Zi(ds,"BYTES_PER_ELEMENT",ki),"BYTES_PER_ELEMENT"in zl||Zi(zl,"BYTES_PER_ELEMENT",ki),Ni(ja)}):y.exports=function(){}});Ah("Uint8",function(y){return function(w,M,R){return y(this,w,M,R)}},!0);var Gd=TypeError,Np=function(y,w){if(!delete y[w])throw Gd("Cannot delete property "+be(w)+" of "+be(y))},H=Math.min,Se=yt([].copyWithin||function(y,w){var M=Gi(this),R=To(M),B=Ta(y,R),Q=Ta(w,R),ue=arguments.length>2?arguments[2]:void 0,oe=H((ue===void 0?R:Ta(ue,R))-Q,R-B),Ae=1;for(Q<B&&B<Q+oe&&(Ae=-1,Q+=oe-1,B+=oe-1);oe-- >0;)Q in M?M[B]=M[Q]:Np(M,B),B+=Ae,Q+=Ae;return M}),He=Ui.aTypedArray;(0,Ui.exportTypedArrayMethod)("copyWithin",function(y,w){return Se(He(this),y,w,arguments.length>2?arguments[2]:void 0)});var Ht=Bt.every,Er=Ui.aTypedArray;(0,Ui.exportTypedArrayMethod)("every",function(y){return Ht(Er(this),y,arguments.length>1?arguments[1]:void 0)});var Vt=TypeError,sr=function(y){var w=Sr(y,"number");if(typeof w=="number")throw Vt("Can't convert number to bigint");return BigInt(w)},kr=Ui.aTypedArray,Dr=Ui.exportTypedArrayMethod,jr=yt("".slice);Dr("fill",function(y){var w=arguments.length;kr(this);var M=jr(oo(this),0,3)==="Big"?sr(y):+y;return hi(Fc,this,M,w>1?arguments[1]:void 0,w>2?arguments[2]:void 0)},Z(function(){var y=0;return new Int8Array(2).fill({valueOf:function(){return y++}}),y!==1}));var qr=Ui.aTypedArrayConstructor,$r=Ui.getTypedArrayConstructor,gn=function(y){return qr(fh(y,$r(y)))},Zr=function(y,w){return function(M,R){for(var B=0,Q=To(R),ue=new M(Q);Q>B;)ue[B]=R[B++];return ue}(gn(y),w)},Xr=Bt.filter,Ct=Ui.aTypedArray;(0,Ui.exportTypedArrayMethod)("filter",function(y){var w=Xr(Ct(this),y,arguments.length>1?arguments[1]:void 0);return Zr(this,w)});var er=Bt.find,Gr=Ui.aTypedArray;(0,Ui.exportTypedArrayMethod)("find",function(y){return er(Gr(this),y,arguments.length>1?arguments[1]:void 0)});var fn=Bt.findIndex,wr=Ui.aTypedArray;(0,Ui.exportTypedArrayMethod)("findIndex",function(y){return fn(wr(this),y,arguments.length>1?arguments[1]:void 0)});var Kr=Bt.forEach,Mn=Ui.aTypedArray;(0,Ui.exportTypedArrayMethod)("forEach",function(y){Kr(Mn(this),y,arguments.length>1?arguments[1]:void 0)});var pi=js.includes,or=Ui.aTypedArray;(0,Ui.exportTypedArrayMethod)("includes",function(y){return pi(or(this),y,arguments.length>1?arguments[1]:void 0)});var dr=js.indexOf,qn=Ui.aTypedArray;(0,Ui.exportTypedArrayMethod)("indexOf",function(y){return dr(qn(this),y,arguments.length>1?arguments[1]:void 0)});var xn=Mr("iterator"),Hr=st.Uint8Array,pn=yt(Rl.values),kn=yt(Rl.keys),Qi=yt(Rl.entries),Ri=Ui.aTypedArray,yn=Ui.exportTypedArrayMethod,bn=Hr&&Hr.prototype,Ai=!Z(function(){bn[xn].call([1])}),Xi=!!bn&&bn.values&&bn[xn]===bn.values&&bn.values.name==="values",xa=function(){return pn(Ri(this))};yn("entries",function(){return Qi(Ri(this))},Ai),yn("keys",function(){return kn(Ri(this))},Ai),yn("values",xa,Ai||!Xi,{name:"values"}),yn(xn,xa,Ai||!Xi,{name:"values"});var $o=Ui.aTypedArray,Ko=Ui.exportTypedArrayMethod,ma=yt([].join);Ko("join",function(y){return ma($o(this),y)});var Xs=Math.min,Mo=[].lastIndexOf,Ns=!!Mo&&1/[1].lastIndexOf(1,-0)<0,rs=nr("lastIndexOf"),Ys=Ns||!rs?function(y){if(Ns)return bl(Mo,this,arguments)||0;var w=Wo(this),M=To(w),R=M-1;for(arguments.length>1&&(R=Xs(R,jn(arguments[1]))),R<0&&(R=M+R);R>=0;R--)if(R in w&&w[R]===y)return R||0;return-1}:Mo,zs=Ui.aTypedArray;(0,Ui.exportTypedArrayMethod)("lastIndexOf",function(y){var w=arguments.length;return bl(Ys,zs(this),w>1?[y,arguments[1]]:[y])});var Us=Bt.map,Qo=Ui.aTypedArray;(0,Ui.exportTypedArrayMethod)("map",function(y){return Us(Qo(this),y,arguments.length>1?arguments[1]:void 0,function(w,M){return new(gn(w))(M)})});var ta=TypeError,ks=function(y){return function(w,M,R,B){Ye(M);var Q=Gi(w),ue=el(Q),oe=To(Q),Ae=y?oe-1:0,Oe=y?-1:1;if(R<2)for(;;){if(Ae in ue){B=ue[Ae],Ae+=Oe;break}if(Ae+=Oe,y?Ae<0:oe<=Ae)throw ta("Reduce of empty array with no initial value")}for(;y?Ae>=0:oe>Ae;Ae+=Oe)Ae in ue&&(B=M(B,ue[Ae],Ae,Q));return B}},La={left:ks(!1),right:ks(!0)},nu=La.left,zi=Ui.aTypedArray;(0,Ui.exportTypedArrayMethod)("reduce",function(y){var w=arguments.length;return nu(zi(this),y,w,w>1?arguments[1]:void 0)});var ba=La.right,Ha=Ui.aTypedArray;(0,Ui.exportTypedArrayMethod)("reduceRight",function(y){var w=arguments.length;return ba(Ha(this),y,w,w>1?arguments[1]:void 0)});var _s=Ui.aTypedArray,ff=Ui.exportTypedArrayMethod,De=Math.floor;ff("reverse",function(){for(var y,w=_s(this).length,M=De(w/2),R=0;R<M;)y=this[R],this[R++]=this[--w],this[w]=y;return this});var Wt=st.RangeError,Lt=st.Int8Array,Un=Lt&&Lt.prototype,Ea=Un&&Un.set,Re=Ui.aTypedArray,ge=Ui.exportTypedArrayMethod,Qe=!Z(function(){var y=new Uint8ClampedArray(2);return hi(Ea,y,{length:1,0:3},1),y[1]!==3}),wt=Qe&&Ui.NATIVE_ARRAY_BUFFER_VIEWS&&Z(function(){var y=new Lt(2);return y.set(1),y.set("2",1),y[0]!==0||y[1]!==2});ge("set",function(y){Re(this);var w=zf(arguments.length>1?arguments[1]:void 0,1),M=Gi(y);if(Qe)return hi(Ea,this,M,w);var R=this.length,B=To(M),Q=0;if(B+w>R)throw Wt("Wrong length");for(;Q<B;)this[w+Q]=M[Q++]},!Qe||wt);var Ut=Ui.aTypedArray;(0,Ui.exportTypedArrayMethod)("slice",function(y,w){for(var M=El(Ut(this),y,w),R=gn(this),B=0,Q=M.length,ue=new R(Q);Q>B;)ue[B]=M[B++];return ue},Z(function(){new Int8Array(1).slice()}));var ot=Bt.some,Ge=Ui.aTypedArray;(0,Ui.exportTypedArrayMethod)("some",function(y){return ot(Ge(this),y,arguments.length>1?arguments[1]:void 0)});var mt=Math.floor,we=function(y,w){var M=y.length,R=mt(M/2);return M<8?Ke(y,w):Ie(y,we(Df(y,0,R),w),we(Df(y,R),w),w)},Ke=function(y,w){for(var M,R,B=y.length,Q=1;Q<B;){for(R=Q,M=y[Q];R&&w(y[R-1],M)>0;)y[R]=y[--R];R!==Q++&&(y[R]=M)}return y},Ie=function(y,w,M,R){for(var B=w.length,Q=M.length,ue=0,oe=0;ue<B||oe<Q;)y[ue+oe]=ue<B&&oe<Q?R(w[ue],M[oe])<=0?w[ue++]:M[oe++]:ue<B?w[ue++]:M[oe++];return y},gt=we,Pt=mi.match(/firefox\/(\d+)/i),Ar=!!Pt&&+Pt[1],ln=/MSIE|Trident/.test(mi),_n=mi.match(/AppleWebKit\/(\d+)\./),Ln=!!_n&&+_n[1],dn=Ui.aTypedArray,ni=Ui.exportTypedArrayMethod,In=st.Uint16Array,En=In&&yt(In.prototype.sort),Jn=!(!En||Z(function(){En(new In(2),null)})&&Z(function(){En(new In(2),{})})),Gn=!!En&&!Z(function(){if(pe)return pe<74;if(Ar)return Ar<67;if(ln)return!0;if(Ln)return Ln<602;var y,w,M=new In(516),R=Array(516);for(y=0;y<516;y++)w=y%4,M[y]=515-y,R[y]=y-2*w+3;for(En(M,function(B,Q){return(B/4|0)-(Q/4|0)}),y=0;y<516;y++)if(M[y]!==R[y])return!0});ni("sort",function(y){return y!==void 0&&Ye(y),Gn?En(this,y):gt(dn(this),function(w){return function(M,R){return w!==void 0?+w(M,R)||0:R!=R?-1:M!=M?1:M===0&&R===0?1/M>0&&1/R<0?1:-1:M>R}}(y))},!Gn||Jn);var Oi=Ui.aTypedArray;(0,Ui.exportTypedArrayMethod)("subarray",function(y,w){var M=Oi(this),R=M.length,B=Ta(y,R);return new(gn(M))(M.buffer,M.byteOffset+B*M.BYTES_PER_ELEMENT,xo((w===void 0?R:Ta(w,R))-B))});var Ma=st.Int8Array,Is=Ui.aTypedArray,co=Ui.exportTypedArrayMethod,Ua=[].toLocaleString,zc=!!Ma&&Z(function(){Ua.call(new Ma(1))});co("toLocaleString",function(){return bl(Ua,zc?El(Is(this)):Is(this),El(arguments))},Z(function(){return[1,2].toLocaleString()!=new Ma([1,2]).toLocaleString()})||!Z(function(){Ma.prototype.toLocaleString.call([1,2])}));var iu=Ui.exportTypedArrayMethod,hl=st.Uint8Array,Ol=hl&&hl.prototype||{},Th=[].toString,pl=yt([].join);Z(function(){Th.call({})})&&(Th=function(){return pl(this)});var Uf=Ol.toString!=Th;iu("toString",Th,Uf);var np,Hd,Do=String,qs=function(y){if(oo(y)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return Do(y)},oh=function(){var y=Ji(this),w="";return y.hasIndices&&(w+="d"),y.global&&(w+="g"),y.ignoreCase&&(w+="i"),y.multiline&&(w+="m"),y.dotAll&&(w+="s"),y.unicode&&(w+="u"),y.unicodeSets&&(w+="v"),y.sticky&&(w+="y"),w},md=st.RegExp,gd=Z(function(){var y=md("a","y");return y.lastIndex=2,y.exec("abcd")!=null}),D0=gd||Z(function(){return!md("a","y").sticky}),yd={BROKEN_CARET:gd||Z(function(){var y=md("^r","gy");return y.lastIndex=2,y.exec("str")!=null}),MISSED_STICKY:D0,UNSUPPORTED_Y:gd},Mh=st.RegExp,l0=Z(function(){var y=Mh(".","s");return!(y.dotAll&&y.exec(`
`)&&y.flags==="s")}),Br=st.RegExp,Hv=Z(function(){var y=Br("(?<a>b)","g");return y.exec("b").groups.a!=="b"||"b".replace(y,"$<a>c")!=="bc"}),au=Li.get,kh=Ee("native-string-replace",String.prototype.replace),Wd=RegExp.prototype.exec,n=Wd,s=yt("".charAt),l=yt("".indexOf),d=yt("".replace),_=yt("".slice),C=(Hd=/b*/g,hi(Wd,np=/a/,"a"),hi(Wd,Hd,"a"),np.lastIndex!==0||Hd.lastIndex!==0),A=yd.BROKEN_CARET,L=/()??/.exec("")[1]!==void 0;(C||L||A||l0||Hv)&&(n=function(y){var w,M,R,B,Q,ue,oe,Ae=this,Oe=au(Ae),Le=qs(y),Dt=Oe.raw;if(Dt)return Dt.lastIndex=Ae.lastIndex,w=hi(n,Dt,Le),Ae.lastIndex=Dt.lastIndex,w;var tr=Oe.groups,gr=A&&Ae.sticky,Fr=hi(oh,Ae),Qr=Ae.source,hn=0,wn=Le;if(gr&&(Fr=d(Fr,"y",""),l(Fr,"g")===-1&&(Fr+="g"),wn=_(Le,Ae.lastIndex),Ae.lastIndex>0&&(!Ae.multiline||Ae.multiline&&s(Le,Ae.lastIndex-1)!==`
`)&&(Qr="(?: "+Qr+")",wn=" "+wn,hn++),M=new RegExp("^(?:"+Qr+")",Fr)),L&&(M=new RegExp("^"+Qr+"$(?!\\s)",Fr)),C&&(R=Ae.lastIndex),B=hi(Wd,gr?M:Ae,wn),gr?B?(B.input=_(B.input,hn),B[0]=_(B[0],hn),B.index=Ae.lastIndex,Ae.lastIndex+=B[0].length):Ae.lastIndex=0:C&&B&&(Ae.lastIndex=Ae.global?B.index+B[0].length:R),L&&B&&B.length>1&&hi(kh,B[0],M,function(){for(Q=1;Q<arguments.length-2;Q++)arguments[Q]===void 0&&(B[Q]=void 0)}),B&&tr)for(B.groups=ue=eu(null),Q=0;Q<tr.length;Q++)ue[(oe=tr[Q])[0]]=B[oe[1]];return B});var z=n;D({target:"RegExp",proto:!0,forced:/./.exec!==z},{exec:z});var W,q=Mr("species"),J=RegExp.prototype,se=function(y,w,M,R){var B=Mr(y),Q=!Z(function(){var Oe={};return Oe[B]=function(){return 7},""[y](Oe)!=7}),ue=Q&&!Z(function(){var Oe=!1,Le=/a/;return y==="split"&&((Le={}).constructor={},Le.constructor[q]=function(){return Le},Le.flags="",Le[B]=/./[B]),Le.exec=function(){return Oe=!0,null},Le[B](""),!Oe});if(!Q||!ue||M){var oe=yt(/./[B]),Ae=w(B,""[y],function(Oe,Le,Dt,tr,gr){var Fr=yt(Oe),Qr=Le.exec;return Qr===z||Qr===J.exec?Q&&!gr?{done:!0,value:oe(Le,Dt,tr)}:{done:!0,value:Fr(Dt,Le,tr)}:{done:!1}});Aa(String.prototype,y,Ae[0]),Aa(J,B,Ae[1])}R&&Zi(J[B],"sham",!0)},de=yt("".charAt),Be=yt("".charCodeAt),Ve=yt("".slice),at=function(y){return function(w,M){var R,B,Q=qs(Xn(w)),ue=jn(M),oe=Q.length;return ue<0||ue>=oe?y?"":void 0:(R=Be(Q,ue))<55296||R>56319||ue+1===oe||(B=Be(Q,ue+1))<56320||B>57343?y?de(Q,ue):R:y?Ve(Q,ue,ue+2):B-56320+(R-55296<<10)+65536}},$e={codeAt:at(!1),charAt:at(!0)},Et=$e.charAt,Rt=function(y,w,M){return w+(M?Et(y,w).length:1)},Jt=Math.floor,$t=yt("".charAt),Cr=yt("".replace),Yr=yt("".slice),Sn=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,yi=/\$([$&'`]|\d{1,2})/g,Zn=function(y,w,M,R,B,Q){var ue=M+y.length,oe=R.length,Ae=yi;return B!==void 0&&(B=Gi(B),Ae=Sn),Cr(Q,Ae,function(Oe,Le){var Dt;switch($t(Le,0)){case"$":return"$";case"&":return y;case"`":return Yr(w,0,M);case"'":return Yr(w,ue);case"<":Dt=B[Yr(Le,1,-1)];break;default:var tr=+Le;if(tr===0)return Oe;if(tr>oe){var gr=Jt(tr/10);return gr===0?Oe:gr<=oe?R[gr-1]===void 0?$t(Le,1):R[gr-1]+$t(Le,1):Oe}Dt=R[tr-1]}return Dt===void 0?"":Dt})},bi=TypeError,Nn=function(y,w){var M=y.exec;if(xi(M)){var R=hi(M,y,w);return R!==null&&Ji(R),R}if(pa(y)==="RegExp")return hi(z,y,w);throw bi("RegExp#exec called on incompatible receiver")},la=Mr("replace"),Mi=Math.max,li=Math.min,vr=yt([].concat),ra=yt([].push),At=yt("".indexOf),Ei=yt("".slice),Wa="a".replace(/./,"$0")==="$0",jo=!!/./[la]&&/./[la]("a","$0")==="";function fs(y){this.message=y}se("replace",function(y,w,M){var R=jo?"$":"$0";return[function(B,Q){var ue=Xn(this),oe=B==null?void 0:lt(B,la);return oe?hi(oe,B,ue,Q):hi(w,qs(ue),B,Q)},function(B,Q){var ue=Ji(this),oe=qs(B);if(typeof Q=="string"&&At(Q,R)===-1&&At(Q,"$<")===-1){var Ae=M(w,ue,oe,Q);if(Ae.done)return Ae.value}var Oe=xi(Q);Oe||(Q=qs(Q));var Le=ue.global;if(Le){var Dt=ue.unicode;ue.lastIndex=0}for(var tr=[];;){var gr=Nn(ue,oe);if(gr===null||(ra(tr,gr),!Le))break;qs(gr[0])===""&&(ue.lastIndex=Rt(oe,xo(ue.lastIndex),Dt))}for(var Fr,Qr="",hn=0,wn=0;wn<tr.length;wn++){for(var nn=qs((gr=tr[wn])[0]),Hn=Mi(li(jn(gr.index),oe.length),0),di=[],yo=1;yo<gr.length;yo++)ra(di,(Fr=gr[yo])===void 0?Fr:String(Fr));var Ka=gr.groups;if(Oe){var Va=vr([nn],di,Hn,oe);Ka!==void 0&&ra(Va,Ka);var Xa=qs(bl(Q,void 0,Va))}else Xa=Zn(nn,oe,Hn,di,Ka,Q);Hn>=hn&&(Qr+=Ei(oe,hn,Hn)+Xa,hn=Hn+nn.length)}return Qr+Ei(oe,hn)}]},!!Z(function(){var y=/./;return y.exec=function(){var w=[];return w.groups={a:"7"},w},"".replace(y,"$<a>")!=="7"})||!Wa||jo),fs.prototype=new Error,fs.prototype.name="InvalidCharacterError",D({global:!0},{globalThis:st}),W=typeof window>"u"?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(y){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(y){return null},clearMeasures:function(y){return null},clearMarks:function(y){return null},measure:function(y,w,M){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(y){return!0},Event:function(y,w){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0?my.getSystemInfoSync().pixelRatio:W.devicePixelRatio;var ns=TypeError,mo=function(y){if(y>9007199254740991)throw ns("Maximum allowed index exceeded");return y},xs=fi("splice"),ou=Math.max,$s=Math.min;D({target:"Array",proto:!0,forced:!xs},{splice:function(y,w){var M,R,B,Q,ue,oe,Ae=Gi(this),Oe=To(Ae),Le=Ta(y,Oe),Dt=arguments.length;for(Dt===0?M=R=0:Dt===1?(M=0,R=Oe-Le):(M=Dt-2,R=$s(ou(jn(w),0),Oe-Le)),mo(Oe+M-R),B=pt(Ae,R),Q=0;Q<R;Q++)(ue=Le+Q)in Ae&&ui(B,Q,Ae[ue]);if(B.length=R,M<R){for(Q=Le;Q<Oe-R;Q++)oe=Q+M,(ue=Q+R)in Ae?Ae[oe]=Ae[ue]:Np(Ae,oe);for(Q=Oe;Q>Oe-R+M;Q--)Np(Ae,Q-1)}else if(M>R)for(Q=Oe-R;Q>Le;Q--)oe=Q+M-1,(ue=Q+R-1)in Ae?Ae[oe]=Ae[ue]:Np(Ae,oe);for(Q=0;Q<M;Q++)Ae[Q+Le]=arguments[Q+2];return Ae.length=Oe-R+M,B}});var zu=Xe(function y(w,M){rt(this,y),Kt(this,"cancelBubble",void 0),Kt(this,"cancelable",void 0),Kt(this,"target",void 0),Kt(this,"currentTarget",void 0),Kt(this,"preventDefault",void 0),Kt(this,"stopPropagation",void 0),Kt(this,"type",void 0),Kt(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=w,this.timeStamp=Date.now()}),hs=Object.assign,Au=Object.defineProperty,bs=yt([].concat),su=!hs||Z(function(){if(Qn&&hs({b:1},hs(Au({},"a",{enumerable:!0,get:function(){Au(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var y={},w={},M=Symbol();return y[M]=7,"abcdefghijklmnopqrst".split("").forEach(function(R){w[R]=R}),hs({},y)[M]!=7||vo(hs({},w)).join("")!="abcdefghijklmnopqrst"})?function(y,w){for(var M=Gi(y),R=arguments.length,B=1,Q=As.f,ue=Ps.f;R>B;)for(var oe,Ae=el(arguments[B++]),Oe=Q?bs(vo(Ae),Q(Ae)):vo(Ae),Le=Oe.length,Dt=0;Le>Dt;)oe=Oe[Dt++],Qn&&!hi(ue,Ae,oe)||(M[oe]=Ae[oe]);return M}:hs;D({target:"Object",stat:!0,arity:2,forced:Object.assign!==su},{assign:su});var wa=Bt.findIndex,Co=!0;"findIndex"in[]&&Array(1).findIndex(function(){Co=!1}),D({target:"Array",proto:!0,forced:Co},{findIndex:function(y){return wa(this,y,arguments.length>1?arguments[1]:void 0)}}),mc("findIndex");var go=$e.charAt,Za=Li.set,dl=Li.getterFor("String Iterator");Pf(String,"String",function(y){Za(this,{type:"String Iterator",string:qs(y),index:0})},function(){var y,w=dl(this),M=w.string,R=w.index;return R>=M.length?{value:void 0,done:!0}:(y=go(M,R),w.index+=y.length,{value:y,done:!1})});var Tu=Fa.f,Go=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Zs={f:function(y){return Go&&pa(y)=="Window"?function(w){try{return Tu(w)}catch{return Df(Go)}}(y):Tu(Wo(y))}},gu=Z(function(){if(typeof ArrayBuffer=="function"){var y=new ArrayBuffer(8);Object.isExtensible(y)&&Object.defineProperty(y,"a",{value:8})}}),Da=Object.isExtensible,vl=Z(function(){Da(1)})||gu?function(y){return!!Bn(y)&&(!gu||pa(y)!="ArrayBuffer")&&(!Da||Da(y))}:Da,_c=!Z(function(){return Object.isExtensible(Object.preventExtensions({}))}),Fl=_i(function(y){var w=vn.f,M=!1,R=Ca("meta"),B=0,Q=function(oe){w(oe,R,{value:{objectID:"O"+B++,weakData:{}}})},ue=y.exports={enable:function(){ue.enable=function(){},M=!0;var oe=Fa.f,Ae=yt([].splice),Oe={};Oe[R]=1,oe(Oe).length&&(Fa.f=function(Le){for(var Dt=oe(Le),tr=0,gr=Dt.length;tr<gr;tr++)if(Dt[tr]===R){Ae(Dt,tr,1);break}return Dt},D({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Zs.f}))},fastKey:function(oe,Ae){if(!Bn(oe))return typeof oe=="symbol"?oe:(typeof oe=="string"?"S":"P")+oe;if(!Rn(oe,R)){if(!vl(oe))return"F";if(!Ae)return"E";Q(oe)}return oe[R].objectID},getWeakData:function(oe,Ae){if(!Rn(oe,R)){if(!vl(oe))return!0;if(!Ae)return!1;Q(oe)}return oe[R].weakData},onFreeze:function(oe){return _c&&M&&vl(oe)&&!Rn(oe,R)&&Q(oe),oe}};lr[R]=!0}),Es=(Fl.enable,Fl.fastKey,Fl.getWeakData,Fl.onFreeze,function(y,w,M){var R=y.indexOf("Map")!==-1,B=y.indexOf("Weak")!==-1,Q=R?"set":"add",ue=st[y],oe=ue&&ue.prototype,Ae=ue,Oe={},Le=function(hn){var wn=yt(oe[hn]);Aa(oe,hn,hn=="add"?function(nn){return wn(this,nn===0?0:nn),this}:hn=="delete"?function(nn){return!(B&&!Bn(nn))&&wn(this,nn===0?0:nn)}:hn=="get"?function(nn){return B&&!Bn(nn)?void 0:wn(this,nn===0?0:nn)}:hn=="has"?function(nn){return!(B&&!Bn(nn))&&wn(this,nn===0?0:nn)}:function(nn,Hn){return wn(this,nn===0?0:nn,Hn),this})};if(I(y,!xi(ue)||!(B||oe.forEach&&!Z(function(){new ue().entries().next()}))))Ae=M.getConstructor(w,y,R,Q),Fl.enable();else if(I(y,!0)){var Dt=new Ae,tr=Dt[Q](B?{}:-0,1)!=Dt,gr=Z(function(){Dt.has(1)}),Fr=io(function(hn){new ue(hn)}),Qr=!B&&Z(function(){for(var hn=new ue,wn=5;wn--;)hn[Q](wn,wn);return!hn.has(-0)});Fr||((Ae=w(function(hn,wn){ia(hn,oe);var nn=cf(new ue,hn,Ae);return wn!=null&&Yo(wn,nn[Q],{that:nn,AS_ENTRIES:R}),nn})).prototype=oe,oe.constructor=Ae),(gr||Qr)&&(Le("delete"),Le("has"),R&&Le("get")),(Qr||tr)&&Le(Q),B&&oe.clear&&delete oe.clear}return Oe[y]=Ae,D({global:!0,constructor:!0,forced:Ae!=ue},Oe),br(Ae,y),B||M.setStrong(Ae,y,R),Ae}),xc=Fl.getWeakData,Uc=Li.set,_d=Li.getterFor,ip=Bt.find,zp=Bt.findIndex,Ih=yt([].splice),xd=0,Up=function(y){return y.frozen||(y.frozen=new ap)},ap=function(){this.entries=[]},Zf=function(y,w){return ip(y.entries,function(M){return M[0]===w})};ap.prototype={get:function(y){var w=Zf(this,y);if(w)return w[1]},has:function(y){return!!Zf(this,y)},set:function(y,w){var M=Zf(this,y);M?M[1]=w:this.entries.push([y,w])},delete:function(y){var w=zp(this.entries,function(M){return M[0]===y});return~w&&Ih(this.entries,w,1),!!~w}};var op,Ra={getConstructor:function(y,w,M,R){var B=y(function(Ae,Oe){ia(Ae,Q),Uc(Ae,{type:w,id:xd++,frozen:void 0}),Oe!=null&&Yo(Oe,Ae[R],{that:Ae,AS_ENTRIES:M})}),Q=B.prototype,ue=_d(w),oe=function(Ae,Oe,Le){var Dt=ue(Ae),tr=xc(Ji(Oe),!0);return tr===!0?Up(Dt).set(Oe,Le):tr[Dt.id]=Le,Ae};return Su(Q,{delete:function(Ae){var Oe=ue(this);if(!Bn(Ae))return!1;var Le=xc(Ae);return Le===!0?Up(Oe).delete(Ae):Le&&Rn(Le,Oe.id)&&delete Le[Oe.id]},has:function(Ae){var Oe=ue(this);if(!Bn(Ae))return!1;var Le=xc(Ae);return Le===!0?Up(Oe).has(Ae):Le&&Rn(Le,Oe.id)}}),Su(Q,M?{get:function(Ae){var Oe=ue(this);if(Bn(Ae)){var Le=xc(Ae);return Le===!0?Up(Oe).get(Ae):Le?Le[Oe.id]:void 0}},set:function(Ae,Oe){return oe(this,Ae,Oe)}}:{add:function(Ae){return oe(this,Ae,!0)}}),B}},Zc=Li.enforce,bd=!st.ActiveXObject&&"ActiveXObject"in st,Zp=function(y){return function(){return y(this,arguments.length?arguments[0]:void 0)}},Ph=Es("WeakMap",Zp,Ra);if(ea&&bd){op=Ra.getConstructor(Zp,"WeakMap",!0),Fl.enable();var Vf=Ph.prototype,Xd=yt(Vf.delete),Vp=yt(Vf.has),jp=yt(Vf.get),Ed=yt(Vf.set);Su(Vf,{delete:function(y){if(Bn(y)&&!vl(y)){var w=Zc(this);return w.frozen||(w.frozen=new op),Xd(this,y)||w.frozen.delete(y)}return Xd(this,y)},has:function(y){if(Bn(y)&&!vl(y)){var w=Zc(this);return w.frozen||(w.frozen=new op),Vp(this,y)||w.frozen.has(y)}return Vp(this,y)},get:function(y){if(Bn(y)&&!vl(y)){var w=Zc(this);return w.frozen||(w.frozen=new op),Vp(this,y)?jp(this,y):w.frozen.get(y)}return jp(this,y)},set:function(y,w){if(Bn(y)&&!vl(y)){var M=Zc(this);M.frozen||(M.frozen=new op),Vp(this,y)?Ed(this,y,w):M.frozen.set(y,w)}else Ed(this,y,w);return this}})}var Gp=Mr("iterator"),Hp=Mr("toStringTag"),Wp=Rl.values,Xp=function(y,w){if(y){if(y[Gp]!==Wp)try{Zi(y,Gp,Wp)}catch{y[Gp]=Wp}if(y[Hp]||Zi(y,Hp,w),le[w]){for(var M in Rl)if(y[M]!==Rl[M])try{Zi(y,M,Rl[M])}catch{y[M]=Rl[M]}}}};for(var Yp in le)Xp(st[Yp]&&st[Yp].prototype,Yp);Xp(Ue,"DOMTokenList");var sp,Cd,up,lp,hf=new WeakMap,Sd=function(){function y(){rt(this,y),hf.set(this,{})}return Xe(y,[{key:"addEventListener",value:function(w,M){var R=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},B=hf.get(this);B||(B={}),B[w]||(B[w]=[]),B[w].push(M),hf.set(this,B),R.capture,R.once,R.passive}},{key:"removeEventListener",value:function(w,M){var R=hf.get(this);if(R){var B=R[w];if(B&&B.length>0){for(var Q=B.length;Q--;Q>0)if(B[Q]===M){B.splice(Q,1);break}}}}},{key:"dispatchEvent",value:function(w){var M=hf.get(this)[w.type];if(M){var R,B=function(Q,ue){var oe=typeof Symbol<"u"&&Q[Symbol.iterator]||Q["@@iterator"];if(!oe){if(Array.isArray(Q)||(oe=Pi(Q))||ue&&Q&&typeof Q.length=="number"){oe&&(Q=oe);var Ae=0,Oe=function(){};return{s:Oe,n:function(){return Ae>=Q.length?{done:!0}:{done:!1,value:Q[Ae++]}},e:function(gr){throw gr},f:Oe}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Le,Dt=!0,tr=!1;return{s:function(){oe=oe.call(Q)},n:function(){var gr=oe.next();return Dt=gr.done,gr},e:function(gr){tr=!0,Le=gr},f:function(){try{Dt||oe.return==null||oe.return()}finally{if(tr)throw Le}}}}(M);try{for(B.s();!(R=B.n()).done;)(0,R.value)(w)}catch(Q){B.e(Q)}finally{B.f()}}}}]),y}(),wd=function(y){hr(M,y);var w=Kn(M);function M(){var R;return rt(this,M),Kt(ur(R=w.call(this)),"className",void 0),Kt(ur(R),"children",void 0),R.className="",R.children=[],R}return Xe(M,[{key:"setAttribute",value:function(R,B){this[R]=B}},{key:"getAttribute",value:function(R){return this[R]}},{key:"setAttributeNS",value:function(R,B){this[R]=B}},{key:"getAttributeNS",value:function(R){return this[R]}}]),M}(function(y){hr(M,y);var w=Kn(M);function M(){var R;return rt(this,M),Kt(ur(R=w.call(this)),"childNodes",void 0),R.childNodes=[],R}return Xe(M,[{key:"appendChild",value:function(R){this.childNodes.push(R)}},{key:"cloneNode",value:function(){var R=Object.create(this);return Object.assign(R,this),R}},{key:"removeChild",value:function(R){var B=this.childNodes.findIndex(function(Q){return Q===R});return B>-1?this.childNodes.splice(B,1):null}}]),M}(Sd));if(typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0){var Ad=my.getSystemInfoSync();sp=Ad.screenWidth,Cd=Ad.screenHeight,up=Ad.windowWidth,lp=Ad.windowHeight}else{var da=W.innerWidth,ca=W.innerHeight;sp=da,Cd=ca,up=da,lp=ca}var cp={width:sp,height:Cd,availWidth:up,availHeight:lp,availLeft:0,availTop:0},fp=cp.availWidth,c0=cp.availHeight,qp={style:[]};function ps(y,w){var M,R;"parentNode"in y||(M=w===0?function(){return null}:w===1?function(){return qp}:function(){return null},Object.defineProperty(y,"parentNode",{enumerable:!0,get:M})),"parentElement"in y||(R=w===0?function(){return null}:w===1?function(){return qp}:function(){return null},Object.defineProperty(y,"parentElement",{enumerable:!0,get:R}))}function qu(y){y.style=y.style||{},Object.assign(y.style,{top:"0px",left:"0px",width:fp+"px",height:c0+"px",margin:"0px",padding:"0px"})}function $p(y){"clientLeft"in y||(y.clientLeft=0,y.clientTop=0),"clientWidth"in y||(y.clientWidth=fp,y.clientHeight=c0),"getBoundingClientRect"in y||(y.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function Lh(y){"offsetLeft"in y||(y.offsetLeft=0,y.offsetTop=0),"offsetWidth"in y||(y.offsetWidth=fp,y.offsetHeight=c0)}function f0(y){"scrollLeft"in y||(y.scrollLeft=0,y.scrollTop=0),"scrollWidth"in y||(y.scrollWidth=fp,y.scrollHeight=c0)}function h0(y){var w=function(){return!0};y.classList=[],y.classList.add=w,y.classList.remove=w,y.classList.contains=w,y.classList.toggle=w}function jf(){}var ec=function(y){hr(M,y);var w=Kn(M);function M(){var R,B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",Q=arguments.length>1?arguments[1]:void 0;return rt(this,M),Kt(ur(R=w.call(this)),"className",void 0),Kt(ur(R),"children",void 0),Kt(ur(R),"focus",void 0),Kt(ur(R),"blur",void 0),Kt(ur(R),"insertBefore",void 0),Kt(ur(R),"appendChild",void 0),Kt(ur(R),"removeChild",void 0),Kt(ur(R),"remove",void 0),Kt(ur(R),"innerHTML",void 0),Kt(ur(R),"tagName",void 0),R.className="",R.children=[],R.focus=jf,R.blur=jf,R.insertBefore=jf,R.appendChild=jf,R.removeChild=jf,R.remove=jf,R.innerHTML="",R.tagName=B.toUpperCase(),ps(ur(R),Q),qu(ur(R)),h0(ur(R)),$p(ur(R)),Lh(ur(R)),f0(ur(R)),R}return Xe(M)}(wd),p0=function(y){hr(M,y);var w=Kn(M);function M(){return rt(this,M),w.call(this,"video")}return Xe(M)}(function(y){hr(M,y);var w=Kn(M);function M(R){return rt(this,M),w.call(this,R)}return Xe(M,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),M}(ec)),Yd={};function d0(){return Yd}var hp=Xe(function y(){rt(this,y);var w=d0(),M=w.createImage&&w.createImage()||{};return"tagName"in M||(M.tagName="IMG",M.__proto__=y.prototype),ps(M),h0(M),Object.assign(M,{addEventListener:function(R,B){M["on".concat(R)]=B.bind(M)},removeEventListener:function(R){M["on".concat(R)]=null}}),M}),Uu={href:"",protocol:"",host:""},B0=function(y){hr(M,y);var w=Kn(M);function M(){return rt(this,M),w.call(this,"body",0)}return Xe(M,[{key:"addEventListener",value:function(R,B){}},{key:"removeEventListener",value:function(R,B,Q){}},{key:"dispatchEvent",value:function(R){}}]),M}(ec),Td=function(y){hr(M,y);var w=Kn(M);function M(){return rt(this,M),w.call(this,"html",0)}return Xe(M,[{key:"addEventListener",value:function(R,B){}},{key:"removeEventListener",value:function(R,B){}},{key:"dispatchEvent",value:function(R){}}]),M}(ec),Kp={},Md={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Uu,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(y){return(y=y.toLowerCase())==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):y==="img"?new hp:y==="video"?new p0:new ec(y)},createElementNS:function(y,w){return this.createElement(w)},createTextNode:function(y){return y},getElementById:function(y){return null},getElementsByTagName:function(y){return y=y.toLowerCase(),[]},getElementsByTagNameNS:function(y,w){return this.getElementsByTagName(w)},getElementsByName:function(y){return[]},querySelector:function(y){return null},querySelectorAll:function(y){return[]},addEventListener:function(y,w,M){Kp[y]||(Kp[y]=[]),Kp[y].push(w)},removeEventListener:function(y,w){var M=Kp[y];if(M&&M.length>0){for(var R=M.length;R--;R>0)if(M[R]===w){M.splice(R,1);break}}},dispatchEvent:function(y){var w=y.type,M=Kp[w];if(M)for(var R=0;R<M.length;R++)M[R](y);y.target&&typeof y.target["on"+w]=="function"&&y.target["on"+w](y)},createEvent:function(y){return new zu(y)}};Md.documentElement=new Td,Md.head=new ec("head"),Md.body=new B0,se("match",function(y,w,M){return[function(R){var B=Xn(this),Q=R==null?void 0:lt(R,y);return Q?hi(Q,R,B):new RegExp(R)[y](qs(B))},function(R){var B=Ji(this),Q=qs(R),ue=M(w,B,Q);if(ue.done)return ue.value;if(!B.global)return Nn(B,Q);var oe=B.unicode;B.lastIndex=0;for(var Ae,Oe=[],Le=0;(Ae=Nn(B,Q))!==null;){var Dt=qs(Ae[0]);Oe[Le]=Dt,Dt===""&&(B.lastIndex=Rt(Q,xo(B.lastIndex),oe)),Le++}return Le===0?null:Oe}]});var qd,Dl,N0=Mr("isConcatSpreadable"),bc=pe>=51||!Z(function(){var y=[];return y[N0]=!1,y.concat()[0]!==y}),v0=fi("concat"),cv=function(y){if(!Bn(y))return!1;var w=y[N0];return w!==void 0?!!w:Je(y)};if(D({target:"Array",proto:!0,arity:1,forced:!bc||!v0},{concat:function(y){var w,M,R,B,Q,ue=Gi(this),oe=pt(ue,0),Ae=0;for(w=-1,R=arguments.length;w<R;w++)if(cv(Q=w===-1?ue:arguments[w]))for(B=To(Q),mo(Ae+B),M=0;M<B;M++,Ae++)M in Q&&ui(oe,Ae,Q[M]);else mo(Ae+1),ui(oe,Ae++,Q);return oe.length=Ae,oe}}),typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0){var pf=my.getSystemInfoSync();qd=pf.system,pf.platform,pf.language}else{var Vc={versions:(Dl=W.navigator.userAgent,{trident:Dl.indexOf("Trident")>-1,presto:Dl.indexOf("Presto")>-1,webKit:Dl.indexOf("AppleWebKit")>-1,gecko:Dl.indexOf("Gecko")>-1&&Dl.indexOf("KHTML")===-1,mobile:!!Dl.match(/AppleWebKit.*Mobile.*/),ios:!!Dl.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Dl.indexOf("Android")>-1||Dl.indexOf("Linux")>-1,iPhone:Dl.indexOf("iPhone")>-1,iPad:Dl.indexOf("iPad")>-1,webApp:Dl.indexOf("Safari")===-1,weixin:Dl.indexOf("MicroMessenger")>-1,qq:Dl.match(/\sQQ/i)===" qq"}),language:(W.navigator.browserLanguage||W.navigator.language).toLowerCase()};Vc.versions.android||Vc.versions.trident||Vc.versions.presto||Vc.versions.webKit||Vc.versions.gecko||Vc.versions.mobile||Vc.versions.ios||Vc.versions.iPhone||Vc.versions.iPad||Vc.versions.webApp||Vc.versions.weixin||Vc.versions.qq,qd=W.navigator.userAgent,Vc.language}qd.toLowerCase().indexOf("android"),Ah("Uint8",function(y){return function(w,M,R){return y(this,w,M,R)}});var X=vn.f,Rh=Fl.fastKey,pp=Li.set,Oh=Li.getterFor;Es("Map",function(y){return function(){return y(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(y,w,M,R){var B=y(function(Oe,Le){ia(Oe,Q),pp(Oe,{type:w,index:eu(null),first:void 0,last:void 0,size:0}),Qn||(Oe.size=0),Le!=null&&Yo(Le,Oe[R],{that:Oe,AS_ENTRIES:M})}),Q=B.prototype,ue=Oh(w),oe=function(Oe,Le,Dt){var tr,gr,Fr=ue(Oe),Qr=Ae(Oe,Le);return Qr?Qr.value=Dt:(Fr.last=Qr={index:gr=Rh(Le,!0),key:Le,value:Dt,previous:tr=Fr.last,next:void 0,removed:!1},Fr.first||(Fr.first=Qr),tr&&(tr.next=Qr),Qn?Fr.size++:Oe.size++,gr!=="F"&&(Fr.index[gr]=Qr)),Oe},Ae=function(Oe,Le){var Dt,tr=ue(Oe),gr=Rh(Le);if(gr!=="F")return tr.index[gr];for(Dt=tr.first;Dt;Dt=Dt.next)if(Dt.key==Le)return Dt};return Su(Q,{clear:function(){for(var Oe=ue(this),Le=Oe.index,Dt=Oe.first;Dt;)Dt.removed=!0,Dt.previous&&(Dt.previous=Dt.previous.next=void 0),delete Le[Dt.index],Dt=Dt.next;Oe.first=Oe.last=void 0,Qn?Oe.size=0:this.size=0},delete:function(Oe){var Le=ue(this),Dt=Ae(this,Oe);if(Dt){var tr=Dt.next,gr=Dt.previous;delete Le.index[Dt.index],Dt.removed=!0,gr&&(gr.next=tr),tr&&(tr.previous=gr),Le.first==Dt&&(Le.first=tr),Le.last==Dt&&(Le.last=gr),Qn?Le.size--:this.size--}return!!Dt},forEach:function(Oe){for(var Le,Dt=ue(this),tr=Pu(Oe,arguments.length>1?arguments[1]:void 0);Le=Le?Le.next:Dt.first;)for(tr(Le.value,Le.key,this);Le&&Le.removed;)Le=Le.previous},has:function(Oe){return!!Ae(this,Oe)}}),Su(Q,M?{get:function(Oe){var Le=Ae(this,Oe);return Le&&Le.value},set:function(Oe,Le){return oe(this,Oe===0?0:Oe,Le)}}:{add:function(Oe){return oe(this,Oe=Oe===0?0:Oe,Oe)}}),Qn&&X(Q,"size",{get:function(){return ue(this).size}}),B},setStrong:function(y,w,M){var R=w+" Iterator",B=Oh(w),Q=Oh(R);Pf(y,w,function(ue,oe){pp(this,{type:R,target:ue,state:B(ue),kind:oe,last:void 0})},function(){for(var ue=Q(this),oe=ue.kind,Ae=ue.last;Ae&&Ae.removed;)Ae=Ae.previous;return ue.target&&(ue.last=Ae=Ae?Ae.next:ue.state.first)?oe=="keys"?{value:Ae.key,done:!1}:oe=="values"?{value:Ae.value,done:!1}:{value:[Ae.key,Ae.value],done:!1}:(ue.target=void 0,{value:void 0,done:!0})},M?"entries":"values",!M,!0),Ni(w)}});var Qp=yt([].join),Jp=el!=Object,z0=nr("join",",");D({target:"Array",proto:!0,forced:Jp||!z0},{join:function(y){return Qp(Wo(this),y===void 0?",":y)}});var U0=Z(function(){vo(1)});D({target:"Object",stat:!0,forced:U0},{keys:function(y){return vo(Gi(y))}});var sh=new Map,m0=new Map,g0=new Map,jc=function(y){hr(M,y);var w=Kn(M);function M(){var R;return rt(this,M),Kt(ur(R=w.call(this)),"onabort",void 0),Kt(ur(R),"onerror",void 0),Kt(ur(R),"onload",void 0),Kt(ur(R),"onloadstart",void 0),Kt(ur(R),"onprogress",void 0),Kt(ur(R),"ontimeout",void 0),Kt(ur(R),"onloadend",void 0),Kt(ur(R),"onreadystatechange",void 0),Kt(ur(R),"readyState",void 0),Kt(ur(R),"response",void 0),Kt(ur(R),"responseText",void 0),Kt(ur(R),"_responseType",void 0),Kt(ur(R),"responseXML",void 0),Kt(ur(R),"status",void 0),Kt(ur(R),"statusText",void 0),Kt(ur(R),"upload",void 0),Kt(ur(R),"withCredentials",void 0),Kt(ur(R),"timeout",void 0),Kt(ur(R),"_url",void 0),Kt(ur(R),"_method",void 0),R.onabort=null,R.onerror=null,R.onload=null,R.onloadstart=null,R.onprogress=null,R.ontimeout=null,R.onloadend=null,R.onreadystatechange=null,R.readyState=0,R.response=null,R.responseText=null,R._responseType="text",R.responseXML=null,R.status=0,R.statusText="",R.upload={},R.withCredentials=!1,sh.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),R}return Xe(M,[{key:"responseType",set:function(R){this._responseType=R}},{key:"abort",value:function(){var R=g0.get("requestTask");R&&R.abort()}},{key:"getAllResponseHeaders",value:function(){var R=m0.get("responseHeader");return Object.keys(R).map(function(B){return"".concat(B,": ").concat(R[B])}).join(`
`)}},{key:"getResponseHeader",value:function(R){return m0.get("responseHeader")[R]}},{key:"open",value:function(R,B,Q){this._method=R,this._url=B}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(R,B){var Q=sh.get("requestHeader");Q[R]=B,sh.set("requestHeader",Q)}},{key:"addEventListener",value:function(R,B){var Q=this;typeof B=="function"&&(this["on"+R]=function(){var ue=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ue.target=ue.target||Q,B.call(Q,ue)})}},{key:"removeEventListener",value:function(R,B){this["on"+R]===B&&(this["on"+R]=null)}}]),M}(Sd);Kt(jc,"UNSEND",void 0),Kt(jc,"OPENED",void 0),Kt(jc,"HEADERS_RECEIVED",void 0),Kt(jc,"LOADING",void 0),Kt(jc,"DONE",void 0),jc.UNSEND=0,jc.OPENED=1,jc.HEADERS_RECEIVED=2,jc.LOADING=3,jc.DONE=4;var uh=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Z0=typeof wx<"u"&&wx!==null&&(wx.request!==void 0||wx.miniProgram!==void 0),y0=uh||Z0;y0||W.XMLHttpRequest,y0||W.location;function $d(y){return[y+1&255,y+1>>8&255,y+1>>8>>8&255]}var V0=Bt.filter,_0=fi("filter");function Kd(y,w){var M=y.color;return M&&M.length?M:[1,1,1,1]}function Qd(y,w,M){return M.length===2?[M[0],M[1],0]:[M[0],M[1],M[2]]}function kd(y,w){return y.filter?[1]:[0]}function dp(y,w,M,R){return[w]}D({target:"Array",proto:!0,forced:!_0},{filter:function(y){return V0(this,y,arguments.length>1?arguments[1]:void 0)}});var vp=mp,j0=mp;function mp(y,w,M){M=M||2;var R,B,Q,ue,oe,Ae,Oe,Le=w&&w.length,Dt=Le?w[0]*M:y.length,tr=fv(y,0,Dt,M,!0),gr=[];if(!tr||tr.next===tr.prev)return gr;if(Le&&(tr=function(Qr,hn,wn,nn){var Hn,di,yo,Ka,Va,Xa=[];for(Hn=0,di=hn.length;Hn<di;Hn++)yo=hn[Hn]*nn,Ka=Hn<di-1?hn[Hn+1]*nn:Qr.length,(Va=fv(Qr,yo,Ka,nn,!1))===Va.next&&(Va.steiner=!0),Xa.push(Jd(Va));for(Xa.sort(qv),Hn=0;Hn<Xa.length;Hn++)wn=$v(Xa[Hn],wn);return wn}(y,w,tr,M)),y.length>80*M){R=Q=y[0],B=ue=y[1];for(var Fr=M;Fr<Dt;Fr+=M)(oe=y[Fr])<R&&(R=oe),(Ae=y[Fr+1])<B&&(B=Ae),oe>Q&&(Q=oe),Ae>ue&&(ue=Ae);Oe=(Oe=Math.max(Q-R,ue-B))!==0?32767/Oe:0}return Id(tr,gr,M,R,B,Oe,0),gr}function fv(y,w,M,R,B){var Q,ue;if(B===vv(y,w,M,R)>0)for(Q=w;Q<M;Q+=R)ue=Qv(Q,y[Q],y[Q+1],ue);else for(Q=M-R;Q>=w;Q-=R)ue=Qv(Q,y[Q],y[Q+1],ue);return ue&&G0(ue,ue.next)&&(b0(ue),ue=ue.next),ue}function gp(y,w){if(!y)return y;w||(w=y);var M,R=y;do if(M=!1,R.steiner||!G0(R,R.next)&&Cs(R.prev,R,R.next)!==0)R=R.next;else{if(b0(R),(R=w=R.prev)===R.next)break;M=!0}while(M||R!==w);return w}function Id(y,w,M,R,B,Q,ue){if(y){!ue&&Q&&function(Le,Dt,tr,gr){var Fr=Le;do Fr.z===0&&(Fr.z=Bl(Fr.x,Fr.y,Dt,tr,gr)),Fr.prevZ=Fr.prev,Fr.nextZ=Fr.next,Fr=Fr.next;while(Fr!==Le);Fr.prevZ.nextZ=null,Fr.prevZ=null,function(Qr){var hn,wn,nn,Hn,di,yo,Ka,Va,Xa=1;do{for(wn=Qr,Qr=null,di=null,yo=0;wn;){for(yo++,nn=wn,Ka=0,hn=0;hn<Xa&&(Ka++,nn=nn.nextZ);hn++);for(Va=Xa;Ka>0||Va>0&&nn;)Ka!==0&&(Va===0||!nn||wn.z<=nn.z)?(Hn=wn,wn=wn.nextZ,Ka--):(Hn=nn,nn=nn.nextZ,Va--),di?di.nextZ=Hn:Qr=Hn,Hn.prevZ=di,di=Hn;wn=nn}di.nextZ=null,Xa*=2}while(yo>1)}(Fr)}(y,R,B,Q);for(var oe,Ae,Oe=y;y.prev!==y.next;)if(oe=y.prev,Ae=y.next,Q?yp(y,R,B,Q):Wv(y))w.push(oe.i/M|0),w.push(y.i/M|0),w.push(Ae.i/M|0),b0(y),y=Ae.next,Oe=Ae.next;else if((y=Ae)===Oe){ue?ue===1?Id(y=Xv(gp(y),w,M),w,M,R,B,Q,2):ue===2&&Yv(y,w,M,R,B,Q):Id(gp(y),w,M,R,B,Q,1);break}}}function Wv(y){var w=y.prev,M=y,R=y.next;if(Cs(w,M,R)>=0)return!1;for(var B=w.x,Q=M.x,ue=R.x,oe=w.y,Ae=M.y,Oe=R.y,Le=B<Q?B<ue?B:ue:Q<ue?Q:ue,Dt=oe<Ae?oe<Oe?oe:Oe:Ae<Oe?Ae:Oe,tr=B>Q?B>ue?B:ue:Q>ue?Q:ue,gr=oe>Ae?oe>Oe?oe:Oe:Ae>Oe?Ae:Oe,Fr=R.next;Fr!==w;){if(Fr.x>=Le&&Fr.x<=tr&&Fr.y>=Dt&&Fr.y<=gr&&_p(B,oe,Q,Ae,ue,Oe,Fr.x,Fr.y)&&Cs(Fr.prev,Fr,Fr.next)>=0)return!1;Fr=Fr.next}return!0}function yp(y,w,M,R){var B=y.prev,Q=y,ue=y.next;if(Cs(B,Q,ue)>=0)return!1;for(var oe=B.x,Ae=Q.x,Oe=ue.x,Le=B.y,Dt=Q.y,tr=ue.y,gr=oe<Ae?oe<Oe?oe:Oe:Ae<Oe?Ae:Oe,Fr=Le<Dt?Le<tr?Le:tr:Dt<tr?Dt:tr,Qr=oe>Ae?oe>Oe?oe:Oe:Ae>Oe?Ae:Oe,hn=Le>Dt?Le>tr?Le:tr:Dt>tr?Dt:tr,wn=Bl(gr,Fr,w,M,R),nn=Bl(Qr,hn,w,M,R),Hn=y.prevZ,di=y.nextZ;Hn&&Hn.z>=wn&&di&&di.z<=nn;){if(Hn.x>=gr&&Hn.x<=Qr&&Hn.y>=Fr&&Hn.y<=hn&&Hn!==B&&Hn!==ue&&_p(oe,Le,Ae,Dt,Oe,tr,Hn.x,Hn.y)&&Cs(Hn.prev,Hn,Hn.next)>=0||(Hn=Hn.prevZ,di.x>=gr&&di.x<=Qr&&di.y>=Fr&&di.y<=hn&&di!==B&&di!==ue&&_p(oe,Le,Ae,Dt,Oe,tr,di.x,di.y)&&Cs(di.prev,di,di.next)>=0))return!1;di=di.nextZ}for(;Hn&&Hn.z>=wn;){if(Hn.x>=gr&&Hn.x<=Qr&&Hn.y>=Fr&&Hn.y<=hn&&Hn!==B&&Hn!==ue&&_p(oe,Le,Ae,Dt,Oe,tr,Hn.x,Hn.y)&&Cs(Hn.prev,Hn,Hn.next)>=0)return!1;Hn=Hn.prevZ}for(;di&&di.z<=nn;){if(di.x>=gr&&di.x<=Qr&&di.y>=Fr&&di.y<=hn&&di!==B&&di!==ue&&_p(oe,Le,Ae,Dt,Oe,tr,di.x,di.y)&&Cs(di.prev,di,di.next)>=0)return!1;di=di.nextZ}return!0}function Xv(y,w,M){var R=y;do{var B=R.prev,Q=R.next.next;!G0(B,Q)&&Bg(B,R,R.next,Q)&&x0(B,Q)&&x0(Q,B)&&(w.push(B.i/M|0),w.push(R.i/M|0),w.push(Q.i/M|0),b0(R),b0(R.next),R=y=Q),R=R.next}while(R!==y);return gp(R)}function Yv(y,w,M,R,B,Q){var ue=y;do{for(var oe=ue.next.next;oe!==ue.prev;){if(ue.i!==oe.i&&Pd(ue,oe)){var Ae=Fm(ue,oe);return ue=gp(ue,ue.next),Ae=gp(Ae,Ae.next),Id(ue,w,M,R,B,Q,0),void Id(Ae,w,M,R,B,Q,0)}oe=oe.next}ue=ue.next}while(ue!==y)}function qv(y,w){return y.x-w.x}function $v(y,w){var M=function(B,Q){var ue,oe=Q,Ae=B.x,Oe=B.y,Le=-1/0;do{if(Oe<=oe.y&&Oe>=oe.next.y&&oe.next.y!==oe.y){var Dt=oe.x+(Oe-oe.y)*(oe.next.x-oe.x)/(oe.next.y-oe.y);if(Dt<=Ae&&Dt>Le&&(Le=Dt,ue=oe.x<oe.next.x?oe:oe.next,Dt===Ae))return ue}oe=oe.next}while(oe!==Q);if(!ue)return null;var tr,gr=ue,Fr=ue.x,Qr=ue.y,hn=1/0;oe=ue;do Ae>=oe.x&&oe.x>=Fr&&Ae!==oe.x&&_p(Oe<Qr?Ae:Le,Oe,Fr,Qr,Oe<Qr?Le:Ae,Oe,oe.x,oe.y)&&(tr=Math.abs(Oe-oe.y)/(Ae-oe.x),x0(oe,B)&&(tr<hn||tr===hn&&(oe.x>ue.x||oe.x===ue.x&&Kv(ue,oe)))&&(ue=oe,hn=tr)),oe=oe.next;while(oe!==gr);return ue}(y,w);if(!M)return w;var R=Fm(M,y);return gp(R,R.next),gp(M,M.next)}function Kv(y,w){return Cs(y.prev,y,w.prev)<0&&Cs(w.next,y,y.next)<0}function Bl(y,w,M,R,B){return(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y=(y-M)*B|0)|y<<8))|y<<4))|y<<2))|y<<1))|(w=1431655765&((w=858993459&((w=252645135&((w=16711935&((w=(w-R)*B|0)|w<<8))|w<<4))|w<<2))|w<<1))<<1}function Jd(y){var w=y,M=y;do(w.x<M.x||w.x===M.x&&w.y<M.y)&&(M=w),w=w.next;while(w!==y);return M}function _p(y,w,M,R,B,Q,ue,oe){return(B-ue)*(w-oe)>=(y-ue)*(Q-oe)&&(y-ue)*(R-oe)>=(M-ue)*(w-oe)&&(M-ue)*(Q-oe)>=(B-ue)*(R-oe)}function Pd(y,w){return y.next.i!==w.i&&y.prev.i!==w.i&&!function(M,R){var B=M;do{if(B.i!==M.i&&B.next.i!==M.i&&B.i!==R.i&&B.next.i!==R.i&&Bg(B,B.next,M,R))return!0;B=B.next}while(B!==M);return!1}(y,w)&&(x0(y,w)&&x0(w,y)&&function(M,R){var B=M,Q=!1,ue=(M.x+R.x)/2,oe=(M.y+R.y)/2;do B.y>oe!=B.next.y>oe&&B.next.y!==B.y&&ue<(B.next.x-B.x)*(oe-B.y)/(B.next.y-B.y)+B.x&&(Q=!Q),B=B.next;while(B!==M);return Q}(y,w)&&(Cs(y.prev,y,w.prev)||Cs(y,w.prev,w))||G0(y,w)&&Cs(y.prev,y,y.next)>0&&Cs(w.prev,w,w.next)>0)}function Cs(y,w,M){return(w.y-y.y)*(M.x-w.x)-(w.x-y.x)*(M.y-w.y)}function G0(y,w){return y.x===w.x&&y.y===w.y}function Bg(y,w,M,R){var B=pv(Cs(y,w,M)),Q=pv(Cs(y,w,R)),ue=pv(Cs(M,R,y)),oe=pv(Cs(M,R,w));return B!==Q&&ue!==oe||!(B!==0||!hv(y,M,w))||!(Q!==0||!hv(y,R,w))||!(ue!==0||!hv(M,y,R))||!(oe!==0||!hv(M,w,R))}function hv(y,w,M){return w.x<=Math.max(y.x,M.x)&&w.x>=Math.min(y.x,M.x)&&w.y<=Math.max(y.y,M.y)&&w.y>=Math.min(y.y,M.y)}function pv(y){return y>0?1:y<0?-1:0}function x0(y,w){return Cs(y.prev,y,y.next)<0?Cs(y,w,y.next)>=0&&Cs(y,y.prev,w)>=0:Cs(y,w,y.prev)<0||Cs(y,y.next,w)<0}function Fm(y,w){var M=new dv(y.i,y.x,y.y),R=new dv(w.i,w.x,w.y),B=y.next,Q=w.prev;return y.next=w,w.prev=y,M.next=B,B.prev=M,R.next=M,M.prev=R,Q.next=R,R.prev=Q,R}function Qv(y,w,M,R){var B=new dv(y,w,M);return R?(B.next=R.next,B.prev=R,R.next.prev=B,R.next=B):(B.prev=B,B.next=B),B}function b0(y){y.next.prev=y.prev,y.prev.next=y.next,y.prevZ&&(y.prevZ.nextZ=y.nextZ),y.nextZ&&(y.nextZ.prevZ=y.prevZ)}function dv(y,w,M){this.i=y,this.x=w,this.y=M,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function vv(y,w,M,R){for(var B=0,Q=w,ue=M-R;Q<M;Q+=R)B+=(y[ue]-y[Q])*(y[Q+1]+y[ue+1]),ue=Q;return B}mp.deviation=function(y,w,M,R){var B=w&&w.length,Q=B?w[0]*M:y.length,ue=Math.abs(vv(y,0,Q,M));if(B)for(var oe=0,Ae=w.length;oe<Ae;oe++){var Oe=w[oe]*M,Le=oe<Ae-1?w[oe+1]*M:y.length;ue-=Math.abs(vv(y,Oe,Le,M))}var Dt=0;for(oe=0;oe<R.length;oe+=3){var tr=R[oe]*M,gr=R[oe+1]*M,Fr=R[oe+2]*M;Dt+=Math.abs((y[tr]-y[Fr])*(y[gr+1]-y[tr+1])-(y[tr]-y[gr])*(y[Fr+1]-y[tr+1]))}return ue===0&&Dt===0?0:Math.abs((Dt-ue)/ue)},mp.flatten=function(y){for(var w=y[0][0].length,M={vertices:[],holes:[],dimensions:w},R=0,B=0;B<y.length;B++){for(var Q=0;Q<y[B].length;Q++)for(var ue=0;ue<w;ue++)M.vertices.push(y[B][Q][ue]);B>0&&(R+=y[B-1].length,M.holes.push(R))}return M},vp.default=j0;var Jv=yt(1 .valueOf),em=yt("".replace),H0=`[	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]`,Dm=RegExp("^"+H0+H0+"*"),Bm=RegExp(H0+H0+"*$"),mv=function(y){return function(w){var M=qs(Xn(w));return 1&y&&(M=em(M,Dm,"")),2&y&&(M=em(M,Bm,"")),M}},Nm={start:mv(1),end:mv(2),trim:mv(3)},zm=Fa.f,Um=Me.f,Zm=vn.f,Vm=Nm.trim,ed=st.Number,gv=ed.prototype,tc=st.TypeError,jm=yt("".slice),W0=yt("".charCodeAt),Gm=function(y){var w=Sr(y,"number");return typeof w=="bigint"?w:Hm(w)},Hm=function(y){var w,M,R,B,Q,ue,oe,Ae,Oe=Sr(y,"number");if(ne(Oe))throw tc("Cannot convert a Symbol value to a number");if(typeof Oe=="string"&&Oe.length>2){if(Oe=Vm(Oe),(w=W0(Oe,0))===43||w===45){if((M=W0(Oe,2))===88||M===120)return NaN}else if(w===48){switch(W0(Oe,1)){case 66:case 98:R=2,B=49;break;case 79:case 111:R=8,B=55;break;default:return+Oe}for(ue=(Q=jm(Oe,2)).length,oe=0;oe<ue;oe++)if((Ae=W0(Q,oe))<48||Ae>B)return NaN;return parseInt(Q,R)}}return+Oe};if(I("Number",!ed(" 0o1")||!ed("0b1")||ed("+0x1"))){for(var X0,e0=function(y){var w=arguments.length<1?0:ed(Gm(y)),M=this;return fa(gv,M)&&Z(function(){Jv(M)})?cf(Object(w),M,e0):w},tm=Qn?zm(ed):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),yv=0;tm.length>yv;yv++)Rn(ed,X0=tm[yv])&&!Rn(e0,X0)&&Zm(e0,X0,Um(ed,X0));e0.prototype=gv,gv.constructor=e0,Aa(st,"Number",e0,{constructor:!0})}var Wm=RangeError,Xm=RangeError,rm=String,nm=Math.floor,_v=yt(function(y){var w=qs(Xn(this)),M="",R=jn(y);if(R<0||R==1/0)throw Wm("Wrong number of repetitions");for(;R>0;(R>>>=1)&&(w+=w))1&R&&(M+=w);return M}),im=yt("".slice),E0=yt(1 .toFixed),C0=function(y,w,M){return w===0?M:w%2==1?C0(y,w-1,M*y):C0(y*y,w/2,M)},S0=function(y,w,M){for(var R=-1,B=M;++R<6;)B+=w*y[R],y[R]=B%1e7,B=nm(B/1e7)},am=function(y,w){for(var M=6,R=0;--M>=0;)R+=y[M],y[M]=nm(R/w),R=R%w*1e7},Ym=function(y){for(var w=6,M="";--w>=0;)if(M!==""||w===0||y[w]!==0){var R=rm(y[w]);M=M===""?R:M+_v("0",7-R.length)+R}return M},Ng=Z(function(){return E0(8e-5,3)!=="0.000"||E0(.9,0)!=="1"||E0(1.255,2)!=="1.25"||E0(0xde0b6b3a7640080,0)!=="1000000000000000128"})||!Z(function(){E0({})});function xv(y){return typeof y=="number"}function td(y){var w=Math.max(Math.min(85.0511287798,y[1]),-85.0511287798),M=Math.PI/180,R=y[0]*M,B=w*M;return B=Math.log(Math.tan(Math.PI/4+B/2)),R=268435456*(.5/Math.PI*R+.5),B=268435456*(-.5/Math.PI*B+(M=.5)),[Math.floor(R),Math.floor(B)]}D({target:"Number",proto:!0,forced:Ng},{toFixed:function(y){var w,M,R,B,Q=Jv(this),ue=jn(y),oe=[0,0,0,0,0,0],Ae="",Oe="0";if(ue<0||ue>20)throw Xm("Incorrect fraction digits");if(Q!=Q)return"NaN";if(Q<=-1e21||Q>=1e21)return rm(Q);if(Q<0&&(Ae="-",Q=-Q),Q>1e-21)if(M=(w=function(Le){for(var Dt=0,tr=Le;tr>=4096;)Dt+=12,tr/=4096;for(;tr>=2;)Dt+=1,tr/=2;return Dt}(Q*C0(2,69,1))-69)<0?Q*C0(2,-w,1):Q/C0(2,w,1),M*=4503599627370496,(w=52-w)>0){for(S0(oe,0,M),R=ue;R>=7;)S0(oe,1e7,0),R-=7;for(S0(oe,C0(10,R,1),0),R=w-1;R>=23;)am(oe,8388608),R-=23;am(oe,1<<R),S0(oe,1,1),am(oe,2),Oe=Ym(oe)}else S0(oe,0,M),S0(oe,1<<-w,0),Oe=Ym(oe)+_v("0",ue);return Oe=ue>0?Ae+((B=Oe.length)<=ue?"0."+_v("0",ue-B)+Oe:im(Oe,0,B-ue)+"."+im(Oe,B-ue)):Ae+Oe}});var om,qm=/"/g,zg=yt("".replace);D({target:"String",proto:!0,forced:(om="sub",Z(function(){var y=""[om]('"');return y!==y.toLowerCase()||y.split('"').length>3}))},{sub:function(){return y="sub",w="",M="",R=qs(Xn(this)),B="<"+y,w!==""&&(B+=" "+w+'="'+zg(qs(M),qm,"&quot;")+'"'),B+">"+R+"</"+y+">";var y,w,M,R,B}});var $m=RegExp.prototype,Ug=cn.PROPER,Km=RegExp.prototype.toString,Zg=Z(function(){return Km.call({source:"a",flags:"b"})!="/a/b"}),Vg=Ug&&Km.name!="toString";(Zg||Vg)&&Aa(RegExp.prototype,"toString",function(){var y=Ji(this);return"/"+qs(y.source)+"/"+qs(function(w){var M=w.flags;return M!==void 0||"flags"in $m||Rn(w,"flags")||!fa($m,w)?M:hi(oh,w)}(y))},{unsafe:!0});var sm=typeof Float32Array<"u"?Float32Array:Array;function $u(){var y=new sm(2);return sm!=Float32Array&&(y[0]=0,y[1]=0),y}function um(y,w){var M=new sm(2);return M[0]=y,M[1]=w,M}function Y0(y,w){return y[0]=w[0],y[1]=w[1],y}function xp(y,w,M){return y[0]=w[0]+M[0],y[1]=w[1]+M[1],y}function bv(y,w,M){return y[0]=w[0]-M[0],y[1]=w[1]-M[1],y}function q0(y,w){var M=w[0],R=w[1],B=M*M+R*R;return B>0&&(B=1/Math.sqrt(B)),y[0]=w[0]*B,y[1]=w[1]*B,y}function Ev(y,w){return y[0]*w[0]+y[1]*w[1]}Math.hypot||(Math.hypot=function(){for(var y=0,w=arguments.length;w--;)y+=arguments[w]*arguments[w];return Math.sqrt(y)});var jg,lm=bv,Cv=(jg=$u(),$u()),Ku=($u(),$u()),df=$u(),Gf=$u();function Sv(y,w,M,R,B){return xp(y,M,R),q0(y,y),[B/Ev(w=um(-y[1],y[0]),um(-M[1],M[0])),w]}function rd(y,w){return function(M,R,B){return M[0]=R,M[1]=B,M}(y,-w[1],w[0])}function nd(y,w,M){return lm(y,w,M),q0(y,y),y}function wv(y,w){return y[0]===w[0]&&y[1]===w[1]}var Qm=function(){function y(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};rt(this,y),Kt(this,"complex",void 0),Kt(this,"join",void 0),Kt(this,"cap",void 0),Kt(this,"miterLimit",void 0),Kt(this,"thickness",void 0),Kt(this,"normal",void 0),Kt(this,"lastFlip",-1),Kt(this,"miter",um(0,0)),Kt(this,"started",!1),Kt(this,"dash",!1),Kt(this,"totalDistance",0),Kt(this,"currentIndex",0),this.join=w.join||"miter",this.cap=w.cap||"butt",this.miterLimit=w.miterLimit||10,this.thickness=w.thickness||1,this.dash=w.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return Xe(y,[{key:"extrude_gaode2",value:function(w,M){var R=this.complex;if(w.length<=1)return R;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var B=w.length,Q=R.startIndex,ue=1;ue<B;ue++){var oe,Ae,Oe,Le=w[ue-1];Le.push((oe=M[ue-1][2])!==null&&oe!==void 0?oe:0);var Dt=M[ue-1],tr=w[ue];tr.push((Ae=M[ue][2])!==null&&Ae!==void 0?Ae:0);var gr=M[ue],Fr=ue<w.length-1?[].concat(an(w[ue+1]),[(Oe=M[ue+1][2])!==null&&Oe!==void 0?Oe:0]):null,Qr=ue<M.length-1?M[ue+1]:null;Q+=this.segment_gaode2(R,Q,Le,tr,Fr,Dt,gr,Qr)}if(this.dash)for(var hn=0;hn<R.positions.length/6;hn++)R.positions[6*hn+5]=this.totalDistance;return R.startIndex=R.positions.length/6,R}},{key:"simpleExtrude_gaode2",value:function(w,M){var R=this.complex;if(w.length<=1)return R;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var B=w.length,Q=R.startIndex,ue=1;ue<B;ue++){var oe,Ae,Oe,Le=w[ue-1];Le.push((oe=M[ue-1][2])!==null&&oe!==void 0?oe:0);var Dt=M[ue-1],tr=w[ue];tr.push((Ae=M[ue][2])!==null&&Ae!==void 0?Ae:0);var gr=M[ue],Fr=ue<w.length-1?[].concat(an(w[ue+1]),[(Oe=M[ue+1][2])!==null&&Oe!==void 0?Oe:0]):null,Qr=ue<M.length-1?M[ue+1]:null;Q+=this.simpleSegment(R,Q,Le,tr,Fr,Dt,gr,Qr)}if(this.dash)for(var hn=0;hn<R.positions.length/6;hn++)R.positions[6*hn+5]=this.totalDistance;return R.startIndex=R.positions.length/6,R}},{key:"extrude",value:function(w){var M=this.complex;if(w.length<=1)return M;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var R=w.length,B=M.startIndex,Q=1;Q<R;Q++){var ue=w[Q-1],oe=w[Q],Ae=Q<w.length-1?w[Q+1]:null;B+=this.segment(M,B,ue,oe,Ae)}if(this.dash)for(var Oe=0;Oe<M.positions.length/6;Oe++)M.positions[6*Oe+5]=this.totalDistance;return M.startIndex=M.positions.length/6,M}},{key:"simpleExtrude",value:function(w){var M=this.complex;if(w.length<=1)return M;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var R=w.length,B=M.startIndex,Q=1;Q<R;Q++){var ue=w[Q-1],oe=w[Q],Ae=Q<w.length-1?w[Q+1]:null;B+=this.simpleSegment(M,B,ue,oe,Ae)}if(this.dash)for(var Oe=0;Oe<M.positions.length/6;Oe++)M.positions[6*Oe+5]=this.totalDistance;return M.startIndex=M.positions.length/6,M}},{key:"segment_gaode2",value:function(w,M,R,B,Q,ue,oe,Ae){var Oe=0,Le=w.indices,Dt=w.positions,tr=w.normals,gr=this.cap==="square",Fr=this.join==="bevel",Qr=td([oe[0],oe[1]]),hn=td([ue[0],ue[1]]);nd(Ku,B,R);var wn=0;if(this.dash&&(wn=this.lineSegmentDistance(Qr,hn),this.totalDistance+=wn),this.normal||(this.normal=$u(),rd(this.normal,Ku)),!this.started)if(this.started=!0,gr){var nn=$u(),Hn=$u();xp(nn,this.normal,Ku),xp(Hn,this.normal,Ku),tr.push(Hn[0],Hn[1],0),tr.push(nn[0],nn[1],0),Dt.push(R[0],R[1],0|R[2],this.totalDistance-wn,-this.thickness,0|R[2]),this.complex.indexes.push(this.currentIndex),Dt.push(R[0],R[1],0|R[2],this.totalDistance-wn,this.thickness,0|R[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(Dt,tr,R,this.normal,this.thickness,this.totalDistance-wn);if(Le.push(M+0,M+1,M+2),Q){wv(B,Q)&&xp(Q,B,q0(Q,bv(Q,B,R))),nd(df,Q,B);var di=On(Sv(Gf,$u(),Ku,df,this.thickness),2),yo=di[0],Ka=di[1],Va=Ev(Gf,this.normal)<0?-1:1,Xa=Fr;!Xa&&this.join==="miter"&&yo>this.miterLimit&&(Xa=!0),Xa?(tr.push(this.normal[0],this.normal[1],0),tr.push(Ka[0],Ka[1],0),Dt.push(B[0],B[1],0|B[2],this.totalDistance,-this.thickness*Va,0|B[2]),this.complex.indexes.push(this.currentIndex),Dt.push(B[0],B[1],0|B[2],this.totalDistance,this.thickness*Va,0|B[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,Le.push.apply(Le,an(this.lastFlip!==-Va?[M,M+2,M+3]:[M+2,M+1,M+3])),Le.push(M+2,M+3,M+4),rd(Cv,df),Y0(this.normal,Cv),tr.push(this.normal[0],this.normal[1],0),Dt.push(B[0],B[1],0|B[2],this.totalDistance,-this.thickness*Va,0|B[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,Oe+=3):(this.extrusions(Dt,tr,B,Ka,yo,this.totalDistance),Le.push.apply(Le,an(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),Va=-1,Y0(this.normal,Ka),Oe+=2),this.lastFlip=Va}else{if(rd(this.normal,Ku),gr){var Qa=$u(),Nr=$u();lm(Nr,Ku,this.normal),xp(Qa,Ku,this.normal),tr.push(Nr[0],Nr[1],0),tr.push(Qa[0],Qa[1],0),Dt.push(B[0],B[1],0|B[2],this.totalDistance,this.thickness,0|B[2]),this.complex.indexes.push(this.currentIndex),Dt.push(B[0],B[1],0|B[2],this.totalDistance,this.thickness,0|B[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(Dt,tr,B,this.normal,this.thickness,this.totalDistance);Le.push.apply(Le,an(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),Oe+=2}return Oe}},{key:"simpleSegment",value:function(w,M,R,B,Q){var ue=0,oe=w.indices,Ae=w.positions,Oe=w.normals,Le=td([B[0],B[1]]),Dt=td([R[0],R[1]]);nd(Ku,Le,Dt);var tr=0;if(this.dash&&(tr=this.lineSegmentDistance(Le,Dt),this.totalDistance+=tr),this.normal||(this.normal=$u(),rd(this.normal,Ku)),this.started||(this.started=!0,this.extrusions(Ae,Oe,R,this.normal,this.thickness,this.totalDistance-tr)),oe.push(M+0,M+1,M+2),Q){var gr=td([Q[0],Q[1]]);wv(Le,gr)&&xp(gr,Le,q0(gr,bv(gr,Le,Dt))),nd(df,gr,Le);var Fr=On(Sv(Gf,$u(),Ku,df,this.thickness),2),Qr=Fr[0],hn=Fr[1];Ev(Gf,this.normal),this.extrusions(Ae,Oe,B,hn,Qr,this.totalDistance),oe.push.apply(oe,an(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),Y0(this.normal,hn),ue+=2,this.lastFlip=-1}else rd(this.normal,Ku),this.extrusions(Ae,Oe,B,this.normal,this.thickness,this.totalDistance),oe.push.apply(oe,an(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),ue+=2;return ue}},{key:"segment",value:function(w,M,R,B,Q){var ue=0,oe=w.indices,Ae=w.positions,Oe=w.normals,Le=this.cap==="square",Dt=this.join==="bevel",tr=td([B[0],B[1]]),gr=td([R[0],R[1]]);nd(Ku,tr,gr);var Fr=0;if(this.dash&&(Fr=this.lineSegmentDistance(tr,gr),this.totalDistance+=Fr),this.normal||(this.normal=$u(),rd(this.normal,Ku)),!this.started)if(this.started=!0,Le){var Qr=$u(),hn=$u();xp(Qr,this.normal,Ku),xp(hn,this.normal,Ku),Oe.push(hn[0],hn[1],0),Oe.push(Qr[0],Qr[1],0),Ae.push(R[0],R[1],0|R[2],this.totalDistance-Fr,-this.thickness,0|R[2]),this.complex.indexes.push(this.currentIndex),Ae.push(R[0],R[1],0|R[2],this.totalDistance-Fr,this.thickness,0|R[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(Ae,Oe,R,this.normal,this.thickness,this.totalDistance-Fr);if(oe.push(M+0,M+1,M+2),Q){var wn=td([Q[0],Q[1]]);wv(tr,wn)&&xp(wn,tr,q0(wn,bv(wn,tr,gr))),nd(df,wn,tr);var nn=On(Sv(Gf,$u(),Ku,df,this.thickness),2),Hn=nn[0],di=nn[1],yo=Ev(Gf,this.normal)<0?-1:1,Ka=Dt;!Ka&&this.join==="miter"&&Hn>this.miterLimit&&(Ka=!0),Ka?(Oe.push(this.normal[0],this.normal[1],0),Oe.push(di[0],di[1],0),Ae.push(B[0],B[1],0|B[2],this.totalDistance,-this.thickness*yo,0|B[2]),this.complex.indexes.push(this.currentIndex),Ae.push(B[0],B[1],0|B[2],this.totalDistance,this.thickness*yo,0|B[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,oe.push.apply(oe,an(this.lastFlip!==-yo?[M,M+2,M+3]:[M+2,M+1,M+3])),oe.push(M+2,M+3,M+4),rd(Cv,df),Y0(this.normal,Cv),Oe.push(this.normal[0],this.normal[1],0),Ae.push(B[0],B[1],0|B[2],this.totalDistance,-this.thickness*yo,0|B[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,ue+=3):(this.extrusions(Ae,Oe,B,di,Hn,this.totalDistance),oe.push.apply(oe,an(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),yo=-1,Y0(this.normal,di),ue+=2),this.lastFlip=yo}else{if(rd(this.normal,Ku),Le){var Va=$u(),Xa=$u();lm(Xa,Ku,this.normal),xp(Va,Ku,this.normal),Oe.push(Xa[0],Xa[1],0),Oe.push(Va[0],Va[1],0),Ae.push(B[0],B[1],0|B[2],this.totalDistance,this.thickness,0|B[2]),this.complex.indexes.push(this.currentIndex),Ae.push(B[0],B[1],0|B[2],this.totalDistance,this.thickness,0|B[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(Ae,Oe,B,this.normal,this.thickness,this.totalDistance);oe.push.apply(oe,an(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),ue+=2}return ue}},{key:"extrusions",value:function(w,M,R,B,Q,ue){M.push(B[0],B[1],0),M.push(B[0],B[1],0),w.push(R[0],R[1],0|R[2],ue,-Q,0|R[2]),this.complex.indexes.push(this.currentIndex),w.push(R[0],R[1],0|R[2],ue,Q,0|R[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(w,M){var R=M[0]-w[0],B=M[1]-w[1];return Math.sqrt(R*R+B*B)}}]),y}();function Gg(y){var w=y.coordinates,M=y.originCoordinates,R=y.version,B=new Qm({dash:!0,join:"bevel"});if(R==="GAODE2.x"){var Q=w;Array.isArray(Q[0][0])||(Q=[w]);var ue=M;Array.isArray(ue[0][0])||(ue=[M]);for(var oe=0;oe<Q.length;oe++){var Ae=Q[oe],Oe=ue[oe];B.extrude_gaode2(Ae,Oe)}}else{var Le=w;Le[0]&&!Array.isArray(Le[0][0])&&(Le=[w]),Le.forEach(function(tr){B.extrude(tr)})}var Dt=B.complex;return{vertices:Dt.positions,indices:Dt.indices,normals:Dt.normals,indexes:Dt.indexes,size:6}}function Hg(y){var w=function(M){if(xv(M[0]))return M;if(xv(M[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(xv(M[0][0][0])){var R=0,B=0,Q=0;return M.forEach(function(ue){ue.forEach(function(oe){R+=oe[0],B+=oe[1],Q++})}),[R/Q,B/Q,0]}throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}(y.coordinates);return{vertices:[].concat(an(w),an(w),an(w),an(w)),indices:[0,1,2,2,3,0],size:w.length}}function Wg(y){var w=y.coordinates,M=vp.flatten(w),R=M.vertices,B=M.dimensions,Q=M.holes;return{indices:vp(R,Q,B),vertices:R,size:B}}var Jm=function(){var y=Tr(Jr().mark(function w(M){var R,B,Q,ue,oe,Ae,Oe,Le,Dt;return Jr().wrap(function(tr){for(;;)switch(tr.prev=tr.next){case 0:return R=M.descriptors,B=M.features,Q=M.enablePicking,ue=M.iconMap,oe={a_Color:Kd,a_Position:Qd,filter:kd,a_vertexId:dp,a_PickingColor:function(gr,Fr){var Qr=gr.id;return Q?$d(Qr):[0,0,0]},a_DistanceAndIndex:function(gr,Fr,Qr,hn,wn,nn){return nn===void 0?[Qr[3],10]:[Qr[3],nn]},a_Total_Distance:function(gr,Fr,Qr,hn){return[Qr[5]]},a_Size:function(gr,Fr,Qr,hn){var wn=gr.size,nn=wn===void 0?1:wn;return Array.isArray(nn)?[nn[0],nn[1]]:[nn,0]},a_Normal:function(gr,Fr,Qr,hn,wn){return wn},a_Miter:function(gr,Fr,Qr,hn){return[Qr[4]]},a_iconMapUV:function(gr,Fr,Qr,hn){var wn=gr.texture,nn=ue[wn]||{x:0,y:0};return[nn.x,nn.y]}},Ae={sizePerElement:0,elements:[]},Oe=0,Le=[],Dt=3,B.forEach(function(gr,Fr){var Qr=Gg(gr),hn=Qr.indices,wn=Qr.vertices,nn=Qr.normals,Hn=Qr.size,di=Qr.indexes;hn.forEach(function(Xa){Le.push(Xa+Oe)}),Dt=Hn;var yo=wn.length/Hn;Ae.sizePerElement=Dt,Ae.elements.push({featureIdx:Fr,vertices:wn,normals:nn,offset:Oe}),Oe+=yo;for(var Ka=function(Xa){var Qa=(nn==null?void 0:nn.slice(3*Xa,3*Xa+3))||[],Nr=wn.slice(Xa*Hn,Xa*Hn+Hn),Wr=0;di&&di[Xa]!==void 0&&(Wr=di[Xa]),R.forEach(function(ki,ja){var ha;ki&&oe[ki.name]&&(ha=ki.buffer.data).push.apply(ha,an(oe[ki.name](gr,Fr,Nr,Xa,Qa,Wr)))})},Va=0;Va<yo;Va++)Ka(Va)}),tr.abrupt("return",{descriptors:R,featureLayout:Ae,indices:Le});case 8:case"end":return tr.stop()}},w)}));return function(w){return y.apply(this,arguments)}}(),cm={pointFill:function(){var y=Tr(Jr().mark(function w(M){var R,B,Q,ue,oe,Ae,Oe,Le,Dt;return Jr().wrap(function(tr){for(;;)switch(tr.prev=tr.next){case 0:return R=M.descriptors,B=M.features,Q=M.enablePicking,ue=M.shape2d,oe={a_Color:Kd,a_Position:Qd,filter:kd,a_vertexId:dp,a_PickingColor:function(gr,Fr){var Qr=gr.id;return Q?$d(Qr):[0,0,0]},a_Shape:function(gr,Fr,Qr,hn){var wn=gr.shape,nn=wn===void 0?2:wn;return[ue.indexOf(nn)]},a_Extrude:function(gr,Fr,Qr,hn){var wn=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],nn=hn%4*3;return[wn[nn],wn[nn+1],wn[nn+2]]},a_Size:function(gr,Fr,Qr,hn){var wn=gr.size,nn=wn===void 0?5:wn;return Array.isArray(nn)?[nn[0]]:[nn]}},Ae={sizePerElement:0,elements:[]},Oe=0,Le=[],Dt=3,B.forEach(function(gr,Fr){var Qr=Hg(gr),hn=Qr.indices,wn=Qr.vertices,nn=Qr.normals,Hn=Qr.size;hn.forEach(function(Va){Le.push(Va+Oe)}),Dt=Hn;var di=wn.length/Hn;Ae.sizePerElement=Dt,Ae.elements.push({featureIdx:Fr,vertices:wn,normals:nn,offset:Oe}),Oe+=di;for(var yo=function(Va){var Xa=[],Qa=wn.slice(Va*Hn,Va*Hn+Hn);R.forEach(function(Nr,Wr){var ki;Nr&&oe[Nr.name]&&(ki=Nr.buffer.data).push.apply(ki,an(oe[Nr.name](gr,Fr,Qa,Va,Xa,0)))})},Ka=0;Ka<di;Ka++)yo(Ka)}),tr.abrupt("return",{descriptors:R,featureLayout:Ae,indices:Le});case 8:case"end":return tr.stop()}},w)}));return function(w){return y.apply(this,arguments)}}(),line:Jm,polygonFill:function(){var y=Tr(Jr().mark(function w(M){var R,B,Q,ue,oe,Ae,Oe,Le;return Jr().wrap(function(Dt){for(;;)switch(Dt.prev=Dt.next){case 0:return R=M.descriptors,B=M.features,Q=M.enablePicking,ue={a_Color:Kd,a_Position:Qd,filter:kd,a_vertexId:dp,a_PickingColor:function(tr,gr){var Fr=tr.id;return Q?$d(Fr):[0,0,0]}},oe={sizePerElement:0,elements:[]},Ae=0,Oe=[],Le=3,B.forEach(function(tr,gr){var Fr=Wg(tr),Qr=Fr.indices,hn=Fr.vertices,wn=Fr.normals,nn=Fr.size;Qr.forEach(function(Ka){Oe.push(Ka+Ae)}),Le=nn;var Hn=hn.length/nn;oe.sizePerElement=Le,oe.elements.push({featureIdx:gr,vertices:hn,normals:wn,offset:Ae}),Ae+=Hn;for(var di=function(Ka){var Va=[],Xa=hn.slice(Ka*nn,Ka*nn+nn);R.forEach(function(Qa,Nr){var Wr;Qa&&ue[Qa.name]&&(Wr=Qa.buffer.data).push.apply(Wr,an(ue[Qa.name](tr,gr,Xa,Ka,Va,0)))})},yo=0;yo<Hn;yo++)di(yo)}),Dt.abrupt("return",{descriptors:R,featureLayout:oe,indices:Oe});case 8:case"end":return Dt.stop()}},w)}));return function(w){return y.apply(this,arguments)}}()},fm=function(y){for(var w=1;w<arguments.length;w++){var M=arguments[w]!=null?arguments[w]:{};w%2?x(Object(M),!0).forEach(function(R){Kt(y,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(M)):x(Object(M)).forEach(function(R){Object.defineProperty(y,R,Object.getOwnPropertyDescriptor(M,R))})}return y}({},cm);function Av(y){return hm.apply(this,arguments)}function hm(){return(hm=Tr(Jr().mark(function y(w){var M,R;return Jr().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(M=w.workerType,R=w.data,!fm[M]){B.next=3;break}return B.abrupt("return",fm[M](R));case 3:return B.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(M,'" non-existent.'))));case 4:case"end":return B.stop()}},y)}))).apply(this,arguments)}return te(Av),Ft.WorkerSourceMap=cm,Ft.createWorker=te,Ft.worker=Av,Ft}({})},38163:function(Ja){Ja.exports=ji;function ji(Ft,x){var Jr=Ft&&Ft.type,tt;if(Jr==="FeatureCollection")for(tt=0;tt<Ft.features.length;tt++)ji(Ft.features[tt],x);else if(Jr==="GeometryCollection")for(tt=0;tt<Ft.geometries.length;tt++)ji(Ft.geometries[tt],x);else if(Jr==="Feature")ji(Ft.geometry,x);else if(Jr==="Polygon")vt(Ft.coordinates,x);else if(Jr==="MultiPolygon")for(tt=0;tt<Ft.coordinates.length;tt++)vt(Ft.coordinates[tt],x);return Ft}function vt(Ft,x){if(Ft.length!==0){rr(Ft[0],x);for(var Jr=1;Jr<Ft.length;Jr++)rr(Ft[Jr],!x)}}function rr(Ft,x){for(var Jr=0,tt=0,Tr=0,rt=Ft.length,fr=rt-1;Tr<rt;fr=Tr++){var Xe=(Ft[Tr][0]-Ft[fr][0])*(Ft[fr][1]+Ft[Tr][1]),Kt=Jr+Xe;tt+=Math.abs(Jr)>=Math.abs(Xe)?Jr-Kt+Xe:Xe-Kt+Jr,Jr=Kt}Jr+tt>=0!=!!x&&Ft.reverse()}},75550:function(Ja){"use strict";Ja.exports=ji;function ji(vt,rr){this.x=vt,this.y=rr}ji.prototype={clone:function(){return new ji(this.x,this.y)},add:function(vt){return this.clone()._add(vt)},sub:function(vt){return this.clone()._sub(vt)},multByPoint:function(vt){return this.clone()._multByPoint(vt)},divByPoint:function(vt){return this.clone()._divByPoint(vt)},mult:function(vt){return this.clone()._mult(vt)},div:function(vt){return this.clone()._div(vt)},rotate:function(vt){return this.clone()._rotate(vt)},rotateAround:function(vt,rr){return this.clone()._rotateAround(vt,rr)},matMult:function(vt){return this.clone()._matMult(vt)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(vt){return this.x===vt.x&&this.y===vt.y},dist:function(vt){return Math.sqrt(this.distSqr(vt))},distSqr:function(vt){var rr=vt.x-this.x,Ft=vt.y-this.y;return rr*rr+Ft*Ft},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(vt){return Math.atan2(this.y-vt.y,this.x-vt.x)},angleWith:function(vt){return this.angleWithSep(vt.x,vt.y)},angleWithSep:function(vt,rr){return Math.atan2(this.x*rr-this.y*vt,this.x*vt+this.y*rr)},_matMult:function(vt){var rr=vt[0]*this.x+vt[1]*this.y,Ft=vt[2]*this.x+vt[3]*this.y;return this.x=rr,this.y=Ft,this},_add:function(vt){return this.x+=vt.x,this.y+=vt.y,this},_sub:function(vt){return this.x-=vt.x,this.y-=vt.y,this},_mult:function(vt){return this.x*=vt,this.y*=vt,this},_div:function(vt){return this.x/=vt,this.y/=vt,this},_multByPoint:function(vt){return this.x*=vt.x,this.y*=vt.y,this},_divByPoint:function(vt){return this.x/=vt.x,this.y/=vt.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var vt=this.y;return this.y=this.x,this.x=-vt,this},_rotate:function(vt){var rr=Math.cos(vt),Ft=Math.sin(vt),x=rr*this.x-Ft*this.y,Jr=Ft*this.x+rr*this.y;return this.x=x,this.y=Jr,this},_rotateAround:function(vt,rr){var Ft=Math.cos(vt),x=Math.sin(vt),Jr=rr.x+Ft*(this.x-rr.x)-x*(this.y-rr.y),tt=rr.y+x*(this.x-rr.x)+Ft*(this.y-rr.y);return this.x=Jr,this.y=tt,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ji.convert=function(vt){return vt instanceof ji?vt:Array.isArray(vt)?new ji(vt[0],vt[1]):vt}},38929:function(Ja,ji,vt){Ja.exports.VectorTile=vt(22779),vt(66024),vt(59701)},22779:function(Ja,ji,vt){"use strict";var rr=vt(59701);Ja.exports=Ft;function Ft(Jr,tt){this.layers=Jr.readFields(x,{},tt)}function x(Jr,tt,Tr){if(Jr===3){var rt=new rr(Tr,Tr.readVarint()+Tr.pos);rt.length&&(tt[rt.name]=rt)}}},66024:function(Ja,ji,vt){"use strict";var rr=vt(75550);Ja.exports=Ft;function Ft(rt,fr,Xe,Kt,hr){this.properties={},this.extent=Xe,this.type=0,this._pbf=rt,this._geometry=-1,this._keys=Kt,this._values=hr,rt.readFields(x,this,fr)}function x(rt,fr,Xe){rt==1?fr.id=Xe.readVarint():rt==2?Jr(Xe,fr):rt==3?fr.type=Xe.readVarint():rt==4&&(fr._geometry=Xe.pos)}function Jr(rt,fr){for(var Xe=rt.readVarint()+rt.pos;rt.pos<Xe;){var Kt=fr._keys[rt.readVarint()],hr=fr._values[rt.readVarint()];fr.properties[Kt]=hr}}Ft.types=["Unknown","Point","LineString","Polygon"],Ft.prototype.loadGeometry=function(){var rt=this._pbf;rt.pos=this._geometry;for(var fr=rt.readVarint()+rt.pos,Xe=1,Kt=0,hr=0,jt=0,ar=[],ur;rt.pos<fr;){if(Kt<=0){var Ir=rt.readVarint();Xe=Ir&7,Kt=Ir>>3}if(Kt--,Xe===1||Xe===2)hr+=rt.readSVarint(),jt+=rt.readSVarint(),Xe===1&&(ur&&ar.push(ur),ur=[]),ur.push(new rr(hr,jt));else if(Xe===7)ur&&ur.push(ur[0].clone());else throw new Error("unknown command "+Xe)}return ur&&ar.push(ur),ar},Ft.prototype.bbox=function(){var rt=this._pbf;rt.pos=this._geometry;for(var fr=rt.readVarint()+rt.pos,Xe=1,Kt=0,hr=0,jt=0,ar=1/0,ur=-1/0,Ir=1/0,Kn=-1/0;rt.pos<fr;){if(Kt<=0){var On=rt.readVarint();Xe=On&7,Kt=On>>3}if(Kt--,Xe===1||Xe===2)hr+=rt.readSVarint(),jt+=rt.readSVarint(),hr<ar&&(ar=hr),hr>ur&&(ur=hr),jt<Ir&&(Ir=jt),jt>Kn&&(Kn=jt);else if(Xe!==7)throw new Error("unknown command "+Xe)}return[ar,Ir,ur,Kn]},Ft.prototype.toGeoJSON=function(rt,fr,Xe){var Kt=this.extent*Math.pow(2,Xe),hr=this.extent*rt,jt=this.extent*fr,ar=this.loadGeometry(),ur=Ft.types[this.type],Ir,Kn;function On(ri){for(var me=0;me<ri.length;me++){var _i=ri[me],Rr=180-(_i.y+jt)*360/Kt;ri[me]=[(_i.x+hr)*360/Kt-180,360/Math.PI*Math.atan(Math.exp(Rr*Math.PI/180))-90]}}switch(this.type){case 1:var an=[];for(Ir=0;Ir<ar.length;Ir++)an[Ir]=ar[Ir][0];ar=an,On(ar);break;case 2:for(Ir=0;Ir<ar.length;Ir++)On(ar[Ir]);break;case 3:for(ar=tt(ar),Ir=0;Ir<ar.length;Ir++)for(Kn=0;Kn<ar[Ir].length;Kn++)On(ar[Ir][Kn]);break}ar.length===1?ar=ar[0]:ur="Multi"+ur;var Pi={type:"Feature",geometry:{type:ur,coordinates:ar},properties:this.properties};return"id"in this&&(Pi.id=this.id),Pi};function tt(rt){var fr=rt.length;if(fr<=1)return[rt];for(var Xe=[],Kt,hr,jt=0;jt<fr;jt++){var ar=Tr(rt[jt]);ar!==0&&(hr===void 0&&(hr=ar<0),hr===ar<0?(Kt&&Xe.push(Kt),Kt=[rt[jt]]):Kt.push(rt[jt]))}return Kt&&Xe.push(Kt),Xe}function Tr(rt){for(var fr=0,Xe=0,Kt=rt.length,hr=Kt-1,jt,ar;Xe<Kt;hr=Xe++)jt=rt[Xe],ar=rt[hr],fr+=(ar.x-jt.x)*(jt.y+ar.y);return fr}},59701:function(Ja,ji,vt){"use strict";var rr=vt(66024);Ja.exports=Ft;function Ft(tt,Tr){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=tt,this._keys=[],this._values=[],this._features=[],tt.readFields(x,this,Tr),this.length=this._features.length}function x(tt,Tr,rt){tt===15?Tr.version=rt.readVarint():tt===1?Tr.name=rt.readString():tt===5?Tr.extent=rt.readVarint():tt===2?Tr._features.push(rt.pos):tt===3?Tr._keys.push(rt.readString()):tt===4&&Tr._values.push(Jr(rt))}function Jr(tt){for(var Tr=null,rt=tt.readVarint()+tt.pos;tt.pos<rt;){var fr=tt.readVarint()>>3;Tr=fr===1?tt.readString():fr===2?tt.readFloat():fr===3?tt.readDouble():fr===4?tt.readVarint64():fr===5?tt.readVarint():fr===6?tt.readSVarint():fr===7?tt.readBoolean():null}return Tr}Ft.prototype.feature=function(tt){if(tt<0||tt>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[tt];var Tr=this._pbf.readVarint()+this._pbf.pos;return new rr(this._pbf,Tr,this.extent,this._keys,this._values)}},9187:function(Ja){"use strict";Ja.exports=ji,Ja.exports.default=ji;function ji(Z,Ze,Pe){Pe=Pe||2;var ft=Ze&&Ze.length,It=ft?Ze[0]*Pe:Z.length,qt=vt(Z,0,It,Pe,!0),yt=[];if(!qt||qt.next===qt.prev)return yt;var cr,Xn,Vn,Gi,ai,Rn,Ba;if(ft&&(qt=rt(Z,Ze,qt,Pe)),Z.length>80*Pe){cr=Vn=Z[0],Xn=Gi=Z[1];for(var oa=Pe;oa<It;oa+=Pe)ai=Z[oa],Rn=Z[oa+1],ai<cr&&(cr=ai),Rn<Xn&&(Xn=Rn),ai>Vn&&(Vn=ai),Rn>Gi&&(Gi=Rn);Ba=Math.max(Vn-cr,Gi-Xn),Ba=Ba!==0?32767/Ba:0}return Ft(qt,yt,Pe,cr,Xn,Ba,0),yt}function vt(Z,Ze,Pe,ft,It){var qt,yt;if(It===Ee(Z,Ze,Pe,ft)>0)for(qt=Ze;qt<Pe;qt+=ft)yt=en(qt,Z[qt],Z[qt+1],yt);else for(qt=Pe-ft;qt>=Ze;qt-=ft)yt=en(qt,Z[qt],Z[qt+1],yt);return yt&&Pi(yt,yt.next)&&(Wn(yt),yt=yt.next),yt}function rr(Z,Ze){if(!Z)return Z;Ze||(Ze=Z);var Pe=Z,ft;do if(ft=!1,!Pe.steiner&&(Pi(Pe,Pe.next)||an(Pe.prev,Pe,Pe.next)===0)){if(Wn(Pe),Pe=Ze=Pe.prev,Pe===Pe.next)break;ft=!0}else Pe=Pe.next;while(ft||Pe!==Ze);return Ze}function Ft(Z,Ze,Pe,ft,It,qt,yt){if(!!Z){!yt&&qt&&jt(Z,ft,It,qt);for(var cr=Z,Xn,Vn;Z.prev!==Z.next;){if(Xn=Z.prev,Vn=Z.next,qt?Jr(Z,ft,It,qt):x(Z)){Ze.push(Xn.i/Pe|0),Ze.push(Z.i/Pe|0),Ze.push(Vn.i/Pe|0),Wn(Z),Z=Vn.next,cr=Vn.next;continue}if(Z=Vn,Z===cr){yt?yt===1?(Z=tt(rr(Z),Ze,Pe),Ft(Z,Ze,Pe,ft,It,qt,2)):yt===2&&Tr(Z,Ze,Pe,ft,It,qt):Ft(rr(Z),Ze,Pe,ft,It,qt,1);break}}}}function x(Z){var Ze=Z.prev,Pe=Z,ft=Z.next;if(an(Ze,Pe,ft)>=0)return!1;for(var It=Ze.x,qt=Pe.x,yt=ft.x,cr=Ze.y,Xn=Pe.y,Vn=ft.y,Gi=It<qt?It<yt?It:yt:qt<yt?qt:yt,ai=cr<Xn?cr<Vn?cr:Vn:Xn<Vn?Xn:Vn,Rn=It>qt?It>yt?It:yt:qt>yt?qt:yt,Ba=cr>Xn?cr>Vn?cr:Vn:Xn>Vn?Xn:Vn,oa=ft.next;oa!==Ze;){if(oa.x>=Gi&&oa.x<=Rn&&oa.y>=ai&&oa.y<=Ba&&Kn(It,cr,qt,Xn,yt,Vn,oa.x,oa.y)&&an(oa.prev,oa,oa.next)>=0)return!1;oa=oa.next}return!0}function Jr(Z,Ze,Pe,ft){var It=Z.prev,qt=Z,yt=Z.next;if(an(It,qt,yt)>=0)return!1;for(var cr=It.x,Xn=qt.x,Vn=yt.x,Gi=It.y,ai=qt.y,Rn=yt.y,Ba=cr<Xn?cr<Vn?cr:Vn:Xn<Vn?Xn:Vn,oa=Gi<ai?Gi<Rn?Gi:Rn:ai<Rn?ai:Rn,Ti=cr>Xn?cr>Vn?cr:Vn:Xn>Vn?Xn:Vn,Ca=Gi>ai?Gi>Rn?Gi:Rn:ai>Rn?ai:Rn,xi=ur(Ba,oa,Ze,Pe,ft),Hi=ur(Ti,Ca,Ze,Pe,ft),vi=Z.prevZ,mi=Z.nextZ;vi&&vi.z>=xi&&mi&&mi.z<=Hi;){if(vi.x>=Ba&&vi.x<=Ti&&vi.y>=oa&&vi.y<=Ca&&vi!==It&&vi!==yt&&Kn(cr,Gi,Xn,ai,Vn,Rn,vi.x,vi.y)&&an(vi.prev,vi,vi.next)>=0||(vi=vi.prevZ,mi.x>=Ba&&mi.x<=Ti&&mi.y>=oa&&mi.y<=Ca&&mi!==It&&mi!==yt&&Kn(cr,Gi,Xn,ai,Vn,Rn,mi.x,mi.y)&&an(mi.prev,mi,mi.next)>=0))return!1;mi=mi.nextZ}for(;vi&&vi.z>=xi;){if(vi.x>=Ba&&vi.x<=Ti&&vi.y>=oa&&vi.y<=Ca&&vi!==It&&vi!==yt&&Kn(cr,Gi,Xn,ai,Vn,Rn,vi.x,vi.y)&&an(vi.prev,vi,vi.next)>=0)return!1;vi=vi.prevZ}for(;mi&&mi.z<=Hi;){if(mi.x>=Ba&&mi.x<=Ti&&mi.y>=oa&&mi.y<=Ca&&mi!==It&&mi!==yt&&Kn(cr,Gi,Xn,ai,Vn,Rn,mi.x,mi.y)&&an(mi.prev,mi,mi.next)>=0)return!1;mi=mi.nextZ}return!0}function tt(Z,Ze,Pe){var ft=Z;do{var It=ft.prev,qt=ft.next.next;!Pi(It,qt)&&ri(It,ft,ft.next,qt)&&ir(It,qt)&&ir(qt,It)&&(Ze.push(It.i/Pe|0),Ze.push(ft.i/Pe|0),Ze.push(qt.i/Pe|0),Wn(ft),Wn(ft.next),ft=Z=qt),ft=ft.next}while(ft!==Z);return rr(ft)}function Tr(Z,Ze,Pe,ft,It,qt){var yt=Z;do{for(var cr=yt.next.next;cr!==yt.prev;){if(yt.i!==cr.i&&On(yt,cr)){var Xn=st(yt,cr);yt=rr(yt,yt.next),Xn=rr(Xn,Xn.next),Ft(yt,Ze,Pe,ft,It,qt,0),Ft(Xn,Ze,Pe,ft,It,qt,0);return}cr=cr.next}yt=yt.next}while(yt!==Z)}function rt(Z,Ze,Pe,ft){var It=[],qt,yt,cr,Xn,Vn;for(qt=0,yt=Ze.length;qt<yt;qt++)cr=Ze[qt]*ft,Xn=qt<yt-1?Ze[qt+1]*ft:Z.length,Vn=vt(Z,cr,Xn,ft,!1),Vn===Vn.next&&(Vn.steiner=!0),It.push(Ir(Vn));for(It.sort(fr),qt=0;qt<It.length;qt++)Pe=Xe(It[qt],Pe);return Pe}function fr(Z,Ze){return Z.x-Ze.x}function Xe(Z,Ze){var Pe=Kt(Z,Ze);if(!Pe)return Ze;var ft=st(Pe,Z);return rr(ft,ft.next),rr(Pe,Pe.next)}function Kt(Z,Ze){var Pe=Ze,ft=Z.x,It=Z.y,qt=-1/0,yt;do{if(It<=Pe.y&&It>=Pe.next.y&&Pe.next.y!==Pe.y){var cr=Pe.x+(It-Pe.y)*(Pe.next.x-Pe.x)/(Pe.next.y-Pe.y);if(cr<=ft&&cr>qt&&(qt=cr,yt=Pe.x<Pe.next.x?Pe:Pe.next,cr===ft))return yt}Pe=Pe.next}while(Pe!==Ze);if(!yt)return null;var Xn=yt,Vn=yt.x,Gi=yt.y,ai=1/0,Rn;Pe=yt;do ft>=Pe.x&&Pe.x>=Vn&&ft!==Pe.x&&Kn(It<Gi?ft:qt,It,Vn,Gi,It<Gi?qt:ft,It,Pe.x,Pe.y)&&(Rn=Math.abs(It-Pe.y)/(ft-Pe.x),ir(Pe,Z)&&(Rn<ai||Rn===ai&&(Pe.x>yt.x||Pe.x===yt.x&&hr(yt,Pe)))&&(yt=Pe,ai=Rn)),Pe=Pe.next;while(Pe!==Xn);return yt}function hr(Z,Ze){return an(Z.prev,Z,Ze.prev)<0&&an(Ze.next,Z,Z.next)<0}function jt(Z,Ze,Pe,ft){var It=Z;do It.z===0&&(It.z=ur(It.x,It.y,Ze,Pe,ft)),It.prevZ=It.prev,It.nextZ=It.next,It=It.next;while(It!==Z);It.prevZ.nextZ=null,It.prevZ=null,ar(It)}function ar(Z){var Ze,Pe,ft,It,qt,yt,cr,Xn,Vn=1;do{for(Pe=Z,Z=null,qt=null,yt=0;Pe;){for(yt++,ft=Pe,cr=0,Ze=0;Ze<Vn&&(cr++,ft=ft.nextZ,!!ft);Ze++);for(Xn=Vn;cr>0||Xn>0&&ft;)cr!==0&&(Xn===0||!ft||Pe.z<=ft.z)?(It=Pe,Pe=Pe.nextZ,cr--):(It=ft,ft=ft.nextZ,Xn--),qt?qt.nextZ=It:Z=It,It.prevZ=qt,qt=It;Pe=ft}qt.nextZ=null,Vn*=2}while(yt>1);return Z}function ur(Z,Ze,Pe,ft,It){return Z=(Z-Pe)*It|0,Ze=(Ze-ft)*It|0,Z=(Z|Z<<8)&16711935,Z=(Z|Z<<4)&252645135,Z=(Z|Z<<2)&858993459,Z=(Z|Z<<1)&1431655765,Ze=(Ze|Ze<<8)&16711935,Ze=(Ze|Ze<<4)&252645135,Ze=(Ze|Ze<<2)&858993459,Ze=(Ze|Ze<<1)&1431655765,Z|Ze<<1}function Ir(Z){var Ze=Z,Pe=Z;do(Ze.x<Pe.x||Ze.x===Pe.x&&Ze.y<Pe.y)&&(Pe=Ze),Ze=Ze.next;while(Ze!==Z);return Pe}function Kn(Z,Ze,Pe,ft,It,qt,yt,cr){return(It-yt)*(Ze-cr)>=(Z-yt)*(qt-cr)&&(Z-yt)*(ft-cr)>=(Pe-yt)*(Ze-cr)&&(Pe-yt)*(qt-cr)>=(It-yt)*(ft-cr)}function On(Z,Ze){return Z.next.i!==Ze.i&&Z.prev.i!==Ze.i&&!Rr(Z,Ze)&&(ir(Z,Ze)&&ir(Ze,Z)&&zr(Z,Ze)&&(an(Z.prev,Z,Ze.prev)||an(Z,Ze.prev,Ze))||Pi(Z,Ze)&&an(Z.prev,Z,Z.next)>0&&an(Ze.prev,Ze,Ze.next)>0)}function an(Z,Ze,Pe){return(Ze.y-Z.y)*(Pe.x-Ze.x)-(Ze.x-Z.x)*(Pe.y-Ze.y)}function Pi(Z,Ze){return Z.x===Ze.x&&Z.y===Ze.y}function ri(Z,Ze,Pe,ft){var It=_i(an(Z,Ze,Pe)),qt=_i(an(Z,Ze,ft)),yt=_i(an(Pe,ft,Z)),cr=_i(an(Pe,ft,Ze));return!!(It!==qt&&yt!==cr||It===0&&me(Z,Pe,Ze)||qt===0&&me(Z,ft,Ze)||yt===0&&me(Pe,Z,ft)||cr===0&&me(Pe,Ze,ft))}function me(Z,Ze,Pe){return Ze.x<=Math.max(Z.x,Pe.x)&&Ze.x>=Math.min(Z.x,Pe.x)&&Ze.y<=Math.max(Z.y,Pe.y)&&Ze.y>=Math.min(Z.y,Pe.y)}function _i(Z){return Z>0?1:Z<0?-1:0}function Rr(Z,Ze){var Pe=Z;do{if(Pe.i!==Z.i&&Pe.next.i!==Z.i&&Pe.i!==Ze.i&&Pe.next.i!==Ze.i&&ri(Pe,Pe.next,Z,Ze))return!0;Pe=Pe.next}while(Pe!==Z);return!1}function ir(Z,Ze){return an(Z.prev,Z,Z.next)<0?an(Z,Ze,Z.next)>=0&&an(Z,Z.prev,Ze)>=0:an(Z,Ze,Z.prev)<0||an(Z,Z.next,Ze)<0}function zr(Z,Ze){var Pe=Z,ft=!1,It=(Z.x+Ze.x)/2,qt=(Z.y+Ze.y)/2;do Pe.y>qt!=Pe.next.y>qt&&Pe.next.y!==Pe.y&&It<(Pe.next.x-Pe.x)*(qt-Pe.y)/(Pe.next.y-Pe.y)+Pe.x&&(ft=!ft),Pe=Pe.next;while(Pe!==Z);return ft}function st(Z,Ze){var Pe=new ce(Z.i,Z.x,Z.y),ft=new ce(Ze.i,Ze.x,Ze.y),It=Z.next,qt=Ze.prev;return Z.next=Ze,Ze.prev=Z,Pe.next=It,It.prev=Pe,ft.next=Pe,Pe.prev=ft,qt.next=ft,ft.prev=qt,ft}function en(Z,Ze,Pe,ft){var It=new ce(Z,Ze,Pe);return ft?(It.next=ft.next,It.prev=ft,ft.next.prev=It,ft.next=It):(It.prev=It,It.next=It),It}function Wn(Z){Z.next.prev=Z.prev,Z.prev.next=Z.next,Z.prevZ&&(Z.prevZ.nextZ=Z.nextZ),Z.nextZ&&(Z.nextZ.prevZ=Z.prevZ)}function ce(Z,Ze,Pe){this.i=Z,this.x=Ze,this.y=Pe,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}ji.deviation=function(Z,Ze,Pe,ft){var It=Ze&&Ze.length,qt=It?Ze[0]*Pe:Z.length,yt=Math.abs(Ee(Z,0,qt,Pe));if(It)for(var cr=0,Xn=Ze.length;cr<Xn;cr++){var Vn=Ze[cr]*Pe,Gi=cr<Xn-1?Ze[cr+1]*Pe:Z.length;yt-=Math.abs(Ee(Z,Vn,Gi,Pe))}var ai=0;for(cr=0;cr<ft.length;cr+=3){var Rn=ft[cr]*Pe,Ba=ft[cr+1]*Pe,oa=ft[cr+2]*Pe;ai+=Math.abs((Z[Rn]-Z[oa])*(Z[Ba+1]-Z[Rn+1])-(Z[Rn]-Z[Ba])*(Z[oa+1]-Z[Rn+1]))}return yt===0&&ai===0?0:Math.abs((ai-yt)/yt)};function Ee(Z,Ze,Pe,ft){for(var It=0,qt=Ze,yt=Pe-ft;qt<Pe;qt+=ft)It+=(Z[yt]-Z[qt])*(Z[qt+1]+Z[yt+1]),yt=qt;return It}ji.flatten=function(Z){for(var Ze=Z[0][0].length,Pe={vertices:[],holes:[],dimensions:Ze},ft=0,It=0;It<Z.length;It++){for(var qt=0;qt<Z[It].length;qt++)for(var yt=0;yt<Ze;yt++)Pe.vertices.push(Z[It][qt][yt]);It>0&&(ft+=Z[It-1].length,Pe.holes.push(ft))}return Pe}},67709:function(Ja){function ji(rr){var Ft=rr.target||rr.srcElement;Ft.__resizeRAF__&&cancelAnimationFrame(Ft.__resizeRAF__),Ft.__resizeRAF__=requestAnimationFrame(function(){var x=Ft.__resizeTrigger__,Jr=x&&x.__resizeListeners__;Jr&&Jr.forEach(function(tt){tt.call(x,rr)})})}var vt=function(Ft,x){var Jr=this,tt=Jr.document,Tr,rt=tt.attachEvent;typeof navigator<"u"&&(Tr=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function fr(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",ji)}if(!Ft.__resizeListeners__)if(Ft.__resizeListeners__=[],rt)Ft.__resizeTrigger__=Ft,Ft.attachEvent("onresize",ji);else{getComputedStyle(Ft).position==="static"&&(Ft.style.position="relative");var Xe=Ft.__resizeTrigger__=tt.createElement("object");Xe.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),Xe.setAttribute("class","resize-sensor"),Xe.setAttribute("tabindex","-1"),Xe.setAttribute("title",""),Xe.__resizeElement__=Ft,Xe.onload=fr,Xe.type="text/html",Tr&&Ft.appendChild(Xe),Xe.data="about:blank",Tr||Ft.appendChild(Xe)}Ft.__resizeListeners__.push(x)};Ja.exports=typeof window>"u"?vt:vt.bind(window),Ja.exports.unbind=function(rr,Ft){var x=document.attachEvent,Jr=rr.__resizeListeners__||[];if(Ft){var tt=Jr.indexOf(Ft);tt!==-1&&Jr.splice(tt,1)}else Jr=rr.__resizeListeners__=[];if(!Jr.length){if(x)rr.detachEvent("onresize",ji);else if(rr.__resizeTrigger__){var Tr=rr.__resizeTrigger__.contentDocument,rt=Tr&&Tr.defaultView;rt&&(rt.removeEventListener("resize",ji),delete rt.__resizeTrigger__),rr.__resizeTrigger__=!rr.removeChild(rr.__resizeTrigger__)}delete rr.__resizeListeners__}}},26729:function(Ja){"use strict";var ji=Object.prototype.hasOwnProperty,vt="~";function rr(){}Object.create&&(rr.prototype=Object.create(null),new rr().__proto__||(vt=!1));function Ft(Tr,rt,fr){this.fn=Tr,this.context=rt,this.once=fr||!1}function x(Tr,rt,fr,Xe,Kt){if(typeof fr!="function")throw new TypeError("The listener must be a function");var hr=new Ft(fr,Xe||Tr,Kt),jt=vt?vt+rt:rt;return Tr._events[jt]?Tr._events[jt].fn?Tr._events[jt]=[Tr._events[jt],hr]:Tr._events[jt].push(hr):(Tr._events[jt]=hr,Tr._eventsCount++),Tr}function Jr(Tr,rt){--Tr._eventsCount===0?Tr._events=new rr:delete Tr._events[rt]}function tt(){this._events=new rr,this._eventsCount=0}tt.prototype.eventNames=function(){var rt=[],fr,Xe;if(this._eventsCount===0)return rt;for(Xe in fr=this._events)ji.call(fr,Xe)&&rt.push(vt?Xe.slice(1):Xe);return Object.getOwnPropertySymbols?rt.concat(Object.getOwnPropertySymbols(fr)):rt},tt.prototype.listeners=function(rt){var fr=vt?vt+rt:rt,Xe=this._events[fr];if(!Xe)return[];if(Xe.fn)return[Xe.fn];for(var Kt=0,hr=Xe.length,jt=new Array(hr);Kt<hr;Kt++)jt[Kt]=Xe[Kt].fn;return jt},tt.prototype.listenerCount=function(rt){var fr=vt?vt+rt:rt,Xe=this._events[fr];return Xe?Xe.fn?1:Xe.length:0},tt.prototype.emit=function(rt,fr,Xe,Kt,hr,jt){var ar=vt?vt+rt:rt;if(!this._events[ar])return!1;var ur=this._events[ar],Ir=arguments.length,Kn,On;if(ur.fn){switch(ur.once&&this.removeListener(rt,ur.fn,void 0,!0),Ir){case 1:return ur.fn.call(ur.context),!0;case 2:return ur.fn.call(ur.context,fr),!0;case 3:return ur.fn.call(ur.context,fr,Xe),!0;case 4:return ur.fn.call(ur.context,fr,Xe,Kt),!0;case 5:return ur.fn.call(ur.context,fr,Xe,Kt,hr),!0;case 6:return ur.fn.call(ur.context,fr,Xe,Kt,hr,jt),!0}for(On=1,Kn=new Array(Ir-1);On<Ir;On++)Kn[On-1]=arguments[On];ur.fn.apply(ur.context,Kn)}else{var an=ur.length,Pi;for(On=0;On<an;On++)switch(ur[On].once&&this.removeListener(rt,ur[On].fn,void 0,!0),Ir){case 1:ur[On].fn.call(ur[On].context);break;case 2:ur[On].fn.call(ur[On].context,fr);break;case 3:ur[On].fn.call(ur[On].context,fr,Xe);break;case 4:ur[On].fn.call(ur[On].context,fr,Xe,Kt);break;default:if(!Kn)for(Pi=1,Kn=new Array(Ir-1);Pi<Ir;Pi++)Kn[Pi-1]=arguments[Pi];ur[On].fn.apply(ur[On].context,Kn)}}return!0},tt.prototype.on=function(rt,fr,Xe){return x(this,rt,fr,Xe,!1)},tt.prototype.once=function(rt,fr,Xe){return x(this,rt,fr,Xe,!0)},tt.prototype.removeListener=function(rt,fr,Xe,Kt){var hr=vt?vt+rt:rt;if(!this._events[hr])return this;if(!fr)return Jr(this,hr),this;var jt=this._events[hr];if(jt.fn)jt.fn===fr&&(!Kt||jt.once)&&(!Xe||jt.context===Xe)&&Jr(this,hr);else{for(var ar=0,ur=[],Ir=jt.length;ar<Ir;ar++)(jt[ar].fn!==fr||Kt&&!jt[ar].once||Xe&&jt[ar].context!==Xe)&&ur.push(jt[ar]);ur.length?this._events[hr]=ur.length===1?ur[0]:ur:Jr(this,hr)}return this},tt.prototype.removeAllListeners=function(rt){var fr;return rt?(fr=vt?vt+rt:rt,this._events[fr]&&Jr(this,fr)):(this._events=new rr,this._eventsCount=0),this},tt.prototype.off=tt.prototype.removeListener,tt.prototype.addListener=tt.prototype.on,tt.prefixed=vt,tt.EventEmitter=tt,Ja.exports=tt},31745:function(Ja){"use strict";Ja.exports=vt,Ja.exports.default=vt;var ji=1e20;function vt(tt,Tr,rt,fr,Xe,Kt){this.fontSize=tt||24,this.buffer=Tr===void 0?3:Tr,this.cutoff=fr||.25,this.fontFamily=Xe||"sans-serif",this.fontWeight=Kt||"normal",this.radius=rt||8;var hr=this.size=this.fontSize+this.buffer*2,jt=hr+this.buffer*2,ar=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;ar?this.canvas=my.createOffscreenCanvas(hr,hr,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=hr),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(jt*jt),this.gridInner=new Float64Array(jt*jt),this.f=new Float64Array(jt),this.z=new Float64Array(jt+1),this.v=new Uint16Array(jt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,ar?this.middle=Math.round(hr/2*1):this.middle=Math.round(hr/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function rr(tt,Tr,rt,fr,Xe,Kt,hr){Kt.fill(ji,0,Tr*rt),hr.fill(0,0,Tr*rt);for(var jt=(Tr-fr)/2,ar=0;ar<Xe;ar++)for(var ur=0;ur<fr;ur++){var Ir=(ar+jt)*Tr+ur+jt,Kn=tt.data[4*(ar*fr+ur)+3]/255;if(Kn===1)Kt[Ir]=0,hr[Ir]=ji;else if(Kn===0)Kt[Ir]=ji,hr[Ir]=0;else{var On=Math.max(0,.5-Kn),an=Math.max(0,Kn-.5);Kt[Ir]=On*On,hr[Ir]=an*an}}}function Ft(tt,Tr,rt,fr,Xe,Kt,hr){for(var jt=0;jt<Tr*rt;jt++){var ar=Math.sqrt(fr[jt])-Math.sqrt(Xe[jt]);tt[jt]=Math.round(255-255*(ar/Kt+hr))}}vt.prototype._draw=function(tt,Tr){var rt=this.ctx.measureText(tt),fr=rt.width,Xe=2*this.buffer,Kt,hr,jt,ar,ur,Ir,Kn,On;Tr&&this.useMetrics?(ur=Math.floor(rt.actualBoundingBoxAscent),On=this.buffer+Math.ceil(rt.actualBoundingBoxAscent),Ir=this.buffer,Kn=this.buffer,hr=Math.min(this.size,Math.ceil(rt.actualBoundingBoxRight-rt.actualBoundingBoxLeft)),ar=Math.min(this.size-Ir,Math.ceil(rt.actualBoundingBoxAscent+rt.actualBoundingBoxDescent)),Kt=hr+Xe,jt=ar+Xe,this.ctx.textBaseline="alphabetic"):(Kt=hr=this.size,jt=ar=this.size,ur=19*this.fontSize/24,Ir=Kn=0,On=this.middle,this.ctx.textBaseline="middle");var an;hr&&ar&&(this.ctx.clearRect(Kn,Ir,hr,ar),this.ctx.fillText(tt,this.buffer,On),an=this.ctx.getImageData(Kn,Ir,hr,ar));var Pi=new Uint8ClampedArray(Kt*jt);return rr(an,Kt,jt,hr,ar,this.gridOuter,this.gridInner),x(this.gridOuter,Kt,jt,this.f,this.v,this.z),x(this.gridInner,Kt,jt,this.f,this.v,this.z),Ft(Pi,Kt,jt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:Pi,metrics:{width:hr,height:ar,sdfWidth:Kt,sdfHeight:jt,top:ur,left:0,advance:fr}}},vt.prototype.draw=function(tt){return this._draw(tt,!1).data},vt.prototype.drawWithMetrics=function(tt){return this._draw(tt,!0)};function x(tt,Tr,rt,fr,Xe,Kt){for(var hr=0;hr<Tr;hr++)Jr(tt,hr,Tr,rt,fr,Xe,Kt);for(var jt=0;jt<rt;jt++)Jr(tt,jt*Tr,1,Tr,fr,Xe,Kt)}function Jr(tt,Tr,rt,fr,Xe,Kt,hr){var jt,ar,ur,Ir;for(Kt[0]=0,hr[0]=-ji,hr[1]=ji,jt=0;jt<fr;jt++)Xe[jt]=tt[Tr+jt*rt];for(jt=1,ar=0,ur=0;jt<fr;jt++){do Ir=Kt[ar],ur=(Xe[jt]-Xe[Ir]+jt*jt-Ir*Ir)/(jt-Ir)/2;while(ur<=hr[ar]&&--ar>-1);ar++,Kt[ar]=jt,hr[ar]=ur,hr[ar+1]=ji}for(jt=0,ar=0;jt<fr;jt++){for(;hr[ar+1]<jt;)ar++;Ir=Kt[ar],tt[Tr+jt*rt]=Xe[Ir]+(jt-Ir)*(jt-Ir)}}},77736:function(Ja,ji,vt){"use strict";vt.r(ji),vt.d(ji,{Function:function(){return _l},Interpreter:function(){return As},default:function(){return gf},evaluate:function(){return Hc},vm:function(){return rr}});var rr={};vt.r(rr),vt.d(rr,{Script:function(){return yl},compileFunction:function(){return Zh},createContext:function(){return Hu},runInContext:function(){return Cc},runInNewContext:function(){return Xf}});var Ft={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},x="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Jr={5:x,"5module":x+" export import",6:x+" const class extends export import super"},tt=/^in(stanceof)?$/,Tr="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",rt="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",fr=new RegExp("["+Tr+"]"),Xe=new RegExp("["+Tr+rt+"]");Tr=rt=null;var Kt=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],hr=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function jt(b,I){for(var G=65536,D=0;D<I.length;D+=2){if(G+=I[D],G>b)return!1;if(G+=I[D+1],G>=b)return!0}}function ar(b,I){return b<65?b===36:b<91?!0:b<97?b===95:b<123?!0:b<=65535?b>=170&&fr.test(String.fromCharCode(b)):I===!1?!1:jt(b,Kt)}function ur(b,I){return b<48?b===36:b<58?!0:b<65?!1:b<91?!0:b<97?b===95:b<123?!0:b<=65535?b>=170&&Xe.test(String.fromCharCode(b)):I===!1?!1:jt(b,Kt)||jt(b,hr)}var Ir=function(I,G){G===void 0&&(G={}),this.label=I,this.keyword=G.keyword,this.beforeExpr=!!G.beforeExpr,this.startsExpr=!!G.startsExpr,this.isLoop=!!G.isLoop,this.isAssign=!!G.isAssign,this.prefix=!!G.prefix,this.postfix=!!G.postfix,this.binop=G.binop||null,this.updateContext=null};function Kn(b,I){return new Ir(b,{beforeExpr:!0,binop:I})}var On={beforeExpr:!0},an={startsExpr:!0},Pi={};function ri(b,I){return I===void 0&&(I={}),I.keyword=b,Pi[b]=new Ir(b,I)}var me={num:new Ir("num",an),regexp:new Ir("regexp",an),string:new Ir("string",an),name:new Ir("name",an),eof:new Ir("eof"),bracketL:new Ir("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Ir("]"),braceL:new Ir("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Ir("}"),parenL:new Ir("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Ir(")"),comma:new Ir(",",On),semi:new Ir(";",On),colon:new Ir(":",On),dot:new Ir("."),question:new Ir("?",On),questionDot:new Ir("?."),arrow:new Ir("=>",On),template:new Ir("template"),invalidTemplate:new Ir("invalidTemplate"),ellipsis:new Ir("...",On),backQuote:new Ir("`",an),dollarBraceL:new Ir("${",{beforeExpr:!0,startsExpr:!0}),eq:new Ir("=",{beforeExpr:!0,isAssign:!0}),assign:new Ir("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Ir("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Ir("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Kn("||",1),logicalAND:Kn("&&",2),bitwiseOR:Kn("|",3),bitwiseXOR:Kn("^",4),bitwiseAND:Kn("&",5),equality:Kn("==/!=/===/!==",6),relational:Kn("</>/<=/>=",7),bitShift:Kn("<</>>/>>>",8),plusMin:new Ir("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Kn("%",10),star:Kn("*",10),slash:Kn("/",10),starstar:new Ir("**",{beforeExpr:!0}),coalesce:Kn("??",1),_break:ri("break"),_case:ri("case",On),_catch:ri("catch"),_continue:ri("continue"),_debugger:ri("debugger"),_default:ri("default",On),_do:ri("do",{isLoop:!0,beforeExpr:!0}),_else:ri("else",On),_finally:ri("finally"),_for:ri("for",{isLoop:!0}),_function:ri("function",an),_if:ri("if"),_return:ri("return",On),_switch:ri("switch"),_throw:ri("throw",On),_try:ri("try"),_var:ri("var"),_const:ri("const"),_while:ri("while",{isLoop:!0}),_with:ri("with"),_new:ri("new",{beforeExpr:!0,startsExpr:!0}),_this:ri("this",an),_super:ri("super",an),_class:ri("class",an),_extends:ri("extends",On),_export:ri("export"),_import:ri("import",an),_null:ri("null",an),_true:ri("true",an),_false:ri("false",an),_in:ri("in",{beforeExpr:!0,binop:7}),_instanceof:ri("instanceof",{beforeExpr:!0,binop:7}),_typeof:ri("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:ri("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:ri("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},_i=/\r\n?|\n|\u2028|\u2029/,Rr=new RegExp(_i.source,"g");function ir(b,I){return b===10||b===13||!I&&(b===8232||b===8233)}var zr=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,st=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,en=Object.prototype,Wn=en.hasOwnProperty,ce=en.toString;function Ee(b,I){return Wn.call(b,I)}var Z=Array.isArray||function(b){return ce.call(b)==="[object Array]"};function Ze(b){return new RegExp("^(?:"+b.replace(/ /g,"|")+")$")}var Pe=function(I,G){this.line=I,this.column=G};Pe.prototype.offset=function(I){return new Pe(this.line,this.column+I)};var ft=function(I,G,D){this.start=G,this.end=D,I.sourceFile!==null&&(this.source=I.sourceFile)};function It(b,I){for(var G=1,D=0;;){Rr.lastIndex=D;var re=Rr.exec(b);if(re&&re.index<I)++G,D=re.index+re[0].length;else return new Pe(G,I-D)}}var qt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function yt(b){var I={};for(var G in qt)I[G]=b&&Ee(b,G)?b[G]:qt[G];if(I.ecmaVersion>=2015&&(I.ecmaVersion-=2009),I.allowReserved==null&&(I.allowReserved=I.ecmaVersion<5),Z(I.onToken)){var D=I.onToken;I.onToken=function(re){return D.push(re)}}return Z(I.onComment)&&(I.onComment=cr(I,I.onComment)),I}function cr(b,I){return function(G,D,re,Te,it,ht){var Tt={type:G?"Block":"Line",value:D,start:re,end:Te};b.locations&&(Tt.loc=new ft(this,it,ht)),b.ranges&&(Tt.range=[re,Te]),I.push(Tt)}}var Xn=1,Vn=2,Gi=Xn|Vn,ai=4,Rn=8,Ba=16,oa=32,Ti=64,Ca=128;function xi(b,I){return Vn|(b?ai:0)|(I?Rn:0)}var Hi=0,vi=1,mi=2,ss=3,Po=4,ao=5,bt=function(I,G,D){this.options=I=yt(I),this.sourceFile=I.sourceFile,this.keywords=Ze(Jr[I.ecmaVersion>=6?6:I.sourceType==="module"?"5module":5]);var re="";if(I.allowReserved!==!0){for(var Te=I.ecmaVersion;!(re=Ft[Te]);Te--);I.sourceType==="module"&&(re+=" await")}this.reservedWords=Ze(re);var it=(re?re+" ":"")+Ft.strict;this.reservedWordsStrict=Ze(it),this.reservedWordsStrictBind=Ze(it+" "+Ft.strictBind),this.input=String(G),this.containsEsc=!1,D?(this.pos=D,this.lineStart=this.input.lastIndexOf(`
`,D-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(_i).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=me.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=I.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&I.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Xn),this.regexpState=null},pe={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};bt.prototype.parse=function(){var I=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(I)},pe.inFunction.get=function(){return(this.currentVarScope().flags&Vn)>0},pe.inGenerator.get=function(){return(this.currentVarScope().flags&Rn)>0},pe.inAsync.get=function(){return(this.currentVarScope().flags&ai)>0},pe.allowSuper.get=function(){return(this.currentThisScope().flags&Ti)>0},pe.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Ca)>0},pe.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},bt.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&Vn)>0},bt.extend=function(){for(var I=[],G=arguments.length;G--;)I[G]=arguments[G];for(var D=this,re=0;re<I.length;re++)D=I[re](D);return D},bt.parse=function(I,G){return new this(G,I).parse()},bt.parseExpressionAt=function(I,G,D){var re=new this(D,I,G);return re.nextToken(),re.parseExpression()},bt.tokenizer=function(I,G){return new this(G,I)},Object.defineProperties(bt.prototype,pe);var ie=bt.prototype,Ce=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;ie.strictDirective=function(b){for(;;){st.lastIndex=b,b+=st.exec(this.input)[0].length;var I=Ce.exec(this.input.slice(b));if(!I)return!1;if((I[1]||I[2])==="use strict"){st.lastIndex=b+I[0].length;var G=st.exec(this.input),D=G.index+G[0].length,re=this.input.charAt(D);return re===";"||re==="}"||_i.test(G[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(re)||re==="!"&&this.input.charAt(D+1)==="=")}b+=I[0].length,st.lastIndex=b,b+=st.exec(this.input)[0].length,this.input[b]===";"&&b++}},ie.eat=function(b){return this.type===b?(this.next(),!0):!1},ie.isContextual=function(b){return this.type===me.name&&this.value===b&&!this.containsEsc},ie.eatContextual=function(b){return this.isContextual(b)?(this.next(),!0):!1},ie.expectContextual=function(b){this.eatContextual(b)||this.unexpected()},ie.canInsertSemicolon=function(){return this.type===me.eof||this.type===me.braceR||_i.test(this.input.slice(this.lastTokEnd,this.start))},ie.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},ie.semicolon=function(){!this.eat(me.semi)&&!this.insertSemicolon()&&this.unexpected()},ie.afterTrailingComma=function(b,I){if(this.type===b)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),I||this.next(),!0},ie.expect=function(b){this.eat(b)||this.unexpected()},ie.unexpected=function(b){this.raise(b??this.start,"Unexpected token")};function V(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}ie.checkPatternErrors=function(b,I){if(!!b){b.trailingComma>-1&&this.raiseRecoverable(b.trailingComma,"Comma is not permitted after the rest element");var G=I?b.parenthesizedAssign:b.parenthesizedBind;G>-1&&this.raiseRecoverable(G,"Parenthesized pattern")}},ie.checkExpressionErrors=function(b,I){if(!b)return!1;var G=b.shorthandAssign,D=b.doubleProto;if(!I)return G>=0||D>=0;G>=0&&this.raise(G,"Shorthand property assignments are valid only in destructuring patterns"),D>=0&&this.raiseRecoverable(D,"Redefinition of __proto__ property")},ie.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},ie.isSimpleAssignTarget=function(b){return b.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(b.expression):b.type==="Identifier"||b.type==="MemberExpression"};var We=bt.prototype;We.parseTopLevel=function(b){var I={};for(b.body||(b.body=[]);this.type!==me.eof;){var G=this.parseStatement(null,!0,I);b.body.push(G)}if(this.inModule)for(var D=0,re=Object.keys(this.undefinedExports);D<re.length;D+=1){var Te=re[D];this.raiseRecoverable(this.undefinedExports[Te].start,"Export '"+Te+"' is not defined")}return this.adaptDirectivePrologue(b.body),this.next(),b.sourceType=this.options.sourceType,this.finishNode(b,"Program")};var Gt={kind:"loop"},Vr={kind:"switch"};We.isLet=function(b){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;st.lastIndex=this.pos;var I=st.exec(this.input),G=this.pos+I[0].length,D=this.input.charCodeAt(G);if(D===91)return!0;if(b)return!1;if(D===123)return!0;if(ar(D,!0)){for(var re=G+1;ur(this.input.charCodeAt(re),!0);)++re;var Te=this.input.slice(G,re);if(!tt.test(Te))return!0}return!1},We.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;st.lastIndex=this.pos;var b=st.exec(this.input),I=this.pos+b[0].length;return!_i.test(this.input.slice(this.pos,I))&&this.input.slice(I,I+8)==="function"&&(I+8===this.input.length||!ur(this.input.charAt(I+8)))},We.parseStatement=function(b,I,G){var D=this.type,re=this.startNode(),Te;switch(this.isLet(b)&&(D=me._var,Te="let"),D){case me._break:case me._continue:return this.parseBreakContinueStatement(re,D.keyword);case me._debugger:return this.parseDebuggerStatement(re);case me._do:return this.parseDoStatement(re);case me._for:return this.parseForStatement(re);case me._function:return b&&(this.strict||b!=="if"&&b!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(re,!1,!b);case me._class:return b&&this.unexpected(),this.parseClass(re,!0);case me._if:return this.parseIfStatement(re);case me._return:return this.parseReturnStatement(re);case me._switch:return this.parseSwitchStatement(re);case me._throw:return this.parseThrowStatement(re);case me._try:return this.parseTryStatement(re);case me._const:case me._var:return Te=Te||this.value,b&&Te!=="var"&&this.unexpected(),this.parseVarStatement(re,Te);case me._while:return this.parseWhileStatement(re);case me._with:return this.parseWithStatement(re);case me.braceL:return this.parseBlock(!0,re);case me.semi:return this.parseEmptyStatement(re);case me._export:case me._import:if(this.options.ecmaVersion>10&&D===me._import){st.lastIndex=this.pos;var it=st.exec(this.input),ht=this.pos+it[0].length,Tt=this.input.charCodeAt(ht);if(Tt===40||Tt===46)return this.parseExpressionStatement(re,this.parseExpression())}return this.options.allowImportExportEverywhere||(I||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),D===me._import?this.parseImport(re):this.parseExport(re,G);default:if(this.isAsyncFunction())return b&&this.unexpected(),this.next(),this.parseFunctionStatement(re,!0,!b);var _r=this.value,br=this.parseExpression();return D===me.name&&br.type==="Identifier"&&this.eat(me.colon)?this.parseLabeledStatement(re,_r,br,b):this.parseExpressionStatement(re,br)}},We.parseBreakContinueStatement=function(b,I){var G=I==="break";this.next(),this.eat(me.semi)||this.insertSemicolon()?b.label=null:this.type!==me.name?this.unexpected():(b.label=this.parseIdent(),this.semicolon());for(var D=0;D<this.labels.length;++D){var re=this.labels[D];if((b.label==null||re.name===b.label.name)&&(re.kind!=null&&(G||re.kind==="loop")||b.label&&G))break}return D===this.labels.length&&this.raise(b.start,"Unsyntactic "+I),this.finishNode(b,G?"BreakStatement":"ContinueStatement")},We.parseDebuggerStatement=function(b){return this.next(),this.semicolon(),this.finishNode(b,"DebuggerStatement")},We.parseDoStatement=function(b){return this.next(),this.labels.push(Gt),b.body=this.parseStatement("do"),this.labels.pop(),this.expect(me._while),b.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(me.semi):this.semicolon(),this.finishNode(b,"DoWhileStatement")},We.parseForStatement=function(b){this.next();var I=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Gt),this.enterScope(0),this.expect(me.parenL),this.type===me.semi)return I>-1&&this.unexpected(I),this.parseFor(b,null);var G=this.isLet();if(this.type===me._var||this.type===me._const||G){var D=this.startNode(),re=G?"let":this.value;return this.next(),this.parseVar(D,!0,re),this.finishNode(D,"VariableDeclaration"),(this.type===me._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&D.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===me._in?I>-1&&this.unexpected(I):b.await=I>-1),this.parseForIn(b,D)):(I>-1&&this.unexpected(I),this.parseFor(b,D))}var Te=new V,it=this.parseExpression(!0,Te);return this.type===me._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===me._in?I>-1&&this.unexpected(I):b.await=I>-1),this.toAssignable(it,!1,Te),this.checkLVal(it),this.parseForIn(b,it)):(this.checkExpressionErrors(Te,!0),I>-1&&this.unexpected(I),this.parseFor(b,it))},We.parseFunctionStatement=function(b,I,G){return this.next(),this.parseFunction(b,Yn|(G?0:Fi),!1,I)},We.parseIfStatement=function(b){return this.next(),b.test=this.parseParenExpression(),b.consequent=this.parseStatement("if"),b.alternate=this.eat(me._else)?this.parseStatement("if"):null,this.finishNode(b,"IfStatement")},We.parseReturnStatement=function(b){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(me.semi)||this.insertSemicolon()?b.argument=null:(b.argument=this.parseExpression(),this.semicolon()),this.finishNode(b,"ReturnStatement")},We.parseSwitchStatement=function(b){this.next(),b.discriminant=this.parseParenExpression(),b.cases=[],this.expect(me.braceL),this.labels.push(Vr),this.enterScope(0);for(var I,G=!1;this.type!==me.braceR;)if(this.type===me._case||this.type===me._default){var D=this.type===me._case;I&&this.finishNode(I,"SwitchCase"),b.cases.push(I=this.startNode()),I.consequent=[],this.next(),D?I.test=this.parseExpression():(G&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),G=!0,I.test=null),this.expect(me.colon)}else I||this.unexpected(),I.consequent.push(this.parseStatement(null));return this.exitScope(),I&&this.finishNode(I,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(b,"SwitchStatement")},We.parseThrowStatement=function(b){return this.next(),_i.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),b.argument=this.parseExpression(),this.semicolon(),this.finishNode(b,"ThrowStatement")};var Mr=[];We.parseTryStatement=function(b){if(this.next(),b.block=this.parseBlock(),b.handler=null,this.type===me._catch){var I=this.startNode();if(this.next(),this.eat(me.parenL)){I.param=this.parseBindingAtom();var G=I.param.type==="Identifier";this.enterScope(G?oa:0),this.checkLVal(I.param,G?Po:mi),this.expect(me.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),I.param=null,this.enterScope(0);I.body=this.parseBlock(!1),this.exitScope(),b.handler=this.finishNode(I,"CatchClause")}return b.finalizer=this.eat(me._finally)?this.parseBlock():null,!b.handler&&!b.finalizer&&this.raise(b.start,"Missing catch or finally clause"),this.finishNode(b,"TryStatement")},We.parseVarStatement=function(b,I){return this.next(),this.parseVar(b,!1,I),this.semicolon(),this.finishNode(b,"VariableDeclaration")},We.parseWhileStatement=function(b){return this.next(),b.test=this.parseParenExpression(),this.labels.push(Gt),b.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(b,"WhileStatement")},We.parseWithStatement=function(b){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),b.object=this.parseParenExpression(),b.body=this.parseStatement("with"),this.finishNode(b,"WithStatement")},We.parseEmptyStatement=function(b){return this.next(),this.finishNode(b,"EmptyStatement")},We.parseLabeledStatement=function(b,I,G,D){for(var re=0,Te=this.labels;re<Te.length;re+=1){var it=Te[re];it.name===I&&this.raise(G.start,"Label '"+I+"' is already declared")}for(var ht=this.type.isLoop?"loop":this.type===me._switch?"switch":null,Tt=this.labels.length-1;Tt>=0;Tt--){var _r=this.labels[Tt];if(_r.statementStart===b.start)_r.statementStart=this.start,_r.kind=ht;else break}return this.labels.push({name:I,kind:ht,statementStart:this.start}),b.body=this.parseStatement(D?D.indexOf("label")===-1?D+"label":D:"label"),this.labels.pop(),b.label=G,this.finishNode(b,"LabeledStatement")},We.parseExpressionStatement=function(b,I){return b.expression=I,this.semicolon(),this.finishNode(b,"ExpressionStatement")},We.parseBlock=function(b,I,G){for(b===void 0&&(b=!0),I===void 0&&(I=this.startNode()),I.body=[],this.expect(me.braceL),b&&this.enterScope(0);this.type!==me.braceR;){var D=this.parseStatement(null);I.body.push(D)}return G&&(this.strict=!1),this.next(),b&&this.exitScope(),this.finishNode(I,"BlockStatement")},We.parseFor=function(b,I){return b.init=I,this.expect(me.semi),b.test=this.type===me.semi?null:this.parseExpression(),this.expect(me.semi),b.update=this.type===me.parenR?null:this.parseExpression(),this.expect(me.parenR),b.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(b,"ForStatement")},We.parseForIn=function(b,I){var G=this.type===me._in;return this.next(),I.type==="VariableDeclaration"&&I.declarations[0].init!=null&&(!G||this.options.ecmaVersion<8||this.strict||I.kind!=="var"||I.declarations[0].id.type!=="Identifier")?this.raise(I.start,(G?"for-in":"for-of")+" loop variable declaration may not have an initializer"):I.type==="AssignmentPattern"&&this.raise(I.start,"Invalid left-hand side in for-loop"),b.left=I,b.right=G?this.parseExpression():this.parseMaybeAssign(),this.expect(me.parenR),b.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(b,G?"ForInStatement":"ForOfStatement")},We.parseVar=function(b,I,G){for(b.declarations=[],b.kind=G;;){var D=this.startNode();if(this.parseVarId(D,G),this.eat(me.eq)?D.init=this.parseMaybeAssign(I):G==="const"&&!(this.type===me._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():D.id.type!=="Identifier"&&!(I&&(this.type===me._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):D.init=null,b.declarations.push(this.finishNode(D,"VariableDeclarator")),!this.eat(me.comma))break}return b},We.parseVarId=function(b,I){b.id=this.parseBindingAtom(),this.checkLVal(b.id,I==="var"?vi:mi,!1)};var Yn=1,Fi=2,Qn=4;We.parseFunction=function(b,I,G,D){this.initFunction(b),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!D)&&(this.type===me.star&&I&Fi&&this.unexpected(),b.generator=this.eat(me.star)),this.options.ecmaVersion>=8&&(b.async=!!D),I&Yn&&(b.id=I&Qn&&this.type!==me.name?null:this.parseIdent(),b.id&&!(I&Fi)&&this.checkLVal(b.id,this.strict||b.generator||b.async?this.treatFunctionsAsVar?vi:mi:ss));var re=this.yieldPos,Te=this.awaitPos,it=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(xi(b.async,b.generator)),I&Yn||(b.id=this.type===me.name?this.parseIdent():null),this.parseFunctionParams(b),this.parseFunctionBody(b,G,!1),this.yieldPos=re,this.awaitPos=Te,this.awaitIdentPos=it,this.finishNode(b,I&Yn?"FunctionDeclaration":"FunctionExpression")},We.parseFunctionParams=function(b){this.expect(me.parenL),b.params=this.parseBindingList(me.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},We.parseClass=function(b,I){this.next();var G=this.strict;this.strict=!0,this.parseClassId(b,I),this.parseClassSuper(b);var D=this.startNode(),re=!1;for(D.body=[],this.expect(me.braceL);this.type!==me.braceR;){var Te=this.parseClassElement(b.superClass!==null);Te&&(D.body.push(Te),Te.type==="MethodDefinition"&&Te.kind==="constructor"&&(re&&this.raise(Te.start,"Duplicate constructor in the same class"),re=!0))}return this.strict=G,this.next(),b.body=this.finishNode(D,"ClassBody"),this.finishNode(b,I?"ClassDeclaration":"ClassExpression")},We.parseClassElement=function(b){var I=this;if(this.eat(me.semi))return null;var G=this.startNode(),D=function(Tt,_r){_r===void 0&&(_r=!1);var br=I.start,si=I.startLoc;return I.eatContextual(Tt)?I.type!==me.parenL&&(!_r||!I.canInsertSemicolon())?!0:(G.key&&I.unexpected(),G.computed=!1,G.key=I.startNodeAt(br,si),G.key.name=Tt,I.finishNode(G.key,"Identifier"),!1):!1};G.kind="method",G.static=D("static");var re=this.eat(me.star),Te=!1;re||(this.options.ecmaVersion>=8&&D("async",!0)?(Te=!0,re=this.options.ecmaVersion>=9&&this.eat(me.star)):D("get")?G.kind="get":D("set")&&(G.kind="set")),G.key||this.parsePropertyName(G);var it=G.key,ht=!1;return!G.computed&&!G.static&&(it.type==="Identifier"&&it.name==="constructor"||it.type==="Literal"&&it.value==="constructor")?(G.kind!=="method"&&this.raise(it.start,"Constructor can't have get/set modifier"),re&&this.raise(it.start,"Constructor can't be a generator"),Te&&this.raise(it.start,"Constructor can't be an async method"),G.kind="constructor",ht=b):G.static&&it.type==="Identifier"&&it.name==="prototype"&&this.raise(it.start,"Classes may not have a static property named prototype"),this.parseClassMethod(G,re,Te,ht),G.kind==="get"&&G.value.params.length!==0&&this.raiseRecoverable(G.value.start,"getter should have no params"),G.kind==="set"&&G.value.params.length!==1&&this.raiseRecoverable(G.value.start,"setter should have exactly one param"),G.kind==="set"&&G.value.params[0].type==="RestElement"&&this.raiseRecoverable(G.value.params[0].start,"Setter cannot use rest params"),G},We.parseClassMethod=function(b,I,G,D){return b.value=this.parseMethod(I,G,D),this.finishNode(b,"MethodDefinition")},We.parseClassId=function(b,I){this.type===me.name?(b.id=this.parseIdent(),I&&this.checkLVal(b.id,mi,!1)):(I===!0&&this.unexpected(),b.id=null)},We.parseClassSuper=function(b){b.superClass=this.eat(me._extends)?this.parseExprSubscripts():null},We.parseExport=function(b,I){if(this.next(),this.eat(me.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(b.exported=this.parseIdent(!0),this.checkExport(I,b.exported.name,this.lastTokStart)):b.exported=null),this.expectContextual("from"),this.type!==me.string&&this.unexpected(),b.source=this.parseExprAtom(),this.semicolon(),this.finishNode(b,"ExportAllDeclaration");if(this.eat(me._default)){this.checkExport(I,"default",this.lastTokStart);var G;if(this.type===me._function||(G=this.isAsyncFunction())){var D=this.startNode();this.next(),G&&this.next(),b.declaration=this.parseFunction(D,Yn|Qn,!1,G)}else if(this.type===me._class){var re=this.startNode();b.declaration=this.parseClass(re,"nullableID")}else b.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(b,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())b.declaration=this.parseStatement(null),b.declaration.type==="VariableDeclaration"?this.checkVariableExport(I,b.declaration.declarations):this.checkExport(I,b.declaration.id.name,b.declaration.id.start),b.specifiers=[],b.source=null;else{if(b.declaration=null,b.specifiers=this.parseExportSpecifiers(I),this.eatContextual("from"))this.type!==me.string&&this.unexpected(),b.source=this.parseExprAtom();else{for(var Te=0,it=b.specifiers;Te<it.length;Te+=1){var ht=it[Te];this.checkUnreserved(ht.local),this.checkLocalExport(ht.local)}b.source=null}this.semicolon()}return this.finishNode(b,"ExportNamedDeclaration")},We.checkExport=function(b,I,G){!b||(Ee(b,I)&&this.raiseRecoverable(G,"Duplicate export '"+I+"'"),b[I]=!0)},We.checkPatternExport=function(b,I){var G=I.type;if(G==="Identifier")this.checkExport(b,I.name,I.start);else if(G==="ObjectPattern")for(var D=0,re=I.properties;D<re.length;D+=1){var Te=re[D];this.checkPatternExport(b,Te)}else if(G==="ArrayPattern")for(var it=0,ht=I.elements;it<ht.length;it+=1){var Tt=ht[it];Tt&&this.checkPatternExport(b,Tt)}else G==="Property"?this.checkPatternExport(b,I.value):G==="AssignmentPattern"?this.checkPatternExport(b,I.left):G==="RestElement"?this.checkPatternExport(b,I.argument):G==="ParenthesizedExpression"&&this.checkPatternExport(b,I.expression)},We.checkVariableExport=function(b,I){if(!!b)for(var G=0,D=I;G<D.length;G+=1){var re=D[G];this.checkPatternExport(b,re.id)}},We.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},We.parseExportSpecifiers=function(b){var I=[],G=!0;for(this.expect(me.braceL);!this.eat(me.braceR);){if(G)G=!1;else if(this.expect(me.comma),this.afterTrailingComma(me.braceR))break;var D=this.startNode();D.local=this.parseIdent(!0),D.exported=this.eatContextual("as")?this.parseIdent(!0):D.local,this.checkExport(b,D.exported.name,D.exported.start),I.push(this.finishNode(D,"ExportSpecifier"))}return I},We.parseImport=function(b){return this.next(),this.type===me.string?(b.specifiers=Mr,b.source=this.parseExprAtom()):(b.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),b.source=this.type===me.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(b,"ImportDeclaration")},We.parseImportSpecifiers=function(){var b=[],I=!0;if(this.type===me.name){var G=this.startNode();if(G.local=this.parseIdent(),this.checkLVal(G.local,mi),b.push(this.finishNode(G,"ImportDefaultSpecifier")),!this.eat(me.comma))return b}if(this.type===me.star){var D=this.startNode();return this.next(),this.expectContextual("as"),D.local=this.parseIdent(),this.checkLVal(D.local,mi),b.push(this.finishNode(D,"ImportNamespaceSpecifier")),b}for(this.expect(me.braceL);!this.eat(me.braceR);){if(I)I=!1;else if(this.expect(me.comma),this.afterTrailingComma(me.braceR))break;var re=this.startNode();re.imported=this.parseIdent(!0),this.eatContextual("as")?re.local=this.parseIdent():(this.checkUnreserved(re.imported),re.local=re.imported),this.checkLVal(re.local,mi),b.push(this.finishNode(re,"ImportSpecifier"))}return b},We.adaptDirectivePrologue=function(b){for(var I=0;I<b.length&&this.isDirectiveCandidate(b[I]);++I)b[I].directive=b[I].expression.raw.slice(1,-1)},We.isDirectiveCandidate=function(b){return b.type==="ExpressionStatement"&&b.expression.type==="Literal"&&typeof b.expression.value=="string"&&(this.input[b.start]==='"'||this.input[b.start]==="'")};var Bn=bt.prototype;Bn.toAssignable=function(b,I,G){if(this.options.ecmaVersion>=6&&b)switch(b.type){case"Identifier":this.inAsync&&b.name==="await"&&this.raise(b.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":b.type="ObjectPattern",G&&this.checkPatternErrors(G,!0);for(var D=0,re=b.properties;D<re.length;D+=1){var Te=re[D];this.toAssignable(Te,I),Te.type==="RestElement"&&(Te.argument.type==="ArrayPattern"||Te.argument.type==="ObjectPattern")&&this.raise(Te.argument.start,"Unexpected token")}break;case"Property":b.kind!=="init"&&this.raise(b.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(b.value,I);break;case"ArrayExpression":b.type="ArrayPattern",G&&this.checkPatternErrors(G,!0),this.toAssignableList(b.elements,I);break;case"SpreadElement":b.type="RestElement",this.toAssignable(b.argument,I),b.argument.type==="AssignmentPattern"&&this.raise(b.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":b.operator!=="="&&this.raise(b.left.end,"Only '=' operator can be used for specifying default value."),b.type="AssignmentPattern",delete b.operator,this.toAssignable(b.left,I);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(b.expression,I,G);break;case"ChainExpression":this.raiseRecoverable(b.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!I)break;default:this.raise(b.start,"Assigning to rvalue")}else G&&this.checkPatternErrors(G,!0);return b},Bn.toAssignableList=function(b,I){for(var G=b.length,D=0;D<G;D++){var re=b[D];re&&this.toAssignable(re,I)}if(G){var Te=b[G-1];this.options.ecmaVersion===6&&I&&Te&&Te.type==="RestElement"&&Te.argument.type!=="Identifier"&&this.unexpected(Te.argument.start)}return b},Bn.parseSpread=function(b){var I=this.startNode();return this.next(),I.argument=this.parseMaybeAssign(!1,b),this.finishNode(I,"SpreadElement")},Bn.parseRestBinding=function(){var b=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==me.name&&this.unexpected(),b.argument=this.parseBindingAtom(),this.finishNode(b,"RestElement")},Bn.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case me.bracketL:var b=this.startNode();return this.next(),b.elements=this.parseBindingList(me.bracketR,!0,!0),this.finishNode(b,"ArrayPattern");case me.braceL:return this.parseObj(!0)}return this.parseIdent()},Bn.parseBindingList=function(b,I,G){for(var D=[],re=!0;!this.eat(b);)if(re?re=!1:this.expect(me.comma),I&&this.type===me.comma)D.push(null);else{if(G&&this.afterTrailingComma(b))break;if(this.type===me.ellipsis){var Te=this.parseRestBinding();this.parseBindingListItem(Te),D.push(Te),this.type===me.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(b);break}else{var it=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(it),D.push(it)}}return D},Bn.parseBindingListItem=function(b){return b},Bn.parseMaybeDefault=function(b,I,G){if(G=G||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(me.eq))return G;var D=this.startNodeAt(b,I);return D.left=G,D.right=this.parseMaybeAssign(),this.finishNode(D,"AssignmentPattern")},Bn.checkLVal=function(b,I,G){switch(I===void 0&&(I=Hi),b.type){case"Identifier":I===mi&&b.name==="let"&&this.raiseRecoverable(b.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(b.name)&&this.raiseRecoverable(b.start,(I?"Binding ":"Assigning to ")+b.name+" in strict mode"),G&&(Ee(G,b.name)&&this.raiseRecoverable(b.start,"Argument name clash"),G[b.name]=!0),I!==Hi&&I!==ao&&this.declareName(b.name,I,b.start);break;case"ChainExpression":this.raiseRecoverable(b.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":I&&this.raiseRecoverable(b.start,"Binding member expression");break;case"ObjectPattern":for(var D=0,re=b.properties;D<re.length;D+=1){var Te=re[D];this.checkLVal(Te,I,G)}break;case"Property":this.checkLVal(b.value,I,G);break;case"ArrayPattern":for(var it=0,ht=b.elements;it<ht.length;it+=1){var Tt=ht[it];Tt&&this.checkLVal(Tt,I,G)}break;case"AssignmentPattern":this.checkLVal(b.left,I,G);break;case"RestElement":this.checkLVal(b.argument,I,G);break;case"ParenthesizedExpression":this.checkLVal(b.expression,I,G);break;default:this.raise(b.start,(I?"Binding":"Assigning to")+" rvalue")}};var Fn=bt.prototype;Fn.checkPropClash=function(b,I,G){if(!(this.options.ecmaVersion>=9&&b.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(b.computed||b.method||b.shorthand))){var D=b.key,re;switch(D.type){case"Identifier":re=D.name;break;case"Literal":re=String(D.value);break;default:return}var Te=b.kind;if(this.options.ecmaVersion>=6){re==="__proto__"&&Te==="init"&&(I.proto&&(G?G.doubleProto<0&&(G.doubleProto=D.start):this.raiseRecoverable(D.start,"Redefinition of __proto__ property")),I.proto=!0);return}re="$"+re;var it=I[re];if(it){var ht;Te==="init"?ht=this.strict&&it.init||it.get||it.set:ht=it.init||it[Te],ht&&this.raiseRecoverable(D.start,"Redefinition of property")}else it=I[re]={init:!1,get:!1,set:!1};it[Te]=!0}},Fn.parseExpression=function(b,I){var G=this.start,D=this.startLoc,re=this.parseMaybeAssign(b,I);if(this.type===me.comma){var Te=this.startNodeAt(G,D);for(Te.expressions=[re];this.eat(me.comma);)Te.expressions.push(this.parseMaybeAssign(b,I));return this.finishNode(Te,"SequenceExpression")}return re},Fn.parseMaybeAssign=function(b,I,G){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(b);this.exprAllowed=!1}var D=!1,re=-1,Te=-1;I?(re=I.parenthesizedAssign,Te=I.trailingComma,I.parenthesizedAssign=I.trailingComma=-1):(I=new V,D=!0);var it=this.start,ht=this.startLoc;(this.type===me.parenL||this.type===me.name)&&(this.potentialArrowAt=this.start);var Tt=this.parseMaybeConditional(b,I);if(G&&(Tt=G.call(this,Tt,it,ht)),this.type.isAssign){var _r=this.startNodeAt(it,ht);return _r.operator=this.value,_r.left=this.type===me.eq?this.toAssignable(Tt,!1,I):Tt,D||(I.parenthesizedAssign=I.trailingComma=I.doubleProto=-1),I.shorthandAssign>=_r.left.start&&(I.shorthandAssign=-1),this.checkLVal(Tt),this.next(),_r.right=this.parseMaybeAssign(b),this.finishNode(_r,"AssignmentExpression")}else D&&this.checkExpressionErrors(I,!0);return re>-1&&(I.parenthesizedAssign=re),Te>-1&&(I.trailingComma=Te),Tt},Fn.parseMaybeConditional=function(b,I){var G=this.start,D=this.startLoc,re=this.parseExprOps(b,I);if(this.checkExpressionErrors(I))return re;if(this.eat(me.question)){var Te=this.startNodeAt(G,D);return Te.test=re,Te.consequent=this.parseMaybeAssign(),this.expect(me.colon),Te.alternate=this.parseMaybeAssign(b),this.finishNode(Te,"ConditionalExpression")}return re},Fn.parseExprOps=function(b,I){var G=this.start,D=this.startLoc,re=this.parseMaybeUnary(I,!1);return this.checkExpressionErrors(I)||re.start===G&&re.type==="ArrowFunctionExpression"?re:this.parseExprOp(re,G,D,-1,b)},Fn.parseExprOp=function(b,I,G,D,re){var Te=this.type.binop;if(Te!=null&&(!re||this.type!==me._in)&&Te>D){var it=this.type===me.logicalOR||this.type===me.logicalAND,ht=this.type===me.coalesce;ht&&(Te=me.logicalAND.binop);var Tt=this.value;this.next();var _r=this.start,br=this.startLoc,si=this.parseExprOp(this.parseMaybeUnary(null,!1),_r,br,Te,re),Ni=this.buildBinary(I,G,b,si,Tt,it||ht);return(it&&this.type===me.coalesce||ht&&(this.type===me.logicalOR||this.type===me.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Ni,I,G,D,re)}return b},Fn.buildBinary=function(b,I,G,D,re,Te){var it=this.startNodeAt(b,I);return it.left=G,it.operator=re,it.right=D,this.finishNode(it,Te?"LogicalExpression":"BinaryExpression")},Fn.parseMaybeUnary=function(b,I){var G=this.start,D=this.startLoc,re;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))re=this.parseAwait(),I=!0;else if(this.type.prefix){var Te=this.startNode(),it=this.type===me.incDec;Te.operator=this.value,Te.prefix=!0,this.next(),Te.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(b,!0),it?this.checkLVal(Te.argument):this.strict&&Te.operator==="delete"&&Te.argument.type==="Identifier"?this.raiseRecoverable(Te.start,"Deleting local variable in strict mode"):I=!0,re=this.finishNode(Te,it?"UpdateExpression":"UnaryExpression")}else{if(re=this.parseExprSubscripts(b),this.checkExpressionErrors(b))return re;for(;this.type.postfix&&!this.canInsertSemicolon();){var ht=this.startNodeAt(G,D);ht.operator=this.value,ht.prefix=!1,ht.argument=re,this.checkLVal(re),this.next(),re=this.finishNode(ht,"UpdateExpression")}}return!I&&this.eat(me.starstar)?this.buildBinary(G,D,re,this.parseMaybeUnary(null,!1),"**",!1):re},Fn.parseExprSubscripts=function(b){var I=this.start,G=this.startLoc,D=this.parseExprAtom(b);if(D.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return D;var re=this.parseSubscripts(D,I,G);return b&&re.type==="MemberExpression"&&(b.parenthesizedAssign>=re.start&&(b.parenthesizedAssign=-1),b.parenthesizedBind>=re.start&&(b.parenthesizedBind=-1)),re},Fn.parseSubscripts=function(b,I,G,D){for(var re=this.options.ecmaVersion>=8&&b.type==="Identifier"&&b.name==="async"&&this.lastTokEnd===b.end&&!this.canInsertSemicolon()&&b.end-b.start===5&&this.potentialArrowAt===b.start,Te=!1;;){var it=this.parseSubscript(b,I,G,D,re,Te);if(it.optional&&(Te=!0),it===b||it.type==="ArrowFunctionExpression"){if(Te){var ht=this.startNodeAt(I,G);ht.expression=it,it=this.finishNode(ht,"ChainExpression")}return it}b=it}},Fn.parseSubscript=function(b,I,G,D,re,Te){var it=this.options.ecmaVersion>=11,ht=it&&this.eat(me.questionDot);D&&ht&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Tt=this.eat(me.bracketL);if(Tt||ht&&this.type!==me.parenL&&this.type!==me.backQuote||this.eat(me.dot)){var _r=this.startNodeAt(I,G);_r.object=b,_r.property=Tt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),_r.computed=!!Tt,Tt&&this.expect(me.bracketR),it&&(_r.optional=ht),b=this.finishNode(_r,"MemberExpression")}else if(!D&&this.eat(me.parenL)){var br=new V,si=this.yieldPos,Ni=this.awaitPos,Di=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var ia=this.parseExprList(me.parenR,this.options.ecmaVersion>=8,!1,br);if(re&&!ht&&!this.canInsertSemicolon()&&this.eat(me.arrow))return this.checkPatternErrors(br,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=si,this.awaitPos=Ni,this.awaitIdentPos=Di,this.parseArrowExpression(this.startNodeAt(I,G),ia,!0);this.checkExpressionErrors(br,!0),this.yieldPos=si||this.yieldPos,this.awaitPos=Ni||this.awaitPos,this.awaitIdentPos=Di||this.awaitIdentPos;var Ga=this.startNodeAt(I,G);Ga.callee=b,Ga.arguments=ia,it&&(Ga.optional=ht),b=this.finishNode(Ga,"CallExpression")}else if(this.type===me.backQuote){(ht||Te)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var uo=this.startNodeAt(I,G);uo.tag=b,uo.quasi=this.parseTemplate({isTagged:!0}),b=this.finishNode(uo,"TaggedTemplateExpression")}return b},Fn.parseExprAtom=function(b){this.type===me.slash&&this.readRegexp();var I,G=this.potentialArrowAt===this.start;switch(this.type){case me._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),I=this.startNode(),this.next(),this.type===me.parenL&&!this.allowDirectSuper&&this.raise(I.start,"super() call outside constructor of a subclass"),this.type!==me.dot&&this.type!==me.bracketL&&this.type!==me.parenL&&this.unexpected(),this.finishNode(I,"Super");case me._this:return I=this.startNode(),this.next(),this.finishNode(I,"ThisExpression");case me.name:var D=this.start,re=this.startLoc,Te=this.containsEsc,it=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Te&&it.name==="async"&&!this.canInsertSemicolon()&&this.eat(me._function))return this.parseFunction(this.startNodeAt(D,re),0,!1,!0);if(G&&!this.canInsertSemicolon()){if(this.eat(me.arrow))return this.parseArrowExpression(this.startNodeAt(D,re),[it],!1);if(this.options.ecmaVersion>=8&&it.name==="async"&&this.type===me.name&&!Te)return it=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(me.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(D,re),[it],!0)}return it;case me.regexp:var ht=this.value;return I=this.parseLiteral(ht.value),I.regex={pattern:ht.pattern,flags:ht.flags},I;case me.num:case me.string:return this.parseLiteral(this.value);case me._null:case me._true:case me._false:return I=this.startNode(),I.value=this.type===me._null?null:this.type===me._true,I.raw=this.type.keyword,this.next(),this.finishNode(I,"Literal");case me.parenL:var Tt=this.start,_r=this.parseParenAndDistinguishExpression(G);return b&&(b.parenthesizedAssign<0&&!this.isSimpleAssignTarget(_r)&&(b.parenthesizedAssign=Tt),b.parenthesizedBind<0&&(b.parenthesizedBind=Tt)),_r;case me.bracketL:return I=this.startNode(),this.next(),I.elements=this.parseExprList(me.bracketR,!0,!0,b),this.finishNode(I,"ArrayExpression");case me.braceL:return this.parseObj(!1,b);case me._function:return I=this.startNode(),this.next(),this.parseFunction(I,0);case me._class:return this.parseClass(this.startNode(),!1);case me._new:return this.parseNew();case me.backQuote:return this.parseTemplate();case me._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Fn.parseExprImport=function(){var b=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var I=this.parseIdent(!0);switch(this.type){case me.parenL:return this.parseDynamicImport(b);case me.dot:return b.meta=I,this.parseImportMeta(b);default:this.unexpected()}},Fn.parseDynamicImport=function(b){if(this.next(),b.source=this.parseMaybeAssign(),!this.eat(me.parenR)){var I=this.start;this.eat(me.comma)&&this.eat(me.parenR)?this.raiseRecoverable(I,"Trailing comma is not allowed in import()"):this.unexpected(I)}return this.finishNode(b,"ImportExpression")},Fn.parseImportMeta=function(b){this.next();var I=this.containsEsc;return b.property=this.parseIdent(!0),b.property.name!=="meta"&&this.raiseRecoverable(b.property.start,"The only valid meta property for import is 'import.meta'"),I&&this.raiseRecoverable(b.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(b.start,"Cannot use 'import.meta' outside a module"),this.finishNode(b,"MetaProperty")},Fn.parseLiteral=function(b){var I=this.startNode();return I.value=b,I.raw=this.input.slice(this.start,this.end),I.raw.charCodeAt(I.raw.length-1)===110&&(I.bigint=I.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(I,"Literal")},Fn.parseParenExpression=function(){this.expect(me.parenL);var b=this.parseExpression();return this.expect(me.parenR),b},Fn.parseParenAndDistinguishExpression=function(b){var I=this.start,G=this.startLoc,D,re=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var Te=this.start,it=this.startLoc,ht=[],Tt=!0,_r=!1,br=new V,si=this.yieldPos,Ni=this.awaitPos,Di;for(this.yieldPos=0,this.awaitPos=0;this.type!==me.parenR;)if(Tt?Tt=!1:this.expect(me.comma),re&&this.afterTrailingComma(me.parenR,!0)){_r=!0;break}else if(this.type===me.ellipsis){Di=this.start,ht.push(this.parseParenItem(this.parseRestBinding())),this.type===me.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else ht.push(this.parseMaybeAssign(!1,br,this.parseParenItem));var ia=this.start,Ga=this.startLoc;if(this.expect(me.parenR),b&&!this.canInsertSemicolon()&&this.eat(me.arrow))return this.checkPatternErrors(br,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=si,this.awaitPos=Ni,this.parseParenArrowList(I,G,ht);(!ht.length||_r)&&this.unexpected(this.lastTokStart),Di&&this.unexpected(Di),this.checkExpressionErrors(br,!0),this.yieldPos=si||this.yieldPos,this.awaitPos=Ni||this.awaitPos,ht.length>1?(D=this.startNodeAt(Te,it),D.expressions=ht,this.finishNodeAt(D,"SequenceExpression",ia,Ga)):D=ht[0]}else D=this.parseParenExpression();if(this.options.preserveParens){var uo=this.startNodeAt(I,G);return uo.expression=D,this.finishNode(uo,"ParenthesizedExpression")}else return D},Fn.parseParenItem=function(b){return b},Fn.parseParenArrowList=function(b,I,G){return this.parseArrowExpression(this.startNodeAt(b,I),G)};var eo=[];Fn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var b=this.startNode(),I=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(me.dot)){b.meta=I;var G=this.containsEsc;return b.property=this.parseIdent(!0),b.property.name!=="target"&&this.raiseRecoverable(b.property.start,"The only valid meta property for new is 'new.target'"),G&&this.raiseRecoverable(b.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(b.start,"'new.target' can only be used in functions"),this.finishNode(b,"MetaProperty")}var D=this.start,re=this.startLoc,Te=this.type===me._import;return b.callee=this.parseSubscripts(this.parseExprAtom(),D,re,!0),Te&&b.callee.type==="ImportExpression"&&this.raise(D,"Cannot use new with import()"),this.eat(me.parenL)?b.arguments=this.parseExprList(me.parenR,this.options.ecmaVersion>=8,!1):b.arguments=eo,this.finishNode(b,"NewExpression")},Fn.parseTemplateElement=function(b){var I=b.isTagged,G=this.startNode();return this.type===me.invalidTemplate?(I||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),G.value={raw:this.value,cooked:null}):G.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),G.tail=this.type===me.backQuote,this.finishNode(G,"TemplateElement")},Fn.parseTemplate=function(b){b===void 0&&(b={});var I=b.isTagged;I===void 0&&(I=!1);var G=this.startNode();this.next(),G.expressions=[];var D=this.parseTemplateElement({isTagged:I});for(G.quasis=[D];!D.tail;)this.type===me.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(me.dollarBraceL),G.expressions.push(this.parseExpression()),this.expect(me.braceR),G.quasis.push(D=this.parseTemplateElement({isTagged:I}));return this.next(),this.finishNode(G,"TemplateLiteral")},Fn.isAsyncProp=function(b){return!b.computed&&b.key.type==="Identifier"&&b.key.name==="async"&&(this.type===me.name||this.type===me.num||this.type===me.string||this.type===me.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===me.star)&&!_i.test(this.input.slice(this.lastTokEnd,this.start))},Fn.parseObj=function(b,I){var G=this.startNode(),D=!0,re={};for(G.properties=[],this.next();!this.eat(me.braceR);){if(D)D=!1;else if(this.expect(me.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(me.braceR))break;var Te=this.parseProperty(b,I);b||this.checkPropClash(Te,re,I),G.properties.push(Te)}return this.finishNode(G,b?"ObjectPattern":"ObjectExpression")},Fn.parseProperty=function(b,I){var G=this.startNode(),D,re,Te,it;if(this.options.ecmaVersion>=9&&this.eat(me.ellipsis))return b?(G.argument=this.parseIdent(!1),this.type===me.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(G,"RestElement")):(this.type===me.parenL&&I&&(I.parenthesizedAssign<0&&(I.parenthesizedAssign=this.start),I.parenthesizedBind<0&&(I.parenthesizedBind=this.start)),G.argument=this.parseMaybeAssign(!1,I),this.type===me.comma&&I&&I.trailingComma<0&&(I.trailingComma=this.start),this.finishNode(G,"SpreadElement"));this.options.ecmaVersion>=6&&(G.method=!1,G.shorthand=!1,(b||I)&&(Te=this.start,it=this.startLoc),b||(D=this.eat(me.star)));var ht=this.containsEsc;return this.parsePropertyName(G),!b&&!ht&&this.options.ecmaVersion>=8&&!D&&this.isAsyncProp(G)?(re=!0,D=this.options.ecmaVersion>=9&&this.eat(me.star),this.parsePropertyName(G,I)):re=!1,this.parsePropertyValue(G,b,D,re,Te,it,I,ht),this.finishNode(G,"Property")},Fn.parsePropertyValue=function(b,I,G,D,re,Te,it,ht){if((G||D)&&this.type===me.colon&&this.unexpected(),this.eat(me.colon))b.value=I?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,it),b.kind="init";else if(this.options.ecmaVersion>=6&&this.type===me.parenL)I&&this.unexpected(),b.kind="init",b.method=!0,b.value=this.parseMethod(G,D);else if(!I&&!ht&&this.options.ecmaVersion>=5&&!b.computed&&b.key.type==="Identifier"&&(b.key.name==="get"||b.key.name==="set")&&this.type!==me.comma&&this.type!==me.braceR&&this.type!==me.eq){(G||D)&&this.unexpected(),b.kind=b.key.name,this.parsePropertyName(b),b.value=this.parseMethod(!1);var Tt=b.kind==="get"?0:1;if(b.value.params.length!==Tt){var _r=b.value.start;b.kind==="get"?this.raiseRecoverable(_r,"getter should have no params"):this.raiseRecoverable(_r,"setter should have exactly one param")}else b.kind==="set"&&b.value.params[0].type==="RestElement"&&this.raiseRecoverable(b.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!b.computed&&b.key.type==="Identifier"?((G||D)&&this.unexpected(),this.checkUnreserved(b.key),b.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=re),b.kind="init",I?b.value=this.parseMaybeDefault(re,Te,b.key):this.type===me.eq&&it?(it.shorthandAssign<0&&(it.shorthandAssign=this.start),b.value=this.parseMaybeDefault(re,Te,b.key)):b.value=b.key,b.shorthand=!0):this.unexpected()},Fn.parsePropertyName=function(b){if(this.options.ecmaVersion>=6){if(this.eat(me.bracketL))return b.computed=!0,b.key=this.parseMaybeAssign(),this.expect(me.bracketR),b.key;b.computed=!1}return b.key=this.type===me.num||this.type===me.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Fn.initFunction=function(b){b.id=null,this.options.ecmaVersion>=6&&(b.generator=b.expression=!1),this.options.ecmaVersion>=8&&(b.async=!1)},Fn.parseMethod=function(b,I,G){var D=this.startNode(),re=this.yieldPos,Te=this.awaitPos,it=this.awaitIdentPos;return this.initFunction(D),this.options.ecmaVersion>=6&&(D.generator=b),this.options.ecmaVersion>=8&&(D.async=!!I),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(xi(I,D.generator)|Ti|(G?Ca:0)),this.expect(me.parenL),D.params=this.parseBindingList(me.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(D,!1,!0),this.yieldPos=re,this.awaitPos=Te,this.awaitIdentPos=it,this.finishNode(D,"FunctionExpression")},Fn.parseArrowExpression=function(b,I,G){var D=this.yieldPos,re=this.awaitPos,Te=this.awaitIdentPos;return this.enterScope(xi(G,!1)|Ba),this.initFunction(b),this.options.ecmaVersion>=8&&(b.async=!!G),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,b.params=this.toAssignableList(I,!0),this.parseFunctionBody(b,!0,!1),this.yieldPos=D,this.awaitPos=re,this.awaitIdentPos=Te,this.finishNode(b,"ArrowFunctionExpression")},Fn.parseFunctionBody=function(b,I,G){var D=I&&this.type!==me.braceL,re=this.strict,Te=!1;if(D)b.body=this.parseMaybeAssign(),b.expression=!0,this.checkParams(b,!1);else{var it=this.options.ecmaVersion>=7&&!this.isSimpleParamList(b.params);(!re||it)&&(Te=this.strictDirective(this.end),Te&&it&&this.raiseRecoverable(b.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var ht=this.labels;this.labels=[],Te&&(this.strict=!0),this.checkParams(b,!re&&!Te&&!I&&!G&&this.isSimpleParamList(b.params)),this.strict&&b.id&&this.checkLVal(b.id,ao),b.body=this.parseBlock(!1,void 0,Te&&!re),b.expression=!1,this.adaptDirectivePrologue(b.body.body),this.labels=ht}this.exitScope()},Fn.isSimpleParamList=function(b){for(var I=0,G=b;I<G.length;I+=1){var D=G[I];if(D.type!=="Identifier")return!1}return!0},Fn.checkParams=function(b,I){for(var G={},D=0,re=b.params;D<re.length;D+=1){var Te=re[D];this.checkLVal(Te,vi,I?null:G)}},Fn.parseExprList=function(b,I,G,D){for(var re=[],Te=!0;!this.eat(b);){if(Te)Te=!1;else if(this.expect(me.comma),I&&this.afterTrailingComma(b))break;var it=void 0;G&&this.type===me.comma?it=null:this.type===me.ellipsis?(it=this.parseSpread(D),D&&this.type===me.comma&&D.trailingComma<0&&(D.trailingComma=this.start)):it=this.parseMaybeAssign(!1,D),re.push(it)}return re},Fn.checkUnreserved=function(b){var I=b.start,G=b.end,D=b.name;if(this.inGenerator&&D==="yield"&&this.raiseRecoverable(I,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&D==="await"&&this.raiseRecoverable(I,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(D)&&this.raise(I,"Unexpected keyword '"+D+"'"),!(this.options.ecmaVersion<6&&this.input.slice(I,G).indexOf("\\")!==-1)){var re=this.strict?this.reservedWordsStrict:this.reservedWords;re.test(D)&&(!this.inAsync&&D==="await"&&this.raiseRecoverable(I,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(I,"The keyword '"+D+"' is reserved"))}},Fn.parseIdent=function(b,I){var G=this.startNode();return this.type===me.name?G.name=this.value:this.type.keyword?(G.name=this.type.keyword,(G.name==="class"||G.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!b),this.finishNode(G,"Identifier"),b||(this.checkUnreserved(G),G.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=G.start)),G},Fn.parseYield=function(b){this.yieldPos||(this.yieldPos=this.start);var I=this.startNode();return this.next(),this.type===me.semi||this.canInsertSemicolon()||this.type!==me.star&&!this.type.startsExpr?(I.delegate=!1,I.argument=null):(I.delegate=this.eat(me.star),I.argument=this.parseMaybeAssign(b)),this.finishNode(I,"YieldExpression")},Fn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var b=this.startNode();return this.next(),b.argument=this.parseMaybeUnary(null,!1),this.finishNode(b,"AwaitExpression")};var va=bt.prototype;va.raise=function(b,I){var G=It(this.input,b);I+=" ("+G.line+":"+G.column+")";var D=new SyntaxError(I);throw D.pos=b,D.loc=G,D.raisedAt=this.pos,D},va.raiseRecoverable=va.raise,va.curPosition=function(){if(this.options.locations)return new Pe(this.curLine,this.pos-this.lineStart)};var Yi=bt.prototype,Lo=function(I){this.flags=I,this.var=[],this.lexical=[],this.functions=[]};Yi.enterScope=function(b){this.scopeStack.push(new Lo(b))},Yi.exitScope=function(){this.scopeStack.pop()},Yi.treatFunctionsAsVarInScope=function(b){return b.flags&Vn||!this.inModule&&b.flags&Xn},Yi.declareName=function(b,I,G){var D=!1;if(I===mi){var re=this.currentScope();D=re.lexical.indexOf(b)>-1||re.functions.indexOf(b)>-1||re.var.indexOf(b)>-1,re.lexical.push(b),this.inModule&&re.flags&Xn&&delete this.undefinedExports[b]}else if(I===Po){var Te=this.currentScope();Te.lexical.push(b)}else if(I===ss){var it=this.currentScope();this.treatFunctionsAsVar?D=it.lexical.indexOf(b)>-1:D=it.lexical.indexOf(b)>-1||it.var.indexOf(b)>-1,it.functions.push(b)}else for(var ht=this.scopeStack.length-1;ht>=0;--ht){var Tt=this.scopeStack[ht];if(Tt.lexical.indexOf(b)>-1&&!(Tt.flags&oa&&Tt.lexical[0]===b)||!this.treatFunctionsAsVarInScope(Tt)&&Tt.functions.indexOf(b)>-1){D=!0;break}if(Tt.var.push(b),this.inModule&&Tt.flags&Xn&&delete this.undefinedExports[b],Tt.flags&Gi)break}D&&this.raiseRecoverable(G,"Identifier '"+b+"' has already been declared")},Yi.checkLocalExport=function(b){this.scopeStack[0].lexical.indexOf(b.name)===-1&&this.scopeStack[0].var.indexOf(b.name)===-1&&(this.undefinedExports[b.name]=b)},Yi.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Yi.currentVarScope=function(){for(var b=this.scopeStack.length-1;;b--){var I=this.scopeStack[b];if(I.flags&Gi)return I}},Yi.currentThisScope=function(){for(var b=this.scopeStack.length-1;;b--){var I=this.scopeStack[b];if(I.flags&Gi&&!(I.flags&Ba))return I}};var to=function(I,G,D){this.type="",this.start=G,this.end=0,I.options.locations&&(this.loc=new ft(I,D)),I.options.directSourceFile&&(this.sourceFile=I.options.directSourceFile),I.options.ranges&&(this.range=[G,0])},So=bt.prototype;So.startNode=function(){return new to(this,this.start,this.startLoc)},So.startNodeAt=function(b,I){return new to(this,b,I)};function Ji(b,I,G,D){return b.type=I,b.end=G,this.options.locations&&(b.loc.end=D),this.options.ranges&&(b.range[1]=G),b}So.finishNode=function(b,I){return Ji.call(this,b,I,this.lastTokEnd,this.lastTokEndLoc)},So.finishNodeAt=function(b,I,G,D){return Ji.call(this,b,I,G,D)};var ro=function(I,G,D,re,Te){this.token=I,this.isExpr=!!G,this.preserveSpace=!!D,this.override=re,this.generator=!!Te},hi={b_stat:new ro("{",!1),b_expr:new ro("{",!0),b_tmpl:new ro("${",!1),p_stat:new ro("(",!1),p_expr:new ro("(",!0),q_tmpl:new ro("`",!0,!0,function(b){return b.tryReadTemplateToken()}),f_stat:new ro("function",!1),f_expr:new ro("function",!0),f_expr_gen:new ro("function",!0,!1,null,!0),f_gen:new ro("function",!1,!1,null,!0)},fa=bt.prototype;fa.initialContext=function(){return[hi.b_stat]},fa.braceIsBlock=function(b){var I=this.curContext();return I===hi.f_expr||I===hi.f_stat?!0:b===me.colon&&(I===hi.b_stat||I===hi.b_expr)?!I.isExpr:b===me._return||b===me.name&&this.exprAllowed?_i.test(this.input.slice(this.lastTokEnd,this.start)):b===me._else||b===me.semi||b===me.eof||b===me.parenR||b===me.arrow?!0:b===me.braceL?I===hi.b_stat:b===me._var||b===me._const||b===me.name?!1:!this.exprAllowed},fa.inGeneratorContext=function(){for(var b=this.context.length-1;b>=1;b--){var I=this.context[b];if(I.token==="function")return I.generator}return!1},fa.updateContext=function(b){var I,G=this.type;G.keyword&&b===me.dot?this.exprAllowed=!1:(I=G.updateContext)?I.call(this,b):this.exprAllowed=G.beforeExpr},me.parenR.updateContext=me.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var b=this.context.pop();b===hi.b_stat&&this.curContext().token==="function"&&(b=this.context.pop()),this.exprAllowed=!b.isExpr},me.braceL.updateContext=function(b){this.context.push(this.braceIsBlock(b)?hi.b_stat:hi.b_expr),this.exprAllowed=!0},me.dollarBraceL.updateContext=function(){this.context.push(hi.b_tmpl),this.exprAllowed=!0},me.parenL.updateContext=function(b){var I=b===me._if||b===me._for||b===me._with||b===me._while;this.context.push(I?hi.p_stat:hi.p_expr),this.exprAllowed=!0},me.incDec.updateContext=function(){},me._function.updateContext=me._class.updateContext=function(b){b.beforeExpr&&b!==me.semi&&b!==me._else&&!(b===me._return&&_i.test(this.input.slice(this.lastTokEnd,this.start)))&&!((b===me.colon||b===me.braceL)&&this.curContext()===hi.b_stat)?this.context.push(hi.f_expr):this.context.push(hi.f_stat),this.exprAllowed=!1},me.backQuote.updateContext=function(){this.curContext()===hi.q_tmpl?this.context.pop():this.context.push(hi.q_tmpl),this.exprAllowed=!1},me.star.updateContext=function(b){if(b===me._function){var I=this.context.length-1;this.context[I]===hi.f_expr?this.context[I]=hi.f_expr_gen:this.context[I]=hi.f_gen}this.exprAllowed=!0},me.name.updateContext=function(b){var I=!1;this.options.ecmaVersion>=6&&b!==me.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(I=!0),this.exprAllowed=I};var $="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ne=$+" Extended_Pictographic",he=ne,be={9:$,10:ne,11:he},Ne="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Ye="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",lt=Ye+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",_e=lt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",je={9:Ye,10:lt,11:_e},Mt={};function Sr(b){var I=Mt[b]={binary:Ze(be[b]+" "+Ne),nonBinary:{General_Category:Ze(Ne),Script:Ze(je[b])}};I.nonBinary.Script_Extensions=I.nonBinary.Script,I.nonBinary.gc=I.nonBinary.General_Category,I.nonBinary.sc=I.nonBinary.Script,I.nonBinary.scx=I.nonBinary.Script_Extensions}Sr(9),Sr(10),Sr(11);var zt=bt.prototype,Yt=function(I){this.parser=I,this.validFlags="gim"+(I.options.ecmaVersion>=6?"uy":"")+(I.options.ecmaVersion>=9?"s":""),this.unicodeProperties=Mt[I.options.ecmaVersion>=11?11:I.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Yt.prototype.reset=function(I,G,D){var re=D.indexOf("u")!==-1;this.start=I|0,this.source=G+"",this.flags=D,this.switchU=re&&this.parser.options.ecmaVersion>=6,this.switchN=re&&this.parser.options.ecmaVersion>=9},Yt.prototype.raise=function(I){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+I)},Yt.prototype.at=function(I,G){G===void 0&&(G=!1);var D=this.source,re=D.length;if(I>=re)return-1;var Te=D.charCodeAt(I);if(!(G||this.switchU)||Te<=55295||Te>=57344||I+1>=re)return Te;var it=D.charCodeAt(I+1);return it>=56320&&it<=57343?(Te<<10)+it-56613888:Te},Yt.prototype.nextIndex=function(I,G){G===void 0&&(G=!1);var D=this.source,re=D.length;if(I>=re)return re;var Te=D.charCodeAt(I),it;return!(G||this.switchU)||Te<=55295||Te>=57344||I+1>=re||(it=D.charCodeAt(I+1))<56320||it>57343?I+1:I+2},Yt.prototype.current=function(I){return I===void 0&&(I=!1),this.at(this.pos,I)},Yt.prototype.lookahead=function(I){return I===void 0&&(I=!1),this.at(this.nextIndex(this.pos,I),I)},Yt.prototype.advance=function(I){I===void 0&&(I=!1),this.pos=this.nextIndex(this.pos,I)},Yt.prototype.eat=function(I,G){return G===void 0&&(G=!1),this.current(G)===I?(this.advance(G),!0):!1};function Lr(b){return b<=65535?String.fromCharCode(b):(b-=65536,String.fromCharCode((b>>10)+55296,(b&1023)+56320))}zt.validateRegExpFlags=function(b){for(var I=b.validFlags,G=b.flags,D=0;D<G.length;D++){var re=G.charAt(D);I.indexOf(re)===-1&&this.raise(b.start,"Invalid regular expression flag"),G.indexOf(re,D+1)>-1&&this.raise(b.start,"Duplicate regular expression flag")}},zt.validateRegExpPattern=function(b){this.regexp_pattern(b),!b.switchN&&this.options.ecmaVersion>=9&&b.groupNames.length>0&&(b.switchN=!0,this.regexp_pattern(b))},zt.regexp_pattern=function(b){b.pos=0,b.lastIntValue=0,b.lastStringValue="",b.lastAssertionIsQuantifiable=!1,b.numCapturingParens=0,b.maxBackReference=0,b.groupNames.length=0,b.backReferenceNames.length=0,this.regexp_disjunction(b),b.pos!==b.source.length&&(b.eat(41)&&b.raise("Unmatched ')'"),(b.eat(93)||b.eat(125))&&b.raise("Lone quantifier brackets")),b.maxBackReference>b.numCapturingParens&&b.raise("Invalid escape");for(var I=0,G=b.backReferenceNames;I<G.length;I+=1){var D=G[I];b.groupNames.indexOf(D)===-1&&b.raise("Invalid named capture referenced")}},zt.regexp_disjunction=function(b){for(this.regexp_alternative(b);b.eat(124);)this.regexp_alternative(b);this.regexp_eatQuantifier(b,!0)&&b.raise("Nothing to repeat"),b.eat(123)&&b.raise("Lone quantifier brackets")},zt.regexp_alternative=function(b){for(;b.pos<b.source.length&&this.regexp_eatTerm(b););},zt.regexp_eatTerm=function(b){return this.regexp_eatAssertion(b)?(b.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(b)&&b.switchU&&b.raise("Invalid quantifier"),!0):(b.switchU?this.regexp_eatAtom(b):this.regexp_eatExtendedAtom(b))?(this.regexp_eatQuantifier(b),!0):!1},zt.regexp_eatAssertion=function(b){var I=b.pos;if(b.lastAssertionIsQuantifiable=!1,b.eat(94)||b.eat(36))return!0;if(b.eat(92)){if(b.eat(66)||b.eat(98))return!0;b.pos=I}if(b.eat(40)&&b.eat(63)){var G=!1;if(this.options.ecmaVersion>=9&&(G=b.eat(60)),b.eat(61)||b.eat(33))return this.regexp_disjunction(b),b.eat(41)||b.raise("Unterminated group"),b.lastAssertionIsQuantifiable=!G,!0}return b.pos=I,!1},zt.regexp_eatQuantifier=function(b,I){return I===void 0&&(I=!1),this.regexp_eatQuantifierPrefix(b,I)?(b.eat(63),!0):!1},zt.regexp_eatQuantifierPrefix=function(b,I){return b.eat(42)||b.eat(43)||b.eat(63)||this.regexp_eatBracedQuantifier(b,I)},zt.regexp_eatBracedQuantifier=function(b,I){var G=b.pos;if(b.eat(123)){var D=0,re=-1;if(this.regexp_eatDecimalDigits(b)&&(D=b.lastIntValue,b.eat(44)&&this.regexp_eatDecimalDigits(b)&&(re=b.lastIntValue),b.eat(125)))return re!==-1&&re<D&&!I&&b.raise("numbers out of order in {} quantifier"),!0;b.switchU&&!I&&b.raise("Incomplete quantifier"),b.pos=G}return!1},zt.regexp_eatAtom=function(b){return this.regexp_eatPatternCharacters(b)||b.eat(46)||this.regexp_eatReverseSolidusAtomEscape(b)||this.regexp_eatCharacterClass(b)||this.regexp_eatUncapturingGroup(b)||this.regexp_eatCapturingGroup(b)},zt.regexp_eatReverseSolidusAtomEscape=function(b){var I=b.pos;if(b.eat(92)){if(this.regexp_eatAtomEscape(b))return!0;b.pos=I}return!1},zt.regexp_eatUncapturingGroup=function(b){var I=b.pos;if(b.eat(40)){if(b.eat(63)&&b.eat(58)){if(this.regexp_disjunction(b),b.eat(41))return!0;b.raise("Unterminated group")}b.pos=I}return!1},zt.regexp_eatCapturingGroup=function(b){if(b.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(b):b.current()===63&&b.raise("Invalid group"),this.regexp_disjunction(b),b.eat(41))return b.numCapturingParens+=1,!0;b.raise("Unterminated group")}return!1},zt.regexp_eatExtendedAtom=function(b){return b.eat(46)||this.regexp_eatReverseSolidusAtomEscape(b)||this.regexp_eatCharacterClass(b)||this.regexp_eatUncapturingGroup(b)||this.regexp_eatCapturingGroup(b)||this.regexp_eatInvalidBracedQuantifier(b)||this.regexp_eatExtendedPatternCharacter(b)},zt.regexp_eatInvalidBracedQuantifier=function(b){return this.regexp_eatBracedQuantifier(b,!0)&&b.raise("Nothing to repeat"),!1},zt.regexp_eatSyntaxCharacter=function(b){var I=b.current();return $n(I)?(b.lastIntValue=I,b.advance(),!0):!1};function $n(b){return b===36||b>=40&&b<=43||b===46||b===63||b>=91&&b<=94||b>=123&&b<=125}zt.regexp_eatPatternCharacters=function(b){for(var I=b.pos,G=0;(G=b.current())!==-1&&!$n(G);)b.advance();return b.pos!==I},zt.regexp_eatExtendedPatternCharacter=function(b){var I=b.current();return I!==-1&&I!==36&&!(I>=40&&I<=43)&&I!==46&&I!==63&&I!==91&&I!==94&&I!==124?(b.advance(),!0):!1},zt.regexp_groupSpecifier=function(b){if(b.eat(63)){if(this.regexp_eatGroupName(b)){b.groupNames.indexOf(b.lastStringValue)!==-1&&b.raise("Duplicate capture group name"),b.groupNames.push(b.lastStringValue);return}b.raise("Invalid group")}},zt.regexp_eatGroupName=function(b){if(b.lastStringValue="",b.eat(60)){if(this.regexp_eatRegExpIdentifierName(b)&&b.eat(62))return!0;b.raise("Invalid capture group name")}return!1},zt.regexp_eatRegExpIdentifierName=function(b){if(b.lastStringValue="",this.regexp_eatRegExpIdentifierStart(b)){for(b.lastStringValue+=Lr(b.lastIntValue);this.regexp_eatRegExpIdentifierPart(b);)b.lastStringValue+=Lr(b.lastIntValue);return!0}return!1},zt.regexp_eatRegExpIdentifierStart=function(b){var I=b.pos,G=this.options.ecmaVersion>=11,D=b.current(G);return b.advance(G),D===92&&this.regexp_eatRegExpUnicodeEscapeSequence(b,G)&&(D=b.lastIntValue),vn(D)?(b.lastIntValue=D,!0):(b.pos=I,!1)};function vn(b){return ar(b,!0)||b===36||b===95}zt.regexp_eatRegExpIdentifierPart=function(b){var I=b.pos,G=this.options.ecmaVersion>=11,D=b.current(G);return b.advance(G),D===92&&this.regexp_eatRegExpUnicodeEscapeSequence(b,G)&&(D=b.lastIntValue),Nt(D)?(b.lastIntValue=D,!0):(b.pos=I,!1)};function Nt(b){return ur(b,!0)||b===36||b===95||b===8204||b===8205}zt.regexp_eatAtomEscape=function(b){return this.regexp_eatBackReference(b)||this.regexp_eatCharacterClassEscape(b)||this.regexp_eatCharacterEscape(b)||b.switchN&&this.regexp_eatKGroupName(b)?!0:(b.switchU&&(b.current()===99&&b.raise("Invalid unicode escape"),b.raise("Invalid escape")),!1)},zt.regexp_eatBackReference=function(b){var I=b.pos;if(this.regexp_eatDecimalEscape(b)){var G=b.lastIntValue;if(b.switchU)return G>b.maxBackReference&&(b.maxBackReference=G),!0;if(G<=b.numCapturingParens)return!0;b.pos=I}return!1},zt.regexp_eatKGroupName=function(b){if(b.eat(107)){if(this.regexp_eatGroupName(b))return b.backReferenceNames.push(b.lastStringValue),!0;b.raise("Invalid named reference")}return!1},zt.regexp_eatCharacterEscape=function(b){return this.regexp_eatControlEscape(b)||this.regexp_eatCControlLetter(b)||this.regexp_eatZero(b)||this.regexp_eatHexEscapeSequence(b)||this.regexp_eatRegExpUnicodeEscapeSequence(b,!1)||!b.switchU&&this.regexp_eatLegacyOctalEscapeSequence(b)||this.regexp_eatIdentityEscape(b)},zt.regexp_eatCControlLetter=function(b){var I=b.pos;if(b.eat(99)){if(this.regexp_eatControlLetter(b))return!0;b.pos=I}return!1},zt.regexp_eatZero=function(b){return b.current()===48&&!xt(b.lookahead())?(b.lastIntValue=0,b.advance(),!0):!1},zt.regexp_eatControlEscape=function(b){var I=b.current();return I===116?(b.lastIntValue=9,b.advance(),!0):I===110?(b.lastIntValue=10,b.advance(),!0):I===118?(b.lastIntValue=11,b.advance(),!0):I===102?(b.lastIntValue=12,b.advance(),!0):I===114?(b.lastIntValue=13,b.advance(),!0):!1},zt.regexp_eatControlLetter=function(b){var I=b.current();return pr(I)?(b.lastIntValue=I%32,b.advance(),!0):!1};function pr(b){return b>=65&&b<=90||b>=97&&b<=122}zt.regexp_eatRegExpUnicodeEscapeSequence=function(b,I){I===void 0&&(I=!1);var G=b.pos,D=I||b.switchU;if(b.eat(117)){if(this.regexp_eatFixedHexDigits(b,4)){var re=b.lastIntValue;if(D&&re>=55296&&re<=56319){var Te=b.pos;if(b.eat(92)&&b.eat(117)&&this.regexp_eatFixedHexDigits(b,4)){var it=b.lastIntValue;if(it>=56320&&it<=57343)return b.lastIntValue=(re-55296)*1024+(it-56320)+65536,!0}b.pos=Te,b.lastIntValue=re}return!0}if(D&&b.eat(123)&&this.regexp_eatHexDigits(b)&&b.eat(125)&&on(b.lastIntValue))return!0;D&&b.raise("Invalid unicode escape"),b.pos=G}return!1};function on(b){return b>=0&&b<=1114111}zt.regexp_eatIdentityEscape=function(b){if(b.switchU)return this.regexp_eatSyntaxCharacter(b)?!0:b.eat(47)?(b.lastIntValue=47,!0):!1;var I=b.current();return I!==99&&(!b.switchN||I!==107)?(b.lastIntValue=I,b.advance(),!0):!1},zt.regexp_eatDecimalEscape=function(b){b.lastIntValue=0;var I=b.current();if(I>=49&&I<=57){do b.lastIntValue=10*b.lastIntValue+(I-48),b.advance();while((I=b.current())>=48&&I<=57);return!0}return!1},zt.regexp_eatCharacterClassEscape=function(b){var I=b.current();if(cn(I))return b.lastIntValue=-1,b.advance(),!0;if(b.switchU&&this.options.ecmaVersion>=9&&(I===80||I===112)){if(b.lastIntValue=-1,b.advance(),b.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(b)&&b.eat(125))return!0;b.raise("Invalid property name")}return!1};function cn(b){return b===100||b===68||b===115||b===83||b===119||b===87}zt.regexp_eatUnicodePropertyValueExpression=function(b){var I=b.pos;if(this.regexp_eatUnicodePropertyName(b)&&b.eat(61)){var G=b.lastStringValue;if(this.regexp_eatUnicodePropertyValue(b)){var D=b.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(b,G,D),!0}}if(b.pos=I,this.regexp_eatLoneUnicodePropertyNameOrValue(b)){var re=b.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(b,re),!0}return!1},zt.regexp_validateUnicodePropertyNameAndValue=function(b,I,G){Ee(b.unicodeProperties.nonBinary,I)||b.raise("Invalid property name"),b.unicodeProperties.nonBinary[I].test(G)||b.raise("Invalid property value")},zt.regexp_validateUnicodePropertyNameOrValue=function(b,I){b.unicodeProperties.binary.test(I)||b.raise("Invalid property name")},zt.regexp_eatUnicodePropertyName=function(b){var I=0;for(b.lastStringValue="";$i(I=b.current());)b.lastStringValue+=Lr(I),b.advance();return b.lastStringValue!==""};function $i(b){return pr(b)||b===95}zt.regexp_eatUnicodePropertyValue=function(b){var I=0;for(b.lastStringValue="";Cn(I=b.current());)b.lastStringValue+=Lr(I),b.advance();return b.lastStringValue!==""};function Cn(b){return $i(b)||xt(b)}zt.regexp_eatLoneUnicodePropertyNameOrValue=function(b){return this.regexp_eatUnicodePropertyValue(b)},zt.regexp_eatCharacterClass=function(b){if(b.eat(91)){if(b.eat(94),this.regexp_classRanges(b),b.eat(93))return!0;b.raise("Unterminated character class")}return!1},zt.regexp_classRanges=function(b){for(;this.regexp_eatClassAtom(b);){var I=b.lastIntValue;if(b.eat(45)&&this.regexp_eatClassAtom(b)){var G=b.lastIntValue;b.switchU&&(I===-1||G===-1)&&b.raise("Invalid character class"),I!==-1&&G!==-1&&I>G&&b.raise("Range out of order in character class")}}},zt.regexp_eatClassAtom=function(b){var I=b.pos;if(b.eat(92)){if(this.regexp_eatClassEscape(b))return!0;if(b.switchU){var G=b.current();(G===99||na(G))&&b.raise("Invalid class escape"),b.raise("Invalid escape")}b.pos=I}var D=b.current();return D!==93?(b.lastIntValue=D,b.advance(),!0):!1},zt.regexp_eatClassEscape=function(b){var I=b.pos;if(b.eat(98))return b.lastIntValue=8,!0;if(b.switchU&&b.eat(45))return b.lastIntValue=45,!0;if(!b.switchU&&b.eat(99)){if(this.regexp_eatClassControlLetter(b))return!0;b.pos=I}return this.regexp_eatCharacterClassEscape(b)||this.regexp_eatCharacterEscape(b)},zt.regexp_eatClassControlLetter=function(b){var I=b.current();return xt(I)||I===95?(b.lastIntValue=I%32,b.advance(),!0):!1},zt.regexp_eatHexEscapeSequence=function(b){var I=b.pos;if(b.eat(120)){if(this.regexp_eatFixedHexDigits(b,2))return!0;b.switchU&&b.raise("Invalid escape"),b.pos=I}return!1},zt.regexp_eatDecimalDigits=function(b){var I=b.pos,G=0;for(b.lastIntValue=0;xt(G=b.current());)b.lastIntValue=10*b.lastIntValue+(G-48),b.advance();return b.pos!==I};function xt(b){return b>=48&&b<=57}zt.regexp_eatHexDigits=function(b){var I=b.pos,G=0;for(b.lastIntValue=0;St(G=b.current());)b.lastIntValue=16*b.lastIntValue+qi(G),b.advance();return b.pos!==I};function St(b){return b>=48&&b<=57||b>=65&&b<=70||b>=97&&b<=102}function qi(b){return b>=65&&b<=70?10+(b-65):b>=97&&b<=102?10+(b-97):b-48}zt.regexp_eatLegacyOctalEscapeSequence=function(b){if(this.regexp_eatOctalDigit(b)){var I=b.lastIntValue;if(this.regexp_eatOctalDigit(b)){var G=b.lastIntValue;I<=3&&this.regexp_eatOctalDigit(b)?b.lastIntValue=I*64+G*8+b.lastIntValue:b.lastIntValue=I*8+G}else b.lastIntValue=I;return!0}return!1},zt.regexp_eatOctalDigit=function(b){var I=b.current();return na(I)?(b.lastIntValue=I-48,b.advance(),!0):(b.lastIntValue=0,!1)};function na(b){return b>=48&&b<=55}zt.regexp_eatFixedHexDigits=function(b,I){var G=b.pos;b.lastIntValue=0;for(var D=0;D<I;++D){var re=b.current();if(!St(re))return b.pos=G,!1;b.lastIntValue=16*b.lastIntValue+qi(re),b.advance()}return!0};var ea=function(I){this.type=I.type,this.value=I.value,this.start=I.start,this.end=I.end,I.options.locations&&(this.loc=new ft(I,I.startLoc,I.endLoc)),I.options.ranges&&(this.range=[I.start,I.end])},oi=bt.prototype;oi.next=function(b){!b&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new ea(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},oi.getToken=function(){return this.next(),new ea(this)},typeof Symbol<"u"&&(oi[Symbol.iterator]=function(){var b=this;return{next:function(){var I=b.getToken();return{done:I.type===me.eof,value:I}}}}),oi.curContext=function(){return this.context[this.context.length-1]},oi.nextToken=function(){var b=this.curContext();if((!b||!b.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(me.eof);if(b.override)return b.override(this);this.readToken(this.fullCharCodeAtPos())},oi.readToken=function(b){return ar(b,this.options.ecmaVersion>=6)||b===92?this.readWord():this.getTokenFromCode(b)},oi.fullCharCodeAtPos=function(){var b=this.input.charCodeAt(this.pos);if(b<=55295||b>=57344)return b;var I=this.input.charCodeAt(this.pos+1);return(b<<10)+I-56613888},oi.skipBlockComment=function(){var b=this.options.onComment&&this.curPosition(),I=this.pos,G=this.input.indexOf("*/",this.pos+=2);if(G===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=G+2,this.options.locations){Rr.lastIndex=I;for(var D;(D=Rr.exec(this.input))&&D.index<this.pos;)++this.curLine,this.lineStart=D.index+D[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(I+2,G),I,this.pos,b,this.curPosition())},oi.skipLineComment=function(b){for(var I=this.pos,G=this.options.onComment&&this.curPosition(),D=this.input.charCodeAt(this.pos+=b);this.pos<this.input.length&&!ir(D);)D=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(I+b,this.pos),I,this.pos,G,this.curPosition())},oi.skipSpace=function(){e:for(;this.pos<this.input.length;){var b=this.input.charCodeAt(this.pos);switch(b){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(b>8&&b<14||b>=5760&&zr.test(String.fromCharCode(b)))++this.pos;else break e}}},oi.finishToken=function(b,I){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var G=this.type;this.type=b,this.value=I,this.updateContext(G)},oi.readToken_dot=function(){var b=this.input.charCodeAt(this.pos+1);if(b>=48&&b<=57)return this.readNumber(!0);var I=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&b===46&&I===46?(this.pos+=3,this.finishToken(me.ellipsis)):(++this.pos,this.finishToken(me.dot))},oi.readToken_slash=function(){var b=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):b===61?this.finishOp(me.assign,2):this.finishOp(me.slash,1)},oi.readToken_mult_modulo_exp=function(b){var I=this.input.charCodeAt(this.pos+1),G=1,D=b===42?me.star:me.modulo;return this.options.ecmaVersion>=7&&b===42&&I===42&&(++G,D=me.starstar,I=this.input.charCodeAt(this.pos+2)),I===61?this.finishOp(me.assign,G+1):this.finishOp(D,G)},oi.readToken_pipe_amp=function(b){var I=this.input.charCodeAt(this.pos+1);if(I===b){if(this.options.ecmaVersion>=12){var G=this.input.charCodeAt(this.pos+2);if(G===61)return this.finishOp(me.assign,3)}return this.finishOp(b===124?me.logicalOR:me.logicalAND,2)}return I===61?this.finishOp(me.assign,2):this.finishOp(b===124?me.bitwiseOR:me.bitwiseAND,1)},oi.readToken_caret=function(){var b=this.input.charCodeAt(this.pos+1);return b===61?this.finishOp(me.assign,2):this.finishOp(me.bitwiseXOR,1)},oi.readToken_plus_min=function(b){var I=this.input.charCodeAt(this.pos+1);return I===b?I===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||_i.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(me.incDec,2):I===61?this.finishOp(me.assign,2):this.finishOp(me.plusMin,1)},oi.readToken_lt_gt=function(b){var I=this.input.charCodeAt(this.pos+1),G=1;return I===b?(G=b===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+G)===61?this.finishOp(me.assign,G+1):this.finishOp(me.bitShift,G)):I===33&&b===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(I===61&&(G=2),this.finishOp(me.relational,G))},oi.readToken_eq_excl=function(b){var I=this.input.charCodeAt(this.pos+1);return I===61?this.finishOp(me.equality,this.input.charCodeAt(this.pos+2)===61?3:2):b===61&&I===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(me.arrow)):this.finishOp(b===61?me.eq:me.prefix,1)},oi.readToken_question=function(){var b=this.options.ecmaVersion;if(b>=11){var I=this.input.charCodeAt(this.pos+1);if(I===46){var G=this.input.charCodeAt(this.pos+2);if(G<48||G>57)return this.finishOp(me.questionDot,2)}if(I===63){if(b>=12){var D=this.input.charCodeAt(this.pos+2);if(D===61)return this.finishOp(me.assign,3)}return this.finishOp(me.coalesce,2)}}return this.finishOp(me.question,1)},oi.getTokenFromCode=function(b){switch(b){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(me.parenL);case 41:return++this.pos,this.finishToken(me.parenR);case 59:return++this.pos,this.finishToken(me.semi);case 44:return++this.pos,this.finishToken(me.comma);case 91:return++this.pos,this.finishToken(me.bracketL);case 93:return++this.pos,this.finishToken(me.bracketR);case 123:return++this.pos,this.finishToken(me.braceL);case 125:return++this.pos,this.finishToken(me.braceR);case 58:return++this.pos,this.finishToken(me.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(me.backQuote);case 48:var I=this.input.charCodeAt(this.pos+1);if(I===120||I===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(I===111||I===79)return this.readRadixNumber(8);if(I===98||I===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(b);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(b);case 124:case 38:return this.readToken_pipe_amp(b);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(b);case 60:case 62:return this.readToken_lt_gt(b);case 61:case 33:return this.readToken_eq_excl(b);case 63:return this.readToken_question();case 126:return this.finishOp(me.prefix,1)}this.raise(this.pos,"Unexpected character '"+mr(b)+"'")},oi.finishOp=function(b,I){var G=this.input.slice(this.pos,this.pos+I);return this.pos+=I,this.finishToken(b,G)},oi.readRegexp=function(){for(var b,I,G=this.pos;;){this.pos>=this.input.length&&this.raise(G,"Unterminated regular expression");var D=this.input.charAt(this.pos);if(_i.test(D)&&this.raise(G,"Unterminated regular expression"),b)b=!1;else{if(D==="[")I=!0;else if(D==="]"&&I)I=!1;else if(D==="/"&&!I)break;b=D==="\\"}++this.pos}var re=this.input.slice(G,this.pos);++this.pos;var Te=this.pos,it=this.readWord1();this.containsEsc&&this.unexpected(Te);var ht=this.regexpState||(this.regexpState=new Yt(this));ht.reset(G,re,it),this.validateRegExpFlags(ht),this.validateRegExpPattern(ht);var Tt=null;try{Tt=new RegExp(re,it)}catch{}return this.finishToken(me.regexp,{pattern:re,flags:it,value:Tt})},oi.readInt=function(b,I,G){for(var D=this.options.ecmaVersion>=12&&I===void 0,re=G&&this.input.charCodeAt(this.pos)===48,Te=this.pos,it=0,ht=0,Tt=0,_r=I??1/0;Tt<_r;++Tt,++this.pos){var br=this.input.charCodeAt(this.pos),si=void 0;if(D&&br===95){re&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),ht===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Tt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),ht=br;continue}if(br>=97?si=br-97+10:br>=65?si=br-65+10:br>=48&&br<=57?si=br-48:si=1/0,si>=b)break;ht=br,it=it*b+si}return D&&ht===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===Te||I!=null&&this.pos-Te!==I?null:it};function Zi(b,I){return I?parseInt(b,8):parseFloat(b.replace(/_/g,""))}function fo(b){return typeof BigInt!="function"?null:BigInt(b.replace(/_/g,""))}oi.readRadixNumber=function(b){var I=this.pos;this.pos+=2;var G=this.readInt(b);return G==null&&this.raise(this.start+2,"Expected number in radix "+b),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(G=fo(this.input.slice(I,this.pos)),++this.pos):ar(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(me.num,G)},oi.readNumber=function(b){var I=this.pos;!b&&this.readInt(10,void 0,!0)===null&&this.raise(I,"Invalid number");var G=this.pos-I>=2&&this.input.charCodeAt(I)===48;G&&this.strict&&this.raise(I,"Invalid number");var D=this.input.charCodeAt(this.pos);if(!G&&!b&&this.options.ecmaVersion>=11&&D===110){var re=fo(this.input.slice(I,this.pos));return++this.pos,ar(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(me.num,re)}G&&/[89]/.test(this.input.slice(I,this.pos))&&(G=!1),D===46&&!G&&(++this.pos,this.readInt(10),D=this.input.charCodeAt(this.pos)),(D===69||D===101)&&!G&&(D=this.input.charCodeAt(++this.pos),(D===43||D===45)&&++this.pos,this.readInt(10)===null&&this.raise(I,"Invalid number")),ar(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var Te=Zi(this.input.slice(I,this.pos),G);return this.finishToken(me.num,Te)},oi.readCodePoint=function(){var b=this.input.charCodeAt(this.pos),I;if(b===123){this.options.ecmaVersion<6&&this.unexpected();var G=++this.pos;I=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,I>1114111&&this.invalidStringToken(G,"Code point out of bounds")}else I=this.readHexChar(4);return I};function mr(b){return b<=65535?String.fromCharCode(b):(b-=65536,String.fromCharCode((b>>10)+55296,(b&1023)+56320))}oi.readString=function(b){for(var I="",G=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var D=this.input.charCodeAt(this.pos);if(D===b)break;D===92?(I+=this.input.slice(G,this.pos),I+=this.readEscapedChar(!1),G=this.pos):(ir(D,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return I+=this.input.slice(G,this.pos++),this.finishToken(me.string,I)};var lr={};oi.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(b){if(b===lr)this.readInvalidTemplateToken();else throw b}this.inTemplateElement=!1},oi.invalidStringToken=function(b,I){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw lr;this.raise(b,I)},oi.readTmplToken=function(){for(var b="",I=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var G=this.input.charCodeAt(this.pos);if(G===96||G===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===me.template||this.type===me.invalidTemplate)?G===36?(this.pos+=2,this.finishToken(me.dollarBraceL)):(++this.pos,this.finishToken(me.backQuote)):(b+=this.input.slice(I,this.pos),this.finishToken(me.template,b));if(G===92)b+=this.input.slice(I,this.pos),b+=this.readEscapedChar(!0),I=this.pos;else if(ir(G)){switch(b+=this.input.slice(I,this.pos),++this.pos,G){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:b+=`
`;break;default:b+=String.fromCharCode(G);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),I=this.pos}else++this.pos}},oi.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(me.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},oi.readEscapedChar=function(b){var I=this.input.charCodeAt(++this.pos);switch(++this.pos,I){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return mr(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(b){var G=this.pos-1;return this.invalidStringToken(G,"Invalid escape sequence in template string"),null}default:if(I>=48&&I<=55){var D=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],re=parseInt(D,8);return re>255&&(D=D.slice(0,-1),re=parseInt(D,8)),this.pos+=D.length-1,I=this.input.charCodeAt(this.pos),(D!=="0"||I===56||I===57)&&(this.strict||b)&&this.invalidStringToken(this.pos-1-D.length,b?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(re)}return ir(I)?"":String.fromCharCode(I)}},oi.readHexChar=function(b){var I=this.pos,G=this.readInt(16,b);return G===null&&this.invalidStringToken(I,"Bad character escape sequence"),G},oi.readWord1=function(){this.containsEsc=!1;for(var b="",I=!0,G=this.pos,D=this.options.ecmaVersion>=6;this.pos<this.input.length;){var re=this.fullCharCodeAtPos();if(ur(re,D))this.pos+=re<=65535?1:2;else if(re===92){this.containsEsc=!0,b+=this.input.slice(G,this.pos);var Te=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var it=this.readCodePoint();(I?ar:ur)(it,D)||this.invalidStringToken(Te,"Invalid Unicode escape"),b+=mr(it),G=this.pos}else break;I=!1}return b+this.input.slice(G,this.pos)},oi.readWord=function(){var b=this.readWord1(),I=me.name;return this.keywords.test(b)&&(I=Pi[b]),this.finishToken(I,b)};var nt="7.4.1";bt.acorn={Parser:bt,version:nt,defaultOptions:qt,Position:Pe,SourceLocation:ft,getLineInfo:It,Node:to,TokenType:Ir,tokTypes:me,keywordTypes:Pi,TokContext:ro,tokContexts:hi,isIdentifierChar:ur,isIdentifierStart:ar,Token:ea,isNewLine:ir,lineBreak:_i,lineBreakG:Rr,nonASCIIwhitespace:zr};function Ya(b,I){return bt.parse(b,I)}function dt(b,I,G){return bt.parseExpressionAt(b,I,G)}function wo(b,I){return bt.tokenizer(b,I)}function qa(b,I){b.prototype=Object.create(I.prototype),b.prototype.constructor=b,b.__proto__=I}function lu(b){var I=typeof Map=="function"?new Map:void 0;return lu=function(D){if(D===null||!ic(D))return D;if(typeof D!="function")throw new TypeError("Super expression must either be null or a function");if(typeof I<"u"){if(I.has(D))return I.get(D);I.set(D,re)}function re(){return Li(D,arguments,Ao(this).constructor)}return re.prototype=Object.create(D.prototype,{constructor:{value:re,enumerable:!1,writable:!0,configurable:!0}}),Aa(re,D)},lu(b)}function No(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Li(b,I,G){return No()?Li=Reflect.construct:Li=function(re,Te,it){var ht=[null];ht.push.apply(ht,Te);var Tt=Function.bind.apply(re,ht),_r=new Tt;return it&&Aa(_r,it.prototype),_r},Li.apply(null,arguments)}function ic(b){return Function.toString.call(b).indexOf("[native code]")!==-1}function Aa(b,I){return Aa=Object.setPrototypeOf||function(D,re){return D.__proto__=re,D},Aa(b,I)}function Ao(b){return Ao=Object.setPrototypeOf?Object.getPrototypeOf:function(G){return G.__proto__||Object.getPrototypeOf(G)},Ao(b)}var Ho=function(b){qa(I,b);function I(){return b.apply(this,arguments)||this}return I}(lu(Error)),pa=function(b){qa(I,b);function I(){return b.apply(this,arguments)||this}return I}(lu(SyntaxError)),ws=function(b){qa(I,b);function I(){return b.apply(this,arguments)||this}return I}(lu(ReferenceError)),Vs=function(b){qa(I,b);function I(){return b.apply(this,arguments)||this}return I}(lu(TypeError)),gl=function(b){qa(I,b);function I(){return b.apply(this,arguments)||this}return I}(Ho),oo=function(b){qa(I,b);function I(){return b.apply(this,arguments)||this}return I}(pa),ms=function(b){qa(I,b);function I(){return b.apply(this,arguments)||this}return I}(ws),Oa={UnknownError:[3001,"%0",gl],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",gl],NodeTypeSyntaxError:[1001,"Unknown node type: %0",ms],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",ms],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",ms],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",ms],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",ms],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",ms],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",ms],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",ms],ParamTypeSyntaxError:[1009,"Unknown param type: %0",ms],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",ms],FunctionUndefinedReferenceError:[2001,"%0 is not a function",ws],VariableUndefinedReferenceError:[2002,"%0 is not defined",ws],IsNotConstructor:[2003,"%0 is not a constructor",Vs]};function Ro(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Ps(b,I,G){return Ro()?Ps=Reflect.construct:Ps=function(re,Te,it){var ht=[null];ht.push.apply(ht,Te);var Tt=Function.bind.apply(re,ht),_r=new Tt;return it&&zo(_r,it.prototype),_r},Ps.apply(null,arguments)}function zo(b,I){return zo=Object.setPrototypeOf||function(D,re){return D.__proto__=re,D},zo(b,I)}var yu="0.0.3";function el(b,I){Object.defineProperty(b,"name",{value:I,writable:!1,enumerable:!1,configurable:!0})}var Wo=Object.prototype.hasOwnProperty,fe=Symbol("Break"),Me=Symbol("Continue"),ut=Symbol("DefaultCase"),Zt=Symbol("EmptyStatementReturn"),sn=Symbol("WithScopeName"),jn=Symbol("SuperScopeName"),ua=Symbol("RootScopeName"),Jo=Symbol("GlobalScopeName");function Ta(b){return typeof b=="function"}var so=function(){function b(G){this.interpreter=G}var I=b.prototype;return I.generator=function(){var D=this.interpreter;function re(){return this.getCurrentScope()}function Te(){return this.getGlobalScope()}function it(){return this.getCurrentContext()}return{getOptions:D.getOptions.bind(D),getCurrentScope:re.bind(D),getGlobalScope:Te.bind(D),getCurrentContext:it.bind(D),getExecStartTime:D.getExecStartTime.bind(D)}},b}();function xo(b,I,G){if(G===void 0&&(G=!0),!(b instanceof so))throw new Error("Illegal call");if(typeof I!="string")return I;if(!!I){var D=b.generator(),re=D.getOptions(),Te={timeout:re.timeout,_initEnv:function(){G||this.setCurrentContext(D.getCurrentContext()),this.execStartTime=D.getExecStartTime(),this.execEndTime=this.execStartTime}},it=G?D.getGlobalScope():D.getCurrentScope(),ht=new As(it,Te);return ht.evaluate(I)}}Object.defineProperty(xo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function To(b){if(!(b instanceof so))throw new Error("Illegal call");for(var I=b.generator(),G=arguments.length,D=new Array(G>1?G-1:0),re=1;re<G;re++)D[re-1]=arguments[re];var Te=D.pop(),it=new As(I.getGlobalScope(),I.getOptions()),ht=`
		    (function anonymous(`+D.join(",")+`){
		        `+Te+`
		    });
		    `;return it.evaluate(ht)}Object.defineProperty(To,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var Ls=function(I){this.value=I},js=function(I){this.value=I},_u=function(I){this.value=I},xu=function(I,G,D){G===void 0&&(G=null),this.name=D,this.parent=G,this.data=I,this.labelStack=[]};function Mu(){}function Uo(b,I){return b===void 0&&(b=null),new xu(Object.create(null),b,I)}function Zo(b){return Object.create(b)}var Fa={NaN:NaN,Infinity:1/0,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:xo,Function:To};typeof JSON<"u"&&(Fa.JSON=JSON),typeof Promise<"u"&&(Fa.Promise=Promise),typeof Set<"u"&&(Fa.Set=Set),typeof Map<"u"&&(Fa.Map=Map),typeof Symbol<"u"&&(Fa.Symbol=Symbol),typeof Proxy<"u"&&(Fa.Proxy=Proxy),typeof WeakMap<"u"&&(Fa.WeakMap=WeakMap),typeof WeakSet<"u"&&(Fa.WeakSet=WeakSet),typeof Reflect<"u"&&(Fa.Reflect=Reflect);var As=function(){function b(G,D){G===void 0&&(G=b.global),D===void 0&&(D={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:D.ecmaVersion||b.ecmaVersion,timeout:D.timeout||0,rootContext:D.rootContext,globalContextInFunction:D.globalContextInFunction===void 0?b.globalContextInFunction:D.globalContextInFunction,_initEnv:D._initEnv},this.context=G||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var I=b.prototype;return I.initEnvironment=function(D){var re;if(D instanceof xu)re=D;else{var Te=null,it=this.createSuperScope(D);this.options.rootContext&&(Te=new xu(Zo(this.options.rootContext),it,ua)),re=new xu(D,Te||it,Jo)}this.globalScope=re,this.currentScope=this.globalScope,this.globalContext=re.data,this.currentContext=re.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var ht=this.options._initEnv;ht&&ht.call(this)},I.getExecStartTime=function(){return this.execStartTime},I.getExecutionTime=function(){return this.execEndTime-this.execStartTime},I.setExecTimeout=function(D){D===void 0&&(D=0),this.options.timeout=D},I.getOptions=function(){return this.options},I.getGlobalScope=function(){return this.globalScope},I.getCurrentScope=function(){return this.currentScope},I.getCurrentContext=function(){return this.currentContext},I.isInterruptThrow=function(D){return D instanceof gl||D instanceof ms||D instanceof oo},I.createSuperScope=function(D){var re=Object.assign({},Fa),Te=Object.keys(re);return Te.forEach(function(it){it in D&&delete re[it]}),new xu(re,null,jn)},I.setCurrentContext=function(D){this.currentContext=D},I.setCurrentScope=function(D){this.currentScope=D},I.evaluate=function(D){D===void 0&&(D="");var re;if(!!D)return re=Ya(D,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||b.ecmaVersion}),this.evaluateNode(re,D)},I.appendCode=function(D){return this.evaluate(D)},I.evaluateNode=function(D,re){var Te=this;re===void 0&&(re=""),this.value=void 0,this.source=re,this.sourceList.push(re),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var it=this.getCurrentScope(),ht=this.getCurrentContext(),Tt=it.labelStack.concat([]),_r=this.callStack.concat([]),br=function(){Te.setCurrentScope(it),Te.setCurrentContext(ht),it.labelStack=Tt,Te.callStack=_r};try{var si=this.createClosure(D);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),si()}catch(Ni){throw Ni}finally{br(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},I.createErrorMessage=function(D,re,Te){var it=D[1].replace("%0",String(re));return Te!==null&&(it+=this.getNodePosition(Te||this.lastExecNode)),it},I.createError=function(D,re){return new re(D)},I.createThrowError=function(D,re){return this.createError(D,re)},I.createInternalThrowError=function(D,re,Te){return this.createError(this.createErrorMessage(D,re,Te),D[2])},I.checkTimeout=function(){if(!this.isRunning)return!1;var D=this.options.timeout||0,re=Date.now();return re-this.execStartTime>D},I.getNodePosition=function(D){if(D){var re="";return D.loc?" ["+D.loc.start.line+":"+D.loc.start.column+"]"+re:""}return""},I.createClosure=function(D){var re=this,Te;switch(D.type){case"BinaryExpression":Te=this.binaryExpressionHandler(D);break;case"LogicalExpression":Te=this.logicalExpressionHandler(D);break;case"UnaryExpression":Te=this.unaryExpressionHandler(D);break;case"UpdateExpression":Te=this.updateExpressionHandler(D);break;case"ObjectExpression":Te=this.objectExpressionHandler(D);break;case"ArrayExpression":Te=this.arrayExpressionHandler(D);break;case"CallExpression":Te=this.callExpressionHandler(D);break;case"NewExpression":Te=this.newExpressionHandler(D);break;case"MemberExpression":Te=this.memberExpressionHandler(D);break;case"ThisExpression":Te=this.thisExpressionHandler(D);break;case"SequenceExpression":Te=this.sequenceExpressionHandler(D);break;case"Literal":Te=this.literalHandler(D);break;case"Identifier":Te=this.identifierHandler(D);break;case"AssignmentExpression":Te=this.assignmentExpressionHandler(D);break;case"FunctionDeclaration":Te=this.functionDeclarationHandler(D);break;case"VariableDeclaration":Te=this.variableDeclarationHandler(D);break;case"BlockStatement":case"Program":Te=this.programHandler(D);break;case"ExpressionStatement":Te=this.expressionStatementHandler(D);break;case"EmptyStatement":Te=this.emptyStatementHandler(D);break;case"ReturnStatement":Te=this.returnStatementHandler(D);break;case"FunctionExpression":Te=this.functionExpressionHandler(D);break;case"IfStatement":Te=this.ifStatementHandler(D);break;case"ConditionalExpression":Te=this.conditionalExpressionHandler(D);break;case"ForStatement":Te=this.forStatementHandler(D);break;case"WhileStatement":Te=this.whileStatementHandler(D);break;case"DoWhileStatement":Te=this.doWhileStatementHandler(D);break;case"ForInStatement":Te=this.forInStatementHandler(D);break;case"WithStatement":Te=this.withStatementHandler(D);break;case"ThrowStatement":Te=this.throwStatementHandler(D);break;case"TryStatement":Te=this.tryStatementHandler(D);break;case"ContinueStatement":Te=this.continueStatementHandler(D);break;case"BreakStatement":Te=this.breakStatementHandler(D);break;case"SwitchStatement":Te=this.switchStatementHandler(D);break;case"LabeledStatement":Te=this.labeledStatementHandler(D);break;case"DebuggerStatement":Te=this.debuggerStatementHandler(D);break;default:throw this.createInternalThrowError(Oa.NodeTypeSyntaxError,D.type,D)}return function(){var it=re.options.timeout;if(it&&it>0&&re.checkTimeout())throw re.createInternalThrowError(Oa.ExecutionTimeOutError,it,null);return re.lastExecNode=D,Te.apply(void 0,arguments)}},I.binaryExpressionHandler=function(D){var re=this,Te=this.createClosure(D.left),it=this.createClosure(D.right);return function(){var ht=Te(),Tt=it();switch(D.operator){case"==":return ht==Tt;case"!=":return ht!=Tt;case"===":return ht===Tt;case"!==":return ht!==Tt;case"<":return ht<Tt;case"<=":return ht<=Tt;case">":return ht>Tt;case">=":return ht>=Tt;case"<<":return ht<<Tt;case">>":return ht>>Tt;case">>>":return ht>>>Tt;case"+":return ht+Tt;case"-":return ht-Tt;case"*":return ht*Tt;case"**":return Math.pow(ht,Tt);case"/":return ht/Tt;case"%":return ht%Tt;case"|":return ht|Tt;case"^":return ht^Tt;case"&":return ht&Tt;case"in":return ht in Tt;case"instanceof":return ht instanceof Tt;default:throw re.createInternalThrowError(Oa.BinaryOperatorSyntaxError,D.operator,D)}}},I.logicalExpressionHandler=function(D){var re=this,Te=this.createClosure(D.left),it=this.createClosure(D.right);return function(){switch(D.operator){case"||":return Te()||it();case"&&":return Te()&&it();default:throw re.createInternalThrowError(Oa.LogicalOperatorSyntaxError,D.operator,D)}}},I.unaryExpressionHandler=function(D){var re=this;switch(D.operator){case"delete":var Te=this.createObjectGetter(D.argument),it=this.createNameGetter(D.argument);return function(){var br=Te(),si=it();return delete br[si]};default:var ht;if(D.operator==="typeof"&&D.argument.type==="Identifier"){var Tt=this.createObjectGetter(D.argument),_r=this.createNameGetter(D.argument);ht=function(){return Tt()[_r()]}}else ht=this.createClosure(D.argument);return function(){var br=ht();switch(D.operator){case"-":return-br;case"+":return+br;case"!":return!br;case"~":return~br;case"void":return;case"typeof":return typeof br;default:throw re.createInternalThrowError(Oa.UnaryOperatorSyntaxError,D.operator,D)}}}},I.updateExpressionHandler=function(D){var re=this,Te=this.createObjectGetter(D.argument),it=this.createNameGetter(D.argument);return function(){var ht=Te(),Tt=it();switch(re.assertVariable(ht,Tt,D),D.operator){case"++":return D.prefix?++ht[Tt]:ht[Tt]++;case"--":return D.prefix?--ht[Tt]:ht[Tt]--;default:throw re.createInternalThrowError(Oa.UpdateOperatorSyntaxError,D.operator,D)}}},I.objectExpressionHandler=function(D){var re=this,Te=[];function it(Tt){return Tt.type==="Identifier"?Tt.name:Tt.type==="Literal"?Tt.value:this.throwError(Oa.ObjectStructureSyntaxError,Tt.type,Tt)}var ht=Object.create(null);return D.properties.forEach(function(Tt){var _r=Tt.kind,br=it(Tt.key);(!ht[br]||_r==="init")&&(ht[br]={}),ht[br][_r]=re.createClosure(Tt.value),Te.push({key:br,property:Tt})}),function(){for(var Tt={},_r=Te.length,br=0;br<_r;br++){var si=Te[br],Ni=si.key,Di=ht[Ni],ia=Di.init?Di.init():void 0,Ga=Di.get?Di.get():function(){},uo=Di.set?Di.set():function(Wc){};if("set"in Di||"get"in Di){var ga={configurable:!0,enumerable:!0,get:Ga,set:uo};Object.defineProperty(Tt,Ni,ga)}else{var Ks=si.property,Zl=Ks.kind;Ks.key.type==="Identifier"&&Ks.value.type==="FunctionExpression"&&Zl==="init"&&!Ks.value.id&&el(ia,Ks.key.name),Tt[Ni]=ia}}return Tt}},I.arrayExpressionHandler=function(D){var re=this,Te=D.elements.map(function(it){return it&&re.createClosure(it)});return function(){for(var it=Te.length,ht=Array(it),Tt=0;Tt<it;Tt++){var _r=Te[Tt];_r&&(ht[Tt]=_r())}return ht}},I.safeObjectGet=function(D,re,Te){return D[re]},I.createCallFunctionGetter=function(D){var re=this;switch(D.type){case"MemberExpression":var Te=this.createClosure(D.object),it=this.createMemberKeyGetter(D),ht=this.source;return function(){var _r=Te(),br=it(),si=re.safeObjectGet(_r,br,D);if(!si||!Ta(si)){var Ni=ht.slice(D.start,D.end);throw re.createInternalThrowError(Oa.FunctionUndefinedReferenceError,Ni,D)}return si.__IS_EVAL_FUNC?function(Di){return si(new so(re),Di,!0)}:si.__IS_FUNCTION_FUNC?function(){for(var Di=arguments.length,ia=new Array(Di),Ga=0;Ga<Di;Ga++)ia[Ga]=arguments[Ga];return si.apply(void 0,[new so(re)].concat(ia))}:si.bind(_r)};default:var Tt=this.createClosure(D);return function(){var _r="";D.type==="Identifier"&&(_r=D.name);var br=Tt();if(!br||!Ta(br))throw re.createInternalThrowError(Oa.FunctionUndefinedReferenceError,_r,D);if(D.type==="Identifier"&&br.__IS_EVAL_FUNC&&_r==="eval")return function(Di){var ia=re.getScopeFromName(_r,re.getCurrentScope()),Ga=ia.name===jn||ia.name===Jo||ia.name===ua;return br(new so(re),Di,!Ga)};if(br.__IS_EVAL_FUNC)return function(Di){return br(new so(re),Di,!0)};if(br.__IS_FUNCTION_FUNC)return function(){for(var Di=arguments.length,ia=new Array(Di),Ga=0;Ga<Di;Ga++)ia[Ga]=arguments[Ga];return br.apply(void 0,[new so(re)].concat(ia))};var si=re.options.globalContextInFunction;if(D.type==="Identifier"){var Ni=re.getIdentifierScope(D);Ni.name===sn&&(si=Ni.data)}return br.bind(si)}}},I.callExpressionHandler=function(D){var re=this,Te=this.createCallFunctionGetter(D.callee),it=D.arguments.map(function(ht){return re.createClosure(ht)});return function(){return Te().apply(void 0,it.map(function(ht){return ht()}))}},I.functionExpressionHandler=function(D){var re=this,Te=this,it=this.source,ht=this.collectDeclVars,Tt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var _r=D.id?D.id.name:"",br=D.params.length,si=D.params.map(function(Ga){return re.createParamNameGetter(Ga)}),Ni=this.createClosure(D.body),Di=this.collectDeclVars,ia=this.collectDeclFuncs;return this.collectDeclVars=ht,this.collectDeclFuncs=Tt,function(){var Ga=Te.getCurrentScope(),uo=function ga(){for(var Ks=arguments.length,Zl=new Array(Ks),Wc=0;Wc<Ks;Wc++)Zl[Wc]=arguments[Wc];Te.callStack.push(""+_r);var Xc=Te.getCurrentScope(),Sc=Uo(Ga,"FunctionScope("+_r+")");Te.setCurrentScope(Sc),Te.addDeclarationsToScope(Di,ia,Sc),_r&&(Sc.data[_r]=ga),Sc.data.arguments=arguments,si.forEach(function(Vl,xl){Sc.data[Vl()]=Zl[xl]});var wc=Te.getCurrentContext();Te.setCurrentContext(this);var ku=Ni();if(Te.setCurrentContext(wc),Te.setCurrentScope(Xc),Te.callStack.pop(),ku instanceof Ls)return ku.value};return el(uo,_r),Object.defineProperty(uo,"length",{value:br,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(uo,"toString",{value:function(){return it.slice(D.start,D.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(uo,"valueOf",{value:function(){return it.slice(D.start,D.end)},writable:!0,configurable:!0,enumerable:!1}),uo}},I.newExpressionHandler=function(D){var re=this,Te=this.source,it=this.createClosure(D.callee),ht=D.arguments.map(function(Tt){return re.createClosure(Tt)});return function(){var Tt=it();if(!Ta(Tt)||Tt.__IS_EVAL_FUNC){var _r=D.callee,br=Te.slice(_r.start,_r.end);throw re.createInternalThrowError(Oa.IsNotConstructor,br,D)}return Tt.__IS_FUNCTION_FUNC?Tt.apply(void 0,[new so(re)].concat(ht.map(function(si){return si()}))):Ps(Tt,ht.map(function(si){return si()}))}},I.memberExpressionHandler=function(D){var re=this.createClosure(D.object),Te=this.createMemberKeyGetter(D);return function(){var it=re(),ht=Te();return it[ht]}},I.thisExpressionHandler=function(D){var re=this;return function(){return re.getCurrentContext()}},I.sequenceExpressionHandler=function(D){var re=this,Te=D.expressions.map(function(it){return re.createClosure(it)});return function(){for(var it,ht=Te.length,Tt=0;Tt<ht;Tt++){var _r=Te[Tt];it=_r()}return it}},I.literalHandler=function(D){return function(){return D.regex?new RegExp(D.regex.pattern,D.regex.flags):D.value}},I.identifierHandler=function(D){var re=this;return function(){var Te=re.getCurrentScope(),it=re.getScopeDataFromName(D.name,Te);return re.assertVariable(it,D.name,D),it[D.name]}},I.getIdentifierScope=function(D){var re=this.getCurrentScope(),Te=this.getScopeFromName(D.name,re);return Te},I.assignmentExpressionHandler=function(D){var re=this;D.left.type==="Identifier"&&D.right.type==="FunctionExpression"&&!D.right.id&&(D.right.id={type:"Identifier",name:D.left.name});var Te=this.createObjectGetter(D.left),it=this.createNameGetter(D.left),ht=this.createClosure(D.right);return function(){var Tt=Te(),_r=it(),br=ht();switch(D.operator!=="="&&re.assertVariable(Tt,_r,D),D.operator){case"=":return Tt[_r]=br;case"+=":return Tt[_r]+=br;case"-=":return Tt[_r]-=br;case"*=":return Tt[_r]*=br;case"**=":return Tt[_r]=Math.pow(Tt[_r],br);case"/=":return Tt[_r]/=br;case"%=":return Tt[_r]%=br;case"<<=":return Tt[_r]<<=br;case">>=":return Tt[_r]>>=br;case">>>=":return Tt[_r]>>>=br;case"&=":return Tt[_r]&=br;case"^=":return Tt[_r]^=br;case"|=":return Tt[_r]|=br;default:throw re.createInternalThrowError(Oa.AssignmentExpressionSyntaxError,D.type,D)}}},I.functionDeclarationHandler=function(D){if(D.id){var re=this.functionExpressionHandler(D);Object.defineProperty(re,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(D.id.name,re)}return function(){return Zt}},I.getVariableName=function(D){if(D.type==="Identifier")return D.name;throw this.createInternalThrowError(Oa.VariableTypeSyntaxError,D.type,D)},I.variableDeclarationHandler=function(D){for(var re=this,Te,it=[],ht=0;ht<D.declarations.length;ht++){var Tt=D.declarations[ht];this.varDeclaration(this.getVariableName(Tt.id)),Tt.init&&it.push({type:"AssignmentExpression",operator:"=",left:Tt.id,right:Tt.init})}return it.length&&(Te=this.createClosure({type:"BlockStatement",body:it})),function(){if(Te){var _r=re.isVarDeclMode;re.isVarDeclMode=!0,Te(),re.isVarDeclMode=_r}return Zt}},I.assertVariable=function(D,re,Te){if(D===this.globalScope.data&&!(re in D))throw this.createInternalThrowError(Oa.VariableUndefinedReferenceError,re,Te)},I.programHandler=function(D){var re=this,Te=D.body.map(function(it){return re.createClosure(it)});return function(){for(var it=Zt,ht=0;ht<Te.length;ht++){var Tt=Te[ht],_r=re.setValue(Tt());if(_r!==Zt&&(it=_r,it instanceof Ls||it instanceof js||it instanceof _u||it===fe||it===Me))break}return it}},I.expressionStatementHandler=function(D){return this.createClosure(D.expression)},I.emptyStatementHandler=function(D){return function(){return Zt}},I.returnStatementHandler=function(D){var re=D.argument?this.createClosure(D.argument):Mu;return function(){return new Ls(re())}},I.ifStatementHandler=function(D){var re=this.createClosure(D.test),Te=this.createClosure(D.consequent),it=D.alternate?this.createClosure(D.alternate):function(){return Zt};return function(){return re()?Te():it()}},I.conditionalExpressionHandler=function(D){return this.ifStatementHandler(D)},I.forStatementHandler=function(D){var re=this,Te=Mu,it=D.test?this.createClosure(D.test):function(){return!0},ht=Mu,Tt=this.createClosure(D.body);return D.type==="ForStatement"&&(Te=D.init?this.createClosure(D.init):Te,ht=D.update?this.createClosure(D.update):Mu),function(_r){var br,si=Zt,Ni=D.type==="DoWhileStatement";for(_r&&_r.type==="LabeledStatement"&&(br=_r.label.name),Te();Ni||it();ht()){Ni=!1;var Di=re.setValue(Tt());if(!(Di===Zt||Di===Me)){if(Di===fe)break;if(si=Di,si instanceof _u&&si.value===br){si=Zt;continue}if(si instanceof Ls||si instanceof js||si instanceof _u)break}}return si}},I.whileStatementHandler=function(D){return this.forStatementHandler(D)},I.doWhileStatementHandler=function(D){return this.forStatementHandler(D)},I.forInStatementHandler=function(D){var re=this,Te=D.left,it=this.createClosure(D.right),ht=this.createClosure(D.body);return D.left.type==="VariableDeclaration"&&(this.createClosure(D.left)(),Te=D.left.declarations[0].id),function(Tt){var _r,br=Zt,si;Tt&&Tt.type==="LabeledStatement"&&(_r=Tt.label.name);var Ni=it();for(si in Ni){re.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:Te,right:{type:"Literal",value:si}})();var Di=re.setValue(ht());if(!(Di===Zt||Di===Me)){if(Di===fe)break;if(br=Di,br instanceof _u&&br.value===_r){br=Zt;continue}if(br instanceof Ls||br instanceof js||br instanceof _u)break}}return br}},I.withStatementHandler=function(D){var re=this,Te=this.createClosure(D.object),it=this.createClosure(D.body);return function(){var ht=Te(),Tt=re.getCurrentScope(),_r=new xu(ht,Tt,sn);re.setCurrentScope(_r);var br=re.setValue(it());return re.setCurrentScope(Tt),br}},I.throwStatementHandler=function(D){var re=this,Te=this.createClosure(D.argument);return function(){throw re.setValue(void 0),Te()}},I.tryStatementHandler=function(D){var re=this,Te=this.createClosure(D.block),it=D.handler?this.catchClauseHandler(D.handler):null,ht=D.finalizer?this.createClosure(D.finalizer):null;return function(){var Tt=re.getCurrentScope(),_r=re.getCurrentContext(),br=Tt.labelStack.concat([]),si=re.callStack.concat([]),Ni=Zt,Di,ia,Ga=function(){re.setCurrentScope(Tt),re.setCurrentContext(_r),Tt.labelStack=br,re.callStack=si};try{Ni=re.setValue(Te()),Ni instanceof Ls&&(Di=Ni)}catch(uo){if(Ga(),re.isInterruptThrow(uo))throw uo;if(it)try{Ni=re.setValue(it(uo)),Ni instanceof Ls&&(Di=Ni)}catch(ga){if(Ga(),re.isInterruptThrow(ga))throw ga;ia=ga}}if(ht)try{Ni=ht(),Ni instanceof Ls&&(Di=Ni)}catch(uo){if(Ga(),re.isInterruptThrow(uo))throw uo;ia=uo}if(ia)throw ia;return Di||Ni}},I.catchClauseHandler=function(D){var re=this,Te=this.createParamNameGetter(D.param),it=this.createClosure(D.body);return function(ht){var Tt,_r=re.getCurrentScope(),br=_r.data,si=Te(),Ni=Wo.call(br,si),Di=br[si];return br[si]=ht,Tt=it(),Ni?br[si]=Di:delete br[si],Tt}},I.continueStatementHandler=function(D){return function(){return D.label?new _u(D.label.name):Me}},I.breakStatementHandler=function(D){return function(){return D.label?new js(D.label.name):fe}},I.switchStatementHandler=function(D){var re=this,Te=this.createClosure(D.discriminant),it=D.cases.map(function(ht){return re.switchCaseHandler(ht)});return function(){for(var ht=Te(),Tt=!1,_r,br,si,Ni=0;Ni<it.length;Ni++){var Di=it[Ni](),ia=Di.testClosure();if(ia===ut){si=Di;continue}if(Tt||ia===ht){if(Tt=!0,br=re.setValue(Di.bodyClosure()),br===Zt)continue;if(br===fe||(_r=br,_r instanceof Ls||_r instanceof js||_r instanceof _u||_r===Me))break}}if(!Tt&&si){br=re.setValue(si.bodyClosure());var Ga=br===Zt||br===fe||br===Me;Ga||(_r=br)}return _r}},I.switchCaseHandler=function(D){var re=D.test?this.createClosure(D.test):function(){return ut},Te=this.createClosure({type:"BlockStatement",body:D.consequent});return function(){return{testClosure:re,bodyClosure:Te}}},I.labeledStatementHandler=function(D){var re=this,Te=D.label.name,it=this.createClosure(D.body);return function(){var ht,Tt=re.getCurrentScope();return Tt.labelStack.push(Te),ht=it(D),ht instanceof js&&ht.value===Te&&(ht=Zt),Tt.labelStack.pop(),ht}},I.debuggerStatementHandler=function(D){return function(){debugger;return Zt}},I.createParamNameGetter=function(D){if(D.type==="Identifier")return function(){return D.name};throw this.createInternalThrowError(Oa.ParamTypeSyntaxError,D.type,D)},I.createObjectKeyGetter=function(D){var re;return D.type==="Identifier"?re=function(){return D.name}:re=this.createClosure(D),function(){return re()}},I.createMemberKeyGetter=function(D){return D.computed?this.createClosure(D.property):this.createObjectKeyGetter(D.property)},I.createObjectGetter=function(D){var re=this;switch(D.type){case"Identifier":return function(){return re.getScopeDataFromName(D.name,re.getCurrentScope())};case"MemberExpression":return this.createClosure(D.object);default:throw this.createInternalThrowError(Oa.AssignmentTypeSyntaxError,D.type,D)}},I.createNameGetter=function(D){switch(D.type){case"Identifier":return function(){return D.name};case"MemberExpression":return this.createMemberKeyGetter(D);default:throw this.createInternalThrowError(Oa.AssignmentTypeSyntaxError,D.type,D)}},I.varDeclaration=function(D){var re=this.collectDeclVars;re[D]=void 0},I.funcDeclaration=function(D,re){var Te=this.collectDeclFuncs;Te[D]=re},I.addDeclarationsToScope=function(D,re,Te){var it=Te.data;for(var ht in re){var Tt=re[ht];it[ht]=Tt&&Tt()}for(var _r in D)_r in it||(it[_r]=void 0)},I.getScopeValue=function(D,re){var Te=this.getScopeFromName(D,re);return Te.data[D]},I.getScopeDataFromName=function(D,re){return this.getScopeFromName(D,re).data},I.getScopeFromName=function(D,re){var Te=re;do if(D in Te.data)return Te;while(Te=Te.parent);return this.globalScope},I.setValue=function(D){var re=this.callStack.length;return this.isVarDeclMode||re||D===Zt||D===fe||D===Me||D instanceof js||D instanceof _u||(this.value=D instanceof Ls?D.value:D),D},I.getValue=function(){return this.value},b}();As.version=yu,As.eval=xo,As.Function=To,As.ecmaVersion=5,As.globalContextInFunction=void 0,As.global=Object.create(null);function Hu(b){return b===void 0&&(b=Object.create(null)),b}function Zh(b,I,G){I===void 0&&(I=[]),G===void 0&&(G={});var D=G.parsingContext,re=G.timeout===void 0?0:G.timeout,Te=`
    (function anonymous(`+I.join(",")+`){
         `+b+`
    });
    `,it=new As(D,{ecmaVersion:G.ecmaVersion,timeout:re,rootContext:G.rootContext,globalContextInFunction:G.globalContextInFunction});return it.evaluate(Te)}function Cc(b,I,G){var D=new As(I,G);return D.evaluate(b)}var Xf=Cc,yl=function(){function b(G){this._code=G}var I=b.prototype;return I.runInContext=function(D){return Cc(this._code,D)},I.runInNewContext=function(D){return Cc(this._code,D)},b}(),Hc=function(b,I,G){return Cc(b,I,G)};function _l(){for(var b=arguments.length,I=new Array(b),G=0;G<b;G++)I[G]=arguments[G];var D=I.pop();return Zh(D||"",I)}var gf=Hc},20396:function(Ja,ji,vt){var rr;(function(Ft,x,Jr,tt){"use strict";var Tr=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,rt=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u"),fr=Tr||rt,Xe=["","webkit","Moz","MS","ms","o"],Kt=fr?"":x.createElement("div"),hr="function",jt=Math.round,ar=Math.abs,ur=Date.now;function Ir(fe,Me,ut){return setTimeout(Rr(fe,ut),Me)}function Kn(fe,Me,ut){return Array.isArray(fe)?(On(fe,ut[Me],ut),!0):!1}function On(fe,Me,ut){var Zt;if(!!fe)if(fe.forEach)fe.forEach(Me,ut);else if(fe.length!==tt)for(Zt=0;Zt<fe.length;)Me.call(ut,fe[Zt],Zt,fe),Zt++;else for(Zt in fe)fe.hasOwnProperty(Zt)&&Me.call(ut,fe[Zt],Zt,fe)}function an(fe,Me,ut){var Zt="DEPRECATED METHOD: "+Me+`
`+ut+` AT 
`;return function(){var sn=new Error("get-stack-trace"),jn=sn&&sn.stack?sn.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",ua=Ft.console&&(Ft.console.warn||Ft.console.log);return ua&&ua.call(Ft.console,Zt,jn),fe.apply(this,arguments)}}var Pi;typeof Object.assign!="function"?Pi=function(Me){if(Me===tt||Me===null)throw new TypeError("Cannot convert undefined or null to object");for(var ut=Object(Me),Zt=1;Zt<arguments.length;Zt++){var sn=arguments[Zt];if(sn!==tt&&sn!==null)for(var jn in sn)sn.hasOwnProperty(jn)&&(ut[jn]=sn[jn])}return ut}:Pi=Object.assign;var ri=an(function(Me,ut,Zt){for(var sn=Object.keys(ut),jn=0;jn<sn.length;)(!Zt||Zt&&Me[sn[jn]]===tt)&&(Me[sn[jn]]=ut[sn[jn]]),jn++;return Me},"extend","Use `assign`."),me=an(function(Me,ut){return ri(Me,ut,!0)},"merge","Use `assign`.");function _i(fe,Me,ut){var Zt=Me.prototype,sn;sn=fe.prototype=Object.create(Zt),sn.constructor=fe,sn._super=Zt,ut&&Pi(sn,ut)}function Rr(fe,Me){return function(){return fe.apply(Me,arguments)}}function ir(fe,Me){return typeof fe==hr?fe.apply(Me&&Me[0]||tt,Me):fe}function zr(fe,Me){return fe===tt?Me:fe}function st(fe,Me,ut){On(Ee(Me),function(Zt){fe.addEventListener(Zt,ut,!1)})}function en(fe,Me,ut){On(Ee(Me),function(Zt){fe.removeEventListener(Zt,ut,!1)})}function Wn(fe,Me){for(;fe;){if(fe==Me)return!0;fe=fe.parentNode}return!1}function ce(fe,Me){return fe.indexOf(Me)>-1}function Ee(fe){return fe.trim().split(/\s+/g)}function Z(fe,Me,ut){if(fe.indexOf&&!ut)return fe.indexOf(Me);for(var Zt=0;Zt<fe.length;){if(ut&&fe[Zt][ut]==Me||!ut&&fe[Zt]===Me)return Zt;Zt++}return-1}function Ze(fe){return Array.prototype.slice.call(fe,0)}function Pe(fe,Me,ut){for(var Zt=[],sn=[],jn=0;jn<fe.length;){var ua=Me?fe[jn][Me]:fe[jn];Z(sn,ua)<0&&Zt.push(fe[jn]),sn[jn]=ua,jn++}return ut&&(Me?Zt=Zt.sort(function(Ta,so){return Ta[Me]>so[Me]}):Zt=Zt.sort()),Zt}function ft(fe,Me){for(var ut,Zt,sn=Me[0].toUpperCase()+Me.slice(1),jn=0;jn<Xe.length;){if(ut=Xe[jn],Zt=ut?ut+sn:Me,Zt in fe)return Zt;jn++}return tt}var It=1;function qt(){return It++}function yt(fe){var Me=fe.ownerDocument||fe;return Me.defaultView||Me.parentWindow||Ft}var cr=/mobile|tablet|ip(ad|hone|od)|android/i,Xn="ontouchstart"in Ft,Vn=ft(Ft,"PointerEvent")!==tt,Gi=Xn&&cr.test(navigator.userAgent),ai="touch",Rn="pen",Ba="mouse",oa="kinect",Ti=25,Ca=1,xi=2,Hi=4,vi=8,mi=1,ss=2,Po=4,ao=8,bt=16,pe=ss|Po,ie=ao|bt,Ce=pe|ie,V=["x","y"],We=["clientX","clientY"];function Gt(fe,Me){var ut=this;this.manager=fe,this.callback=Me,this.element=fe.element,this.target=fe.options.inputTarget,this.domHandler=function(Zt){ir(fe.options.enable,[fe])&&ut.handler(Zt)},this.init()}Gt.prototype={handler:function(){},init:function(){this.evEl&&st(this.element,this.evEl,this.domHandler),this.evTarget&&st(this.target,this.evTarget,this.domHandler),this.evWin&&st(yt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&en(this.element,this.evEl,this.domHandler),this.evTarget&&en(this.target,this.evTarget,this.domHandler),this.evWin&&en(yt(this.element),this.evWin,this.domHandler)}};function Vr(fe){var Me,ut=fe.options.inputClass;return ut?Me=ut:Vn?Me=Ne:Gi?Me=Yt:Xn?Me=Nt:Me=fa,new Me(fe,Mr)}function Mr(fe,Me,ut){var Zt=ut.pointers.length,sn=ut.changedPointers.length,jn=Me&Ca&&Zt-sn===0,ua=Me&(Hi|vi)&&Zt-sn===0;ut.isFirst=!!jn,ut.isFinal=!!ua,jn&&(fe.session={}),ut.eventType=Me,Yn(fe,ut),fe.emit("hammer.input",ut),fe.recognize(ut),fe.session.prevInput=ut}function Yn(fe,Me){var ut=fe.session,Zt=Me.pointers,sn=Zt.length;ut.firstInput||(ut.firstInput=Bn(Me)),sn>1&&!ut.firstMultiple?ut.firstMultiple=Bn(Me):sn===1&&(ut.firstMultiple=!1);var jn=ut.firstInput,ua=ut.firstMultiple,Jo=ua?ua.center:jn.center,Ta=Me.center=Fn(Zt);Me.timeStamp=ur(),Me.deltaTime=Me.timeStamp-jn.timeStamp,Me.angle=Lo(Jo,Ta),Me.distance=Yi(Jo,Ta),Fi(ut,Me),Me.offsetDirection=va(Me.deltaX,Me.deltaY);var so=eo(Me.deltaTime,Me.deltaX,Me.deltaY);Me.overallVelocityX=so.x,Me.overallVelocityY=so.y,Me.overallVelocity=ar(so.x)>ar(so.y)?so.x:so.y,Me.scale=ua?So(ua.pointers,Zt):1,Me.rotation=ua?to(ua.pointers,Zt):0,Me.maxPointers=ut.prevInput?Me.pointers.length>ut.prevInput.maxPointers?Me.pointers.length:ut.prevInput.maxPointers:Me.pointers.length,Qn(ut,Me);var xo=fe.element;Wn(Me.srcEvent.target,xo)&&(xo=Me.srcEvent.target),Me.target=xo}function Fi(fe,Me){var ut=Me.center,Zt=fe.offsetDelta||{},sn=fe.prevDelta||{},jn=fe.prevInput||{};(Me.eventType===Ca||jn.eventType===Hi)&&(sn=fe.prevDelta={x:jn.deltaX||0,y:jn.deltaY||0},Zt=fe.offsetDelta={x:ut.x,y:ut.y}),Me.deltaX=sn.x+(ut.x-Zt.x),Me.deltaY=sn.y+(ut.y-Zt.y)}function Qn(fe,Me){var ut=fe.lastInterval||Me,Zt=Me.timeStamp-ut.timeStamp,sn,jn,ua,Jo;if(Me.eventType!=vi&&(Zt>Ti||ut.velocity===tt)){var Ta=Me.deltaX-ut.deltaX,so=Me.deltaY-ut.deltaY,xo=eo(Zt,Ta,so);jn=xo.x,ua=xo.y,sn=ar(xo.x)>ar(xo.y)?xo.x:xo.y,Jo=va(Ta,so),fe.lastInterval=Me}else sn=ut.velocity,jn=ut.velocityX,ua=ut.velocityY,Jo=ut.direction;Me.velocity=sn,Me.velocityX=jn,Me.velocityY=ua,Me.direction=Jo}function Bn(fe){for(var Me=[],ut=0;ut<fe.pointers.length;)Me[ut]={clientX:jt(fe.pointers[ut].clientX),clientY:jt(fe.pointers[ut].clientY)},ut++;return{timeStamp:ur(),pointers:Me,center:Fn(Me),deltaX:fe.deltaX,deltaY:fe.deltaY}}function Fn(fe){var Me=fe.length;if(Me===1)return{x:jt(fe[0].clientX),y:jt(fe[0].clientY)};for(var ut=0,Zt=0,sn=0;sn<Me;)ut+=fe[sn].clientX,Zt+=fe[sn].clientY,sn++;return{x:jt(ut/Me),y:jt(Zt/Me)}}function eo(fe,Me,ut){return{x:Me/fe||0,y:ut/fe||0}}function va(fe,Me){return fe===Me?mi:ar(fe)>=ar(Me)?fe<0?ss:Po:Me<0?ao:bt}function Yi(fe,Me,ut){ut||(ut=V);var Zt=Me[ut[0]]-fe[ut[0]],sn=Me[ut[1]]-fe[ut[1]];return Math.sqrt(Zt*Zt+sn*sn)}function Lo(fe,Me,ut){ut||(ut=V);var Zt=Me[ut[0]]-fe[ut[0]],sn=Me[ut[1]]-fe[ut[1]];return Math.atan2(sn,Zt)*180/Math.PI}function to(fe,Me){return Lo(Me[1],Me[0],We)+Lo(fe[1],fe[0],We)}function So(fe,Me){return Yi(Me[0],Me[1],We)/Yi(fe[0],fe[1],We)}var Ji={mousedown:Ca,mousemove:xi,mouseup:Hi},ro="mousedown",hi="mousemove mouseup";function fa(){this.evEl=ro,this.evWin=hi,this.pressed=!1,Gt.apply(this,arguments)}_i(fa,Gt,{handler:function(Me){var ut=Ji[Me.type];ut&Ca&&Me.button===0&&(this.pressed=!0),ut&xi&&Me.which!==1&&(ut=Hi),this.pressed&&(ut&Hi&&(this.pressed=!1),this.callback(this.manager,ut,{pointers:[Me],changedPointers:[Me],pointerType:Ba,srcEvent:Me}))}});var $={pointerdown:Ca,pointermove:xi,pointerup:Hi,pointercancel:vi,pointerout:vi},ne={2:ai,3:Rn,4:Ba,5:oa},he="pointerdown",be="pointermove pointerup pointercancel";!fr&&Ft.MSPointerEvent&&!Ft.PointerEvent&&(he="MSPointerDown",be="MSPointerMove MSPointerUp MSPointerCancel");function Ne(){this.evEl=he,this.evWin=be,Gt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}_i(Ne,Gt,{handler:function(Me){var ut=this.store,Zt=!1,sn=Me.type.toLowerCase().replace("ms",""),jn=$[sn],ua=ne[Me.pointerType]||Me.pointerType,Jo=ua==ai,Ta=Z(ut,Me.pointerId,"pointerId");jn&Ca&&(Me.button===0||Jo)?Ta<0&&(ut.push(Me),Ta=ut.length-1):jn&(Hi|vi)&&(Zt=!0),!(Ta<0)&&(ut[Ta]=Me,this.callback(this.manager,jn,{pointers:ut,changedPointers:[Me],pointerType:ua,srcEvent:Me}),Zt&&ut.splice(Ta,1))}});var Ye={touchstart:Ca,touchmove:xi,touchend:Hi,touchcancel:vi},lt="touchstart",_e="touchstart touchmove touchend touchcancel";function je(){this.evTarget=lt,this.evWin=_e,this.started=!1,Gt.apply(this,arguments)}_i(je,Gt,{handler:function(Me){var ut=Ye[Me.type];if(ut===Ca&&(this.started=!0),!!this.started){var Zt=Mt.call(this,Me,ut);ut&(Hi|vi)&&Zt[0].length-Zt[1].length===0&&(this.started=!1),this.callback(this.manager,ut,{pointers:Zt[0],changedPointers:Zt[1],pointerType:ai,srcEvent:Me})}}});function Mt(fe,Me){var ut=Ze(fe.touches),Zt=Ze(fe.changedTouches);return Me&(Hi|vi)&&(ut=Pe(ut.concat(Zt),"identifier",!0)),[ut,Zt]}var Sr={touchstart:Ca,touchmove:xi,touchend:Hi,touchcancel:vi},zt="touchstart touchmove touchend touchcancel";function Yt(){this.evTarget=zt,this.targetIds={},Gt.apply(this,arguments)}_i(Yt,Gt,{handler:function(Me){var ut=Sr[Me.type],Zt=Lr.call(this,Me,ut);!Zt||this.callback(this.manager,ut,{pointers:Zt[0],changedPointers:Zt[1],pointerType:ai,srcEvent:Me})}});function Lr(fe,Me){var ut=Ze(fe.touches),Zt=this.targetIds;if(Me&(Ca|xi)&&ut.length===1)return Zt[ut[0].identifier]=!0,[ut,ut];var sn,jn,ua=Ze(fe.changedTouches),Jo=[],Ta=this.target;if(jn=ut.filter(function(so){return Wn(so.target,Ta)}),Me===Ca)for(sn=0;sn<jn.length;)Zt[jn[sn].identifier]=!0,sn++;for(sn=0;sn<ua.length;)Zt[ua[sn].identifier]&&Jo.push(ua[sn]),Me&(Hi|vi)&&delete Zt[ua[sn].identifier],sn++;if(!!Jo.length)return[Pe(jn.concat(Jo),"identifier",!0),Jo]}var $n=2500,vn=25;function Nt(){Gt.apply(this,arguments);var fe=Rr(this.handler,this);this.touch=new Yt(this.manager,fe),this.mouse=new fa(this.manager,fe),this.primaryTouch=null,this.lastTouches=[]}_i(Nt,Gt,{handler:function(Me,ut,Zt){var sn=Zt.pointerType==ai,jn=Zt.pointerType==Ba;if(!(jn&&Zt.sourceCapabilities&&Zt.sourceCapabilities.firesTouchEvents)){if(sn)pr.call(this,ut,Zt);else if(jn&&cn.call(this,Zt))return;this.callback(Me,ut,Zt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function pr(fe,Me){fe&Ca?(this.primaryTouch=Me.changedPointers[0].identifier,on.call(this,Me)):fe&(Hi|vi)&&on.call(this,Me)}function on(fe){var Me=fe.changedPointers[0];if(Me.identifier===this.primaryTouch){var ut={x:Me.clientX,y:Me.clientY};this.lastTouches.push(ut);var Zt=this.lastTouches,sn=function(){var jn=Zt.indexOf(ut);jn>-1&&Zt.splice(jn,1)};setTimeout(sn,$n)}}function cn(fe){for(var Me=fe.srcEvent.clientX,ut=fe.srcEvent.clientY,Zt=0;Zt<this.lastTouches.length;Zt++){var sn=this.lastTouches[Zt],jn=Math.abs(Me-sn.x),ua=Math.abs(ut-sn.y);if(jn<=vn&&ua<=vn)return!0}return!1}var $i=fr?tt:ft(Kt.style,"touchAction"),Cn=$i!==tt,xt="compute",St="auto",qi="manipulation",na="none",ea="pan-x",oi="pan-y",Zi=lr();function fo(fe,Me){this.manager=fe,this.set(Me)}fo.prototype={set:function(fe){fe==xt&&(fe=this.compute()),Cn&&this.manager.element.style&&Zi[fe]&&(this.manager.element.style[$i]=fe),this.actions=fe.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var fe=[];return On(this.manager.recognizers,function(Me){ir(Me.options.enable,[Me])&&(fe=fe.concat(Me.getTouchAction()))}),mr(fe.join(" "))},preventDefaults:function(fe){var Me=fe.srcEvent,ut=fe.offsetDirection;if(this.manager.session.prevented){Me.preventDefault();return}var Zt=this.actions,sn=ce(Zt,na)&&!Zi[na],jn=ce(Zt,oi)&&!Zi[oi],ua=ce(Zt,ea)&&!Zi[ea];if(sn){var Jo=fe.pointers.length===1,Ta=fe.distance<2,so=fe.deltaTime<250;if(Jo&&Ta&&so)return}if(!(ua&&jn)&&(sn||jn&&ut&pe||ua&&ut&ie))return this.preventSrc(Me)},preventSrc:function(fe){this.manager.session.prevented=!0,fe.preventDefault()}};function mr(fe){if(ce(fe,na))return na;var Me=ce(fe,ea),ut=ce(fe,oi);return Me&&ut?na:Me||ut?Me?ea:oi:ce(fe,qi)?qi:St}function lr(){if(!Cn)return!1;var fe={};if(fr)return fe;var Me=Ft.CSS&&Ft.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ut){fe[ut]=Me?Ft.CSS.supports("touch-action",ut):!0}),fe}var nt=1,Ya=2,dt=4,wo=8,qa=wo,lu=16,No=32;function Li(fe){this.options=Pi({},this.defaults,fe||{}),this.id=qt(),this.manager=null,this.options.enable=zr(this.options.enable,!0),this.state=nt,this.simultaneous={},this.requireFail=[]}Li.prototype={defaults:{},set:function(fe){return Pi(this.options,fe),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(fe){if(Kn(fe,"recognizeWith",this))return this;var Me=this.simultaneous;return fe=Ao(fe,this),Me[fe.id]||(Me[fe.id]=fe,fe.recognizeWith(this)),this},dropRecognizeWith:function(fe){return Kn(fe,"dropRecognizeWith",this)?this:(fe=Ao(fe,this),delete this.simultaneous[fe.id],this)},requireFailure:function(fe){if(Kn(fe,"requireFailure",this))return this;var Me=this.requireFail;return fe=Ao(fe,this),Z(Me,fe)===-1&&(Me.push(fe),fe.requireFailure(this)),this},dropRequireFailure:function(fe){if(Kn(fe,"dropRequireFailure",this))return this;fe=Ao(fe,this);var Me=Z(this.requireFail,fe);return Me>-1&&this.requireFail.splice(Me,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(fe){return!!this.simultaneous[fe.id]},emit:function(fe){var Me=this,ut=this.state;function Zt(sn){Me.manager.emit(sn,fe)}ut<wo&&Zt(Me.options.event+ic(ut)),Zt(Me.options.event),fe.additionalEvent&&Zt(fe.additionalEvent),ut>=wo&&Zt(Me.options.event+ic(ut))},tryEmit:function(fe){if(this.canEmit())return this.emit(fe);this.state=No},canEmit:function(){for(var fe=0;fe<this.requireFail.length;){if(!(this.requireFail[fe].state&(No|nt)))return!1;fe++}return!0},recognize:function(fe){var Me=Pi({},fe);if(!ir(this.options.enable,[this,Me])){this.reset(),this.state=No;return}this.state&(qa|lu|No)&&(this.state=nt),this.state=this.process(Me),this.state&(Ya|dt|wo|lu)&&this.tryEmit(Me)},process:function(fe){},getTouchAction:function(){},reset:function(){}};function ic(fe){return fe&lu?"cancel":fe&wo?"end":fe&dt?"move":fe&Ya?"start":""}function Aa(fe){return fe==bt?"down":fe==ao?"up":fe==ss?"left":fe==Po?"right":""}function Ao(fe,Me){var ut=Me.manager;return ut?ut.get(fe):fe}function Ho(){Li.apply(this,arguments)}_i(Ho,Li,{defaults:{pointers:1},attrTest:function(fe){var Me=this.options.pointers;return Me===0||fe.pointers.length===Me},process:function(fe){var Me=this.state,ut=fe.eventType,Zt=Me&(Ya|dt),sn=this.attrTest(fe);return Zt&&(ut&vi||!sn)?Me|lu:Zt||sn?ut&Hi?Me|wo:Me&Ya?Me|dt:Ya:No}});function pa(){Ho.apply(this,arguments),this.pX=null,this.pY=null}_i(pa,Ho,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ce},getTouchAction:function(){var fe=this.options.direction,Me=[];return fe&pe&&Me.push(oi),fe&ie&&Me.push(ea),Me},directionTest:function(fe){var Me=this.options,ut=!0,Zt=fe.distance,sn=fe.direction,jn=fe.deltaX,ua=fe.deltaY;return sn&Me.direction||(Me.direction&pe?(sn=jn===0?mi:jn<0?ss:Po,ut=jn!=this.pX,Zt=Math.abs(fe.deltaX)):(sn=ua===0?mi:ua<0?ao:bt,ut=ua!=this.pY,Zt=Math.abs(fe.deltaY))),fe.direction=sn,ut&&Zt>Me.threshold&&sn&Me.direction},attrTest:function(fe){return Ho.prototype.attrTest.call(this,fe)&&(this.state&Ya||!(this.state&Ya)&&this.directionTest(fe))},emit:function(fe){this.pX=fe.deltaX,this.pY=fe.deltaY;var Me=Aa(fe.direction);Me&&(fe.additionalEvent=this.options.event+Me),this._super.emit.call(this,fe)}});function ws(){Ho.apply(this,arguments)}_i(ws,Ho,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[na]},attrTest:function(fe){return this._super.attrTest.call(this,fe)&&(Math.abs(fe.scale-1)>this.options.threshold||this.state&Ya)},emit:function(fe){if(fe.scale!==1){var Me=fe.scale<1?"in":"out";fe.additionalEvent=this.options.event+Me}this._super.emit.call(this,fe)}});function Vs(){Li.apply(this,arguments),this._timer=null,this._input=null}_i(Vs,Li,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[St]},process:function(fe){var Me=this.options,ut=fe.pointers.length===Me.pointers,Zt=fe.distance<Me.threshold,sn=fe.deltaTime>Me.time;if(this._input=fe,!Zt||!ut||fe.eventType&(Hi|vi)&&!sn)this.reset();else if(fe.eventType&Ca)this.reset(),this._timer=Ir(function(){this.state=qa,this.tryEmit()},Me.time,this);else if(fe.eventType&Hi)return qa;return No},reset:function(){clearTimeout(this._timer)},emit:function(fe){this.state===qa&&(fe&&fe.eventType&Hi?this.manager.emit(this.options.event+"up",fe):(this._input.timeStamp=ur(),this.manager.emit(this.options.event,this._input)))}});function gl(){Ho.apply(this,arguments)}_i(gl,Ho,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[na]},attrTest:function(fe){return this._super.attrTest.call(this,fe)&&(Math.abs(fe.rotation)>this.options.threshold||this.state&Ya)}});function oo(){Ho.apply(this,arguments)}_i(oo,Ho,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:pe|ie,pointers:1},getTouchAction:function(){return pa.prototype.getTouchAction.call(this)},attrTest:function(fe){var Me=this.options.direction,ut;return Me&(pe|ie)?ut=fe.overallVelocity:Me&pe?ut=fe.overallVelocityX:Me&ie&&(ut=fe.overallVelocityY),this._super.attrTest.call(this,fe)&&Me&fe.offsetDirection&&fe.distance>this.options.threshold&&fe.maxPointers==this.options.pointers&&ar(ut)>this.options.velocity&&fe.eventType&Hi},emit:function(fe){var Me=Aa(fe.offsetDirection);Me&&this.manager.emit(this.options.event+Me,fe),this.manager.emit(this.options.event,fe)}});function ms(){Li.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}_i(ms,Li,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[qi]},process:function(fe){var Me=this.options,ut=fe.pointers.length===Me.pointers,Zt=fe.distance<Me.threshold,sn=fe.deltaTime<Me.time;if(this.reset(),fe.eventType&Ca&&this.count===0)return this.failTimeout();if(Zt&&sn&&ut){if(fe.eventType!=Hi)return this.failTimeout();var jn=this.pTime?fe.timeStamp-this.pTime<Me.interval:!0,ua=!this.pCenter||Yi(this.pCenter,fe.center)<Me.posThreshold;this.pTime=fe.timeStamp,this.pCenter=fe.center,!ua||!jn?this.count=1:this.count+=1,this._input=fe;var Jo=this.count%Me.taps;if(Jo===0)return this.hasRequireFailures()?(this._timer=Ir(function(){this.state=qa,this.tryEmit()},Me.interval,this),Ya):qa}return No},failTimeout:function(){return this._timer=Ir(function(){this.state=No},this.options.interval,this),No},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==qa&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Oa(fe,Me){return Me=Me||{},Me.recognizers=zr(Me.recognizers,Oa.defaults.preset),new zo(fe,Me)}Oa.VERSION="2.0.7",Oa.defaults={domEvents:!1,touchAction:xt,enable:!0,inputTarget:null,inputClass:null,preset:[[gl,{enable:!1}],[ws,{enable:!1},["rotate"]],[oo,{direction:pe}],[pa,{direction:pe},["swipe"]],[ms],[ms,{event:"doubletap",taps:2},["tap"]],[Vs]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Ro=1,Ps=2;function zo(fe,Me){this.options=Pi({},Oa.defaults,Me||{}),this.options.inputTarget=this.options.inputTarget||fe,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=fe,this.input=Vr(this),this.touchAction=new fo(this,this.options.touchAction),yu(this,!0),On(this.options.recognizers,function(ut){var Zt=this.add(new ut[0](ut[1]));ut[2]&&Zt.recognizeWith(ut[2]),ut[3]&&Zt.requireFailure(ut[3])},this)}zo.prototype={set:function(fe){return Pi(this.options,fe),fe.touchAction&&this.touchAction.update(),fe.inputTarget&&(this.input.destroy(),this.input.target=fe.inputTarget,this.input.init()),this},stop:function(fe){this.session.stopped=fe?Ps:Ro},recognize:function(fe){var Me=this.session;if(!Me.stopped){this.touchAction.preventDefaults(fe);var ut,Zt=this.recognizers,sn=Me.curRecognizer;(!sn||sn&&sn.state&qa)&&(sn=Me.curRecognizer=null);for(var jn=0;jn<Zt.length;)ut=Zt[jn],Me.stopped!==Ps&&(!sn||ut==sn||ut.canRecognizeWith(sn))?ut.recognize(fe):ut.reset(),!sn&&ut.state&(Ya|dt|wo)&&(sn=Me.curRecognizer=ut),jn++}},get:function(fe){if(fe instanceof Li)return fe;for(var Me=this.recognizers,ut=0;ut<Me.length;ut++)if(Me[ut].options.event==fe)return Me[ut];return null},add:function(fe){if(Kn(fe,"add",this))return this;var Me=this.get(fe.options.event);return Me&&this.remove(Me),this.recognizers.push(fe),fe.manager=this,this.touchAction.update(),fe},remove:function(fe){if(Kn(fe,"remove",this))return this;if(fe=this.get(fe),fe){var Me=this.recognizers,ut=Z(Me,fe);ut!==-1&&(Me.splice(ut,1),this.touchAction.update())}return this},on:function(fe,Me){if(fe!==tt&&Me!==tt){var ut=this.handlers;return On(Ee(fe),function(Zt){ut[Zt]=ut[Zt]||[],ut[Zt].push(Me)}),this}},off:function(fe,Me){if(fe!==tt){var ut=this.handlers;return On(Ee(fe),function(Zt){Me?ut[Zt]&&ut[Zt].splice(Z(ut[Zt],Me),1):delete ut[Zt]}),this}},emit:function(fe,Me){this.options.domEvents&&el(fe,Me);var ut=this.handlers[fe]&&this.handlers[fe].slice();if(!(!ut||!ut.length)){Me.type=fe,Me.preventDefault=function(){Me.srcEvent.preventDefault()};for(var Zt=0;Zt<ut.length;)ut[Zt](Me),Zt++}},destroy:function(){this.element&&yu(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function yu(fe,Me){var ut=fe.element;if(!!ut.style){var Zt;On(fe.options.cssProps,function(sn,jn){Zt=ft(ut.style,jn),Me?(fe.oldCssProps[Zt]=ut.style[Zt],ut.style[Zt]=sn):ut.style[Zt]=fe.oldCssProps[Zt]||""}),Me||(fe.oldCssProps={})}}function el(fe,Me){if(!fr){var ut=x.createEvent("Event");ut.initEvent(fe,!0,!0),ut.gesture=Me,Me.target.dispatchEvent(ut)}}if(!fr){Pi(Oa,{INPUT_START:Ca,INPUT_MOVE:xi,INPUT_END:Hi,INPUT_CANCEL:vi,STATE_POSSIBLE:nt,STATE_BEGAN:Ya,STATE_CHANGED:dt,STATE_ENDED:wo,STATE_RECOGNIZED:qa,STATE_CANCELLED:lu,STATE_FAILED:No,DIRECTION_NONE:mi,DIRECTION_LEFT:ss,DIRECTION_RIGHT:Po,DIRECTION_UP:ao,DIRECTION_DOWN:bt,DIRECTION_HORIZONTAL:pe,DIRECTION_VERTICAL:ie,DIRECTION_ALL:Ce,Manager:zo,Input:Gt,TouchAction:fo,TouchInput:Yt,MouseInput:fa,PointerEventInput:Ne,TouchMouseInput:Nt,SingleTouchInput:je,Recognizer:Li,AttrRecognizer:Ho,Tap:ms,Pan:pa,Swipe:oo,Pinch:ws,Rotate:gl,Press:Vs,on:st,off:en,each:On,merge:me,extend:ri,assign:Pi,inherit:_i,bindFn:Rr,prefixed:ft});var Wo=typeof window<"u"?window:typeof self<"u"?self:{};Wo.Hammer=Oa,rr=function(){return Oa}.call(ji,vt,ji,Ja),rr!==tt&&(Ja.exports=rr)}})(typeof window<"u"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Ja,ji,vt){(function(rr,Ft){Ja.exports=Ft(vt(77736))})(this,function(rr){"use strict";var Ft=function(H){return H instanceof Uint8Array||H instanceof Uint16Array||H instanceof Uint32Array||H instanceof Int8Array||H instanceof Int16Array||H instanceof Int32Array||H instanceof Float32Array||H instanceof Float64Array||H instanceof Uint8ClampedArray},x=function(H,Se){for(var He=Object.keys(Se),Ht=0;Ht<He.length;++Ht)H[He[Ht]]=Se[He[Ht]];return H},Jr=`
`;function tt(H){return typeof atob<"u"?atob(H):"base64:"+H}function Tr(H){var Se=new Error("(regl) "+H);throw console.error(Se),Se}function rt(H,Se){H||Tr(Se)}function fr(H){return H?": "+H:""}function Xe(H,Se,He){H in Se||Tr("unknown parameter ("+H+")"+fr(He)+". possible values: "+Object.keys(Se).join())}function Kt(H,Se){Ft(H)||Tr("invalid parameter type"+fr(Se)+". must be a typed array")}function hr(H,Se){switch(Se){case"number":return typeof H=="number";case"object":return typeof H=="object";case"string":return typeof H=="string";case"boolean":return typeof H=="boolean";case"function":return typeof H=="function";case"undefined":return typeof H>"u";case"symbol":return typeof H=="symbol"}}function jt(H,Se,He){hr(H,Se)||Tr("invalid parameter type"+fr(He)+". expected "+Se+", got "+typeof H)}function ar(H,Se){H>=0&&(H|0)===H||Tr("invalid parameter type, ("+H+")"+fr(Se)+". must be a nonnegative integer")}function ur(H,Se,He){Se.indexOf(H)<0&&Tr("invalid value"+fr(He)+". must be one of: "+Se)}var Ir=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Kn(H){Object.keys(H).forEach(function(Se){Ir.indexOf(Se)<0&&Tr('invalid regl constructor argument "'+Se+'". must be one of '+Ir)})}function On(H,Se){for(H=H+"";H.length<Se;)H=" "+H;return H}function an(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Pi(H,Se){this.number=H,this.line=Se,this.errors=[]}function ri(H,Se,He){this.file=H,this.line=Se,this.message=He}function me(){var H=new Error,Se=(H.stack||H).toString(),He=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Se);if(He)return He[1];var Ht=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Se);return Ht?Ht[1]:"unknown"}function _i(){var H=new Error,Se=(H.stack||H).toString(),He=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Se);if(He)return He[1];var Ht=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Se);return Ht?Ht[1]:"unknown"}function Rr(H,Se){var He=H.split(`
`),Ht=1,Er=0,Vt={unknown:new an,0:new an};Vt.unknown.name=Vt[0].name=Se||me(),Vt.unknown.lines.push(new Pi(0,""));for(var sr=0;sr<He.length;++sr){var kr=He[sr],Dr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(kr);if(Dr)switch(Dr[1]){case"line":var jr=/(\d+)(\s+\d+)?/.exec(Dr[2]);jr&&(Ht=jr[1]|0,jr[2]&&(Er=jr[2]|0,Er in Vt||(Vt[Er]=new an)));break;case"define":var qr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Dr[2]);qr&&(Vt[Er].name=qr[1]?tt(qr[2]):qr[2]);break}Vt[Er].lines.push(new Pi(Ht++,kr))}return Object.keys(Vt).forEach(function($r){var gn=Vt[$r];gn.lines.forEach(function(Zr){gn.index[Zr.number]=Zr})}),Vt}function ir(H){var Se=[];return H.split(`
`).forEach(function(He){if(!(He.length<5)){var Ht=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(He);Ht?Se.push(new ri(Ht[1]|0,Ht[2]|0,Ht[3].trim())):He.length>0&&Se.push(new ri("unknown",0,He))}}),Se}function zr(H,Se){Se.forEach(function(He){var Ht=H[He.file];if(Ht){var Er=Ht.index[He.line];if(Er){Er.errors.push(He),Ht.hasErrors=!0;return}}H.unknown.hasErrors=!0,H.unknown.lines[0].errors.push(He)})}function st(H,Se,He,Ht,Er){if(!H.getShaderParameter(Se,H.COMPILE_STATUS)){var Vt=H.getShaderInfoLog(Se),sr=Ht===H.FRAGMENT_SHADER?"fragment":"vertex";Pe(He,"string",sr+" shader source must be a string",Er);var kr=Rr(He,Er),Dr=ir(Vt);zr(kr,Dr),Object.keys(kr).forEach(function(jr){var qr=kr[jr];if(!qr.hasErrors)return;var $r=[""],gn=[""];function Zr(Xr,Ct){$r.push(Xr),gn.push(Ct||"")}Zr("file number "+jr+": "+qr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),qr.lines.forEach(function(Xr){if(Xr.errors.length>0){Zr(On(Xr.number,4)+"|  ","background-color:yellow; font-weight:bold"),Zr(Xr.line+Jr,"color:red; background-color:yellow; font-weight:bold");var Ct=0;Xr.errors.forEach(function(er){var Gr=er.message,fn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Gr);if(fn){var wr=fn[1];switch(Gr=fn[2],wr){case"assign":wr="=";break}Ct=Math.max(Xr.line.indexOf(wr,Ct),0)}else Ct=0;Zr(On("| ",6)),Zr(On("^^^",Ct+3)+Jr,"font-weight:bold"),Zr(On("| ",6)),Zr(Gr+Jr,"font-weight:bold")}),Zr(On("| ",6)+Jr)}else Zr(On(Xr.number,4)+"|  "),Zr(Xr.line+Jr,"color:red")}),typeof document<"u"&&!window.chrome?(gn[0]=$r.join("%c"),console.log.apply(console,gn)):console.log($r.join(""))}),rt.raise("Error compiling "+sr+" shader, "+kr[0].name)}}function en(H,Se,He,Ht,Er){if(!H.getProgramParameter(Se,H.LINK_STATUS)){var Vt=H.getProgramInfoLog(Se),sr=Rr(He,Er),kr=Rr(Ht,Er),Dr='Error linking program with vertex shader, "'+kr[0].name+'", and fragment shader "'+sr[0].name+'"';typeof document<"u"?console.log("%c"+Dr+Jr+"%c"+Vt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Dr+Jr+Vt),rt.raise(Dr)}}function Wn(H){H._commandRef=me()}function ce(H,Se,He,Ht){Wn(H);function Er(Dr){return Dr?Ht.id(Dr):0}H._fragId=Er(H.static.frag),H._vertId=Er(H.static.vert);function Vt(Dr,jr){Object.keys(jr).forEach(function(qr){Dr[Ht.id(qr)]=!0})}var sr=H._uniformSet={};Vt(sr,Se.static),Vt(sr,Se.dynamic);var kr=H._attributeSet={};Vt(kr,He.static),Vt(kr,He.dynamic),H._hasCount="count"in H.static||"count"in H.dynamic||"elements"in H.static||"elements"in H.dynamic}function Ee(H,Se){var He=_i();Tr(H+" in command "+(Se||me())+(He==="unknown"?"":" called from "+He))}function Z(H,Se,He){H||Ee(Se,He||me())}function Ze(H,Se,He,Ht){H in Se||Ee("unknown parameter ("+H+")"+fr(He)+". possible values: "+Object.keys(Se).join(),Ht||me())}function Pe(H,Se,He,Ht){hr(H,Se)||Ee("invalid parameter type"+fr(He)+". expected "+Se+", got "+typeof H,Ht||me())}function ft(H){H()}function It(H,Se,He){H.texture?ur(H.texture._texture.internalformat,Se,"unsupported texture format for attachment"):ur(H.renderbuffer._renderbuffer.format,He,"unsupported renderbuffer format for attachment")}var qt=33071,yt=9728,cr=9984,Xn=9985,Vn=9986,Gi=9987,ai=5120,Rn=5121,Ba=5122,oa=5123,Ti=5124,Ca=5125,xi=5126,Hi=32819,vi=32820,mi=33635,ss=34042,Po=36193,ao={};ao[ai]=ao[Rn]=1,ao[Ba]=ao[oa]=ao[Po]=ao[mi]=ao[Hi]=ao[vi]=2,ao[Ti]=ao[Ca]=ao[xi]=ao[ss]=4;function bt(H,Se){return H===vi||H===Hi||H===mi?2:H===ss?4:ao[H]*Se}function pe(H){return!(H&H-1)&&!!H}function ie(H,Se,He){var Ht,Er=Se.width,Vt=Se.height,sr=Se.channels;rt(Er>0&&Er<=He.maxTextureSize&&Vt>0&&Vt<=He.maxTextureSize,"invalid texture shape"),(H.wrapS!==qt||H.wrapT!==qt)&&rt(pe(Er)&&pe(Vt),"incompatible wrap mode for texture, both width and height must be power of 2"),Se.mipmask===1?Er!==1&&Vt!==1&&rt(H.minFilter!==cr&&H.minFilter!==Vn&&H.minFilter!==Xn&&H.minFilter!==Gi,"min filter requires mipmap"):(rt(pe(Er)&&pe(Vt),"texture must be a square power of 2 to support mipmapping"),rt(Se.mipmask===(Er<<1)-1,"missing or incomplete mipmap data")),Se.type===xi&&(He.extensions.indexOf("oes_texture_float_linear")<0&&rt(H.minFilter===yt&&H.magFilter===yt,"filter not supported, must enable oes_texture_float_linear"),rt(!H.genMipmaps,"mipmap generation not supported with float textures"));var kr=Se.images;for(Ht=0;Ht<16;++Ht)if(kr[Ht]){var Dr=Er>>Ht,jr=Vt>>Ht;rt(Se.mipmask&1<<Ht,"missing mipmap data");var qr=kr[Ht];if(rt(qr.width===Dr&&qr.height===jr,"invalid shape for mip images"),rt(qr.format===Se.format&&qr.internalformat===Se.internalformat&&qr.type===Se.type,"incompatible type for mip image"),!qr.compressed)if(qr.data){var $r=Math.ceil(bt(qr.type,sr)*Dr/qr.unpackAlignment)*qr.unpackAlignment;rt(qr.data.byteLength===$r*jr,"invalid data for image, buffer size is inconsistent with image format")}else qr.element||qr.copy}else H.genMipmaps||rt((Se.mipmask&1<<Ht)===0,"extra mipmap data");Se.compressed&&rt(!H.genMipmaps,"mipmap generation for compressed images not supported")}function Ce(H,Se,He,Ht){var Er=H.width,Vt=H.height,sr=H.channels;rt(Er>0&&Er<=Ht.maxTextureSize&&Vt>0&&Vt<=Ht.maxTextureSize,"invalid texture shape"),rt(Er===Vt,"cube map must be square"),rt(Se.wrapS===qt&&Se.wrapT===qt,"wrap mode not supported by cube map");for(var kr=0;kr<He.length;++kr){var Dr=He[kr];rt(Dr.width===Er&&Dr.height===Vt,"inconsistent cube map face shape"),Se.genMipmaps&&(rt(!Dr.compressed,"can not generate mipmap for compressed textures"),rt(Dr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var jr=Dr.images,qr=0;qr<16;++qr){var $r=jr[qr];if($r){var gn=Er>>qr,Zr=Vt>>qr;rt(Dr.mipmask&1<<qr,"missing mipmap data"),rt($r.width===gn&&$r.height===Zr,"invalid shape for mip images"),rt($r.format===H.format&&$r.internalformat===H.internalformat&&$r.type===H.type,"incompatible type for mip image"),$r.compressed||($r.data?rt($r.data.byteLength===gn*Zr*Math.max(bt($r.type,sr),$r.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):$r.element||$r.copy)}}}}var V=x(rt,{optional:ft,raise:Tr,commandRaise:Ee,command:Z,parameter:Xe,commandParameter:Ze,constructor:Kn,type:jt,commandType:Pe,isTypedArray:Kt,nni:ar,oneOf:ur,shaderError:st,linkError:en,callSite:_i,saveCommandRef:Wn,saveDrawInfo:ce,framebufferFormat:It,guessCommand:me,texture2D:ie,textureCube:Ce}),We=0,Gt=0,Vr=5,Mr=6;function Yn(H,Se){this.id=We++,this.type=H,this.data=Se}function Fi(H){return H.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Qn(H){if(H.length===0)return[];var Se=H.charAt(0),He=H.charAt(H.length-1);if(H.length>1&&Se===He&&(Se==='"'||Se==="'"))return['"'+Fi(H.substr(1,H.length-2))+'"'];var Ht=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(H);if(Ht)return Qn(H.substr(0,Ht.index)).concat(Qn(Ht[1])).concat(Qn(H.substr(Ht.index+Ht[0].length)));var Er=H.split(".");if(Er.length===1)return['"'+Fi(H)+'"'];for(var Vt=[],sr=0;sr<Er.length;++sr)Vt=Vt.concat(Qn(Er[sr]));return Vt}function Bn(H){return"["+Qn(H).join("][")+"]"}function Fn(H,Se){return new Yn(H,Bn(Se+""))}function eo(H){return typeof H=="function"&&!H._reglType||H instanceof Yn}function va(H,Se){if(typeof H=="function")return new Yn(Gt,H);if(typeof H=="number"||typeof H=="boolean")return new Yn(Vr,H);if(Array.isArray(H))return new Yn(Mr,H.map(function(He,Ht){return va(He,Se+"["+Ht+"]")}));if(H instanceof Yn)return H;V(!1,"invalid option type in uniform "+Se)}var Yi={DynamicVariable:Yn,define:Fn,isDynamic:eo,unbox:va,accessor:Bn},Lo={next:typeof requestAnimationFrame=="function"?function(H){return requestAnimationFrame(H)}:function(H){return setTimeout(H,16)},cancel:typeof cancelAnimationFrame=="function"?function(H){return cancelAnimationFrame(H)}:clearTimeout},to=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,So=to?function(){return+new Date}:typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Ji(){var H={"":0},Se=[""];return{id:function(He){var Ht=H[He];return Ht||(Ht=H[He]=Se.length,Se.push(He),Ht)},str:function(He){return Se[He]}}}function ro(H,Se,He){var Ht=document.createElement("canvas");x(Ht.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),H.appendChild(Ht),H===document.body&&(Ht.style.position="absolute",x(H.style,{margin:0,padding:0}));function Er(){var kr=window.innerWidth,Dr=window.innerHeight;if(H!==document.body){var jr=Ht.getBoundingClientRect();kr=jr.right-jr.left,Dr=jr.bottom-jr.top}Ht.width=He*kr,Ht.height=He*Dr}var Vt;H!==document.body&&typeof ResizeObserver=="function"?(Vt=new ResizeObserver(function(){setTimeout(Er)}),Vt.observe(H)):window.addEventListener("resize",Er,!1);function sr(){Vt?Vt.disconnect():window.removeEventListener("resize",Er),H.removeChild(Ht)}return Er(),{canvas:Ht,onDestroy:sr}}function hi(H,Se){function He(Ht){try{return H.getContext(Ht,Se)}catch{return null}}return He("webgl")||He("experimental-webgl")||He("webgl-experimental")}function fa(H){return typeof H.nodeName=="string"&&typeof H.appendChild=="function"&&typeof H.getBoundingClientRect=="function"}function $(H){return typeof H.drawArrays=="function"||typeof H.drawElements=="function"}function ne(H){return typeof H=="string"?H.split():(V(Array.isArray(H),"invalid extension array"),H)}function he(H){return typeof H=="string"?(V(typeof document<"u","not supported outside of DOM"),document.querySelector(H)):H}function be(H){var Se=H||{},He,Ht,Er,Vt,sr={},kr=[],Dr=[],jr=typeof window>"u"?1:window.devicePixelRatio,qr=!1,$r=function(Xr){Xr&&V.raise(Xr)},gn=function(){};if(typeof Se=="string"?(V(typeof document<"u","selector queries only supported in DOM environments"),He=document.querySelector(Se),V(He,"invalid query string for element")):typeof Se=="object"?fa(Se)?He=Se:$(Se)?(Vt=Se,Er=Vt.canvas):(V.constructor(Se),"gl"in Se?Vt=Se.gl:"canvas"in Se?Er=he(Se.canvas):"container"in Se&&(Ht=he(Se.container)),"attributes"in Se&&(sr=Se.attributes,V.type(sr,"object","invalid context attributes")),"extensions"in Se&&(kr=ne(Se.extensions)),"optionalExtensions"in Se&&(Dr=ne(Se.optionalExtensions)),"onDone"in Se&&(V.type(Se.onDone,"function","invalid or missing onDone callback"),$r=Se.onDone),"profile"in Se&&(qr=!!Se.profile),"pixelRatio"in Se&&(jr=+Se.pixelRatio,V(jr>0,"invalid pixel ratio"))):V.raise("invalid arguments to regl"),He&&(He.nodeName.toLowerCase()==="canvas"?Er=He:Ht=He),!Vt){if(!Er){V(typeof document<"u","must manually specify webgl context outside of DOM environments");var Zr=ro(Ht||document.body,$r,jr);if(!Zr)return null;Er=Zr.canvas,gn=Zr.onDestroy}sr.premultipliedAlpha===void 0&&(sr.premultipliedAlpha=!0),Vt=hi(Er,sr)}return Vt?{gl:Vt,canvas:Er,container:Ht,extensions:kr,optionalExtensions:Dr,pixelRatio:jr,profile:qr,onDone:$r,onDestroy:gn}:(gn(),$r("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ne(H,Se){var He={};function Ht(kr){V.type(kr,"string","extension name must be string");var Dr=kr.toLowerCase(),jr;try{jr=He[Dr]=Er(kr)}catch{}return!!jr}function Er(kr){return H.getExtension(kr)?H.getExtension(kr):H.getExtension(kr.toLowerCase())?H.getExtension(kr.toLowerCase()):null}for(var Vt=0;Vt<Se.extensions.length;++Vt){var sr=Se.extensions[Vt];if(!Ht(sr))return Se.onDestroy(),Se.onDone('"'+sr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Se.optionalExtensions.forEach(Ht),{extensions:He,restore:function(){Object.keys(He).forEach(function(kr){if(He[kr]&&!Ht(kr))throw new Error("(regl): error restoring extension "+kr)})}}}function Ye(H,Se){for(var He=Array(H),Ht=0;Ht<H;++Ht)He[Ht]=Se(Ht);return He}var lt=5120,_e=5121,je=5122,Mt=5123,Sr=5124,zt=5125,Yt=5126;function Lr(H){for(var Se=16;Se<=1<<28;Se*=16)if(H<=Se)return Se;return 0}function $n(H){var Se,He;return Se=(H>65535)<<4,H>>>=Se,He=(H>255)<<3,H>>>=He,Se|=He,He=(H>15)<<2,H>>>=He,Se|=He,He=(H>3)<<1,H>>>=He,Se|=He,Se|H>>1}function vn(){var H=Ye(8,function(){return[]});function Se(Vt){var sr=Lr(Vt),kr=H[$n(sr)>>2];return kr.length>0?kr.pop():new ArrayBuffer(sr)}function He(Vt){H[$n(Vt.byteLength)>>2].push(Vt)}function Ht(Vt,sr){var kr=null;switch(Vt){case lt:kr=new Int8Array(Se(sr),0,sr);break;case _e:kr=new Uint8Array(Se(sr),0,sr);break;case je:kr=new Int16Array(Se(2*sr),0,sr);break;case Mt:kr=new Uint16Array(Se(2*sr),0,sr);break;case Sr:kr=new Int32Array(Se(4*sr),0,sr);break;case zt:kr=new Uint32Array(Se(4*sr),0,sr);break;case Yt:kr=new Float32Array(Se(4*sr),0,sr);break;default:return null}return kr.length!==sr?kr.subarray(0,sr):kr}function Er(Vt){He(Vt.buffer)}return{alloc:Se,free:He,allocType:Ht,freeType:Er}}var Nt=vn();Nt.zero=vn();var pr=3408,on=3410,cn=3411,$i=3412,Cn=3413,xt=3414,St=3415,qi=33901,na=33902,ea=3379,oi=3386,Zi=34921,fo=36347,mr=36348,lr=35661,nt=35660,Ya=34930,dt=36349,wo=34076,qa=34024,lu=7936,No=7937,Li=7938,ic=35724,Aa=34047,Ao=36063,Ho=34852,pa=3553,ws=34067,Vs=34069,gl=33984,oo=6408,ms=5126,Oa=5121,Ro=36160,Ps=36053,zo=36064,yu=16384,el=function(H,Se){var He=1;Se.ext_texture_filter_anisotropic&&(He=H.getParameter(Aa));var Ht=1,Er=1;Se.webgl_draw_buffers&&(Ht=H.getParameter(Ho),Er=H.getParameter(Ao));var Vt=!!Se.oes_texture_float;if(Vt){var sr=H.createTexture();H.bindTexture(pa,sr),H.texImage2D(pa,0,oo,1,1,0,oo,ms,null);var kr=H.createFramebuffer();if(H.bindFramebuffer(Ro,kr),H.framebufferTexture2D(Ro,zo,pa,sr,0),H.bindTexture(pa,null),H.checkFramebufferStatus(Ro)!==Ps)Vt=!1;else{H.viewport(0,0,1,1),H.clearColor(1,0,0,1),H.clear(yu);var Dr=Nt.allocType(ms,4);H.readPixels(0,0,1,1,oo,ms,Dr),H.getError()?Vt=!1:(H.deleteFramebuffer(kr),H.deleteTexture(sr),Vt=Dr[0]===1),Nt.freeType(Dr)}}var jr=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),qr=!0;if(!jr){var $r=H.createTexture(),gn=Nt.allocType(Oa,36);H.activeTexture(gl),H.bindTexture(ws,$r),H.texImage2D(Vs,0,oo,3,3,0,oo,Oa,gn),Nt.freeType(gn),H.bindTexture(ws,null),H.deleteTexture($r),qr=!H.getError()}return{colorBits:[H.getParameter(on),H.getParameter(cn),H.getParameter($i),H.getParameter(Cn)],depthBits:H.getParameter(xt),stencilBits:H.getParameter(St),subpixelBits:H.getParameter(pr),extensions:Object.keys(Se).filter(function(Zr){return!!Se[Zr]}),maxAnisotropic:He,maxDrawbuffers:Ht,maxColorAttachments:Er,pointSizeDims:H.getParameter(qi),lineWidthDims:H.getParameter(na),maxViewportDims:H.getParameter(oi),maxCombinedTextureUnits:H.getParameter(lr),maxCubeMapSize:H.getParameter(wo),maxRenderbufferSize:H.getParameter(qa),maxTextureUnits:H.getParameter(Ya),maxTextureSize:H.getParameter(ea),maxAttributes:H.getParameter(Zi),maxVertexUniforms:H.getParameter(fo),maxVertexTextureUnits:H.getParameter(nt),maxVaryingVectors:H.getParameter(mr),maxFragmentUniforms:H.getParameter(dt),glsl:H.getParameter(ic),renderer:H.getParameter(No),vendor:H.getParameter(lu),version:H.getParameter(Li),readFloat:Vt,npotTextureCube:qr}};function Wo(H){return!!H&&typeof H=="object"&&Array.isArray(H.shape)&&Array.isArray(H.stride)&&typeof H.offset=="number"&&H.shape.length===H.stride.length&&(Array.isArray(H.data)||Ft(H.data))}var fe=function(H){return Object.keys(H).map(function(Se){return H[Se]})},Me={shape:Jo,flatten:ua};function ut(H,Se,He){for(var Ht=0;Ht<Se;++Ht)He[Ht]=H[Ht]}function Zt(H,Se,He,Ht){for(var Er=0,Vt=0;Vt<Se;++Vt)for(var sr=H[Vt],kr=0;kr<He;++kr)Ht[Er++]=sr[kr]}function sn(H,Se,He,Ht,Er,Vt){for(var sr=Vt,kr=0;kr<Se;++kr)for(var Dr=H[kr],jr=0;jr<He;++jr)for(var qr=Dr[jr],$r=0;$r<Ht;++$r)Er[sr++]=qr[$r]}function jn(H,Se,He,Ht,Er){for(var Vt=1,sr=He+1;sr<Se.length;++sr)Vt*=Se[sr];var kr=Se[He];if(Se.length-He===4){var Dr=Se[He+1],jr=Se[He+2],qr=Se[He+3];for(sr=0;sr<kr;++sr)sn(H[sr],Dr,jr,qr,Ht,Er),Er+=Vt}else for(sr=0;sr<kr;++sr)jn(H[sr],Se,He+1,Ht,Er),Er+=Vt}function ua(H,Se,He,Ht){var Er=1;if(Se.length)for(var Vt=0;Vt<Se.length;++Vt)Er*=Se[Vt];else Er=0;var sr=Ht||Nt.allocType(He,Er);switch(Se.length){case 0:break;case 1:ut(H,Se[0],sr);break;case 2:Zt(H,Se[0],Se[1],sr);break;case 3:sn(H,Se[0],Se[1],Se[2],sr,0);break;default:jn(H,Se,0,sr,0)}return sr}function Jo(H){for(var Se=[],He=H;He.length;He=He[0])Se.push(He.length);return Se}var Ta={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},so=5120,xo=5122,To=5124,Ls=5121,js=5123,_u=5125,xu=5126,Mu=5126,Uo={int8:so,int16:xo,int32:To,uint8:Ls,uint16:js,uint32:_u,float:xu,float32:Mu},Zo=35048,Fa=35040,As={dynamic:Zo,stream:Fa,static:35044},Hu=Me.flatten,Zh=Me.shape,Cc=35044,Xf=35040,yl=5121,Hc=5126,_l=[];_l[5120]=1,_l[5122]=2,_l[5124]=4,_l[5121]=1,_l[5123]=2,_l[5125]=4,_l[5126]=4;function gf(H){return Ta[Object.prototype.toString.call(H)]|0}function b(H,Se){for(var He=0;He<Se.length;++He)H[He]=Se[He]}function I(H,Se,He,Ht,Er,Vt,sr){for(var kr=0,Dr=0;Dr<He;++Dr)for(var jr=0;jr<Ht;++jr)H[kr++]=Se[Er*Dr+Vt*jr+sr]}function G(H,Se,He,Ht){var Er=0,Vt={};function sr(Ct){this.id=Er++,this.buffer=H.createBuffer(),this.type=Ct,this.usage=Cc,this.byteLength=0,this.dimension=1,this.dtype=yl,this.persistentData=null,He.profile&&(this.stats={size:0})}sr.prototype.bind=function(){H.bindBuffer(this.type,this.buffer)},sr.prototype.destroy=function(){gn(this)};var kr=[];function Dr(Ct,er){var Gr=kr.pop();return Gr||(Gr=new sr(Ct)),Gr.bind(),$r(Gr,er,Xf,0,1,!1),Gr}function jr(Ct){kr.push(Ct)}function qr(Ct,er,Gr){Ct.byteLength=er.byteLength,H.bufferData(Ct.type,er,Gr)}function $r(Ct,er,Gr,fn,wr,Kr){var Mn;if(Ct.usage=Gr,Array.isArray(er)){if(Ct.dtype=fn||Hc,er.length>0){var pi;if(Array.isArray(er[0])){Mn=Zh(er);for(var or=1,dr=1;dr<Mn.length;++dr)or*=Mn[dr];Ct.dimension=or,pi=Hu(er,Mn,Ct.dtype),qr(Ct,pi,Gr),Kr?Ct.persistentData=pi:Nt.freeType(pi)}else if(typeof er[0]=="number"){Ct.dimension=wr;var qn=Nt.allocType(Ct.dtype,er.length);b(qn,er),qr(Ct,qn,Gr),Kr?Ct.persistentData=qn:Nt.freeType(qn)}else Ft(er[0])?(Ct.dimension=er[0].length,Ct.dtype=fn||gf(er[0])||Hc,pi=Hu(er,[er.length,er[0].length],Ct.dtype),qr(Ct,pi,Gr),Kr?Ct.persistentData=pi:Nt.freeType(pi)):V.raise("invalid buffer data")}}else if(Ft(er))Ct.dtype=fn||gf(er),Ct.dimension=wr,qr(Ct,er,Gr),Kr&&(Ct.persistentData=new Uint8Array(new Uint8Array(er.buffer)));else if(Wo(er)){Mn=er.shape;var xn=er.stride,Hr=er.offset,pn=0,kn=0,Qi=0,Ri=0;Mn.length===1?(pn=Mn[0],kn=1,Qi=xn[0],Ri=0):Mn.length===2?(pn=Mn[0],kn=Mn[1],Qi=xn[0],Ri=xn[1]):V.raise("invalid shape"),Ct.dtype=fn||gf(er.data)||Hc,Ct.dimension=kn;var yn=Nt.allocType(Ct.dtype,pn*kn);I(yn,er.data,pn,kn,Qi,Ri,Hr),qr(Ct,yn,Gr),Kr?Ct.persistentData=yn:Nt.freeType(yn)}else er instanceof ArrayBuffer?(Ct.dtype=yl,Ct.dimension=wr,qr(Ct,er,Gr),Kr&&(Ct.persistentData=new Uint8Array(new Uint8Array(er)))):V.raise("invalid buffer data")}function gn(Ct){Se.bufferCount--,Ht(Ct);var er=Ct.buffer;V(er,"buffer must not be deleted already"),H.deleteBuffer(er),Ct.buffer=null,delete Vt[Ct.id]}function Zr(Ct,er,Gr,fn){Se.bufferCount++;var wr=new sr(er);Vt[wr.id]=wr;function Kr(or){var dr=Cc,qn=null,xn=0,Hr=0,pn=1;return Array.isArray(or)||Ft(or)||Wo(or)||or instanceof ArrayBuffer?qn=or:typeof or=="number"?xn=or|0:or&&(V.type(or,"object","buffer arguments must be an object, a number or an array"),"data"in or&&(V(qn===null||Array.isArray(qn)||Ft(qn)||Wo(qn),"invalid data for buffer"),qn=or.data),"usage"in or&&(V.parameter(or.usage,As,"invalid buffer usage"),dr=As[or.usage]),"type"in or&&(V.parameter(or.type,Uo,"invalid buffer type"),Hr=Uo[or.type]),"dimension"in or&&(V.type(or.dimension,"number","invalid dimension"),pn=or.dimension|0),"length"in or&&(V.nni(xn,"buffer length must be a nonnegative integer"),xn=or.length|0)),wr.bind(),qn?$r(wr,qn,dr,Hr,pn,fn):(xn&&H.bufferData(wr.type,xn,dr),wr.dtype=Hr||yl,wr.usage=dr,wr.dimension=pn,wr.byteLength=xn),He.profile&&(wr.stats.size=wr.byteLength*_l[wr.dtype]),Kr}function Mn(or,dr){V(dr+or.byteLength<=wr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+or.byteLength+" starting from offset "+dr+" to a buffer of size "+wr.byteLength),H.bufferSubData(wr.type,dr,or)}function pi(or,dr){var qn=(dr||0)|0,xn;if(wr.bind(),Ft(or)||or instanceof ArrayBuffer)Mn(or,qn);else if(Array.isArray(or)){if(or.length>0)if(typeof or[0]=="number"){var Hr=Nt.allocType(wr.dtype,or.length);b(Hr,or),Mn(Hr,qn),Nt.freeType(Hr)}else if(Array.isArray(or[0])||Ft(or[0])){xn=Zh(or);var pn=Hu(or,xn,wr.dtype);Mn(pn,qn),Nt.freeType(pn)}else V.raise("invalid buffer data")}else if(Wo(or)){xn=or.shape;var kn=or.stride,Qi=0,Ri=0,yn=0,bn=0;xn.length===1?(Qi=xn[0],Ri=1,yn=kn[0],bn=0):xn.length===2?(Qi=xn[0],Ri=xn[1],yn=kn[0],bn=kn[1]):V.raise("invalid shape");var Ai=Array.isArray(or.data)?wr.dtype:gf(or.data),Xi=Nt.allocType(Ai,Qi*Ri);I(Xi,or.data,Qi,Ri,yn,bn,or.offset),Mn(Xi,qn),Nt.freeType(Xi)}else V.raise("invalid data for buffer subdata");return Kr}return Gr||Kr(Ct),Kr._reglType="buffer",Kr._buffer=wr,Kr.subdata=pi,He.profile&&(Kr.stats=wr.stats),Kr.destroy=function(){gn(wr)},Kr}function Xr(){fe(Vt).forEach(function(Ct){Ct.buffer=H.createBuffer(),H.bindBuffer(Ct.type,Ct.buffer),H.bufferData(Ct.type,Ct.persistentData||Ct.byteLength,Ct.usage)})}return He.profile&&(Se.getTotalBufferSize=function(){var Ct=0;return Object.keys(Vt).forEach(function(er){Ct+=Vt[er].stats.size}),Ct}),{create:Zr,createStream:Dr,destroyStream:jr,clear:function(){fe(Vt).forEach(gn),kr.forEach(gn)},getBuffer:function(Ct){return Ct&&Ct._buffer instanceof sr?Ct._buffer:null},restore:Xr,_initBuffer:$r}}var D=0,re=0,Te=1,it=1,ht=4,Tt=4,_r={points:D,point:re,lines:Te,line:it,triangles:ht,triangle:Tt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},br=0,si=1,Ni=4,Di=5120,ia=5121,Ga=5122,uo=5123,ga=5124,Ks=5125,Zl=34963,Wc=35040,Xc=35044;function Sc(H,Se,He,Ht){var Er={},Vt=0,sr={uint8:ia,uint16:uo};Se.oes_element_index_uint&&(sr.uint32=Ks);function kr(Xr){this.id=Vt++,Er[this.id]=this,this.buffer=Xr,this.primType=Ni,this.vertCount=0,this.type=0}kr.prototype.bind=function(){this.buffer.bind()};var Dr=[];function jr(Xr){var Ct=Dr.pop();return Ct||(Ct=new kr(He.create(null,Zl,!0,!1)._buffer)),$r(Ct,Xr,Wc,-1,-1,0,0),Ct}function qr(Xr){Dr.push(Xr)}function $r(Xr,Ct,er,Gr,fn,wr,Kr){Xr.buffer.bind();var Mn;if(Ct){var pi=Kr;!Kr&&(!Ft(Ct)||Wo(Ct)&&!Ft(Ct.data))&&(pi=Se.oes_element_index_uint?Ks:uo),He._initBuffer(Xr.buffer,Ct,er,pi,3)}else H.bufferData(Zl,wr,er),Xr.buffer.dtype=Mn||ia,Xr.buffer.usage=er,Xr.buffer.dimension=3,Xr.buffer.byteLength=wr;if(Mn=Kr,!Kr){switch(Xr.buffer.dtype){case ia:case Di:Mn=ia;break;case uo:case Ga:Mn=uo;break;case Ks:case ga:Mn=Ks;break;default:V.raise("unsupported type for element array")}Xr.buffer.dtype=Mn}Xr.type=Mn,V(Mn!==Ks||!!Se.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var or=fn;or<0&&(or=Xr.buffer.byteLength,Mn===uo?or>>=1:Mn===Ks&&(or>>=2)),Xr.vertCount=or;var dr=Gr;if(Gr<0){dr=Ni;var qn=Xr.buffer.dimension;qn===1&&(dr=br),qn===2&&(dr=si),qn===3&&(dr=Ni)}Xr.primType=dr}function gn(Xr){Ht.elementsCount--,V(Xr.buffer!==null,"must not double destroy elements"),delete Er[Xr.id],Xr.buffer.destroy(),Xr.buffer=null}function Zr(Xr,Ct){var er=He.create(null,Zl,!0),Gr=new kr(er._buffer);Ht.elementsCount++;function fn(wr){if(!wr)er(),Gr.primType=Ni,Gr.vertCount=0,Gr.type=ia;else if(typeof wr=="number")er(wr),Gr.primType=Ni,Gr.vertCount=wr|0,Gr.type=ia;else{var Kr=null,Mn=Xc,pi=-1,or=-1,dr=0,qn=0;Array.isArray(wr)||Ft(wr)||Wo(wr)?Kr=wr:(V.type(wr,"object","invalid arguments for elements"),"data"in wr&&(Kr=wr.data,V(Array.isArray(Kr)||Ft(Kr)||Wo(Kr),"invalid data for element buffer")),"usage"in wr&&(V.parameter(wr.usage,As,"invalid element buffer usage"),Mn=As[wr.usage]),"primitive"in wr&&(V.parameter(wr.primitive,_r,"invalid element buffer primitive"),pi=_r[wr.primitive]),"count"in wr&&(V(typeof wr.count=="number"&&wr.count>=0,"invalid vertex count for elements"),or=wr.count|0),"type"in wr&&(V.parameter(wr.type,sr,"invalid buffer type"),qn=sr[wr.type]),"length"in wr?dr=wr.length|0:(dr=or,qn===uo||qn===Ga?dr*=2:(qn===Ks||qn===ga)&&(dr*=4))),$r(Gr,Kr,Mn,pi,or,dr,qn)}return fn}return fn(Xr),fn._reglType="elements",fn._elements=Gr,fn.subdata=function(wr,Kr){return er.subdata(wr,Kr),fn},fn.destroy=function(){gn(Gr)},fn}return{create:Zr,createStream:jr,destroyStream:qr,getElements:function(Xr){return typeof Xr=="function"&&Xr._elements instanceof kr?Xr._elements:null},clear:function(){fe(Er).forEach(gn)}}}var wc=new Float32Array(1),ku=new Uint32Array(wc.buffer),Vl=5123;function xl(H){for(var Se=Nt.allocType(Vl,H.length),He=0;He<H.length;++He)if(isNaN(H[He]))Se[He]=65535;else if(H[He]===1/0)Se[He]=31744;else if(H[He]===-1/0)Se[He]=64512;else{wc[0]=H[He];var Ht=ku[0],Er=Ht>>>31<<15,Vt=(Ht<<1>>>24)-127,sr=Ht>>13&(1<<10)-1;if(Vt<-24)Se[He]=Er;else if(Vt<-14){var kr=-14-Vt;Se[He]=Er+(sr+(1<<10)>>kr)}else Vt>15?Se[He]=Er+31744:Se[He]=Er+(Vt+15<<10)+sr}return Se}function Oo(H){return Array.isArray(H)||Ft(H)}var Vh=function(H){return!(H&H-1)&&!!H},jh=34467,Iu=3553,fh=34067,ac=34069,Rs=6408,hh=6406,bl=6407,no=6409,Pu=6410,Yf=32854,El=32855,od=36194,i0=32819,sd=32820,ph=33635,Yc=34042,yf=6402,Ac=34041,qc=35904,Tc=35906,_f=36193,oc=33776,cu=33777,sc=33778,qf=33779,Gh=35986,Mc=35987,Cl=34798,uc=35840,xf=35841,kc=35842,Hh=35843,bf=36196,Ic=5121,Ef=5123,Wh=5125,Cf=5126,ud=10242,wp=10243,dh=10497,Ts=33071,Ap=33648,Ia=10240,bo=10241,$f=9728,$c=9729,tl=9984,ya=9985,ho=9986,ka=9987,jl=33170,bu=4352,Pc=4353,rl=4354,Tp=34046,Sf=3317,Kf=37440,lc=37441,us=37443,Sl=37444,vh=33984,Vo=[tl,ho,ya,ka],tn=[0,no,Pu,bl,Rs],Xo={};Xo[no]=Xo[hh]=Xo[yf]=1,Xo[Ac]=Xo[Pu]=2,Xo[bl]=Xo[qc]=3,Xo[Rs]=Xo[Tc]=4;function Lc(H){return"[object "+H+"]"}var Kc=Lc("HTMLCanvasElement"),Wu=Lc("OffscreenCanvas"),Lu=Lc("CanvasRenderingContext2D"),Gl=Lc("ImageBitmap"),mn=Lc("HTMLImageElement"),wf=Lc("HTMLVideoElement"),Sa=Object.keys(Ta).concat([Kc,Wu,Lu,Gl,mn,wf]),Hl=[];Hl[Ic]=1,Hl[Cf]=4,Hl[_f]=2,Hl[Ef]=2,Hl[Wh]=4;var po=[];po[Yf]=2,po[El]=2,po[od]=2,po[Ac]=4,po[oc]=.5,po[cu]=.5,po[sc]=1,po[qf]=1,po[Gh]=.5,po[Mc]=1,po[Cl]=1,po[uc]=.5,po[xf]=.25,po[kc]=.5,po[Hh]=.25,po[bf]=.5;function fu(H){return Array.isArray(H)&&(H.length===0||typeof H[0]=="number")}function Qc(H){if(!Array.isArray(H))return!1;var Se=H.length;return!(Se===0||!Oo(H[0]))}function wl(H){return Object.prototype.toString.call(H)}function Eu(H){return wl(H)===Kc}function zn(H){return wl(H)===Wu}function Mp(H){return wl(H)===Lu}function Qf(H){return wl(H)===Gl}function ld(H){return wl(H)===mn}function Xh(H){return wl(H)===wf}function nl(H){var Se=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(Se&&H&&H.getContext)}function Os(H){var Se=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(Se&&H&&"src"in H&&"crossOrigin"in H)}function aa(H){if(!H)return!1;if(nl(H)||Os(H))return!0;var Se=wl(H);return Sa.indexOf(Se)>=0?!0:fu(H)||Qc(H)||Wo(H)}function il(H){return Ta[Object.prototype.toString.call(H)]|0}function Gs(H,Se){var He=Se.length;switch(H.type){case Ic:case Ef:case Wh:case Cf:var Ht=Nt.allocType(H.type,He);Ht.set(Se),H.data=Ht;break;case _f:H.data=xl(Se);break;default:V.raise("unsupported texture type, must specify a typed array")}}function Qs(H,Se){return Nt.allocType(H.type===_f?Cf:H.type,Se)}function cc(H,Se){H.type===_f?(H.data=xl(Se),Nt.freeType(Se)):H.data=Se}function Jc(H,Se,He,Ht,Er,Vt){for(var sr=H.width,kr=H.height,Dr=H.channels,jr=sr*kr*Dr,qr=Qs(H,jr),$r=0,gn=0;gn<kr;++gn)for(var Zr=0;Zr<sr;++Zr)for(var Xr=0;Xr<Dr;++Xr)qr[$r++]=Se[He*Zr+Ht*gn+Er*Xr+Vt];cc(H,qr)}function al(H,Se,He,Ht,Er,Vt){var sr;if(typeof po[H]<"u"?sr=po[H]:sr=Xo[H]*Hl[Se],Vt&&(sr*=6),Er){for(var kr=0,Dr=He;Dr>=1;)kr+=sr*Dr*Dr,Dr/=2;return kr}else return sr*He*Ht}function Hs(H,Se,He,Ht,Er,Vt,sr){var kr={"don't care":bu,"dont care":bu,nice:rl,fast:Pc},Dr={repeat:dh,clamp:Ts,mirror:Ap},jr={nearest:$f,linear:$c},qr=x({mipmap:ka,"nearest mipmap nearest":tl,"linear mipmap nearest":ya,"nearest mipmap linear":ho,"linear mipmap linear":ka},jr),$r={none:0,browser:Sl},gn={uint8:Ic,rgba4:i0,rgb565:ph,"rgb5 a1":sd},Zr={alpha:hh,luminance:no,"luminance alpha":Pu,rgb:bl,rgba:Rs,rgba4:Yf,"rgb5 a1":El,rgb565:od},Xr={};Se.ext_srgb&&(Zr.srgb=qc,Zr.srgba=Tc),Se.oes_texture_float&&(gn.float32=gn.float=Cf),Se.oes_texture_half_float&&(gn.float16=gn["half float"]=_f),Se.webgl_depth_texture&&(x(Zr,{depth:yf,"depth stencil":Ac}),x(gn,{uint16:Ef,uint32:Wh,"depth stencil":Yc})),Se.webgl_compressed_texture_s3tc&&x(Xr,{"rgb s3tc dxt1":oc,"rgba s3tc dxt1":cu,"rgba s3tc dxt3":sc,"rgba s3tc dxt5":qf}),Se.webgl_compressed_texture_atc&&x(Xr,{"rgb atc":Gh,"rgba atc explicit alpha":Mc,"rgba atc interpolated alpha":Cl}),Se.webgl_compressed_texture_pvrtc&&x(Xr,{"rgb pvrtc 4bppv1":uc,"rgb pvrtc 2bppv1":xf,"rgba pvrtc 4bppv1":kc,"rgba pvrtc 2bppv1":Hh}),Se.webgl_compressed_texture_etc1&&(Xr["rgb etc1"]=bf);var Ct=Array.prototype.slice.call(H.getParameter(jh)||new Uint32Array(0));Object.keys(Xr).forEach(function(De){var Wt=Xr[De];Ct.indexOf(Wt)>=0&&(Zr[De]=Wt)});var er=Object.keys(Zr);He.textureFormats=er;var Gr=[];Object.keys(Zr).forEach(function(De){var Wt=Zr[De];Gr[Wt]=De});var fn=[];Object.keys(gn).forEach(function(De){var Wt=gn[De];fn[Wt]=De});var wr=[];Object.keys(jr).forEach(function(De){var Wt=jr[De];wr[Wt]=De});var Kr=[];Object.keys(qr).forEach(function(De){var Wt=qr[De];Kr[Wt]=De});var Mn=[];Object.keys(Dr).forEach(function(De){var Wt=Dr[De];Mn[Wt]=De});var pi=er.reduce(function(De,Wt){var Lt=Zr[Wt];return Lt===no||Lt===hh||Lt===no||Lt===Pu||Lt===yf||Lt===Ac||Se.ext_srgb&&(Lt===qc||Lt===Tc)?De[Lt]=Lt:Lt===El||Wt.indexOf("rgba")>=0?De[Lt]=Rs:De[Lt]=bl,De},{});function or(){this.internalformat=Rs,this.format=Rs,this.type=Ic,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Sl,this.width=0,this.height=0,this.channels=0}function dr(De,Wt){De.internalformat=Wt.internalformat,De.format=Wt.format,De.type=Wt.type,De.compressed=Wt.compressed,De.premultiplyAlpha=Wt.premultiplyAlpha,De.flipY=Wt.flipY,De.unpackAlignment=Wt.unpackAlignment,De.colorSpace=Wt.colorSpace,De.width=Wt.width,De.height=Wt.height,De.channels=Wt.channels}function qn(De,Wt){if(!(typeof Wt!="object"||!Wt)){if("premultiplyAlpha"in Wt&&(V.type(Wt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),De.premultiplyAlpha=Wt.premultiplyAlpha),"flipY"in Wt&&(V.type(Wt.flipY,"boolean","invalid texture flip"),De.flipY=Wt.flipY),"alignment"in Wt&&(V.oneOf(Wt.alignment,[1,2,4,8],"invalid texture unpack alignment"),De.unpackAlignment=Wt.alignment),"colorSpace"in Wt&&(V.parameter(Wt.colorSpace,$r,"invalid colorSpace"),De.colorSpace=$r[Wt.colorSpace]),"type"in Wt){var Lt=Wt.type;V(Se.oes_texture_float||!(Lt==="float"||Lt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),V(Se.oes_texture_half_float||!(Lt==="half float"||Lt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),V(Se.webgl_depth_texture||!(Lt==="uint16"||Lt==="uint32"||Lt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),V.parameter(Lt,gn,"invalid texture type"),De.type=gn[Lt]}var Un=De.width,Ea=De.height,Re=De.channels,ge=!1;"shape"in Wt?(V(Array.isArray(Wt.shape)&&Wt.shape.length>=2,"shape must be an array"),Un=Wt.shape[0],Ea=Wt.shape[1],Wt.shape.length===3&&(Re=Wt.shape[2],V(Re>0&&Re<=4,"invalid number of channels"),ge=!0),V(Un>=0&&Un<=He.maxTextureSize,"invalid width"),V(Ea>=0&&Ea<=He.maxTextureSize,"invalid height")):("radius"in Wt&&(Un=Ea=Wt.radius,V(Un>=0&&Un<=He.maxTextureSize,"invalid radius")),"width"in Wt&&(Un=Wt.width,V(Un>=0&&Un<=He.maxTextureSize,"invalid width")),"height"in Wt&&(Ea=Wt.height,V(Ea>=0&&Ea<=He.maxTextureSize,"invalid height")),"channels"in Wt&&(Re=Wt.channels,V(Re>0&&Re<=4,"invalid number of channels"),ge=!0)),De.width=Un|0,De.height=Ea|0,De.channels=Re|0;var Qe=!1;if("format"in Wt){var wt=Wt.format;V(Se.webgl_depth_texture||!(wt==="depth"||wt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),V.parameter(wt,Zr,"invalid texture format");var Ut=De.internalformat=Zr[wt];De.format=pi[Ut],wt in gn&&("type"in Wt||(De.type=gn[wt])),wt in Xr&&(De.compressed=!0),Qe=!0}!ge&&Qe?De.channels=Xo[De.format]:ge&&!Qe?De.channels!==tn[De.format]&&(De.format=De.internalformat=tn[De.channels]):Qe&&ge&&V(De.channels===Xo[De.format],"number of channels inconsistent with specified format")}}function xn(De){H.pixelStorei(Kf,De.flipY),H.pixelStorei(lc,De.premultiplyAlpha),H.pixelStorei(us,De.colorSpace),H.pixelStorei(Sf,De.unpackAlignment)}function Hr(){or.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function pn(De,Wt){var Lt=null;if(aa(Wt)?Lt=Wt:Wt&&(V.type(Wt,"object","invalid pixel data type"),qn(De,Wt),"x"in Wt&&(De.xOffset=Wt.x|0),"y"in Wt&&(De.yOffset=Wt.y|0),aa(Wt.data)&&(Lt=Wt.data)),V(!De.compressed||Lt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Wt.copy){V(!Lt,"can not specify copy and data field for the same texture");var Un=Er.viewportWidth,Ea=Er.viewportHeight;De.width=De.width||Un-De.xOffset,De.height=De.height||Ea-De.yOffset,De.needsCopy=!0,V(De.xOffset>=0&&De.xOffset<Un&&De.yOffset>=0&&De.yOffset<Ea&&De.width>0&&De.width<=Un&&De.height>0&&De.height<=Ea,"copy texture read out of bounds")}else if(!Lt)De.width=De.width||1,De.height=De.height||1,De.channels=De.channels||4;else if(Ft(Lt))De.channels=De.channels||4,De.data=Lt,!("type"in Wt)&&De.type===Ic&&(De.type=il(Lt));else if(fu(Lt))De.channels=De.channels||4,Gs(De,Lt),De.alignment=1,De.needsFree=!0;else if(Wo(Lt)){var Re=Lt.data;!Array.isArray(Re)&&De.type===Ic&&(De.type=il(Re));var ge=Lt.shape,Qe=Lt.stride,wt,Ut,ot,Ge,mt,we;ge.length===3?(ot=ge[2],we=Qe[2]):(V(ge.length===2,"invalid ndarray pixel data, must be 2 or 3D"),ot=1,we=1),wt=ge[0],Ut=ge[1],Ge=Qe[0],mt=Qe[1],De.alignment=1,De.width=wt,De.height=Ut,De.channels=ot,De.format=De.internalformat=tn[ot],De.needsFree=!0,Jc(De,Re,Ge,mt,we,Lt.offset)}else if(nl(Lt)||Eu(Lt)||zn(Lt)||Mp(Lt))nl(Lt)||Eu(Lt)||zn(Lt)?De.element=Lt:De.element=Lt.canvas,De.width=De.element.width,De.height=De.element.height,De.channels=4;else if(Qf(Lt))De.element=Lt,De.width=Lt.width,De.height=Lt.height,De.channels=4;else if(ld(Lt))De.element=Lt,De.width=Lt.naturalWidth,De.height=Lt.naturalHeight,De.channels=4;else if(Os(Lt))De.element=Lt,De.width=Lt.width,De.height=Lt.height,De.channels=4;else if(Xh(Lt))De.element=Lt,De.width=Lt.videoWidth,De.height=Lt.videoHeight,De.channels=4;else if(Qc(Lt)){var Ke=De.width||Lt[0].length,Ie=De.height||Lt.length,gt=De.channels;Oo(Lt[0][0])?gt=gt||Lt[0][0].length:gt=gt||1;for(var Pt=Me.shape(Lt),Ar=1,ln=0;ln<Pt.length;++ln)Ar*=Pt[ln];var _n=Qs(De,Ar);Me.flatten(Lt,Pt,"",_n),cc(De,_n),De.alignment=1,De.width=Ke,De.height=Ie,De.channels=gt,De.format=De.internalformat=tn[gt],De.needsFree=!0}De.type===Cf?V(He.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):De.type===_f&&V(He.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function kn(De,Wt,Lt){var Un=De.element,Ea=De.data,Re=De.internalformat,ge=De.format,Qe=De.type,wt=De.width,Ut=De.height;xn(De),Un?H.texImage2D(Wt,Lt,ge,ge,Qe,Un):De.compressed?H.compressedTexImage2D(Wt,Lt,Re,wt,Ut,0,Ea):De.needsCopy?(Ht(),H.copyTexImage2D(Wt,Lt,ge,De.xOffset,De.yOffset,wt,Ut,0)):H.texImage2D(Wt,Lt,ge,wt,Ut,0,ge,Qe,Ea||null)}function Qi(De,Wt,Lt,Un,Ea){var Re=De.element,ge=De.data,Qe=De.internalformat,wt=De.format,Ut=De.type,ot=De.width,Ge=De.height;xn(De),Re?H.texSubImage2D(Wt,Ea,Lt,Un,wt,Ut,Re):De.compressed?H.compressedTexSubImage2D(Wt,Ea,Lt,Un,Qe,ot,Ge,ge):De.needsCopy?(Ht(),H.copyTexSubImage2D(Wt,Ea,Lt,Un,De.xOffset,De.yOffset,ot,Ge)):H.texSubImage2D(Wt,Ea,Lt,Un,ot,Ge,wt,Ut,ge)}var Ri=[];function yn(){return Ri.pop()||new Hr}function bn(De){De.needsFree&&Nt.freeType(De.data),Hr.call(De),Ri.push(De)}function Ai(){or.call(this),this.genMipmaps=!1,this.mipmapHint=bu,this.mipmask=0,this.images=Array(16)}function Xi(De,Wt,Lt){var Un=De.images[0]=yn();De.mipmask=1,Un.width=De.width=Wt,Un.height=De.height=Lt,Un.channels=De.channels=4}function xa(De,Wt){var Lt=null;if(aa(Wt))Lt=De.images[0]=yn(),dr(Lt,De),pn(Lt,Wt),De.mipmask=1;else if(qn(De,Wt),Array.isArray(Wt.mipmap))for(var Un=Wt.mipmap,Ea=0;Ea<Un.length;++Ea)Lt=De.images[Ea]=yn(),dr(Lt,De),Lt.width>>=Ea,Lt.height>>=Ea,pn(Lt,Un[Ea]),De.mipmask|=1<<Ea;else Lt=De.images[0]=yn(),dr(Lt,De),pn(Lt,Wt),De.mipmask=1;dr(De,De.images[0]),De.compressed&&(De.internalformat===oc||De.internalformat===cu||De.internalformat===sc||De.internalformat===qf)&&V(De.width%4===0&&De.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function $o(De,Wt){for(var Lt=De.images,Un=0;Un<Lt.length;++Un){if(!Lt[Un])return;kn(Lt[Un],Wt,Un)}}var Ko=[];function ma(){var De=Ko.pop()||new Ai;or.call(De),De.mipmask=0;for(var Wt=0;Wt<16;++Wt)De.images[Wt]=null;return De}function Xs(De){for(var Wt=De.images,Lt=0;Lt<Wt.length;++Lt)Wt[Lt]&&bn(Wt[Lt]),Wt[Lt]=null;Ko.push(De)}function Mo(){this.minFilter=$f,this.magFilter=$f,this.wrapS=Ts,this.wrapT=Ts,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=bu}function Ns(De,Wt){if("min"in Wt){var Lt=Wt.min;V.parameter(Lt,qr),De.minFilter=qr[Lt],Vo.indexOf(De.minFilter)>=0&&!("faces"in Wt)&&(De.genMipmaps=!0)}if("mag"in Wt){var Un=Wt.mag;V.parameter(Un,jr),De.magFilter=jr[Un]}var Ea=De.wrapS,Re=De.wrapT;if("wrap"in Wt){var ge=Wt.wrap;typeof ge=="string"?(V.parameter(ge,Dr),Ea=Re=Dr[ge]):Array.isArray(ge)&&(V.parameter(ge[0],Dr),V.parameter(ge[1],Dr),Ea=Dr[ge[0]],Re=Dr[ge[1]])}else{if("wrapS"in Wt){var Qe=Wt.wrapS;V.parameter(Qe,Dr),Ea=Dr[Qe]}if("wrapT"in Wt){var wt=Wt.wrapT;V.parameter(wt,Dr),Re=Dr[wt]}}if(De.wrapS=Ea,De.wrapT=Re,"anisotropic"in Wt){var Ut=Wt.anisotropic;V(typeof Ut=="number"&&Ut>=1&&Ut<=He.maxAnisotropic,"aniso samples must be between 1 and "),De.anisotropic=Wt.anisotropic}if("mipmap"in Wt){var ot=!1;switch(typeof Wt.mipmap){case"string":V.parameter(Wt.mipmap,kr,"invalid mipmap hint"),De.mipmapHint=kr[Wt.mipmap],De.genMipmaps=!0,ot=!0;break;case"boolean":ot=De.genMipmaps=Wt.mipmap;break;case"object":V(Array.isArray(Wt.mipmap),"invalid mipmap type"),De.genMipmaps=!1,ot=!0;break;default:V.raise("invalid mipmap type")}ot&&!("min"in Wt)&&(De.minFilter=tl)}}function rs(De,Wt){H.texParameteri(Wt,bo,De.minFilter),H.texParameteri(Wt,Ia,De.magFilter),H.texParameteri(Wt,ud,De.wrapS),H.texParameteri(Wt,wp,De.wrapT),Se.ext_texture_filter_anisotropic&&H.texParameteri(Wt,Tp,De.anisotropic),De.genMipmaps&&(H.hint(jl,De.mipmapHint),H.generateMipmap(Wt))}var Ys=0,zs={},Us=He.maxTextureUnits,Qo=Array(Us).map(function(){return null});function ta(De){or.call(this),this.mipmask=0,this.internalformat=Rs,this.id=Ys++,this.refCount=1,this.target=De,this.texture=H.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Mo,sr.profile&&(this.stats={size:0})}function ks(De){H.activeTexture(vh),H.bindTexture(De.target,De.texture)}function La(){var De=Qo[0];De?H.bindTexture(De.target,De.texture):H.bindTexture(Iu,null)}function nu(De){var Wt=De.texture;V(Wt,"must not double destroy texture");var Lt=De.unit,Un=De.target;Lt>=0&&(H.activeTexture(vh+Lt),H.bindTexture(Un,null),Qo[Lt]=null),H.deleteTexture(Wt),De.texture=null,De.params=null,De.pixels=null,De.refCount=0,delete zs[De.id],Vt.textureCount--}x(ta.prototype,{bind:function(){var De=this;De.bindCount+=1;var Wt=De.unit;if(Wt<0){for(var Lt=0;Lt<Us;++Lt){var Un=Qo[Lt];if(Un){if(Un.bindCount>0)continue;Un.unit=-1}Qo[Lt]=De,Wt=Lt;break}Wt>=Us&&V.raise("insufficient number of texture units"),sr.profile&&Vt.maxTextureUnits<Wt+1&&(Vt.maxTextureUnits=Wt+1),De.unit=Wt,H.activeTexture(vh+Wt),H.bindTexture(De.target,De.texture)}return Wt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&nu(this)}});function zi(De,Wt){var Lt=new ta(Iu);zs[Lt.id]=Lt,Vt.textureCount++;function Un(ge,Qe){var wt=Lt.texInfo;Mo.call(wt);var Ut=ma();return typeof ge=="number"?typeof Qe=="number"?Xi(Ut,ge|0,Qe|0):Xi(Ut,ge|0,ge|0):ge?(V.type(ge,"object","invalid arguments to regl.texture"),Ns(wt,ge),xa(Ut,ge)):Xi(Ut,1,1),wt.genMipmaps&&(Ut.mipmask=(Ut.width<<1)-1),Lt.mipmask=Ut.mipmask,dr(Lt,Ut),V.texture2D(wt,Ut,He),Lt.internalformat=Ut.internalformat,Un.width=Ut.width,Un.height=Ut.height,ks(Lt),$o(Ut,Iu),rs(wt,Iu),La(),Xs(Ut),sr.profile&&(Lt.stats.size=al(Lt.internalformat,Lt.type,Ut.width,Ut.height,wt.genMipmaps,!1)),Un.format=Gr[Lt.internalformat],Un.type=fn[Lt.type],Un.mag=wr[wt.magFilter],Un.min=Kr[wt.minFilter],Un.wrapS=Mn[wt.wrapS],Un.wrapT=Mn[wt.wrapT],Un}function Ea(ge,Qe,wt,Ut){V(!!ge,"must specify image data");var ot=Qe|0,Ge=wt|0,mt=Ut|0,we=yn();return dr(we,Lt),we.width=0,we.height=0,pn(we,ge),we.width=we.width||(Lt.width>>mt)-ot,we.height=we.height||(Lt.height>>mt)-Ge,V(Lt.type===we.type&&Lt.format===we.format&&Lt.internalformat===we.internalformat,"incompatible format for texture.subimage"),V(ot>=0&&Ge>=0&&ot+we.width<=Lt.width&&Ge+we.height<=Lt.height,"texture.subimage write out of bounds"),V(Lt.mipmask&1<<mt,"missing mipmap data"),V(we.data||we.element||we.needsCopy,"missing image data"),ks(Lt),Qi(we,Iu,ot,Ge,mt),La(),bn(we),Un}function Re(ge,Qe){var wt=ge|0,Ut=Qe|0||wt;if(wt===Lt.width&&Ut===Lt.height)return Un;Un.width=Lt.width=wt,Un.height=Lt.height=Ut,ks(Lt);for(var ot=0;Lt.mipmask>>ot;++ot){var Ge=wt>>ot,mt=Ut>>ot;if(!Ge||!mt)break;H.texImage2D(Iu,ot,Lt.format,Ge,mt,0,Lt.format,Lt.type,null)}return La(),sr.profile&&(Lt.stats.size=al(Lt.internalformat,Lt.type,wt,Ut,!1,!1)),Un}return Un(De,Wt),Un.subimage=Ea,Un.resize=Re,Un._reglType="texture2d",Un._texture=Lt,sr.profile&&(Un.stats=Lt.stats),Un.destroy=function(){Lt.decRef()},Un}function ba(De,Wt,Lt,Un,Ea,Re){var ge=new ta(fh);zs[ge.id]=ge,Vt.cubeCount++;var Qe=new Array(6);function wt(Ge,mt,we,Ke,Ie,gt){var Pt,Ar=ge.texInfo;for(Mo.call(Ar),Pt=0;Pt<6;++Pt)Qe[Pt]=ma();if(typeof Ge=="number"||!Ge){var ln=Ge|0||1;for(Pt=0;Pt<6;++Pt)Xi(Qe[Pt],ln,ln)}else if(typeof Ge=="object")if(mt)xa(Qe[0],Ge),xa(Qe[1],mt),xa(Qe[2],we),xa(Qe[3],Ke),xa(Qe[4],Ie),xa(Qe[5],gt);else if(Ns(Ar,Ge),qn(ge,Ge),"faces"in Ge){var _n=Ge.faces;for(V(Array.isArray(_n)&&_n.length===6,"cube faces must be a length 6 array"),Pt=0;Pt<6;++Pt)V(typeof _n[Pt]=="object"&&!!_n[Pt],"invalid input for cube map face"),dr(Qe[Pt],ge),xa(Qe[Pt],_n[Pt])}else for(Pt=0;Pt<6;++Pt)xa(Qe[Pt],Ge);else V.raise("invalid arguments to cube map");for(dr(ge,Qe[0]),V.optional(function(){He.npotTextureCube||V(Vh(ge.width)&&Vh(ge.height),"your browser does not support non power or two texture dimensions")}),Ar.genMipmaps?ge.mipmask=(Qe[0].width<<1)-1:ge.mipmask=Qe[0].mipmask,V.textureCube(ge,Ar,Qe,He),ge.internalformat=Qe[0].internalformat,wt.width=Qe[0].width,wt.height=Qe[0].height,ks(ge),Pt=0;Pt<6;++Pt)$o(Qe[Pt],ac+Pt);for(rs(Ar,fh),La(),sr.profile&&(ge.stats.size=al(ge.internalformat,ge.type,wt.width,wt.height,Ar.genMipmaps,!0)),wt.format=Gr[ge.internalformat],wt.type=fn[ge.type],wt.mag=wr[Ar.magFilter],wt.min=Kr[Ar.minFilter],wt.wrapS=Mn[Ar.wrapS],wt.wrapT=Mn[Ar.wrapT],Pt=0;Pt<6;++Pt)Xs(Qe[Pt]);return wt}function Ut(Ge,mt,we,Ke,Ie){V(!!mt,"must specify image data"),V(typeof Ge=="number"&&Ge===(Ge|0)&&Ge>=0&&Ge<6,"invalid face");var gt=we|0,Pt=Ke|0,Ar=Ie|0,ln=yn();return dr(ln,ge),ln.width=0,ln.height=0,pn(ln,mt),ln.width=ln.width||(ge.width>>Ar)-gt,ln.height=ln.height||(ge.height>>Ar)-Pt,V(ge.type===ln.type&&ge.format===ln.format&&ge.internalformat===ln.internalformat,"incompatible format for texture.subimage"),V(gt>=0&&Pt>=0&&gt+ln.width<=ge.width&&Pt+ln.height<=ge.height,"texture.subimage write out of bounds"),V(ge.mipmask&1<<Ar,"missing mipmap data"),V(ln.data||ln.element||ln.needsCopy,"missing image data"),ks(ge),Qi(ln,ac+Ge,gt,Pt,Ar),La(),bn(ln),wt}function ot(Ge){var mt=Ge|0;if(mt!==ge.width){wt.width=ge.width=mt,wt.height=ge.height=mt,ks(ge);for(var we=0;we<6;++we)for(var Ke=0;ge.mipmask>>Ke;++Ke)H.texImage2D(ac+we,Ke,ge.format,mt>>Ke,mt>>Ke,0,ge.format,ge.type,null);return La(),sr.profile&&(ge.stats.size=al(ge.internalformat,ge.type,wt.width,wt.height,!1,!0)),wt}}return wt(De,Wt,Lt,Un,Ea,Re),wt.subimage=Ut,wt.resize=ot,wt._reglType="textureCube",wt._texture=ge,sr.profile&&(wt.stats=ge.stats),wt.destroy=function(){ge.decRef()},wt}function Ha(){for(var De=0;De<Us;++De)H.activeTexture(vh+De),H.bindTexture(Iu,null),Qo[De]=null;fe(zs).forEach(nu),Vt.cubeCount=0,Vt.textureCount=0}sr.profile&&(Vt.getTotalTextureSize=function(){var De=0;return Object.keys(zs).forEach(function(Wt){De+=zs[Wt].stats.size}),De});function _s(){for(var De=0;De<Us;++De){var Wt=Qo[De];Wt&&(Wt.bindCount=0,Wt.unit=-1,Qo[De]=null)}fe(zs).forEach(function(Lt){Lt.texture=H.createTexture(),H.bindTexture(Lt.target,Lt.texture);for(var Un=0;Un<32;++Un)if((Lt.mipmask&1<<Un)!==0)if(Lt.target===Iu)H.texImage2D(Iu,Un,Lt.internalformat,Lt.width>>Un,Lt.height>>Un,0,Lt.internalformat,Lt.type,null);else for(var Ea=0;Ea<6;++Ea)H.texImage2D(ac+Ea,Un,Lt.internalformat,Lt.width>>Un,Lt.height>>Un,0,Lt.internalformat,Lt.type,null);rs(Lt.texInfo,Lt.target)})}function ff(){for(var De=0;De<Us;++De){var Wt=Qo[De];Wt&&(Wt.bindCount=0,Wt.unit=-1,Qo[De]=null),H.activeTexture(vh+De),H.bindTexture(Iu,null),H.bindTexture(fh,null)}}return{create2D:zi,createCube:ba,clear:Ha,getTexture:function(De){return null},restore:_s,refresh:ff}}var Al=36161,ci=32854,ti=32855,mh=36194,Fs=33189,Ru=36168,Yo=34041,Tl=35907,Jf=34836,Yh=34842,Na=34843,io=[];io[ci]=2,io[ti]=2,io[mh]=2,io[Fs]=2,io[Ru]=1,io[Yo]=4,io[Tl]=4,io[Jf]=16,io[Yh]=8,io[Na]=6;function kp(H,Se,He){return io[H]*Se*He}var Af=function(H,Se,He,Ht,Er){var Vt={rgba4:ci,rgb565:mh,"rgb5 a1":ti,depth:Fs,stencil:Ru,"depth stencil":Yo};Se.ext_srgb&&(Vt.srgba=Tl),Se.ext_color_buffer_half_float&&(Vt.rgba16f=Yh,Vt.rgb16f=Na),Se.webgl_color_buffer_float&&(Vt.rgba32f=Jf);var sr=[];Object.keys(Vt).forEach(function(Zr){var Xr=Vt[Zr];sr[Xr]=Zr});var kr=0,Dr={};function jr(Zr){this.id=kr++,this.refCount=1,this.renderbuffer=Zr,this.format=ci,this.width=0,this.height=0,Er.profile&&(this.stats={size:0})}jr.prototype.decRef=function(){--this.refCount<=0&&qr(this)};function qr(Zr){var Xr=Zr.renderbuffer;V(Xr,"must not double destroy renderbuffer"),H.bindRenderbuffer(Al,null),H.deleteRenderbuffer(Xr),Zr.renderbuffer=null,Zr.refCount=0,delete Dr[Zr.id],Ht.renderbufferCount--}function $r(Zr,Xr){var Ct=new jr(H.createRenderbuffer());Dr[Ct.id]=Ct,Ht.renderbufferCount++;function er(fn,wr){var Kr=0,Mn=0,pi=ci;if(typeof fn=="object"&&fn){var or=fn;if("shape"in or){var dr=or.shape;V(Array.isArray(dr)&&dr.length>=2,"invalid renderbuffer shape"),Kr=dr[0]|0,Mn=dr[1]|0}else"radius"in or&&(Kr=Mn=or.radius|0),"width"in or&&(Kr=or.width|0),"height"in or&&(Mn=or.height|0);"format"in or&&(V.parameter(or.format,Vt,"invalid renderbuffer format"),pi=Vt[or.format])}else typeof fn=="number"?(Kr=fn|0,typeof wr=="number"?Mn=wr|0:Mn=Kr):fn?V.raise("invalid arguments to renderbuffer constructor"):Kr=Mn=1;if(V(Kr>0&&Mn>0&&Kr<=He.maxRenderbufferSize&&Mn<=He.maxRenderbufferSize,"invalid renderbuffer size"),!(Kr===Ct.width&&Mn===Ct.height&&pi===Ct.format))return er.width=Ct.width=Kr,er.height=Ct.height=Mn,Ct.format=pi,H.bindRenderbuffer(Al,Ct.renderbuffer),H.renderbufferStorage(Al,pi,Kr,Mn),V(H.getError()===0,"invalid render buffer format"),Er.profile&&(Ct.stats.size=kp(Ct.format,Ct.width,Ct.height)),er.format=sr[Ct.format],er}function Gr(fn,wr){var Kr=fn|0,Mn=wr|0||Kr;return Kr===Ct.width&&Mn===Ct.height||(V(Kr>0&&Mn>0&&Kr<=He.maxRenderbufferSize&&Mn<=He.maxRenderbufferSize,"invalid renderbuffer size"),er.width=Ct.width=Kr,er.height=Ct.height=Mn,H.bindRenderbuffer(Al,Ct.renderbuffer),H.renderbufferStorage(Al,Ct.format,Kr,Mn),V(H.getError()===0,"invalid render buffer format"),Er.profile&&(Ct.stats.size=kp(Ct.format,Ct.width,Ct.height))),er}return er(Zr,Xr),er.resize=Gr,er._reglType="renderbuffer",er._renderbuffer=Ct,Er.profile&&(er.stats=Ct.stats),er.destroy=function(){Ct.decRef()},er}Er.profile&&(Ht.getTotalRenderbufferSize=function(){var Zr=0;return Object.keys(Dr).forEach(function(Xr){Zr+=Dr[Xr].stats.size}),Zr});function gn(){fe(Dr).forEach(function(Zr){Zr.renderbuffer=H.createRenderbuffer(),H.bindRenderbuffer(Al,Zr.renderbuffer),H.renderbufferStorage(Al,Zr.format,Zr.width,Zr.height)}),H.bindRenderbuffer(Al,null)}return{create:$r,clear:function(){fe(Dr).forEach(qr)},restore:gn}},Ml=36160,kl=36161,za=3553,Il=34069,fc=36064,qh=36096,Rc=36128,gh=33306,hc=36053,pc=36054,Wl=36055,eh=36057,dc=36061,vc=36193,th=5121,ef=5126,ol=6407,rh=6408,hu=6402,Ip=[ol,rh],tf=[];tf[rh]=4,tf[ol]=3;var c=[];c[th]=1,c[ef]=4,c[vc]=2;var h=32854,f=32855,m=36194,S=33189,k=36168,P=34041,N=35907,Y=34836,te=34842,ye=34843,le=[h,f,m,N,te,ye,Y],xe={};xe[hc]="complete",xe[pc]="incomplete attachment",xe[eh]="incomplete dimensions",xe[Wl]="incomplete, missing attachment",xe[dc]="unsupported";function ze(H,Se,He,Ht,Er,Vt){var sr={cur:null,next:null,dirty:!1,setFBO:null},kr=["rgba"],Dr=["rgba4","rgb565","rgb5 a1"];Se.ext_srgb&&Dr.push("srgba"),Se.ext_color_buffer_half_float&&Dr.push("rgba16f","rgb16f"),Se.webgl_color_buffer_float&&Dr.push("rgba32f");var jr=["uint8"];Se.oes_texture_half_float&&jr.push("half float","float16"),Se.oes_texture_float&&jr.push("float","float32");function qr(Hr,pn,kn){this.target=Hr,this.texture=pn,this.renderbuffer=kn;var Qi=0,Ri=0;pn?(Qi=pn.width,Ri=pn.height):kn&&(Qi=kn.width,Ri=kn.height),this.width=Qi,this.height=Ri}function $r(Hr){Hr&&(Hr.texture&&Hr.texture._texture.decRef(),Hr.renderbuffer&&Hr.renderbuffer._renderbuffer.decRef())}function gn(Hr,pn,kn){if(!!Hr)if(Hr.texture){var Qi=Hr.texture._texture,Ri=Math.max(1,Qi.width),yn=Math.max(1,Qi.height);V(Ri===pn&&yn===kn,"inconsistent width/height for supplied texture"),Qi.refCount+=1}else{var bn=Hr.renderbuffer._renderbuffer;V(bn.width===pn&&bn.height===kn,"inconsistent width/height for renderbuffer"),bn.refCount+=1}}function Zr(Hr,pn){pn&&(pn.texture?H.framebufferTexture2D(Ml,Hr,pn.target,pn.texture._texture.texture,0):H.framebufferRenderbuffer(Ml,Hr,kl,pn.renderbuffer._renderbuffer.renderbuffer))}function Xr(Hr){var pn=za,kn=null,Qi=null,Ri=Hr;typeof Hr=="object"&&(Ri=Hr.data,"target"in Hr&&(pn=Hr.target|0)),V.type(Ri,"function","invalid attachment data");var yn=Ri._reglType;return yn==="texture2d"?(kn=Ri,V(pn===za)):yn==="textureCube"?(kn=Ri,V(pn>=Il&&pn<Il+6,"invalid cube map target")):yn==="renderbuffer"?(Qi=Ri,pn=kl):V.raise("invalid regl object for attachment"),new qr(pn,kn,Qi)}function Ct(Hr,pn,kn,Qi,Ri){if(kn){var yn=Ht.create2D({width:Hr,height:pn,format:Qi,type:Ri});return yn._texture.refCount=0,new qr(za,yn,null)}else{var bn=Er.create({width:Hr,height:pn,format:Qi});return bn._renderbuffer.refCount=0,new qr(kl,null,bn)}}function er(Hr){return Hr&&(Hr.texture||Hr.renderbuffer)}function Gr(Hr,pn,kn){Hr&&(Hr.texture?Hr.texture.resize(pn,kn):Hr.renderbuffer&&Hr.renderbuffer.resize(pn,kn),Hr.width=pn,Hr.height=kn)}var fn=0,wr={};function Kr(){this.id=fn++,wr[this.id]=this,this.framebuffer=H.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Mn(Hr){Hr.colorAttachments.forEach($r),$r(Hr.depthAttachment),$r(Hr.stencilAttachment),$r(Hr.depthStencilAttachment)}function pi(Hr){var pn=Hr.framebuffer;V(pn,"must not double destroy framebuffer"),H.deleteFramebuffer(pn),Hr.framebuffer=null,Vt.framebufferCount--,delete wr[Hr.id]}function or(Hr){var pn;H.bindFramebuffer(Ml,Hr.framebuffer);var kn=Hr.colorAttachments;for(pn=0;pn<kn.length;++pn)Zr(fc+pn,kn[pn]);for(pn=kn.length;pn<He.maxColorAttachments;++pn)H.framebufferTexture2D(Ml,fc+pn,za,null,0);H.framebufferTexture2D(Ml,gh,za,null,0),H.framebufferTexture2D(Ml,qh,za,null,0),H.framebufferTexture2D(Ml,Rc,za,null,0),Zr(qh,Hr.depthAttachment),Zr(Rc,Hr.stencilAttachment),Zr(gh,Hr.depthStencilAttachment);var Qi=H.checkFramebufferStatus(Ml);!H.isContextLost()&&Qi!==hc&&V.raise("framebuffer configuration not supported, status = "+xe[Qi]),H.bindFramebuffer(Ml,sr.next?sr.next.framebuffer:null),sr.cur=sr.next,H.getError()}function dr(Hr,pn){var kn=new Kr;Vt.framebufferCount++;function Qi(yn,bn){var Ai;V(sr.next!==kn,"can not update framebuffer which is currently in use");var Xi=0,xa=0,$o=!0,Ko=!0,ma=null,Xs=!0,Mo="rgba",Ns="uint8",rs=1,Ys=null,zs=null,Us=null,Qo=!1;if(typeof yn=="number")Xi=yn|0,xa=bn|0||Xi;else if(!yn)Xi=xa=1;else{V.type(yn,"object","invalid arguments for framebuffer");var ta=yn;if("shape"in ta){var ks=ta.shape;V(Array.isArray(ks)&&ks.length>=2,"invalid shape for framebuffer"),Xi=ks[0],xa=ks[1]}else"radius"in ta&&(Xi=xa=ta.radius),"width"in ta&&(Xi=ta.width),"height"in ta&&(xa=ta.height);("color"in ta||"colors"in ta)&&(ma=ta.color||ta.colors,Array.isArray(ma)&&V(ma.length===1||Se.webgl_draw_buffers,"multiple render targets not supported")),ma||("colorCount"in ta&&(rs=ta.colorCount|0,V(rs>0,"invalid color buffer count")),"colorTexture"in ta&&(Xs=!!ta.colorTexture,Mo="rgba4"),"colorType"in ta&&(Ns=ta.colorType,Xs?(V(Se.oes_texture_float||!(Ns==="float"||Ns==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),V(Se.oes_texture_half_float||!(Ns==="half float"||Ns==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Ns==="half float"||Ns==="float16"?(V(Se.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Mo="rgba16f"):(Ns==="float"||Ns==="float32")&&(V(Se.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Mo="rgba32f"),V.oneOf(Ns,jr,"invalid color type")),"colorFormat"in ta&&(Mo=ta.colorFormat,kr.indexOf(Mo)>=0?Xs=!0:Dr.indexOf(Mo)>=0?Xs=!1:V.optional(function(){Xs?V.oneOf(ta.colorFormat,kr,"invalid color format for texture"):V.oneOf(ta.colorFormat,Dr,"invalid color format for renderbuffer")}))),("depthTexture"in ta||"depthStencilTexture"in ta)&&(Qo=!!(ta.depthTexture||ta.depthStencilTexture),V(!Qo||Se.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in ta&&(typeof ta.depth=="boolean"?$o=ta.depth:(Ys=ta.depth,Ko=!1)),"stencil"in ta&&(typeof ta.stencil=="boolean"?Ko=ta.stencil:(zs=ta.stencil,$o=!1)),"depthStencil"in ta&&(typeof ta.depthStencil=="boolean"?$o=Ko=ta.depthStencil:(Us=ta.depthStencil,$o=!1,Ko=!1))}var La=null,nu=null,zi=null,ba=null;if(Array.isArray(ma))La=ma.map(Xr);else if(ma)La=[Xr(ma)];else for(La=new Array(rs),Ai=0;Ai<rs;++Ai)La[Ai]=Ct(Xi,xa,Xs,Mo,Ns);V(Se.webgl_draw_buffers||La.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),V(La.length<=He.maxColorAttachments,"too many color attachments, not supported"),Xi=Xi||La[0].width,xa=xa||La[0].height,Ys?nu=Xr(Ys):$o&&!Ko&&(nu=Ct(Xi,xa,Qo,"depth","uint32")),zs?zi=Xr(zs):Ko&&!$o&&(zi=Ct(Xi,xa,!1,"stencil","uint8")),Us?ba=Xr(Us):!Ys&&!zs&&Ko&&$o&&(ba=Ct(Xi,xa,Qo,"depth stencil","depth stencil")),V(!!Ys+!!zs+!!Us<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Ha=null;for(Ai=0;Ai<La.length;++Ai)if(gn(La[Ai],Xi,xa),V(!La[Ai]||La[Ai].texture&&Ip.indexOf(La[Ai].texture._texture.format)>=0||La[Ai].renderbuffer&&le.indexOf(La[Ai].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ai+" is invalid"),La[Ai]&&La[Ai].texture){var _s=tf[La[Ai].texture._texture.format]*c[La[Ai].texture._texture.type];Ha===null?Ha=_s:V(Ha===_s,"all color attachments much have the same number of bits per pixel.")}return gn(nu,Xi,xa),V(!nu||nu.texture&&nu.texture._texture.format===hu||nu.renderbuffer&&nu.renderbuffer._renderbuffer.format===S,"invalid depth attachment for framebuffer object"),gn(zi,Xi,xa),V(!zi||zi.renderbuffer&&zi.renderbuffer._renderbuffer.format===k,"invalid stencil attachment for framebuffer object"),gn(ba,Xi,xa),V(!ba||ba.texture&&ba.texture._texture.format===P||ba.renderbuffer&&ba.renderbuffer._renderbuffer.format===P,"invalid depth-stencil attachment for framebuffer object"),Mn(kn),kn.width=Xi,kn.height=xa,kn.colorAttachments=La,kn.depthAttachment=nu,kn.stencilAttachment=zi,kn.depthStencilAttachment=ba,Qi.color=La.map(er),Qi.depth=er(nu),Qi.stencil=er(zi),Qi.depthStencil=er(ba),Qi.width=kn.width,Qi.height=kn.height,or(kn),Qi}function Ri(yn,bn){V(sr.next!==kn,"can not resize a framebuffer which is currently in use");var Ai=Math.max(yn|0,1),Xi=Math.max(bn|0||Ai,1);if(Ai===kn.width&&Xi===kn.height)return Qi;for(var xa=kn.colorAttachments,$o=0;$o<xa.length;++$o)Gr(xa[$o],Ai,Xi);return Gr(kn.depthAttachment,Ai,Xi),Gr(kn.stencilAttachment,Ai,Xi),Gr(kn.depthStencilAttachment,Ai,Xi),kn.width=Qi.width=Ai,kn.height=Qi.height=Xi,or(kn),Qi}return Qi(Hr,pn),x(Qi,{resize:Ri,_reglType:"framebuffer",_framebuffer:kn,destroy:function(){pi(kn),Mn(kn)},use:function(yn){sr.setFBO({framebuffer:Qi},yn)}})}function qn(Hr){var pn=Array(6);function kn(Ri){var yn;V(pn.indexOf(sr.next)<0,"can not update framebuffer which is currently in use");var bn={color:null},Ai=0,Xi=null,xa="rgba",$o="uint8",Ko=1;if(typeof Ri=="number")Ai=Ri|0;else if(!Ri)Ai=1;else{V.type(Ri,"object","invalid arguments for framebuffer");var ma=Ri;if("shape"in ma){var Xs=ma.shape;V(Array.isArray(Xs)&&Xs.length>=2,"invalid shape for framebuffer"),V(Xs[0]===Xs[1],"cube framebuffer must be square"),Ai=Xs[0]}else"radius"in ma&&(Ai=ma.radius|0),"width"in ma?(Ai=ma.width|0,"height"in ma&&V(ma.height===Ai,"must be square")):"height"in ma&&(Ai=ma.height|0);("color"in ma||"colors"in ma)&&(Xi=ma.color||ma.colors,Array.isArray(Xi)&&V(Xi.length===1||Se.webgl_draw_buffers,"multiple render targets not supported")),Xi||("colorCount"in ma&&(Ko=ma.colorCount|0,V(Ko>0,"invalid color buffer count")),"colorType"in ma&&(V.oneOf(ma.colorType,jr,"invalid color type"),$o=ma.colorType),"colorFormat"in ma&&(xa=ma.colorFormat,V.oneOf(ma.colorFormat,kr,"invalid color format for texture"))),"depth"in ma&&(bn.depth=ma.depth),"stencil"in ma&&(bn.stencil=ma.stencil),"depthStencil"in ma&&(bn.depthStencil=ma.depthStencil)}var Mo;if(Xi)if(Array.isArray(Xi))for(Mo=[],yn=0;yn<Xi.length;++yn)Mo[yn]=Xi[yn];else Mo=[Xi];else{Mo=Array(Ko);var Ns={radius:Ai,format:xa,type:$o};for(yn=0;yn<Ko;++yn)Mo[yn]=Ht.createCube(Ns)}for(bn.color=Array(Mo.length),yn=0;yn<Mo.length;++yn){var rs=Mo[yn];V(typeof rs=="function"&&rs._reglType==="textureCube","invalid cube map"),Ai=Ai||rs.width,V(rs.width===Ai&&rs.height===Ai,"invalid cube map shape"),bn.color[yn]={target:Il,data:Mo[yn]}}for(yn=0;yn<6;++yn){for(var Ys=0;Ys<Mo.length;++Ys)bn.color[Ys].target=Il+yn;yn>0&&(bn.depth=pn[0].depth,bn.stencil=pn[0].stencil,bn.depthStencil=pn[0].depthStencil),pn[yn]?pn[yn](bn):pn[yn]=dr(bn)}return x(kn,{width:Ai,height:Ai,color:Mo})}function Qi(Ri){var yn,bn=Ri|0;if(V(bn>0&&bn<=He.maxCubeMapSize,"invalid radius for cube fbo"),bn===kn.width)return kn;var Ai=kn.color;for(yn=0;yn<Ai.length;++yn)Ai[yn].resize(bn);for(yn=0;yn<6;++yn)pn[yn].resize(bn);return kn.width=kn.height=bn,kn}return kn(Hr),x(kn,{faces:pn,resize:Qi,_reglType:"framebufferCube",destroy:function(){pn.forEach(function(Ri){Ri.destroy()})}})}function xn(){sr.cur=null,sr.next=null,sr.dirty=!0,fe(wr).forEach(function(Hr){Hr.framebuffer=H.createFramebuffer(),or(Hr)})}return x(sr,{getFramebuffer:function(Hr){if(typeof Hr=="function"&&Hr._reglType==="framebuffer"){var pn=Hr._framebuffer;if(pn instanceof Kr)return pn}return null},create:dr,createCube:qn,clear:function(){fe(wr).forEach(pi)},restore:xn})}var Ue=5126,Je=34962,Fe=34963,et=["attributes","elements","offset","count","primitive","instances"];function pt(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ue,this.offset=0,this.stride=0,this.divisor=0}function kt(H,Se,He,Ht,Er,Vt,sr){for(var kr=He.maxAttributes,Dr=new Array(kr),jr=0;jr<kr;++jr)Dr[jr]=new pt;var qr=0,$r={},gn={Record:pt,scope:{},state:Dr,currentVAO:null,targetVAO:null,restore:Xr()?Mn:function(){},createVAO:pi,getVAO:er,destroyBuffer:Zr,setVAO:Xr()?Gr:fn,clear:Xr()?wr:function(){}};function Zr(or){for(var dr=0;dr<Dr.length;++dr){var qn=Dr[dr];qn.buffer===or&&(H.disableVertexAttribArray(dr),qn.buffer=null)}}function Xr(){return Se.oes_vertex_array_object}function Ct(){return Se.angle_instanced_arrays}function er(or){return typeof or=="function"&&or._vao?or._vao:null}function Gr(or){if(or!==gn.currentVAO){var dr=Xr();or?dr.bindVertexArrayOES(or.vao):dr.bindVertexArrayOES(null),gn.currentVAO=or}}function fn(or){if(or!==gn.currentVAO){if(or)or.bindAttrs();else{for(var dr=Ct(),qn=0;qn<Dr.length;++qn){var xn=Dr[qn];xn.buffer?(H.enableVertexAttribArray(qn),xn.buffer.bind(),H.vertexAttribPointer(qn,xn.size,xn.type,xn.normalized,xn.stride,xn.offfset),dr&&xn.divisor&&dr.vertexAttribDivisorANGLE(qn,xn.divisor)):(H.disableVertexAttribArray(qn),H.vertexAttrib4f(qn,xn.x,xn.y,xn.z,xn.w))}sr.elements?H.bindBuffer(Fe,sr.elements.buffer.buffer):H.bindBuffer(Fe,null)}gn.currentVAO=or}}function wr(){fe($r).forEach(function(or){or.destroy()})}function Kr(){this.id=++qr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var or=Xr();or?this.vao=or.createVertexArrayOES():this.vao=null,$r[this.id]=this,this.buffers=[]}Kr.prototype.bindAttrs=function(){for(var or=Ct(),dr=this.attributes,qn=0;qn<dr.length;++qn){var xn=dr[qn];xn.buffer?(H.enableVertexAttribArray(qn),H.bindBuffer(Je,xn.buffer.buffer),H.vertexAttribPointer(qn,xn.size,xn.type,xn.normalized,xn.stride,xn.offset),or&&xn.divisor&&or.vertexAttribDivisorANGLE(qn,xn.divisor)):(H.disableVertexAttribArray(qn),H.vertexAttrib4f(qn,xn.x,xn.y,xn.z,xn.w))}for(var Hr=dr.length;Hr<kr;++Hr)H.disableVertexAttribArray(Hr);var pn=Vt.getElements(this.elements);pn?H.bindBuffer(Fe,pn.buffer.buffer):H.bindBuffer(Fe,null)},Kr.prototype.refresh=function(){var or=Xr();or&&(or.bindVertexArrayOES(this.vao),this.bindAttrs(),gn.currentVAO=null,or.bindVertexArrayOES(null))},Kr.prototype.destroy=function(){if(this.vao){var or=Xr();this===gn.currentVAO&&(gn.currentVAO=null,or.bindVertexArrayOES(null)),or.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),$r[this.id]&&(delete $r[this.id],Ht.vaoCount-=1)};function Mn(){var or=Xr();or&&fe($r).forEach(function(dr){dr.refresh()})}function pi(or){var dr=new Kr;Ht.vaoCount+=1;function qn(xn){var Hr;if(Array.isArray(xn))Hr=xn,dr.elements&&dr.ownsElements&&dr.elements.destroy(),dr.elements=null,dr.ownsElements=!1,dr.offset=0,dr.count=0,dr.instances=-1,dr.primitive=4;else{if(V(typeof xn=="object","invalid arguments for create vao"),V("attributes"in xn,"must specify attributes for vao"),xn.elements){var pn=xn.elements;dr.ownsElements?typeof pn=="function"&&pn._reglType==="elements"?(dr.elements.destroy(),dr.ownsElements=!1):(dr.elements(pn),dr.ownsElements=!1):Vt.getElements(xn.elements)?(dr.elements=xn.elements,dr.ownsElements=!1):(dr.elements=Vt.create(xn.elements),dr.ownsElements=!0)}else dr.elements=null,dr.ownsElements=!1;Hr=xn.attributes,dr.offset=0,dr.count=-1,dr.instances=-1,dr.primitive=4,dr.elements&&(dr.count=dr.elements._elements.vertCount,dr.primitive=dr.elements._elements.primType),"offset"in xn&&(dr.offset=xn.offset|0),"count"in xn&&(dr.count=xn.count|0),"instances"in xn&&(dr.instances=xn.instances|0),"primitive"in xn&&(V(xn.primitive in _r,"bad primitive type: "+xn.primitive),dr.primitive=_r[xn.primitive]),V.optional(function(){for(var $o=Object.keys(xn),Ko=0;Ko<$o.length;++Ko)V(et.indexOf($o[Ko])>=0,'invalid option for vao: "'+$o[Ko]+'" valid options are '+et)}),V(Array.isArray(Hr),"attributes must be an array")}V(Hr.length<kr,"too many attributes"),V(Hr.length>0,"must specify at least one attribute");var kn={},Qi=dr.attributes;Qi.length=Hr.length;for(var Ri=0;Ri<Hr.length;++Ri){var yn=Hr[Ri],bn=Qi[Ri]=new pt,Ai=yn.data||yn;if(Array.isArray(Ai)||Ft(Ai)||Wo(Ai)){var Xi;dr.buffers[Ri]&&(Xi=dr.buffers[Ri],Ft(Ai)&&Xi._buffer.byteLength>=Ai.byteLength?Xi.subdata(Ai):(Xi.destroy(),dr.buffers[Ri]=null)),dr.buffers[Ri]||(Xi=dr.buffers[Ri]=Er.create(yn,Je,!1,!0)),bn.buffer=Er.getBuffer(Xi),bn.size=bn.buffer.dimension|0,bn.normalized=!1,bn.type=bn.buffer.dtype,bn.offset=0,bn.stride=0,bn.divisor=0,bn.state=1,kn[Ri]=1}else Er.getBuffer(yn)?(bn.buffer=Er.getBuffer(yn),bn.size=bn.buffer.dimension|0,bn.normalized=!1,bn.type=bn.buffer.dtype,bn.offset=0,bn.stride=0,bn.divisor=0,bn.state=1):Er.getBuffer(yn.buffer)?(bn.buffer=Er.getBuffer(yn.buffer),bn.size=(+yn.size||bn.buffer.dimension)|0,bn.normalized=!!yn.normalized||!1,"type"in yn?(V.parameter(yn.type,Uo,"invalid buffer type"),bn.type=Uo[yn.type]):bn.type=bn.buffer.dtype,bn.offset=(yn.offset||0)|0,bn.stride=(yn.stride||0)|0,bn.divisor=(yn.divisor||0)|0,bn.state=1,V(bn.size>=1&&bn.size<=4,"size must be between 1 and 4"),V(bn.offset>=0,"invalid offset"),V(bn.stride>=0&&bn.stride<=255,"stride must be between 0 and 255"),V(bn.divisor>=0,"divisor must be positive"),V(!bn.divisor||!!Se.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in yn?(V(Ri>0,"first attribute must not be a constant"),bn.x=+yn.x||0,bn.y=+yn.y||0,bn.z=+yn.z||0,bn.w=+yn.w||0,bn.state=2):V(!1,"invalid attribute spec for location "+Ri)}for(var xa=0;xa<dr.buffers.length;++xa)!kn[xa]&&dr.buffers[xa]&&(dr.buffers[xa].destroy(),dr.buffers[xa]=null);return dr.refresh(),qn}return qn.destroy=function(){for(var xn=0;xn<dr.buffers.length;++xn)dr.buffers[xn]&&dr.buffers[xn].destroy();dr.buffers.length=0,dr.ownsElements&&(dr.elements.destroy(),dr.elements=null,dr.ownsElements=!1),dr.destroy()},qn._vao=dr,qn._reglType="vao",qn(or)}return gn}var Qt=35632,Bt=35633,nr=35718,Or=35721;function un(H,Se,He,Ht){var Er={},Vt={};function sr(Ct,er,Gr,fn){this.name=Ct,this.id=er,this.location=Gr,this.info=fn}function kr(Ct,er){for(var Gr=0;Gr<Ct.length;++Gr)if(Ct[Gr].id===er.id){Ct[Gr].location=er.location;return}Ct.push(er)}function Dr(Ct,er,Gr){var fn=Ct===Qt?Er:Vt,wr=fn[er];if(!wr){var Kr=Se.str(er);wr=H.createShader(Ct),H.shaderSource(wr,Kr),H.compileShader(wr),V.shaderError(H,wr,Kr,Ct,Gr),fn[er]=wr}return wr}var jr={},qr=[],$r=0;function gn(Ct,er){this.id=$r++,this.fragId=Ct,this.vertId=er,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Ht.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Zr(Ct,er,Gr){var fn,wr,Kr=Dr(Qt,Ct.fragId),Mn=Dr(Bt,Ct.vertId),pi=Ct.program=H.createProgram();if(H.attachShader(pi,Kr),H.attachShader(pi,Mn),Gr)for(fn=0;fn<Gr.length;++fn){var or=Gr[fn];H.bindAttribLocation(pi,or[0],or[1])}H.linkProgram(pi),V.linkError(H,pi,Se.str(Ct.fragId),Se.str(Ct.vertId),er);var dr=H.getProgramParameter(pi,nr);Ht.profile&&(Ct.stats.uniformsCount=dr);var qn=Ct.uniforms;for(fn=0;fn<dr;++fn)if(wr=H.getActiveUniform(pi,fn),wr)if(wr.size>1)for(var xn=0;xn<wr.size;++xn){var Hr=wr.name.replace("[0]","["+xn+"]");kr(qn,new sr(Hr,Se.id(Hr),H.getUniformLocation(pi,Hr),wr))}else kr(qn,new sr(wr.name,Se.id(wr.name),H.getUniformLocation(pi,wr.name),wr));var pn=H.getProgramParameter(pi,Or);Ht.profile&&(Ct.stats.attributesCount=pn);var kn=Ct.attributes;for(fn=0;fn<pn;++fn)wr=H.getActiveAttrib(pi,fn),wr&&kr(kn,new sr(wr.name,Se.id(wr.name),H.getAttribLocation(pi,wr.name),wr))}Ht.profile&&(He.getMaxUniformsCount=function(){var Ct=0;return qr.forEach(function(er){er.stats.uniformsCount>Ct&&(Ct=er.stats.uniformsCount)}),Ct},He.getMaxAttributesCount=function(){var Ct=0;return qr.forEach(function(er){er.stats.attributesCount>Ct&&(Ct=er.stats.attributesCount)}),Ct});function Xr(){Er={},Vt={};for(var Ct=0;Ct<qr.length;++Ct)Zr(qr[Ct],null,qr[Ct].attributes.map(function(er){return[er.location,er.name]}))}return{clear:function(){var Ct=H.deleteShader.bind(H);fe(Er).forEach(Ct),Er={},fe(Vt).forEach(Ct),Vt={},qr.forEach(function(er){H.deleteProgram(er.program)}),qr.length=0,jr={},He.shaderCount=0},program:function(Ct,er,Gr,fn){V.command(Ct>=0,"missing vertex shader",Gr),V.command(er>=0,"missing fragment shader",Gr);var wr=jr[er];wr||(wr=jr[er]={});var Kr=wr[Ct];if(Kr&&(Kr.refCount++,!fn))return Kr;var Mn=new gn(er,Ct);return He.shaderCount++,Zr(Mn,Gr,fn),Kr||(wr[Ct]=Mn),qr.push(Mn),x(Mn,{destroy:function(){if(Mn.refCount--,Mn.refCount<=0){H.deleteProgram(Mn.program);var pi=qr.indexOf(Mn);qr.splice(pi,1),He.shaderCount--}wr[Mn.vertId].refCount<=0&&(H.deleteShader(Vt[Mn.vertId]),delete Vt[Mn.vertId],delete jr[Mn.fragId][Mn.vertId]),Object.keys(jr[Mn.fragId]).length||(H.deleteShader(Er[Mn.fragId]),delete Er[Mn.fragId],delete jr[Mn.fragId])}})},restore:Xr,shader:Dr,frag:-1,vert:-1}}var rn=6408,Pn=5121,ui=3333,gi=5126;function fi(H,Se,He,Ht,Er,Vt,sr){function kr(qr){var $r;Se.next===null?(V(Er.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),$r=Pn):(V(Se.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),$r=Se.next.colorAttachments[0].texture._texture.type,V.optional(function(){Vt.oes_texture_float?(V($r===Pn||$r===gi,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),$r===gi&&V(sr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):V($r===Pn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var gn=0,Zr=0,Xr=Ht.framebufferWidth,Ct=Ht.framebufferHeight,er=null;Ft(qr)?er=qr:qr&&(V.type(qr,"object","invalid arguments to regl.read()"),gn=qr.x|0,Zr=qr.y|0,V(gn>=0&&gn<Ht.framebufferWidth,"invalid x offset for regl.read"),V(Zr>=0&&Zr<Ht.framebufferHeight,"invalid y offset for regl.read"),Xr=(qr.width||Ht.framebufferWidth-gn)|0,Ct=(qr.height||Ht.framebufferHeight-Zr)|0,er=qr.data||null),er&&($r===Pn?V(er instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):$r===gi&&V(er instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),V(Xr>0&&Xr+gn<=Ht.framebufferWidth,"invalid width for read pixels"),V(Ct>0&&Ct+Zr<=Ht.framebufferHeight,"invalid height for read pixels"),He();var Gr=Xr*Ct*4;return er||($r===Pn?er=new Uint8Array(Gr):$r===gi&&(er=er||new Float32Array(Gr))),V.isTypedArray(er,"data buffer for regl.read() must be a typedarray"),V(er.byteLength>=Gr,"data buffer for regl.read() too small"),H.pixelStorei(ui,4),H.readPixels(gn,Zr,Xr,Ct,rn,$r,er),er}function Dr(qr){var $r;return Se.setFBO({framebuffer:qr.framebuffer},function(){$r=kr(qr)}),$r}function jr(qr){return!qr||!("framebuffer"in qr)?kr(qr):Dr(qr)}return jr}function _a(H){return Array.prototype.slice.call(H)}function Dn(H){return _a(H).join("")}function Ii(){var H=0,Se=[],He=[];function Ht($r){for(var gn=0;gn<He.length;++gn)if(He[gn]===$r)return Se[gn];var Zr="g"+H++;return Se.push(Zr),He.push($r),Zr}function Er(){var $r=[];function gn(){$r.push.apply($r,_a(arguments))}var Zr=[];function Xr(){var Ct="v"+H++;return Zr.push(Ct),arguments.length>0&&($r.push(Ct,"="),$r.push.apply($r,_a(arguments)),$r.push(";")),Ct}return x(gn,{def:Xr,toString:function(){return Dn([Zr.length>0?"var "+Zr.join(",")+";":"",Dn($r)])}})}function Vt(){var $r=Er(),gn=Er(),Zr=$r.toString,Xr=gn.toString;function Ct(er,Gr){gn(er,Gr,"=",$r.def(er,Gr),";")}return x(function(){$r.apply($r,_a(arguments))},{def:$r.def,entry:$r,exit:gn,save:Ct,set:function(er,Gr,fn){Ct(er,Gr),$r(er,Gr,"=",fn,";")},toString:function(){return Zr()+Xr()}})}function sr(){var $r=Dn(arguments),gn=Vt(),Zr=Vt(),Xr=gn.toString,Ct=Zr.toString;return x(gn,{then:function(){return gn.apply(gn,_a(arguments)),this},else:function(){return Zr.apply(Zr,_a(arguments)),this},toString:function(){var er=Ct();return er&&(er="else{"+er+"}"),Dn(["if(",$r,"){",Xr(),"}",er])}})}var kr=Er(),Dr={};function jr($r,gn){var Zr=[];function Xr(){var wr="a"+Zr.length;return Zr.push(wr),wr}gn=gn||0;for(var Ct=0;Ct<gn;++Ct)Xr();var er=Vt(),Gr=er.toString,fn=Dr[$r]=x(er,{arg:Xr,toString:function(){return Dn(["function(",Zr.join(),"){",Gr(),"}"])}});return fn}function qr(){var $r=['"use strict";',kr,"return {"];Object.keys(Dr).forEach(function(Ct){$r.push('"',Ct,'":',Dr[Ct].toString(),",")}),$r.push("}");var gn=Dn($r).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Zr=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Xr=Zr?rr.Function.apply(null,Se.concat(gn)):Function.apply(null,Se.concat(gn));return Xr.apply(null,He)}return{global:kr,link:Ht,block:Er,proc:jr,scope:Vt,cond:sr,compile:qr}}var Wi="xyzw".split(""),Bi=5121,wi=1,Ki=2,Ci=0,Si=1,gs=2,qo=3,Ds=4,es=5,vo=6,lo="dither",pu="blend.enable",Js="blend.color",Xl="blend.equation",du="blend.func",Xu="depth.enable",eu="depth.func",Tf="depth.range",rf="depth.mask",Yl="colorMask",sl="cull.enable",Mf="cull.face",ul="frontFace",mc="lineWidth",ql="polygonOffset.enable",ls="polygonOffset.offset",Pl="sample.alpha",Ll="sample.enable",tu="sample.coverage",Pa="stencil.enable",Ou="stencil.mask",Bs="stencil.func",gc="stencil.opFront",kf="stencil.opBack",$h="scissor.enable",Kh="scissor.box",Yu="viewport",Oc="profile",Fu="framebuffer",If="vert",Pf="frag",$l="elements",ys="primitive",Lf="count",Rl="offset",yh="instances",Cu="vao",vu="Width",ee="Height",Ur=Fu+vu,Rf=Fu+ee,cd=Yu+vu,Ws=Yu+ee,mu="drawingBuffer",Kl=mu+vu,Pp=mu+ee,Of=[du,Xl,Bs,gc,kf,tu,Yu,Kh,ls],ru=34962,ll=34963,lv=35632,Dd=35633,Lp=3553,nh=34067,nf=2884,_h=3042,Ff=3024,cs=2960,Qh=2929,fd=3089,Ui=32823,Jh=32926,ep=32928,af=5126,Rp=35664,Su=35665,tp=35666,of=5124,hd=35667,ih=35668,yc=35669,xh=35670,sf=35671,uf=35672,Op=35673,Du=35674,Fc=35675,Bu=35676,Fp=35678,Df=35680,Dp=4,Ql=1028,bh=1029,Bd=2304,Bf=2305,pd=32775,Jl=32776,cl=519,Nu=7680,Dc=0,lf=1,Eh=32774,Bc=513,Bp=36160,Nd=36064,Nc={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Ch=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],ah={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Nf={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},zd={frag:lv,vert:Dd},fl={cw:Bd,ccw:Bf};function Sh(H){return Array.isArray(H)||Ft(H)||Wo(H)}function Ud(H){return H.sort(function(Se,He){return Se===Yu?-1:He===Yu?1:Se<He?-1:1})}function $a(H,Se,He,Ht){this.thisDep=H,this.contextDep=Se,this.propDep=He,this.append=Ht}function wu(H){return H&&!(H.thisDep||H.contextDep||H.propDep)}function Fo(H){return new $a(!1,!1,!1,H)}function Ms(H,Se){var He=H.type;if(He===Ci){var Ht=H.data.length;return new $a(!0,Ht>=1,Ht>=2,Se)}else if(He===Ds){var Er=H.data;return new $a(Er.thisDep,Er.contextDep,Er.propDep,Se)}else{if(He===es)return new $a(!1,!1,!1,Se);if(He===vo){for(var Vt=!1,sr=!1,kr=!1,Dr=0;Dr<H.data.length;++Dr){var jr=H.data[Dr];if(jr.type===Si)kr=!0;else if(jr.type===gs)sr=!0;else if(jr.type===qo)Vt=!0;else if(jr.type===Ci){Vt=!0;var qr=jr.data;qr>=1&&(sr=!0),qr>=2&&(kr=!0)}else jr.type===Ds&&(Vt=Vt||jr.data.thisDep,sr=sr||jr.data.contextDep,kr=kr||jr.data.propDep)}return new $a(Vt,sr,kr,Se)}else return new $a(He===qo,He===gs,He===Si,Se)}}var Zd=new $a(!1,!1,!1,function(){});function dd(H,Se,He,Ht,Er,Vt,sr,kr,Dr,jr,qr,$r,gn,Zr,Xr){var Ct=jr.Record,er={add:32774,subtract:32778,"reverse subtract":32779};He.ext_blend_minmax&&(er.min=pd,er.max=Jl);var Gr=He.angle_instanced_arrays,fn=He.webgl_draw_buffers,wr=He.oes_vertex_array_object,Kr={dirty:!0,profile:Xr.profile},Mn={},pi=[],or={},dr={};function qn(Re){return Re.replace(".","_")}function xn(Re,ge,Qe){var wt=qn(Re);pi.push(Re),Mn[wt]=Kr[wt]=!!Qe,or[wt]=ge}function Hr(Re,ge,Qe){var wt=qn(Re);pi.push(Re),Array.isArray(Qe)?(Kr[wt]=Qe.slice(),Mn[wt]=Qe.slice()):Kr[wt]=Mn[wt]=Qe,dr[wt]=ge}xn(lo,Ff),xn(pu,_h),Hr(Js,"blendColor",[0,0,0,0]),Hr(Xl,"blendEquationSeparate",[Eh,Eh]),Hr(du,"blendFuncSeparate",[lf,Dc,lf,Dc]),xn(Xu,Qh,!0),Hr(eu,"depthFunc",Bc),Hr(Tf,"depthRange",[0,1]),Hr(rf,"depthMask",!0),Hr(Yl,Yl,[!0,!0,!0,!0]),xn(sl,nf),Hr(Mf,"cullFace",bh),Hr(ul,ul,Bf),Hr(mc,mc,1),xn(ql,Ui),Hr(ls,"polygonOffset",[0,0]),xn(Pl,Jh),xn(Ll,ep),Hr(tu,"sampleCoverage",[1,!1]),xn(Pa,cs),Hr(Ou,"stencilMask",-1),Hr(Bs,"stencilFunc",[cl,0,-1]),Hr(gc,"stencilOpSeparate",[Ql,Nu,Nu,Nu]),Hr(kf,"stencilOpSeparate",[bh,Nu,Nu,Nu]),xn($h,fd),Hr(Kh,"scissor",[0,0,H.drawingBufferWidth,H.drawingBufferHeight]),Hr(Yu,Yu,[0,0,H.drawingBufferWidth,H.drawingBufferHeight]);var pn={gl:H,context:gn,strings:Se,next:Mn,current:Kr,draw:$r,elements:Vt,buffer:Er,shader:qr,attributes:jr.state,vao:jr,uniforms:Dr,framebuffer:kr,extensions:He,timer:Zr,isBufferArgs:Sh},kn={primTypes:_r,compareFuncs:ah,blendFuncs:Nc,blendEquations:er,stencilOps:Nf,glTypes:Uo,orientationType:fl};V.optional(function(){pn.isArrayLike=Oo}),fn&&(kn.backBuffer=[bh],kn.drawBuffer=Ye(Ht.maxDrawbuffers,function(Re){return Re===0?[0]:Ye(Re,function(ge){return Nd+ge})}));var Qi=0;function Ri(){var Re=Ii(),ge=Re.link,Qe=Re.global;Re.id=Qi++,Re.batchId="0";var wt=ge(pn),Ut=Re.shared={props:"a0"};Object.keys(pn).forEach(function(Ke){Ut[Ke]=Qe.def(wt,".",Ke)}),V.optional(function(){Re.CHECK=ge(V),Re.commandStr=V.guessCommand(),Re.command=ge(Re.commandStr),Re.assert=function(Ke,Ie,gt){Ke("if(!(",Ie,"))",this.CHECK,".commandRaise(",ge(gt),",",this.command,");")},kn.invalidBlendCombinations=Ch});var ot=Re.next={},Ge=Re.current={};Object.keys(dr).forEach(function(Ke){Array.isArray(Kr[Ke])&&(ot[Ke]=Qe.def(Ut.next,".",Ke),Ge[Ke]=Qe.def(Ut.current,".",Ke))});var mt=Re.constants={};Object.keys(kn).forEach(function(Ke){mt[Ke]=Qe.def(JSON.stringify(kn[Ke]))}),Re.invoke=function(Ke,Ie){switch(Ie.type){case Ci:var gt=["this",Ut.context,Ut.props,Re.batchId];return Ke.def(ge(Ie.data),".call(",gt.slice(0,Math.max(Ie.data.length+1,4)),")");case Si:return Ke.def(Ut.props,Ie.data);case gs:return Ke.def(Ut.context,Ie.data);case qo:return Ke.def("this",Ie.data);case Ds:return Ie.data.append(Re,Ke),Ie.data.ref;case es:return Ie.data.toString();case vo:return Ie.data.map(function(Pt){return Re.invoke(Ke,Pt)})}},Re.attribCache={};var we={};return Re.scopeAttrib=function(Ke){var Ie=Se.id(Ke);if(Ie in we)return we[Ie];var gt=jr.scope[Ie];gt||(gt=jr.scope[Ie]=new Ct);var Pt=we[Ie]=ge(gt);return Pt},Re}function yn(Re){var ge=Re.static,Qe=Re.dynamic,wt;if(Oc in ge){var Ut=!!ge[Oc];wt=Fo(function(Ge,mt){return Ut}),wt.enable=Ut}else if(Oc in Qe){var ot=Qe[Oc];wt=Ms(ot,function(Ge,mt){return Ge.invoke(mt,ot)})}return wt}function bn(Re,ge){var Qe=Re.static,wt=Re.dynamic;if(Fu in Qe){var Ut=Qe[Fu];return Ut?(Ut=kr.getFramebuffer(Ut),V.command(Ut,"invalid framebuffer object"),Fo(function(Ge,mt){var we=Ge.link(Ut),Ke=Ge.shared;mt.set(Ke.framebuffer,".next",we);var Ie=Ke.context;return mt.set(Ie,"."+Ur,we+".width"),mt.set(Ie,"."+Rf,we+".height"),we})):Fo(function(Ge,mt){var we=Ge.shared;mt.set(we.framebuffer,".next","null");var Ke=we.context;return mt.set(Ke,"."+Ur,Ke+"."+Kl),mt.set(Ke,"."+Rf,Ke+"."+Pp),"null"})}else if(Fu in wt){var ot=wt[Fu];return Ms(ot,function(Ge,mt){var we=Ge.invoke(mt,ot),Ke=Ge.shared,Ie=Ke.framebuffer,gt=mt.def(Ie,".getFramebuffer(",we,")");V.optional(function(){Ge.assert(mt,"!"+we+"||"+gt,"invalid framebuffer object")}),mt.set(Ie,".next",gt);var Pt=Ke.context;return mt.set(Pt,"."+Ur,gt+"?"+gt+".width:"+Pt+"."+Kl),mt.set(Pt,"."+Rf,gt+"?"+gt+".height:"+Pt+"."+Pp),gt})}else return null}function Ai(Re,ge,Qe){var wt=Re.static,Ut=Re.dynamic;function ot(we){if(we in wt){var Ke=wt[we];V.commandType(Ke,"object","invalid "+we,Qe.commandStr);var Ie=!0,gt=Ke.x|0,Pt=Ke.y|0,Ar,ln;return"width"in Ke?(Ar=Ke.width|0,V.command(Ar>=0,"invalid "+we,Qe.commandStr)):Ie=!1,"height"in Ke?(ln=Ke.height|0,V.command(ln>=0,"invalid "+we,Qe.commandStr)):Ie=!1,new $a(!Ie&&ge&&ge.thisDep,!Ie&&ge&&ge.contextDep,!Ie&&ge&&ge.propDep,function(dn,ni){var In=dn.shared.context,En=Ar;"width"in Ke||(En=ni.def(In,".",Ur,"-",gt));var Jn=ln;return"height"in Ke||(Jn=ni.def(In,".",Rf,"-",Pt)),[gt,Pt,En,Jn]})}else if(we in Ut){var _n=Ut[we],Ln=Ms(_n,function(dn,ni){var In=dn.invoke(ni,_n);V.optional(function(){dn.assert(ni,In+"&&typeof "+In+'==="object"',"invalid "+we)});var En=dn.shared.context,Jn=ni.def(In,".x|0"),Gn=ni.def(In,".y|0"),Oi=ni.def('"width" in ',In,"?",In,".width|0:","(",En,".",Ur,"-",Jn,")"),Ma=ni.def('"height" in ',In,"?",In,".height|0:","(",En,".",Rf,"-",Gn,")");return V.optional(function(){dn.assert(ni,Oi+">=0&&"+Ma+">=0","invalid "+we)}),[Jn,Gn,Oi,Ma]});return ge&&(Ln.thisDep=Ln.thisDep||ge.thisDep,Ln.contextDep=Ln.contextDep||ge.contextDep,Ln.propDep=Ln.propDep||ge.propDep),Ln}else return ge?new $a(ge.thisDep,ge.contextDep,ge.propDep,function(dn,ni){var In=dn.shared.context;return[0,0,ni.def(In,".",Ur),ni.def(In,".",Rf)]}):null}var Ge=ot(Yu);if(Ge){var mt=Ge;Ge=new $a(Ge.thisDep,Ge.contextDep,Ge.propDep,function(we,Ke){var Ie=mt.append(we,Ke),gt=we.shared.context;return Ke.set(gt,"."+cd,Ie[2]),Ke.set(gt,"."+Ws,Ie[3]),Ie})}return{viewport:Ge,scissor_box:ot(Kh)}}function Xi(Re,ge){var Qe=Re.static,wt=typeof Qe[Pf]=="string"&&typeof Qe[If]=="string";if(wt){if(Object.keys(ge.dynamic).length>0)return null;var Ut=ge.static,ot=Object.keys(Ut);if(ot.length>0&&typeof Ut[ot[0]]=="number"){for(var Ge=[],mt=0;mt<ot.length;++mt)V(typeof Ut[ot[mt]]=="number","must specify all vertex attribute locations when using vaos"),Ge.push([Ut[ot[mt]]|0,ot[mt]]);return Ge}}return null}function xa(Re,ge,Qe){var wt=Re.static,Ut=Re.dynamic;function ot(Ie){if(Ie in wt){var gt=Se.id(wt[Ie]);V.optional(function(){qr.shader(zd[Ie],gt,V.guessCommand())});var Pt=Fo(function(){return gt});return Pt.id=gt,Pt}else if(Ie in Ut){var Ar=Ut[Ie];return Ms(Ar,function(ln,_n){var Ln=ln.invoke(_n,Ar),dn=_n.def(ln.shared.strings,".id(",Ln,")");return V.optional(function(){_n(ln.shared.shader,".shader(",zd[Ie],",",dn,",",ln.command,");")}),dn})}return null}var Ge=ot(Pf),mt=ot(If),we=null,Ke;return wu(Ge)&&wu(mt)?(we=qr.program(mt.id,Ge.id,null,Qe),Ke=Fo(function(Ie,gt){return Ie.link(we)})):Ke=new $a(Ge&&Ge.thisDep||mt&&mt.thisDep,Ge&&Ge.contextDep||mt&&mt.contextDep,Ge&&Ge.propDep||mt&&mt.propDep,function(Ie,gt){var Pt=Ie.shared.shader,Ar;Ge?Ar=Ge.append(Ie,gt):Ar=gt.def(Pt,".",Pf);var ln;mt?ln=mt.append(Ie,gt):ln=gt.def(Pt,".",If);var _n=Pt+".program("+ln+","+Ar;return V.optional(function(){_n+=","+Ie.command}),gt.def(_n+")")}),{frag:Ge,vert:mt,progVar:Ke,program:we}}function $o(Re,ge){var Qe=Re.static,wt=Re.dynamic,Ut={},ot=!1;function Ge(){if(Cu in Qe){var ni=Qe[Cu];return ni!==null&&jr.getVAO(ni)===null&&(ni=jr.createVAO(ni)),ot=!0,Ut.vao=ni,Fo(function(En){var Jn=jr.getVAO(ni);return Jn?En.link(Jn):"null"})}else if(Cu in wt){ot=!0;var In=wt[Cu];return Ms(In,function(En,Jn){var Gn=En.invoke(Jn,In);return Jn.def(En.shared.vao+".getVAO("+Gn+")")})}return null}var mt=Ge(),we=!1;function Ke(){if($l in Qe){var ni=Qe[$l];if(Ut.elements=ni,Sh(ni)){var In=Ut.elements=Vt.create(ni,!0);ni=Vt.getElements(In),we=!0}else ni&&(ni=Vt.getElements(ni),we=!0,V.command(ni,"invalid elements",ge.commandStr));var En=Fo(function(Gn,Oi){if(ni){var Ma=Gn.link(ni);return Gn.ELEMENTS=Ma,Ma}return Gn.ELEMENTS=null,null});return En.value=ni,En}else if($l in wt){we=!0;var Jn=wt[$l];return Ms(Jn,function(Gn,Oi){var Ma=Gn.shared,Is=Ma.isBufferArgs,co=Ma.elements,Ua=Gn.invoke(Oi,Jn),zc=Oi.def("null"),iu=Oi.def(Is,"(",Ua,")"),hl=Gn.cond(iu).then(zc,"=",co,".createStream(",Ua,");").else(zc,"=",co,".getElements(",Ua,");");return V.optional(function(){Gn.assert(hl.else,"!"+Ua+"||"+zc,"invalid elements")}),Oi.entry(hl),Oi.exit(Gn.cond(iu).then(co,".destroyStream(",zc,");")),Gn.ELEMENTS=zc,zc})}else if(ot)return new $a(mt.thisDep,mt.contextDep,mt.propDep,function(Gn,Oi){return Oi.def(Gn.shared.vao+".currentVAO?"+Gn.shared.elements+".getElements("+Gn.shared.vao+".currentVAO.elements):null")});return null}var Ie=Ke();function gt(){if(ys in Qe){var ni=Qe[ys];return Ut.primitive=ni,V.commandParameter(ni,_r,"invalid primitve",ge.commandStr),Fo(function(En,Jn){return _r[ni]})}else if(ys in wt){var In=wt[ys];return Ms(In,function(En,Jn){var Gn=En.constants.primTypes,Oi=En.invoke(Jn,In);return V.optional(function(){En.assert(Jn,Oi+" in "+Gn,"invalid primitive, must be one of "+Object.keys(_r))}),Jn.def(Gn,"[",Oi,"]")})}else{if(we)return wu(Ie)?Ie.value?Fo(function(En,Jn){return Jn.def(En.ELEMENTS,".primType")}):Fo(function(){return Dp}):new $a(Ie.thisDep,Ie.contextDep,Ie.propDep,function(En,Jn){var Gn=En.ELEMENTS;return Jn.def(Gn,"?",Gn,".primType:",Dp)});if(ot)return new $a(mt.thisDep,mt.contextDep,mt.propDep,function(En,Jn){return Jn.def(En.shared.vao+".currentVAO?"+En.shared.vao+".currentVAO.primitive:"+Dp)})}return null}function Pt(ni,In){if(ni in Qe){var En=Qe[ni]|0;return In?Ut.offset=En:Ut.instances=En,V.command(!In||En>=0,"invalid "+ni,ge.commandStr),Fo(function(Gn,Oi){return In&&(Gn.OFFSET=En),En})}else if(ni in wt){var Jn=wt[ni];return Ms(Jn,function(Gn,Oi){var Ma=Gn.invoke(Oi,Jn);return In&&(Gn.OFFSET=Ma,V.optional(function(){Gn.assert(Oi,Ma+">=0","invalid "+ni)})),Ma})}else if(In){if(we)return Fo(function(Gn,Oi){return Gn.OFFSET=0,0});if(ot)return new $a(mt.thisDep,mt.contextDep,mt.propDep,function(Gn,Oi){return Oi.def(Gn.shared.vao+".currentVAO?"+Gn.shared.vao+".currentVAO.offset:0")})}else if(ot)return new $a(mt.thisDep,mt.contextDep,mt.propDep,function(Gn,Oi){return Oi.def(Gn.shared.vao+".currentVAO?"+Gn.shared.vao+".currentVAO.instances:-1")});return null}var Ar=Pt(Rl,!0);function ln(){if(Lf in Qe){var ni=Qe[Lf]|0;return Ut.count=ni,V.command(typeof ni=="number"&&ni>=0,"invalid vertex count",ge.commandStr),Fo(function(){return ni})}else if(Lf in wt){var In=wt[Lf];return Ms(In,function(Oi,Ma){var Is=Oi.invoke(Ma,In);return V.optional(function(){Oi.assert(Ma,"typeof "+Is+'==="number"&&'+Is+">=0&&"+Is+"===("+Is+"|0)","invalid vertex count")}),Is})}else if(we)if(wu(Ie)){if(Ie)return Ar?new $a(Ar.thisDep,Ar.contextDep,Ar.propDep,function(Oi,Ma){var Is=Ma.def(Oi.ELEMENTS,".vertCount-",Oi.OFFSET);return V.optional(function(){Oi.assert(Ma,Is+">=0","invalid vertex offset/element buffer too small")}),Is}):Fo(function(Oi,Ma){return Ma.def(Oi.ELEMENTS,".vertCount")});var En=Fo(function(){return-1});return V.optional(function(){En.MISSING=!0}),En}else{var Jn=new $a(Ie.thisDep||Ar.thisDep,Ie.contextDep||Ar.contextDep,Ie.propDep||Ar.propDep,function(Oi,Ma){var Is=Oi.ELEMENTS;return Oi.OFFSET?Ma.def(Is,"?",Is,".vertCount-",Oi.OFFSET,":-1"):Ma.def(Is,"?",Is,".vertCount:-1")});return V.optional(function(){Jn.DYNAMIC=!0}),Jn}else if(ot){var Gn=new $a(mt.thisDep,mt.contextDep,mt.propDep,function(Oi,Ma){return Ma.def(Oi.shared.vao,".currentVAO?",Oi.shared.vao,".currentVAO.count:-1")});return Gn}return null}var _n=gt(),Ln=ln(),dn=Pt(yh,!1);return{elements:Ie,primitive:_n,count:Ln,instances:dn,offset:Ar,vao:mt,vaoActive:ot,elementsActive:we,static:Ut}}function Ko(Re,ge){var Qe=Re.static,wt=Re.dynamic,Ut={};return pi.forEach(function(ot){var Ge=qn(ot);function mt(we,Ke){if(ot in Qe){var Ie=we(Qe[ot]);Ut[Ge]=Fo(function(){return Ie})}else if(ot in wt){var gt=wt[ot];Ut[Ge]=Ms(gt,function(Pt,Ar){return Ke(Pt,Ar,Pt.invoke(Ar,gt))})}}switch(ot){case sl:case pu:case lo:case Pa:case Xu:case $h:case ql:case Pl:case Ll:case rf:return mt(function(we){return V.commandType(we,"boolean",ot,ge.commandStr),we},function(we,Ke,Ie){return V.optional(function(){we.assert(Ke,"typeof "+Ie+'==="boolean"',"invalid flag "+ot,we.commandStr)}),Ie});case eu:return mt(function(we){return V.commandParameter(we,ah,"invalid "+ot,ge.commandStr),ah[we]},function(we,Ke,Ie){var gt=we.constants.compareFuncs;return V.optional(function(){we.assert(Ke,Ie+" in "+gt,"invalid "+ot+", must be one of "+Object.keys(ah))}),Ke.def(gt,"[",Ie,"]")});case Tf:return mt(function(we){return V.command(Oo(we)&&we.length===2&&typeof we[0]=="number"&&typeof we[1]=="number"&&we[0]<=we[1],"depth range is 2d array",ge.commandStr),we},function(we,Ke,Ie){V.optional(function(){we.assert(Ke,we.shared.isArrayLike+"("+Ie+")&&"+Ie+".length===2&&typeof "+Ie+'[0]==="number"&&typeof '+Ie+'[1]==="number"&&'+Ie+"[0]<="+Ie+"[1]","depth range must be a 2d array")});var gt=Ke.def("+",Ie,"[0]"),Pt=Ke.def("+",Ie,"[1]");return[gt,Pt]});case du:return mt(function(we){V.commandType(we,"object","blend.func",ge.commandStr);var Ke="srcRGB"in we?we.srcRGB:we.src,Ie="srcAlpha"in we?we.srcAlpha:we.src,gt="dstRGB"in we?we.dstRGB:we.dst,Pt="dstAlpha"in we?we.dstAlpha:we.dst;return V.commandParameter(Ke,Nc,Ge+".srcRGB",ge.commandStr),V.commandParameter(Ie,Nc,Ge+".srcAlpha",ge.commandStr),V.commandParameter(gt,Nc,Ge+".dstRGB",ge.commandStr),V.commandParameter(Pt,Nc,Ge+".dstAlpha",ge.commandStr),V.command(Ch.indexOf(Ke+", "+gt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Ke+", "+gt+")",ge.commandStr),[Nc[Ke],Nc[gt],Nc[Ie],Nc[Pt]]},function(we,Ke,Ie){var gt=we.constants.blendFuncs;V.optional(function(){we.assert(Ke,Ie+"&&typeof "+Ie+'==="object"',"invalid blend func, must be an object")});function Pt(In,En){var Jn=Ke.def('"',In,En,'" in ',Ie,"?",Ie,".",In,En,":",Ie,".",In);return V.optional(function(){we.assert(Ke,Jn+" in "+gt,"invalid "+ot+"."+In+En+", must be one of "+Object.keys(Nc))}),Jn}var Ar=Pt("src","RGB"),ln=Pt("dst","RGB");V.optional(function(){var In=we.constants.invalidBlendCombinations;we.assert(Ke,In+".indexOf("+Ar+'+", "+'+ln+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var _n=Ke.def(gt,"[",Ar,"]"),Ln=Ke.def(gt,"[",Pt("src","Alpha"),"]"),dn=Ke.def(gt,"[",ln,"]"),ni=Ke.def(gt,"[",Pt("dst","Alpha"),"]");return[_n,dn,Ln,ni]});case Xl:return mt(function(we){if(typeof we=="string")return V.commandParameter(we,er,"invalid "+ot,ge.commandStr),[er[we],er[we]];if(typeof we=="object")return V.commandParameter(we.rgb,er,ot+".rgb",ge.commandStr),V.commandParameter(we.alpha,er,ot+".alpha",ge.commandStr),[er[we.rgb],er[we.alpha]];V.commandRaise("invalid blend.equation",ge.commandStr)},function(we,Ke,Ie){var gt=we.constants.blendEquations,Pt=Ke.def(),Ar=Ke.def(),ln=we.cond("typeof ",Ie,'==="string"');return V.optional(function(){function _n(Ln,dn,ni){we.assert(Ln,ni+" in "+gt,"invalid "+dn+", must be one of "+Object.keys(er))}_n(ln.then,ot,Ie),we.assert(ln.else,Ie+"&&typeof "+Ie+'==="object"',"invalid "+ot),_n(ln.else,ot+".rgb",Ie+".rgb"),_n(ln.else,ot+".alpha",Ie+".alpha")}),ln.then(Pt,"=",Ar,"=",gt,"[",Ie,"];"),ln.else(Pt,"=",gt,"[",Ie,".rgb];",Ar,"=",gt,"[",Ie,".alpha];"),Ke(ln),[Pt,Ar]});case Js:return mt(function(we){return V.command(Oo(we)&&we.length===4,"blend.color must be a 4d array",ge.commandStr),Ye(4,function(Ke){return+we[Ke]})},function(we,Ke,Ie){return V.optional(function(){we.assert(Ke,we.shared.isArrayLike+"("+Ie+")&&"+Ie+".length===4","blend.color must be a 4d array")}),Ye(4,function(gt){return Ke.def("+",Ie,"[",gt,"]")})});case Ou:return mt(function(we){return V.commandType(we,"number",Ge,ge.commandStr),we|0},function(we,Ke,Ie){return V.optional(function(){we.assert(Ke,"typeof "+Ie+'==="number"',"invalid stencil.mask")}),Ke.def(Ie,"|0")});case Bs:return mt(function(we){V.commandType(we,"object",Ge,ge.commandStr);var Ke=we.cmp||"keep",Ie=we.ref||0,gt="mask"in we?we.mask:-1;return V.commandParameter(Ke,ah,ot+".cmp",ge.commandStr),V.commandType(Ie,"number",ot+".ref",ge.commandStr),V.commandType(gt,"number",ot+".mask",ge.commandStr),[ah[Ke],Ie,gt]},function(we,Ke,Ie){var gt=we.constants.compareFuncs;V.optional(function(){function _n(){we.assert(Ke,Array.prototype.join.call(arguments,""),"invalid stencil.func")}_n(Ie+"&&typeof ",Ie,'==="object"'),_n('!("cmp" in ',Ie,")||(",Ie,".cmp in ",gt,")")});var Pt=Ke.def('"cmp" in ',Ie,"?",gt,"[",Ie,".cmp]",":",Nu),Ar=Ke.def(Ie,".ref|0"),ln=Ke.def('"mask" in ',Ie,"?",Ie,".mask|0:-1");return[Pt,Ar,ln]});case gc:case kf:return mt(function(we){V.commandType(we,"object",Ge,ge.commandStr);var Ke=we.fail||"keep",Ie=we.zfail||"keep",gt=we.zpass||"keep";return V.commandParameter(Ke,Nf,ot+".fail",ge.commandStr),V.commandParameter(Ie,Nf,ot+".zfail",ge.commandStr),V.commandParameter(gt,Nf,ot+".zpass",ge.commandStr),[ot===kf?bh:Ql,Nf[Ke],Nf[Ie],Nf[gt]]},function(we,Ke,Ie){var gt=we.constants.stencilOps;V.optional(function(){we.assert(Ke,Ie+"&&typeof "+Ie+'==="object"',"invalid "+ot)});function Pt(Ar){return V.optional(function(){we.assert(Ke,'!("'+Ar+'" in '+Ie+")||("+Ie+"."+Ar+" in "+gt+")","invalid "+ot+"."+Ar+", must be one of "+Object.keys(Nf))}),Ke.def('"',Ar,'" in ',Ie,"?",gt,"[",Ie,".",Ar,"]:",Nu)}return[ot===kf?bh:Ql,Pt("fail"),Pt("zfail"),Pt("zpass")]});case ls:return mt(function(we){V.commandType(we,"object",Ge,ge.commandStr);var Ke=we.factor|0,Ie=we.units|0;return V.commandType(Ke,"number",Ge+".factor",ge.commandStr),V.commandType(Ie,"number",Ge+".units",ge.commandStr),[Ke,Ie]},function(we,Ke,Ie){V.optional(function(){we.assert(Ke,Ie+"&&typeof "+Ie+'==="object"',"invalid "+ot)});var gt=Ke.def(Ie,".factor|0"),Pt=Ke.def(Ie,".units|0");return[gt,Pt]});case Mf:return mt(function(we){var Ke=0;return we==="front"?Ke=Ql:we==="back"&&(Ke=bh),V.command(!!Ke,Ge,ge.commandStr),Ke},function(we,Ke,Ie){return V.optional(function(){we.assert(Ke,Ie+'==="front"||'+Ie+'==="back"',"invalid cull.face")}),Ke.def(Ie,'==="front"?',Ql,":",bh)});case mc:return mt(function(we){return V.command(typeof we=="number"&&we>=Ht.lineWidthDims[0]&&we<=Ht.lineWidthDims[1],"invalid line width, must be a positive number between "+Ht.lineWidthDims[0]+" and "+Ht.lineWidthDims[1],ge.commandStr),we},function(we,Ke,Ie){return V.optional(function(){we.assert(Ke,"typeof "+Ie+'==="number"&&'+Ie+">="+Ht.lineWidthDims[0]+"&&"+Ie+"<="+Ht.lineWidthDims[1],"invalid line width")}),Ie});case ul:return mt(function(we){return V.commandParameter(we,fl,Ge,ge.commandStr),fl[we]},function(we,Ke,Ie){return V.optional(function(){we.assert(Ke,Ie+'==="cw"||'+Ie+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Ke.def(Ie+'==="cw"?'+Bd+":"+Bf)});case Yl:return mt(function(we){return V.command(Oo(we)&&we.length===4,"color.mask must be length 4 array",ge.commandStr),we.map(function(Ke){return!!Ke})},function(we,Ke,Ie){return V.optional(function(){we.assert(Ke,we.shared.isArrayLike+"("+Ie+")&&"+Ie+".length===4","invalid color.mask")}),Ye(4,function(gt){return"!!"+Ie+"["+gt+"]"})});case tu:return mt(function(we){V.command(typeof we=="object"&&we,Ge,ge.commandStr);var Ke="value"in we?we.value:1,Ie=!!we.invert;return V.command(typeof Ke=="number"&&Ke>=0&&Ke<=1,"sample.coverage.value must be a number between 0 and 1",ge.commandStr),[Ke,Ie]},function(we,Ke,Ie){V.optional(function(){we.assert(Ke,Ie+"&&typeof "+Ie+'==="object"',"invalid sample.coverage")});var gt=Ke.def('"value" in ',Ie,"?+",Ie,".value:1"),Pt=Ke.def("!!",Ie,".invert");return[gt,Pt]})}}),Ut}function ma(Re,ge){var Qe=Re.static,wt=Re.dynamic,Ut={};return Object.keys(Qe).forEach(function(ot){var Ge=Qe[ot],mt;if(typeof Ge=="number"||typeof Ge=="boolean")mt=Fo(function(){return Ge});else if(typeof Ge=="function"){var we=Ge._reglType;we==="texture2d"||we==="textureCube"?mt=Fo(function(Ke){return Ke.link(Ge)}):we==="framebuffer"||we==="framebufferCube"?(V.command(Ge.color.length>0,'missing color attachment for framebuffer sent to uniform "'+ot+'"',ge.commandStr),mt=Fo(function(Ke){return Ke.link(Ge.color[0])})):V.commandRaise('invalid data for uniform "'+ot+'"',ge.commandStr)}else Oo(Ge)?mt=Fo(function(Ke){var Ie=Ke.global.def("[",Ye(Ge.length,function(gt){return V.command(typeof Ge[gt]=="number"||typeof Ge[gt]=="boolean","invalid uniform "+ot,Ke.commandStr),Ge[gt]}),"]");return Ie}):V.commandRaise('invalid or missing data for uniform "'+ot+'"',ge.commandStr);mt.value=Ge,Ut[ot]=mt}),Object.keys(wt).forEach(function(ot){var Ge=wt[ot];Ut[ot]=Ms(Ge,function(mt,we){return mt.invoke(we,Ge)})}),Ut}function Xs(Re,ge){var Qe=Re.static,wt=Re.dynamic,Ut={};return Object.keys(Qe).forEach(function(ot){var Ge=Qe[ot],mt=Se.id(ot),we=new Ct;if(Sh(Ge))we.state=wi,we.buffer=Er.getBuffer(Er.create(Ge,ru,!1,!0)),we.type=0;else{var Ke=Er.getBuffer(Ge);if(Ke)we.state=wi,we.buffer=Ke,we.type=0;else if(V.command(typeof Ge=="object"&&Ge,"invalid data for attribute "+ot,ge.commandStr),"constant"in Ge){var Ie=Ge.constant;we.buffer="null",we.state=Ki,typeof Ie=="number"?we.x=Ie:(V.command(Oo(Ie)&&Ie.length>0&&Ie.length<=4,"invalid constant for attribute "+ot,ge.commandStr),Wi.forEach(function(dn,ni){ni<Ie.length&&(we[dn]=Ie[ni])}))}else{Sh(Ge.buffer)?Ke=Er.getBuffer(Er.create(Ge.buffer,ru,!1,!0)):Ke=Er.getBuffer(Ge.buffer),V.command(!!Ke,'missing buffer for attribute "'+ot+'"',ge.commandStr);var gt=Ge.offset|0;V.command(gt>=0,'invalid offset for attribute "'+ot+'"',ge.commandStr);var Pt=Ge.stride|0;V.command(Pt>=0&&Pt<256,'invalid stride for attribute "'+ot+'", must be integer betweeen [0, 255]',ge.commandStr);var Ar=Ge.size|0;V.command(!("size"in Ge)||Ar>0&&Ar<=4,'invalid size for attribute "'+ot+'", must be 1,2,3,4',ge.commandStr);var ln=!!Ge.normalized,_n=0;"type"in Ge&&(V.commandParameter(Ge.type,Uo,"invalid type for attribute "+ot,ge.commandStr),_n=Uo[Ge.type]);var Ln=Ge.divisor|0;V.optional(function(){"divisor"in Ge&&(V.command(Ln===0||Gr,'cannot specify divisor for attribute "'+ot+'", instancing not supported',ge.commandStr),V.command(Ln>=0,'invalid divisor for attribute "'+ot+'"',ge.commandStr));var dn=ge.commandStr,ni=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Ge).forEach(function(In){V.command(ni.indexOf(In)>=0,'unknown parameter "'+In+'" for attribute pointer "'+ot+'" (valid parameters are '+ni+")",dn)})}),we.buffer=Ke,we.state=wi,we.size=Ar,we.normalized=ln,we.type=_n||Ke.dtype,we.offset=gt,we.stride=Pt,we.divisor=Ln}}Ut[ot]=Fo(function(dn,ni){var In=dn.attribCache;if(mt in In)return In[mt];var En={isStream:!1};return Object.keys(we).forEach(function(Jn){En[Jn]=we[Jn]}),we.buffer&&(En.buffer=dn.link(we.buffer),En.type=En.type||En.buffer+".dtype"),In[mt]=En,En})}),Object.keys(wt).forEach(function(ot){var Ge=wt[ot];function mt(we,Ke){var Ie=we.invoke(Ke,Ge),gt=we.shared,Pt=we.constants,Ar=gt.isBufferArgs,ln=gt.buffer;V.optional(function(){we.assert(Ke,Ie+"&&(typeof "+Ie+'==="object"||typeof '+Ie+'==="function")&&('+Ar+"("+Ie+")||"+ln+".getBuffer("+Ie+")||"+ln+".getBuffer("+Ie+".buffer)||"+Ar+"("+Ie+'.buffer)||("constant" in '+Ie+"&&(typeof "+Ie+'.constant==="number"||'+gt.isArrayLike+"("+Ie+".constant))))",'invalid dynamic attribute "'+ot+'"')});var _n={isStream:Ke.def(!1)},Ln=new Ct;Ln.state=wi,Object.keys(Ln).forEach(function(En){_n[En]=Ke.def(""+Ln[En])});var dn=_n.buffer,ni=_n.type;Ke("if(",Ar,"(",Ie,")){",_n.isStream,"=true;",dn,"=",ln,".createStream(",ru,",",Ie,");",ni,"=",dn,".dtype;","}else{",dn,"=",ln,".getBuffer(",Ie,");","if(",dn,"){",ni,"=",dn,".dtype;",'}else if("constant" in ',Ie,"){",_n.state,"=",Ki,";","if(typeof "+Ie+'.constant === "number"){',_n[Wi[0]],"=",Ie,".constant;",Wi.slice(1).map(function(En){return _n[En]}).join("="),"=0;","}else{",Wi.map(function(En,Jn){return _n[En]+"="+Ie+".constant.length>"+Jn+"?"+Ie+".constant["+Jn+"]:0;"}).join(""),"}}else{","if(",Ar,"(",Ie,".buffer)){",dn,"=",ln,".createStream(",ru,",",Ie,".buffer);","}else{",dn,"=",ln,".getBuffer(",Ie,".buffer);","}",ni,'="type" in ',Ie,"?",Pt.glTypes,"[",Ie,".type]:",dn,".dtype;",_n.normalized,"=!!",Ie,".normalized;");function In(En){Ke(_n[En],"=",Ie,".",En,"|0;")}return In("size"),In("offset"),In("stride"),In("divisor"),Ke("}}"),Ke.exit("if(",_n.isStream,"){",ln,".destroyStream(",dn,");","}"),_n}Ut[ot]=Ms(Ge,mt)}),Ut}function Mo(Re){var ge=Re.static,Qe=Re.dynamic,wt={};return Object.keys(ge).forEach(function(Ut){var ot=ge[Ut];wt[Ut]=Fo(function(Ge,mt){return typeof ot=="number"||typeof ot=="boolean"?""+ot:Ge.link(ot)})}),Object.keys(Qe).forEach(function(Ut){var ot=Qe[Ut];wt[Ut]=Ms(ot,function(Ge,mt){return Ge.invoke(mt,ot)})}),wt}function Ns(Re,ge,Qe,wt,Ut){var ot=Re.static,Ge=Re.dynamic;V.optional(function(){var In=[Fu,If,Pf,$l,ys,Rl,Lf,yh,Oc,Cu].concat(pi);function En(Jn){Object.keys(Jn).forEach(function(Gn){V.command(In.indexOf(Gn)>=0,'unknown parameter "'+Gn+'"',Ut.commandStr)})}En(ot),En(Ge)});var mt=Xi(Re,ge),we=bn(Re,Ut),Ke=Ai(Re,we,Ut),Ie=$o(Re,Ut),gt=Ko(Re,Ut),Pt=xa(Re,Ut,mt);function Ar(In){var En=Ke[In];En&&(gt[In]=En)}Ar(Yu),Ar(qn(Kh));var ln=Object.keys(gt).length>0,_n={framebuffer:we,draw:Ie,shader:Pt,state:gt,dirty:ln,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(_n.profile=yn(Re,Ut),_n.uniforms=ma(Qe,Ut),_n.drawVAO=_n.scopeVAO=Ie.vao,!_n.drawVAO&&Pt.program&&!mt&&He.angle_instanced_arrays&&Ie.static.elements){var Ln=!0,dn=Pt.program.attributes.map(function(In){var En=ge.static[In];return Ln=Ln&&!!En,En});if(Ln&&dn.length>0){var ni=jr.getVAO(jr.createVAO({attributes:dn,elements:Ie.static.elements}));_n.drawVAO=new $a(null,null,null,function(In,En){return In.link(ni)}),_n.useVAO=!0}}return mt?_n.useVAO=!0:_n.attributes=Xs(ge,Ut),_n.context=Mo(wt,Ut),_n}function rs(Re,ge,Qe){var wt=Re.shared,Ut=wt.context,ot=Re.scope();Object.keys(Qe).forEach(function(Ge){ge.save(Ut,"."+Ge);var mt=Qe[Ge],we=mt.append(Re,ge);Array.isArray(we)?ot(Ut,".",Ge,"=[",we.join(),"];"):ot(Ut,".",Ge,"=",we,";")}),ge(ot)}function Ys(Re,ge,Qe,wt){var Ut=Re.shared,ot=Ut.gl,Ge=Ut.framebuffer,mt;fn&&(mt=ge.def(Ut.extensions,".webgl_draw_buffers"));var we=Re.constants,Ke=we.drawBuffer,Ie=we.backBuffer,gt;Qe?gt=Qe.append(Re,ge):gt=ge.def(Ge,".next"),wt||ge("if(",gt,"!==",Ge,".cur){"),ge("if(",gt,"){",ot,".bindFramebuffer(",Bp,",",gt,".framebuffer);"),fn&&ge(mt,".drawBuffersWEBGL(",Ke,"[",gt,".colorAttachments.length]);"),ge("}else{",ot,".bindFramebuffer(",Bp,",null);"),fn&&ge(mt,".drawBuffersWEBGL(",Ie,");"),ge("}",Ge,".cur=",gt,";"),wt||ge("}")}function zs(Re,ge,Qe){var wt=Re.shared,Ut=wt.gl,ot=Re.current,Ge=Re.next,mt=wt.current,we=wt.next,Ke=Re.cond(mt,".dirty");pi.forEach(function(Ie){var gt=qn(Ie);if(!(gt in Qe.state)){var Pt,Ar;if(gt in Ge){Pt=Ge[gt],Ar=ot[gt];var ln=Ye(Kr[gt].length,function(Ln){return Ke.def(Pt,"[",Ln,"]")});Ke(Re.cond(ln.map(function(Ln,dn){return Ln+"!=="+Ar+"["+dn+"]"}).join("||")).then(Ut,".",dr[gt],"(",ln,");",ln.map(function(Ln,dn){return Ar+"["+dn+"]="+Ln}).join(";"),";"))}else{Pt=Ke.def(we,".",gt);var _n=Re.cond(Pt,"!==",mt,".",gt);Ke(_n),gt in or?_n(Re.cond(Pt).then(Ut,".enable(",or[gt],");").else(Ut,".disable(",or[gt],");"),mt,".",gt,"=",Pt,";"):_n(Ut,".",dr[gt],"(",Pt,");",mt,".",gt,"=",Pt,";")}}}),Object.keys(Qe.state).length===0&&Ke(mt,".dirty=false;"),ge(Ke)}function Us(Re,ge,Qe,wt){var Ut=Re.shared,ot=Re.current,Ge=Ut.current,mt=Ut.gl;Ud(Object.keys(Qe)).forEach(function(we){var Ke=Qe[we];if(!(wt&&!wt(Ke))){var Ie=Ke.append(Re,ge);if(or[we]){var gt=or[we];wu(Ke)?Ie?ge(mt,".enable(",gt,");"):ge(mt,".disable(",gt,");"):ge(Re.cond(Ie).then(mt,".enable(",gt,");").else(mt,".disable(",gt,");")),ge(Ge,".",we,"=",Ie,";")}else if(Oo(Ie)){var Pt=ot[we];ge(mt,".",dr[we],"(",Ie,");",Ie.map(function(Ar,ln){return Pt+"["+ln+"]="+Ar}).join(";"),";")}else ge(mt,".",dr[we],"(",Ie,");",Ge,".",we,"=",Ie,";")}})}function Qo(Re,ge){Gr&&(Re.instancing=ge.def(Re.shared.extensions,".angle_instanced_arrays"))}function ta(Re,ge,Qe,wt,Ut){var ot=Re.shared,Ge=Re.stats,mt=ot.current,we=ot.timer,Ke=Qe.profile;function Ie(){var In=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return In||typeof performance>"u"?"Date.now()":"performance.now()"}var gt,Pt;function Ar(In){gt=ge.def(),In(gt,"=",Ie(),";"),typeof Ut=="string"?In(Ge,".count+=",Ut,";"):In(Ge,".count++;"),Zr&&(wt?(Pt=ge.def(),In(Pt,"=",we,".getNumPendingQueries();")):In(we,".beginQuery(",Ge,");"))}function ln(In){In(Ge,".cpuTime+=",Ie(),"-",gt,";"),Zr&&(wt?In(we,".pushScopeStats(",Pt,",",we,".getNumPendingQueries(),",Ge,");"):In(we,".endQuery();"))}function _n(In){var En=ge.def(mt,".profile");ge(mt,".profile=",In,";"),ge.exit(mt,".profile=",En,";")}var Ln;if(Ke){if(wu(Ke)){Ke.enable?(Ar(ge),ln(ge.exit),_n("true")):_n("false");return}Ln=Ke.append(Re,ge),_n(Ln)}else Ln=ge.def(mt,".profile");var dn=Re.block();Ar(dn),ge("if(",Ln,"){",dn,"}");var ni=Re.block();ln(ni),ge.exit("if(",Ln,"){",ni,"}")}function ks(Re,ge,Qe,wt,Ut){var ot=Re.shared;function Ge(we){switch(we){case Rp:case hd:case sf:return 2;case Su:case ih:case uf:return 3;case tp:case yc:case Op:return 4;default:return 1}}function mt(we,Ke,Ie){var gt=ot.gl,Pt=ge.def(we,".location"),Ar=ge.def(ot.attributes,"[",Pt,"]"),ln=Ie.state,_n=Ie.buffer,Ln=[Ie.x,Ie.y,Ie.z,Ie.w],dn=["buffer","normalized","offset","stride"];function ni(){ge("if(!",Ar,".buffer){",gt,".enableVertexAttribArray(",Pt,");}");var En=Ie.type,Jn;if(Ie.size?Jn=ge.def(Ie.size,"||",Ke):Jn=Ke,ge("if(",Ar,".type!==",En,"||",Ar,".size!==",Jn,"||",dn.map(function(Oi){return Ar+"."+Oi+"!=="+Ie[Oi]}).join("||"),"){",gt,".bindBuffer(",ru,",",_n,".buffer);",gt,".vertexAttribPointer(",[Pt,Jn,En,Ie.normalized,Ie.stride,Ie.offset],");",Ar,".type=",En,";",Ar,".size=",Jn,";",dn.map(function(Oi){return Ar+"."+Oi+"="+Ie[Oi]+";"}).join(""),"}"),Gr){var Gn=Ie.divisor;ge("if(",Ar,".divisor!==",Gn,"){",Re.instancing,".vertexAttribDivisorANGLE(",[Pt,Gn],");",Ar,".divisor=",Gn,";}")}}function In(){ge("if(",Ar,".buffer){",gt,".disableVertexAttribArray(",Pt,");",Ar,".buffer=null;","}if(",Wi.map(function(En,Jn){return Ar+"."+En+"!=="+Ln[Jn]}).join("||"),"){",gt,".vertexAttrib4f(",Pt,",",Ln,");",Wi.map(function(En,Jn){return Ar+"."+En+"="+Ln[Jn]+";"}).join(""),"}")}ln===wi?ni():ln===Ki?In():(ge("if(",ln,"===",wi,"){"),ni(),ge("}else{"),In(),ge("}"))}wt.forEach(function(we){var Ke=we.name,Ie=Qe.attributes[Ke],gt;if(Ie){if(!Ut(Ie))return;gt=Ie.append(Re,ge)}else{if(!Ut(Zd))return;var Pt=Re.scopeAttrib(Ke);V.optional(function(){Re.assert(ge,Pt+".state","missing attribute "+Ke)}),gt={},Object.keys(new Ct).forEach(function(Ar){gt[Ar]=ge.def(Pt,".",Ar)})}mt(Re.link(we),Ge(we.info.type),gt)})}function La(Re,ge,Qe,wt,Ut,ot){for(var Ge=Re.shared,mt=Ge.gl,we,Ke=0;Ke<wt.length;++Ke){var Ie=wt[Ke],gt=Ie.name,Pt=Ie.info.type,Ar=Qe.uniforms[gt],ln=Re.link(Ie),_n=ln+".location",Ln;if(Ar){if(!Ut(Ar))continue;if(wu(Ar)){var dn=Ar.value;if(V.command(dn!==null&&typeof dn<"u",'missing uniform "'+gt+'"',Re.commandStr),Pt===Fp||Pt===Df){V.command(typeof dn=="function"&&(Pt===Fp&&(dn._reglType==="texture2d"||dn._reglType==="framebuffer")||Pt===Df&&(dn._reglType==="textureCube"||dn._reglType==="framebufferCube")),"invalid texture for uniform "+gt,Re.commandStr);var ni=Re.link(dn._texture||dn.color[0]._texture);ge(mt,".uniform1i(",_n,",",ni+".bind());"),ge.exit(ni,".unbind();")}else if(Pt===Du||Pt===Fc||Pt===Bu){V.optional(function(){V.command(Oo(dn),"invalid matrix for uniform "+gt,Re.commandStr),V.command(Pt===Du&&dn.length===4||Pt===Fc&&dn.length===9||Pt===Bu&&dn.length===16,"invalid length for matrix uniform "+gt,Re.commandStr)});var In=Re.global.def("new Float32Array(["+Array.prototype.slice.call(dn)+"])"),En=2;Pt===Fc?En=3:Pt===Bu&&(En=4),ge(mt,".uniformMatrix",En,"fv(",_n,",false,",In,");")}else{switch(Pt){case af:V.commandType(dn,"number","uniform "+gt,Re.commandStr),we="1f";break;case Rp:V.command(Oo(dn)&&dn.length===2,"uniform "+gt,Re.commandStr),we="2f";break;case Su:V.command(Oo(dn)&&dn.length===3,"uniform "+gt,Re.commandStr),we="3f";break;case tp:V.command(Oo(dn)&&dn.length===4,"uniform "+gt,Re.commandStr),we="4f";break;case xh:V.commandType(dn,"boolean","uniform "+gt,Re.commandStr),we="1i";break;case of:V.commandType(dn,"number","uniform "+gt,Re.commandStr),we="1i";break;case sf:V.command(Oo(dn)&&dn.length===2,"uniform "+gt,Re.commandStr),we="2i";break;case hd:V.command(Oo(dn)&&dn.length===2,"uniform "+gt,Re.commandStr),we="2i";break;case uf:V.command(Oo(dn)&&dn.length===3,"uniform "+gt,Re.commandStr),we="3i";break;case ih:V.command(Oo(dn)&&dn.length===3,"uniform "+gt,Re.commandStr),we="3i";break;case Op:V.command(Oo(dn)&&dn.length===4,"uniform "+gt,Re.commandStr),we="4i";break;case yc:V.command(Oo(dn)&&dn.length===4,"uniform "+gt,Re.commandStr),we="4i";break}ge(mt,".uniform",we,"(",_n,",",Oo(dn)?Array.prototype.slice.call(dn):dn,");")}continue}else Ln=Ar.append(Re,ge)}else{if(!Ut(Zd))continue;Ln=ge.def(Ge.uniforms,"[",Se.id(gt),"]")}Pt===Fp?(V(!Array.isArray(Ln),"must specify a scalar prop for textures"),ge("if(",Ln,"&&",Ln,'._reglType==="framebuffer"){',Ln,"=",Ln,".color[0];","}")):Pt===Df&&(V(!Array.isArray(Ln),"must specify a scalar prop for cube maps"),ge("if(",Ln,"&&",Ln,'._reglType==="framebufferCube"){',Ln,"=",Ln,".color[0];","}")),V.optional(function(){function iu(pl,Uf){Re.assert(ge,pl,'bad data or missing for uniform "'+gt+'".  '+Uf)}function hl(pl){V(!Array.isArray(Ln),"must not specify an array type for uniform"),iu("typeof "+Ln+'==="'+pl+'"',"invalid type, expected "+pl)}function Ol(pl,Uf){Array.isArray(Ln)?V(Ln.length===pl,"must have length "+pl):iu(Ge.isArrayLike+"("+Ln+")&&"+Ln+".length==="+pl,"invalid vector, should have length "+pl,Re.commandStr)}function Th(pl){V(!Array.isArray(Ln),"must not specify a value type"),iu("typeof "+Ln+'==="function"&&'+Ln+'._reglType==="texture'+(pl===Lp?"2d":"Cube")+'"',"invalid texture type",Re.commandStr)}switch(Pt){case of:hl("number");break;case hd:Ol(2,"number");break;case ih:Ol(3,"number");break;case yc:Ol(4,"number");break;case af:hl("number");break;case Rp:Ol(2,"number");break;case Su:Ol(3,"number");break;case tp:Ol(4,"number");break;case xh:hl("boolean");break;case sf:Ol(2,"boolean");break;case uf:Ol(3,"boolean");break;case Op:Ol(4,"boolean");break;case Du:Ol(4,"number");break;case Fc:Ol(9,"number");break;case Bu:Ol(16,"number");break;case Fp:Th(Lp);break;case Df:Th(nh);break}});var Jn=1;switch(Pt){case Fp:case Df:var Gn=ge.def(Ln,"._texture");ge(mt,".uniform1i(",_n,",",Gn,".bind());"),ge.exit(Gn,".unbind();");continue;case of:case xh:we="1i";break;case hd:case sf:we="2i",Jn=2;break;case ih:case uf:we="3i",Jn=3;break;case yc:case Op:we="4i",Jn=4;break;case af:we="1f";break;case Rp:we="2f",Jn=2;break;case Su:we="3f",Jn=3;break;case tp:we="4f",Jn=4;break;case Du:we="Matrix2fv";break;case Fc:we="Matrix3fv";break;case Bu:we="Matrix4fv";break}if(we.charAt(0)==="M"){ge(mt,".uniform",we,"(",_n,",");var Oi=Math.pow(Pt-Du+2,2),Ma=Re.global.def("new Float32Array(",Oi,")");Array.isArray(Ln)?ge("false,(",Ye(Oi,function(iu){return Ma+"["+iu+"]="+Ln[iu]}),",",Ma,")"):ge("false,(Array.isArray(",Ln,")||",Ln," instanceof Float32Array)?",Ln,":(",Ye(Oi,function(iu){return Ma+"["+iu+"]="+Ln+"["+iu+"]"}),",",Ma,")"),ge(");")}else if(Jn>1){for(var Is=[],co=[],Ua=0;Ua<Jn;++Ua)Array.isArray(Ln)?co.push(Ln[Ua]):co.push(ge.def(Ln+"["+Ua+"]")),ot&&Is.push(ge.def());ot&&ge("if(!",Re.batchId,"||",Is.map(function(iu,hl){return iu+"!=="+co[hl]}).join("||"),"){",Is.map(function(iu,hl){return iu+"="+co[hl]+";"}).join("")),ge(mt,".uniform",we,"(",_n,",",co.join(","),");"),ot&&ge("}")}else{if(V(!Array.isArray(Ln),"uniform value must not be an array"),ot){var zc=ge.def();ge("if(!",Re.batchId,"||",zc,"!==",Ln,"){",zc,"=",Ln,";")}ge(mt,".uniform",we,"(",_n,",",Ln,");"),ot&&ge("}")}}}function nu(Re,ge,Qe,wt){var Ut=Re.shared,ot=Ut.gl,Ge=Ut.draw,mt=wt.draw;function we(){var Jn=mt.elements,Gn,Oi=ge;return Jn?((Jn.contextDep&&wt.contextDynamic||Jn.propDep)&&(Oi=Qe),Gn=Jn.append(Re,Oi),mt.elementsActive&&Oi("if("+Gn+")"+ot+".bindBuffer("+ll+","+Gn+".buffer.buffer);")):(Gn=Oi.def(),Oi(Gn,"=",Ge,".",$l,";","if(",Gn,"){",ot,".bindBuffer(",ll,",",Gn,".buffer.buffer);}","else if(",Ut.vao,".currentVAO){",Gn,"=",Re.shared.elements+".getElements("+Ut.vao,".currentVAO.elements);",wr?"":"if("+Gn+")"+ot+".bindBuffer("+ll+","+Gn+".buffer.buffer);","}")),Gn}function Ke(){var Jn=mt.count,Gn,Oi=ge;return Jn?((Jn.contextDep&&wt.contextDynamic||Jn.propDep)&&(Oi=Qe),Gn=Jn.append(Re,Oi),V.optional(function(){Jn.MISSING&&Re.assert(ge,"false","missing vertex count"),Jn.DYNAMIC&&Re.assert(Oi,Gn+">=0","missing vertex count")})):(Gn=Oi.def(Ge,".",Lf),V.optional(function(){Re.assert(Oi,Gn+">=0","missing vertex count")})),Gn}var Ie=we();function gt(Jn){var Gn=mt[Jn];return Gn?Gn.contextDep&&wt.contextDynamic||Gn.propDep?Gn.append(Re,Qe):Gn.append(Re,ge):ge.def(Ge,".",Jn)}var Pt=gt(ys),Ar=gt(Rl),ln=Ke();if(typeof ln=="number"){if(ln===0)return}else Qe("if(",ln,"){"),Qe.exit("}");var _n,Ln;Gr&&(_n=gt(yh),Ln=Re.instancing);var dn=Ie+".type",ni=mt.elements&&wu(mt.elements)&&!mt.vaoActive;function In(){function Jn(){Qe(Ln,".drawElementsInstancedANGLE(",[Pt,ln,dn,Ar+"<<(("+dn+"-"+Bi+")>>1)",_n],");")}function Gn(){Qe(Ln,".drawArraysInstancedANGLE(",[Pt,Ar,ln,_n],");")}Ie&&Ie!=="null"?ni?Jn():(Qe("if(",Ie,"){"),Jn(),Qe("}else{"),Gn(),Qe("}")):Gn()}function En(){function Jn(){Qe(ot+".drawElements("+[Pt,ln,dn,Ar+"<<(("+dn+"-"+Bi+")>>1)"]+");")}function Gn(){Qe(ot+".drawArrays("+[Pt,Ar,ln]+");")}Ie&&Ie!=="null"?ni?Jn():(Qe("if(",Ie,"){"),Jn(),Qe("}else{"),Gn(),Qe("}")):Gn()}Gr&&(typeof _n!="number"||_n>=0)?typeof _n=="string"?(Qe("if(",_n,">0){"),In(),Qe("}else if(",_n,"<0){"),En(),Qe("}")):In():En()}function zi(Re,ge,Qe,wt,Ut){var ot=Ri(),Ge=ot.proc("body",Ut);return V.optional(function(){ot.commandStr=ge.commandStr,ot.command=ot.link(ge.commandStr)}),Gr&&(ot.instancing=Ge.def(ot.shared.extensions,".angle_instanced_arrays")),Re(ot,Ge,Qe,wt),ot.compile().body}function ba(Re,ge,Qe,wt){Qo(Re,ge),Qe.useVAO?Qe.drawVAO?ge(Re.shared.vao,".setVAO(",Qe.drawVAO.append(Re,ge),");"):ge(Re.shared.vao,".setVAO(",Re.shared.vao,".targetVAO);"):(ge(Re.shared.vao,".setVAO(null);"),ks(Re,ge,Qe,wt.attributes,function(){return!0})),La(Re,ge,Qe,wt.uniforms,function(){return!0},!1),nu(Re,ge,ge,Qe)}function Ha(Re,ge){var Qe=Re.proc("draw",1);Qo(Re,Qe),rs(Re,Qe,ge.context),Ys(Re,Qe,ge.framebuffer),zs(Re,Qe,ge),Us(Re,Qe,ge.state),ta(Re,Qe,ge,!1,!0);var wt=ge.shader.progVar.append(Re,Qe);if(Qe(Re.shared.gl,".useProgram(",wt,".program);"),ge.shader.program)ba(Re,Qe,ge,ge.shader.program);else{Qe(Re.shared.vao,".setVAO(null);");var Ut=Re.global.def("{}"),ot=Qe.def(wt,".id"),Ge=Qe.def(Ut,"[",ot,"]");Qe(Re.cond(Ge).then(Ge,".call(this,a0);").else(Ge,"=",Ut,"[",ot,"]=",Re.link(function(mt){return zi(ba,Re,ge,mt,1)}),"(",wt,");",Ge,".call(this,a0);"))}Object.keys(ge.state).length>0&&Qe(Re.shared.current,".dirty=true;"),Re.shared.vao&&Qe(Re.shared.vao,".setVAO(null);")}function _s(Re,ge,Qe,wt){Re.batchId="a1",Qo(Re,ge);function Ut(){return!0}ks(Re,ge,Qe,wt.attributes,Ut),La(Re,ge,Qe,wt.uniforms,Ut,!1),nu(Re,ge,ge,Qe)}function ff(Re,ge,Qe,wt){Qo(Re,ge);var Ut=Qe.contextDep,ot=ge.def(),Ge="a0",mt="a1",we=ge.def();Re.shared.props=we,Re.batchId=ot;var Ke=Re.scope(),Ie=Re.scope();ge(Ke.entry,"for(",ot,"=0;",ot,"<",mt,";++",ot,"){",we,"=",Ge,"[",ot,"];",Ie,"}",Ke.exit);function gt(dn){return dn.contextDep&&Ut||dn.propDep}function Pt(dn){return!gt(dn)}if(Qe.needsContext&&rs(Re,Ie,Qe.context),Qe.needsFramebuffer&&Ys(Re,Ie,Qe.framebuffer),Us(Re,Ie,Qe.state,gt),Qe.profile&&gt(Qe.profile)&&ta(Re,Ie,Qe,!1,!0),wt)Qe.useVAO?Qe.drawVAO?gt(Qe.drawVAO)?Ie(Re.shared.vao,".setVAO(",Qe.drawVAO.append(Re,Ie),");"):Ke(Re.shared.vao,".setVAO(",Qe.drawVAO.append(Re,Ke),");"):Ke(Re.shared.vao,".setVAO(",Re.shared.vao,".targetVAO);"):(Ke(Re.shared.vao,".setVAO(null);"),ks(Re,Ke,Qe,wt.attributes,Pt),ks(Re,Ie,Qe,wt.attributes,gt)),La(Re,Ke,Qe,wt.uniforms,Pt,!1),La(Re,Ie,Qe,wt.uniforms,gt,!0),nu(Re,Ke,Ie,Qe);else{var Ar=Re.global.def("{}"),ln=Qe.shader.progVar.append(Re,Ie),_n=Ie.def(ln,".id"),Ln=Ie.def(Ar,"[",_n,"]");Ie(Re.shared.gl,".useProgram(",ln,".program);","if(!",Ln,"){",Ln,"=",Ar,"[",_n,"]=",Re.link(function(dn){return zi(_s,Re,Qe,dn,2)}),"(",ln,");}",Ln,".call(this,a0[",ot,"],",ot,");")}}function De(Re,ge){var Qe=Re.proc("batch",2);Re.batchId="0",Qo(Re,Qe);var wt=!1,Ut=!0;Object.keys(ge.context).forEach(function(Ar){wt=wt||ge.context[Ar].propDep}),wt||(rs(Re,Qe,ge.context),Ut=!1);var ot=ge.framebuffer,Ge=!1;ot?(ot.propDep?wt=Ge=!0:ot.contextDep&&wt&&(Ge=!0),Ge||Ys(Re,Qe,ot)):Ys(Re,Qe,null),ge.state.viewport&&ge.state.viewport.propDep&&(wt=!0);function mt(Ar){return Ar.contextDep&&wt||Ar.propDep}zs(Re,Qe,ge),Us(Re,Qe,ge.state,function(Ar){return!mt(Ar)}),(!ge.profile||!mt(ge.profile))&&ta(Re,Qe,ge,!1,"a1"),ge.contextDep=wt,ge.needsContext=Ut,ge.needsFramebuffer=Ge;var we=ge.shader.progVar;if(we.contextDep&&wt||we.propDep)ff(Re,Qe,ge,null);else{var Ke=we.append(Re,Qe);if(Qe(Re.shared.gl,".useProgram(",Ke,".program);"),ge.shader.program)ff(Re,Qe,ge,ge.shader.program);else{Qe(Re.shared.vao,".setVAO(null);");var Ie=Re.global.def("{}"),gt=Qe.def(Ke,".id"),Pt=Qe.def(Ie,"[",gt,"]");Qe(Re.cond(Pt).then(Pt,".call(this,a0,a1);").else(Pt,"=",Ie,"[",gt,"]=",Re.link(function(Ar){return zi(ff,Re,ge,Ar,2)}),"(",Ke,");",Pt,".call(this,a0,a1);"))}}Object.keys(ge.state).length>0&&Qe(Re.shared.current,".dirty=true;"),Re.shared.vao&&Qe(Re.shared.vao,".setVAO(null);")}function Wt(Re,ge){var Qe=Re.proc("scope",3);Re.batchId="a2";var wt=Re.shared,Ut=wt.current;rs(Re,Qe,ge.context),ge.framebuffer&&ge.framebuffer.append(Re,Qe),Ud(Object.keys(ge.state)).forEach(function(Ge){var mt=ge.state[Ge],we=mt.append(Re,Qe);Oo(we)?we.forEach(function(Ke,Ie){Qe.set(Re.next[Ge],"["+Ie+"]",Ke)}):Qe.set(wt.next,"."+Ge,we)}),ta(Re,Qe,ge,!0,!0),[$l,Rl,Lf,yh,ys].forEach(function(Ge){var mt=ge.draw[Ge];!mt||Qe.set(wt.draw,"."+Ge,""+mt.append(Re,Qe))}),Object.keys(ge.uniforms).forEach(function(Ge){var mt=ge.uniforms[Ge].append(Re,Qe);Array.isArray(mt)&&(mt="["+mt.join()+"]"),Qe.set(wt.uniforms,"["+Se.id(Ge)+"]",mt)}),Object.keys(ge.attributes).forEach(function(Ge){var mt=ge.attributes[Ge].append(Re,Qe),we=Re.scopeAttrib(Ge);Object.keys(new Ct).forEach(function(Ke){Qe.set(we,"."+Ke,mt[Ke])})}),ge.scopeVAO&&Qe.set(wt.vao,".targetVAO",ge.scopeVAO.append(Re,Qe));function ot(Ge){var mt=ge.shader[Ge];mt&&Qe.set(wt.shader,"."+Ge,mt.append(Re,Qe))}ot(If),ot(Pf),Object.keys(ge.state).length>0&&(Qe(Ut,".dirty=true;"),Qe.exit(Ut,".dirty=true;")),Qe("a1(",Re.shared.context,",a0,",Re.batchId,");")}function Lt(Re){if(!(typeof Re!="object"||Oo(Re))){for(var ge=Object.keys(Re),Qe=0;Qe<ge.length;++Qe)if(Yi.isDynamic(Re[ge[Qe]]))return!0;return!1}}function Un(Re,ge,Qe){var wt=ge.static[Qe];if(!wt||!Lt(wt))return;var Ut=Re.global,ot=Object.keys(wt),Ge=!1,mt=!1,we=!1,Ke=Re.global.def("{}");ot.forEach(function(gt){var Pt=wt[gt];if(Yi.isDynamic(Pt)){typeof Pt=="function"&&(Pt=wt[gt]=Yi.unbox(Pt));var Ar=Ms(Pt,null);Ge=Ge||Ar.thisDep,we=we||Ar.propDep,mt=mt||Ar.contextDep}else{switch(Ut(Ke,".",gt,"="),typeof Pt){case"number":Ut(Pt);break;case"string":Ut('"',Pt,'"');break;case"object":Array.isArray(Pt)&&Ut("[",Pt.join(),"]");break;default:Ut(Re.link(Pt));break}Ut(";")}});function Ie(gt,Pt){ot.forEach(function(Ar){var ln=wt[Ar];if(!!Yi.isDynamic(ln)){var _n=gt.invoke(Pt,ln);Pt(Ke,".",Ar,"=",_n,";")}})}ge.dynamic[Qe]=new Yi.DynamicVariable(Ds,{thisDep:Ge,contextDep:mt,propDep:we,ref:Ke,append:Ie}),delete ge.static[Qe]}function Ea(Re,ge,Qe,wt,Ut){var ot=Ri();ot.stats=ot.link(Ut),Object.keys(ge.static).forEach(function(mt){Un(ot,ge,mt)}),Of.forEach(function(mt){Un(ot,Re,mt)});var Ge=Ns(Re,ge,Qe,wt,ot);return Ha(ot,Ge),Wt(ot,Ge),De(ot,Ge),x(ot.compile(),{destroy:function(){Ge.shader.program.destroy()}})}return{next:Mn,current:Kr,procs:function(){var Re=Ri(),ge=Re.proc("poll"),Qe=Re.proc("refresh"),wt=Re.block();ge(wt),Qe(wt);var Ut=Re.shared,ot=Ut.gl,Ge=Ut.next,mt=Ut.current;wt(mt,".dirty=false;"),Ys(Re,ge),Ys(Re,Qe,null,!0);var we;Gr&&(we=Re.link(Gr)),He.oes_vertex_array_object&&Qe(Re.link(He.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Ke=0;Ke<Ht.maxAttributes;++Ke){var Ie=Qe.def(Ut.attributes,"[",Ke,"]"),gt=Re.cond(Ie,".buffer");gt.then(ot,".enableVertexAttribArray(",Ke,");",ot,".bindBuffer(",ru,",",Ie,".buffer.buffer);",ot,".vertexAttribPointer(",Ke,",",Ie,".size,",Ie,".type,",Ie,".normalized,",Ie,".stride,",Ie,".offset);").else(ot,".disableVertexAttribArray(",Ke,");",ot,".vertexAttrib4f(",Ke,",",Ie,".x,",Ie,".y,",Ie,".z,",Ie,".w);",Ie,".buffer=null;"),Qe(gt),Gr&&Qe(we,".vertexAttribDivisorANGLE(",Ke,",",Ie,".divisor);")}return Qe(Re.shared.vao,".currentVAO=null;",Re.shared.vao,".setVAO(",Re.shared.vao,".targetVAO);"),Object.keys(or).forEach(function(Pt){var Ar=or[Pt],ln=wt.def(Ge,".",Pt),_n=Re.block();_n("if(",ln,"){",ot,".enable(",Ar,")}else{",ot,".disable(",Ar,")}",mt,".",Pt,"=",ln,";"),Qe(_n),ge("if(",ln,"!==",mt,".",Pt,"){",_n,"}")}),Object.keys(dr).forEach(function(Pt){var Ar=dr[Pt],ln=Kr[Pt],_n,Ln,dn=Re.block();if(dn(ot,".",Ar,"("),Oo(ln)){var ni=ln.length;_n=Re.global.def(Ge,".",Pt),Ln=Re.global.def(mt,".",Pt),dn(Ye(ni,function(In){return _n+"["+In+"]"}),");",Ye(ni,function(In){return Ln+"["+In+"]="+_n+"["+In+"];"}).join("")),ge("if(",Ye(ni,function(In){return _n+"["+In+"]!=="+Ln+"["+In+"]"}).join("||"),"){",dn,"}")}else _n=wt.def(Ge,".",Pt),Ln=wt.def(mt,".",Pt),dn(_n,");",mt,".",Pt,"=",_n,";"),ge("if(",_n,"!==",Ln,"){",dn,"}");Qe(dn)}),Re.compile()}(),compile:Ea}}function a0(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Vd=34918,jd=34919,wh=35007,o0=function(H,Se){if(!Se.ext_disjoint_timer_query)return null;var He=[];function Ht(){return He.pop()||Se.ext_disjoint_timer_query.createQueryEXT()}function Er(Gr){He.push(Gr)}var Vt=[];function sr(Gr){var fn=Ht();Se.ext_disjoint_timer_query.beginQueryEXT(wh,fn),Vt.push(fn),Zr(Vt.length-1,Vt.length,Gr)}function kr(){Se.ext_disjoint_timer_query.endQueryEXT(wh)}function Dr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var jr=[];function qr(){return jr.pop()||new Dr}function $r(Gr){jr.push(Gr)}var gn=[];function Zr(Gr,fn,wr){var Kr=qr();Kr.startQueryIndex=Gr,Kr.endQueryIndex=fn,Kr.sum=0,Kr.stats=wr,gn.push(Kr)}var Xr=[],Ct=[];function er(){var Gr,fn,wr=Vt.length;if(wr!==0){Ct.length=Math.max(Ct.length,wr+1),Xr.length=Math.max(Xr.length,wr+1),Xr[0]=0,Ct[0]=0;var Kr=0;for(Gr=0,fn=0;fn<Vt.length;++fn){var Mn=Vt[fn];Se.ext_disjoint_timer_query.getQueryObjectEXT(Mn,jd)?(Kr+=Se.ext_disjoint_timer_query.getQueryObjectEXT(Mn,Vd),Er(Mn)):Vt[Gr++]=Mn,Xr[fn+1]=Kr,Ct[fn+1]=Gr}for(Vt.length=Gr,Gr=0,fn=0;fn<gn.length;++fn){var pi=gn[fn],or=pi.startQueryIndex,dr=pi.endQueryIndex;pi.sum+=Xr[dr]-Xr[or];var qn=Ct[or],xn=Ct[dr];xn===qn?(pi.stats.gpuTime+=pi.sum/1e6,$r(pi)):(pi.startQueryIndex=qn,pi.endQueryIndex=xn,gn[Gr++]=pi)}gn.length=Gr}}return{beginQuery:sr,endQuery:kr,pushScopeStats:Zr,update:er,getNumPendingQueries:function(){return Vt.length},clear:function(){He.push.apply(He,Vt);for(var Gr=0;Gr<He.length;Gr++)Se.ext_disjoint_timer_query.deleteQueryEXT(He[Gr]);Vt.length=0,He.length=0},restore:function(){Vt.length=0,He.length=0}}},s0=16384,rp=256,F0=1024,u0=34962,zf="webglcontextlost",Eo="webglcontextrestored",vd=1,cf=2,Ah=3;function Gd(H,Se){for(var He=0;He<H.length;++He)if(H[He]===Se)return He;return-1}function Np(H){var Se=be(H);if(!Se)return null;var He=Se.gl,Ht=He.getContextAttributes(),Er=He.isContextLost(),Vt=Ne(He,Se);if(!Vt)return null;var sr=Ji(),kr=a0(),Dr=Vt.extensions,jr=o0(He,Dr),qr=So(),$r=He.drawingBufferWidth,gn=He.drawingBufferHeight,Zr={tick:0,time:0,viewportWidth:$r,viewportHeight:gn,framebufferWidth:$r,framebufferHeight:gn,drawingBufferWidth:$r,drawingBufferHeight:gn,pixelRatio:Se.pixelRatio},Xr={},Ct={elements:null,primitive:4,count:-1,offset:0,instances:-1},er=el(He,Dr),Gr=G(He,kr,Se,Kr),fn=Sc(He,Dr,Gr,kr),wr=kt(He,Dr,er,kr,Gr,fn,Ct);function Kr(zi){return wr.destroyBuffer(zi)}var Mn=un(He,sr,kr,Se),pi=Hs(He,Dr,er,function(){qn.procs.poll()},Zr,kr,Se),or=Af(He,Dr,er,kr,Se),dr=ze(He,Dr,er,pi,or,kr),qn=dd(He,sr,Dr,er,Gr,fn,pi,dr,Xr,wr,Mn,Ct,Zr,jr,Se),xn=fi(He,dr,qn.procs.poll,Zr,Ht,Dr,er),Hr=qn.next,pn=He.canvas,kn=[],Qi=[],Ri=[],yn=[Se.onDestroy],bn=null;function Ai(){if(kn.length===0){jr&&jr.update(),bn=null;return}bn=Lo.next(Ai),Qo();for(var zi=kn.length-1;zi>=0;--zi){var ba=kn[zi];ba&&ba(Zr,null,0)}He.flush(),jr&&jr.update()}function Xi(){!bn&&kn.length>0&&(bn=Lo.next(Ai))}function xa(){bn&&(Lo.cancel(Ai),bn=null)}function $o(zi){zi.preventDefault(),Er=!0,xa(),Qi.forEach(function(ba){ba()})}function Ko(zi){He.getError(),Er=!1,Vt.restore(),Mn.restore(),Gr.restore(),pi.restore(),or.restore(),dr.restore(),wr.restore(),jr&&jr.restore(),qn.procs.refresh(),Xi(),Ri.forEach(function(ba){ba()})}var ma=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!ma&&pn&&(pn.addEventListener(zf,$o,!1),pn.addEventListener(Eo,Ko,!1));function Xs(){kn.length=0,xa(),!ma&&pn&&(pn.removeEventListener(zf,$o),pn.removeEventListener(Eo,Ko)),Mn.clear(),dr.clear(),or.clear(),wr.clear(),pi.clear(),fn.clear(),Gr.clear(),jr&&jr.clear(),yn.forEach(function(zi){zi()})}function Mo(zi){V(!!zi,"invalid args to regl({...})"),V.type(zi,"object","invalid args to regl({...})");function ba(ot){var Ge=x({},ot);delete Ge.uniforms,delete Ge.attributes,delete Ge.context,delete Ge.vao,"stencil"in Ge&&Ge.stencil.op&&(Ge.stencil.opBack=Ge.stencil.opFront=Ge.stencil.op,delete Ge.stencil.op);function mt(we){if(we in Ge){var Ke=Ge[we];delete Ge[we],Object.keys(Ke).forEach(function(Ie){Ge[we+"."+Ie]=Ke[Ie]})}}return mt("blend"),mt("depth"),mt("cull"),mt("stencil"),mt("polygonOffset"),mt("scissor"),mt("sample"),"vao"in ot&&(Ge.vao=ot.vao),Ge}function Ha(ot,Ge){var mt={},we={};return Object.keys(ot).forEach(function(Ke){var Ie=ot[Ke];if(Yi.isDynamic(Ie)){we[Ke]=Yi.unbox(Ie,Ke);return}else if(Ge&&Array.isArray(Ie)){for(var gt=0;gt<Ie.length;++gt)if(Yi.isDynamic(Ie[gt])){we[Ke]=Yi.unbox(Ie,Ke);return}}mt[Ke]=Ie}),{dynamic:we,static:mt}}var _s=Ha(zi.context||{},!0),ff=Ha(zi.uniforms||{},!0),De=Ha(zi.attributes||{},!1),Wt=Ha(ba(zi),!1),Lt={gpuTime:0,cpuTime:0,count:0},Un=qn.compile(Wt,De,ff,_s,Lt),Ea=Un.draw,Re=Un.batch,ge=Un.scope,Qe=[];function wt(ot){for(;Qe.length<ot;)Qe.push(null);return Qe}function Ut(ot,Ge){var mt;if(Er&&V.raise("context lost"),typeof ot=="function")return ge.call(this,null,ot,0);if(typeof Ge=="function")if(typeof ot=="number")for(mt=0;mt<ot;++mt)ge.call(this,null,Ge,mt);else if(Array.isArray(ot))for(mt=0;mt<ot.length;++mt)ge.call(this,ot[mt],Ge,mt);else return ge.call(this,ot,Ge,0);else if(typeof ot=="number"){if(ot>0)return Re.call(this,wt(ot|0),ot|0)}else if(Array.isArray(ot)){if(ot.length)return Re.call(this,ot,ot.length)}else return Ea.call(this,ot)}return x(Ut,{stats:Lt,destroy:function(){Un.destroy()}})}var Ns=dr.setFBO=Mo({framebuffer:Yi.define.call(null,vd,"framebuffer")});function rs(zi,ba){var Ha=0;qn.procs.poll();var _s=ba.color;_s&&(He.clearColor(+_s[0]||0,+_s[1]||0,+_s[2]||0,+_s[3]||0),Ha|=s0),"depth"in ba&&(He.clearDepth(+ba.depth),Ha|=rp),"stencil"in ba&&(He.clearStencil(ba.stencil|0),Ha|=F0),V(!!Ha,"called regl.clear with no buffer specified"),He.clear(Ha)}function Ys(zi){if(V(typeof zi=="object"&&zi,"regl.clear() takes an object as input"),"framebuffer"in zi)if(zi.framebuffer&&zi.framebuffer_reglType==="framebufferCube")for(var ba=0;ba<6;++ba)Ns(x({framebuffer:zi.framebuffer.faces[ba]},zi),rs);else Ns(zi,rs);else rs(null,zi)}function zs(zi){V.type(zi,"function","regl.frame() callback must be a function"),kn.push(zi);function ba(){var Ha=Gd(kn,zi);V(Ha>=0,"cannot cancel a frame twice");function _s(){var ff=Gd(kn,_s);kn[ff]=kn[kn.length-1],kn.length-=1,kn.length<=0&&xa()}kn[Ha]=_s}return Xi(),{cancel:ba}}function Us(){var zi=Hr.viewport,ba=Hr.scissor_box;zi[0]=zi[1]=ba[0]=ba[1]=0,Zr.viewportWidth=Zr.framebufferWidth=Zr.drawingBufferWidth=zi[2]=ba[2]=He.drawingBufferWidth,Zr.viewportHeight=Zr.framebufferHeight=Zr.drawingBufferHeight=zi[3]=ba[3]=He.drawingBufferHeight}function Qo(){Zr.tick+=1,Zr.time=ks(),Us(),qn.procs.poll()}function ta(){pi.refresh(),Us(),qn.procs.refresh(),jr&&jr.update()}function ks(){return(So()-qr)/1e3}ta();function La(zi,ba){V.type(ba,"function","listener callback must be a function");var Ha;switch(zi){case"frame":return zs(ba);case"lost":Ha=Qi;break;case"restore":Ha=Ri;break;case"destroy":Ha=yn;break;default:V.raise("invalid event, must be one of frame,lost,restore,destroy")}return Ha.push(ba),{cancel:function(){for(var _s=0;_s<Ha.length;++_s)if(Ha[_s]===ba){Ha[_s]=Ha[Ha.length-1],Ha.pop();return}}}}var nu=x(Mo,{clear:Ys,prop:Yi.define.bind(null,vd),context:Yi.define.bind(null,cf),this:Yi.define.bind(null,Ah),draw:Mo({}),buffer:function(zi){return Gr.create(zi,u0,!1,!1)},elements:function(zi){return fn.create(zi,!1)},texture:pi.create2D,cube:pi.createCube,renderbuffer:or.create,framebuffer:dr.create,framebufferCube:dr.createCube,vao:wr.createVAO,attributes:Ht,frame:zs,on:La,limits:er,hasExtension:function(zi){return er.extensions.indexOf(zi.toLowerCase())>=0},read:xn,destroy:Xs,_gl:He,_refresh:ta,poll:function(){Qo(),jr&&jr.update()},now:ks,stats:kr});return Se.onDone(null,nu),nu}return Np})},6158:function(Ja){(function(ji,vt){Ja.exports=vt()})(this,function(){"use strict";var ji,vt,rr;function Ft(x,Jr){if(!ji)ji=Jr;else if(!vt)vt=Jr;else{var tt="var sharedChunk = {}; ("+ji+")(sharedChunk); ("+vt+")(sharedChunk);",Tr={};ji(Tr),rr=Jr(Tr),typeof window<"u"&&(rr.workerUrl=window.URL.createObjectURL(new Blob([tt],{type:"text/javascript"})))}}return Ft(["exports"],function(x){"use strict";function Jr(n,s){return n(s={exports:{}},s.exports),s.exports}var tt=Tr;function Tr(n,s,l,d){this.cx=3*n,this.bx=3*(l-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(d-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=d,this.p2x=l,this.p2y=d}Tr.prototype.sampleCurveX=function(n){return((this.ax*n+this.bx)*n+this.cx)*n},Tr.prototype.sampleCurveY=function(n){return((this.ay*n+this.by)*n+this.cy)*n},Tr.prototype.sampleCurveDerivativeX=function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},Tr.prototype.solveCurveX=function(n,s){var l,d,_,C,A;for(s===void 0&&(s=1e-6),_=n,A=0;A<8;A++){if(C=this.sampleCurveX(_)-n,Math.abs(C)<s)return _;var L=this.sampleCurveDerivativeX(_);if(Math.abs(L)<1e-6)break;_-=C/L}if((_=n)<(l=0))return l;if(_>(d=1))return d;for(;l<d;){if(C=this.sampleCurveX(_),Math.abs(C-n)<s)return _;n>C?l=_:d=_,_=.5*(d-l)+l}return _},Tr.prototype.solve=function(n,s){return this.sampleCurveY(this.solveCurveX(n,s))};var rt=fr;function fr(n,s){this.x=n,this.y=s}fr.prototype={clone:function(){return new fr(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,s){return this.clone()._rotateAround(n,s)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var s=n.x-this.x,l=n.y-this.y;return s*s+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,s){return Math.atan2(this.x*s-this.y*n,this.x*n+this.y*s)},_matMult:function(n){var s=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=s,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var s=Math.cos(n),l=Math.sin(n),d=l*this.x+s*this.y;return this.x=s*this.x-l*this.y,this.y=d,this},_rotateAround:function(n,s){var l=Math.cos(n),d=Math.sin(n),_=s.y+d*(this.x-s.x)+l*(this.y-s.y);return this.x=s.x+l*(this.x-s.x)-d*(this.y-s.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},fr.convert=function(n){return n instanceof fr?n:Array.isArray(n)?new fr(n[0],n[1]):n};var Xe=typeof self<"u"?self:{},Kt=Math.pow(2,53)-1;function hr(n,s,l,d){var _=new tt(n,s,l,d);return function(C){return _.solve(C)}}var jt=hr(.25,.1,.25,1);function ar(n,s,l){return Math.min(l,Math.max(s,n))}function ur(n,s,l){var d=l-s,_=((n-s)%d+d)%d+s;return _===s?l:_}function Ir(n){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];for(var d=0,_=s;d<_.length;d+=1){var C=_[d];for(var A in C)n[A]=C[A]}return n}var Kn=1;function On(){return Kn++}function an(){return function n(s){return s?(s^16*Math.random()>>s/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function Pi(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function ri(n,s){n.forEach(function(l){s[l]&&(s[l]=s[l].bind(s))})}function me(n,s){return n.indexOf(s,n.length-s.length)!==-1}function _i(n,s,l){var d={};for(var _ in n)d[_]=s.call(l||this,n[_],_,n);return d}function Rr(n,s,l){var d={};for(var _ in n)s.call(l||this,n[_],_,n)&&(d[_]=n[_]);return d}function ir(n){return Array.isArray(n)?n.map(ir):typeof n=="object"&&n?_i(n,ir):n}var zr={};function st(n){zr[n]||(typeof console<"u"&&console.warn(n),zr[n]=!0)}function en(n,s,l){return(l.y-n.y)*(s.x-n.x)>(s.y-n.y)*(l.x-n.x)}function Wn(n){for(var s=0,l=0,d=n.length,_=d-1,C=void 0,A=void 0;l<d;_=l++)s+=((A=n[_]).x-(C=n[l]).x)*(C.y+A.y);return s}function ce(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ee(n){var s={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(d,_,C,A){var L=C||A;return s[_]=!L||L.toLowerCase(),""}),s["max-age"]){var l=parseInt(s["max-age"],10);isNaN(l)?delete s["max-age"]:s["max-age"]=l}return s}var Z=null;function Ze(n){if(Z==null){var s=n.navigator?n.navigator.userAgent:null;Z=!!n.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Z}function Pe(n){try{var s=Xe[n];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch{return!1}}var ft,It,qt,yt,cr=Xe.performance&&Xe.performance.now?Xe.performance.now.bind(Xe.performance):Date.now.bind(Date),Xn=Xe.requestAnimationFrame||Xe.mozRequestAnimationFrame||Xe.webkitRequestAnimationFrame||Xe.msRequestAnimationFrame,Vn=Xe.cancelAnimationFrame||Xe.mozCancelAnimationFrame||Xe.webkitCancelAnimationFrame||Xe.msCancelAnimationFrame,Gi={now:cr,frame:function(n){var s=Xn(n);return{cancel:function(){return Vn(s)}}},getImageData:function(n,s){s===void 0&&(s=0);var l=Xe.document.createElement("canvas"),d=l.getContext("2d");if(!d)throw new Error("failed to create canvas 2d context");return l.width=n.width,l.height=n.height,d.drawImage(n,0,0,n.width,n.height),d.getImageData(-s,-s,n.width+2*s,n.height+2*s)},resolveURL:function(n){return ft||(ft=Xe.document.createElement("a")),ft.href=n,ft.href},hardwareConcurrency:Xe.navigator&&Xe.navigator.hardwareConcurrency||4,get devicePixelRatio(){return Xe.devicePixelRatio},get prefersReducedMotion(){return!!Xe.matchMedia&&(It==null&&(It=Xe.matchMedia("(prefers-reduced-motion: reduce)")),It.matches)}},ai={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Rn={supported:!1,testSupport:function(n){!Ba&&yt&&(oa?Ti(n):qt=n)}},Ba=!1,oa=!1;function Ti(n){var s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,yt),n.isContextLost())return;Rn.supported=!0}catch{}n.deleteTexture(s),Ba=!0}Xe.document&&((yt=Xe.document.createElement("img")).onload=function(){qt&&Ti(qt),qt=null,oa=!0},yt.onerror=function(){Ba=!0,qt=null},yt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Ca="01",xi=function(n,s){this._transformRequestFn=n,this._customAccessToken=s,this._createSkuToken()};function Hi(n){return n.indexOf("mapbox:")===0}xi.prototype._createSkuToken=function(){var n=function(){for(var s="",l=0;l<10;l++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ca,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt},xi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},xi.prototype.transformRequest=function(n,s){return this._transformRequestFn&&this._transformRequestFn(n,s)||{url:n}},xi.prototype.normalizeStyleURL=function(n,s){if(!Hi(n))return n;var l=Po(n);return l.path="/styles/v1"+l.path,this._makeAPIURL(l,this._customAccessToken||s)},xi.prototype.normalizeGlyphsURL=function(n,s){if(!Hi(n))return n;var l=Po(n);return l.path="/fonts/v1"+l.path,this._makeAPIURL(l,this._customAccessToken||s)},xi.prototype.normalizeSourceURL=function(n,s){if(!Hi(n))return n;var l=Po(n);return l.path="/v4/"+l.authority+".json",l.params.push("secure"),this._makeAPIURL(l,this._customAccessToken||s)},xi.prototype.normalizeSpriteURL=function(n,s,l,d){var _=Po(n);return Hi(n)?(_.path="/styles/v1"+_.path+"/sprite"+s+l,this._makeAPIURL(_,this._customAccessToken||d)):(_.path+=""+s+l,ao(_))},xi.prototype.normalizeTileURL=function(n,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!Hi(n))return n;var l=Po(n);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Gi.devicePixelRatio>=2||s===512?"@2x":"")+(Rn.supported?".webp":"$1")),l.path=l.path.replace(/^.+\/v4\//,"/"),l.path="/v4"+l.path;var d=this._customAccessToken||function(_){for(var C=0,A=_;C<A.length;C+=1){var L=A[C].match(/^access_token=(.*)$/);if(L)return L[1]}return null}(l.params)||ai.ACCESS_TOKEN;return ai.REQUIRE_ACCESS_TOKEN&&d&&this._skuToken&&l.params.push("sku="+this._skuToken),this._makeAPIURL(l,d)},xi.prototype.canonicalizeTileURL=function(n,s){var l=Po(n);if(!l.path.match(/(^\/v4\/)/)||!l.path.match(/\.[\w]+$/))return n;var d="mapbox://tiles/";d+=l.path.replace("/v4/","");var _=l.params;return s&&(_=_.filter(function(C){return!C.match(/^access_token=/)})),_.length&&(d+="?"+_.join("&")),d},xi.prototype.canonicalizeTileset=function(n,s){for(var l=!!s&&Hi(s),d=[],_=0,C=n.tiles||[];_<C.length;_+=1){var A=C[_];mi(A)?d.push(this.canonicalizeTileURL(A,l)):d.push(A)}return d},xi.prototype._makeAPIURL=function(n,s){var l="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",d=Po(ai.API_URL);if(n.protocol=d.protocol,n.authority=d.authority,n.protocol==="http"){var _=n.params.indexOf("secure");_>=0&&n.params.splice(_,1)}if(d.path!=="/"&&(n.path=""+d.path+n.path),!ai.REQUIRE_ACCESS_TOKEN)return ao(n);if(!(s=s||ai.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+l);if(s[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+l);return n.params=n.params.filter(function(C){return C.indexOf("access_token")===-1}),n.params.push("access_token="+s),ao(n)};var vi=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function mi(n){return vi.test(n)}var ss=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Po(n){var s=n.match(ss);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function ao(n){var s=n.params.length?"?"+n.params.join("&"):"";return n.protocol+"://"+n.authority+n.path+s}function bt(n){if(!n)return null;var s=n.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(decodeURIComponent(Xe.atob(s[1]).split("").map(function(l){return"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var pe=function(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};pe.prototype.getStorageKey=function(n){var s,l=bt(ai.ACCESS_TOKEN);return s=l&&l.u?Xe.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,function(d,_){return String.fromCharCode(Number("0x"+_))})):ai.ACCESS_TOKEN||"",n?"mapbox.eventData."+n+":"+s:"mapbox.eventData:"+s},pe.prototype.fetchEventData=function(){var n=Pe("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(n)try{var d=Xe.localStorage.getItem(s);d&&(this.eventData=JSON.parse(d));var _=Xe.localStorage.getItem(l);_&&(this.anonId=_)}catch{st("Unable to read from LocalStorage")}},pe.prototype.saveEventData=function(){var n=Pe("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(n)try{Xe.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&Xe.localStorage.setItem(s,JSON.stringify(this.eventData))}catch{st("Unable to write to LocalStorage")}},pe.prototype.processRequests=function(n){},pe.prototype.postEvent=function(n,s,l,d){var _=this;if(ai.EVENTS_URL){var C=Po(ai.EVENTS_URL);C.params.push("access_token="+(d||ai.ACCESS_TOKEN||""));var A={event:this.type,created:new Date(n).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:Ca,userId:this.anonId},L=s?Ir(A,s):A,z={url:ao(C),headers:{"Content-Type":"text/plain"},body:JSON.stringify([L])};this.pendingRequest=fa(z,function(W){_.pendingRequest=null,l(W),_.saveEventData(),_.processRequests(d)})}},pe.prototype.queueRequest=function(n,s){this.queue.push(n),this.processRequests(s)};var ie,Ce,V=function(n){function s(){n.call(this,"map.load"),this.success={},this.skuToken=""}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.postMapLoadEvent=function(l,d,_,C){this.skuToken=_,(ai.EVENTS_URL&&C||ai.ACCESS_TOKEN&&Array.isArray(l)&&l.some(function(A){return Hi(A)||mi(A)}))&&this.queueRequest({id:d,timestamp:Date.now()},C)},s.prototype.processRequests=function(l){var d=this;if(!this.pendingRequest&&this.queue.length!==0){var _=this.queue.shift(),C=_.id,A=_.timestamp;C&&this.success[C]||(this.anonId||this.fetchEventData(),Pi(this.anonId)||(this.anonId=an()),this.postEvent(A,{skuToken:this.skuToken},function(L){L||C&&(d.success[C]=!0)},l))}},s}(pe),We=new(function(n){function s(l){n.call(this,"appUserTurnstile"),this._customAccessToken=l}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.postTurnstileEvent=function(l,d){ai.EVENTS_URL&&ai.ACCESS_TOKEN&&Array.isArray(l)&&l.some(function(_){return Hi(_)||mi(_)})&&this.queueRequest(Date.now(),d)},s.prototype.processRequests=function(l){var d=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var _=bt(ai.ACCESS_TOKEN),C=_?_.u:ai.ACCESS_TOKEN,A=C!==this.eventData.tokenU;Pi(this.anonId)||(this.anonId=an(),A=!0);var L=this.queue.shift();if(this.eventData.lastSuccess){var z=new Date(this.eventData.lastSuccess),W=new Date(L),q=(L-this.eventData.lastSuccess)/864e5;A=A||q>=1||q<-1||z.getDate()!==W.getDate()}else A=!0;if(!A)return this.processRequests();this.postEvent(L,{"enabled.telemetry":!1},function(J){J||(d.eventData.lastSuccess=L,d.eventData.tokenU=C)},l)}},s}(pe)),Gt=We.postTurnstileEvent.bind(We),Vr=new V,Mr=Vr.postMapLoadEvent.bind(Vr),Yn=500,Fi=50;function Qn(){Xe.caches&&!ie&&(ie=Xe.caches.open("mapbox-tiles"))}function Bn(n){var s=n.indexOf("?");return s<0?n:n.slice(0,s)}var Fn,eo=1/0;function va(){return Fn==null&&(Fn=Xe.OffscreenCanvas&&new Xe.OffscreenCanvas(1,1).getContext("2d")&&typeof Xe.createImageBitmap=="function"),Fn}var Yi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Yi);var Lo=function(n){function s(l,d,_){d===401&&mi(_)&&(l+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),n.call(this,l),this.status=d,this.url=_,this.name=this.constructor.name,this.message=l}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},s}(Error),to=ce()?function(){return self.worker&&self.worker.referrer}:function(){return(Xe.location.protocol==="blob:"?Xe.parent:Xe).location.href},So,Ji,ro=function(n,s){if(!(/^file:/.test(l=n.url)||/^file:/.test(to())&&!/^\w+:/.test(l))){if(Xe.fetch&&Xe.Request&&Xe.AbortController&&Xe.Request.prototype.hasOwnProperty("signal"))return function(d,_){var C,A=new Xe.AbortController,L=new Xe.Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:to(),signal:A.signal}),z=!1,W=!1,q=(C=L.url).indexOf("sku=")>0&&mi(C);d.type==="json"&&L.headers.set("Accept","application/json");var J=function(de,Be,Ve){if(!W){if(de&&de.message!=="SecurityError"&&st(de),Be&&Ve)return se(Be);var at=Date.now();Xe.fetch(L).then(function($e){if($e.ok){var Et=q?$e.clone():null;return se($e,Et,at)}return _(new Lo($e.statusText,$e.status,d.url))}).catch(function($e){$e.code!==20&&_(new Error($e.message))})}},se=function(de,Be,Ve){(d.type==="arrayBuffer"?de.arrayBuffer():d.type==="json"?de.json():de.text()).then(function(at){W||(Be&&Ve&&function($e,Et,Rt){if(Qn(),ie){var Jt={status:Et.status,statusText:Et.statusText,headers:new Xe.Headers};Et.headers.forEach(function(Cr,Yr){return Jt.headers.set(Yr,Cr)});var $t=Ee(Et.headers.get("Cache-Control")||"");$t["no-store"]||($t["max-age"]&&Jt.headers.set("Expires",new Date(Rt+1e3*$t["max-age"]).toUTCString()),new Date(Jt.headers.get("Expires")).getTime()-Rt<42e4||function(Cr,Yr){if(Ce===void 0)try{new Response(new ReadableStream),Ce=!0}catch{Ce=!1}Ce?Yr(Cr.body):Cr.blob().then(Yr)}(Et,function(Cr){var Yr=new Xe.Response(Cr,Jt);Qn(),ie&&ie.then(function(Sn){return Sn.put(Bn($e.url),Yr)}).catch(function(Sn){return st(Sn.message)})}))}}(L,Be,Ve),z=!0,_(null,at,de.headers.get("Cache-Control"),de.headers.get("Expires")))}).catch(function(at){W||_(new Error(at.message))})};return q?function(de,Be){if(Qn(),!ie)return Be(null);var Ve=Bn(de.url);ie.then(function(at){at.match(Ve).then(function($e){var Et=function(Rt){if(!Rt)return!1;var Jt=new Date(Rt.headers.get("Expires")||0),$t=Ee(Rt.headers.get("Cache-Control")||"");return Jt>Date.now()&&!$t["no-cache"]}($e);at.delete(Ve),Et&&at.put(Ve,$e.clone()),Be(null,$e,Et)}).catch(Be)}).catch(Be)}(L,J):J(null,null),{cancel:function(){W=!0,z||A.abort()}}}(n,s);if(ce()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,s,void 0,!0)}var l;return function(d,_){var C=new Xe.XMLHttpRequest;for(var A in C.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(C.responseType="arraybuffer"),d.headers)C.setRequestHeader(A,d.headers[A]);return d.type==="json"&&(C.responseType="text",C.setRequestHeader("Accept","application/json")),C.withCredentials=d.credentials==="include",C.onerror=function(){_(new Error(C.statusText))},C.onload=function(){if((C.status>=200&&C.status<300||C.status===0)&&C.response!==null){var L=C.response;if(d.type==="json")try{L=JSON.parse(C.response)}catch(z){return _(z)}_(null,L,C.getResponseHeader("Cache-Control"),C.getResponseHeader("Expires"))}else _(new Lo(C.statusText,C.status,d.url))},C.send(d.body),{cancel:function(){return C.abort()}}}(n,s)},hi=function(n,s){return ro(Ir(n,{type:"arrayBuffer"}),s)},fa=function(n,s){return ro(Ir(n,{method:"POST"}),s)},$="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";So=[],Ji=0;var ne=function(n,s){if(Rn.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),Ji>=ai.MAX_PARALLEL_IMAGE_REQUESTS){var l={requestParameters:n,callback:s,cancelled:!1,cancel:function(){this.cancelled=!0}};return So.push(l),l}Ji++;var d=!1,_=function(){if(!d)for(d=!0,Ji--;So.length&&Ji<ai.MAX_PARALLEL_IMAGE_REQUESTS;){var A=So.shift();A.cancelled||(A.cancel=ne(A.requestParameters,A.callback).cancel)}},C=hi(n,function(A,L,z,W){_(),A?s(A):L&&(va()?function(q,J){var se=new Xe.Blob([new Uint8Array(q)],{type:"image/png"});Xe.createImageBitmap(se).then(function(de){J(null,de)}).catch(function(de){J(new Error("Could not load image because of "+de.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(L,s):function(q,J,se,de){var Be=new Xe.Image,Ve=Xe.URL;Be.onload=function(){J(null,Be),Ve.revokeObjectURL(Be.src),Be.onload=null,Xe.requestAnimationFrame(function(){Be.src=$})},Be.onerror=function(){return J(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var at=new Xe.Blob([new Uint8Array(q)],{type:"image/png"});Be.cacheControl=se,Be.expires=de,Be.src=q.byteLength?Ve.createObjectURL(at):$}(L,s,z,W))});return{cancel:function(){C.cancel(),_()}}};function he(n,s,l){l[n]&&l[n].indexOf(s)!==-1||(l[n]=l[n]||[],l[n].push(s))}function be(n,s,l){if(l&&l[n]){var d=l[n].indexOf(s);d!==-1&&l[n].splice(d,1)}}var Ne=function(n,s){s===void 0&&(s={}),Ir(this,s),this.type=n},Ye=function(n){function s(l,d){d===void 0&&(d={}),n.call(this,"error",Ir({error:l},d))}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s}(Ne),lt=function(){};lt.prototype.on=function(n,s){return this._listeners=this._listeners||{},he(n,s,this._listeners),this},lt.prototype.off=function(n,s){return be(n,s,this._listeners),be(n,s,this._oneTimeListeners),this},lt.prototype.once=function(n,s){return this._oneTimeListeners=this._oneTimeListeners||{},he(n,s,this._oneTimeListeners),this},lt.prototype.fire=function(n,s){typeof n=="string"&&(n=new Ne(n,s||{}));var l=n.type;if(this.listens(l)){n.target=this;for(var d=0,_=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];d<_.length;d+=1)_[d].call(this,n);for(var C=0,A=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];C<A.length;C+=1){var L=A[C];be(l,L,this._oneTimeListeners),L.call(this,n)}var z=this._eventedParent;z&&(Ir(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),z.fire(n))}else n instanceof Ye&&console.error(n.error);return this},lt.prototype.listens=function(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)},lt.prototype.setEventedParent=function(n,s){return this._eventedParent=n,this._eventedParentData=s,this};var _e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},je=function(n,s,l,d){this.message=(n?n+": ":"")+l,d&&(this.identifier=d),s!=null&&s.__line__&&(this.line=s.__line__)};function Mt(n){var s=n.value;return s?[new je(n.key,s,"constants have been deprecated as of v8")]:[]}function Sr(n){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];for(var d=0,_=s;d<_.length;d+=1){var C=_[d];for(var A in C)n[A]=C[A]}return n}function zt(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Yt(n){if(Array.isArray(n))return n.map(Yt);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){var s={};for(var l in n)s[l]=Yt(n[l]);return s}return zt(n)}var Lr=function(n){function s(l,d){n.call(this,d),this.message=d,this.key=l}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s}(Error),$n=function(n,s){s===void 0&&(s=[]),this.parent=n,this.bindings={};for(var l=0,d=s;l<d.length;l+=1){var _=d[l];this.bindings[_[0]]=_[1]}};$n.prototype.concat=function(n){return new $n(this,n)},$n.prototype.get=function(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(n+" not found in scope.")},$n.prototype.has=function(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)};var vn={kind:"null"},Nt={kind:"number"},pr={kind:"string"},on={kind:"boolean"},cn={kind:"color"},$i={kind:"object"},Cn={kind:"value"},xt={kind:"collator"},St={kind:"formatted"},qi={kind:"resolvedImage"};function na(n,s){return{kind:"array",itemType:n,N:s}}function ea(n){if(n.kind==="array"){var s=ea(n.itemType);return typeof n.N=="number"?"array<"+s+", "+n.N+">":n.itemType.kind==="value"?"array":"array<"+s+">"}return n.kind}var oi=[vn,Nt,pr,on,cn,St,$i,na(Cn),qi];function Zi(n,s){if(s.kind==="error")return null;if(n.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Zi(n.itemType,s.itemType))&&(typeof n.N!="number"||n.N===s.N))return null}else{if(n.kind===s.kind)return null;if(n.kind==="value"){for(var l=0,d=oi;l<d.length;l+=1)if(!Zi(d[l],s))return null}}return"Expected "+ea(n)+" but found "+ea(s)+" instead."}function fo(n,s){return s.some(function(l){return l.kind===n.kind})}function mr(n,s){return s.some(function(l){return l==="null"?n===null:l==="array"?Array.isArray(n):l==="object"?n&&!Array.isArray(n)&&typeof n=="object":l===typeof n})}var lr=Jr(function(n,s){var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function d(L){return(L=Math.round(L))<0?0:L>255?255:L}function _(L){return d(L[L.length-1]==="%"?parseFloat(L)/100*255:parseInt(L))}function C(L){return(z=L[L.length-1]==="%"?parseFloat(L)/100:parseFloat(L))<0?0:z>1?1:z;var z}function A(L,z,W){return W<0?W+=1:W>1&&(W-=1),6*W<1?L+(z-L)*W*6:2*W<1?z:3*W<2?L+(z-L)*(2/3-W)*6:L}try{s.parseCSSColor=function(L){var z,W=L.replace(/ /g,"").toLowerCase();if(W in l)return l[W].slice();if(W[0]==="#")return W.length===4?(z=parseInt(W.substr(1),16))>=0&&z<=4095?[(3840&z)>>4|(3840&z)>>8,240&z|(240&z)>>4,15&z|(15&z)<<4,1]:null:W.length===7&&(z=parseInt(W.substr(1),16))>=0&&z<=16777215?[(16711680&z)>>16,(65280&z)>>8,255&z,1]:null;var q=W.indexOf("("),J=W.indexOf(")");if(q!==-1&&J+1===W.length){var se=W.substr(0,q),de=W.substr(q+1,J-(q+1)).split(","),Be=1;switch(se){case"rgba":if(de.length!==4)return null;Be=C(de.pop());case"rgb":return de.length!==3?null:[_(de[0]),_(de[1]),_(de[2]),Be];case"hsla":if(de.length!==4)return null;Be=C(de.pop());case"hsl":if(de.length!==3)return null;var Ve=(parseFloat(de[0])%360+360)%360/360,at=C(de[1]),$e=C(de[2]),Et=$e<=.5?$e*(at+1):$e+at-$e*at,Rt=2*$e-Et;return[d(255*A(Rt,Et,Ve+1/3)),d(255*A(Rt,Et,Ve)),d(255*A(Rt,Et,Ve-1/3)),Be];default:return null}}return null}}catch{}}).parseCSSColor,nt=function(n,s,l,d){d===void 0&&(d=1),this.r=n,this.g=s,this.b=l,this.a=d};nt.parse=function(n){if(n){if(n instanceof nt)return n;if(typeof n=="string"){var s=lr(n);if(s)return new nt(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3])}}},nt.prototype.toString=function(){var n=this.toArray(),s=n[1],l=n[2],d=n[3];return"rgba("+Math.round(n[0])+","+Math.round(s)+","+Math.round(l)+","+d+")"},nt.prototype.toArray=function(){var n=this.a;return n===0?[0,0,0,0]:[255*this.r/n,255*this.g/n,255*this.b/n,n]},nt.black=new nt(0,0,0,1),nt.white=new nt(1,1,1,1),nt.transparent=new nt(0,0,0,0),nt.red=new nt(1,0,0,1);var Ya=function(n,s,l){this.sensitivity=n?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Ya.prototype.compare=function(n,s){return this.collator.compare(n,s)},Ya.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var dt=function(n,s,l,d,_){this.text=n,this.image=s,this.scale=l,this.fontStack=d,this.textColor=_},wo=function(n){this.sections=n};wo.fromString=function(n){return new wo([new dt(n,null,null,null,null)])},wo.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(n){return n.text.length!==0||n.image&&n.image.name.length!==0})},wo.factory=function(n){return n instanceof wo?n:wo.fromString(n)},wo.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(n){return n.text}).join("")},wo.prototype.serialize=function(){for(var n=["format"],s=0,l=this.sections;s<l.length;s+=1){var d=l[s];if(d.image)n.push(["image",d.image.name]);else{n.push(d.text);var _={};d.fontStack&&(_["text-font"]=["literal",d.fontStack.split(",")]),d.scale&&(_["font-scale"]=d.scale),d.textColor&&(_["text-color"]=["rgba"].concat(d.textColor.toArray())),n.push(_)}}return n};var qa=function(n){this.name=n.name,this.available=n.available};function lu(n,s,l,d){return typeof n=="number"&&n>=0&&n<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof l=="number"&&l>=0&&l<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:"Invalid rgba value ["+[n,s,l,d].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof d=="number"?[n,s,l,d]:[n,s,l]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function No(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof nt||n instanceof Ya||n instanceof wo||n instanceof qa)return!0;if(Array.isArray(n)){for(var s=0,l=n;s<l.length;s+=1)if(!No(l[s]))return!1;return!0}if(typeof n=="object"){for(var d in n)if(!No(n[d]))return!1;return!0}return!1}function Li(n){if(n===null)return vn;if(typeof n=="string")return pr;if(typeof n=="boolean")return on;if(typeof n=="number")return Nt;if(n instanceof nt)return cn;if(n instanceof Ya)return xt;if(n instanceof wo)return St;if(n instanceof qa)return qi;if(Array.isArray(n)){for(var s,l=n.length,d=0,_=n;d<_.length;d+=1){var C=Li(_[d]);if(s){if(s===C)continue;s=Cn;break}s=C}return na(s||Cn,l)}return $i}function ic(n){var s=typeof n;return n===null?"":s==="string"||s==="number"||s==="boolean"?String(n):n instanceof nt||n instanceof wo||n instanceof qa?n.toString():JSON.stringify(n)}qa.prototype.toString=function(){return this.name},qa.fromString=function(n){return n?new qa({name:n,available:!1}):null},qa.prototype.serialize=function(){return["image",this.name]};var Aa=function(n,s){this.type=n,this.value=s};Aa.parse=function(n,s){if(n.length!==2)return s.error("'literal' expression requires exactly one argument, but found "+(n.length-1)+" instead.");if(!No(n[1]))return s.error("invalid value");var l=n[1],d=Li(l),_=s.expectedType;return d.kind!=="array"||d.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(d=_),new Aa(d,l)},Aa.prototype.evaluate=function(){return this.value},Aa.prototype.eachChild=function(){},Aa.prototype.outputDefined=function(){return!0},Aa.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof nt?["rgba"].concat(this.value.toArray()):this.value instanceof wo?this.value.serialize():this.value};var Ao=function(n){this.name="ExpressionEvaluationError",this.message=n};Ao.prototype.toJSON=function(){return this.message};var Ho={string:pr,number:Nt,boolean:on,object:$i},pa=function(n,s){this.type=n,this.args=s};pa.parse=function(n,s){if(n.length<2)return s.error("Expected at least one argument.");var l,d=1,_=n[0];if(_==="array"){var C,A;if(n.length>2){var L=n[1];if(typeof L!="string"||!(L in Ho)||L==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);C=Ho[L],d++}else C=Cn;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return s.error('The length argument to "array" must be a positive integer literal',2);A=n[2],d++}l=na(C,A)}else l=Ho[_];for(var z=[];d<n.length;d++){var W=s.parse(n[d],d,Cn);if(!W)return null;z.push(W)}return new pa(l,z)},pa.prototype.evaluate=function(n){for(var s=0;s<this.args.length;s++){var l=this.args[s].evaluate(n);if(!Zi(this.type,Li(l)))return l;if(s===this.args.length-1)throw new Ao("Expected value to be of type "+ea(this.type)+", but found "+ea(Li(l))+" instead.")}return null},pa.prototype.eachChild=function(n){this.args.forEach(n)},pa.prototype.outputDefined=function(){return this.args.every(function(n){return n.outputDefined()})},pa.prototype.serialize=function(){var n=this.type,s=[n.kind];if(n.kind==="array"){var l=n.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){s.push(l.kind);var d=n.N;(typeof d=="number"||this.args.length>1)&&s.push(d)}}return s.concat(this.args.map(function(_){return _.serialize()}))};var ws=function(n){this.type=St,this.sections=n};ws.parse=function(n,s){if(n.length<2)return s.error("Expected at least one argument.");var l=n[1];if(!Array.isArray(l)&&typeof l=="object")return s.error("First argument must be an image or text section.");for(var d=[],_=!1,C=1;C<=n.length-1;++C){var A=n[C];if(_&&typeof A=="object"&&!Array.isArray(A)){_=!1;var L=null;if(A["font-scale"]&&!(L=s.parse(A["font-scale"],1,Nt)))return null;var z=null;if(A["text-font"]&&!(z=s.parse(A["text-font"],1,na(pr))))return null;var W=null;if(A["text-color"]&&!(W=s.parse(A["text-color"],1,cn)))return null;var q=d[d.length-1];q.scale=L,q.font=z,q.textColor=W}else{var J=s.parse(n[C],1,Cn);if(!J)return null;var se=J.type.kind;if(se!=="string"&&se!=="value"&&se!=="null"&&se!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,d.push({content:J,scale:null,font:null,textColor:null})}}return new ws(d)},ws.prototype.evaluate=function(n){return new wo(this.sections.map(function(s){var l=s.content.evaluate(n);return Li(l)===qi?new dt("",l,null,null,null):new dt(ic(l),null,s.scale?s.scale.evaluate(n):null,s.font?s.font.evaluate(n).join(","):null,s.textColor?s.textColor.evaluate(n):null)}))},ws.prototype.eachChild=function(n){for(var s=0,l=this.sections;s<l.length;s+=1){var d=l[s];n(d.content),d.scale&&n(d.scale),d.font&&n(d.font),d.textColor&&n(d.textColor)}},ws.prototype.outputDefined=function(){return!1},ws.prototype.serialize=function(){for(var n=["format"],s=0,l=this.sections;s<l.length;s+=1){var d=l[s];n.push(d.content.serialize());var _={};d.scale&&(_["font-scale"]=d.scale.serialize()),d.font&&(_["text-font"]=d.font.serialize()),d.textColor&&(_["text-color"]=d.textColor.serialize()),n.push(_)}return n};var Vs=function(n){this.type=qi,this.input=n};Vs.parse=function(n,s){if(n.length!==2)return s.error("Expected two arguments.");var l=s.parse(n[1],1,pr);return l?new Vs(l):s.error("No image name provided.")},Vs.prototype.evaluate=function(n){var s=this.input.evaluate(n),l=qa.fromString(s);return l&&n.availableImages&&(l.available=n.availableImages.indexOf(s)>-1),l},Vs.prototype.eachChild=function(n){n(this.input)},Vs.prototype.outputDefined=function(){return!1},Vs.prototype.serialize=function(){return["image",this.input.serialize()]};var gl={"to-boolean":on,"to-color":cn,"to-number":Nt,"to-string":pr},oo=function(n,s){this.type=n,this.args=s};oo.parse=function(n,s){if(n.length<2)return s.error("Expected at least one argument.");var l=n[0];if((l==="to-boolean"||l==="to-string")&&n.length!==2)return s.error("Expected one argument.");for(var d=gl[l],_=[],C=1;C<n.length;C++){var A=s.parse(n[C],C,Cn);if(!A)return null;_.push(A)}return new oo(d,_)},oo.prototype.evaluate=function(n){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(n));if(this.type.kind==="color"){for(var s,l,d=0,_=this.args;d<_.length;d+=1){if(l=null,(s=_[d].evaluate(n))instanceof nt)return s;if(typeof s=="string"){var C=n.parseColor(s);if(C)return C}else if(Array.isArray(s)&&!(l=s.length<3||s.length>4?"Invalid rbga value "+JSON.stringify(s)+": expected an array containing either three or four numeric values.":lu(s[0],s[1],s[2],s[3])))return new nt(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Ao(l||"Could not parse color from value '"+(typeof s=="string"?s:String(JSON.stringify(s)))+"'")}if(this.type.kind==="number"){for(var A=null,L=0,z=this.args;L<z.length;L+=1){if((A=z[L].evaluate(n))===null)return 0;var W=Number(A);if(!isNaN(W))return W}throw new Ao("Could not convert "+JSON.stringify(A)+" to number.")}return this.type.kind==="formatted"?wo.fromString(ic(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?qa.fromString(ic(this.args[0].evaluate(n))):ic(this.args[0].evaluate(n))},oo.prototype.eachChild=function(n){this.args.forEach(n)},oo.prototype.outputDefined=function(){return this.args.every(function(n){return n.outputDefined()})},oo.prototype.serialize=function(){if(this.type.kind==="formatted")return new ws([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Vs(this.args[0]).serialize();var n=["to-"+this.type.kind];return this.eachChild(function(s){n.push(s.serialize())}),n};var ms=["Unknown","Point","LineString","Polygon"],Oa=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Oa.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Oa.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?ms[this.feature.type]:this.feature.type:null},Oa.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Oa.prototype.canonicalID=function(){return this.canonical},Oa.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Oa.prototype.parseColor=function(n){var s=this._parseColorCache[n];return s||(s=this._parseColorCache[n]=nt.parse(n)),s};var Ro=function(n,s,l,d){this.name=n,this.type=s,this._evaluate=l,this.args=d};Ro.prototype.evaluate=function(n){return this._evaluate(n,this.args)},Ro.prototype.eachChild=function(n){this.args.forEach(n)},Ro.prototype.outputDefined=function(){return!1},Ro.prototype.serialize=function(){return[this.name].concat(this.args.map(function(n){return n.serialize()}))},Ro.parse=function(n,s){var l,d=n[0],_=Ro.definitions[d];if(!_)return s.error('Unknown expression "'+d+'". If you wanted a literal array, use ["literal", [...]].',0);for(var C=Array.isArray(_)?_[0]:_.type,A=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,L=A.filter(function(bi){var Nn=bi[0];return!Array.isArray(Nn)||Nn.length===n.length-1}),z=null,W=0,q=L;W<q.length;W+=1){var J=q[W],se=J[0],de=J[1];z=new Mu(s.registry,s.path,null,s.scope);for(var Be=[],Ve=!1,at=1;at<n.length;at++){var $e=n[at],Et=Array.isArray(se)?se[at-1]:se.type,Rt=z.parse($e,1+Be.length,Et);if(!Rt){Ve=!0;break}Be.push(Rt)}if(!Ve)if(Array.isArray(se)&&se.length!==Be.length)z.error("Expected "+se.length+" arguments, but found "+Be.length+" instead.");else{for(var Jt=0;Jt<Be.length;Jt++){var $t=Array.isArray(se)?se[Jt]:se.type,Cr=Be[Jt];z.concat(Jt+1).checkSubtype($t,Cr.type)}if(z.errors.length===0)return new Ro(d,C,de,Be)}}if(L.length===1)(l=s.errors).push.apply(l,z.errors);else{for(var Yr=(L.length?L:A).map(function(bi){var Nn;return Nn=bi[0],Array.isArray(Nn)?"("+Nn.map(ea).join(", ")+")":"("+ea(Nn.type)+"...)"}).join(" | "),Sn=[],yi=1;yi<n.length;yi++){var Zn=s.parse(n[yi],1+Sn.length);if(!Zn)return null;Sn.push(ea(Zn.type))}s.error("Expected arguments of type "+Yr+", but found ("+Sn.join(", ")+") instead.")}return null},Ro.register=function(n,s){for(var l in Ro.definitions=s,s)n[l]=Ro};var Ps=function(n,s,l){this.type=xt,this.locale=l,this.caseSensitive=n,this.diacriticSensitive=s};function zo(n,s){n[0]=Math.min(n[0],s[0]),n[1]=Math.min(n[1],s[1]),n[2]=Math.max(n[2],s[0]),n[3]=Math.max(n[3],s[1])}function yu(n,s){return!(n[0]<=s[0]||n[2]>=s[2]||n[1]<=s[1]||n[3]>=s[3])}function el(n,s){var l=(180+n[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,_=Math.pow(2,s.z);return[Math.round(l*_*8192),Math.round(d*_*8192)]}function Wo(n,s,l){return s[1]>n[1]!=l[1]>n[1]&&n[0]<(l[0]-s[0])*(n[1]-s[1])/(l[1]-s[1])+s[0]}function fe(n,s){for(var l,d,_,C,A,L,z,W=!1,q=0,J=s.length;q<J;q++)for(var se=s[q],de=0,Be=se.length;de<Be-1;de++){if((C=(l=n)[0]-(d=se[de])[0])*(z=l[1]-(_=se[de+1])[1])-(L=l[0]-_[0])*(A=l[1]-d[1])==0&&C*L<=0&&A*z<=0)return!1;Wo(n,se[de],se[de+1])&&(W=!W)}return W}function Me(n,s){for(var l=0;l<s.length;l++)if(fe(n,s[l]))return!0;return!1}function ut(n,s,l,d){var _=d[0]-l[0],C=d[1]-l[1],A=(n[0]-l[0])*C-_*(n[1]-l[1]),L=(s[0]-l[0])*C-_*(s[1]-l[1]);return A>0&&L<0||A<0&&L>0}function Zt(n,s,l){for(var d=0,_=l;d<_.length;d+=1)for(var C=_[d],A=0;A<C.length-1;++A)if((J=[(q=C[A+1])[0]-(W=C[A])[0],q[1]-W[1]])[0]*(se=[(z=s)[0]-(L=n)[0],z[1]-L[1]])[1]-J[1]*se[0]!=0&&ut(L,z,W,q)&&ut(W,q,L,z))return!0;var L,z,W,q,J,se;return!1}function sn(n,s){for(var l=0;l<n.length;++l)if(!fe(n[l],s))return!1;for(var d=0;d<n.length-1;++d)if(Zt(n[d],n[d+1],s))return!1;return!0}function jn(n,s){for(var l=0;l<s.length;l++)if(sn(n,s[l]))return!0;return!1}function ua(n,s,l){for(var d=[],_=0;_<n.length;_++){for(var C=[],A=0;A<n[_].length;A++){var L=el(n[_][A],l);zo(s,L),C.push(L)}d.push(C)}return d}function Jo(n,s,l){for(var d=[],_=0;_<n.length;_++){var C=ua(n[_],s,l);d.push(C)}return d}function Ta(n,s,l,d){if(n[0]<l[0]||n[0]>l[2]){var _=.5*d,C=n[0]-l[0]>_?-d:l[0]-n[0]>_?d:0;C===0&&(C=n[0]-l[2]>_?-d:l[2]-n[0]>_?d:0),n[0]+=C}zo(s,n)}function so(n,s,l,d){for(var _=8192*Math.pow(2,d.z),C=[8192*d.x,8192*d.y],A=[],L=0,z=n;L<z.length;L+=1)for(var W=0,q=z[L];W<q.length;W+=1){var J=q[W],se=[J.x+C[0],J.y+C[1]];Ta(se,s,l,_),A.push(se)}return A}function xo(n,s,l,d){for(var _,C=8192*Math.pow(2,d.z),A=[8192*d.x,8192*d.y],L=[],z=0,W=n;z<W.length;z+=1){for(var q=[],J=0,se=W[z];J<se.length;J+=1){var de=se[J],Be=[de.x+A[0],de.y+A[1]];zo(s,Be),q.push(Be)}L.push(q)}if(s[2]-s[0]<=C/2){(_=s)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(var Ve=0,at=L;Ve<at.length;Ve+=1)for(var $e=0,Et=at[Ve];$e<Et.length;$e+=1)Ta(Et[$e],s,l,C)}return L}Ps.parse=function(n,s){if(n.length!==2)return s.error("Expected one argument.");var l=n[1];if(typeof l!="object"||Array.isArray(l))return s.error("Collator options argument must be an object.");var d=s.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,on);if(!d)return null;var _=s.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,on);if(!_)return null;var C=null;return l.locale&&!(C=s.parse(l.locale,1,pr))?null:new Ps(d,_,C)},Ps.prototype.evaluate=function(n){return new Ya(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)},Ps.prototype.eachChild=function(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)},Ps.prototype.outputDefined=function(){return!1},Ps.prototype.serialize=function(){var n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]};var To=function(n,s){this.type=on,this.geojson=n,this.geometries=s};function Ls(n){if(n instanceof Ro&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof To)return!1;var s=!0;return n.eachChild(function(l){s&&!Ls(l)&&(s=!1)}),s}function js(n){if(n instanceof Ro&&n.name==="feature-state")return!1;var s=!0;return n.eachChild(function(l){s&&!js(l)&&(s=!1)}),s}function _u(n,s){if(n instanceof Ro&&s.indexOf(n.name)>=0)return!1;var l=!0;return n.eachChild(function(d){l&&!_u(d,s)&&(l=!1)}),l}To.parse=function(n,s){if(n.length!==2)return s.error("'within' expression requires exactly one argument, but found "+(n.length-1)+" instead.");if(No(n[1])){var l=n[1];if(l.type==="FeatureCollection")for(var d=0;d<l.features.length;++d){var _=l.features[d].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new To(l,l.features[d].geometry)}else if(l.type==="Feature"){var C=l.geometry.type;if(C==="Polygon"||C==="MultiPolygon")return new To(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new To(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")},To.prototype.evaluate=function(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(s,l){var d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],C=s.canonicalID();if(l.type==="Polygon"){var A=ua(l.coordinates,_,C),L=so(s.geometry(),d,_,C);if(!yu(d,_))return!1;for(var z=0,W=L;z<W.length;z+=1)if(!fe(W[z],A))return!1}if(l.type==="MultiPolygon"){var q=Jo(l.coordinates,_,C),J=so(s.geometry(),d,_,C);if(!yu(d,_))return!1;for(var se=0,de=J;se<de.length;se+=1)if(!Me(de[se],q))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(s,l){var d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],C=s.canonicalID();if(l.type==="Polygon"){var A=ua(l.coordinates,_,C),L=xo(s.geometry(),d,_,C);if(!yu(d,_))return!1;for(var z=0,W=L;z<W.length;z+=1)if(!sn(W[z],A))return!1}if(l.type==="MultiPolygon"){var q=Jo(l.coordinates,_,C),J=xo(s.geometry(),d,_,C);if(!yu(d,_))return!1;for(var se=0,de=J;se<de.length;se+=1)if(!jn(de[se],q))return!1}return!0}(n,this.geometries)}return!1},To.prototype.eachChild=function(){},To.prototype.outputDefined=function(){return!0},To.prototype.serialize=function(){return["within",this.geojson]};var xu=function(n,s){this.type=s.type,this.name=n,this.boundExpression=s};xu.parse=function(n,s){if(n.length!==2||typeof n[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");var l=n[1];return s.scope.has(l)?new xu(l,s.scope.get(l)):s.error('Unknown variable "'+l+'". Make sure "'+l+'" has been bound in an enclosing "let" expression before using it.',1)},xu.prototype.evaluate=function(n){return this.boundExpression.evaluate(n)},xu.prototype.eachChild=function(){},xu.prototype.outputDefined=function(){return!1},xu.prototype.serialize=function(){return["var",this.name]};var Mu=function(n,s,l,d,_){s===void 0&&(s=[]),d===void 0&&(d=new $n),_===void 0&&(_=[]),this.registry=n,this.path=s,this.key=s.map(function(C){return"["+C+"]"}).join(""),this.scope=d,this.errors=_,this.expectedType=l};function Uo(n,s){for(var l,d=n.length-1,_=0,C=d,A=0;_<=C;)if((l=n[A=Math.floor((_+C)/2)])<=s){if(A===d||s<n[A+1])return A;_=A+1}else{if(!(l>s))throw new Ao("Input is not a number.");C=A-1}return 0}Mu.prototype.parse=function(n,s,l,d,_){return _===void 0&&(_={}),s?this.concat(s,l,d)._parse(n,_):this._parse(n,_)},Mu.prototype._parse=function(n,s){function l(W,q,J){return J==="assert"?new pa(q,[W]):J==="coerce"?new oo(q,[W]):W}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var d=n[0];if(typeof d!="string")return this.error("Expression name must be a string, but found "+typeof d+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var _=this.registry[d];if(_){var C=_.parse(n,this);if(!C)return null;if(this.expectedType){var A=this.expectedType,L=C.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||L.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||L.kind!=="value"&&L.kind!=="string"){if(this.checkSubtype(A,L))return null}else C=l(C,A,s.typeAnnotation||"coerce");else C=l(C,A,s.typeAnnotation||"assert")}if(!(C instanceof Aa)&&C.type.kind!=="resolvedImage"&&function W(q){if(q instanceof xu)return W(q.boundExpression);if(q instanceof Ro&&q.name==="error"||q instanceof Ps||q instanceof To)return!1;var J=q instanceof oo||q instanceof pa,se=!0;return q.eachChild(function(de){se=J?se&&W(de):se&&de instanceof Aa}),!!se&&Ls(q)&&_u(q,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(C)){var z=new Oa;try{C=new Aa(C.type,C.evaluate(z))}catch(W){return this.error(W.message),null}}return C}return this.error('Unknown expression "'+d+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof n+" instead.")},Mu.prototype.concat=function(n,s,l){var d=typeof n=="number"?this.path.concat(n):this.path,_=l?this.scope.concat(l):this.scope;return new Mu(this.registry,d,s||null,_,this.errors)},Mu.prototype.error=function(n){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];var d=""+this.key+s.map(function(_){return"["+_+"]"}).join("");this.errors.push(new Lr(d,n))},Mu.prototype.checkSubtype=function(n,s){var l=Zi(n,s);return l&&this.error(l),l};var Zo=function(n,s,l){this.type=n,this.input=s,this.labels=[],this.outputs=[];for(var d=0,_=l;d<_.length;d+=1){var C=_[d],A=C[1];this.labels.push(C[0]),this.outputs.push(A)}};function Fa(n,s,l){return n*(1-l)+s*l}Zo.parse=function(n,s){if(n.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(n.length-1)+".");if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");var l=s.parse(n[1],1,Nt);if(!l)return null;var d=[],_=null;s.expectedType&&s.expectedType.kind!=="value"&&(_=s.expectedType);for(var C=1;C<n.length;C+=2){var A=C===1?-1/0:n[C],L=n[C+1],z=C,W=C+1;if(typeof A!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(d.length&&d[d.length-1][0]>=A)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);var q=s.parse(L,W,_);if(!q)return null;_=_||q.type,d.push([A,q])}return new Zo(_,l,d)},Zo.prototype.evaluate=function(n){var s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(n);var d=this.input.evaluate(n);if(d<=s[0])return l[0].evaluate(n);var _=s.length;return d>=s[_-1]?l[_-1].evaluate(n):l[Uo(s,d)].evaluate(n)},Zo.prototype.eachChild=function(n){n(this.input);for(var s=0,l=this.outputs;s<l.length;s+=1)n(l[s])},Zo.prototype.outputDefined=function(){return this.outputs.every(function(n){return n.outputDefined()})},Zo.prototype.serialize=function(){for(var n=["step",this.input.serialize()],s=0;s<this.labels.length;s++)s>0&&n.push(this.labels[s]),n.push(this.outputs[s].serialize());return n};var As=Object.freeze({__proto__:null,number:Fa,color:function(n,s,l){return new nt(Fa(n.r,s.r,l),Fa(n.g,s.g,l),Fa(n.b,s.b,l),Fa(n.a,s.a,l))},array:function(n,s,l){return n.map(function(d,_){return Fa(d,s[_],l)})}}),Hu=6/29*3*(6/29),Zh=Math.PI/180,Cc=180/Math.PI;function Xf(n){return n>.008856451679035631?Math.pow(n,1/3):n/Hu+4/29}function yl(n){return n>6/29?n*n*n:Hu*(n-4/29)}function Hc(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function _l(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function gf(n){var s=_l(n.r),l=_l(n.g),d=_l(n.b),_=Xf((.4124564*s+.3575761*l+.1804375*d)/.95047),C=Xf((.2126729*s+.7151522*l+.072175*d)/1);return{l:116*C-16,a:500*(_-C),b:200*(C-Xf((.0193339*s+.119192*l+.9503041*d)/1.08883)),alpha:n.a}}function b(n){var s=(n.l+16)/116,l=isNaN(n.a)?s:s+n.a/500,d=isNaN(n.b)?s:s-n.b/200;return s=1*yl(s),l=.95047*yl(l),d=1.08883*yl(d),new nt(Hc(3.2404542*l-1.5371385*s-.4985314*d),Hc(-.969266*l+1.8760108*s+.041556*d),Hc(.0556434*l-.2040259*s+1.0572252*d),n.alpha)}function I(n,s,l){var d=s-n;return n+l*(d>180||d<-180?d-360*Math.round(d/360):d)}var G={forward:gf,reverse:b,interpolate:function(n,s,l){return{l:Fa(n.l,s.l,l),a:Fa(n.a,s.a,l),b:Fa(n.b,s.b,l),alpha:Fa(n.alpha,s.alpha,l)}}},D={forward:function(n){var s=gf(n),l=s.l,d=s.a,_=s.b,C=Math.atan2(_,d)*Cc;return{h:C<0?C+360:C,c:Math.sqrt(d*d+_*_),l,alpha:n.a}},reverse:function(n){var s=n.h*Zh,l=n.c;return b({l:n.l,a:Math.cos(s)*l,b:Math.sin(s)*l,alpha:n.alpha})},interpolate:function(n,s,l){return{h:I(n.h,s.h,l),c:Fa(n.c,s.c,l),l:Fa(n.l,s.l,l),alpha:Fa(n.alpha,s.alpha,l)}}},re=Object.freeze({__proto__:null,lab:G,hcl:D}),Te=function(n,s,l,d,_){this.type=n,this.operator=s,this.interpolation=l,this.input=d,this.labels=[],this.outputs=[];for(var C=0,A=_;C<A.length;C+=1){var L=A[C],z=L[1];this.labels.push(L[0]),this.outputs.push(z)}};function it(n,s,l,d){var _=d-l,C=n-l;return _===0?0:s===1?C/_:(Math.pow(s,C)-1)/(Math.pow(s,_)-1)}Te.interpolationFactor=function(n,s,l,d){var _=0;if(n.name==="exponential")_=it(s,n.base,l,d);else if(n.name==="linear")_=it(s,1,l,d);else if(n.name==="cubic-bezier"){var C=n.controlPoints;_=new tt(C[0],C[1],C[2],C[3]).solve(it(s,1,l,d))}return _},Te.parse=function(n,s){var l=n[0],d=n[1],_=n[2],C=n.slice(3);if(!Array.isArray(d)||d.length===0)return s.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){var A=d[1];if(typeof A!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:A}}else{if(d[0]!=="cubic-bezier")return s.error("Unknown interpolation type "+String(d[0]),1,0);var L=d.slice(1);if(L.length!==4||L.some(function(at){return typeof at!="number"||at<0||at>1}))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:L}}if(n.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(n.length-1)+".");if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(!(_=s.parse(_,2,Nt)))return null;var z=[],W=null;l==="interpolate-hcl"||l==="interpolate-lab"?W=cn:s.expectedType&&s.expectedType.kind!=="value"&&(W=s.expectedType);for(var q=0;q<C.length;q+=2){var J=C[q],se=C[q+1],de=q+3,Be=q+4;if(typeof J!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',de);if(z.length&&z[z.length-1][0]>=J)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',de);var Ve=s.parse(se,Be,W);if(!Ve)return null;W=W||Ve.type,z.push([J,Ve])}return W.kind==="number"||W.kind==="color"||W.kind==="array"&&W.itemType.kind==="number"&&typeof W.N=="number"?new Te(W,l,d,_,z):s.error("Type "+ea(W)+" is not interpolatable.")},Te.prototype.evaluate=function(n){var s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(n);var d=this.input.evaluate(n);if(d<=s[0])return l[0].evaluate(n);var _=s.length;if(d>=s[_-1])return l[_-1].evaluate(n);var C=Uo(s,d),A=Te.interpolationFactor(this.interpolation,d,s[C],s[C+1]),L=l[C].evaluate(n),z=l[C+1].evaluate(n);return this.operator==="interpolate"?As[this.type.kind.toLowerCase()](L,z,A):this.operator==="interpolate-hcl"?D.reverse(D.interpolate(D.forward(L),D.forward(z),A)):G.reverse(G.interpolate(G.forward(L),G.forward(z),A))},Te.prototype.eachChild=function(n){n(this.input);for(var s=0,l=this.outputs;s<l.length;s+=1)n(l[s])},Te.prototype.outputDefined=function(){return this.outputs.every(function(n){return n.outputDefined()})},Te.prototype.serialize=function(){var n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var s=[this.operator,n,this.input.serialize()],l=0;l<this.labels.length;l++)s.push(this.labels[l],this.outputs[l].serialize());return s};var ht=function(n,s){this.type=n,this.args=s};ht.parse=function(n,s){if(n.length<2)return s.error("Expectected at least one argument.");var l=null,d=s.expectedType;d&&d.kind!=="value"&&(l=d);for(var _=[],C=0,A=n.slice(1);C<A.length;C+=1){var L=s.parse(A[C],1+_.length,l,void 0,{typeAnnotation:"omit"});if(!L)return null;l=l||L.type,_.push(L)}var z=d&&_.some(function(W){return Zi(d,W.type)});return new ht(z?Cn:l,_)},ht.prototype.evaluate=function(n){for(var s,l=null,d=0,_=0,C=this.args;_<C.length&&(d++,(l=C[_].evaluate(n))&&l instanceof qa&&!l.available&&(s||(s=l.name),l=null,d===this.args.length&&(l=s)),l===null);_+=1);return l},ht.prototype.eachChild=function(n){this.args.forEach(n)},ht.prototype.outputDefined=function(){return this.args.every(function(n){return n.outputDefined()})},ht.prototype.serialize=function(){var n=["coalesce"];return this.eachChild(function(s){n.push(s.serialize())}),n};var Tt=function(n,s){this.type=s.type,this.bindings=[].concat(n),this.result=s};Tt.prototype.evaluate=function(n){return this.result.evaluate(n)},Tt.prototype.eachChild=function(n){for(var s=0,l=this.bindings;s<l.length;s+=1)n(l[s][1]);n(this.result)},Tt.parse=function(n,s){if(n.length<4)return s.error("Expected at least 3 arguments, but found "+(n.length-1)+" instead.");for(var l=[],d=1;d<n.length-1;d+=2){var _=n[d];if(typeof _!="string")return s.error("Expected string, but found "+typeof _+" instead.",d);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",d);var C=s.parse(n[d+1],d+1);if(!C)return null;l.push([_,C])}var A=s.parse(n[n.length-1],n.length-1,s.expectedType,l);return A?new Tt(l,A):null},Tt.prototype.outputDefined=function(){return this.result.outputDefined()},Tt.prototype.serialize=function(){for(var n=["let"],s=0,l=this.bindings;s<l.length;s+=1){var d=l[s];n.push(d[0],d[1].serialize())}return n.push(this.result.serialize()),n};var _r=function(n,s,l){this.type=n,this.index=s,this.input=l};_r.parse=function(n,s){if(n.length!==3)return s.error("Expected 2 arguments, but found "+(n.length-1)+" instead.");var l=s.parse(n[1],1,Nt),d=s.parse(n[2],2,na(s.expectedType||Cn));return l&&d?new _r(d.type.itemType,l,d):null},_r.prototype.evaluate=function(n){var s=this.index.evaluate(n),l=this.input.evaluate(n);if(s<0)throw new Ao("Array index out of bounds: "+s+" < 0.");if(s>=l.length)throw new Ao("Array index out of bounds: "+s+" > "+(l.length-1)+".");if(s!==Math.floor(s))throw new Ao("Array index must be an integer, but found "+s+" instead.");return l[s]},_r.prototype.eachChild=function(n){n(this.index),n(this.input)},_r.prototype.outputDefined=function(){return!1},_r.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var br=function(n,s){this.type=on,this.needle=n,this.haystack=s};br.parse=function(n,s){if(n.length!==3)return s.error("Expected 2 arguments, but found "+(n.length-1)+" instead.");var l=s.parse(n[1],1,Cn),d=s.parse(n[2],2,Cn);return l&&d?fo(l.type,[on,pr,Nt,vn,Cn])?new br(l,d):s.error("Expected first argument to be of type boolean, string, number or null, but found "+ea(l.type)+" instead"):null},br.prototype.evaluate=function(n){var s=this.needle.evaluate(n),l=this.haystack.evaluate(n);if(!l)return!1;if(!mr(s,["boolean","string","number","null"]))throw new Ao("Expected first argument to be of type boolean, string, number or null, but found "+ea(Li(s))+" instead.");if(!mr(l,["string","array"]))throw new Ao("Expected second argument to be of type array or string, but found "+ea(Li(l))+" instead.");return l.indexOf(s)>=0},br.prototype.eachChild=function(n){n(this.needle),n(this.haystack)},br.prototype.outputDefined=function(){return!0},br.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var si=function(n,s,l){this.type=Nt,this.needle=n,this.haystack=s,this.fromIndex=l};si.parse=function(n,s){if(n.length<=2||n.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(n.length-1)+" instead.");var l=s.parse(n[1],1,Cn),d=s.parse(n[2],2,Cn);if(!l||!d)return null;if(!fo(l.type,[on,pr,Nt,vn,Cn]))return s.error("Expected first argument to be of type boolean, string, number or null, but found "+ea(l.type)+" instead");if(n.length===4){var _=s.parse(n[3],3,Nt);return _?new si(l,d,_):null}return new si(l,d)},si.prototype.evaluate=function(n){var s=this.needle.evaluate(n),l=this.haystack.evaluate(n);if(!mr(s,["boolean","string","number","null"]))throw new Ao("Expected first argument to be of type boolean, string, number or null, but found "+ea(Li(s))+" instead.");if(!mr(l,["string","array"]))throw new Ao("Expected second argument to be of type array or string, but found "+ea(Li(l))+" instead.");if(this.fromIndex){var d=this.fromIndex.evaluate(n);return l.indexOf(s,d)}return l.indexOf(s)},si.prototype.eachChild=function(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)},si.prototype.outputDefined=function(){return!1},si.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Ni=function(n,s,l,d,_,C){this.inputType=n,this.type=s,this.input=l,this.cases=d,this.outputs=_,this.otherwise=C};Ni.parse=function(n,s){if(n.length<5)return s.error("Expected at least 4 arguments, but found only "+(n.length-1)+".");if(n.length%2!=1)return s.error("Expected an even number of arguments.");var l,d;s.expectedType&&s.expectedType.kind!=="value"&&(d=s.expectedType);for(var _={},C=[],A=2;A<n.length-1;A+=2){var L=n[A],z=n[A+1];Array.isArray(L)||(L=[L]);var W=s.concat(A);if(L.length===0)return W.error("Expected at least one branch label.");for(var q=0,J=L;q<J.length;q+=1){var se=J[q];if(typeof se!="number"&&typeof se!="string")return W.error("Branch labels must be numbers or strings.");if(typeof se=="number"&&Math.abs(se)>Number.MAX_SAFE_INTEGER)return W.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof se=="number"&&Math.floor(se)!==se)return W.error("Numeric branch labels must be integer values.");if(l){if(W.checkSubtype(l,Li(se)))return null}else l=Li(se);if(_[String(se)]!==void 0)return W.error("Branch labels must be unique.");_[String(se)]=C.length}var de=s.parse(z,A,d);if(!de)return null;d=d||de.type,C.push(de)}var Be=s.parse(n[1],1,Cn);if(!Be)return null;var Ve=s.parse(n[n.length-1],n.length-1,d);return Ve?Be.type.kind!=="value"&&s.concat(1).checkSubtype(l,Be.type)?null:new Ni(l,d,Be,_,C,Ve):null},Ni.prototype.evaluate=function(n){var s=this.input.evaluate(n);return(Li(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(n)},Ni.prototype.eachChild=function(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)},Ni.prototype.outputDefined=function(){return this.outputs.every(function(n){return n.outputDefined()})&&this.otherwise.outputDefined()},Ni.prototype.serialize=function(){for(var n=this,s=["match",this.input.serialize()],l=[],d={},_=0,C=Object.keys(this.cases).sort();_<C.length;_+=1){var A=C[_];(J=d[this.cases[A]])===void 0?(d[this.cases[A]]=l.length,l.push([this.cases[A],[A]])):l[J][1].push(A)}for(var L=function(de){return n.inputType.kind==="number"?Number(de):de},z=0,W=l;z<W.length;z+=1){var q=W[z],J=q[0],se=q[1];s.push(se.length===1?L(se[0]):se.map(L)),s.push(this.outputs[outputIndex$1].serialize())}return s.push(this.otherwise.serialize()),s};var Di=function(n,s,l){this.type=n,this.branches=s,this.otherwise=l};Di.parse=function(n,s){if(n.length<4)return s.error("Expected at least 3 arguments, but found only "+(n.length-1)+".");if(n.length%2!=0)return s.error("Expected an odd number of arguments.");var l;s.expectedType&&s.expectedType.kind!=="value"&&(l=s.expectedType);for(var d=[],_=1;_<n.length-1;_+=2){var C=s.parse(n[_],_,on);if(!C)return null;var A=s.parse(n[_+1],_+1,l);if(!A)return null;d.push([C,A]),l=l||A.type}var L=s.parse(n[n.length-1],n.length-1,l);return L?new Di(l,d,L):null},Di.prototype.evaluate=function(n){for(var s=0,l=this.branches;s<l.length;s+=1){var d=l[s],_=d[1];if(d[0].evaluate(n))return _.evaluate(n)}return this.otherwise.evaluate(n)},Di.prototype.eachChild=function(n){for(var s=0,l=this.branches;s<l.length;s+=1){var d=l[s],_=d[1];n(d[0]),n(_)}n(this.otherwise)},Di.prototype.outputDefined=function(){return this.branches.every(function(n){return n[1].outputDefined()})&&this.otherwise.outputDefined()},Di.prototype.serialize=function(){var n=["case"];return this.eachChild(function(s){n.push(s.serialize())}),n};var ia=function(n,s,l,d){this.type=n,this.input=s,this.beginIndex=l,this.endIndex=d};function Ga(n,s){return n==="=="||n==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function uo(n,s,l,d){return d.compare(s,l)===0}function ga(n,s,l){var d=n!=="=="&&n!=="!=";return function(){function _(C,A,L){this.type=on,this.lhs=C,this.rhs=A,this.collator=L,this.hasUntypedArgument=C.type.kind==="value"||A.type.kind==="value"}return _.parse=function(C,A){if(C.length!==3&&C.length!==4)return A.error("Expected two or three arguments.");var L=C[0],z=A.parse(C[1],1,Cn);if(!z)return null;if(!Ga(L,z.type))return A.concat(1).error('"'+L+`" comparisons are not supported for type '`+ea(z.type)+"'.");var W=A.parse(C[2],2,Cn);if(!W)return null;if(!Ga(L,W.type))return A.concat(2).error('"'+L+`" comparisons are not supported for type '`+ea(W.type)+"'.");if(z.type.kind!==W.type.kind&&z.type.kind!=="value"&&W.type.kind!=="value")return A.error("Cannot compare types '"+ea(z.type)+"' and '"+ea(W.type)+"'.");d&&(z.type.kind==="value"&&W.type.kind!=="value"?z=new pa(W.type,[z]):z.type.kind!=="value"&&W.type.kind==="value"&&(W=new pa(z.type,[W])));var q=null;if(C.length===4){if(z.type.kind!=="string"&&W.type.kind!=="string"&&z.type.kind!=="value"&&W.type.kind!=="value")return A.error("Cannot use collator to compare non-string types.");if(!(q=A.parse(C[3],3,xt)))return null}return new _(z,W,q)},_.prototype.evaluate=function(C){var A=this.lhs.evaluate(C),L=this.rhs.evaluate(C);if(d&&this.hasUntypedArgument){var z=Li(A),W=Li(L);if(z.kind!==W.kind||z.kind!=="string"&&z.kind!=="number")throw new Ao('Expected arguments for "'+n+'" to be (string, string) or (number, number), but found ('+z.kind+", "+W.kind+") instead.")}if(this.collator&&!d&&this.hasUntypedArgument){var q=Li(A),J=Li(L);if(q.kind!=="string"||J.kind!=="string")return s(C,A,L)}return this.collator?l(C,A,L,this.collator.evaluate(C)):s(C,A,L)},_.prototype.eachChild=function(C){C(this.lhs),C(this.rhs),this.collator&&C(this.collator)},_.prototype.outputDefined=function(){return!0},_.prototype.serialize=function(){var C=[n];return this.eachChild(function(A){C.push(A.serialize())}),C},_}()}ia.parse=function(n,s){if(n.length<=2||n.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(n.length-1)+" instead.");var l=s.parse(n[1],1,Cn),d=s.parse(n[2],2,Nt);if(!l||!d)return null;if(!fo(l.type,[na(Cn),pr,Cn]))return s.error("Expected first argument to be of type array or string, but found "+ea(l.type)+" instead");if(n.length===4){var _=s.parse(n[3],3,Nt);return _?new ia(l.type,l,d,_):null}return new ia(l.type,l,d)},ia.prototype.evaluate=function(n){var s=this.input.evaluate(n),l=this.beginIndex.evaluate(n);if(!mr(s,["string","array"]))throw new Ao("Expected first argument to be of type array or string, but found "+ea(Li(s))+" instead.");if(this.endIndex){var d=this.endIndex.evaluate(n);return s.slice(l,d)}return s.slice(l)},ia.prototype.eachChild=function(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)},ia.prototype.outputDefined=function(){return!1},ia.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Ks=ga("==",function(n,s,l){return s===l},uo),Zl=ga("!=",function(n,s,l){return s!==l},function(n,s,l,d){return!uo(0,s,l,d)}),Wc=ga("<",function(n,s,l){return s<l},function(n,s,l,d){return d.compare(s,l)<0}),Xc=ga(">",function(n,s,l){return s>l},function(n,s,l,d){return d.compare(s,l)>0}),Sc=ga("<=",function(n,s,l){return s<=l},function(n,s,l,d){return d.compare(s,l)<=0}),wc=ga(">=",function(n,s,l){return s>=l},function(n,s,l,d){return d.compare(s,l)>=0}),ku=function(n,s,l,d,_){this.type=pr,this.number=n,this.locale=s,this.currency=l,this.minFractionDigits=d,this.maxFractionDigits=_};ku.parse=function(n,s){if(n.length!==3)return s.error("Expected two arguments.");var l=s.parse(n[1],1,Nt);if(!l)return null;var d=n[2];if(typeof d!="object"||Array.isArray(d))return s.error("NumberFormat options argument must be an object.");var _=null;if(d.locale&&!(_=s.parse(d.locale,1,pr)))return null;var C=null;if(d.currency&&!(C=s.parse(d.currency,1,pr)))return null;var A=null;if(d["min-fraction-digits"]&&!(A=s.parse(d["min-fraction-digits"],1,Nt)))return null;var L=null;return d["max-fraction-digits"]&&!(L=s.parse(d["max-fraction-digits"],1,Nt))?null:new ku(l,_,C,A,L)},ku.prototype.evaluate=function(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))},ku.prototype.eachChild=function(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)},ku.prototype.outputDefined=function(){return!1},ku.prototype.serialize=function(){var n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]};var Vl=function(n){this.type=Nt,this.input=n};Vl.parse=function(n,s){if(n.length!==2)return s.error("Expected 1 argument, but found "+(n.length-1)+" instead.");var l=s.parse(n[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?s.error("Expected argument of type string or array, but found "+ea(l.type)+" instead."):new Vl(l):null},Vl.prototype.evaluate=function(n){var s=this.input.evaluate(n);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Ao("Expected value to be of type string or array, but found "+ea(Li(s))+" instead.")},Vl.prototype.eachChild=function(n){n(this.input)},Vl.prototype.outputDefined=function(){return!1},Vl.prototype.serialize=function(){var n=["length"];return this.eachChild(function(s){n.push(s.serialize())}),n};var xl={"==":Ks,"!=":Zl,">":Xc,"<":Wc,">=":wc,"<=":Sc,array:pa,at:_r,boolean:pa,case:Di,coalesce:ht,collator:Ps,format:ws,image:Vs,in:br,"index-of":si,interpolate:Te,"interpolate-hcl":Te,"interpolate-lab":Te,length:Vl,let:Tt,literal:Aa,match:Ni,number:pa,"number-format":ku,object:pa,slice:ia,step:Zo,string:pa,"to-boolean":oo,"to-color":oo,"to-number":oo,"to-string":oo,var:xu,within:To};function Oo(n,s){var l=s[0],d=s[1],_=s[2],C=s[3];l=l.evaluate(n),d=d.evaluate(n),_=_.evaluate(n);var A=C?C.evaluate(n):1,L=lu(l,d,_,A);if(L)throw new Ao(L);return new nt(l/255*A,d/255*A,_/255*A,A)}function Vh(n,s){return n in s}function jh(n,s){var l=s[n];return l===void 0?null:l}function Iu(n){return{type:n}}function fh(n){return{result:"success",value:n}}function ac(n){return{result:"error",value:n}}function Rs(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function hh(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function bl(n){return!!n.expression&&n.expression.interpolated}function no(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Pu(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Yf(n){return n}function El(n,s,l){return n!==void 0?n:s!==void 0?s:l!==void 0?l:void 0}function od(n,s,l,d,_){return El(typeof l===_?d[l]:void 0,n.default,s.default)}function i0(n,s,l){if(no(l)!=="number")return El(n.default,s.default);var d=n.stops.length;if(d===1||l<=n.stops[0][0])return n.stops[0][1];if(l>=n.stops[d-1][0])return n.stops[d-1][1];var _=Uo(n.stops.map(function(C){return C[0]}),l);return n.stops[_][1]}function sd(n,s,l){var d=n.base!==void 0?n.base:1;if(no(l)!=="number")return El(n.default,s.default);var _=n.stops.length;if(_===1||l<=n.stops[0][0])return n.stops[0][1];if(l>=n.stops[_-1][0])return n.stops[_-1][1];var C=Uo(n.stops.map(function(J){return J[0]}),l),A=function(J,se,de,Be){var Ve=Be-de,at=J-de;return Ve===0?0:se===1?at/Ve:(Math.pow(se,at)-1)/(Math.pow(se,Ve)-1)}(l,d,n.stops[C][0],n.stops[C+1][0]),L=n.stops[C][1],z=n.stops[C+1][1],W=As[s.type]||Yf;if(n.colorSpace&&n.colorSpace!=="rgb"){var q=re[n.colorSpace];W=function(J,se){return q.reverse(q.interpolate(q.forward(J),q.forward(se),A))}}return typeof L.evaluate=="function"?{evaluate:function(){for(var J=[],se=arguments.length;se--;)J[se]=arguments[se];var de=L.evaluate.apply(void 0,J),Be=z.evaluate.apply(void 0,J);if(de!==void 0&&Be!==void 0)return W(de,Be,A)}}:W(L,z,A)}function ph(n,s,l){return s.type==="color"?l=nt.parse(l):s.type==="formatted"?l=wo.fromString(l.toString()):s.type==="resolvedImage"?l=qa.fromString(l.toString()):no(l)===s.type||s.type==="enum"&&s.values[l]||(l=void 0),El(l,n.default,s.default)}Ro.register(xl,{error:[{kind:"error"},[pr],function(n,s){throw new Ao(s[0].evaluate(n))}],typeof:[pr,[Cn],function(n,s){return ea(Li(s[0].evaluate(n)))}],"to-rgba":[na(Nt,4),[cn],function(n,s){return s[0].evaluate(n).toArray()}],rgb:[cn,[Nt,Nt,Nt],Oo],rgba:[cn,[Nt,Nt,Nt,Nt],Oo],has:{type:on,overloads:[[[pr],function(n,s){return Vh(s[0].evaluate(n),n.properties())}],[[pr,$i],function(n,s){var l=s[1];return Vh(s[0].evaluate(n),l.evaluate(n))}]]},get:{type:Cn,overloads:[[[pr],function(n,s){return jh(s[0].evaluate(n),n.properties())}],[[pr,$i],function(n,s){var l=s[1];return jh(s[0].evaluate(n),l.evaluate(n))}]]},"feature-state":[Cn,[pr],function(n,s){return jh(s[0].evaluate(n),n.featureState||{})}],properties:[$i,[],function(n){return n.properties()}],"geometry-type":[pr,[],function(n){return n.geometryType()}],id:[Cn,[],function(n){return n.id()}],zoom:[Nt,[],function(n){return n.globals.zoom}],"heatmap-density":[Nt,[],function(n){return n.globals.heatmapDensity||0}],"line-progress":[Nt,[],function(n){return n.globals.lineProgress||0}],accumulated:[Cn,[],function(n){return n.globals.accumulated===void 0?null:n.globals.accumulated}],"+":[Nt,Iu(Nt),function(n,s){for(var l=0,d=0,_=s;d<_.length;d+=1)l+=_[d].evaluate(n);return l}],"*":[Nt,Iu(Nt),function(n,s){for(var l=1,d=0,_=s;d<_.length;d+=1)l*=_[d].evaluate(n);return l}],"-":{type:Nt,overloads:[[[Nt,Nt],function(n,s){var l=s[1];return s[0].evaluate(n)-l.evaluate(n)}],[[Nt],function(n,s){return-s[0].evaluate(n)}]]},"/":[Nt,[Nt,Nt],function(n,s){var l=s[1];return s[0].evaluate(n)/l.evaluate(n)}],"%":[Nt,[Nt,Nt],function(n,s){var l=s[1];return s[0].evaluate(n)%l.evaluate(n)}],ln2:[Nt,[],function(){return Math.LN2}],pi:[Nt,[],function(){return Math.PI}],e:[Nt,[],function(){return Math.E}],"^":[Nt,[Nt,Nt],function(n,s){var l=s[1];return Math.pow(s[0].evaluate(n),l.evaluate(n))}],sqrt:[Nt,[Nt],function(n,s){return Math.sqrt(s[0].evaluate(n))}],log10:[Nt,[Nt],function(n,s){return Math.log(s[0].evaluate(n))/Math.LN10}],ln:[Nt,[Nt],function(n,s){return Math.log(s[0].evaluate(n))}],log2:[Nt,[Nt],function(n,s){return Math.log(s[0].evaluate(n))/Math.LN2}],sin:[Nt,[Nt],function(n,s){return Math.sin(s[0].evaluate(n))}],cos:[Nt,[Nt],function(n,s){return Math.cos(s[0].evaluate(n))}],tan:[Nt,[Nt],function(n,s){return Math.tan(s[0].evaluate(n))}],asin:[Nt,[Nt],function(n,s){return Math.asin(s[0].evaluate(n))}],acos:[Nt,[Nt],function(n,s){return Math.acos(s[0].evaluate(n))}],atan:[Nt,[Nt],function(n,s){return Math.atan(s[0].evaluate(n))}],min:[Nt,Iu(Nt),function(n,s){return Math.min.apply(Math,s.map(function(l){return l.evaluate(n)}))}],max:[Nt,Iu(Nt),function(n,s){return Math.max.apply(Math,s.map(function(l){return l.evaluate(n)}))}],abs:[Nt,[Nt],function(n,s){return Math.abs(s[0].evaluate(n))}],round:[Nt,[Nt],function(n,s){var l=s[0].evaluate(n);return l<0?-Math.round(-l):Math.round(l)}],floor:[Nt,[Nt],function(n,s){return Math.floor(s[0].evaluate(n))}],ceil:[Nt,[Nt],function(n,s){return Math.ceil(s[0].evaluate(n))}],"filter-==":[on,[pr,Cn],function(n,s){var l=s[0],d=s[1];return n.properties()[l.value]===d.value}],"filter-id-==":[on,[Cn],function(n,s){var l=s[0];return n.id()===l.value}],"filter-type-==":[on,[pr],function(n,s){var l=s[0];return n.geometryType()===l.value}],"filter-<":[on,[pr,Cn],function(n,s){var l=s[0],d=s[1],_=n.properties()[l.value],C=d.value;return typeof _==typeof C&&_<C}],"filter-id-<":[on,[Cn],function(n,s){var l=s[0],d=n.id(),_=l.value;return typeof d==typeof _&&d<_}],"filter->":[on,[pr,Cn],function(n,s){var l=s[0],d=s[1],_=n.properties()[l.value],C=d.value;return typeof _==typeof C&&_>C}],"filter-id->":[on,[Cn],function(n,s){var l=s[0],d=n.id(),_=l.value;return typeof d==typeof _&&d>_}],"filter-<=":[on,[pr,Cn],function(n,s){var l=s[0],d=s[1],_=n.properties()[l.value],C=d.value;return typeof _==typeof C&&_<=C}],"filter-id-<=":[on,[Cn],function(n,s){var l=s[0],d=n.id(),_=l.value;return typeof d==typeof _&&d<=_}],"filter->=":[on,[pr,Cn],function(n,s){var l=s[0],d=s[1],_=n.properties()[l.value],C=d.value;return typeof _==typeof C&&_>=C}],"filter-id->=":[on,[Cn],function(n,s){var l=s[0],d=n.id(),_=l.value;return typeof d==typeof _&&d>=_}],"filter-has":[on,[Cn],function(n,s){return s[0].value in n.properties()}],"filter-has-id":[on,[],function(n){return n.id()!==null&&n.id()!==void 0}],"filter-type-in":[on,[na(pr)],function(n,s){return s[0].value.indexOf(n.geometryType())>=0}],"filter-id-in":[on,[na(Cn)],function(n,s){return s[0].value.indexOf(n.id())>=0}],"filter-in-small":[on,[pr,na(Cn)],function(n,s){var l=s[0];return s[1].value.indexOf(n.properties()[l.value])>=0}],"filter-in-large":[on,[pr,na(Cn)],function(n,s){var l=s[0],d=s[1];return function(_,C,A,L){for(;A<=L;){var z=A+L>>1;if(C[z]===_)return!0;C[z]>_?L=z-1:A=z+1}return!1}(n.properties()[l.value],d.value,0,d.value.length-1)}],all:{type:on,overloads:[[[on,on],function(n,s){var l=s[1];return s[0].evaluate(n)&&l.evaluate(n)}],[Iu(on),function(n,s){for(var l=0,d=s;l<d.length;l+=1)if(!d[l].evaluate(n))return!1;return!0}]]},any:{type:on,overloads:[[[on,on],function(n,s){var l=s[1];return s[0].evaluate(n)||l.evaluate(n)}],[Iu(on),function(n,s){for(var l=0,d=s;l<d.length;l+=1)if(d[l].evaluate(n))return!0;return!1}]]},"!":[on,[on],function(n,s){return!s[0].evaluate(n)}],"is-supported-script":[on,[pr],function(n,s){var l=n.globals&&n.globals.isSupportedScript;return!l||l(s[0].evaluate(n))}],upcase:[pr,[pr],function(n,s){return s[0].evaluate(n).toUpperCase()}],downcase:[pr,[pr],function(n,s){return s[0].evaluate(n).toLowerCase()}],concat:[pr,Iu(Cn),function(n,s){return s.map(function(l){return ic(l.evaluate(n))}).join("")}],"resolved-locale":[pr,[xt],function(n,s){return s[0].evaluate(n).resolvedLocale()}]});var Yc=function(n,s){this.expression=n,this._warningHistory={},this._evaluator=new Oa,this._defaultValue=s?function(l){return l.type==="color"&&Pu(l.default)?new nt(0,0,0,0):l.type==="color"?nt.parse(l.default)||null:l.default===void 0?null:l.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null};function yf(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in xl}function Ac(n,s){var l=new Mu(xl,[],s?function(_){var C={color:cn,string:pr,number:Nt,enum:pr,boolean:on,formatted:St,resolvedImage:qi};return _.type==="array"?na(C[_.value]||Cn,_.length):C[_.type]}(s):void 0),d=l.parse(n,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?fh(new Yc(d,s)):ac(l.errors)}Yc.prototype.evaluateWithoutErrorHandling=function(n,s,l,d,_,C){return this._evaluator.globals=n,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=C,this.expression.evaluate(this._evaluator)},Yc.prototype.evaluate=function(n,s,l,d,_,C){this._evaluator.globals=n,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=C||null;try{var A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Ao("Expected value to be one of "+Object.keys(this._enumValues).map(function(L){return JSON.stringify(L)}).join(", ")+", but found "+JSON.stringify(A)+" instead.");return A}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(L.message)),this._defaultValue}};var qc=function(n,s){this.kind=n,this._styleExpression=s,this.isStateDependent=n!=="constant"&&!js(s.expression)};qc.prototype.evaluateWithoutErrorHandling=function(n,s,l,d,_,C){return this._styleExpression.evaluateWithoutErrorHandling(n,s,l,d,_,C)},qc.prototype.evaluate=function(n,s,l,d,_,C){return this._styleExpression.evaluate(n,s,l,d,_,C)};var Tc=function(n,s,l,d){this.kind=n,this.zoomStops=l,this._styleExpression=s,this.isStateDependent=n!=="camera"&&!js(s.expression),this.interpolationType=d};function _f(n,s){if((n=Ac(n,s)).result==="error")return n;var l=n.value.expression,d=Ls(l);if(!d&&!Rs(s))return ac([new Lr("","data expressions not supported")]);var _=_u(l,["zoom"]);if(!_&&!hh(s))return ac([new Lr("","zoom expressions not supported")]);var C=function A(L){var z=null;if(L instanceof Tt)z=A(L.result);else if(L instanceof ht)for(var W=0,q=L.args;W<q.length&&!(z=A(q[W]));W+=1);else(L instanceof Zo||L instanceof Te)&&L.input instanceof Ro&&L.input.name==="zoom"&&(z=L);return z instanceof Lr||L.eachChild(function(J){var se=A(J);se instanceof Lr?z=se:!z&&se?z=new Lr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):z&&se&&z!==se&&(z=new Lr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),z}(l);return C||_?C instanceof Lr?ac([C]):C instanceof Te&&!bl(s)?ac([new Lr("",'"interpolate" expressions cannot be used with this property')]):fh(C?new Tc(d?"camera":"composite",n.value,C.labels,C instanceof Te?C.interpolation:void 0):new qc(d?"constant":"source",n.value)):ac([new Lr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Tc.prototype.evaluateWithoutErrorHandling=function(n,s,l,d,_,C){return this._styleExpression.evaluateWithoutErrorHandling(n,s,l,d,_,C)},Tc.prototype.evaluate=function(n,s,l,d,_,C){return this._styleExpression.evaluate(n,s,l,d,_,C)},Tc.prototype.interpolationFactor=function(n,s,l){return this.interpolationType?Te.interpolationFactor(this.interpolationType,n,s,l):0};var oc=function(n,s){this._parameters=n,this._specification=s,Sr(this,function l(d,_){var C,A,L,z=_.type==="color",W=d.stops&&typeof d.stops[0][0]=="object",q=W||!(W||d.property!==void 0),J=d.type||(bl(_)?"exponential":"interval");if(z&&((d=Sr({},d)).stops&&(d.stops=d.stops.map(function(Zn){return[Zn[0],nt.parse(Zn[1])]})),d.default=nt.parse(d.default?d.default:_.default)),d.colorSpace&&d.colorSpace!=="rgb"&&!re[d.colorSpace])throw new Error("Unknown color space: "+d.colorSpace);if(J==="exponential")C=sd;else if(J==="interval")C=i0;else if(J==="categorical"){C=od,A=Object.create(null);for(var se=0,de=d.stops;se<de.length;se+=1){var Be=de[se];A[Be[0]]=Be[1]}L=typeof d.stops[0][0]}else{if(J!=="identity")throw new Error('Unknown function type "'+J+'"');C=ph}if(W){for(var Ve={},at=[],$e=0;$e<d.stops.length;$e++){var Et=d.stops[$e],Rt=Et[0].zoom;Ve[Rt]===void 0&&(Ve[Rt]={zoom:Rt,type:d.type,property:d.property,default:d.default,stops:[]},at.push(Rt)),Ve[Rt].stops.push([Et[0].value,Et[1]])}for(var Jt=[],$t=0,Cr=at;$t<Cr.length;$t+=1){var Yr=Cr[$t];Jt.push([Ve[Yr].zoom,l(Ve[Yr],_)])}var Sn={name:"linear"};return{kind:"composite",interpolationType:Sn,interpolationFactor:Te.interpolationFactor.bind(void 0,Sn),zoomStops:Jt.map(function(Zn){return Zn[0]}),evaluate:function(Zn,bi){var Nn=Zn.zoom;return sd({stops:Jt,base:d.base},_,Nn).evaluate(Nn,bi)}}}if(q){var yi=J==="exponential"?{name:"exponential",base:d.base!==void 0?d.base:1}:null;return{kind:"camera",interpolationType:yi,interpolationFactor:Te.interpolationFactor.bind(void 0,yi),zoomStops:d.stops.map(function(Zn){return Zn[0]}),evaluate:function(Zn){return C(d,_,Zn.zoom,A,L)}}}return{kind:"source",evaluate:function(Zn,bi){var Nn=bi&&bi.properties?bi.properties[d.property]:void 0;return Nn===void 0?El(d.default,_.default):C(d,_,Nn,A,L)}}}(this._parameters,this._specification))};function cu(n){var s=n.key,l=n.value,d=n.valueSpec||{},_=n.objectElementValidators||{},C=n.style,A=n.styleSpec,L=[],z=no(l);if(z!=="object")return[new je(s,l,"object expected, "+z+" found")];for(var W in l){var q=W.split(".")[0],J=d[q]||d["*"],se=void 0;if(_[q])se=_[q];else if(d[q])se=ya;else if(_["*"])se=_["*"];else{if(!d["*"]){L.push(new je(s,l[W],'unknown property "'+W+'"'));continue}se=ya}L=L.concat(se({key:(s&&s+".")+W,value:l[W],valueSpec:J,style:C,styleSpec:A,object:l,objectKey:W},l))}for(var de in d)_[de]||d[de].required&&d[de].default===void 0&&l[de]===void 0&&L.push(new je(s,l,'missing required property "'+de+'"'));return L}function sc(n){var s=n.value,l=n.valueSpec,d=n.style,_=n.styleSpec,C=n.key,A=n.arrayElementValidator||ya;if(no(s)!=="array")return[new je(C,s,"array expected, "+no(s)+" found")];if(l.length&&s.length!==l.length)return[new je(C,s,"array length "+l.length+" expected, length "+s.length+" found")];if(l["min-length"]&&s.length<l["min-length"])return[new je(C,s,"array length at least "+l["min-length"]+" expected, length "+s.length+" found")];var L={type:l.value,values:l.values};_.$version<7&&(L.function=l.function),no(l.value)==="object"&&(L=l.value);for(var z=[],W=0;W<s.length;W++)z=z.concat(A({array:s,arrayIndex:W,value:s[W],valueSpec:L,style:d,styleSpec:_,key:C+"["+W+"]"}));return z}function qf(n){var s=n.key,l=n.value,d=n.valueSpec,_=no(l);return _==="number"&&l!=l&&(_="NaN"),_!=="number"?[new je(s,l,"number expected, "+_+" found")]:"minimum"in d&&l<d.minimum?[new je(s,l,l+" is less than the minimum value "+d.minimum)]:"maximum"in d&&l>d.maximum?[new je(s,l,l+" is greater than the maximum value "+d.maximum)]:[]}function Gh(n){var s,l,d,_=n.valueSpec,C=zt(n.value.type),A={},L=C!=="categorical"&&n.value.property===void 0,z=!L,W=no(n.value.stops)==="array"&&no(n.value.stops[0])==="array"&&no(n.value.stops[0][0])==="object",q=cu({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(de){if(C==="identity")return[new je(de.key,de.value,'identity function may not have a "stops" property')];var Be=[],Ve=de.value;return Be=Be.concat(sc({key:de.key,value:Ve,valueSpec:de.valueSpec,style:de.style,styleSpec:de.styleSpec,arrayElementValidator:J})),no(Ve)==="array"&&Ve.length===0&&Be.push(new je(de.key,Ve,"array must have at least one stop")),Be},default:function(de){return ya({key:de.key,value:de.value,valueSpec:_,style:de.style,styleSpec:de.styleSpec})}}});return C==="identity"&&L&&q.push(new je(n.key,n.value,'missing required property "property"')),C==="identity"||n.value.stops||q.push(new je(n.key,n.value,'missing required property "stops"')),C==="exponential"&&n.valueSpec.expression&&!bl(n.valueSpec)&&q.push(new je(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(z&&!Rs(n.valueSpec)?q.push(new je(n.key,n.value,"property functions not supported")):L&&!hh(n.valueSpec)&&q.push(new je(n.key,n.value,"zoom functions not supported"))),C!=="categorical"&&!W||n.value.property!==void 0||q.push(new je(n.key,n.value,'"property" property is required')),q;function J(de){var Be=[],Ve=de.value,at=de.key;if(no(Ve)!=="array")return[new je(at,Ve,"array expected, "+no(Ve)+" found")];if(Ve.length!==2)return[new je(at,Ve,"array length 2 expected, length "+Ve.length+" found")];if(W){if(no(Ve[0])!=="object")return[new je(at,Ve,"object expected, "+no(Ve[0])+" found")];if(Ve[0].zoom===void 0)return[new je(at,Ve,"object stop key must have zoom")];if(Ve[0].value===void 0)return[new je(at,Ve,"object stop key must have value")];if(d&&d>zt(Ve[0].zoom))return[new je(at,Ve[0].zoom,"stop zoom values must appear in ascending order")];zt(Ve[0].zoom)!==d&&(d=zt(Ve[0].zoom),l=void 0,A={}),Be=Be.concat(cu({key:at+"[0]",value:Ve[0],valueSpec:{zoom:{}},style:de.style,styleSpec:de.styleSpec,objectElementValidators:{zoom:qf,value:se}}))}else Be=Be.concat(se({key:at+"[0]",value:Ve[0],valueSpec:{},style:de.style,styleSpec:de.styleSpec},Ve));return yf(Yt(Ve[1]))?Be.concat([new je(at+"[1]",Ve[1],"expressions are not allowed in function stops.")]):Be.concat(ya({key:at+"[1]",value:Ve[1],valueSpec:_,style:de.style,styleSpec:de.styleSpec}))}function se(de,Be){var Ve=no(de.value),at=zt(de.value),$e=de.value!==null?de.value:Be;if(s){if(Ve!==s)return[new je(de.key,$e,Ve+" stop domain type must match previous stop domain type "+s)]}else s=Ve;if(Ve!=="number"&&Ve!=="string"&&Ve!=="boolean")return[new je(de.key,$e,"stop domain value must be a number, string, or boolean")];if(Ve!=="number"&&C!=="categorical"){var Et="number expected, "+Ve+" found";return Rs(_)&&C===void 0&&(Et+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new je(de.key,$e,Et)]}return C!=="categorical"||Ve!=="number"||isFinite(at)&&Math.floor(at)===at?C!=="categorical"&&Ve==="number"&&l!==void 0&&at<l?[new je(de.key,$e,"stop domain values must appear in ascending order")]:(l=at,C==="categorical"&&at in A?[new je(de.key,$e,"stop domain values must be unique")]:(A[at]=!0,[])):[new je(de.key,$e,"integer expected, found "+at)]}}function Mc(n){var s=(n.expressionContext==="property"?_f:Ac)(Yt(n.value),n.valueSpec);if(s.result==="error")return s.value.map(function(d){return new je(""+n.key+d.key,n.value,d.message)});var l=s.value.expression||s.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!l.outputDefined())return[new je(n.key,n.value,'Invalid data expression for "'+n.propertyKey+'". Output values must be contained as literals within the expression.')];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!js(l))return[new je(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!js(l))return[new je(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!_u(l,["zoom","feature-state"]))return[new je(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Ls(l))return[new je(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Cl(n){var s=n.key,l=n.value,d=n.valueSpec,_=[];return Array.isArray(d.values)?d.values.indexOf(zt(l))===-1&&_.push(new je(s,l,"expected one of ["+d.values.join(", ")+"], "+JSON.stringify(l)+" found")):Object.keys(d.values).indexOf(zt(l))===-1&&_.push(new je(s,l,"expected one of ["+Object.keys(d.values).join(", ")+"], "+JSON.stringify(l)+" found")),_}function uc(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(var s=0,l=n.slice(1);s<l.length;s+=1){var d=l[s];if(!uc(d)&&typeof d!="boolean")return!1}return!0;default:return!0}}oc.deserialize=function(n){return new oc(n._parameters,n._specification)},oc.serialize=function(n){return{_parameters:n._parameters,_specification:n._specification}};var xf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function kc(n){if(n==null)return{filter:function(){return!0},needGeometry:!1};uc(n)||(n=bf(n));var s=Ac(n,xf);if(s.result==="error")throw new Error(s.value.map(function(l){return l.key+": "+l.message}).join(", "));return{filter:function(l,d,_){return s.value.evaluate(l,d,{},_)},needGeometry:function l(d){if(!Array.isArray(d))return!1;if(d[0]==="within")return!0;for(var _=1;_<d.length;_++)if(l(d[_]))return!0;return!1}(n)}}function Hh(n,s){return n<s?-1:n>s?1:0}function bf(n){if(!n)return!0;var s,l=n[0];return n.length<=1?l!=="any":l==="=="?Ic(n[1],n[2],"=="):l==="!="?Cf(Ic(n[1],n[2],"==")):l==="<"||l===">"||l==="<="||l===">="?Ic(n[1],n[2],l):l==="any"?(s=n.slice(1),["any"].concat(s.map(bf))):l==="all"?["all"].concat(n.slice(1).map(bf)):l==="none"?["all"].concat(n.slice(1).map(bf).map(Cf)):l==="in"?Ef(n[1],n.slice(2)):l==="!in"?Cf(Ef(n[1],n.slice(2))):l==="has"?Wh(n[1]):l==="!has"?Cf(Wh(n[1])):l!=="within"||n}function Ic(n,s,l){switch(n){case"$type":return["filter-type-"+l,s];case"$id":return["filter-id-"+l,s];default:return["filter-"+l,n,s]}}function Ef(n,s){if(s.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(function(l){return typeof l!=typeof s[0]})?["filter-in-large",n,["literal",s.sort(Hh)]]:["filter-in-small",n,["literal",s]]}}function Wh(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Cf(n){return["!",n]}function ud(n){return uc(Yt(n.value))?Mc(Sr({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function s(l){var d=l.value,_=l.key;if(no(d)!=="array")return[new je(_,d,"array expected, "+no(d)+" found")];var C,A=l.styleSpec,L=[];if(d.length<1)return[new je(_,d,"filter array must have at least 1 element")];switch(L=L.concat(Cl({key:_+"[0]",value:d[0],valueSpec:A.filter_operator,style:l.style,styleSpec:l.styleSpec})),zt(d[0])){case"<":case"<=":case">":case">=":d.length>=2&&zt(d[1])==="$type"&&L.push(new je(_,d,'"$type" cannot be use with operator "'+d[0]+'"'));case"==":case"!=":d.length!==3&&L.push(new je(_,d,'filter array for operator "'+d[0]+'" must have 3 elements'));case"in":case"!in":d.length>=2&&(C=no(d[1]))!=="string"&&L.push(new je(_+"[1]",d[1],"string expected, "+C+" found"));for(var z=2;z<d.length;z++)C=no(d[z]),zt(d[1])==="$type"?L=L.concat(Cl({key:_+"["+z+"]",value:d[z],valueSpec:A.geometry_type,style:l.style,styleSpec:l.styleSpec})):C!=="string"&&C!=="number"&&C!=="boolean"&&L.push(new je(_+"["+z+"]",d[z],"string, number, or boolean expected, "+C+" found"));break;case"any":case"all":case"none":for(var W=1;W<d.length;W++)L=L.concat(s({key:_+"["+W+"]",value:d[W],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":C=no(d[1]),d.length!==2?L.push(new je(_,d,'filter array for "'+d[0]+'" operator must have 2 elements')):C!=="string"&&L.push(new je(_+"[1]",d[1],"string expected, "+C+" found"));break;case"within":C=no(d[1]),d.length!==2?L.push(new je(_,d,'filter array for "'+d[0]+'" operator must have 2 elements')):C!=="object"&&L.push(new je(_+"[1]",d[1],"object expected, "+C+" found"))}return L}(n)}function wp(n,s){var l=n.key,d=n.style,_=n.styleSpec,C=n.value,A=n.objectKey,L=_[s+"_"+n.layerType];if(!L)return[];var z=A.match(/^(.*)-transition$/);if(s==="paint"&&z&&L[z[1]]&&L[z[1]].transition)return ya({key:l,value:C,valueSpec:_.transition,style:d,styleSpec:_});var W,q=n.valueSpec||L[A];if(!q)return[new je(l,C,'unknown property "'+A+'"')];if(no(C)==="string"&&Rs(q)&&!q.tokens&&(W=/^{([^}]+)}$/.exec(C)))return[new je(l,C,'"'+A+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(W[1])+" }`.")];var J=[];return n.layerType==="symbol"&&(A==="text-field"&&d&&!d.glyphs&&J.push(new je(l,C,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&Pu(Yt(C))&&zt(C.type)==="identity"&&J.push(new je(l,C,'"text-font" does not support identity functions'))),J.concat(ya({key:n.key,value:C,valueSpec:q,style:d,styleSpec:_,expressionContext:"property",propertyType:s,propertyKey:A}))}function dh(n){return wp(n,"paint")}function Ts(n){return wp(n,"layout")}function Ap(n){var s=[],l=n.value,d=n.key,_=n.style,C=n.styleSpec;l.type||l.ref||s.push(new je(d,l,'either "type" or "ref" is required'));var A,L=zt(l.type),z=zt(l.ref);if(l.id)for(var W=zt(l.id),q=0;q<n.arrayIndex;q++){var J=_.layers[q];zt(J.id)===W&&s.push(new je(d,l.id,'duplicate layer id "'+l.id+'", previously used at line '+J.id.__line__))}if("ref"in l)["type","source","source-layer","filter","layout"].forEach(function(Be){Be in l&&s.push(new je(d,l[Be],'"'+Be+'" is prohibited for ref layers'))}),_.layers.forEach(function(Be){zt(Be.id)===z&&(A=Be)}),A?A.ref?s.push(new je(d,l.ref,"ref cannot reference another ref layer")):L=zt(A.type):s.push(new je(d,l.ref,'ref layer "'+z+'" not found'));else if(L!=="background")if(l.source){var se=_.sources&&_.sources[l.source],de=se&&zt(se.type);se?de==="vector"&&L==="raster"?s.push(new je(d,l.source,'layer "'+l.id+'" requires a raster source')):de==="raster"&&L!=="raster"?s.push(new je(d,l.source,'layer "'+l.id+'" requires a vector source')):de!=="vector"||l["source-layer"]?de==="raster-dem"&&L!=="hillshade"?s.push(new je(d,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="line"||!l.paint||!l.paint["line-gradient"]||de==="geojson"&&se.lineMetrics||s.push(new je(d,l,'layer "'+l.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):s.push(new je(d,l,'layer "'+l.id+'" must specify a "source-layer"')):s.push(new je(d,l.source,'source "'+l.source+'" not found'))}else s.push(new je(d,l,'missing required property "source"'));return s=s.concat(cu({key:d,value:l,valueSpec:C.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ya({key:d+".type",value:l.type,valueSpec:C.layer.type,style:n.style,styleSpec:n.styleSpec,object:l,objectKey:"type"})},filter:ud,layout:function(Be){return cu({layer:l,key:Be.key,value:Be.value,style:Be.style,styleSpec:Be.styleSpec,objectElementValidators:{"*":function(Ve){return Ts(Sr({layerType:L},Ve))}}})},paint:function(Be){return cu({layer:l,key:Be.key,value:Be.value,style:Be.style,styleSpec:Be.styleSpec,objectElementValidators:{"*":function(Ve){return dh(Sr({layerType:L},Ve))}}})}}}))}function Ia(n){var s=n.value,l=n.key,d=no(s);return d!=="string"?[new je(l,s,"string expected, "+d+" found")]:[]}var bo={promoteId:function(n){var s=n.key,l=n.value;if(no(l)==="string")return Ia({key:s,value:l});var d=[];for(var _ in l)d.push.apply(d,Ia({key:s+"."+_,value:l[_]}));return d}};function $f(n){var s=n.value,l=n.key,d=n.styleSpec,_=n.style;if(!s.type)return[new je(l,s,'"type" is required')];var C,A=zt(s.type);switch(A){case"vector":case"raster":case"raster-dem":return cu({key:l,value:s,valueSpec:d["source_"+A.replace("-","_")],style:n.style,styleSpec:d,objectElementValidators:bo});case"geojson":if(C=cu({key:l,value:s,valueSpec:d.source_geojson,style:_,styleSpec:d,objectElementValidators:bo}),s.cluster)for(var L in s.clusterProperties){var z=s.clusterProperties[L],W=z[0],q=typeof W=="string"?[W,["accumulated"],["get",L]]:W;C.push.apply(C,Mc({key:l+"."+L+".map",value:z[1],expressionContext:"cluster-map"})),C.push.apply(C,Mc({key:l+"."+L+".reduce",value:q,expressionContext:"cluster-reduce"}))}return C;case"video":return cu({key:l,value:s,valueSpec:d.source_video,style:_,styleSpec:d});case"image":return cu({key:l,value:s,valueSpec:d.source_image,style:_,styleSpec:d});case"canvas":return[new je(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Cl({key:l+".type",value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,styleSpec:d})}}function $c(n){var s=n.value,l=n.styleSpec,d=l.light,_=n.style,C=[],A=no(s);if(s===void 0)return C;if(A!=="object")return C.concat([new je("light",s,"object expected, "+A+" found")]);for(var L in s){var z=L.match(/^(.*)-transition$/);C=C.concat(z&&d[z[1]]&&d[z[1]].transition?ya({key:L,value:s[L],valueSpec:l.transition,style:_,styleSpec:l}):d[L]?ya({key:L,value:s[L],valueSpec:d[L],style:_,styleSpec:l}):[new je(L,s[L],'unknown property "'+L+'"')])}return C}var tl={"*":function(){return[]},array:sc,boolean:function(n){var s=n.value,l=n.key,d=no(s);return d!=="boolean"?[new je(l,s,"boolean expected, "+d+" found")]:[]},number:qf,color:function(n){var s=n.key,l=n.value,d=no(l);return d!=="string"?[new je(s,l,"color expected, "+d+" found")]:lr(l)===null?[new je(s,l,'color expected, "'+l+'" found')]:[]},constants:Mt,enum:Cl,filter:ud,function:Gh,layer:Ap,object:cu,source:$f,light:$c,string:Ia,formatted:function(n){return Ia(n).length===0?[]:Mc(n)},resolvedImage:function(n){return Ia(n).length===0?[]:Mc(n)}};function ya(n){var s=n.value,l=n.valueSpec,d=n.styleSpec;return l.expression&&Pu(zt(s))?Gh(n):l.expression&&yf(Yt(s))?Mc(n):l.type&&tl[l.type]?tl[l.type](n):cu(Sr({},n,{valueSpec:l.type?d[l.type]:l}))}function ho(n){var s=n.value,l=n.key,d=Ia(n);return d.length||(s.indexOf("{fontstack}")===-1&&d.push(new je(l,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&d.push(new je(l,s,'"glyphs" url must include a "{range}" token'))),d}function ka(n,s){s===void 0&&(s=_e);var l=[];return l=l.concat(ya({key:"",value:n,valueSpec:s.$root,styleSpec:s,style:n,objectElementValidators:{glyphs:ho,"*":function(){return[]}}})),n.constants&&(l=l.concat(Mt({key:"constants",value:n.constants,style:n,styleSpec:s}))),jl(l)}function jl(n){return[].concat(n).sort(function(s,l){return s.line-l.line})}function bu(n){return function(){for(var s=[],l=arguments.length;l--;)s[l]=arguments[l];return jl(n.apply(this,s))}}ka.source=bu($f),ka.light=bu($c),ka.layer=bu(Ap),ka.filter=bu(ud),ka.paintProperty=bu(dh),ka.layoutProperty=bu(Ts);var Pc=ka,rl=Pc.light,Tp=Pc.paintProperty,Sf=Pc.layoutProperty;function Kf(n,s){var l=!1;if(s&&s.length)for(var d=0,_=s;d<_.length;d+=1)n.fire(new Ye(new Error(_[d].message))),l=!0;return l}var lc=us;function us(n,s,l){var d=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var _=new Int32Array(this.arrayBuffer);n=_[0],this.d=(s=_[1])+2*(l=_[2]);for(var C=0;C<this.d*this.d;C++){var A=_[3+C],L=_[3+C+1];d.push(A===L?null:_.subarray(A,L))}var z=_[3+d.length+1];this.keys=_.subarray(_[3+d.length],z),this.bboxes=_.subarray(z),this.insert=this._insertReadonly}else{this.d=s+2*l;for(var W=0;W<this.d*this.d;W++)d.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=n,this.padding=l,this.scale=s/n,this.uid=0;var q=l/s*n;this.min=-q,this.max=n+q}us.prototype.insert=function(n,s,l,d,_){this._forEachCell(s,l,d,_,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(_)},us.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},us.prototype._insertCell=function(n,s,l,d,_,C){this.cells[_].push(C)},us.prototype.query=function(n,s,l,d,_){var C=this.min,A=this.max;if(n<=C&&s<=C&&A<=l&&A<=d&&!_)return Array.prototype.slice.call(this.keys);var L=[];return this._forEachCell(n,s,l,d,this._queryCell,L,{},_),L},us.prototype._queryCell=function(n,s,l,d,_,C,A,L){var z=this.cells[_];if(z!==null)for(var W=this.keys,q=this.bboxes,J=0;J<z.length;J++){var se=z[J];if(A[se]===void 0){var de=4*se;(L?L(q[de+0],q[de+1],q[de+2],q[de+3]):n<=q[de+2]&&s<=q[de+3]&&l>=q[de+0]&&d>=q[de+1])?(A[se]=!0,C.push(W[se])):A[se]=!1}}},us.prototype._forEachCell=function(n,s,l,d,_,C,A,L){for(var z=this._convertToCellCoord(n),W=this._convertToCellCoord(s),q=this._convertToCellCoord(l),J=this._convertToCellCoord(d),se=z;se<=q;se++)for(var de=W;de<=J;de++){var Be=this.d*de+se;if((!L||L(this._convertFromCellCoord(se),this._convertFromCellCoord(de),this._convertFromCellCoord(se+1),this._convertFromCellCoord(de+1)))&&_.call(this,n,s,l,d,Be,C,A,L))return}},us.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},us.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},us.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,s=3+this.cells.length+1+1,l=0,d=0;d<this.cells.length;d++)l+=this.cells[d].length;var _=new Int32Array(s+l+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var C=s,A=0;A<n.length;A++){var L=n[A];_[3+A]=C,_.set(L,C),C+=L.length}return _[3+n.length]=C,_.set(this.keys,C),_[3+n.length+1]=C+=this.keys.length,_.set(this.bboxes,C),C+=this.bboxes.length,_.buffer};var Sl=Xe.ImageData,vh=Xe.ImageBitmap,Vo={};function tn(n,s,l){l===void 0&&(l={}),Object.defineProperty(s,"_classRegistryKey",{value:n,writeable:!1}),Vo[n]={klass:s,omit:l.omit||[],shallow:l.shallow||[]}}for(var Xo in tn("Object",Object),lc.serialize=function(n,s){var l=n.toArrayBuffer();return s&&s.push(l),{buffer:l}},lc.deserialize=function(n){return new lc(n.buffer)},tn("Grid",lc),tn("Color",nt),tn("Error",Error),tn("ResolvedImage",qa),tn("StylePropertyFunction",oc),tn("StyleExpression",Yc,{omit:["_evaluator"]}),tn("ZoomDependentExpression",Tc),tn("ZoomConstantExpression",qc),tn("CompoundExpression",Ro,{omit:["_evaluate"]}),xl)xl[Xo]._classRegistryKey||tn("Expression_"+Xo,xl[Xo]);function Lc(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Kc(n){return vh&&n instanceof vh}function Wu(n,s){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Lc(n)||Kc(n))return s&&s.push(n),n;if(ArrayBuffer.isView(n)){var l=n;return s&&s.push(l.buffer),l}if(n instanceof Sl)return s&&s.push(n.data.buffer),n;if(Array.isArray(n)){for(var d=[],_=0,C=n;_<C.length;_+=1)d.push(Wu(C[_],s));return d}if(typeof n=="object"){var A=n.constructor,L=A._classRegistryKey;if(!L)throw new Error("can't serialize object of unregistered class");var z=A.serialize?A.serialize(n,s):{};if(!A.serialize){for(var W in n)if(n.hasOwnProperty(W)&&!(Vo[L].omit.indexOf(W)>=0)){var q=n[W];z[W]=Vo[L].shallow.indexOf(W)>=0?q:Wu(q,s)}n instanceof Error&&(z.message=n.message)}if(z.$name)throw new Error("$name property is reserved for worker serialization logic.");return L!=="Object"&&(z.$name=L),z}throw new Error("can't serialize object of type "+typeof n)}function Lu(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Lc(n)||Kc(n)||ArrayBuffer.isView(n)||n instanceof Sl)return n;if(Array.isArray(n))return n.map(Lu);if(typeof n=="object"){var s=n.$name||"Object",l=Vo[s].klass;if(!l)throw new Error("can't deserialize unregistered class "+s);if(l.deserialize)return l.deserialize(n);for(var d=Object.create(l.prototype),_=0,C=Object.keys(n);_<C.length;_+=1){var A=C[_];if(A!=="$name"){var L=n[A];d[A]=Vo[s].shallow.indexOf(A)>=0?L:Lu(L)}}return d}throw new Error("can't deserialize object of type "+typeof n)}var Gl=function(){this.first=!0};Gl.prototype.update=function(n,s){var l=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=l,!0))};var mn={"Latin-1 Supplement":function(n){return n>=128&&n<=255},Arabic:function(n){return n>=1536&&n<=1791},"Arabic Supplement":function(n){return n>=1872&&n<=1919},"Arabic Extended-A":function(n){return n>=2208&&n<=2303},"Hangul Jamo":function(n){return n>=4352&&n<=4607},"Unified Canadian Aboriginal Syllabics":function(n){return n>=5120&&n<=5759},Khmer:function(n){return n>=6016&&n<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(n){return n>=6320&&n<=6399},"General Punctuation":function(n){return n>=8192&&n<=8303},"Letterlike Symbols":function(n){return n>=8448&&n<=8527},"Number Forms":function(n){return n>=8528&&n<=8591},"Miscellaneous Technical":function(n){return n>=8960&&n<=9215},"Control Pictures":function(n){return n>=9216&&n<=9279},"Optical Character Recognition":function(n){return n>=9280&&n<=9311},"Enclosed Alphanumerics":function(n){return n>=9312&&n<=9471},"Geometric Shapes":function(n){return n>=9632&&n<=9727},"Miscellaneous Symbols":function(n){return n>=9728&&n<=9983},"Miscellaneous Symbols and Arrows":function(n){return n>=11008&&n<=11263},"CJK Radicals Supplement":function(n){return n>=11904&&n<=12031},"Kangxi Radicals":function(n){return n>=12032&&n<=12255},"Ideographic Description Characters":function(n){return n>=12272&&n<=12287},"CJK Symbols and Punctuation":function(n){return n>=12288&&n<=12351},Hiragana:function(n){return n>=12352&&n<=12447},Katakana:function(n){return n>=12448&&n<=12543},Bopomofo:function(n){return n>=12544&&n<=12591},"Hangul Compatibility Jamo":function(n){return n>=12592&&n<=12687},Kanbun:function(n){return n>=12688&&n<=12703},"Bopomofo Extended":function(n){return n>=12704&&n<=12735},"CJK Strokes":function(n){return n>=12736&&n<=12783},"Katakana Phonetic Extensions":function(n){return n>=12784&&n<=12799},"Enclosed CJK Letters and Months":function(n){return n>=12800&&n<=13055},"CJK Compatibility":function(n){return n>=13056&&n<=13311},"CJK Unified Ideographs Extension A":function(n){return n>=13312&&n<=19903},"Yijing Hexagram Symbols":function(n){return n>=19904&&n<=19967},"CJK Unified Ideographs":function(n){return n>=19968&&n<=40959},"Yi Syllables":function(n){return n>=40960&&n<=42127},"Yi Radicals":function(n){return n>=42128&&n<=42191},"Hangul Jamo Extended-A":function(n){return n>=43360&&n<=43391},"Hangul Syllables":function(n){return n>=44032&&n<=55215},"Hangul Jamo Extended-B":function(n){return n>=55216&&n<=55295},"Private Use Area":function(n){return n>=57344&&n<=63743},"CJK Compatibility Ideographs":function(n){return n>=63744&&n<=64255},"Arabic Presentation Forms-A":function(n){return n>=64336&&n<=65023},"Vertical Forms":function(n){return n>=65040&&n<=65055},"CJK Compatibility Forms":function(n){return n>=65072&&n<=65103},"Small Form Variants":function(n){return n>=65104&&n<=65135},"Arabic Presentation Forms-B":function(n){return n>=65136&&n<=65279},"Halfwidth and Fullwidth Forms":function(n){return n>=65280&&n<=65519}};function wf(n){for(var s=0,l=n;s<l.length;s+=1)if(Sa(l[s].charCodeAt(0)))return!0;return!1}function Sa(n){return!(n!==746&&n!==747&&(n<4352||!(mn["Bopomofo Extended"](n)||mn.Bopomofo(n)||mn["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||mn["CJK Compatibility Ideographs"](n)||mn["CJK Compatibility"](n)||mn["CJK Radicals Supplement"](n)||mn["CJK Strokes"](n)||!(!mn["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||mn["CJK Unified Ideographs Extension A"](n)||mn["CJK Unified Ideographs"](n)||mn["Enclosed CJK Letters and Months"](n)||mn["Hangul Compatibility Jamo"](n)||mn["Hangul Jamo Extended-A"](n)||mn["Hangul Jamo Extended-B"](n)||mn["Hangul Jamo"](n)||mn["Hangul Syllables"](n)||mn.Hiragana(n)||mn["Ideographic Description Characters"](n)||mn.Kanbun(n)||mn["Kangxi Radicals"](n)||mn["Katakana Phonetic Extensions"](n)||mn.Katakana(n)&&n!==12540||!(!mn["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!mn["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||mn["Unified Canadian Aboriginal Syllabics"](n)||mn["Unified Canadian Aboriginal Syllabics Extended"](n)||mn["Vertical Forms"](n)||mn["Yijing Hexagram Symbols"](n)||mn["Yi Syllables"](n)||mn["Yi Radicals"](n))))}function Hl(n){return!(Sa(n)||function(s){return!!(mn["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||mn["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||mn["Letterlike Symbols"](s)||mn["Number Forms"](s)||mn["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||mn["Control Pictures"](s)&&s!==9251||mn["Optical Character Recognition"](s)||mn["Enclosed Alphanumerics"](s)||mn["Geometric Shapes"](s)||mn["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||mn["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||mn["CJK Symbols and Punctuation"](s)||mn.Katakana(s)||mn["Private Use Area"](s)||mn["CJK Compatibility Forms"](s)||mn["Small Form Variants"](s)||mn["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(n))}function po(n){return n>=1424&&n<=2303||mn["Arabic Presentation Forms-A"](n)||mn["Arabic Presentation Forms-B"](n)}function fu(n,s){return!(!s&&po(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||mn.Khmer(n))}function Qc(n){for(var s=0,l=n;s<l.length;s+=1)if(po(l[s].charCodeAt(0)))return!0;return!1}var wl=null,Eu="unavailable",zn=null,Mp=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(Eu="error"),wl&&wl(n)};function Qf(){ld.fire(new Ne("pluginStateChange",{pluginStatus:Eu,pluginURL:zn}))}var ld=new lt,Xh=function(){return Eu},nl=function(){if(Eu!=="deferred"||!zn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Eu="loading",Qf(),zn&&hi({url:zn},function(n){n?Mp(n):(Eu="loaded",Qf())})},Os={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Eu==="loaded"||Os.applyArabicShaping!=null},isLoading:function(){return Eu==="loading"},setState:function(n){Eu=n.pluginStatus,zn=n.pluginURL},isParsed:function(){return Os.applyArabicShaping!=null&&Os.processBidirectionalText!=null&&Os.processStyledBidirectionalText!=null},getPluginURL:function(){return zn}},aa=function(n,s){this.zoom=n,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Gl,this.transition={})};aa.prototype.isSupportedScript=function(n){return function(s,l){for(var d=0,_=s;d<_.length;d+=1)if(!fu(_[d].charCodeAt(0),l))return!1;return!0}(n,Os.isLoaded())},aa.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},aa.prototype.getCrossfadeParameters=function(){var n=this.zoom,s=n-Math.floor(n),l=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}};var il=function(n,s){this.property=n,this.value=s,this.expression=function(l,d){if(Pu(l))return new oc(l,d);if(yf(l)){var _=_f(l,d);if(_.result==="error")throw new Error(_.value.map(function(A){return A.key+": "+A.message}).join(", "));return _.value}var C=l;return typeof l=="string"&&d.type==="color"&&(C=nt.parse(l)),{kind:"constant",evaluate:function(){return C}}}(s===void 0?n.specification.default:s,n.specification)};il.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},il.prototype.possiblyEvaluate=function(n,s,l){return this.property.possiblyEvaluate(this,n,s,l)};var Gs=function(n){this.property=n,this.value=new il(n,void 0)};Gs.prototype.transitioned=function(n,s){return new cc(this.property,this.value,s,Ir({},n.transition,this.transition),n.now)},Gs.prototype.untransitioned=function(){return new cc(this.property,this.value,null,{},0)};var Qs=function(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)};Qs.prototype.getValue=function(n){return ir(this._values[n].value.value)},Qs.prototype.setValue=function(n,s){this._values.hasOwnProperty(n)||(this._values[n]=new Gs(this._values[n].property)),this._values[n].value=new il(this._values[n].property,s===null?void 0:ir(s))},Qs.prototype.getTransition=function(n){return ir(this._values[n].transition)},Qs.prototype.setTransition=function(n,s){this._values.hasOwnProperty(n)||(this._values[n]=new Gs(this._values[n].property)),this._values[n].transition=ir(s)||void 0},Qs.prototype.serialize=function(){for(var n={},s=0,l=Object.keys(this._values);s<l.length;s+=1){var d=l[s],_=this.getValue(d);_!==void 0&&(n[d]=_);var C=this.getTransition(d);C!==void 0&&(n[d+"-transition"]=C)}return n},Qs.prototype.transitioned=function(n,s){for(var l=new Jc(this._properties),d=0,_=Object.keys(this._values);d<_.length;d+=1){var C=_[d];l._values[C]=this._values[C].transitioned(n,s._values[C])}return l},Qs.prototype.untransitioned=function(){for(var n=new Jc(this._properties),s=0,l=Object.keys(this._values);s<l.length;s+=1){var d=l[s];n._values[d]=this._values[d].untransitioned()}return n};var cc=function(n,s,l,d,_){this.property=n,this.value=s,this.begin=_+d.delay||0,this.end=this.begin+d.duration||0,n.specification.transition&&(d.delay||d.duration)&&(this.prior=l)};cc.prototype.possiblyEvaluate=function(n,s,l){var d=n.now||0,_=this.value.possiblyEvaluate(n,s,l),C=this.prior;if(C){if(d>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(d<this.begin)return C.possiblyEvaluate(n,s,l);var A=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(C.possiblyEvaluate(n,s,l),_,function(L){if(L<=0)return 0;if(L>=1)return 1;var z=L*L,W=z*L;return 4*(L<.5?W:3*(L-z)+W-.75)}(A))}return _};var Jc=function(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)};Jc.prototype.possiblyEvaluate=function(n,s,l){for(var d=new Al(this._properties),_=0,C=Object.keys(this._values);_<C.length;_+=1){var A=C[_];d._values[A]=this._values[A].possiblyEvaluate(n,s,l)}return d},Jc.prototype.hasTransition=function(){for(var n=0,s=Object.keys(this._values);n<s.length;n+=1)if(this._values[s[n]].prior)return!0;return!1};var al=function(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)};al.prototype.getValue=function(n){return ir(this._values[n].value)},al.prototype.setValue=function(n,s){this._values[n]=new il(this._values[n].property,s===null?void 0:ir(s))},al.prototype.serialize=function(){for(var n={},s=0,l=Object.keys(this._values);s<l.length;s+=1){var d=l[s],_=this.getValue(d);_!==void 0&&(n[d]=_)}return n},al.prototype.possiblyEvaluate=function(n,s,l){for(var d=new Al(this._properties),_=0,C=Object.keys(this._values);_<C.length;_+=1){var A=C[_];d._values[A]=this._values[A].possiblyEvaluate(n,s,l)}return d};var Hs=function(n,s,l){this.property=n,this.value=s,this.parameters=l};Hs.prototype.isConstant=function(){return this.value.kind==="constant"},Hs.prototype.constantOr=function(n){return this.value.kind==="constant"?this.value.value:n},Hs.prototype.evaluate=function(n,s,l,d){return this.property.evaluate(this.value,this.parameters,n,s,l,d)};var Al=function(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)};Al.prototype.get=function(n){return this._values[n]};var ci=function(n){this.specification=n};ci.prototype.possiblyEvaluate=function(n,s){return n.expression.evaluate(s)},ci.prototype.interpolate=function(n,s,l){var d=As[this.specification.type];return d?d(n,s,l):n};var ti=function(n,s){this.specification=n,this.overrides=s};ti.prototype.possiblyEvaluate=function(n,s,l,d){return new Hs(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(s,null,{},l,d)}:n.expression,s)},ti.prototype.interpolate=function(n,s,l){if(n.value.kind!=="constant"||s.value.kind!=="constant")return n;if(n.value.value===void 0||s.value.value===void 0)return new Hs(this,{kind:"constant",value:void 0},n.parameters);var d=As[this.specification.type];return d?new Hs(this,{kind:"constant",value:d(n.value.value,s.value.value,l)},n.parameters):n},ti.prototype.evaluate=function(n,s,l,d,_,C){return n.kind==="constant"?n.value:n.evaluate(s,l,d,_,C)};var mh=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(l,d,_,C){if(l.value===void 0)return new Hs(this,{kind:"constant",value:void 0},d);if(l.expression.kind==="constant"){var A=l.expression.evaluate(d,null,{},_,C),L=l.property.specification.type==="resolvedImage"&&typeof A!="string"?A.name:A,z=this._calculate(L,L,L,d);return new Hs(this,{kind:"constant",value:z},d)}if(l.expression.kind==="camera"){var W=this._calculate(l.expression.evaluate({zoom:d.zoom-1}),l.expression.evaluate({zoom:d.zoom}),l.expression.evaluate({zoom:d.zoom+1}),d);return new Hs(this,{kind:"constant",value:W},d)}return new Hs(this,l.expression,d)},s.prototype.evaluate=function(l,d,_,C,A,L){if(l.kind==="source"){var z=l.evaluate(d,_,C,A,L);return this._calculate(z,z,z,d)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(d.zoom)-1},_,C),l.evaluate({zoom:Math.floor(d.zoom)},_,C),l.evaluate({zoom:Math.floor(d.zoom)+1},_,C),d):l.value},s.prototype._calculate=function(l,d,_,C){return C.zoom>C.zoomHistory.lastIntegerZoom?{from:l,to:d}:{from:_,to:d}},s.prototype.interpolate=function(l){return l},s}(ti),Fs=function(n){this.specification=n};Fs.prototype.possiblyEvaluate=function(n,s,l,d){if(n.value!==void 0){if(n.expression.kind==="constant"){var _=n.expression.evaluate(s,null,{},l,d);return this._calculate(_,_,_,s)}return this._calculate(n.expression.evaluate(new aa(Math.floor(s.zoom-1),s)),n.expression.evaluate(new aa(Math.floor(s.zoom),s)),n.expression.evaluate(new aa(Math.floor(s.zoom+1),s)),s)}},Fs.prototype._calculate=function(n,s,l,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:n,to:s}:{from:l,to:s}},Fs.prototype.interpolate=function(n){return n};var Ru=function(n){this.specification=n};Ru.prototype.possiblyEvaluate=function(n,s,l,d){return!!n.expression.evaluate(s,null,{},l,d)},Ru.prototype.interpolate=function(){return!1};var Yo=function(n){for(var s in this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],n){var l=n[s];l.specification.overridable&&this.overridableProperties.push(s);var d=this.defaultPropertyValues[s]=new il(l,void 0),_=this.defaultTransitionablePropertyValues[s]=new Gs(l);this.defaultTransitioningPropertyValues[s]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=d.possiblyEvaluate({})}};tn("DataDrivenProperty",ti),tn("DataConstantProperty",ci),tn("CrossFadedDataDrivenProperty",mh),tn("CrossFadedProperty",Fs),tn("ColorRampProperty",Ru);var Tl=function(n){function s(l,d){if(n.call(this),this.id=l.id,this.type=l.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},l.type!=="custom"&&(this.metadata=(l=l).metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),d.layout&&(this._unevaluatedLayout=new al(d.layout)),d.paint)){for(var _ in this._transitionablePaint=new Qs(d.paint),l.paint)this.setPaintProperty(_,l.paint[_],{validate:!1});for(var C in l.layout)this.setLayoutProperty(C,l.layout[C],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Al(d.paint)}}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},s.prototype.getLayoutProperty=function(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)},s.prototype.setLayoutProperty=function(l,d,_){_===void 0&&(_={}),d!=null&&this._validate(Sf,"layers."+this.id+".layout."+l,l,d,_)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,d):this.visibility=d)},s.prototype.getPaintProperty=function(l){return me(l,"-transition")?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)},s.prototype.setPaintProperty=function(l,d,_){if(_===void 0&&(_={}),d!=null&&this._validate(Tp,"layers."+this.id+".paint."+l,l,d,_))return!1;if(me(l,"-transition"))return this._transitionablePaint.setTransition(l.slice(0,-11),d||void 0),!1;var C=this._transitionablePaint._values[l],A=C.property.specification["property-type"]==="cross-faded-data-driven",L=C.value.isDataDriven(),z=C.value;this._transitionablePaint.setValue(l,d),this._handleSpecialPaintPropertyUpdate(l);var W=this._transitionablePaint._values[l].value;return W.isDataDriven()||L||A||this._handleOverridablePaintPropertyUpdate(l,z,W)},s.prototype._handleSpecialPaintPropertyUpdate=function(l){},s.prototype._handleOverridablePaintPropertyUpdate=function(l,d,_){return!1},s.prototype.isHidden=function(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"},s.prototype.updateTransitions=function(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)},s.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},s.prototype.recalculate=function(l,d){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,d)},s.prototype.serialize=function(){var l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),Rr(l,function(d,_){return!(d===void 0||_==="layout"&&!Object.keys(d).length||_==="paint"&&!Object.keys(d).length)})},s.prototype._validate=function(l,d,_,C,A){return A===void 0&&(A={}),(!A||A.validate!==!1)&&Kf(this,l.call(Pc,{key:d,layerType:this.type,objectKey:_,value:C,styleSpec:_e,style:{glyphs:!0,sprite:!0}}))},s.prototype.is3D=function(){return!1},s.prototype.isTileClipped=function(){return!1},s.prototype.hasOffscreenPass=function(){return!1},s.prototype.resize=function(){},s.prototype.isStateDependent=function(){for(var l in this.paint._values){var d=this.paint.get(l);if(d instanceof Hs&&Rs(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1},s}(lt),Jf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Yh=function(n,s){this._structArray=n,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Na=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function io(n,s){s===void 0&&(s=1);var l=0,d=0;return{members:n.map(function(_){var C=Jf[_.type].BYTES_PER_ELEMENT,A=l=kp(l,Math.max(s,C)),L=_.components||1;return d=Math.max(d,C),l+=C*L,{name:_.name,type:_.type,components:L,offset:A}}),size:kp(l,Math.max(d,s)),alignment:s}}function kp(n,s){return Math.ceil(n/s)*s}Na.serialize=function(n,s){return n._trim(),s&&(n.isTransferred=!0,s.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}},Na.deserialize=function(n){var s=Object.create(this.prototype);return s.arrayBuffer=n.arrayBuffer,s.length=n.length,s.capacity=n.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s},Na.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Na.prototype.clear=function(){this.length=0},Na.prototype.resize=function(n){this.reserve(n),this.length=n},Na.prototype.reserve=function(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}},Na.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Af=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d){var _=this.length;return this.resize(_+1),this.emplace(_,l,d)},s.prototype.emplace=function(l,d,_){var C=2*l;return this.int16[C+0]=d,this.int16[C+1]=_,l},s}(Na);Af.prototype.bytesPerElement=4,tn("StructArrayLayout2i4",Af);var Ml=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,_,C){var A=this.length;return this.resize(A+1),this.emplace(A,l,d,_,C)},s.prototype.emplace=function(l,d,_,C,A){var L=4*l;return this.int16[L+0]=d,this.int16[L+1]=_,this.int16[L+2]=C,this.int16[L+3]=A,l},s}(Na);Ml.prototype.bytesPerElement=8,tn("StructArrayLayout4i8",Ml);var kl=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,_,C,A,L){var z=this.length;return this.resize(z+1),this.emplace(z,l,d,_,C,A,L)},s.prototype.emplace=function(l,d,_,C,A,L,z){var W=6*l;return this.int16[W+0]=d,this.int16[W+1]=_,this.int16[W+2]=C,this.int16[W+3]=A,this.int16[W+4]=L,this.int16[W+5]=z,l},s}(Na);kl.prototype.bytesPerElement=12,tn("StructArrayLayout2i4i12",kl);var za=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,_,C,A,L){var z=this.length;return this.resize(z+1),this.emplace(z,l,d,_,C,A,L)},s.prototype.emplace=function(l,d,_,C,A,L,z){var W=4*l,q=8*l;return this.int16[W+0]=d,this.int16[W+1]=_,this.uint8[q+4]=C,this.uint8[q+5]=A,this.uint8[q+6]=L,this.uint8[q+7]=z,l},s}(Na);za.prototype.bytesPerElement=8,tn("StructArrayLayout2i4ub8",za);var Il=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d){var _=this.length;return this.resize(_+1),this.emplace(_,l,d)},s.prototype.emplace=function(l,d,_){var C=2*l;return this.float32[C+0]=d,this.float32[C+1]=_,l},s}(Na);Il.prototype.bytesPerElement=8,tn("StructArrayLayout2f8",Il);var fc=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,_,C,A,L,z,W,q,J){var se=this.length;return this.resize(se+1),this.emplace(se,l,d,_,C,A,L,z,W,q,J)},s.prototype.emplace=function(l,d,_,C,A,L,z,W,q,J,se){var de=10*l;return this.uint16[de+0]=d,this.uint16[de+1]=_,this.uint16[de+2]=C,this.uint16[de+3]=A,this.uint16[de+4]=L,this.uint16[de+5]=z,this.uint16[de+6]=W,this.uint16[de+7]=q,this.uint16[de+8]=J,this.uint16[de+9]=se,l},s}(Na);fc.prototype.bytesPerElement=20,tn("StructArrayLayout10ui20",fc);var qh=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,_,C,A,L,z,W,q,J,se,de){var Be=this.length;return this.resize(Be+1),this.emplace(Be,l,d,_,C,A,L,z,W,q,J,se,de)},s.prototype.emplace=function(l,d,_,C,A,L,z,W,q,J,se,de,Be){var Ve=12*l;return this.int16[Ve+0]=d,this.int16[Ve+1]=_,this.int16[Ve+2]=C,this.int16[Ve+3]=A,this.uint16[Ve+4]=L,this.uint16[Ve+5]=z,this.uint16[Ve+6]=W,this.uint16[Ve+7]=q,this.int16[Ve+8]=J,this.int16[Ve+9]=se,this.int16[Ve+10]=de,this.int16[Ve+11]=Be,l},s}(Na);qh.prototype.bytesPerElement=24,tn("StructArrayLayout4i4ui4i24",qh);var Rc=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,_){var C=this.length;return this.resize(C+1),this.emplace(C,l,d,_)},s.prototype.emplace=function(l,d,_,C){var A=3*l;return this.float32[A+0]=d,this.float32[A+1]=_,this.float32[A+2]=C,l},s}(Na);Rc.prototype.bytesPerElement=12,tn("StructArrayLayout3f12",Rc);var gh=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var d=this.length;return this.resize(d+1),this.emplace(d,l)},s.prototype.emplace=function(l,d){return this.uint32[1*l+0]=d,l},s}(Na);gh.prototype.bytesPerElement=4,tn("StructArrayLayout1ul4",gh);var hc=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,_,C,A,L,z,W,q){var J=this.length;return this.resize(J+1),this.emplace(J,l,d,_,C,A,L,z,W,q)},s.prototype.emplace=function(l,d,_,C,A,L,z,W,q,J){var se=10*l,de=5*l;return this.int16[se+0]=d,this.int16[se+1]=_,this.int16[se+2]=C,this.int16[se+3]=A,this.int16[se+4]=L,this.int16[se+5]=z,this.uint32[de+3]=W,this.uint16[se+8]=q,this.uint16[se+9]=J,l},s}(Na);hc.prototype.bytesPerElement=20,tn("StructArrayLayout6i1ul2ui20",hc);var pc=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,_,C,A,L){var z=this.length;return this.resize(z+1),this.emplace(z,l,d,_,C,A,L)},s.prototype.emplace=function(l,d,_,C,A,L,z){var W=6*l;return this.int16[W+0]=d,this.int16[W+1]=_,this.int16[W+2]=C,this.int16[W+3]=A,this.int16[W+4]=L,this.int16[W+5]=z,l},s}(Na);pc.prototype.bytesPerElement=12,tn("StructArrayLayout2i2i2i12",pc);var Wl=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,_,C,A){var L=this.length;return this.resize(L+1),this.emplace(L,l,d,_,C,A)},s.prototype.emplace=function(l,d,_,C,A,L){var z=4*l,W=8*l;return this.float32[z+0]=d,this.float32[z+1]=_,this.float32[z+2]=C,this.int16[W+6]=A,this.int16[W+7]=L,l},s}(Na);Wl.prototype.bytesPerElement=16,tn("StructArrayLayout2f1f2i16",Wl);var eh=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,_,C){var A=this.length;return this.resize(A+1),this.emplace(A,l,d,_,C)},s.prototype.emplace=function(l,d,_,C,A){var L=12*l,z=3*l;return this.uint8[L+0]=d,this.uint8[L+1]=_,this.float32[z+1]=C,this.float32[z+2]=A,l},s}(Na);eh.prototype.bytesPerElement=12,tn("StructArrayLayout2ub2f12",eh);var dc=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,_){var C=this.length;return this.resize(C+1),this.emplace(C,l,d,_)},s.prototype.emplace=function(l,d,_,C){var A=3*l;return this.uint16[A+0]=d,this.uint16[A+1]=_,this.uint16[A+2]=C,l},s}(Na);dc.prototype.bytesPerElement=6,tn("StructArrayLayout3ui6",dc);var vc=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,_,C,A,L,z,W,q,J,se,de,Be,Ve,at,$e,Et){var Rt=this.length;return this.resize(Rt+1),this.emplace(Rt,l,d,_,C,A,L,z,W,q,J,se,de,Be,Ve,at,$e,Et)},s.prototype.emplace=function(l,d,_,C,A,L,z,W,q,J,se,de,Be,Ve,at,$e,Et,Rt){var Jt=24*l,$t=12*l,Cr=48*l;return this.int16[Jt+0]=d,this.int16[Jt+1]=_,this.uint16[Jt+2]=C,this.uint16[Jt+3]=A,this.uint32[$t+2]=L,this.uint32[$t+3]=z,this.uint32[$t+4]=W,this.uint16[Jt+10]=q,this.uint16[Jt+11]=J,this.uint16[Jt+12]=se,this.float32[$t+7]=de,this.float32[$t+8]=Be,this.uint8[Cr+36]=Ve,this.uint8[Cr+37]=at,this.uint8[Cr+38]=$e,this.uint32[$t+10]=Et,this.int16[Jt+22]=Rt,l},s}(Na);vc.prototype.bytesPerElement=48,tn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",vc);var th=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,_,C,A,L,z,W,q,J,se,de,Be,Ve,at,$e,Et,Rt,Jt,$t,Cr,Yr,Sn,yi,Zn,bi,Nn,la){var Mi=this.length;return this.resize(Mi+1),this.emplace(Mi,l,d,_,C,A,L,z,W,q,J,se,de,Be,Ve,at,$e,Et,Rt,Jt,$t,Cr,Yr,Sn,yi,Zn,bi,Nn,la)},s.prototype.emplace=function(l,d,_,C,A,L,z,W,q,J,se,de,Be,Ve,at,$e,Et,Rt,Jt,$t,Cr,Yr,Sn,yi,Zn,bi,Nn,la,Mi){var li=34*l,vr=17*l;return this.int16[li+0]=d,this.int16[li+1]=_,this.int16[li+2]=C,this.int16[li+3]=A,this.int16[li+4]=L,this.int16[li+5]=z,this.int16[li+6]=W,this.int16[li+7]=q,this.uint16[li+8]=J,this.uint16[li+9]=se,this.uint16[li+10]=de,this.uint16[li+11]=Be,this.uint16[li+12]=Ve,this.uint16[li+13]=at,this.uint16[li+14]=$e,this.uint16[li+15]=Et,this.uint16[li+16]=Rt,this.uint16[li+17]=Jt,this.uint16[li+18]=$t,this.uint16[li+19]=Cr,this.uint16[li+20]=Yr,this.uint16[li+21]=Sn,this.uint16[li+22]=yi,this.uint32[vr+12]=Zn,this.float32[vr+13]=bi,this.float32[vr+14]=Nn,this.float32[vr+15]=la,this.float32[vr+16]=Mi,l},s}(Na);th.prototype.bytesPerElement=68,tn("StructArrayLayout8i15ui1ul4f68",th);var ef=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var d=this.length;return this.resize(d+1),this.emplace(d,l)},s.prototype.emplace=function(l,d){return this.float32[1*l+0]=d,l},s}(Na);ef.prototype.bytesPerElement=4,tn("StructArrayLayout1f4",ef);var ol=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,_){var C=this.length;return this.resize(C+1),this.emplace(C,l,d,_)},s.prototype.emplace=function(l,d,_,C){var A=3*l;return this.int16[A+0]=d,this.int16[A+1]=_,this.int16[A+2]=C,l},s}(Na);ol.prototype.bytesPerElement=6,tn("StructArrayLayout3i6",ol);var rh=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,_){var C=this.length;return this.resize(C+1),this.emplace(C,l,d,_)},s.prototype.emplace=function(l,d,_,C){var A=4*l;return this.uint32[2*l+0]=d,this.uint16[A+2]=_,this.uint16[A+3]=C,l},s}(Na);rh.prototype.bytesPerElement=8,tn("StructArrayLayout1ul2ui8",rh);var hu=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d){var _=this.length;return this.resize(_+1),this.emplace(_,l,d)},s.prototype.emplace=function(l,d,_){var C=2*l;return this.uint16[C+0]=d,this.uint16[C+1]=_,l},s}(Na);hu.prototype.bytesPerElement=4,tn("StructArrayLayout2ui4",hu);var Ip=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var d=this.length;return this.resize(d+1),this.emplace(d,l)},s.prototype.emplace=function(l,d){return this.uint16[1*l+0]=d,l},s}(Na);Ip.prototype.bytesPerElement=2,tn("StructArrayLayout1ui2",Ip);var tf=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,_,C){var A=this.length;return this.resize(A+1),this.emplace(A,l,d,_,C)},s.prototype.emplace=function(l,d,_,C,A){var L=4*l;return this.float32[L+0]=d,this.float32[L+1]=_,this.float32[L+2]=C,this.float32[L+3]=A,l},s}(Na);tf.prototype.bytesPerElement=16,tn("StructArrayLayout4f16",tf);var c=function(n){function s(){n.apply(this,arguments)}n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s;var l={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return l.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},l.x1.get=function(){return this._structArray.int16[this._pos2+2]},l.y1.get=function(){return this._structArray.int16[this._pos2+3]},l.x2.get=function(){return this._structArray.int16[this._pos2+4]},l.y2.get=function(){return this._structArray.int16[this._pos2+5]},l.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},l.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},l.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},l.anchorPoint.get=function(){return new rt(this.anchorPointX,this.anchorPointY)},Object.defineProperties(s.prototype,l),s}(Yh);c.prototype.size=20;var h=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.get=function(l){return new c(this,l)},s}(hc);tn("CollisionBoxArray",h);var f=function(n){function s(){n.apply(this,arguments)}n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s;var l={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return l.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},l.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},l.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},l.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},l.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},l.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},l.segment.get=function(){return this._structArray.uint16[this._pos2+10]},l.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},l.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},l.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},l.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},l.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},l.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},l.placedOrientation.set=function(d){this._structArray.uint8[this._pos1+37]=d},l.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},l.hidden.set=function(d){this._structArray.uint8[this._pos1+38]=d},l.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},l.crossTileID.set=function(d){this._structArray.uint32[this._pos4+10]=d},l.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(s.prototype,l),s}(Yh);f.prototype.size=48;var m=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.get=function(l){return new f(this,l)},s}(vc);tn("PlacedSymbolArray",m);var S=function(n){function s(){n.apply(this,arguments)}n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s;var l={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return l.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},l.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},l.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},l.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},l.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},l.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},l.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},l.key.get=function(){return this._structArray.uint16[this._pos2+8]},l.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},l.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},l.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},l.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},l.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},l.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},l.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},l.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},l.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},l.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},l.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},l.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},l.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},l.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},l.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},l.crossTileID.set=function(d){this._structArray.uint32[this._pos4+12]=d},l.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},l.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},l.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},l.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(s.prototype,l),s}(Yh);S.prototype.size=68;var k=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.get=function(l){return new S(this,l)},s}(th);tn("SymbolInstanceArray",k);var P=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getoffsetX=function(l){return this.float32[1*l+0]},s}(ef);tn("GlyphOffsetArray",P);var N=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getx=function(l){return this.int16[3*l+0]},s.prototype.gety=function(l){return this.int16[3*l+1]},s.prototype.gettileUnitDistanceFromAnchor=function(l){return this.int16[3*l+2]},s}(ol);tn("SymbolLineVertexArray",N);var Y=function(n){function s(){n.apply(this,arguments)}n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s;var l={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return l.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},l.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},l.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(s.prototype,l),s}(Yh);Y.prototype.size=8;var te=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.get=function(l){return new Y(this,l)},s}(rh);tn("FeatureIndexArray",te);var ye=io([{name:"a_pos",components:2,type:"Int16"}],4).members,le=function(n){n===void 0&&(n=[]),this.segments=n};function xe(n,s){return 256*(n=ar(Math.floor(n),0,255))+ar(Math.floor(s),0,255)}le.prototype.prepareSegment=function(n,s,l,d){var _=this.segments[this.segments.length-1];return n>le.MAX_VERTEX_ARRAY_LENGTH&&st("Max vertices per segment is "+le.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+n),(!_||_.vertexLength+n>le.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==d)&&(_={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},d!==void 0&&(_.sortKey=d),this.segments.push(_)),_},le.prototype.get=function(){return this.segments},le.prototype.destroy=function(){for(var n=0,s=this.segments;n<s.length;n+=1){var l=s[n];for(var d in l.vaos)l.vaos[d].destroy()}},le.simpleSegment=function(n,s,l,d){return new le([{vertexOffset:n,primitiveOffset:s,vertexLength:l,primitiveLength:d,vaos:{},sortKey:0}])},le.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,tn("SegmentVector",le);var ze=io([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ue=Jr(function(n){n.exports=function(s,l){var d,_,C,A,L,z,W,q;for(_=s.length-(d=3&s.length),C=l,L=3432918353,z=461845907,q=0;q<_;)W=255&s.charCodeAt(q)|(255&s.charCodeAt(++q))<<8|(255&s.charCodeAt(++q))<<16|(255&s.charCodeAt(++q))<<24,++q,C=27492+(65535&(A=5*(65535&(C=(C^=W=(65535&(W=(W=(65535&W)*L+(((W>>>16)*L&65535)<<16)&4294967295)<<15|W>>>17))*z+(((W>>>16)*z&65535)<<16)&4294967295)<<13|C>>>19))+((5*(C>>>16)&65535)<<16)&4294967295))+((58964+(A>>>16)&65535)<<16);switch(W=0,d){case 3:W^=(255&s.charCodeAt(q+2))<<16;case 2:W^=(255&s.charCodeAt(q+1))<<8;case 1:C^=W=(65535&(W=(W=(65535&(W^=255&s.charCodeAt(q)))*L+(((W>>>16)*L&65535)<<16)&4294967295)<<15|W>>>17))*z+(((W>>>16)*z&65535)<<16)&4294967295}return C^=s.length,C=2246822507*(65535&(C^=C>>>16))+((2246822507*(C>>>16)&65535)<<16)&4294967295,C=3266489909*(65535&(C^=C>>>13))+((3266489909*(C>>>16)&65535)<<16)&4294967295,(C^=C>>>16)>>>0}}),Je=Jr(function(n){n.exports=function(s,l){for(var d,_=s.length,C=l^_,A=0;_>=4;)d=1540483477*(65535&(d=255&s.charCodeAt(A)|(255&s.charCodeAt(++A))<<8|(255&s.charCodeAt(++A))<<16|(255&s.charCodeAt(++A))<<24))+((1540483477*(d>>>16)&65535)<<16),C=1540483477*(65535&C)+((1540483477*(C>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),_-=4,++A;switch(_){case 3:C^=(255&s.charCodeAt(A+2))<<16;case 2:C^=(255&s.charCodeAt(A+1))<<8;case 1:C=1540483477*(65535&(C^=255&s.charCodeAt(A)))+((1540483477*(C>>>16)&65535)<<16)}return C=1540483477*(65535&(C^=C>>>13))+((1540483477*(C>>>16)&65535)<<16),(C^=C>>>15)>>>0}}),Fe=Ue,et=Je;Fe.murmur3=Ue,Fe.murmur2=et;var pt=function(){this.ids=[],this.positions=[],this.indexed=!1};pt.prototype.add=function(n,s,l,d){this.ids.push(Qt(n)),this.positions.push(s,l,d)},pt.prototype.getPositions=function(n){for(var s=Qt(n),l=0,d=this.ids.length-1;l<d;){var _=l+d>>1;this.ids[_]>=s?d=_:l=_+1}for(var C=[];this.ids[l]===s;)C.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return C},pt.serialize=function(n,s){var l=new Float64Array(n.ids),d=new Uint32Array(n.positions);return function _(C,A,L,z){for(;L<z;){for(var W=C[L+z>>1],q=L-1,J=z+1;;){do q++;while(C[q]<W);do J--;while(C[J]>W);if(q>=J)break;Bt(C,q,J),Bt(A,3*q,3*J),Bt(A,3*q+1,3*J+1),Bt(A,3*q+2,3*J+2)}J-L<z-J?(_(C,A,L,J),L=J+1):(_(C,A,J+1,z),z=J)}}(l,d,0,l.length-1),s&&s.push(l.buffer,d.buffer),{ids:l,positions:d}},pt.deserialize=function(n){var s=new pt;return s.ids=n.ids,s.positions=n.positions,s.indexed=!0,s};var kt=Math.pow(2,53)-1;function Qt(n){var s=+n;return!isNaN(s)&&s<=kt?s:Fe(String(n))}function Bt(n,s,l){var d=n[s];n[s]=n[l],n[l]=d}tn("FeaturePositionMap",pt);var nr=function(n,s){this.gl=n.gl,this.location=s},Or=function(n){function s(l,d){n.call(this,l,d),this.current=0}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))},s}(nr),un=function(n){function s(l,d){n.call(this,l,d),this.current=0}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))},s}(nr),rn=function(n){function s(l,d){n.call(this,l,d),this.current=[0,0]}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))},s}(nr),Pn=function(n){function s(l,d){n.call(this,l,d),this.current=[0,0,0]}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))},s}(nr),ui=function(n){function s(l,d){n.call(this,l,d),this.current=[0,0,0,0]}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))},s}(nr),gi=function(n){function s(l,d){n.call(this,l,d),this.current=nt.transparent}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))},s}(nr),fi=new Float32Array(16),_a=function(n){function s(l,d){n.call(this,l,d),this.current=fi}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(var d=1;d<16;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}},s}(nr);function Dn(n){return[xe(255*n.r,255*n.g),xe(255*n.b,255*n.a)]}var Ii=function(n,s,l){this.value=n,this.uniformNames=s.map(function(d){return"u_"+d}),this.type=l};Ii.prototype.setUniform=function(n,s,l){n.set(l.constantOr(this.value))},Ii.prototype.getBinding=function(n,s,l){return this.type==="color"?new gi(n,s):new un(n,s)};var Wi=function(n,s){this.uniformNames=s.map(function(l){return"u_"+l}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Wi.prototype.setConstantPatternPositions=function(n,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=n.tlbr},Wi.prototype.setUniform=function(n,s,l,d){var _=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&n.set(_)},Wi.prototype.getBinding=function(n,s,l){return l.substr(0,9)==="u_pattern"?new ui(n,s):new un(n,s)};var Bi=function(n,s,l,d){this.expression=n,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(function(_){return{name:"a_"+_,type:"Float32",components:l==="color"?2:1,offset:0}}),this.paintVertexArray=new d};Bi.prototype.populatePaintArray=function(n,s,l,d,_){var C=this.paintVertexArray.length,A=this.expression.evaluate(new aa(0),s,{},d,[],_);this.paintVertexArray.resize(n),this._setPaintValue(C,n,A)},Bi.prototype.updatePaintArray=function(n,s,l,d){var _=this.expression.evaluate({zoom:0},l,d);this._setPaintValue(n,s,_)},Bi.prototype._setPaintValue=function(n,s,l){if(this.type==="color")for(var d=Dn(l),_=n;_<s;_++)this.paintVertexArray.emplace(_,d[0],d[1]);else{for(var C=n;C<s;C++)this.paintVertexArray.emplace(C,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}},Bi.prototype.upload=function(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Bi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var wi=function(n,s,l,d,_,C){this.expression=n,this.uniformNames=s.map(function(A){return"u_"+A+"_t"}),this.type=l,this.useIntegerZoom=d,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=s.map(function(A){return{name:"a_"+A,type:"Float32",components:l==="color"?4:2,offset:0}}),this.paintVertexArray=new C};wi.prototype.populatePaintArray=function(n,s,l,d,_){var C=this.expression.evaluate(new aa(this.zoom),s,{},d,[],_),A=this.expression.evaluate(new aa(this.zoom+1),s,{},d,[],_),L=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(L,n,C,A)},wi.prototype.updatePaintArray=function(n,s,l,d){var _=this.expression.evaluate({zoom:this.zoom},l,d),C=this.expression.evaluate({zoom:this.zoom+1},l,d);this._setPaintValue(n,s,_,C)},wi.prototype._setPaintValue=function(n,s,l,d){if(this.type==="color")for(var _=Dn(l),C=Dn(d),A=n;A<s;A++)this.paintVertexArray.emplace(A,_[0],_[1],C[0],C[1]);else{for(var L=n;L<s;L++)this.paintVertexArray.emplace(L,l,d);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(d))}},wi.prototype.upload=function(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},wi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},wi.prototype.setUniform=function(n,s){var l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,d=ar(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);n.set(d)},wi.prototype.getBinding=function(n,s,l){return new un(n,s)};var Ki=function(n,s,l,d,_,C){this.expression=n,this.type=s,this.useIntegerZoom=l,this.zoom=d,this.layerId=C,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _};Ki.prototype.populatePaintArray=function(n,s,l){var d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(d,n,s.patterns&&s.patterns[this.layerId],l)},Ki.prototype.updatePaintArray=function(n,s,l,d,_){this._setPaintValues(n,s,l.patterns&&l.patterns[this.layerId],_)},Ki.prototype._setPaintValues=function(n,s,l,d){if(d&&l){var _=d[l.min],C=d[l.mid],A=d[l.max];if(_&&C&&A)for(var L=n;L<s;L++)this.zoomInPaintVertexArray.emplace(L,C.tl[0],C.tl[1],C.br[0],C.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],C.pixelRatio,_.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,C.tl[0],C.tl[1],C.br[0],C.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],C.pixelRatio,A.pixelRatio)}},Ki.prototype.upload=function(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,ze.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,ze.members,this.expression.isStateDependent))},Ki.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Ci=function(n,s,l){this.binders={},this._buffers=[];var d=[];for(var _ in n.paint._values)if(l(_)){var C=n.paint.get(_);if(C instanceof Hs&&Rs(C.property.specification)){var A=gs(_,n.type),L=C.value,z=C.property.specification.type,W=C.property.useIntegerZoom,q=C.property.specification["property-type"],J=q==="cross-faded"||q==="cross-faded-data-driven";if(L.kind==="constant")this.binders[_]=J?new Wi(L.value,A):new Ii(L.value,A,z),d.push("/u_"+_);else if(L.kind==="source"||J){var se=qo(_,z,"source");this.binders[_]=J?new Ki(L,z,W,s,se,n.id):new Bi(L,A,z,se),d.push("/a_"+_)}else{var de=qo(_,z,"composite");this.binders[_]=new wi(L,A,z,W,s,de),d.push("/z_"+_)}}}this.cacheKey=d.sort().join("")};Ci.prototype.getMaxValue=function(n){var s=this.binders[n];return s instanceof Bi||s instanceof wi?s.maxValue:0},Ci.prototype.populatePaintArrays=function(n,s,l,d,_){for(var C in this.binders){var A=this.binders[C];(A instanceof Bi||A instanceof wi||A instanceof Ki)&&A.populatePaintArray(n,s,l,d,_)}},Ci.prototype.setConstantPatternPositions=function(n,s){for(var l in this.binders){var d=this.binders[l];d instanceof Wi&&d.setConstantPatternPositions(n,s)}},Ci.prototype.updatePaintArrays=function(n,s,l,d,_){var C=!1;for(var A in n)for(var L=0,z=s.getPositions(A);L<z.length;L+=1){var W=z[L],q=l.feature(W.index);for(var J in this.binders){var se=this.binders[J];if((se instanceof Bi||se instanceof wi||se instanceof Ki)&&se.expression.isStateDependent===!0){var de=d.paint.get(J);se.expression=de.value,se.updatePaintArray(W.start,W.end,q,n[A],_),C=!0}}}return C},Ci.prototype.defines=function(){var n=[];for(var s in this.binders){var l=this.binders[s];(l instanceof Ii||l instanceof Wi)&&n.push.apply(n,l.uniformNames.map(function(d){return"#define HAS_UNIFORM_"+d}))}return n},Ci.prototype.getBinderAttributes=function(){var n=[];for(var s in this.binders){var l=this.binders[s];if(l instanceof Bi||l instanceof wi)for(var d=0;d<l.paintVertexAttributes.length;d++)n.push(l.paintVertexAttributes[d].name);else if(l instanceof Ki)for(var _=0;_<ze.members.length;_++)n.push(ze.members[_].name)}return n},Ci.prototype.getBinderUniforms=function(){var n=[];for(var s in this.binders){var l=this.binders[s];if(l instanceof Ii||l instanceof Wi||l instanceof wi)for(var d=0,_=l.uniformNames;d<_.length;d+=1)n.push(_[d])}return n},Ci.prototype.getPaintVertexBuffers=function(){return this._buffers},Ci.prototype.getUniforms=function(n,s){var l=[];for(var d in this.binders){var _=this.binders[d];if(_ instanceof Ii||_ instanceof Wi||_ instanceof wi)for(var C=0,A=_.uniformNames;C<A.length;C+=1){var L=A[C];if(s[L]){var z=_.getBinding(n,s[L],L);l.push({name:L,property:d,binding:z})}}}return l},Ci.prototype.setUniforms=function(n,s,l,d){for(var _=0,C=s;_<C.length;_+=1){var A=C[_],L=A.name,z=A.property;this.binders[z].setUniform(A.binding,d,l.get(z),L)}},Ci.prototype.updatePaintBuffers=function(n){for(var s in this._buffers=[],this.binders){var l=this.binders[s];if(n&&l instanceof Ki){var d=n.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(l instanceof Bi||l instanceof wi)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}},Ci.prototype.upload=function(n){for(var s in this.binders){var l=this.binders[s];(l instanceof Bi||l instanceof wi||l instanceof Ki)&&l.upload(n)}this.updatePaintBuffers()},Ci.prototype.destroy=function(){for(var n in this.binders){var s=this.binders[n];(s instanceof Bi||s instanceof wi||s instanceof Ki)&&s.destroy()}};var Si=function(n,s,l){l===void 0&&(l=function(){return!0}),this.programConfigurations={};for(var d=0,_=n;d<_.length;d+=1){var C=_[d];this.programConfigurations[C.id]=new Ci(C,s,l)}this.needsUpload=!1,this._featureMap=new pt,this._bufferOffset=0};function gs(n,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(s+"-","").replace(/-/g,"_")]}function qo(n,s,l){var d={color:{source:Il,composite:tf},number:{source:ef,composite:Il}},_=function(C){return{"line-pattern":{source:fc,composite:fc},"fill-pattern":{source:fc,composite:fc},"fill-extrusion-pattern":{source:fc,composite:fc}}[C]}(n);return _&&_[l]||d[s][l]}Si.prototype.populatePaintArrays=function(n,s,l,d,_,C){for(var A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(n,s,d,_,C);s.id!==void 0&&this._featureMap.add(s.id,l,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0},Si.prototype.updatePaintArrays=function(n,s,l,d){for(var _=0,C=l;_<C.length;_+=1){var A=C[_];this.needsUpload=this.programConfigurations[A.id].updatePaintArrays(n,this._featureMap,s,A,d)||this.needsUpload}},Si.prototype.get=function(n){return this.programConfigurations[n]},Si.prototype.upload=function(n){if(this.needsUpload){for(var s in this.programConfigurations)this.programConfigurations[s].upload(n);this.needsUpload=!1}},Si.prototype.destroy=function(){for(var n in this.programConfigurations)this.programConfigurations[n].destroy()},tn("ConstantBinder",Ii),tn("CrossFadedConstantBinder",Wi),tn("SourceExpressionBinder",Bi),tn("CrossFadedCompositeBinder",Ki),tn("CompositeExpressionBinder",wi),tn("ProgramConfiguration",Ci,{omit:["_buffers"]}),tn("ProgramConfigurationSet",Si);var Ds=Math.pow(2,14)-1,es=-Ds-1;function vo(n){for(var s=8192/n.extent,l=n.loadGeometry(),d=0;d<l.length;d++)for(var _=l[d],C=0;C<_.length;C++){var A=_[C],L=Math.round(A.x*s),z=Math.round(A.y*s);A.x=ar(L,es,Ds),A.y=ar(z,es,Ds),(L<A.x||L>A.x+1||z<A.y||z>A.y+1)&&st("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return l}function lo(n,s){return{type:n.type,id:n.id,properties:n.properties,geometry:s?vo(n):[]}}function pu(n,s,l,d,_){n.emplaceBack(2*s+(d+1)/2,2*l+(_+1)/2)}var Js=function(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new Af,this.indexArray=new dc,this.segments=new le,this.programConfigurations=new Si(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function Xl(n,s){for(var l=0;l<n.length;l++)if(ul(s,n[l]))return!0;for(var d=0;d<s.length;d++)if(ul(n,s[d]))return!0;return!!Tf(n,s)}function du(n,s,l){return!!ul(n,s)||!!Yl(s,n,l)}function Xu(n,s){if(n.length===1)return Mf(s,n[0]);for(var l=0;l<s.length;l++)for(var d=s[l],_=0;_<d.length;_++)if(ul(n,d[_]))return!0;for(var C=0;C<n.length;C++)if(Mf(s,n[C]))return!0;for(var A=0;A<s.length;A++)if(Tf(n,s[A]))return!0;return!1}function eu(n,s,l){if(n.length>1){if(Tf(n,s))return!0;for(var d=0;d<s.length;d++)if(Yl(s[d],n,l))return!0}for(var _=0;_<n.length;_++)if(Yl(n[_],s,l))return!0;return!1}function Tf(n,s){if(n.length===0||s.length===0)return!1;for(var l=0;l<n.length-1;l++)for(var d=n[l],_=n[l+1],C=0;C<s.length-1;C++)if(rf(d,_,s[C],s[C+1]))return!0;return!1}function rf(n,s,l,d){return en(n,l,d)!==en(s,l,d)&&en(n,s,l)!==en(n,s,d)}function Yl(n,s,l){var d=l*l;if(s.length===1)return n.distSqr(s[0])<d;for(var _=1;_<s.length;_++)if(sl(n,s[_-1],s[_])<d)return!0;return!1}function sl(n,s,l){var d=s.distSqr(l);if(d===0)return n.distSqr(s);var _=((n.x-s.x)*(l.x-s.x)+(n.y-s.y)*(l.y-s.y))/d;return n.distSqr(_<0?s:_>1?l:l.sub(s)._mult(_)._add(s))}function Mf(n,s){for(var l,d,_,C=!1,A=0;A<n.length;A++)for(var L=0,z=(l=n[A]).length-1;L<l.length;z=L++)(d=l[L]).y>s.y!=(_=l[z]).y>s.y&&s.x<(_.x-d.x)*(s.y-d.y)/(_.y-d.y)+d.x&&(C=!C);return C}function ul(n,s){for(var l=!1,d=0,_=n.length-1;d<n.length;_=d++){var C=n[d],A=n[_];C.y>s.y!=A.y>s.y&&s.x<(A.x-C.x)*(s.y-C.y)/(A.y-C.y)+C.x&&(l=!l)}return l}function mc(n,s,l){var d=l[0],_=l[2];if(n.x<d.x&&s.x<d.x||n.x>_.x&&s.x>_.x||n.y<d.y&&s.y<d.y||n.y>_.y&&s.y>_.y)return!1;var C=en(n,s,l[0]);return C!==en(n,s,l[1])||C!==en(n,s,l[2])||C!==en(n,s,l[3])}function ql(n,s,l){var d=s.paint.get(n).value;return d.kind==="constant"?d.value:l.programConfigurations.get(s.id).getMaxValue(n)}function ls(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Pl(n,s,l,d,_){if(!s[0]&&!s[1])return n;var C=rt.convert(s)._mult(_);l==="viewport"&&C._rotate(-d);for(var A=[],L=0;L<n.length;L++)A.push(n[L].sub(C));return A}Js.prototype.populate=function(n,s,l){var d=this.layers[0],_=[],C=null;d.type==="circle"&&(C=d.layout.get("circle-sort-key"));for(var A=0,L=n;A<L.length;A+=1){var z=L[A],W=z.feature,q=z.id,J=z.index,se=z.sourceLayerIndex,de=this.layers[0]._featureFilter.needGeometry,Be=lo(W,de);if(this.layers[0]._featureFilter.filter(new aa(this.zoom),Be,l)){var Ve=C?C.evaluate(Be,{},l):void 0,at={id:q,properties:W.properties,type:W.type,sourceLayerIndex:se,index:J,geometry:de?Be.geometry:vo(W),patterns:{},sortKey:Ve};_.push(at)}}C&&_.sort(function(Sn,yi){return Sn.sortKey-yi.sortKey});for(var $e=0,Et=_;$e<Et.length;$e+=1){var Rt=Et[$e],Jt=Rt.geometry,$t=Rt.index,Cr=Rt.sourceLayerIndex,Yr=n[$t].feature;this.addFeature(Rt,Jt,$t,l),s.featureIndex.insert(Yr,Jt,$t,Cr,this.index)}},Js.prototype.update=function(n,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,l)},Js.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Js.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Js.prototype.upload=function(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,ye),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0},Js.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Js.prototype.addFeature=function(n,s,l,d){for(var _=0,C=s;_<C.length;_+=1)for(var A=0,L=C[_];A<L.length;A+=1){var z=L[A],W=z.x,q=z.y;if(!(W<0||W>=8192||q<0||q>=8192)){var J=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),se=J.vertexLength;pu(this.layoutVertexArray,W,q,-1,-1),pu(this.layoutVertexArray,W,q,1,-1),pu(this.layoutVertexArray,W,q,1,1),pu(this.layoutVertexArray,W,q,-1,1),this.indexArray.emplaceBack(se,se+1,se+2),this.indexArray.emplaceBack(se,se+3,se+2),J.vertexLength+=4,J.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,{},d)},tn("CircleBucket",Js,{omit:["layers"]});var Ll=new Yo({"circle-sort-key":new ti(_e.layout_circle["circle-sort-key"])}),tu={paint:new Yo({"circle-radius":new ti(_e.paint_circle["circle-radius"]),"circle-color":new ti(_e.paint_circle["circle-color"]),"circle-blur":new ti(_e.paint_circle["circle-blur"]),"circle-opacity":new ti(_e.paint_circle["circle-opacity"]),"circle-translate":new ci(_e.paint_circle["circle-translate"]),"circle-translate-anchor":new ci(_e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ci(_e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ci(_e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ti(_e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ti(_e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ti(_e.paint_circle["circle-stroke-opacity"])}),layout:Ll},Pa=typeof Float32Array<"u"?Float32Array:Array;function Ou(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Bs(n,s,l){var d=s[0],_=s[1],C=s[2],A=s[3],L=s[4],z=s[5],W=s[6],q=s[7],J=s[8],se=s[9],de=s[10],Be=s[11],Ve=s[12],at=s[13],$e=s[14],Et=s[15],Rt=l[0],Jt=l[1],$t=l[2],Cr=l[3];return n[0]=Rt*d+Jt*L+$t*J+Cr*Ve,n[1]=Rt*_+Jt*z+$t*se+Cr*at,n[2]=Rt*C+Jt*W+$t*de+Cr*$e,n[3]=Rt*A+Jt*q+$t*Be+Cr*Et,n[4]=(Rt=l[4])*d+(Jt=l[5])*L+($t=l[6])*J+(Cr=l[7])*Ve,n[5]=Rt*_+Jt*z+$t*se+Cr*at,n[6]=Rt*C+Jt*W+$t*de+Cr*$e,n[7]=Rt*A+Jt*q+$t*Be+Cr*Et,n[8]=(Rt=l[8])*d+(Jt=l[9])*L+($t=l[10])*J+(Cr=l[11])*Ve,n[9]=Rt*_+Jt*z+$t*se+Cr*at,n[10]=Rt*C+Jt*W+$t*de+Cr*$e,n[11]=Rt*A+Jt*q+$t*Be+Cr*Et,n[12]=(Rt=l[12])*d+(Jt=l[13])*L+($t=l[14])*J+(Cr=l[15])*Ve,n[13]=Rt*_+Jt*z+$t*se+Cr*at,n[14]=Rt*C+Jt*W+$t*de+Cr*$e,n[15]=Rt*A+Jt*q+$t*Be+Cr*Et,n}Math.hypot||(Math.hypot=function(){for(var n=arguments,s=0,l=arguments.length;l--;)s+=n[l]*n[l];return Math.sqrt(s)});var gc,kf=Bs;function $h(n,s,l){var d=s[0],_=s[1],C=s[2],A=s[3];return n[0]=l[0]*d+l[4]*_+l[8]*C+l[12]*A,n[1]=l[1]*d+l[5]*_+l[9]*C+l[13]*A,n[2]=l[2]*d+l[6]*_+l[10]*C+l[14]*A,n[3]=l[3]*d+l[7]*_+l[11]*C+l[15]*A,n}gc=new Pa(3),Pa!=Float32Array&&(gc[0]=0,gc[1]=0,gc[2]=0),function(){var n=new Pa(4);Pa!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0)}();var Kh=(function(){var n=new Pa(2);Pa!=Float32Array&&(n[0]=0,n[1]=0)}(),function(n){function s(l){n.call(this,l,tu)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.createBucket=function(l){return new Js(l)},s.prototype.queryRadius=function(l){var d=l;return ql("circle-radius",this,d)+ql("circle-stroke-width",this,d)+ls(this.paint.get("circle-translate"))},s.prototype.queryIntersectsFeature=function(l,d,_,C,A,L,z,W){for(var q=Pl(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),L.angle,z),J=this.paint.get("circle-radius").evaluate(d,_)+this.paint.get("circle-stroke-width").evaluate(d,_),se=this.paint.get("circle-pitch-alignment")==="map",de=se?q:function(Yr,Sn){return Yr.map(function(yi){return Yu(yi,Sn)})}(q,W),Be=se?J*z:J,Ve=0,at=C;Ve<at.length;Ve+=1)for(var $e=0,Et=at[Ve];$e<Et.length;$e+=1){var Rt=Et[$e],Jt=se?Rt:Yu(Rt,W),$t=Be,Cr=$h([],[Rt.x,Rt.y,0,1],W);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?$t*=Cr[3]/L.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&($t*=L.cameraToCenterDistance/Cr[3]),du(de,Jt,$t))return!0}return!1},s}(Tl));function Yu(n,s){var l=$h([],[n.x,n.y,0,1],s);return new rt(l[0]/l[3],l[1]/l[3])}var Oc=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s}(Js);function Fu(n,s,l,d){var _=s.width,C=s.height;if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==_*C*l)throw new RangeError("mismatched image size")}else d=new Uint8Array(_*C*l);return n.width=_,n.height=C,n.data=d,n}function If(n,s,l){var d=s.width,_=s.height;if(d!==n.width||_!==n.height){var C=Fu({},{width:d,height:_},l);Pf(n,C,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,d),height:Math.min(n.height,_)},l),n.width=d,n.height=_,n.data=C.data}}function Pf(n,s,l,d,_,C){if(_.width===0||_.height===0)return s;if(_.width>n.width||_.height>n.height||l.x>n.width-_.width||l.y>n.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>s.width||_.height>s.height||d.x>s.width-_.width||d.y>s.height-_.height)throw new RangeError("out of range destination coordinates for image copy");for(var A=n.data,L=s.data,z=0;z<_.height;z++)for(var W=((l.y+z)*n.width+l.x)*C,q=((d.y+z)*s.width+d.x)*C,J=0;J<_.width*C;J++)L[q+J]=A[W+J];return s}tn("HeatmapBucket",Oc,{omit:["layers"]});var $l=function(n,s){Fu(this,n,1,s)};$l.prototype.resize=function(n){If(this,n,1)},$l.prototype.clone=function(){return new $l({width:this.width,height:this.height},new Uint8Array(this.data))},$l.copy=function(n,s,l,d,_){Pf(n,s,l,d,_,1)};var ys=function(n,s){Fu(this,n,4,s)};ys.prototype.resize=function(n){If(this,n,4)},ys.prototype.replace=function(n,s){s?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n},ys.prototype.clone=function(){return new ys({width:this.width,height:this.height},new Uint8Array(this.data))},ys.copy=function(n,s,l,d,_){Pf(n,s,l,d,_,4)},tn("AlphaImage",$l),tn("RGBAImage",ys);var Lf={paint:new Yo({"heatmap-radius":new ti(_e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ti(_e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ci(_e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ru(_e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ci(_e.paint_heatmap["heatmap-opacity"])})};function Rl(n){var s={},l=n.resolution||256,d=n.clips?n.clips.length:1,_=n.image||new ys({width:l,height:d}),C=function(Be,Ve,at){s[n.evaluationKey]=at;var $e=n.expression.evaluate(s);_.data[Be+Ve+0]=Math.floor(255*$e.r/$e.a),_.data[Be+Ve+1]=Math.floor(255*$e.g/$e.a),_.data[Be+Ve+2]=Math.floor(255*$e.b/$e.a),_.data[Be+Ve+3]=Math.floor(255*$e.a)};if(n.clips)for(var A=0,L=0;A<d;++A,L+=4*l)for(var z=0,W=0;z<l;z++,W+=4){var q=z/(l-1),J=n.clips[A];C(L,W,J.start*(1-q)+J.end*q)}else for(var se=0,de=0;se<l;se++,de+=4)C(0,de,se/(l-1));return _}var yh=function(n){function s(l){n.call(this,l,Lf),this._updateColorRamp()}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.createBucket=function(l){return new Oc(l)},s.prototype._handleSpecialPaintPropertyUpdate=function(l){l==="heatmap-color"&&this._updateColorRamp()},s.prototype._updateColorRamp=function(){this.colorRamp=Rl({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},s.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},s}(Tl),Cu={paint:new Yo({"hillshade-illumination-direction":new ci(_e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ci(_e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ci(_e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ci(_e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ci(_e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ci(_e.paint_hillshade["hillshade-accent-color"])})},vu=function(n){function s(l){n.call(this,l,Cu)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},s}(Tl),ee=io([{name:"a_pos",components:2,type:"Int16"}],4).members,Ur=cd,Rf=cd;function cd(n,s,l){l=l||2;var d,_,C,A,L,z,W,q=s&&s.length,J=q?s[0]*l:n.length,se=Ws(n,0,J,l,!0),de=[];if(!se||se.next===se.prev)return de;if(q&&(se=function(Ve,at,$e,Et){var Rt,Jt,$t,Cr=[];for(Rt=0,Jt=at.length;Rt<Jt;Rt++)($t=Ws(Ve,at[Rt]*Et,Rt<Jt-1?at[Rt+1]*Et:Ve.length,Et,!1))===$t.next&&($t.steiner=!0),Cr.push(nf($t));for(Cr.sort(lv),Rt=0;Rt<Cr.length;Rt++)Dd(Cr[Rt],$e),$e=mu($e,$e.next);return $e}(n,s,se,l)),n.length>80*l){d=C=n[0],_=A=n[1];for(var Be=l;Be<J;Be+=l)(L=n[Be])<d&&(d=L),(z=n[Be+1])<_&&(_=z),L>C&&(C=L),z>A&&(A=z);W=(W=Math.max(C-d,A-_))!==0?1/W:0}return Kl(se,de,l,d,_,W),de}function Ws(n,s,l,d,_){var C,A;if(_===of(n,s,l,d)>0)for(C=s;C<l;C+=d)A=Rp(C,n[C],n[C+1],A);else for(C=l-d;C>=s;C-=d)A=Rp(C,n[C],n[C+1],A);return A&&Qh(A,A.next)&&(Su(A),A=A.next),A}function mu(n,s){if(!n)return n;s||(s=n);var l,d=n;do if(l=!1,d.steiner||!Qh(d,d.next)&&cs(d.prev,d,d.next)!==0)d=d.next;else{if(Su(d),(d=s=d.prev)===d.next)break;l=!0}while(l||d!==s);return s}function Kl(n,s,l,d,_,C,A){if(n){!A&&C&&function(q,J,se,de){var Be=q;do Be.z===null&&(Be.z=nh(Be.x,Be.y,J,se,de)),Be.prevZ=Be.prev,Be.nextZ=Be.next,Be=Be.next;while(Be!==q);Be.prevZ.nextZ=null,Be.prevZ=null,function(Ve){var at,$e,Et,Rt,Jt,$t,Cr,Yr,Sn=1;do{for($e=Ve,Ve=null,Jt=null,$t=0;$e;){for($t++,Et=$e,Cr=0,at=0;at<Sn&&(Cr++,Et=Et.nextZ);at++);for(Yr=Sn;Cr>0||Yr>0&&Et;)Cr!==0&&(Yr===0||!Et||$e.z<=Et.z)?(Rt=$e,$e=$e.nextZ,Cr--):(Rt=Et,Et=Et.nextZ,Yr--),Jt?Jt.nextZ=Rt:Ve=Rt,Rt.prevZ=Jt,Jt=Rt;$e=Et}Jt.nextZ=null,Sn*=2}while($t>1)}(Be)}(n,d,_,C);for(var L,z,W=n;n.prev!==n.next;)if(L=n.prev,z=n.next,C?Of(n,d,_,C):Pp(n))s.push(L.i/l),s.push(n.i/l),s.push(z.i/l),Su(n),n=z.next,W=z.next;else if((n=z)===W){A?A===1?Kl(n=ru(mu(n),s,l),s,l,d,_,C,2):A===2&&ll(n,s,l,d,_,C):Kl(mu(n),s,l,d,_,C,1);break}}}function Pp(n){var s=n.prev,l=n,d=n.next;if(cs(s,l,d)>=0)return!1;for(var _=n.next.next;_!==n.prev;){if(_h(s.x,s.y,l.x,l.y,d.x,d.y,_.x,_.y)&&cs(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function Of(n,s,l,d){var _=n.prev,C=n,A=n.next;if(cs(_,C,A)>=0)return!1;for(var L=_.x>C.x?_.x>A.x?_.x:A.x:C.x>A.x?C.x:A.x,z=_.y>C.y?_.y>A.y?_.y:A.y:C.y>A.y?C.y:A.y,W=nh(_.x<C.x?_.x<A.x?_.x:A.x:C.x<A.x?C.x:A.x,_.y<C.y?_.y<A.y?_.y:A.y:C.y<A.y?C.y:A.y,s,l,d),q=nh(L,z,s,l,d),J=n.prevZ,se=n.nextZ;J&&J.z>=W&&se&&se.z<=q;){if(J!==n.prev&&J!==n.next&&_h(_.x,_.y,C.x,C.y,A.x,A.y,J.x,J.y)&&cs(J.prev,J,J.next)>=0||(J=J.prevZ,se!==n.prev&&se!==n.next&&_h(_.x,_.y,C.x,C.y,A.x,A.y,se.x,se.y)&&cs(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;J&&J.z>=W;){if(J!==n.prev&&J!==n.next&&_h(_.x,_.y,C.x,C.y,A.x,A.y,J.x,J.y)&&cs(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;se&&se.z<=q;){if(se!==n.prev&&se!==n.next&&_h(_.x,_.y,C.x,C.y,A.x,A.y,se.x,se.y)&&cs(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function ru(n,s,l){var d=n;do{var _=d.prev,C=d.next.next;!Qh(_,C)&&fd(_,d,d.next,C)&&ep(_,C)&&ep(C,_)&&(s.push(_.i/l),s.push(d.i/l),s.push(C.i/l),Su(d),Su(d.next),d=n=C),d=d.next}while(d!==n);return mu(d)}function ll(n,s,l,d,_,C){var A=n;do{for(var L=A.next.next;L!==A.prev;){if(A.i!==L.i&&Ff(A,L)){var z=af(A,L);return A=mu(A,A.next),z=mu(z,z.next),Kl(A,s,l,d,_,C),void Kl(z,s,l,d,_,C)}L=L.next}A=A.next}while(A!==n)}function lv(n,s){return n.x-s.x}function Dd(n,s){if(s=function(d,_){var C,A=_,L=d.x,z=d.y,W=-1/0;do{if(z<=A.y&&z>=A.next.y&&A.next.y!==A.y){var q=A.x+(z-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(q<=L&&q>W){if(W=q,q===L){if(z===A.y)return A;if(z===A.next.y)return A.next}C=A.x<A.next.x?A:A.next}}A=A.next}while(A!==_);if(!C)return null;if(L===W)return C;var J,se=C,de=C.x,Be=C.y,Ve=1/0;A=C;do L>=A.x&&A.x>=de&&L!==A.x&&_h(z<Be?L:W,z,de,Be,z<Be?W:L,z,A.x,A.y)&&(J=Math.abs(z-A.y)/(L-A.x),ep(A,d)&&(J<Ve||J===Ve&&(A.x>C.x||A.x===C.x&&Lp(C,A)))&&(C=A,Ve=J)),A=A.next;while(A!==se);return C}(n,s)){var l=af(s,n);mu(s,s.next),mu(l,l.next)}}function Lp(n,s){return cs(n.prev,n,s.prev)<0&&cs(s.next,n,n.next)<0}function nh(n,s,l,d,_){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-l)*_)|n<<8))|n<<4))|n<<2))|n<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-d)*_)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function nf(n){var s=n,l=n;do(s.x<l.x||s.x===l.x&&s.y<l.y)&&(l=s),s=s.next;while(s!==n);return l}function _h(n,s,l,d,_,C,A,L){return(_-A)*(s-L)-(n-A)*(C-L)>=0&&(n-A)*(d-L)-(l-A)*(s-L)>=0&&(l-A)*(C-L)-(_-A)*(d-L)>=0}function Ff(n,s){return n.next.i!==s.i&&n.prev.i!==s.i&&!function(l,d){var _=l;do{if(_.i!==l.i&&_.next.i!==l.i&&_.i!==d.i&&_.next.i!==d.i&&fd(_,_.next,l,d))return!0;_=_.next}while(_!==l);return!1}(n,s)&&(ep(n,s)&&ep(s,n)&&function(l,d){var _=l,C=!1,A=(l.x+d.x)/2,L=(l.y+d.y)/2;do _.y>L!=_.next.y>L&&_.next.y!==_.y&&A<(_.next.x-_.x)*(L-_.y)/(_.next.y-_.y)+_.x&&(C=!C),_=_.next;while(_!==l);return C}(n,s)&&(cs(n.prev,n,s.prev)||cs(n,s.prev,s))||Qh(n,s)&&cs(n.prev,n,n.next)>0&&cs(s.prev,s,s.next)>0)}function cs(n,s,l){return(s.y-n.y)*(l.x-s.x)-(s.x-n.x)*(l.y-s.y)}function Qh(n,s){return n.x===s.x&&n.y===s.y}function fd(n,s,l,d){var _=Jh(cs(n,s,l)),C=Jh(cs(n,s,d)),A=Jh(cs(l,d,n)),L=Jh(cs(l,d,s));return _!==C&&A!==L||!(_!==0||!Ui(n,l,s))||!(C!==0||!Ui(n,d,s))||!(A!==0||!Ui(l,n,d))||!(L!==0||!Ui(l,s,d))}function Ui(n,s,l){return s.x<=Math.max(n.x,l.x)&&s.x>=Math.min(n.x,l.x)&&s.y<=Math.max(n.y,l.y)&&s.y>=Math.min(n.y,l.y)}function Jh(n){return n>0?1:n<0?-1:0}function ep(n,s){return cs(n.prev,n,n.next)<0?cs(n,s,n.next)>=0&&cs(n,n.prev,s)>=0:cs(n,s,n.prev)<0||cs(n,n.next,s)<0}function af(n,s){var l=new tp(n.i,n.x,n.y),d=new tp(s.i,s.x,s.y),_=n.next,C=s.prev;return n.next=s,s.prev=n,l.next=_,_.prev=l,d.next=l,l.prev=d,C.next=d,d.prev=C,d}function Rp(n,s,l,d){var _=new tp(n,s,l);return d?(_.next=d.next,_.prev=d,d.next.prev=_,d.next=_):(_.prev=_,_.next=_),_}function Su(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function tp(n,s,l){this.i=n,this.x=s,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function of(n,s,l,d){for(var _=0,C=s,A=l-d;C<l;C+=d)_+=(n[A]-n[C])*(n[C+1]+n[A+1]),A=C;return _}function hd(n,s,l,d,_){(function C(A,L,z,W,q){for(;W>z;){if(W-z>600){var J=W-z+1,se=L-z+1,de=Math.log(J),Be=.5*Math.exp(2*de/3),Ve=.5*Math.sqrt(de*Be*(J-Be)/J)*(se-J/2<0?-1:1);C(A,L,Math.max(z,Math.floor(L-se*Be/J+Ve)),Math.min(W,Math.floor(L+(J-se)*Be/J+Ve)),q)}var at=A[L],$e=z,Et=W;for(ih(A,z,L),q(A[W],at)>0&&ih(A,z,W);$e<Et;){for(ih(A,$e,Et),$e++,Et--;q(A[$e],at)<0;)$e++;for(;q(A[Et],at)>0;)Et--}q(A[z],at)===0?ih(A,z,Et):ih(A,++Et,W),Et<=L&&(z=Et+1),L<=Et&&(W=Et-1)}})(n,s,l||0,d||n.length-1,_||yc)}function ih(n,s,l){var d=n[s];n[s]=n[l],n[l]=d}function yc(n,s){return n<s?-1:n>s?1:0}function xh(n,s){var l=n.length;if(l<=1)return[n];for(var d,_,C=[],A=0;A<l;A++){var L=Wn(n[A]);L!==0&&(n[A].area=Math.abs(L),_===void 0&&(_=L<0),_===L<0?(d&&C.push(d),d=[n[A]]):d.push(n[A]))}if(d&&C.push(d),s>1)for(var z=0;z<C.length;z++)C[z].length<=s||(hd(C[z],s,1,C[z].length-1,sf),C[z]=C[z].slice(0,s));return C}function sf(n,s){return s.area-n.area}function uf(n,s,l){for(var d=l.patternDependencies,_=!1,C=0,A=s;C<A.length;C+=1){var L=A[C].paint.get(n+"-pattern");L.isConstant()||(_=!0);var z=L.constantOr(null);z&&(_=!0,d[z.to]=!0,d[z.from]=!0)}return _}function Op(n,s,l,d,_){for(var C=_.patternDependencies,A=0,L=s;A<L.length;A+=1){var z=L[A],W=z.paint.get(n+"-pattern").value;if(W.kind!=="constant"){var q=W.evaluate({zoom:d-1},l,{},_.availableImages),J=W.evaluate({zoom:d},l,{},_.availableImages),se=W.evaluate({zoom:d+1},l,{},_.availableImages);J=J&&J.name?J.name:J,se=se&&se.name?se.name:se,C[q=q&&q.name?q.name:q]=!0,C[J]=!0,C[se]=!0,l.patterns[z.id]={min:q,mid:J,max:se}}}return l}cd.deviation=function(n,s,l,d){var _=s&&s.length,C=Math.abs(of(n,0,_?s[0]*l:n.length,l));if(_)for(var A=0,L=s.length;A<L;A++)C-=Math.abs(of(n,s[A]*l,A<L-1?s[A+1]*l:n.length,l));var z=0;for(A=0;A<d.length;A+=3){var W=d[A]*l,q=d[A+1]*l,J=d[A+2]*l;z+=Math.abs((n[W]-n[J])*(n[q+1]-n[W+1])-(n[W]-n[q])*(n[J+1]-n[W+1]))}return C===0&&z===0?0:Math.abs((z-C)/C)},cd.flatten=function(n){for(var s=n[0][0].length,l={vertices:[],holes:[],dimensions:s},d=0,_=0;_<n.length;_++){for(var C=0;C<n[_].length;C++)for(var A=0;A<s;A++)l.vertices.push(n[_][C][A]);_>0&&l.holes.push(d+=n[_-1].length)}return l},Ur.default=Rf;var Du=function(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Af,this.indexArray=new dc,this.indexArray2=new hu,this.programConfigurations=new Si(n.layers,n.zoom),this.segments=new le,this.segments2=new le,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};Du.prototype.populate=function(n,s,l){this.hasPattern=uf("fill",this.layers,s);for(var d=this.layers[0].layout.get("fill-sort-key"),_=[],C=0,A=n;C<A.length;C+=1){var L=A[C],z=L.feature,W=L.id,q=L.index,J=L.sourceLayerIndex,se=this.layers[0]._featureFilter.needGeometry,de=lo(z,se);if(this.layers[0]._featureFilter.filter(new aa(this.zoom),de,l)){var Be=d?d.evaluate(de,{},l,s.availableImages):void 0,Ve={id:W,properties:z.properties,type:z.type,sourceLayerIndex:J,index:q,geometry:se?de.geometry:vo(z),patterns:{},sortKey:Be};_.push(Ve)}}d&&_.sort(function(Yr,Sn){return Yr.sortKey-Sn.sortKey});for(var at=0,$e=_;at<$e.length;at+=1){var Et=$e[at],Rt=Et.geometry,Jt=Et.index,$t=Et.sourceLayerIndex;if(this.hasPattern){var Cr=Op("fill",this.layers,Et,this.zoom,s);this.patternFeatures.push(Cr)}else this.addFeature(Et,Rt,Jt,l,{});s.featureIndex.insert(n[Jt].feature,Rt,Jt,$t,this.index)}},Du.prototype.update=function(n,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,l)},Du.prototype.addFeatures=function(n,s,l){for(var d=0,_=this.patternFeatures;d<_.length;d+=1){var C=_[d];this.addFeature(C,C.geometry,C.index,s,l)}},Du.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Du.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Du.prototype.upload=function(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,ee),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0},Du.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Du.prototype.addFeature=function(n,s,l,d,_){for(var C=0,A=xh(s,500);C<A.length;C+=1){for(var L=A[C],z=0,W=0,q=L;W<q.length;W+=1)z+=q[W].length;for(var J=this.segments.prepareSegment(z,this.layoutVertexArray,this.indexArray),se=J.vertexLength,de=[],Be=[],Ve=0,at=L;Ve<at.length;Ve+=1){var $e=at[Ve];if($e.length!==0){$e!==L[0]&&Be.push(de.length/2);var Et=this.segments2.prepareSegment($e.length,this.layoutVertexArray,this.indexArray2),Rt=Et.vertexLength;this.layoutVertexArray.emplaceBack($e[0].x,$e[0].y),this.indexArray2.emplaceBack(Rt+$e.length-1,Rt),de.push($e[0].x),de.push($e[0].y);for(var Jt=1;Jt<$e.length;Jt++)this.layoutVertexArray.emplaceBack($e[Jt].x,$e[Jt].y),this.indexArray2.emplaceBack(Rt+Jt-1,Rt+Jt),de.push($e[Jt].x),de.push($e[Jt].y);Et.vertexLength+=$e.length,Et.primitiveLength+=$e.length}}for(var $t=Ur(de,Be),Cr=0;Cr<$t.length;Cr+=3)this.indexArray.emplaceBack(se+$t[Cr],se+$t[Cr+1],se+$t[Cr+2]);J.vertexLength+=z,J.primitiveLength+=$t.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,_,d)},tn("FillBucket",Du,{omit:["layers","patternFeatures"]});var Fc=new Yo({"fill-sort-key":new ti(_e.layout_fill["fill-sort-key"])}),Bu={paint:new Yo({"fill-antialias":new ci(_e.paint_fill["fill-antialias"]),"fill-opacity":new ti(_e.paint_fill["fill-opacity"]),"fill-color":new ti(_e.paint_fill["fill-color"]),"fill-outline-color":new ti(_e.paint_fill["fill-outline-color"]),"fill-translate":new ci(_e.paint_fill["fill-translate"]),"fill-translate-anchor":new ci(_e.paint_fill["fill-translate-anchor"]),"fill-pattern":new mh(_e.paint_fill["fill-pattern"])}),layout:Fc},Fp=function(n){function s(l){n.call(this,l,Bu)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.recalculate=function(l,d){n.prototype.recalculate.call(this,l,d);var _=this.paint._values["fill-outline-color"];_.value.kind==="constant"&&_.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},s.prototype.createBucket=function(l){return new Du(l)},s.prototype.queryRadius=function(){return ls(this.paint.get("fill-translate"))},s.prototype.queryIntersectsFeature=function(l,d,_,C,A,L,z){return Xu(Pl(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),L.angle,z),C)},s.prototype.isTileClipped=function(){return!0},s}(Tl),Df=io([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Dp=Ql;function Ql(n,s,l,d,_){this.properties={},this.extent=l,this.type=0,this._pbf=n,this._geometry=-1,this._keys=d,this._values=_,n.readFields(bh,this,s)}function bh(n,s,l){n==1?s.id=l.readVarint():n==2?function(d,_){for(var C=d.readVarint()+d.pos;d.pos<C;){var A=_._keys[d.readVarint()],L=_._values[d.readVarint()];_.properties[A]=L}}(l,s):n==3?s.type=l.readVarint():n==4&&(s._geometry=l.pos)}function Bd(n){for(var s,l,d=0,_=0,C=n.length,A=C-1;_<C;A=_++)d+=((l=n[A]).x-(s=n[_]).x)*(s.y+l.y);return d}Ql.types=["Unknown","Point","LineString","Polygon"],Ql.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var s,l=n.readVarint()+n.pos,d=1,_=0,C=0,A=0,L=[];n.pos<l;){if(_<=0){var z=n.readVarint();d=7&z,_=z>>3}if(_--,d===1||d===2)C+=n.readSVarint(),A+=n.readSVarint(),d===1&&(s&&L.push(s),s=[]),s.push(new rt(C,A));else{if(d!==7)throw new Error("unknown command "+d);s&&s.push(s[0].clone())}}return s&&L.push(s),L},Ql.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var s=n.readVarint()+n.pos,l=1,d=0,_=0,C=0,A=1/0,L=-1/0,z=1/0,W=-1/0;n.pos<s;){if(d<=0){var q=n.readVarint();l=7&q,d=q>>3}if(d--,l===1||l===2)(_+=n.readSVarint())<A&&(A=_),_>L&&(L=_),(C+=n.readSVarint())<z&&(z=C),C>W&&(W=C);else if(l!==7)throw new Error("unknown command "+l)}return[A,z,L,W]},Ql.prototype.toGeoJSON=function(n,s,l){var d,_,C=this.extent*Math.pow(2,l),A=this.extent*n,L=this.extent*s,z=this.loadGeometry(),W=Ql.types[this.type];function q(de){for(var Be=0;Be<de.length;Be++){var Ve=de[Be];de[Be]=[360*(Ve.x+A)/C-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ve.y+L)/C)*Math.PI/180))-90]}}switch(this.type){case 1:var J=[];for(d=0;d<z.length;d++)J[d]=z[d][0];q(z=J);break;case 2:for(d=0;d<z.length;d++)q(z[d]);break;case 3:for(z=function(de){var Be=de.length;if(Be<=1)return[de];for(var Ve,at,$e=[],Et=0;Et<Be;Et++){var Rt=Bd(de[Et]);Rt!==0&&(at===void 0&&(at=Rt<0),at===Rt<0?(Ve&&$e.push(Ve),Ve=[de[Et]]):Ve.push(de[Et]))}return Ve&&$e.push(Ve),$e}(z),d=0;d<z.length;d++)for(_=0;_<z[d].length;_++)q(z[d][_])}z.length===1?z=z[0]:W="Multi"+W;var se={type:"Feature",geometry:{type:W,coordinates:z},properties:this.properties};return"id"in this&&(se.id=this.id),se};var Bf=pd;function pd(n,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(Jl,this,s),this.length=this._features.length}function Jl(n,s,l){n===15?s.version=l.readVarint():n===1?s.name=l.readString():n===5?s.extent=l.readVarint():n===2?s._features.push(l.pos):n===3?s._keys.push(l.readString()):n===4&&s._values.push(function(d){for(var _=null,C=d.readVarint()+d.pos;d.pos<C;){var A=d.readVarint()>>3;_=A===1?d.readString():A===2?d.readFloat():A===3?d.readDouble():A===4?d.readVarint64():A===5?d.readVarint():A===6?d.readSVarint():A===7?d.readBoolean():null}return _}(l))}function cl(n,s,l){if(n===3){var d=new Bf(l,l.readVarint()+l.pos);d.length&&(s[d.name]=d)}}pd.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var s=this._pbf.readVarint()+this._pbf.pos;return new Dp(this._pbf,s,this.extent,this._keys,this._values)};var Nu={VectorTile:function(n,s){this.layers=n.readFields(cl,{},s)},VectorTileFeature:Dp,VectorTileLayer:Bf},Dc=Nu.VectorTileFeature.types,lf=Math.pow(2,13);function Eh(n,s,l,d,_,C,A,L){n.emplaceBack(s,l,2*Math.floor(d*lf)+A,_*lf*2,C*lf*2,Math.round(L))}var Bc=function(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new kl,this.indexArray=new dc,this.programConfigurations=new Si(n.layers,n.zoom),this.segments=new le,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function Bp(n,s){return n.x===s.x&&(n.x<0||n.x>8192)||n.y===s.y&&(n.y<0||n.y>8192)}Bc.prototype.populate=function(n,s,l){this.features=[],this.hasPattern=uf("fill-extrusion",this.layers,s);for(var d=0,_=n;d<_.length;d+=1){var C=_[d],A=C.feature,L=C.id,z=C.index,W=C.sourceLayerIndex,q=this.layers[0]._featureFilter.needGeometry,J=lo(A,q);if(this.layers[0]._featureFilter.filter(new aa(this.zoom),J,l)){var se={id:L,sourceLayerIndex:W,index:z,geometry:q?J.geometry:vo(A),properties:A.properties,type:A.type,patterns:{}};this.hasPattern?this.features.push(Op("fill-extrusion",this.layers,se,this.zoom,s)):this.addFeature(se,se.geometry,z,l,{}),s.featureIndex.insert(A,se.geometry,z,W,this.index,!0)}}},Bc.prototype.addFeatures=function(n,s,l){for(var d=0,_=this.features;d<_.length;d+=1){var C=_[d];this.addFeature(C,C.geometry,C.index,s,l)}},Bc.prototype.update=function(n,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,l)},Bc.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Bc.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Bc.prototype.upload=function(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Df),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0},Bc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Bc.prototype.addFeature=function(n,s,l,d,_){for(var C=0,A=xh(s,500);C<A.length;C+=1){for(var L=A[C],z=0,W=0,q=L;W<q.length;W+=1)z+=q[W].length;for(var J=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),se=0,de=L;se<de.length;se+=1){var Be=de[se];if(Be.length!==0&&!((vr=Be).every(function(ra){return ra.x<0})||vr.every(function(ra){return ra.x>8192})||vr.every(function(ra){return ra.y<0})||vr.every(function(ra){return ra.y>8192})))for(var Ve=0,at=0;at<Be.length;at++){var $e=Be[at];if(at>=1){var Et=Be[at-1];if(!Bp($e,Et)){J.vertexLength+4>le.MAX_VERTEX_ARRAY_LENGTH&&(J=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Rt=$e.sub(Et)._perp()._unit(),Jt=Et.dist($e);Ve+Jt>32768&&(Ve=0),Eh(this.layoutVertexArray,$e.x,$e.y,Rt.x,Rt.y,0,0,Ve),Eh(this.layoutVertexArray,$e.x,$e.y,Rt.x,Rt.y,0,1,Ve),Eh(this.layoutVertexArray,Et.x,Et.y,Rt.x,Rt.y,0,0,Ve+=Jt),Eh(this.layoutVertexArray,Et.x,Et.y,Rt.x,Rt.y,0,1,Ve);var $t=J.vertexLength;this.indexArray.emplaceBack($t,$t+2,$t+1),this.indexArray.emplaceBack($t+1,$t+2,$t+3),J.vertexLength+=4,J.primitiveLength+=2}}}}if(J.vertexLength+z>le.MAX_VERTEX_ARRAY_LENGTH&&(J=this.segments.prepareSegment(z,this.layoutVertexArray,this.indexArray)),Dc[n.type]==="Polygon"){for(var Cr=[],Yr=[],Sn=J.vertexLength,yi=0,Zn=L;yi<Zn.length;yi+=1){var bi=Zn[yi];if(bi.length!==0){bi!==L[0]&&Yr.push(Cr.length/2);for(var Nn=0;Nn<bi.length;Nn++){var la=bi[Nn];Eh(this.layoutVertexArray,la.x,la.y,0,0,1,1,0),Cr.push(la.x),Cr.push(la.y)}}}for(var Mi=Ur(Cr,Yr),li=0;li<Mi.length;li+=3)this.indexArray.emplaceBack(Sn+Mi[li],Sn+Mi[li+2],Sn+Mi[li+1]);J.primitiveLength+=Mi.length/3,J.vertexLength+=z}}var vr;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,_,d)},tn("FillExtrusionBucket",Bc,{omit:["layers","features"]});var Nd={paint:new Yo({"fill-extrusion-opacity":new ci(_e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ti(_e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ci(_e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ci(_e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new mh(_e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ti(_e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ti(_e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ci(_e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Nc=function(n){function s(l){n.call(this,l,Nd)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.createBucket=function(l){return new Bc(l)},s.prototype.queryRadius=function(){return ls(this.paint.get("fill-extrusion-translate"))},s.prototype.is3D=function(){return!0},s.prototype.queryIntersectsFeature=function(l,d,_,C,A,L,z,W){var q=Pl(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),L.angle,z),J=this.paint.get("fill-extrusion-height").evaluate(d,_),se=this.paint.get("fill-extrusion-base").evaluate(d,_),de=function(Ve,at,$e,Et){for(var Rt=[],Jt=0,$t=Ve;Jt<$t.length;Jt+=1){var Cr=$t[Jt],Yr=[Cr.x,Cr.y,0,1];$h(Yr,Yr,at),Rt.push(new rt(Yr[0]/Yr[3],Yr[1]/Yr[3]))}return Rt}(q,W),Be=function(Ve,at,$e,Et){for(var Rt=[],Jt=[],$t=Et[8]*at,Cr=Et[9]*at,Yr=Et[10]*at,Sn=Et[11]*at,yi=Et[8]*$e,Zn=Et[9]*$e,bi=Et[10]*$e,Nn=Et[11]*$e,la=0,Mi=Ve;la<Mi.length;la+=1){for(var li=[],vr=[],ra=0,At=Mi[la];ra<At.length;ra+=1){var Ei=At[ra],Wa=Ei.x,jo=Ei.y,fs=Et[0]*Wa+Et[4]*jo+Et[12],ns=Et[1]*Wa+Et[5]*jo+Et[13],mo=Et[2]*Wa+Et[6]*jo+Et[14],xs=Et[3]*Wa+Et[7]*jo+Et[15],ou=mo+Yr,$s=xs+Sn,zu=fs+yi,hs=ns+Zn,Au=mo+bi,bs=xs+Nn,su=new rt((fs+$t)/$s,(ns+Cr)/$s);su.z=ou/$s,li.push(su);var wa=new rt(zu/bs,hs/bs);wa.z=Au/bs,vr.push(wa)}Rt.push(li),Jt.push(vr)}return[Rt,Jt]}(C,se,J,W);return function(Ve,at,$e){var Et=1/0;Xu($e,at)&&(Et=ah($e,at[0]));for(var Rt=0;Rt<at.length;Rt++)for(var Jt=at[Rt],$t=Ve[Rt],Cr=0;Cr<Jt.length-1;Cr++){var Yr=Jt[Cr],Sn=[Yr,Jt[Cr+1],$t[Cr+1],$t[Cr],Yr];Xl($e,Sn)&&(Et=Math.min(Et,ah($e,Sn)))}return Et!==1/0&&Et}(Be[0],Be[1],de)},s}(Tl);function Ch(n,s){return n.x*s.x+n.y*s.y}function ah(n,s){if(n.length===1){for(var l,d=0,_=s[d++];!l||_.equals(l);)if(!(l=s[d++]))return 1/0;for(;d<s.length;d++){var C=s[d],A=n[0],L=l.sub(_),z=C.sub(_),W=A.sub(_),q=Ch(L,L),J=Ch(L,z),se=Ch(z,z),de=Ch(W,L),Be=Ch(W,z),Ve=q*se-J*J,at=(se*de-J*Be)/Ve,$e=(q*Be-J*de)/Ve,Et=_.z*(1-at-$e)+l.z*at+C.z*$e;if(isFinite(Et))return Et}return 1/0}for(var Rt=1/0,Jt=0,$t=s;Jt<$t.length;Jt+=1)Rt=Math.min(Rt,$t[Jt].z);return Rt}var Nf=io([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,zd=io([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,fl=Nu.VectorTileFeature.types,Sh=Math.cos(Math.PI/180*37.5),Ud=Math.pow(2,14)/.5,$a=function(n){var s=this;this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(l){return l.id}),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(l){s.gradients[l.id]={}}),this.layoutVertexArray=new za,this.layoutVertexArray2=new Il,this.indexArray=new dc,this.programConfigurations=new Si(n.layers,n.zoom),this.segments=new le,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(l){return l.isStateDependent()}).map(function(l){return l.id})};$a.prototype.populate=function(n,s,l){this.hasPattern=uf("line",this.layers,s);for(var d=this.layers[0].layout.get("line-sort-key"),_=[],C=0,A=n;C<A.length;C+=1){var L=A[C],z=L.feature,W=L.id,q=L.index,J=L.sourceLayerIndex,se=this.layers[0]._featureFilter.needGeometry,de=lo(z,se);if(this.layers[0]._featureFilter.filter(new aa(this.zoom),de,l)){var Be=d?d.evaluate(de,{},l):void 0,Ve={id:W,properties:z.properties,type:z.type,sourceLayerIndex:J,index:q,geometry:se?de.geometry:vo(z),patterns:{},sortKey:Be};_.push(Ve)}}d&&_.sort(function(Yr,Sn){return Yr.sortKey-Sn.sortKey});for(var at=0,$e=_;at<$e.length;at+=1){var Et=$e[at],Rt=Et.geometry,Jt=Et.index,$t=Et.sourceLayerIndex;if(this.hasPattern){var Cr=Op("line",this.layers,Et,this.zoom,s);this.patternFeatures.push(Cr)}else this.addFeature(Et,Rt,Jt,l,{});s.featureIndex.insert(n[Jt].feature,Rt,Jt,$t,this.index)}},$a.prototype.update=function(n,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,l)},$a.prototype.addFeatures=function(n,s,l){for(var d=0,_=this.patternFeatures;d<_.length;d+=1){var C=_[d];this.addFeature(C,C.geometry,C.index,s,l)}},$a.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},$a.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},$a.prototype.upload=function(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,zd)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Nf),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0},$a.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},$a.prototype.lineFeatureClips=function(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}},$a.prototype.addFeature=function(n,s,l,d,_){var C=this.layers[0].layout,A=C.get("line-join").evaluate(n,{}),L=C.get("line-cap"),z=C.get("line-miter-limit"),W=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(var q=0,J=s;q<J.length;q+=1)this.addLine(J[q],n,A,L,z,W);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,_,d)},$a.prototype.addLine=function(n,s,l,d,_,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var A=0;A<n.length-1;A++)this.totalDistance+=n[A].dist(n[A+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var L=fl[s.type]==="Polygon",z=n.length;z>=2&&n[z-1].equals(n[z-2]);)z--;for(var W=0;W<z-1&&n[W].equals(n[W+1]);)W++;if(!(z<(L?3:2))){l==="bevel"&&(_=1.05);var q,J=this.overscaling<=16?122880/(512*this.overscaling):0,se=this.segments.prepareSegment(10*z,this.layoutVertexArray,this.indexArray),de=void 0,Be=void 0,Ve=void 0,at=void 0;this.e1=this.e2=-1,L&&(at=n[W].sub(q=n[z-2])._unit()._perp());for(var $e=W;$e<z;$e++)if(!(Be=$e===z-1?L?n[W+1]:void 0:n[$e+1])||!n[$e].equals(Be)){at&&(Ve=at),q&&(de=q),q=n[$e],at=Be?Be.sub(q)._unit()._perp():Ve;var Et=(Ve=Ve||at).add(at);Et.x===0&&Et.y===0||Et._unit();var Rt=Ve.x*at.x+Ve.y*at.y,Jt=Et.x*at.x+Et.y*at.y,$t=Jt!==0?1/Jt:1/0,Cr=2*Math.sqrt(2-2*Jt),Yr=Jt<Sh&&de&&Be,Sn=Ve.x*at.y-Ve.y*at.x>0;if(Yr&&$e>W){var yi=q.dist(de);if(yi>2*J){var Zn=q.sub(q.sub(de)._mult(J/yi)._round());this.updateDistance(de,Zn),this.addCurrentVertex(Zn,Ve,0,0,se),de=Zn}}var bi=de&&Be,Nn=bi?l:L?"butt":d;if(bi&&Nn==="round"&&($t<C?Nn="miter":$t<=2&&(Nn="fakeround")),Nn==="miter"&&$t>_&&(Nn="bevel"),Nn==="bevel"&&($t>2&&(Nn="flipbevel"),$t<_&&(Nn="miter")),de&&this.updateDistance(de,q),Nn==="miter")Et._mult($t),this.addCurrentVertex(q,Et,0,0,se);else if(Nn==="flipbevel"){if($t>100)Et=at.mult(-1);else{var la=$t*Ve.add(at).mag()/Ve.sub(at).mag();Et._perp()._mult(la*(Sn?-1:1))}this.addCurrentVertex(q,Et,0,0,se),this.addCurrentVertex(q,Et.mult(-1),0,0,se)}else if(Nn==="bevel"||Nn==="fakeround"){var Mi=-Math.sqrt($t*$t-1),li=Sn?Mi:0,vr=Sn?0:Mi;if(de&&this.addCurrentVertex(q,Ve,li,vr,se),Nn==="fakeround")for(var ra=Math.round(180*Cr/Math.PI/20),At=1;At<ra;At++){var Ei=At/ra;if(Ei!==.5){var Wa=Ei-.5;Ei+=Ei*Wa*(Ei-1)*((1.0904+Rt*(Rt*(3.55645-1.43519*Rt)-3.2452))*Wa*Wa+(.848013+Rt*(.215638*Rt-1.06021)))}var jo=at.sub(Ve)._mult(Ei)._add(Ve)._unit()._mult(Sn?-1:1);this.addHalfVertex(q,jo.x,jo.y,!1,Sn,0,se)}Be&&this.addCurrentVertex(q,at,-li,-vr,se)}else if(Nn==="butt")this.addCurrentVertex(q,Et,0,0,se);else if(Nn==="square"){var fs=de?1:-1;this.addCurrentVertex(q,Et,fs,fs,se)}else Nn==="round"&&(de&&(this.addCurrentVertex(q,Ve,0,0,se),this.addCurrentVertex(q,Ve,1,1,se,!0)),Be&&(this.addCurrentVertex(q,at,-1,-1,se,!0),this.addCurrentVertex(q,at,0,0,se)));if(Yr&&$e<z-1){var ns=q.dist(Be);if(ns>2*J){var mo=q.add(Be.sub(q)._mult(J/ns)._round());this.updateDistance(q,mo),this.addCurrentVertex(mo,at,0,0,se),q=mo}}}}},$a.prototype.addCurrentVertex=function(n,s,l,d,_,C){C===void 0&&(C=!1);var A=s.y*d-s.x,L=-s.y-s.x*d;this.addHalfVertex(n,s.x+s.y*l,s.y-s.x*l,C,!1,l,_),this.addHalfVertex(n,A,L,C,!0,-d,_),this.distance>Ud/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(n,s,l,d,_,C))},$a.prototype.addHalfVertex=function(n,s,l,d,_,C,A){var L=.5*(this.lineClips?this.scaledDistance*(Ud-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n.x<<1)+(d?1:0),(n.y<<1)+(_?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(C===0?0:C<0?-1:1)|(63&L)<<2,L>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var z=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,z),A.primitiveLength++),_?this.e2=z:this.e1=z},$a.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},$a.prototype.updateDistance=function(n,s){this.distance+=n.dist(s),this.updateScaledDistance()},tn("LineBucket",$a,{omit:["layers","patternFeatures"]});var wu=new Yo({"line-cap":new ci(_e.layout_line["line-cap"]),"line-join":new ti(_e.layout_line["line-join"]),"line-miter-limit":new ci(_e.layout_line["line-miter-limit"]),"line-round-limit":new ci(_e.layout_line["line-round-limit"]),"line-sort-key":new ti(_e.layout_line["line-sort-key"])}),Fo={paint:new Yo({"line-opacity":new ti(_e.paint_line["line-opacity"]),"line-color":new ti(_e.paint_line["line-color"]),"line-translate":new ci(_e.paint_line["line-translate"]),"line-translate-anchor":new ci(_e.paint_line["line-translate-anchor"]),"line-width":new ti(_e.paint_line["line-width"]),"line-gap-width":new ti(_e.paint_line["line-gap-width"]),"line-offset":new ti(_e.paint_line["line-offset"]),"line-blur":new ti(_e.paint_line["line-blur"]),"line-dasharray":new Fs(_e.paint_line["line-dasharray"]),"line-pattern":new mh(_e.paint_line["line-pattern"]),"line-gradient":new Ru(_e.paint_line["line-gradient"])}),layout:wu},Ms=new(function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(l,d){return d=new aa(Math.floor(d.zoom),{now:d.now,fadeDuration:d.fadeDuration,zoomHistory:d.zoomHistory,transition:d.transition}),n.prototype.possiblyEvaluate.call(this,l,d)},s.prototype.evaluate=function(l,d,_,C){return d=Ir({},d,{zoom:Math.floor(d.zoom)}),n.prototype.evaluate.call(this,l,d,_,C)},s}(ti))(Fo.paint.properties["line-width"].specification);Ms.useIntegerZoom=!0;var Zd=function(n){function s(l){n.call(this,l,Fo),this.gradientVersion=0}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._handleSpecialPaintPropertyUpdate=function(l){l==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Zo,this.gradientVersion=(this.gradientVersion+1)%Kt)},s.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},s.prototype.recalculate=function(l,d){n.prototype.recalculate.call(this,l,d),this.paint._values["line-floorwidth"]=Ms.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)},s.prototype.createBucket=function(l){return new $a(l)},s.prototype.queryRadius=function(l){var d=l,_=dd(ql("line-width",this,d),ql("line-gap-width",this,d)),C=ql("line-offset",this,d);return _/2+Math.abs(C)+ls(this.paint.get("line-translate"))},s.prototype.queryIntersectsFeature=function(l,d,_,C,A,L,z){var W=Pl(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),L.angle,z),q=z/2*dd(this.paint.get("line-width").evaluate(d,_),this.paint.get("line-gap-width").evaluate(d,_)),J=this.paint.get("line-offset").evaluate(d,_);return J&&(C=function(se,de){for(var Be=[],Ve=new rt(0,0),at=0;at<se.length;at++){for(var $e=se[at],Et=[],Rt=0;Rt<$e.length;Rt++){var Jt=$e[Rt],$t=$e[Rt+1],Cr=Rt===0?Ve:Jt.sub($e[Rt-1])._unit()._perp(),Yr=Rt===$e.length-1?Ve:$t.sub(Jt)._unit()._perp(),Sn=Cr._add(Yr)._unit();Sn._mult(1/(Sn.x*Yr.x+Sn.y*Yr.y)),Et.push(Sn._mult(de)._add(Jt))}Be.push(Et)}return Be}(C,J*z)),function(se,de,Be){for(var Ve=0;Ve<de.length;Ve++){var at=de[Ve];if(se.length>=3){for(var $e=0;$e<at.length;$e++)if(ul(se,at[$e]))return!0}if(eu(se,at,Be))return!0}return!1}(W,C,q)},s.prototype.isTileClipped=function(){return!0},s}(Tl);function dd(n,s){return s>0?s+2*n:n}var a0=io([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Vd=io([{name:"a_projected_pos",components:3,type:"Float32"}],4),jd=(io([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),io([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),wh=(io([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),io([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),o0=io([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function s0(n,s,l){return n.sections.forEach(function(d){d.text=function(_,C,A){var L=C.layout.get("text-transform").evaluate(A,{});return L==="uppercase"?_=_.toLocaleUpperCase():L==="lowercase"&&(_=_.toLocaleLowerCase()),Os.applyArabicShaping&&(_=Os.applyArabicShaping(_)),_}(d.text,s,l)}),n}io([{name:"triangle",components:3,type:"Uint16"}]),io([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),io([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),io([{type:"Float32",name:"offsetX"}]),io([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var rp={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},F0=function(n,s,l,d,_){var C,A,L=8*_-d-1,z=(1<<L)-1,W=z>>1,q=-7,J=l?_-1:0,se=l?-1:1,de=n[s+J];for(J+=se,C=de&(1<<-q)-1,de>>=-q,q+=L;q>0;C=256*C+n[s+J],J+=se,q-=8);for(A=C&(1<<-q)-1,C>>=-q,q+=d;q>0;A=256*A+n[s+J],J+=se,q-=8);if(C===0)C=1-W;else{if(C===z)return A?NaN:1/0*(de?-1:1);A+=Math.pow(2,d),C-=W}return(de?-1:1)*A*Math.pow(2,C-d)},u0=function(n,s,l,d,_,C){var A,L,z,W=8*C-_-1,q=(1<<W)-1,J=q>>1,se=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,de=d?0:C-1,Be=d?1:-1,Ve=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(L=isNaN(s)?1:0,A=q):(A=Math.floor(Math.log(s)/Math.LN2),s*(z=Math.pow(2,-A))<1&&(A--,z*=2),(s+=A+J>=1?se/z:se*Math.pow(2,1-J))*z>=2&&(A++,z/=2),A+J>=q?(L=0,A=q):A+J>=1?(L=(s*z-1)*Math.pow(2,_),A+=J):(L=s*Math.pow(2,J-1)*Math.pow(2,_),A=0));_>=8;n[l+de]=255&L,de+=Be,L/=256,_-=8);for(A=A<<_|L,W+=_;W>0;n[l+de]=255&A,de+=Be,A/=256,W-=8);n[l+de-Be]|=128*Ve},zf=Eo;function Eo(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Eo.Varint=0,Eo.Fixed64=1,Eo.Bytes=2,Eo.Fixed32=5;var vd=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function cf(n){return n.type===Eo.Bytes?n.readVarint()+n.pos:n.pos+1}function Ah(n,s,l){return l?4294967296*s+(n>>>0):4294967296*(s>>>0)+(n>>>0)}function Gd(n,s,l){var d=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));l.realloc(d);for(var _=l.pos-1;_>=n;_--)l.buf[_+d]=l.buf[_]}function Np(n,s){for(var l=0;l<n.length;l++)s.writeVarint(n[l])}function H(n,s){for(var l=0;l<n.length;l++)s.writeSVarint(n[l])}function Se(n,s){for(var l=0;l<n.length;l++)s.writeFloat(n[l])}function He(n,s){for(var l=0;l<n.length;l++)s.writeDouble(n[l])}function Ht(n,s){for(var l=0;l<n.length;l++)s.writeBoolean(n[l])}function Er(n,s){for(var l=0;l<n.length;l++)s.writeFixed32(n[l])}function Vt(n,s){for(var l=0;l<n.length;l++)s.writeSFixed32(n[l])}function sr(n,s){for(var l=0;l<n.length;l++)s.writeFixed64(n[l])}function kr(n,s){for(var l=0;l<n.length;l++)s.writeSFixed64(n[l])}function Dr(n,s){return(n[s]|n[s+1]<<8|n[s+2]<<16)+16777216*n[s+3]}function jr(n,s,l){n[l]=s,n[l+1]=s>>>8,n[l+2]=s>>>16,n[l+3]=s>>>24}function qr(n,s){return(n[s]|n[s+1]<<8|n[s+2]<<16)+(n[s+3]<<24)}function $r(n,s,l){n===1&&l.readMessage(gn,s)}function gn(n,s,l){if(n===3){var d=l.readMessage(Zr,{}),_=d.width,C=d.height,A=d.left,L=d.top,z=d.advance;s.push({id:d.id,bitmap:new $l({width:_+6,height:C+6},d.bitmap),metrics:{width:_,height:C,left:A,top:L,advance:z}})}}function Zr(n,s,l){n===1?s.id=l.readVarint():n===2?s.bitmap=l.readBytes():n===3?s.width=l.readVarint():n===4?s.height=l.readVarint():n===5?s.left=l.readSVarint():n===6?s.top=l.readSVarint():n===7&&(s.advance=l.readVarint())}function Xr(n){for(var s=0,l=0,d=0,_=n;d<_.length;d+=1){var C=_[d];s+=C.w*C.h,l=Math.max(l,C.w)}n.sort(function(Ve,at){return at.h-Ve.h});for(var A=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),l),h:1/0}],L=0,z=0,W=0,q=n;W<q.length;W+=1)for(var J=q[W],se=A.length-1;se>=0;se--){var de=A[se];if(!(J.w>de.w||J.h>de.h)){if(J.x=de.x,J.y=de.y,z=Math.max(z,J.y+J.h),L=Math.max(L,J.x+J.w),J.w===de.w&&J.h===de.h){var Be=A.pop();se<A.length&&(A[se]=Be)}else J.h===de.h?(de.x+=J.w,de.w-=J.w):J.w===de.w?(de.y+=J.h,de.h-=J.h):(A.push({x:de.x+J.w,y:de.y,w:de.w-J.w,h:J.h}),de.y+=J.h,de.h-=J.h);break}}return{w:L,h:z,fill:s/(L*z)||0}}Eo.prototype={destroy:function(){this.buf=null},readFields:function(n,s,l){for(l=l||this.length;this.pos<l;){var d=this.readVarint(),_=d>>3,C=this.pos;this.type=7&d,n(_,s,this),this.pos===C&&this.skip(d)}return s},readMessage:function(n,s){return this.readFields(n,s,this.readVarint()+this.pos)},readFixed32:function(){var n=Dr(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=qr(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=Dr(this.buf,this.pos)+4294967296*Dr(this.buf,this.pos+4);return this.pos+=8,n},readSFixed64:function(){var n=Dr(this.buf,this.pos)+4294967296*qr(this.buf,this.pos+4);return this.pos+=8,n},readFloat:function(){var n=F0(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=F0(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var s,l,d=this.buf;return s=127&(l=d[this.pos++]),l<128?s:(s|=(127&(l=d[this.pos++]))<<7,l<128?s:(s|=(127&(l=d[this.pos++]))<<14,l<128?s:(s|=(127&(l=d[this.pos++]))<<21,l<128?s:function(_,C,A){var L,z,W=A.buf;if(L=(112&(z=W[A.pos++]))>>4,z<128||(L|=(127&(z=W[A.pos++]))<<3,z<128)||(L|=(127&(z=W[A.pos++]))<<10,z<128)||(L|=(127&(z=W[A.pos++]))<<17,z<128)||(L|=(127&(z=W[A.pos++]))<<24,z<128)||(L|=(1&(z=W[A.pos++]))<<31,z<128))return Ah(_,L,C);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(l=d[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,s=this.pos;return this.pos=n,n-s>=12&&vd?function(l,d,_){return vd.decode(l.subarray(d,_))}(this.buf,s,n):function(l,d,_){for(var C="",A=d;A<_;){var L,z,W,q=l[A],J=null,se=q>239?4:q>223?3:q>191?2:1;if(A+se>_)break;se===1?q<128&&(J=q):se===2?(192&(L=l[A+1]))==128&&(J=(31&q)<<6|63&L)<=127&&(J=null):se===3?(z=l[A+2],(192&(L=l[A+1]))==128&&(192&z)==128&&((J=(15&q)<<12|(63&L)<<6|63&z)<=2047||J>=55296&&J<=57343)&&(J=null)):se===4&&(z=l[A+2],W=l[A+3],(192&(L=l[A+1]))==128&&(192&z)==128&&(192&W)==128&&((J=(15&q)<<18|(63&L)<<12|(63&z)<<6|63&W)<=65535||J>=1114112)&&(J=null)),J===null?(J=65533,se=1):J>65535&&(J-=65536,C+=String.fromCharCode(J>>>10&1023|55296),J=56320|1023&J),C+=String.fromCharCode(J),A+=se}return C}(this.buf,s,n)},readBytes:function(){var n=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,n);return this.pos=n,s},readPackedVarint:function(n,s){if(this.type!==Eo.Bytes)return n.push(this.readVarint(s));var l=cf(this);for(n=n||[];this.pos<l;)n.push(this.readVarint(s));return n},readPackedSVarint:function(n){if(this.type!==Eo.Bytes)return n.push(this.readSVarint());var s=cf(this);for(n=n||[];this.pos<s;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Eo.Bytes)return n.push(this.readBoolean());var s=cf(this);for(n=n||[];this.pos<s;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Eo.Bytes)return n.push(this.readFloat());var s=cf(this);for(n=n||[];this.pos<s;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Eo.Bytes)return n.push(this.readDouble());var s=cf(this);for(n=n||[];this.pos<s;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Eo.Bytes)return n.push(this.readFixed32());var s=cf(this);for(n=n||[];this.pos<s;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Eo.Bytes)return n.push(this.readSFixed32());var s=cf(this);for(n=n||[];this.pos<s;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Eo.Bytes)return n.push(this.readFixed64());var s=cf(this);for(n=n||[];this.pos<s;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Eo.Bytes)return n.push(this.readSFixed64());var s=cf(this);for(n=n||[];this.pos<s;)n.push(this.readSFixed64());return n},skip:function(n){var s=7&n;if(s===Eo.Varint)for(;this.buf[this.pos++]>127;);else if(s===Eo.Bytes)this.pos=this.readVarint()+this.pos;else if(s===Eo.Fixed32)this.pos+=4;else{if(s!==Eo.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(n,s){this.writeVarint(n<<3|s)},realloc:function(n){for(var s=this.length||16;s<this.pos+n;)s*=2;if(s!==this.length){var l=new Uint8Array(s);l.set(this.buf),this.buf=l,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),jr(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),jr(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),jr(this.buf,-1&n,this.pos),jr(this.buf,Math.floor(n*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),jr(this.buf,-1&n,this.pos),jr(this.buf,Math.floor(n*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(s,l){var d,_;if(s>=0?(d=s%4294967296|0,_=s/4294967296|0):(_=~(-s/4294967296),4294967295^(d=~(-s%4294967296))?d=d+1|0:(d=0,_=_+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(C,A,L){L.buf[L.pos++]=127&C|128,C>>>=7,L.buf[L.pos++]=127&C|128,C>>>=7,L.buf[L.pos++]=127&C|128,C>>>=7,L.buf[L.pos++]=127&C|128,L.buf[L.pos]=127&(C>>>=7)}(d,0,l),function(C,A){var L=(7&C)<<4;A.buf[A.pos++]|=L|((C>>>=3)?128:0),C&&(A.buf[A.pos++]=127&C|((C>>>=7)?128:0),C&&(A.buf[A.pos++]=127&C|((C>>>=7)?128:0),C&&(A.buf[A.pos++]=127&C|((C>>>=7)?128:0),C&&(A.buf[A.pos++]=127&C|((C>>>=7)?128:0),C&&(A.buf[A.pos++]=127&C)))))}(_,l)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var s=this.pos;this.pos=function(d,_,C){for(var A,L,z=0;z<_.length;z++){if((A=_.charCodeAt(z))>55295&&A<57344){if(!L){A>56319||z+1===_.length?(d[C++]=239,d[C++]=191,d[C++]=189):L=A;continue}if(A<56320){d[C++]=239,d[C++]=191,d[C++]=189,L=A;continue}A=L-55296<<10|A-56320|65536,L=null}else L&&(d[C++]=239,d[C++]=191,d[C++]=189,L=null);A<128?d[C++]=A:(A<2048?d[C++]=A>>6|192:(A<65536?d[C++]=A>>12|224:(d[C++]=A>>18|240,d[C++]=A>>12&63|128),d[C++]=A>>6&63|128),d[C++]=63&A|128)}return C}(this.buf,n,this.pos);var l=this.pos-s;l>=128&&Gd(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l},writeFloat:function(n){this.realloc(4),u0(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),u0(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var s=n.length;this.writeVarint(s),this.realloc(s);for(var l=0;l<s;l++)this.buf[this.pos++]=n[l]},writeRawMessage:function(n,s){this.pos++;var l=this.pos;n(s,this);var d=this.pos-l;d>=128&&Gd(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d},writeMessage:function(n,s,l){this.writeTag(n,Eo.Bytes),this.writeRawMessage(s,l)},writePackedVarint:function(n,s){s.length&&this.writeMessage(n,Np,s)},writePackedSVarint:function(n,s){s.length&&this.writeMessage(n,H,s)},writePackedBoolean:function(n,s){s.length&&this.writeMessage(n,Ht,s)},writePackedFloat:function(n,s){s.length&&this.writeMessage(n,Se,s)},writePackedDouble:function(n,s){s.length&&this.writeMessage(n,He,s)},writePackedFixed32:function(n,s){s.length&&this.writeMessage(n,Er,s)},writePackedSFixed32:function(n,s){s.length&&this.writeMessage(n,Vt,s)},writePackedFixed64:function(n,s){s.length&&this.writeMessage(n,sr,s)},writePackedSFixed64:function(n,s){s.length&&this.writeMessage(n,kr,s)},writeBytesField:function(n,s){this.writeTag(n,Eo.Bytes),this.writeBytes(s)},writeFixed32Field:function(n,s){this.writeTag(n,Eo.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(n,s){this.writeTag(n,Eo.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(n,s){this.writeTag(n,Eo.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(n,s){this.writeTag(n,Eo.Fixed64),this.writeSFixed64(s)},writeVarintField:function(n,s){this.writeTag(n,Eo.Varint),this.writeVarint(s)},writeSVarintField:function(n,s){this.writeTag(n,Eo.Varint),this.writeSVarint(s)},writeStringField:function(n,s){this.writeTag(n,Eo.Bytes),this.writeString(s)},writeFloatField:function(n,s){this.writeTag(n,Eo.Fixed32),this.writeFloat(s)},writeDoubleField:function(n,s){this.writeTag(n,Eo.Fixed64),this.writeDouble(s)},writeBooleanField:function(n,s){this.writeVarintField(n,Boolean(s))}};var Ct=function(n,s){var l=s.pixelRatio,d=s.version,_=s.stretchX,C=s.stretchY,A=s.content;this.paddedRect=n,this.pixelRatio=l,this.stretchX=_,this.stretchY=C,this.content=A,this.version=d},er={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};er.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},er.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},er.tlbr.get=function(){return this.tl.concat(this.br)},er.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Ct.prototype,er);var Gr=function(n,s){var l={},d={};this.haveRenderCallbacks=[];var _=[];this.addImages(n,l,_),this.addImages(s,d,_);var C=Xr(_),A=new ys({width:C.w||1,height:C.h||1});for(var L in n){var z=n[L],W=l[L].paddedRect;ys.copy(z.data,A,{x:0,y:0},{x:W.x+1,y:W.y+1},z.data)}for(var q in s){var J=s[q],se=d[q].paddedRect,de=se.x+1,Be=se.y+1,Ve=J.data.width,at=J.data.height;ys.copy(J.data,A,{x:0,y:0},{x:de,y:Be},J.data),ys.copy(J.data,A,{x:0,y:at-1},{x:de,y:Be-1},{width:Ve,height:1}),ys.copy(J.data,A,{x:0,y:0},{x:de,y:Be+at},{width:Ve,height:1}),ys.copy(J.data,A,{x:Ve-1,y:0},{x:de-1,y:Be},{width:1,height:at}),ys.copy(J.data,A,{x:0,y:0},{x:de+Ve,y:Be},{width:1,height:at})}this.image=A,this.iconPositions=l,this.patternPositions=d};Gr.prototype.addImages=function(n,s,l){for(var d in n){var _=n[d],C={x:0,y:0,w:_.data.width+2,h:_.data.height+2};l.push(C),s[d]=new Ct(C,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(d)}},Gr.prototype.patchUpdatedImages=function(n,s){for(var l in n.dispatchRenderCallbacks(this.haveRenderCallbacks),n.updatedImages)this.patchUpdatedImage(this.iconPositions[l],n.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],n.getImage(l),s)},Gr.prototype.patchUpdatedImage=function(n,s,l){if(n&&s&&n.version!==s.version){n.version=s.version;var d=n.tl;l.update(s.data,void 0,{x:d[0],y:d[1]})}},tn("ImagePosition",Ct),tn("ImageAtlas",Gr);var fn={horizontal:1,vertical:2,horizontalOnly:3},wr=function(){this.scale=1,this.fontStack="",this.imageName=null};wr.forText=function(n,s){var l=new wr;return l.scale=n||1,l.fontStack=s,l},wr.forImage=function(n){var s=new wr;return s.imageName=n,s};var Kr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Mn(n,s,l,d,_,C,A,L,z,W,q,J,se,de,Be,Ve){var at,$e=Kr.fromFeature(n,_);J===fn.vertical&&$e.verticalizePunctuation();var Et=Os.processBidirectionalText,Rt=Os.processStyledBidirectionalText;if(Et&&$e.sections.length===1){at=[];for(var Jt=0,$t=Et($e.toString(),pn($e,W,C,s,d,de,Be));Jt<$t.length;Jt+=1){var Cr=$t[Jt],Yr=new Kr;Yr.text=Cr,Yr.sections=$e.sections;for(var Sn=0;Sn<Cr.length;Sn++)Yr.sectionIndex.push(0);at.push(Yr)}}else if(Rt){at=[];for(var yi=0,Zn=Rt($e.text,$e.sectionIndex,pn($e,W,C,s,d,de,Be));yi<Zn.length;yi+=1){var bi=Zn[yi],Nn=new Kr;Nn.text=bi[0],Nn.sectionIndex=bi[1],Nn.sections=$e.sections,at.push(Nn)}}else at=function(li,vr){for(var ra=[],At=li.text,Ei=0,Wa=0,jo=vr;Wa<jo.length;Wa+=1){var fs=jo[Wa];ra.push(li.substring(Ei,fs)),Ei=fs}return Ei<At.length&&ra.push(li.substring(Ei,At.length)),ra}($e,pn($e,W,C,s,d,de,Be));var la=[],Mi={positionedLines:la,text:$e.toString(),top:q[1],bottom:q[1],left:q[0],right:q[0],writingMode:J,iconsInText:!1,verticalizable:!1};return function(li,vr,ra,At,Ei,Wa,jo,fs,ns,mo,xs,ou){for(var $s=0,zu=-17,hs=0,Au=0,bs=fs==="right"?1:fs==="left"?0:.5,su=0,wa=0,Co=Ei;wa<Co.length;wa+=1){var go=Co[wa];go.trim();var Za=go.getMaxScale(),dl=24*(Za-1),Tu={positionedGlyphs:[],lineOffset:0};li.positionedLines[su]=Tu;var Go=Tu.positionedGlyphs,Zs=0;if(go.length()){for(var gu=0;gu<go.length();gu++){var Da=go.getSection(gu),vl=go.getSectionIndex(gu),_c=go.getCharCode(gu),Fl=0,Es=null,xc=null,Uc=null,_d=24,ip=!(ns===fn.horizontal||!xs&&!Sa(_c)||xs&&(pi[_c]||(Zc=_c,mn.Arabic(Zc)||mn["Arabic Supplement"](Zc)||mn["Arabic Extended-A"](Zc)||mn["Arabic Presentation Forms-A"](Zc)||mn["Arabic Presentation Forms-B"](Zc))));if(Da.imageName){var zp=At[Da.imageName];if(!zp)continue;Uc=Da.imageName,li.iconsInText=li.iconsInText||!0,xc=zp.paddedRect;var Ih=zp.displaySize;Da.scale=24*Da.scale/ou,Fl=dl+(24-Ih[1]*Da.scale),_d=(Es={width:Ih[0],height:Ih[1],left:1,top:-3,advance:ip?Ih[1]:Ih[0]}).advance;var xd=ip?Ih[0]*Da.scale-24*Za:Ih[1]*Da.scale-24*Za;xd>0&&xd>Zs&&(Zs=xd)}else{var Up=ra[Da.fontStack],ap=Up&&Up[_c];if(ap&&ap.rect)xc=ap.rect,Es=ap.metrics;else{var Zf=vr[Da.fontStack],op=Zf&&Zf[_c];if(!op)continue;Es=op.metrics}Fl=24*(Za-Da.scale)}ip?(li.verticalizable=!0,Go.push({glyph:_c,imageName:Uc,x:$s,y:zu+Fl,vertical:ip,scale:Da.scale,fontStack:Da.fontStack,sectionIndex:vl,metrics:Es,rect:xc}),$s+=_d*Da.scale+mo):(Go.push({glyph:_c,imageName:Uc,x:$s,y:zu+Fl,vertical:ip,scale:Da.scale,fontStack:Da.fontStack,sectionIndex:vl,metrics:Es,rect:xc}),$s+=Es.advance*Da.scale+mo)}Go.length!==0&&(hs=Math.max($s-mo,hs),Qi(Go,0,Go.length-1,bs,Zs)),$s=0;var Ra=Wa*Za+Zs;Tu.lineOffset=Math.max(Zs,dl),zu+=Ra,Au=Math.max(Ra,Au),++su}else zu+=Wa,++su}var Zc,bd=zu- -17,Zp=kn(jo),Ph=Zp.horizontalAlign,Vf=Zp.verticalAlign;(function(Xd,Vp,jp,Ed,Gp,Hp,Wp,Xp,Yp){var sp,Cd=(Vp-jp)*Gp;sp=Hp!==Wp?-Xp*Ed- -17:(-Ed*Yp+.5)*Wp;for(var up=0,lp=Xd;up<lp.length;up+=1)for(var hf=0,Sd=lp[up].positionedGlyphs;hf<Sd.length;hf+=1){var wd=Sd[hf];wd.x+=Cd,wd.y+=sp}})(li.positionedLines,bs,Ph,Vf,hs,Au,Wa,bd,Ei.length),li.top+=-Vf*bd,li.bottom=li.top+bd,li.left+=-Ph*hs,li.right=li.left+hs}(Mi,s,l,d,at,A,L,z,J,W,se,Ve),!function(li){for(var vr=0,ra=li;vr<ra.length;vr+=1)if(ra[vr].positionedGlyphs.length!==0)return!1;return!0}(la)&&Mi}Kr.fromFeature=function(n,s){for(var l=new Kr,d=0;d<n.sections.length;d++){var _=n.sections[d];_.image?l.addImageSection(_):l.addTextSection(_,s)}return l},Kr.prototype.length=function(){return this.text.length},Kr.prototype.getSection=function(n){return this.sections[this.sectionIndex[n]]},Kr.prototype.getSectionIndex=function(n){return this.sectionIndex[n]},Kr.prototype.getCharCode=function(n){return this.text.charCodeAt(n)},Kr.prototype.verticalizePunctuation=function(){this.text=function(n){for(var s="",l=0;l<n.length;l++){var d=n.charCodeAt(l+1)||null,_=n.charCodeAt(l-1)||null;s+=d&&Hl(d)&&!rp[n[l+1]]||_&&Hl(_)&&!rp[n[l-1]]||!rp[n[l]]?n[l]:rp[n[l]]}return s}(this.text)},Kr.prototype.trim=function(){for(var n=0,s=0;s<this.text.length&&pi[this.text.charCodeAt(s)];s++)n++;for(var l=this.text.length,d=this.text.length-1;d>=0&&d>=n&&pi[this.text.charCodeAt(d)];d--)l--;this.text=this.text.substring(n,l),this.sectionIndex=this.sectionIndex.slice(n,l)},Kr.prototype.substring=function(n,s){var l=new Kr;return l.text=this.text.substring(n,s),l.sectionIndex=this.sectionIndex.slice(n,s),l.sections=this.sections,l},Kr.prototype.toString=function(){return this.text},Kr.prototype.getMaxScale=function(){var n=this;return this.sectionIndex.reduce(function(s,l){return Math.max(s,n.sections[l].scale)},0)},Kr.prototype.addTextSection=function(n,s){this.text+=n.text,this.sections.push(wr.forText(n.scale,n.fontStack||s));for(var l=this.sections.length-1,d=0;d<n.text.length;++d)this.sectionIndex.push(l)},Kr.prototype.addImageSection=function(n){var s=n.image?n.image.name:"";if(s.length!==0){var l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(wr.forImage(s)),this.sectionIndex.push(this.sections.length-1)):st("Reached maximum number of images 6401")}else st("Can't add FormattedSection with an empty image.")},Kr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var pi={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},or={};function dr(n,s,l,d,_,C){if(s.imageName){var A=d[s.imageName];return A?A.displaySize[0]*s.scale*24/C+_:0}var L=l[s.fontStack],z=L&&L[n];return z?z.metrics.advance*s.scale+_:0}function qn(n,s,l,d){var _=Math.pow(n-s,2);return d?n<s?_/2:2*_:_+Math.abs(l)*l}function xn(n,s,l){var d=0;return n===10&&(d-=1e4),l&&(d+=150),n!==40&&n!==65288||(d+=50),s!==41&&s!==65289||(d+=50),d}function Hr(n,s,l,d,_,C){for(var A=null,L=qn(s,l,_,C),z=0,W=d;z<W.length;z+=1){var q=W[z],J=qn(s-q.x,l,_,C)+q.badness;J<=L&&(A=q,L=J)}return{index:n,x:s,priorBreak:A,badness:L}}function pn(n,s,l,d,_,C,A){if(C!=="point")return[];if(!n)return[];for(var L,z=[],W=function(at,$e,Et,Rt,Jt,$t){for(var Cr=0,Yr=0;Yr<at.length();Yr++){var Sn=at.getSection(Yr);Cr+=dr(at.getCharCode(Yr),Sn,Rt,Jt,$e,$t)}return Cr/Math.max(1,Math.ceil(Cr/Et))}(n,s,l,d,_,A),q=n.text.indexOf("\u200B")>=0,J=0,se=0;se<n.length();se++){var de=n.getSection(se),Be=n.getCharCode(se);if(pi[Be]||(J+=dr(Be,de,d,_,s,A)),se<n.length()-1){var Ve=!((L=Be)<11904||!(mn["Bopomofo Extended"](L)||mn.Bopomofo(L)||mn["CJK Compatibility Forms"](L)||mn["CJK Compatibility Ideographs"](L)||mn["CJK Compatibility"](L)||mn["CJK Radicals Supplement"](L)||mn["CJK Strokes"](L)||mn["CJK Symbols and Punctuation"](L)||mn["CJK Unified Ideographs Extension A"](L)||mn["CJK Unified Ideographs"](L)||mn["Enclosed CJK Letters and Months"](L)||mn["Halfwidth and Fullwidth Forms"](L)||mn.Hiragana(L)||mn["Ideographic Description Characters"](L)||mn["Kangxi Radicals"](L)||mn["Katakana Phonetic Extensions"](L)||mn.Katakana(L)||mn["Vertical Forms"](L)||mn["Yi Radicals"](L)||mn["Yi Syllables"](L)));(or[Be]||Ve||de.imageName)&&z.push(Hr(se+1,J,W,z,xn(Be,n.getCharCode(se+1),Ve&&q),!1))}}return function at($e){return $e?at($e.priorBreak).concat($e.index):[]}(Hr(n.length(),J,W,z,0,!0))}function kn(n){var s=.5,l=.5;switch(n){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:s,verticalAlign:l}}function Qi(n,s,l,d,_){if(d||_)for(var C=n[l],A=(n[l].x+C.metrics.advance*C.scale)*d,L=s;L<=l;L++)n[L].x-=A,n[L].y+=_}function Ri(n,s,l,d,_,C){var A,L=n.image;if(L.content){var z=L.content,W=L.pixelRatio||1;A=[z[0]/W,z[1]/W,L.displaySize[0]-z[2]/W,L.displaySize[1]-z[3]/W]}var q,J,se,de,Be=s.left*C,Ve=s.right*C;l==="width"||l==="both"?(de=_[0]+Be-d[3],J=_[0]+Ve+d[1]):J=(de=_[0]+(Be+Ve-L.displaySize[0])/2)+L.displaySize[0];var at=s.top*C,$e=s.bottom*C;return l==="height"||l==="both"?(q=_[1]+at-d[0],se=_[1]+$e+d[2]):se=(q=_[1]+(at+$e-L.displaySize[1])/2)+L.displaySize[1],{image:L,top:q,right:J,bottom:se,left:de,collisionPadding:A}}or[10]=!0,or[32]=!0,or[38]=!0,or[40]=!0,or[41]=!0,or[43]=!0,or[45]=!0,or[47]=!0,or[173]=!0,or[183]=!0,or[8203]=!0,or[8208]=!0,or[8211]=!0,or[8231]=!0;var yn=function(n){function s(l,d,_,C){n.call(this,l,d),this.angle=_,C!==void 0&&(this.segment=C)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.clone=function(){return new s(this.x,this.y,this.angle,this.segment)},s}(rt);function bn(n,s){var l=s.expression;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new aa(n+1))};if(l.kind==="source")return{kind:"source"};for(var d=l.zoomStops,_=l.interpolationType,C=0;C<d.length&&d[C]<=n;)C++;for(var A=C=Math.max(0,C-1);A<d.length&&d[A]<n+1;)A++;A=Math.min(d.length-1,A);var L=d[C],z=d[A];return l.kind==="composite"?{kind:"composite",minZoom:L,maxZoom:z,interpolationType:_}:{kind:"camera",minZoom:L,maxZoom:z,minSize:l.evaluate(new aa(L)),maxSize:l.evaluate(new aa(z)),interpolationType:_}}function Ai(n,s,l){var d=s.uSize,_=l.lowerSize;return n.kind==="source"?_/128:n.kind==="composite"?Fa(_/128,l.upperSize/128,s.uSizeT):d}function Xi(n,s){var l=0,d=0;if(n.kind==="constant")d=n.layoutSize;else if(n.kind!=="source"){var _=n.interpolationType,C=_?ar(Te.interpolationFactor(_,s,n.minZoom,n.maxZoom),0,1):0;n.kind==="camera"?d=Fa(n.minSize,n.maxSize,C):l=C}return{uSizeT:l,uSize:d}}tn("Anchor",yn);var xa=Object.freeze({__proto__:null,getSizeData:bn,evaluateSizeForFeature:Ai,evaluateSizeForZoom:Xi,SIZE_PACK_FACTOR:128});function $o(n,s,l,d,_){if(s.segment===void 0)return!0;for(var C=s,A=s.segment+1,L=0;L>-l/2;){if(--A<0)return!1;L-=n[A].dist(C),C=n[A]}L+=n[A].dist(n[A+1]),A++;for(var z=[],W=0;L<l/2;){var q=n[A],J=n[A+1];if(!J)return!1;var se=n[A-1].angleTo(q)-q.angleTo(J);for(se=Math.abs((se+3*Math.PI)%(2*Math.PI)-Math.PI),z.push({distance:L,angleDelta:se}),W+=se;L-z[0].distance>d;)W-=z.shift().angleDelta;if(W>_)return!1;A++,L+=q.dist(J)}return!0}function Ko(n){for(var s=0,l=0;l<n.length-1;l++)s+=n[l].dist(n[l+1]);return s}function ma(n,s,l){return n?.6*s*l:0}function Xs(n,s){return Math.max(n?n.right-n.left:0,s?s.right-s.left:0)}function Mo(n,s,l,d,_,C){for(var A=ma(l,_,C),L=Xs(l,d)*C,z=0,W=Ko(n)/2,q=0;q<n.length-1;q++){var J=n[q],se=n[q+1],de=J.dist(se);if(z+de>W){var Be=(W-z)/de,Ve=Fa(J.x,se.x,Be),at=Fa(J.y,se.y,Be),$e=new yn(Ve,at,se.angleTo(J),q);return $e._round(),!A||$o(n,$e,L,A,s)?$e:void 0}z+=de}}function Ns(n,s,l,d,_,C,A,L,z){var W=ma(d,C,A),q=Xs(d,_),J=q*A,se=n[0].x===0||n[0].x===z||n[0].y===0||n[0].y===z;return s-J<s/4&&(s=J+s/4),function de(Be,Ve,at,$e,Et,Rt,Jt,$t,Cr){for(var Yr=Rt/2,Sn=Ko(Be),yi=0,Zn=Ve-at,bi=[],Nn=0;Nn<Be.length-1;Nn++){for(var la=Be[Nn],Mi=Be[Nn+1],li=la.dist(Mi),vr=Mi.angleTo(la);Zn+at<yi+li;){var ra=((Zn+=at)-yi)/li,At=Fa(la.x,Mi.x,ra),Ei=Fa(la.y,Mi.y,ra);if(At>=0&&At<Cr&&Ei>=0&&Ei<Cr&&Zn-Yr>=0&&Zn+Yr<=Sn){var Wa=new yn(At,Ei,vr,Nn);Wa._round(),$e&&!$o(Be,Wa,Rt,$e,Et)||bi.push(Wa)}}yi+=li}return $t||bi.length||Jt||(bi=de(Be,yi/2,at,$e,Et,Rt,Jt,!0,Cr)),bi}(n,se?s/2*L%s:(q/2+2*C)*A*L%s,s,W,l,J,se,!1,z)}function rs(n,s,l,d,_){for(var C=[],A=0;A<n.length;A++)for(var L=n[A],z=void 0,W=0;W<L.length-1;W++){var q=L[W],J=L[W+1];q.x<s&&J.x<s||(q.x<s?q=new rt(s,q.y+(s-q.x)/(J.x-q.x)*(J.y-q.y))._round():J.x<s&&(J=new rt(s,q.y+(s-q.x)/(J.x-q.x)*(J.y-q.y))._round()),q.y<l&&J.y<l||(q.y<l?q=new rt(q.x+(l-q.y)/(J.y-q.y)*(J.x-q.x),l)._round():J.y<l&&(J=new rt(q.x+(l-q.y)/(J.y-q.y)*(J.x-q.x),l)._round()),q.x>=d&&J.x>=d||(q.x>=d?q=new rt(d,q.y+(d-q.x)/(J.x-q.x)*(J.y-q.y))._round():J.x>=d&&(J=new rt(d,q.y+(d-q.x)/(J.x-q.x)*(J.y-q.y))._round()),q.y>=_&&J.y>=_||(q.y>=_?q=new rt(q.x+(_-q.y)/(J.y-q.y)*(J.x-q.x),_)._round():J.y>=_&&(J=new rt(q.x+(_-q.y)/(J.y-q.y)*(J.x-q.x),_)._round()),z&&q.equals(z[z.length-1])||C.push(z=[q]),z.push(J)))))}return C}function Ys(n,s,l,d){var _=[],C=n.image,A=C.pixelRatio,L=C.paddedRect.w-2,z=C.paddedRect.h-2,W=n.right-n.left,q=n.bottom-n.top,J=C.stretchX||[[0,L]],se=C.stretchY||[[0,z]],de=function(At,Ei){return At+Ei[1]-Ei[0]},Be=J.reduce(de,0),Ve=se.reduce(de,0),at=L-Be,$e=z-Ve,Et=0,Rt=Be,Jt=0,$t=Ve,Cr=0,Yr=at,Sn=0,yi=$e;if(C.content&&d){var Zn=C.content;Et=zs(J,0,Zn[0]),Jt=zs(se,0,Zn[1]),Rt=zs(J,Zn[0],Zn[2]),$t=zs(se,Zn[1],Zn[3]),Cr=Zn[0]-Et,Sn=Zn[1]-Jt,Yr=Zn[2]-Zn[0]-Rt,yi=Zn[3]-Zn[1]-$t}var bi=function(At,Ei,Wa,jo){var fs=Qo(At.stretch-Et,Rt,W,n.left),ns=ta(At.fixed-Cr,Yr,At.stretch,Be),mo=Qo(Ei.stretch-Jt,$t,q,n.top),xs=ta(Ei.fixed-Sn,yi,Ei.stretch,Ve),ou=Qo(Wa.stretch-Et,Rt,W,n.left),$s=ta(Wa.fixed-Cr,Yr,Wa.stretch,Be),zu=Qo(jo.stretch-Jt,$t,q,n.top),hs=ta(jo.fixed-Sn,yi,jo.stretch,Ve),Au=new rt(fs,mo),bs=new rt(ou,mo),su=new rt(ou,zu),wa=new rt(fs,zu),Co=new rt(ns/A,xs/A),go=new rt($s/A,hs/A),Za=s*Math.PI/180;if(Za){var dl=Math.sin(Za),Tu=Math.cos(Za),Go=[Tu,-dl,dl,Tu];Au._matMult(Go),bs._matMult(Go),wa._matMult(Go),su._matMult(Go)}var Zs=At.stretch+At.fixed,gu=Ei.stretch+Ei.fixed;return{tl:Au,tr:bs,bl:wa,br:su,tex:{x:C.paddedRect.x+1+Zs,y:C.paddedRect.y+1+gu,w:Wa.stretch+Wa.fixed-Zs,h:jo.stretch+jo.fixed-gu},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Co,pixelOffsetBR:go,minFontScaleX:Yr/A/W,minFontScaleY:yi/A/q,isSDF:l}};if(d&&(C.stretchX||C.stretchY))for(var Nn=Us(J,at,Be),la=Us(se,$e,Ve),Mi=0;Mi<Nn.length-1;Mi++)for(var li=Nn[Mi],vr=Nn[Mi+1],ra=0;ra<la.length-1;ra++)_.push(bi(li,la[ra],vr,la[ra+1]));else _.push(bi({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:z+1}));return _}function zs(n,s,l){for(var d=0,_=0,C=n;_<C.length;_+=1){var A=C[_];d+=Math.max(s,Math.min(l,A[1]))-Math.max(s,Math.min(l,A[0]))}return d}function Us(n,s,l){for(var d=[{fixed:-1,stretch:0}],_=0,C=n;_<C.length;_+=1){var A=C[_],L=A[0],z=A[1],W=d[d.length-1];d.push({fixed:L-W.stretch,stretch:W.stretch}),d.push({fixed:L-W.stretch,stretch:W.stretch+(z-L)})}return d.push({fixed:s+1,stretch:l}),d}function Qo(n,s,l,d){return n/s*l+d}function ta(n,s,l,d){return n-s*l/d}var ks=function(n,s,l,d,_,C,A,L,z,W){if(this.boxStartIndex=n.length,z){var q=C.top,J=C.bottom,se=C.collisionPadding;se&&(q-=se[1],J+=se[3]);var de=J-q;de>0&&(de=Math.max(10,de),this.circleDiameter=de)}else{var Be=C.top*A-L,Ve=C.bottom*A+L,at=C.left*A-L,$e=C.right*A+L,Et=C.collisionPadding;if(Et&&(at-=Et[0]*A,Be-=Et[1]*A,$e+=Et[2]*A,Ve+=Et[3]*A),W){var Rt=new rt(at,Be),Jt=new rt($e,Be),$t=new rt(at,Ve),Cr=new rt($e,Ve),Yr=W*Math.PI/180;Rt._rotate(Yr),Jt._rotate(Yr),$t._rotate(Yr),Cr._rotate(Yr),at=Math.min(Rt.x,Jt.x,$t.x,Cr.x),$e=Math.max(Rt.x,Jt.x,$t.x,Cr.x),Be=Math.min(Rt.y,Jt.y,$t.y,Cr.y),Ve=Math.max(Rt.y,Jt.y,$t.y,Cr.y)}n.emplaceBack(s.x,s.y,at,Be,$e,Ve,l,d,_)}this.boxEndIndex=n.length},La=function(n,s){if(n===void 0&&(n=[]),s===void 0&&(s=nu),this.data=n,this.length=this.data.length,this.compare=s,this.length>0)for(var l=(this.length>>1)-1;l>=0;l--)this._down(l)};function nu(n,s){return n<s?-1:n>s?1:0}function zi(n,s,l){s===void 0&&(s=1),l===void 0&&(l=!1);for(var d=1/0,_=1/0,C=-1/0,A=-1/0,L=n[0],z=0;z<L.length;z++){var W=L[z];(!z||W.x<d)&&(d=W.x),(!z||W.y<_)&&(_=W.y),(!z||W.x>C)&&(C=W.x),(!z||W.y>A)&&(A=W.y)}var q=Math.min(C-d,A-_),J=q/2,se=new La([],ba);if(q===0)return new rt(d,_);for(var de=d;de<C;de+=q)for(var Be=_;Be<A;Be+=q)se.push(new Ha(de+J,Be+J,J,n));for(var Ve=function(Et){for(var Rt=0,Jt=0,$t=0,Cr=Et[0],Yr=0,Sn=Cr.length,yi=Sn-1;Yr<Sn;yi=Yr++){var Zn=Cr[Yr],bi=Cr[yi],Nn=Zn.x*bi.y-bi.x*Zn.y;Jt+=(Zn.x+bi.x)*Nn,$t+=(Zn.y+bi.y)*Nn,Rt+=3*Nn}return new Ha(Jt/Rt,$t/Rt,0,Et)}(n),at=se.length;se.length;){var $e=se.pop();($e.d>Ve.d||!Ve.d)&&(Ve=$e,l&&console.log("found best %d after %d probes",Math.round(1e4*$e.d)/1e4,at)),$e.max-Ve.d<=s||(se.push(new Ha($e.p.x-(J=$e.h/2),$e.p.y-J,J,n)),se.push(new Ha($e.p.x+J,$e.p.y-J,J,n)),se.push(new Ha($e.p.x-J,$e.p.y+J,J,n)),se.push(new Ha($e.p.x+J,$e.p.y+J,J,n)),at+=4)}return l&&(console.log("num probes: "+at),console.log("best distance: "+Ve.d)),Ve.p}function ba(n,s){return s.max-n.max}function Ha(n,s,l,d){this.p=new rt(n,s),this.h=l,this.d=function(_,C){for(var A=!1,L=1/0,z=0;z<C.length;z++)for(var W=C[z],q=0,J=W.length,se=J-1;q<J;se=q++){var de=W[q],Be=W[se];de.y>_.y!=Be.y>_.y&&_.x<(Be.x-de.x)*(_.y-de.y)/(Be.y-de.y)+de.x&&(A=!A),L=Math.min(L,sl(_,de,Be))}return(A?1:-1)*Math.sqrt(L)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}La.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},La.prototype.pop=function(){if(this.length!==0){var n=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),n}},La.prototype.peek=function(){return this.data[0]},La.prototype._up=function(n){for(var s=this.data,l=this.compare,d=s[n];n>0;){var _=n-1>>1,C=s[_];if(l(d,C)>=0)break;s[n]=C,n=_}s[n]=d},La.prototype._down=function(n){for(var s=this.data,l=this.compare,d=this.length>>1,_=s[n];n<d;){var C=1+(n<<1),A=s[C],L=C+1;if(L<this.length&&l(s[L],A)<0&&(C=L,A=s[L]),l(A,_)>=0)break;s[n]=A,n=C}s[n]=_};var _s=Number.POSITIVE_INFINITY;function ff(n,s){return s[1]!==_s?function(l,d,_){var C=0,A=0;switch(d=Math.abs(d),_=Math.abs(_),l){case"top-right":case"top-left":case"top":A=_-7;break;case"bottom-right":case"bottom-left":case"bottom":A=7-_}switch(l){case"top-right":case"bottom-right":case"right":C=-d;break;case"top-left":case"bottom-left":case"left":C=d}return[C,A]}(n,s[0],s[1]):function(l,d){var _=0,C=0;d<0&&(d=0);var A=d/Math.sqrt(2);switch(l){case"top-right":case"top-left":C=A-7;break;case"bottom-right":case"bottom-left":C=7-A;break;case"bottom":C=7-d;break;case"top":C=d-7}switch(l){case"top-right":case"bottom-right":_=-A;break;case"top-left":case"bottom-left":_=A;break;case"left":_=d;break;case"right":_=-d}return[_,C]}(n,s[0])}function De(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Wt(n,s,l,d,_,C,A,L,z,W,q,J,se,de,Be){var Ve=function(Jt,$t,Cr,Yr,Sn,yi,Zn,bi){for(var Nn=Yr.layout.get("text-rotate").evaluate(yi,{})*Math.PI/180,la=[],Mi=0,li=$t.positionedLines;Mi<li.length;Mi+=1)for(var vr=li[Mi],ra=0,At=vr.positionedGlyphs;ra<At.length;ra+=1){var Ei=At[ra];if(Ei.rect){var Wa=Ei.rect||{},jo=4,fs=!0,ns=1,mo=0,xs=(Sn||bi)&&Ei.vertical,ou=Ei.metrics.advance*Ei.scale/2;if(bi&&$t.verticalizable&&(mo=vr.lineOffset/2-(Ei.imageName?-(24-Ei.metrics.width*Ei.scale)/2:24*(Ei.scale-1))),Ei.imageName){var $s=Zn[Ei.imageName];fs=$s.sdf,jo=1/(ns=$s.pixelRatio)}var zu=Sn?[Ei.x+ou,Ei.y]:[0,0],hs=Sn?[0,0]:[Ei.x+ou+Cr[0],Ei.y+Cr[1]-mo],Au=[0,0];xs&&(Au=hs,hs=[0,0]);var bs=(Ei.metrics.left-jo)*Ei.scale-ou+hs[0],su=(-Ei.metrics.top-jo)*Ei.scale+hs[1],wa=bs+Wa.w*Ei.scale/ns,Co=su+Wa.h*Ei.scale/ns,go=new rt(bs,su),Za=new rt(wa,su),dl=new rt(bs,Co),Tu=new rt(wa,Co);if(xs){var Go=new rt(-ou,ou- -17),Zs=-Math.PI/2,gu=12-ou,Da=new rt(22-gu,-(Ei.imageName?gu:0)),vl=new(Function.prototype.bind.apply(rt,[null].concat(Au)));go._rotateAround(Zs,Go)._add(Da)._add(vl),Za._rotateAround(Zs,Go)._add(Da)._add(vl),dl._rotateAround(Zs,Go)._add(Da)._add(vl),Tu._rotateAround(Zs,Go)._add(Da)._add(vl)}if(Nn){var _c=Math.sin(Nn),Fl=Math.cos(Nn),Es=[Fl,-_c,_c,Fl];go._matMult(Es),Za._matMult(Es),dl._matMult(Es),Tu._matMult(Es)}var xc=new rt(0,0),Uc=new rt(0,0);la.push({tl:go,tr:Za,bl:dl,br:Tu,tex:Wa,writingMode:$t.writingMode,glyphOffset:zu,sectionIndex:Ei.sectionIndex,isSDF:fs,pixelOffsetTL:xc,pixelOffsetBR:Uc,minFontScaleX:0,minFontScaleY:0})}}return la}(0,l,L,_,C,A,d,n.allowVerticalPlacement),at=n.textSizeData,$e=null;at.kind==="source"?($e=[128*_.layout.get("text-size").evaluate(A,{})])[0]>32640&&st(n.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):at.kind==="composite"&&(($e=[128*de.compositeTextSizes[0].evaluate(A,{},Be),128*de.compositeTextSizes[1].evaluate(A,{},Be)])[0]>32640||$e[1]>32640)&&st(n.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),n.addSymbols(n.text,Ve,$e,L,C,A,W,s,z.lineStartIndex,z.lineLength,se,Be);for(var Et=0,Rt=q;Et<Rt.length;Et+=1)J[Rt[Et]]=n.text.placedSymbolArray.length-1;return 4*Ve.length}function Lt(n){for(var s in n)return n[s];return null}function Un(n,s,l,d){var _=n.compareText;if(s in _){for(var C=_[s],A=C.length-1;A>=0;A--)if(d.dist(C[A])<l)return!0}else _[s]=[];return _[s].push(d),!1}var Ea=Nu.VectorTileFeature.types,Re=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ge(n,s,l,d,_,C,A,L,z,W,q,J,se){var de=L?Math.min(32640,Math.round(L[0])):0,Be=L?Math.min(32640,Math.round(L[1])):0;n.emplaceBack(s,l,Math.round(32*d),Math.round(32*_),C,A,(de<<1)+(z?1:0),Be,16*W,16*q,256*J,256*se)}function Qe(n,s,l){n.emplaceBack(s.x,s.y,l),n.emplaceBack(s.x,s.y,l),n.emplaceBack(s.x,s.y,l),n.emplaceBack(s.x,s.y,l)}function wt(n){for(var s=0,l=n.sections;s<l.length;s+=1)if(Qc(l[s].text))return!0;return!1}var Ut=function(n){this.layoutVertexArray=new qh,this.indexArray=new dc,this.programConfigurations=n,this.segments=new le,this.dynamicLayoutVertexArray=new Rc,this.opacityVertexArray=new gh,this.placedSymbolArray=new m};Ut.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Ut.prototype.upload=function(n,s,l,d){this.isEmpty()||(l&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,a0.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,Vd.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,Re,!0),this.opacityVertexBuffer.itemSize=1),(l||d)&&this.programConfigurations.upload(n))},Ut.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},tn("SymbolBuffers",Ut);var ot=function(n,s,l){this.layoutVertexArray=new n,this.layoutAttributes=s,this.indexArray=new l,this.segments=new le,this.collisionVertexArray=new eh};ot.prototype.upload=function(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,jd.members,!0)},ot.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},tn("CollisionBuffers",ot);var Ge=function(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(C){return C.id}),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ou([]),this.placementViewportMatrix=Ou([]);var s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bn(this.zoom,s["text-size"]),this.iconSizeData=bn(this.zoom,s["icon-size"]);var l=this.layers[0].layout,d=l.get("symbol-sort-key"),_=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(function(C){return fn[C]})),this.stateDependentLayerIds=this.layers.filter(function(C){return C.isStateDependent()}).map(function(C){return C.id}),this.sourceID=n.sourceID};Ge.prototype.createArrays=function(){this.text=new Ut(new Si(this.layers,this.zoom,function(n){return/^text/.test(n)})),this.icon=new Ut(new Si(this.layers,this.zoom,function(n){return/^icon/.test(n)})),this.glyphOffsetArray=new P,this.lineVertexArray=new N,this.symbolInstances=new k},Ge.prototype.calculateGlyphDependencies=function(n,s,l,d,_){for(var C=0;C<n.length;C++)if(s[n.charCodeAt(C)]=!0,(l||d)&&_){var A=rp[n.charAt(C)];A&&(s[A.charCodeAt(0)]=!0)}},Ge.prototype.populate=function(n,s,l){var d=this.layers[0],_=d.layout,C=_.get("text-font"),A=_.get("text-field"),L=_.get("icon-image"),z=(A.value.kind!=="constant"||A.value.value instanceof wo&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),W=L.value.kind!=="constant"||!!L.value.value||Object.keys(L.parameters).length>0,q=_.get("symbol-sort-key");if(this.features=[],z||W){for(var J=s.iconDependencies,se=s.glyphDependencies,de=s.availableImages,Be=new aa(this.zoom),Ve=0,at=n;Ve<at.length;Ve+=1){var $e=at[Ve],Et=$e.feature,Rt=$e.id,Jt=$e.index,$t=$e.sourceLayerIndex,Cr=d._featureFilter.needGeometry,Yr=lo(Et,Cr);if(d._featureFilter.filter(Be,Yr,l)){Cr||(Yr.geometry=vo(Et));var Sn=void 0;if(z){var yi=d.getValueAndResolveTokens("text-field",Yr,l,de),Zn=wo.factory(yi);wt(Zn)&&(this.hasRTLText=!0),(!this.hasRTLText||Xh()==="unavailable"||this.hasRTLText&&Os.isParsed())&&(Sn=s0(Zn,d,Yr))}var bi=void 0;if(W){var Nn=d.getValueAndResolveTokens("icon-image",Yr,l,de);bi=Nn instanceof qa?Nn:qa.fromString(Nn)}if(Sn||bi){var la=this.sortFeaturesByKey?q.evaluate(Yr,{},l):void 0;if(this.features.push({id:Rt,text:Sn,icon:bi,index:Jt,sourceLayerIndex:$t,geometry:Yr.geometry,properties:Et.properties,type:Ea[Et.type],sortKey:la}),bi&&(J[bi.name]=!0),Sn){var Mi=C.evaluate(Yr,{},l).join(","),li=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(fn.vertical)>=0;for(var vr=0,ra=Sn.sections;vr<ra.length;vr+=1){var At=ra[vr];if(At.image)J[At.image.name]=!0;else{var Ei=wf(Sn.toString()),Wa=At.fontStack||Mi,jo=se[Wa]=se[Wa]||{};this.calculateGlyphDependencies(At.text,jo,li,this.allowVerticalPlacement,Ei)}}}}}}_.get("symbol-placement")==="line"&&(this.features=function(fs){var ns={},mo={},xs=[],ou=0;function $s(Go){xs.push(fs[Go]),ou++}function zu(Go,Zs,gu){var Da=mo[Go];return delete mo[Go],mo[Zs]=Da,xs[Da].geometry[0].pop(),xs[Da].geometry[0]=xs[Da].geometry[0].concat(gu[0]),Da}function hs(Go,Zs,gu){var Da=ns[Zs];return delete ns[Zs],ns[Go]=Da,xs[Da].geometry[0].shift(),xs[Da].geometry[0]=gu[0].concat(xs[Da].geometry[0]),Da}function Au(Go,Zs,gu){var Da=gu?Zs[0][Zs[0].length-1]:Zs[0][0];return Go+":"+Da.x+":"+Da.y}for(var bs=0;bs<fs.length;bs++){var su=fs[bs],wa=su.geometry,Co=su.text?su.text.toString():null;if(Co){var go=Au(Co,wa),Za=Au(Co,wa,!0);if(go in mo&&Za in ns&&mo[go]!==ns[Za]){var dl=hs(go,Za,wa),Tu=zu(go,Za,xs[dl].geometry);delete ns[go],delete mo[Za],mo[Au(Co,xs[Tu].geometry,!0)]=Tu,xs[dl].geometry=null}else go in mo?zu(go,Za,wa):Za in ns?hs(go,Za,wa):($s(bs),ns[go]=ou-1,mo[Za]=ou-1)}else $s(bs)}return xs.filter(function(Go){return Go.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(fs,ns){return fs.sortKey-ns.sortKey})}},Ge.prototype.update=function(n,s,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,s,this.layers,l),this.icon.programConfigurations.updatePaintArrays(n,s,this.layers,l))},Ge.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Ge.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Ge.prototype.upload=function(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Ge.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Ge.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Ge.prototype.addToLineVertexArray=function(n,s){var l=this.lineVertexArray.length;if(n.segment!==void 0){for(var d=n.dist(s[n.segment+1]),_=n.dist(s[n.segment]),C={},A=n.segment+1;A<s.length;A++)C[A]={x:s[A].x,y:s[A].y,tileUnitDistanceFromAnchor:d},A<s.length-1&&(d+=s[A+1].dist(s[A]));for(var L=n.segment||0;L>=0;L--)C[L]={x:s[L].x,y:s[L].y,tileUnitDistanceFromAnchor:_},L>0&&(_+=s[L-1].dist(s[L]));for(var z=0;z<s.length;z++){var W=C[z];this.lineVertexArray.emplaceBack(W.x,W.y,W.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}},Ge.prototype.addSymbols=function(n,s,l,d,_,C,A,L,z,W,q,J){for(var se=n.indexArray,de=n.layoutVertexArray,Be=n.segments.prepareSegment(4*s.length,de,se,this.canOverlap?C.sortKey:void 0),Ve=this.glyphOffsetArray.length,at=Be.vertexLength,$e=this.allowVerticalPlacement&&A===fn.vertical?Math.PI/2:0,Et=C.text&&C.text.sections,Rt=0;Rt<s.length;Rt++){var Jt=s[Rt],$t=Jt.tl,Cr=Jt.tr,Yr=Jt.bl,Sn=Jt.br,yi=Jt.tex,Zn=Jt.pixelOffsetTL,bi=Jt.pixelOffsetBR,Nn=Jt.minFontScaleX,la=Jt.minFontScaleY,Mi=Jt.glyphOffset,li=Jt.isSDF,vr=Jt.sectionIndex,ra=Be.vertexLength,At=Mi[1];ge(de,L.x,L.y,$t.x,At+$t.y,yi.x,yi.y,l,li,Zn.x,Zn.y,Nn,la),ge(de,L.x,L.y,Cr.x,At+Cr.y,yi.x+yi.w,yi.y,l,li,bi.x,Zn.y,Nn,la),ge(de,L.x,L.y,Yr.x,At+Yr.y,yi.x,yi.y+yi.h,l,li,Zn.x,bi.y,Nn,la),ge(de,L.x,L.y,Sn.x,At+Sn.y,yi.x+yi.w,yi.y+yi.h,l,li,bi.x,bi.y,Nn,la),Qe(n.dynamicLayoutVertexArray,L,$e),se.emplaceBack(ra,ra+1,ra+2),se.emplaceBack(ra+1,ra+2,ra+3),Be.vertexLength+=4,Be.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Mi[0]),Rt!==s.length-1&&vr===s[Rt+1].sectionIndex||n.programConfigurations.populatePaintArrays(de.length,C,C.index,{},J,Et&&Et[vr])}n.placedSymbolArray.emplaceBack(L.x,L.y,Ve,this.glyphOffsetArray.length-Ve,at,z,W,L.segment,l?l[0]:0,l?l[1]:0,d[0],d[1],A,0,!1,0,q)},Ge.prototype._addCollisionDebugVertex=function(n,s,l,d,_,C){return s.emplaceBack(0,0),n.emplaceBack(l.x,l.y,d,_,Math.round(C.x),Math.round(C.y))},Ge.prototype.addCollisionDebugVertices=function(n,s,l,d,_,C,A){var L=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),z=L.vertexLength,W=_.layoutVertexArray,q=_.collisionVertexArray,J=A.anchorX,se=A.anchorY;this._addCollisionDebugVertex(W,q,C,J,se,new rt(n,s)),this._addCollisionDebugVertex(W,q,C,J,se,new rt(l,s)),this._addCollisionDebugVertex(W,q,C,J,se,new rt(l,d)),this._addCollisionDebugVertex(W,q,C,J,se,new rt(n,d)),L.vertexLength+=4;var de=_.indexArray;de.emplaceBack(z,z+1),de.emplaceBack(z+1,z+2),de.emplaceBack(z+2,z+3),de.emplaceBack(z+3,z),L.primitiveLength+=4},Ge.prototype.addDebugCollisionBoxes=function(n,s,l,d){for(var _=n;_<s;_++){var C=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(C.x1,C.y1,C.x2,C.y2,d?this.textCollisionBox:this.iconCollisionBox,C.anchorPoint,l)}},Ge.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ot(pc,wh.members,hu),this.iconCollisionBox=new ot(pc,wh.members,hu);for(var n=0;n<this.symbolInstances.length;n++){var s=this.symbolInstances.get(n);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}},Ge.prototype._deserializeCollisionBoxesForSymbol=function(n,s,l,d,_,C,A,L,z){for(var W={},q=s;q<l;q++){var J=n.get(q);W.textBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},W.textFeatureIndex=J.featureIndex;break}for(var se=d;se<_;se++){var de=n.get(se);W.verticalTextBox={x1:de.x1,y1:de.y1,x2:de.x2,y2:de.y2,anchorPointX:de.anchorPointX,anchorPointY:de.anchorPointY},W.verticalTextFeatureIndex=de.featureIndex;break}for(var Be=C;Be<A;Be++){var Ve=n.get(Be);W.iconBox={x1:Ve.x1,y1:Ve.y1,x2:Ve.x2,y2:Ve.y2,anchorPointX:Ve.anchorPointX,anchorPointY:Ve.anchorPointY},W.iconFeatureIndex=Ve.featureIndex;break}for(var at=L;at<z;at++){var $e=n.get(at);W.verticalIconBox={x1:$e.x1,y1:$e.y1,x2:$e.x2,y2:$e.y2,anchorPointX:$e.anchorPointX,anchorPointY:$e.anchorPointY},W.verticalIconFeatureIndex=$e.featureIndex;break}return W},Ge.prototype.deserializeCollisionBoxes=function(n){this.collisionArrays=[];for(var s=0;s<this.symbolInstances.length;s++){var l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}},Ge.prototype.hasTextData=function(){return this.text.segments.get().length>0},Ge.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Ge.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Ge.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Ge.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Ge.prototype.addIndicesForPlacedSymbol=function(n,s){for(var l=n.placedSymbolArray.get(s),d=l.vertexStartIndex+4*l.numGlyphs,_=l.vertexStartIndex;_<d;_+=4)n.indexArray.emplaceBack(_,_+1,_+2),n.indexArray.emplaceBack(_+1,_+2,_+3)},Ge.prototype.getSortedSymbolIndexes=function(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var s=Math.sin(n),l=Math.cos(n),d=[],_=[],C=[],A=0;A<this.symbolInstances.length;++A){C.push(A);var L=this.symbolInstances.get(A);d.push(0|Math.round(s*L.anchorX+l*L.anchorY)),_.push(L.featureIndex)}return C.sort(function(z,W){return d[z]-d[W]||_[W]-_[z]}),C},Ge.prototype.addToSortKeyRanges=function(n,s){var l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:n,symbolInstanceEnd:n+1})},Ge.prototype.sortFeatures=function(n){var s=this;if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var l=0,d=this.symbolInstanceIndexes;l<d.length;l+=1){var _=this.symbolInstances.get(d[l]);this.featureSortOrder.push(_.featureIndex),[_.rightJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.leftJustifiedTextSymbolIndex].forEach(function(C,A,L){C>=0&&L.indexOf(C)===A&&s.addIndicesForPlacedSymbol(s.text,C)}),_.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,_.verticalPlacedTextSymbolIndex),_.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.placedIconSymbolIndex),_.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},tn("SymbolBucket",Ge,{omit:["layers","collisionBoxArray","features","compareText"]}),Ge.MAX_GLYPHS=65535,Ge.addDynamicAttributes=Qe;var mt=new Yo({"symbol-placement":new ci(_e.layout_symbol["symbol-placement"]),"symbol-spacing":new ci(_e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ci(_e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ti(_e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ci(_e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ci(_e.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ci(_e.layout_symbol["icon-ignore-placement"]),"icon-optional":new ci(_e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ci(_e.layout_symbol["icon-rotation-alignment"]),"icon-size":new ti(_e.layout_symbol["icon-size"]),"icon-text-fit":new ci(_e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ci(_e.layout_symbol["icon-text-fit-padding"]),"icon-image":new ti(_e.layout_symbol["icon-image"]),"icon-rotate":new ti(_e.layout_symbol["icon-rotate"]),"icon-padding":new ci(_e.layout_symbol["icon-padding"]),"icon-keep-upright":new ci(_e.layout_symbol["icon-keep-upright"]),"icon-offset":new ti(_e.layout_symbol["icon-offset"]),"icon-anchor":new ti(_e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ci(_e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ci(_e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ci(_e.layout_symbol["text-rotation-alignment"]),"text-field":new ti(_e.layout_symbol["text-field"]),"text-font":new ti(_e.layout_symbol["text-font"]),"text-size":new ti(_e.layout_symbol["text-size"]),"text-max-width":new ti(_e.layout_symbol["text-max-width"]),"text-line-height":new ci(_e.layout_symbol["text-line-height"]),"text-letter-spacing":new ti(_e.layout_symbol["text-letter-spacing"]),"text-justify":new ti(_e.layout_symbol["text-justify"]),"text-radial-offset":new ti(_e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ci(_e.layout_symbol["text-variable-anchor"]),"text-anchor":new ti(_e.layout_symbol["text-anchor"]),"text-max-angle":new ci(_e.layout_symbol["text-max-angle"]),"text-writing-mode":new ci(_e.layout_symbol["text-writing-mode"]),"text-rotate":new ti(_e.layout_symbol["text-rotate"]),"text-padding":new ci(_e.layout_symbol["text-padding"]),"text-keep-upright":new ci(_e.layout_symbol["text-keep-upright"]),"text-transform":new ti(_e.layout_symbol["text-transform"]),"text-offset":new ti(_e.layout_symbol["text-offset"]),"text-allow-overlap":new ci(_e.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ci(_e.layout_symbol["text-ignore-placement"]),"text-optional":new ci(_e.layout_symbol["text-optional"])}),we={paint:new Yo({"icon-opacity":new ti(_e.paint_symbol["icon-opacity"]),"icon-color":new ti(_e.paint_symbol["icon-color"]),"icon-halo-color":new ti(_e.paint_symbol["icon-halo-color"]),"icon-halo-width":new ti(_e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ti(_e.paint_symbol["icon-halo-blur"]),"icon-translate":new ci(_e.paint_symbol["icon-translate"]),"icon-translate-anchor":new ci(_e.paint_symbol["icon-translate-anchor"]),"text-opacity":new ti(_e.paint_symbol["text-opacity"]),"text-color":new ti(_e.paint_symbol["text-color"],{runtimeType:cn,getOverride:function(n){return n.textColor},hasOverride:function(n){return!!n.textColor}}),"text-halo-color":new ti(_e.paint_symbol["text-halo-color"]),"text-halo-width":new ti(_e.paint_symbol["text-halo-width"]),"text-halo-blur":new ti(_e.paint_symbol["text-halo-blur"]),"text-translate":new ci(_e.paint_symbol["text-translate"]),"text-translate-anchor":new ci(_e.paint_symbol["text-translate-anchor"])}),layout:mt},Ke=function(n){this.type=n.property.overrides?n.property.overrides.runtimeType:vn,this.defaultValue=n};Ke.prototype.evaluate=function(n){if(n.formattedSection){var s=this.defaultValue.property.overrides;if(s&&s.hasOverride(n.formattedSection))return s.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default},Ke.prototype.eachChild=function(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)},Ke.prototype.outputDefined=function(){return!1},Ke.prototype.serialize=function(){return null},tn("FormatSectionOverride",Ke,{omit:["defaultValue"]});var Ie=function(n){function s(l){n.call(this,l,we)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.recalculate=function(l,d){if(n.prototype.recalculate.call(this,l,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var _=this.layout.get("text-writing-mode");if(_){for(var C=[],A=0,L=_;A<L.length;A+=1){var z=L[A];C.indexOf(z)<0&&C.push(z)}this.layout._values["text-writing-mode"]=C}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},s.prototype.getValueAndResolveTokens=function(l,d,_,C){var A=this.layout.get(l).evaluate(d,{},_,C),L=this._unevaluatedLayout._values[l];return L.isDataDriven()||yf(L.value)||!A?A:function(z,W){return W.replace(/{([^{}]+)}/g,function(q,J){return J in z?String(z[J]):""})}(d.properties,A)},s.prototype.createBucket=function(l){return new Ge(l)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype._setPaintOverrides=function(){for(var l=0,d=we.paint.overridableProperties;l<d.length;l+=1){var _=d[l];if(s.hasPaintOverride(this.layout,_)){var C,A=this.paint.get(_),L=new Ke(A),z=new Yc(L,A.property.specification);C=A.value.kind==="constant"||A.value.kind==="source"?new qc("source",z):new Tc("composite",z,A.value.zoomStops,A.value._interpolationType),this.paint._values[_]=new Hs(A.property,C,A.parameters)}}},s.prototype._handleOverridablePaintPropertyUpdate=function(l,d,_){return!(!this.layout||d.isDataDriven()||_.isDataDriven())&&s.hasPaintOverride(this.layout,l)},s.hasPaintOverride=function(l,d){var _=l.get("text-field"),C=we.paint.properties[d],A=!1,L=function(q){for(var J=0,se=q;J<se.length;J+=1)if(C.overrides&&C.overrides.hasOverride(se[J]))return void(A=!0)};if(_.value.kind==="constant"&&_.value.value instanceof wo)L(_.value.value.sections);else if(_.value.kind==="source"){var z=function(q){A||(q instanceof Aa&&Li(q.value)===St?L(q.value.sections):q instanceof ws?L(q.sections):q.eachChild(z))},W=_.value;W._styleExpression&&z(W._styleExpression.expression)}return A},s}(Tl),gt={paint:new Yo({"background-color":new ci(_e.paint_background["background-color"]),"background-pattern":new Fs(_e.paint_background["background-pattern"]),"background-opacity":new ci(_e.paint_background["background-opacity"])})},Pt=function(n){function s(l){n.call(this,l,gt)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s}(Tl),Ar={paint:new Yo({"raster-opacity":new ci(_e.paint_raster["raster-opacity"]),"raster-hue-rotate":new ci(_e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ci(_e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ci(_e.paint_raster["raster-brightness-max"]),"raster-saturation":new ci(_e.paint_raster["raster-saturation"]),"raster-contrast":new ci(_e.paint_raster["raster-contrast"]),"raster-resampling":new ci(_e.paint_raster["raster-resampling"]),"raster-fade-duration":new ci(_e.paint_raster["raster-fade-duration"])})},ln=function(n){function s(l){n.call(this,l,Ar)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s}(Tl),_n=function(n){function s(l){n.call(this,l,{}),this.implementation=l}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},s.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},s.prototype.recalculate=function(){},s.prototype.updateTransitions=function(){},s.prototype.hasTransition=function(){},s.prototype.serialize=function(){},s.prototype.onAdd=function(l){this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},s.prototype.onRemove=function(l){this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},s}(Tl),Ln={circle:Kh,heatmap:yh,hillshade:vu,fill:Fp,"fill-extrusion":Nc,line:Zd,symbol:Ie,background:Pt,raster:ln},dn=Xe.HTMLImageElement,ni=Xe.HTMLCanvasElement,In=Xe.HTMLVideoElement,En=Xe.ImageData,Jn=Xe.ImageBitmap,Gn=function(n,s,l,d){this.context=n,this.format=l,this.texture=n.gl.createTexture(),this.update(s,d)};Gn.prototype.update=function(n,s,l){var d=n.width,_=n.height,C=!(this.size&&this.size[0]===d&&this.size[1]===_||l),A=this.context,L=A.gl;if(this.useMipmap=Boolean(s&&s.useMipmap),L.bindTexture(L.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===L.RGBA&&(!s||s.premultiply!==!1)),C)this.size=[d,_],n instanceof dn||n instanceof ni||n instanceof In||n instanceof En||Jn&&n instanceof Jn?L.texImage2D(L.TEXTURE_2D,0,this.format,this.format,L.UNSIGNED_BYTE,n):L.texImage2D(L.TEXTURE_2D,0,this.format,d,_,0,this.format,L.UNSIGNED_BYTE,n.data);else{var z=l||{x:0,y:0},W=z.x,q=z.y;n instanceof dn||n instanceof ni||n instanceof In||n instanceof En||Jn&&n instanceof Jn?L.texSubImage2D(L.TEXTURE_2D,0,W,q,L.RGBA,L.UNSIGNED_BYTE,n):L.texSubImage2D(L.TEXTURE_2D,0,W,q,d,_,L.RGBA,L.UNSIGNED_BYTE,n.data)}this.useMipmap&&this.isSizePowerOfTwo()&&L.generateMipmap(L.TEXTURE_2D)},Gn.prototype.bind=function(n,s,l){var d=this.context.gl;d.bindTexture(d.TEXTURE_2D,this.texture),l!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=d.LINEAR),n!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,l||n),this.filter=n),s!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,s),this.wrap=s)},Gn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Gn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Oi=function(n){var s=this;this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){s._triggered=!1,s._callback()})};Oi.prototype.trigger=function(){var n=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){n._triggered=!1,n._callback()},0))},Oi.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ma=function(n,s,l){this.target=n,this.parent=s,this.mapId=l,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},ri(["receive","process"],this),this.invoker=new Oi(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ce()?n:Xe};function Is(n,s,l){var d=2*Math.PI*6378137/256/Math.pow(2,l);return[n*d-2*Math.PI*6378137/2,s*d-2*Math.PI*6378137/2]}Ma.prototype.send=function(n,s,l,d,_){var C=this;_===void 0&&(_=!1);var A=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(this.callbacks[A]=l);var L=Ze(this.globalScope)?void 0:[];return this.target.postMessage({id:A,type:n,hasCallback:!!l,targetMapId:d,mustQueue:_,sourceMapId:this.mapId,data:Wu(s,L)},L),{cancel:function(){l&&delete C.callbacks[A],C.target.postMessage({id:A,type:"<cancel>",targetMapId:d,sourceMapId:C.mapId})}}},Ma.prototype.receive=function(n){var s=n.data,l=s.id;if(l&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){delete this.tasks[l];var d=this.cancelCallbacks[l];delete this.cancelCallbacks[l],d&&d()}else ce()||s.mustQueue?(this.tasks[l]=s,this.taskQueue.push(l),this.invoker.trigger()):this.processTask(l,s)},Ma.prototype.process=function(){if(this.taskQueue.length){var n=this.taskQueue.shift(),s=this.tasks[n];delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),s&&this.processTask(n,s)}},Ma.prototype.processTask=function(n,s){var l=this;if(s.type==="<response>"){var d=this.callbacks[n];delete this.callbacks[n],d&&(s.error?d(Lu(s.error)):d(null,Lu(s.data)))}else{var _=!1,C=Ze(this.globalScope)?void 0:[],A=s.hasCallback?function(q,J){_=!0,delete l.cancelCallbacks[n],l.target.postMessage({id:n,type:"<response>",sourceMapId:l.mapId,error:q?Wu(q):null,data:Wu(J,C)},C)}:function(q){_=!0},L=null,z=Lu(s.data);if(this.parent[s.type])L=this.parent[s.type](s.sourceMapId,z,A);else if(this.parent.getWorkerSource){var W=s.type.split(".");L=this.parent.getWorkerSource(s.sourceMapId,W[0],z.source)[W[1]](z,A)}else A(new Error("Could not find function "+s.type));!_&&L&&L.cancel&&(this.cancelCallbacks[n]=L.cancel)}},Ma.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var co=function(n,s){n&&(s?this.setSouthWest(n).setNorthEast(s):n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))};co.prototype.setNorthEast=function(n){return this._ne=n instanceof Ua?new Ua(n.lng,n.lat):Ua.convert(n),this},co.prototype.setSouthWest=function(n){return this._sw=n instanceof Ua?new Ua(n.lng,n.lat):Ua.convert(n),this},co.prototype.extend=function(n){var s,l,d=this._sw,_=this._ne;if(n instanceof Ua)s=n,l=n;else{if(!(n instanceof co))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(co.convert(n)):this.extend(Ua.convert(n)):this;if(l=n._ne,!(s=n._sw)||!l)return this}return d||_?(d.lng=Math.min(s.lng,d.lng),d.lat=Math.min(s.lat,d.lat),_.lng=Math.max(l.lng,_.lng),_.lat=Math.max(l.lat,_.lat)):(this._sw=new Ua(s.lng,s.lat),this._ne=new Ua(l.lng,l.lat)),this},co.prototype.getCenter=function(){return new Ua((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},co.prototype.getSouthWest=function(){return this._sw},co.prototype.getNorthEast=function(){return this._ne},co.prototype.getNorthWest=function(){return new Ua(this.getWest(),this.getNorth())},co.prototype.getSouthEast=function(){return new Ua(this.getEast(),this.getSouth())},co.prototype.getWest=function(){return this._sw.lng},co.prototype.getSouth=function(){return this._sw.lat},co.prototype.getEast=function(){return this._ne.lng},co.prototype.getNorth=function(){return this._ne.lat},co.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},co.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},co.prototype.isEmpty=function(){return!(this._sw&&this._ne)},co.prototype.contains=function(n){var s=Ua.convert(n),l=s.lng,d=s.lat,_=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&_},co.convert=function(n){return!n||n instanceof co?n:new co(n)};var Ua=function(n,s){if(isNaN(n)||isNaN(s))throw new Error("Invalid LngLat object: ("+n+", "+s+")");if(this.lng=+n,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Ua.prototype.wrap=function(){return new Ua(ur(this.lng,-180,180),this.lat)},Ua.prototype.toArray=function(){return[this.lng,this.lat]},Ua.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Ua.prototype.distanceTo=function(n){var s=Math.PI/180,l=this.lat*s,d=n.lat*s,_=Math.sin(l)*Math.sin(d)+Math.cos(l)*Math.cos(d)*Math.cos((n.lng-this.lng)*s);return 63710088e-1*Math.acos(Math.min(_,1))},Ua.prototype.toBounds=function(n){n===void 0&&(n=0);var s=360*n/40075017,l=s/Math.cos(Math.PI/180*this.lat);return new co(new Ua(this.lng-l,this.lat-s),new Ua(this.lng+l,this.lat+s))},Ua.convert=function(n){if(n instanceof Ua)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new Ua(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new Ua(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var zc=2*Math.PI*63710088e-1;function iu(n){return zc*Math.cos(n*Math.PI/180)}function hl(n){return(180+n)/360}function Ol(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Th(n,s){return n/iu(s)}function pl(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}var Uf=function(n,s,l){l===void 0&&(l=0),this.x=+n,this.y=+s,this.z=+l};Uf.fromLngLat=function(n,s){s===void 0&&(s=0);var l=Ua.convert(n);return new Uf(hl(l.lng),Ol(l.lat),Th(s,l.lat))},Uf.prototype.toLngLat=function(){return new Ua(360*this.x-180,pl(this.y))},Uf.prototype.toAltitude=function(){return this.z*iu(pl(this.y))},Uf.prototype.meterInMercatorCoordinateUnits=function(){return 1/zc*(n=pl(this.y),1/Math.cos(n*Math.PI/180));var n};var np=function(n,s,l){this.z=n,this.x=s,this.y=l,this.key=qs(0,n,n,s,l)};np.prototype.equals=function(n){return this.z===n.z&&this.x===n.x&&this.y===n.y},np.prototype.url=function(n,s){var l,d,_,C,A,L=(d=this.y,_=this.z,C=Is(256*(l=this.x),256*(d=Math.pow(2,_)-d-1),_),A=Is(256*(l+1),256*(d+1),_),C[0]+","+C[1]+","+A[0]+","+A[1]),z=function(W,q,J){for(var se,de="",Be=W;Be>0;Be--)de+=(q&(se=1<<Be-1)?1:0)+(J&se?2:0);return de}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",z).replace("{bbox-epsg-3857}",L)},np.prototype.getTilePoint=function(n){var s=Math.pow(2,this.z);return new rt(8192*(n.x*s-this.x),8192*(n.y*s-this.y))},np.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Hd=function(n,s){this.wrap=n,this.canonical=s,this.key=qs(n,s.z,s.z,s.x,s.y)},Do=function(n,s,l,d,_){this.overscaledZ=n,this.wrap=s,this.canonical=new np(l,+d,+_),this.key=qs(s,n,l,d,_)};function qs(n,s,l,d,_){(n*=2)<0&&(n=-1*n-1);var C=1<<l;return(C*C*n+C*_+d).toString(36)+l.toString(36)+s.toString(36)}Do.prototype.equals=function(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)},Do.prototype.scaledTo=function(n){var s=this.canonical.z-n;return n>this.canonical.z?new Do(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Do(n,this.wrap,n,this.canonical.x>>s,this.canonical.y>>s)},Do.prototype.calculateScaledKey=function(n,s){var l=this.canonical.z-n;return n>this.canonical.z?qs(this.wrap*+s,n,this.canonical.z,this.canonical.x,this.canonical.y):qs(this.wrap*+s,n,n,this.canonical.x>>l,this.canonical.y>>l)},Do.prototype.isChildOf=function(n){if(n.wrap!==this.wrap)return!1;var s=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>s&&n.canonical.y===this.canonical.y>>s},Do.prototype.children=function(n){if(this.overscaledZ>=n)return[new Do(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var s=this.canonical.z+1,l=2*this.canonical.x,d=2*this.canonical.y;return[new Do(s,this.wrap,s,l,d),new Do(s,this.wrap,s,l+1,d),new Do(s,this.wrap,s,l,d+1),new Do(s,this.wrap,s,l+1,d+1)]},Do.prototype.isLessThan=function(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))},Do.prototype.wrapped=function(){return new Do(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Do.prototype.unwrapTo=function(n){return new Do(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)},Do.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Do.prototype.toUnwrapped=function(){return new Hd(this.wrap,this.canonical)},Do.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Do.prototype.getTilePoint=function(n){return this.canonical.getTilePoint(new Uf(n.x-this.wrap,n.y))},tn("CanonicalTileID",np),tn("OverscaledTileID",Do,{omit:["posMatrix"]});var oh=function(n,s,l){if(this.uid=n,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return st('"'+l+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=s.height;var d=this.dim=s.height-2;this.data=new Uint32Array(s.data.buffer),this.encoding=l||"mapbox";for(var _=0;_<d;_++)this.data[this._idx(-1,_)]=this.data[this._idx(0,_)],this.data[this._idx(d,_)]=this.data[this._idx(d-1,_)],this.data[this._idx(_,-1)]=this.data[this._idx(_,0)],this.data[this._idx(_,d)]=this.data[this._idx(_,d-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(d,-1)]=this.data[this._idx(d-1,0)],this.data[this._idx(-1,d)]=this.data[this._idx(0,d-1)],this.data[this._idx(d,d)]=this.data[this._idx(d-1,d-1)]};oh.prototype.get=function(n,s){var l=new Uint8Array(this.data.buffer),d=4*this._idx(n,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(l[d],l[d+1],l[d+2])},oh.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},oh.prototype._idx=function(n,s){if(n<-1||n>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(n+1)},oh.prototype._unpackMapbox=function(n,s,l){return(256*n*256+256*s+l)/10-1e4},oh.prototype._unpackTerrarium=function(n,s,l){return 256*n+s+l/256-32768},oh.prototype.getPixels=function(){return new ys({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},oh.prototype.backfillBorder=function(n,s,l){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");var d=s*this.dim,_=s*this.dim+this.dim,C=l*this.dim,A=l*this.dim+this.dim;switch(s){case-1:d=_-1;break;case 1:_=d+1}switch(l){case-1:C=A-1;break;case 1:A=C+1}for(var L=-s*this.dim,z=-l*this.dim,W=C;W<A;W++)for(var q=d;q<_;q++)this.data[this._idx(q,W)]=n.data[this._idx(q+L,W+z)]},tn("DEMData",oh);var md=function(n){this._stringToNumber={},this._numberToString=[];for(var s=0;s<n.length;s++){var l=n[s];this._stringToNumber[l]=s,this._numberToString[s]=l}};md.prototype.encode=function(n){return this._stringToNumber[n]},md.prototype.decode=function(n){return this._numberToString[n]};var gd=function(n,s,l,d,_){this.type="Feature",this._vectorTileFeature=n,n._z=s,n._x=l,n._y=d,this.properties=n.properties,this.id=_},D0={geometry:{configurable:!0}};D0.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},D0.geometry.set=function(n){this._geometry=n},gd.prototype.toJSON=function(){var n={geometry:this.geometry};for(var s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(n[s]=this[s]);return n},Object.defineProperties(gd.prototype,D0);var yd=function(){this.state={},this.stateChanges={},this.deletedStates={}};yd.prototype.updateState=function(n,s,l){var d=String(s);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][d]=this.stateChanges[n][d]||{},Ir(this.stateChanges[n][d],l),this.deletedStates[n]===null)for(var _ in this.deletedStates[n]={},this.state[n])_!==d&&(this.deletedStates[n][_]=null);else if(this.deletedStates[n]&&this.deletedStates[n][d]===null)for(var C in this.deletedStates[n][d]={},this.state[n][d])l[C]||(this.deletedStates[n][d][C]=null);else for(var A in l)this.deletedStates[n]&&this.deletedStates[n][d]&&this.deletedStates[n][d][A]===null&&delete this.deletedStates[n][d][A]},yd.prototype.removeFeatureState=function(n,s,l){if(this.deletedStates[n]!==null){var d=String(s);if(this.deletedStates[n]=this.deletedStates[n]||{},l&&s!==void 0)this.deletedStates[n][d]!==null&&(this.deletedStates[n][d]=this.deletedStates[n][d]||{},this.deletedStates[n][d][l]=null);else if(s!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][d])for(l in this.deletedStates[n][d]={},this.stateChanges[n][d])this.deletedStates[n][d][l]=null;else this.deletedStates[n][d]=null;else this.deletedStates[n]=null}},yd.prototype.getState=function(n,s){var l=String(s),d=Ir({},(this.state[n]||{})[l],(this.stateChanges[n]||{})[l]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){var _=this.deletedStates[n][s];if(_===null)return{};for(var C in _)delete d[C]}return d},yd.prototype.initializeTileState=function(n,s){n.setFeatureState(this.state,s)},yd.prototype.coalesceChanges=function(n,s){var l={};for(var d in this.stateChanges){this.state[d]=this.state[d]||{};var _={};for(var C in this.stateChanges[d])this.state[d][C]||(this.state[d][C]={}),Ir(this.state[d][C],this.stateChanges[d][C]),_[C]=this.state[d][C];l[d]=_}for(var A in this.deletedStates){this.state[A]=this.state[A]||{};var L={};if(this.deletedStates[A]===null)for(var z in this.state[A])L[z]={},this.state[A][z]={};else for(var W in this.deletedStates[A]){if(this.deletedStates[A][W]===null)this.state[A][W]={};else for(var q=0,J=Object.keys(this.deletedStates[A][W]);q<J.length;q+=1)delete this.state[A][W][J[q]];L[W]=this.state[A][W]}l[A]=l[A]||{},Ir(l[A],L)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(var se in n)n[se].setFeatureState(l,s)};var Mh=function(n,s){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new lc(8192,16,0),this.grid3D=new lc(8192,16,0),this.featureIndexArray=new te,this.promoteId=s};function l0(n,s,l,d,_){return _i(n,function(C,A){var L=s instanceof Al?s.get(A):null;return L&&L.evaluate?L.evaluate(l,d,_):L})}function Br(n){for(var s=1/0,l=1/0,d=-1/0,_=-1/0,C=0,A=n;C<A.length;C+=1){var L=A[C];s=Math.min(s,L.x),l=Math.min(l,L.y),d=Math.max(d,L.x),_=Math.max(_,L.y)}return{minX:s,minY:l,maxX:d,maxY:_}}function Hv(n,s){return s-n}Mh.prototype.insert=function(n,s,l,d,_,C){var A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,d,_);for(var L=C?this.grid3D:this.grid,z=0;z<s.length;z++){for(var W=s[z],q=[1/0,1/0,-1/0,-1/0],J=0;J<W.length;J++){var se=W[J];q[0]=Math.min(q[0],se.x),q[1]=Math.min(q[1],se.y),q[2]=Math.max(q[2],se.x),q[3]=Math.max(q[3],se.y)}q[0]<8192&&q[1]<8192&&q[2]>=0&&q[3]>=0&&L.insert(A,q[0],q[1],q[2],q[3])}},Mh.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Nu.VectorTile(new zf(this.rawTileData)).layers,this.sourceLayerCoder=new md(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Mh.prototype.query=function(n,s,l,d){var _=this;this.loadVTLayers();for(var C=n.params||{},A=8192/n.tileSize/n.scale,L=kc(C.filter),z=n.queryGeometry,W=n.queryPadding*A,q=Br(z),J=this.grid.query(q.minX-W,q.minY-W,q.maxX+W,q.maxY+W),se=Br(n.cameraQueryGeometry),de=this.grid3D.query(se.minX-W,se.minY-W,se.maxX+W,se.maxY+W,function(Jt,$t,Cr,Yr){return function(Sn,yi,Zn,bi,Nn){for(var la=0,Mi=Sn;la<Mi.length;la+=1){var li=Mi[la];if(yi<=li.x&&Zn<=li.y&&bi>=li.x&&Nn>=li.y)return!0}var vr=[new rt(yi,Zn),new rt(yi,Nn),new rt(bi,Nn),new rt(bi,Zn)];if(Sn.length>2){for(var ra=0,At=vr;ra<At.length;ra+=1)if(ul(Sn,At[ra]))return!0}for(var Ei=0;Ei<Sn.length-1;Ei++)if(mc(Sn[Ei],Sn[Ei+1],vr))return!0;return!1}(n.cameraQueryGeometry,Jt-W,$t-W,Cr+W,Yr+W)}),Be=0,Ve=de;Be<Ve.length;Be+=1)J.push(Ve[Be]);J.sort(Hv);for(var at,$e={},Et=function(Jt){var $t=J[Jt];if($t!==at){at=$t;var Cr=_.featureIndexArray.get($t),Yr=null;_.loadMatchingFeature($e,Cr.bucketIndex,Cr.sourceLayerIndex,Cr.featureIndex,L,C.layers,C.availableImages,s,l,d,function(Sn,yi,Zn){return Yr||(Yr=vo(Sn)),yi.queryIntersectsFeature(z,Sn,Zn,Yr,_.z,n.transform,A,n.pixelPosMatrix)})}},Rt=0;Rt<J.length;Rt++)Et(Rt);return $e},Mh.prototype.loadMatchingFeature=function(n,s,l,d,_,C,A,L,z,W,q){var J=this.bucketLayerIDs[s];if(!C||function(Sn,yi){for(var Zn=0;Zn<Sn.length;Zn++)if(yi.indexOf(Sn[Zn])>=0)return!0;return!1}(C,J)){var se=this.sourceLayerCoder.decode(l),de=this.vtLayers[se].feature(d);if(_.needGeometry){var Be=lo(de,!0);if(!_.filter(new aa(this.tileID.overscaledZ),Be,this.tileID.canonical))return}else if(!_.filter(new aa(this.tileID.overscaledZ),de))return;for(var Ve=this.getId(de,se),at=0;at<J.length;at++){var $e=J[at];if(!(C&&C.indexOf($e)<0)){var Et=L[$e];if(Et){var Rt={};Ve!==void 0&&W&&(Rt=W.getState(Et.sourceLayer||"_geojsonTileLayer",Ve));var Jt=Ir({},z[$e]);Jt.paint=l0(Jt.paint,Et.paint,de,Rt,A),Jt.layout=l0(Jt.layout,Et.layout,de,Rt,A);var $t=!q||q(de,Et,Rt);if($t){var Cr=new gd(de,this.z,this.x,this.y,Ve);Cr.layer=Jt;var Yr=n[$e];Yr===void 0&&(Yr=n[$e]=[]),Yr.push({featureIndex:d,feature:Cr,intersectionZ:$t})}}}}}},Mh.prototype.lookupSymbolFeatures=function(n,s,l,d,_,C,A,L){var z={};this.loadVTLayers();for(var W=kc(_),q=0,J=n;q<J.length;q+=1)this.loadMatchingFeature(z,l,d,J[q],W,C,A,L,s);return z},Mh.prototype.hasLayer=function(n){for(var s=0,l=this.bucketLayerIDs;s<l.length;s+=1)for(var d=0,_=l[s];d<_.length;d+=1)if(n===_[d])return!0;return!1},Mh.prototype.getId=function(n,s){var l=n.id;return this.promoteId&&typeof(l=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]])=="boolean"&&(l=Number(l)),l},tn("FeatureIndex",Mh,{omit:["rawTileData","sourceLayerCoder"]});var au=function(n,s){this.tileID=n,this.uid=On(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};au.prototype.registerFadeDuration=function(n){var s=n+this.timeAdded;s<Gi.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)},au.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},au.prototype.loadVectorData=function(n,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",n){for(var d in n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(W,q){var J={};if(!q)return J;for(var se=function(){var Ve=Be[de],at=Ve.layerIds.map(function(Rt){return q.getLayer(Rt)}).filter(Boolean);if(at.length!==0){Ve.layers=at,Ve.stateDependentLayerIds&&(Ve.stateDependentLayers=Ve.stateDependentLayerIds.map(function(Rt){return at.filter(function(Jt){return Jt.id===Rt})[0]}));for(var $e=0,Et=at;$e<Et.length;$e+=1)J[Et[$e].id]=Ve}},de=0,Be=W;de<Be.length;de+=1)se();return J}(n.buckets,s.style),this.hasSymbolBuckets=!1,this.buckets){var _=this.buckets[d];if(_ instanceof Ge){if(this.hasSymbolBuckets=!0,!l)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var C in this.buckets){var A=this.buckets[C];if(A instanceof Ge&&A.hasRTLText){this.hasRTLText=!0,Os.isLoading()||Os.isLoaded()||Xh()!=="deferred"||nl();break}}for(var L in this.queryPadding=0,this.buckets){var z=this.buckets[L];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(L).queryRadius(z))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage)}else this.collisionBoxArray=new h},au.prototype.unloadVectorData=function(){for(var n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},au.prototype.getBucket=function(n){return this.buckets[n.id]},au.prototype.upload=function(n){for(var s in this.buckets){var l=this.buckets[s];l.uploadPending()&&l.upload(n)}var d=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Gn(n,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Gn(n,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)},au.prototype.prepare=function(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)},au.prototype.queryRenderedFeatures=function(n,s,l,d,_,C,A,L,z,W){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:_,scale:C,tileSize:this.tileSize,pixelPosMatrix:W,transform:L,params:A,queryPadding:this.queryPadding*z},n,s,l):{}},au.prototype.querySourceFeatures=function(n,s){var l=this.latestFeatureIndex;if(l&&l.rawTileData){var d=l.loadVTLayers(),_=s?s.sourceLayer:"",C=d._geojsonTileLayer||d[_];if(C)for(var A=kc(s&&s.filter),L=this.tileID.canonical,z=L.z,W=L.x,q=L.y,J={z,x:W,y:q},se=0;se<C.length;se++){var de=C.feature(se);if(A.needGeometry){var Be=lo(de,!0);if(!A.filter(new aa(this.tileID.overscaledZ),Be,this.tileID.canonical))continue}else if(!A.filter(new aa(this.tileID.overscaledZ),de))continue;var Ve=l.getId(de,_),at=new gd(de,z,W,q,Ve);at.tile=J,n.push(at)}}},au.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},au.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},au.prototype.setExpiryData=function(n){var s=this.expirationTime;if(n.cacheControl){var l=Ee(n.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){var d=Date.now(),_=!1;if(this.expirationTime>d)_=!1;else if(s)if(this.expirationTime<s)_=!0;else{var C=this.expirationTime-s;C?this.expirationTime=d+Math.max(C,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},au.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},au.prototype.setFeatureState=function(n,s){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0){var l=this.latestFeatureIndex.loadVTLayers();for(var d in this.buckets)if(s.style.hasLayer(d)){var _=this.buckets[d],C=_.layers[0].sourceLayer||"_geojsonTileLayer",A=l[C],L=n[C];if(A&&L&&Object.keys(L).length!==0){_.update(L,A,this.imageAtlas&&this.imageAtlas.patternPositions||{});var z=s&&s.style&&s.style.getLayer(d);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(_)))}}}},au.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},au.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Gi.now()},au.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},au.prototype.setHoldDuration=function(n){this.symbolFadeHoldUntil=Gi.now()+n},au.prototype.setDependencies=function(n,s){for(var l={},d=0,_=s;d<_.length;d+=1)l[_[d]]=!0;this.dependencies[n]=l},au.prototype.hasDependency=function(n,s){for(var l=0,d=n;l<d.length;l+=1){var _=this.dependencies[d[l]];if(_){for(var C=0,A=s;C<A.length;C+=1)if(_[A[C]])return!0}}return!1};var kh=Xe.performance,Wd=function(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},kh.mark(this._marks.start)};Wd.prototype.finish=function(){kh.mark(this._marks.end);var n=kh.getEntriesByName(this._marks.measure);return n.length===0&&(kh.measure(this._marks.measure,this._marks.start,this._marks.end),n=kh.getEntriesByName(this._marks.measure),kh.clearMarks(this._marks.start),kh.clearMarks(this._marks.end),kh.clearMeasures(this._marks.measure)),n},x.Actor=Ma,x.AlphaImage=$l,x.CanonicalTileID=np,x.CollisionBoxArray=h,x.Color=nt,x.DEMData=oh,x.DataConstantProperty=ci,x.DictionaryCoder=md,x.EXTENT=8192,x.ErrorEvent=Ye,x.EvaluationParameters=aa,x.Event=Ne,x.Evented=lt,x.FeatureIndex=Mh,x.FillBucket=Du,x.FillExtrusionBucket=Bc,x.ImageAtlas=Gr,x.ImagePosition=Ct,x.LineBucket=$a,x.LngLat=Ua,x.LngLatBounds=co,x.MercatorCoordinate=Uf,x.ONE_EM=24,x.OverscaledTileID=Do,x.Point=rt,x.Point$1=rt,x.Properties=Yo,x.Protobuf=zf,x.RGBAImage=ys,x.RequestManager=xi,x.RequestPerformance=Wd,x.ResourceType=Yi,x.SegmentVector=le,x.SourceFeatureState=yd,x.StructArrayLayout1ui2=Ip,x.StructArrayLayout2f1f2i16=Wl,x.StructArrayLayout2i4=Af,x.StructArrayLayout3ui6=dc,x.StructArrayLayout4i8=Ml,x.SymbolBucket=Ge,x.Texture=Gn,x.Tile=au,x.Transitionable=Qs,x.Uniform1f=un,x.Uniform1i=Or,x.Uniform2f=rn,x.Uniform3f=Pn,x.Uniform4f=ui,x.UniformColor=gi,x.UniformMatrix4f=_a,x.UnwrappedTileID=Hd,x.ValidationError=je,x.WritingMode=fn,x.ZoomHistory=Gl,x.add=function(n,s,l){return n[0]=s[0]+l[0],n[1]=s[1]+l[1],n[2]=s[2]+l[2],n},x.addDynamicAttributes=Qe,x.asyncAll=function(n,s,l){if(!n.length)return l(null,[]);var d=n.length,_=new Array(n.length),C=null;n.forEach(function(A,L){s(A,function(z,W){z&&(C=z),_[L]=W,--d==0&&l(C,_)})})},x.bezier=hr,x.bindAll=ri,x.browser=Gi,x.cacheEntryPossiblyAdded=function(n){++eo>Fi&&(n.getActor().send("enforceCacheSizeLimit",Yn),eo=0)},x.clamp=ar,x.clearTileCache=function(n){var s=Xe.caches.delete("mapbox-tiles");n&&s.catch(n).then(function(){return n()})},x.clipLine=rs,x.clone=function(n){var s=new Pa(16);return s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[4]=n[4],s[5]=n[5],s[6]=n[6],s[7]=n[7],s[8]=n[8],s[9]=n[9],s[10]=n[10],s[11]=n[11],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15],s},x.clone$1=ir,x.clone$2=function(n){var s=new Pa(3);return s[0]=n[0],s[1]=n[1],s[2]=n[2],s},x.collisionCircleLayout=o0,x.config=ai,x.create=function(){var n=new Pa(16);return Pa!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},x.create$1=function(){var n=new Pa(9);return Pa!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n},x.create$2=function(){var n=new Pa(4);return Pa!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},x.createCommonjsModule=Jr,x.createExpression=Ac,x.createLayout=io,x.createStyleLayer=function(n){return n.type==="custom"?new _n(n):new Ln[n.type](n)},x.cross=function(n,s,l){var d=s[0],_=s[1],C=s[2],A=l[0],L=l[1],z=l[2];return n[0]=_*z-C*L,n[1]=C*A-d*z,n[2]=d*L-_*A,n},x.deepEqual=function n(s,l){if(Array.isArray(s)){if(!Array.isArray(l)||s.length!==l.length)return!1;for(var d=0;d<s.length;d++)if(!n(s[d],l[d]))return!1;return!0}if(typeof s=="object"&&s!==null&&l!==null){if(typeof l!="object"||Object.keys(s).length!==Object.keys(l).length)return!1;for(var _ in s)if(!n(s[_],l[_]))return!1;return!0}return s===l},x.dot=function(n,s){return n[0]*s[0]+n[1]*s[1]+n[2]*s[2]},x.dot$1=function(n,s){return n[0]*s[0]+n[1]*s[1]+n[2]*s[2]+n[3]*s[3]},x.ease=jt,x.emitValidationErrors=Kf,x.endsWith=me,x.enforceCacheSizeLimit=function(n){Qn(),ie&&ie.then(function(s){s.keys().then(function(l){for(var d=0;d<l.length-n;d++)s.delete(l[d])})})},x.evaluateSizeForFeature=Ai,x.evaluateSizeForZoom=Xi,x.evaluateVariableOffset=ff,x.evented=ld,x.extend=Ir,x.featureFilter=kc,x.filterObject=Rr,x.fromRotation=function(n,s){var l=Math.sin(s),d=Math.cos(s);return n[0]=d,n[1]=l,n[2]=0,n[3]=-l,n[4]=d,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},x.getAnchorAlignment=kn,x.getAnchorJustification=De,x.getArrayBuffer=hi,x.getImage=ne,x.getJSON=function(n,s){return ro(Ir(n,{type:"json"}),s)},x.getRTLTextPluginStatus=Xh,x.getReferrer=to,x.getVideo=function(n,s){var l,d,_=Xe.document.createElement("video");_.muted=!0,_.onloadstart=function(){s(null,_)};for(var C=0;C<n.length;C++){var A=Xe.document.createElement("source");l=n[C],d=void 0,(d=Xe.document.createElement("a")).href=l,(d.protocol!==Xe.document.location.protocol||d.host!==Xe.document.location.host)&&(_.crossOrigin="Anonymous"),A.src=n[C],_.appendChild(A)}return{cancel:function(){}}},x.identity=Ou,x.invert=function(n,s){var l=s[0],d=s[1],_=s[2],C=s[3],A=s[4],L=s[5],z=s[6],W=s[7],q=s[8],J=s[9],se=s[10],de=s[11],Be=s[12],Ve=s[13],at=s[14],$e=s[15],Et=l*L-d*A,Rt=l*z-_*A,Jt=l*W-C*A,$t=d*z-_*L,Cr=d*W-C*L,Yr=_*W-C*z,Sn=q*Ve-J*Be,yi=q*at-se*Be,Zn=q*$e-de*Be,bi=J*at-se*Ve,Nn=J*$e-de*Ve,la=se*$e-de*at,Mi=Et*la-Rt*Nn+Jt*bi+$t*Zn-Cr*yi+Yr*Sn;return Mi?(n[0]=(L*la-z*Nn+W*bi)*(Mi=1/Mi),n[1]=(_*Nn-d*la-C*bi)*Mi,n[2]=(Ve*Yr-at*Cr+$e*$t)*Mi,n[3]=(se*Cr-J*Yr-de*$t)*Mi,n[4]=(z*Zn-A*la-W*yi)*Mi,n[5]=(l*la-_*Zn+C*yi)*Mi,n[6]=(at*Jt-Be*Yr-$e*Rt)*Mi,n[7]=(q*Yr-se*Jt+de*Rt)*Mi,n[8]=(A*Nn-L*Zn+W*Sn)*Mi,n[9]=(d*Zn-l*Nn-C*Sn)*Mi,n[10]=(Be*Cr-Ve*Jt+$e*Et)*Mi,n[11]=(J*Jt-q*Cr-de*Et)*Mi,n[12]=(L*yi-A*bi-z*Sn)*Mi,n[13]=(l*bi-d*yi+_*Sn)*Mi,n[14]=(Ve*Rt-Be*$t-at*Et)*Mi,n[15]=(q*$t-J*Rt+se*Et)*Mi,n):null},x.isChar=mn,x.isMapboxURL=Hi,x.keysDifference=function(n,s){var l=[];for(var d in n)d in s||l.push(d);return l},x.makeRequest=ro,x.mapObject=_i,x.mercatorXfromLng=hl,x.mercatorYfromLat=Ol,x.mercatorZfromAltitude=Th,x.mul=kf,x.multiply=Bs,x.mvt=Nu,x.nextPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},x.normalize=function(n,s){var l=s[0],d=s[1],_=s[2],C=l*l+d*d+_*_;return C>0&&(C=1/Math.sqrt(C)),n[0]=s[0]*C,n[1]=s[1]*C,n[2]=s[2]*C,n},x.number=Fa,x.offscreenCanvasSupported=va,x.ortho=function(n,s,l,d,_,C,A){var L=1/(s-l),z=1/(d-_),W=1/(C-A);return n[0]=-2*L,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*z,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*W,n[11]=0,n[12]=(s+l)*L,n[13]=(_+d)*z,n[14]=(A+C)*W,n[15]=1,n},x.parseGlyphPBF=function(n){return new zf(n).readFields($r,[])},x.pbf=zf,x.performSymbolLayout=function(n,s,l,d,_,C,A){n.createArrays(),n.tilePixelRatio=8192/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;var L=n.layers[0].layout,z=n.layers[0]._unevaluatedLayout._values,W={};if(n.textSizeData.kind==="composite"){var q=n.textSizeData,J=q.maxZoom;W.compositeTextSizes=[z["text-size"].possiblyEvaluate(new aa(q.minZoom),A),z["text-size"].possiblyEvaluate(new aa(J),A)]}if(n.iconSizeData.kind==="composite"){var se=n.iconSizeData,de=se.maxZoom;W.compositeIconSizes=[z["icon-size"].possiblyEvaluate(new aa(se.minZoom),A),z["icon-size"].possiblyEvaluate(new aa(de),A)]}W.layoutTextSize=z["text-size"].possiblyEvaluate(new aa(n.zoom+1),A),W.layoutIconSize=z["icon-size"].possiblyEvaluate(new aa(n.zoom+1),A),W.textMaxSize=z["text-size"].possiblyEvaluate(new aa(18));for(var Be=24*L.get("text-line-height"),Ve=L.get("text-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",at=L.get("text-keep-upright"),$e=L.get("text-size"),Et=function(){var $t=Jt[Rt],Cr=L.get("text-font").evaluate($t,{},A).join(","),Yr=$e.evaluate($t,{},A),Sn=W.layoutTextSize.evaluate($t,{},A),yi=W.layoutIconSize.evaluate($t,{},A),Zn={horizontal:{},vertical:void 0},bi=$t.text,Nn=[0,0];if(bi){var la=bi.toString(),Mi=24*L.get("text-letter-spacing").evaluate($t,{},A),li=function(wa){for(var Co=0,go=wa;Co<go.length;Co+=1)if(Za=go[Co].charCodeAt(0),mn.Arabic(Za)||mn["Arabic Supplement"](Za)||mn["Arabic Extended-A"](Za)||mn["Arabic Presentation Forms-A"](Za)||mn["Arabic Presentation Forms-B"](Za))return!1;var Za;return!0}(la)?Mi:0,vr=L.get("text-anchor").evaluate($t,{},A),ra=L.get("text-variable-anchor");if(!ra){var At=L.get("text-radial-offset").evaluate($t,{},A);Nn=At?ff(vr,[24*At,_s]):L.get("text-offset").evaluate($t,{},A).map(function(wa){return 24*wa})}var Ei=Ve?"center":L.get("text-justify").evaluate($t,{},A),Wa=L.get("symbol-placement"),jo=Wa==="point"?24*L.get("text-max-width").evaluate($t,{},A):0,fs=function(){n.allowVerticalPlacement&&wf(la)&&(Zn.vertical=Mn(bi,s,l,_,Cr,jo,Be,vr,"left",li,Nn,fn.vertical,!0,Wa,Sn,Yr))};if(!Ve&&ra){for(var ns=Ei==="auto"?ra.map(function(wa){return De(wa)}):[Ei],mo=!1,xs=0;xs<ns.length;xs++){var ou=ns[xs];if(!Zn.horizontal[ou])if(mo)Zn.horizontal[ou]=Zn.horizontal[0];else{var $s=Mn(bi,s,l,_,Cr,jo,Be,"center",ou,li,Nn,fn.horizontal,!1,Wa,Sn,Yr);$s&&(Zn.horizontal[ou]=$s,mo=$s.positionedLines.length===1)}}fs()}else{Ei==="auto"&&(Ei=De(vr));var zu=Mn(bi,s,l,_,Cr,jo,Be,vr,Ei,li,Nn,fn.horizontal,!1,Wa,Sn,Yr);zu&&(Zn.horizontal[Ei]=zu),fs(),wf(la)&&Ve&&at&&(Zn.vertical=Mn(bi,s,l,_,Cr,jo,Be,vr,Ei,li,Nn,fn.vertical,!1,Wa,Sn,Yr))}}var hs=void 0,Au=!1;if($t.icon&&$t.icon.name){var bs=d[$t.icon.name];bs&&(hs=function(wa,Co,go){var Za=kn(go),dl=Co[0]-wa.displaySize[0]*Za.horizontalAlign,Tu=Co[1]-wa.displaySize[1]*Za.verticalAlign;return{image:wa,top:Tu,bottom:Tu+wa.displaySize[1],left:dl,right:dl+wa.displaySize[0]}}(_[$t.icon.name],L.get("icon-offset").evaluate($t,{},A),L.get("icon-anchor").evaluate($t,{},A)),Au=bs.sdf,n.sdfIcons===void 0?n.sdfIcons=bs.sdf:n.sdfIcons!==bs.sdf&&st("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(bs.pixelRatio!==n.pixelRatio||L.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0))}var su=Lt(Zn.horizontal)||Zn.vertical;n.iconsInText=!!su&&su.iconsInText,(su||hs)&&function(wa,Co,go,Za,dl,Tu,Go,Zs,gu,Da,vl){var _c=Tu.textMaxSize.evaluate(Co,{});_c===void 0&&(_c=Go);var Fl,Es=wa.layers[0].layout,xc=Es.get("icon-offset").evaluate(Co,{},vl),Uc=Lt(go.horizontal),_d=Go/24,ip=wa.tilePixelRatio*_d,zp=wa.tilePixelRatio*_c/24,Ih=wa.tilePixelRatio*Zs,xd=wa.tilePixelRatio*Es.get("symbol-spacing"),Up=Es.get("text-padding")*wa.tilePixelRatio,ap=Es.get("icon-padding")*wa.tilePixelRatio,Zf=Es.get("text-max-angle")/180*Math.PI,op=Es.get("text-rotation-alignment")==="map"&&Es.get("symbol-placement")!=="point",Ra=Es.get("icon-rotation-alignment")==="map"&&Es.get("symbol-placement")!=="point",Zc=Es.get("symbol-placement"),bd=xd/2,Zp=Es.get("icon-text-fit");Za&&Zp!=="none"&&(wa.allowVerticalPlacement&&go.vertical&&(Fl=Ri(Za,go.vertical,Zp,Es.get("icon-text-fit-padding"),xc,_d)),Uc&&(Za=Ri(Za,Uc,Zp,Es.get("icon-text-fit-padding"),xc,_d)));var Ph=function(c0,qp){qp.x<0||qp.x>=8192||qp.y<0||qp.y>=8192||function(ps,qu,$p,Lh,f0,h0,jf,ec,p0,Yd,d0,hp,Uu,B0,Td,Kp,Md,qd,Dl,N0,bc,v0,cv,pf,Vc){var X,Rh,pp,Oh,Qp,Jp=ps.addToLineVertexArray(qu,$p),z0=0,U0=0,sh=0,m0=0,g0=-1,jc=-1,uh={},Z0=Fe(""),y0=0,$d=0;if(ec._unevaluatedLayout.getValue("text-radial-offset")===void 0?(y0=(X=ec.layout.get("text-offset").evaluate(bc,{},pf).map(function(Pd){return 24*Pd}))[0],$d=X[1]):(y0=24*ec.layout.get("text-radial-offset").evaluate(bc,{},pf),$d=_s),ps.allowVerticalPlacement&&Lh.vertical){var V0=ec.layout.get("text-rotate").evaluate(bc,{},pf)+90;Oh=new ks(p0,qu,Yd,d0,hp,Lh.vertical,Uu,B0,Td,V0),jf&&(Qp=new ks(p0,qu,Yd,d0,hp,jf,Md,qd,Td,V0))}if(f0){var _0=ec.layout.get("icon-rotate").evaluate(bc,{}),Kd=ec.layout.get("icon-text-fit")!=="none",Qd=Ys(f0,_0,cv,Kd),kd=jf?Ys(jf,_0,cv,Kd):void 0;pp=new ks(p0,qu,Yd,d0,hp,f0,Md,qd,!1,_0),z0=4*Qd.length;var dp=ps.iconSizeData,vp=null;dp.kind==="source"?(vp=[128*ec.layout.get("icon-size").evaluate(bc,{})])[0]>32640&&st(ps.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):dp.kind==="composite"&&((vp=[128*v0.compositeIconSizes[0].evaluate(bc,{},pf),128*v0.compositeIconSizes[1].evaluate(bc,{},pf)])[0]>32640||vp[1]>32640)&&st(ps.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),ps.addSymbols(ps.icon,Qd,vp,N0,Dl,bc,!1,qu,Jp.lineStartIndex,Jp.lineLength,-1,pf),g0=ps.icon.placedSymbolArray.length-1,kd&&(U0=4*kd.length,ps.addSymbols(ps.icon,kd,vp,N0,Dl,bc,fn.vertical,qu,Jp.lineStartIndex,Jp.lineLength,-1,pf),jc=ps.icon.placedSymbolArray.length-1)}for(var j0 in Lh.horizontal){var mp=Lh.horizontal[j0];if(!Rh){Z0=Fe(mp.text);var fv=ec.layout.get("text-rotate").evaluate(bc,{},pf);Rh=new ks(p0,qu,Yd,d0,hp,mp,Uu,B0,Td,fv)}var gp=mp.positionedLines.length===1;if(sh+=Wt(ps,qu,mp,h0,ec,Td,bc,Kp,Jp,Lh.vertical?fn.horizontal:fn.horizontalOnly,gp?Object.keys(Lh.horizontal):[j0],uh,g0,v0,pf),gp)break}Lh.vertical&&(m0+=Wt(ps,qu,Lh.vertical,h0,ec,Td,bc,Kp,Jp,fn.vertical,["vertical"],uh,jc,v0,pf));var Id=Rh?Rh.boxStartIndex:ps.collisionBoxArray.length,Wv=Rh?Rh.boxEndIndex:ps.collisionBoxArray.length,yp=Oh?Oh.boxStartIndex:ps.collisionBoxArray.length,Xv=Oh?Oh.boxEndIndex:ps.collisionBoxArray.length,Yv=pp?pp.boxStartIndex:ps.collisionBoxArray.length,qv=pp?pp.boxEndIndex:ps.collisionBoxArray.length,$v=Qp?Qp.boxStartIndex:ps.collisionBoxArray.length,Kv=Qp?Qp.boxEndIndex:ps.collisionBoxArray.length,Bl=-1,Jd=function(Pd,Cs){return Pd&&Pd.circleDiameter?Math.max(Pd.circleDiameter,Cs):Cs};Bl=Jd(Rh,Bl),Bl=Jd(Oh,Bl),Bl=Jd(pp,Bl);var _p=(Bl=Jd(Qp,Bl))>-1?1:0;_p&&(Bl*=Vc/24),ps.glyphOffsetArray.length>=Ge.MAX_GLYPHS&&st("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),bc.sortKey!==void 0&&ps.addToSortKeyRanges(ps.symbolInstances.length,bc.sortKey),ps.symbolInstances.emplaceBack(qu.x,qu.y,uh.right>=0?uh.right:-1,uh.center>=0?uh.center:-1,uh.left>=0?uh.left:-1,uh.vertical||-1,g0,jc,Z0,Id,Wv,yp,Xv,Yv,qv,$v,Kv,Yd,sh,m0,z0,U0,_p,0,Uu,y0,$d,Bl)}(wa,qp,c0,go,Za,dl,Fl,wa.layers[0],wa.collisionBoxArray,Co.index,Co.sourceLayerIndex,wa.index,ip,Up,op,gu,Ih,ap,Ra,xc,Co,Tu,Da,vl,Go)};if(Zc==="line")for(var Vf=0,Xd=rs(Co.geometry,0,0,8192,8192);Vf<Xd.length;Vf+=1)for(var Vp=Xd[Vf],jp=0,Ed=Ns(Vp,xd,Zf,go.vertical||Uc,Za,24,zp,wa.overscaling,8192);jp<Ed.length;jp+=1){var Gp=Ed[jp];Uc&&Un(wa,Uc.text,bd,Gp)||Ph(Vp,Gp)}else if(Zc==="line-center")for(var Hp=0,Wp=Co.geometry;Hp<Wp.length;Hp+=1){var Xp=Wp[Hp];if(Xp.length>1){var Yp=Mo(Xp,Zf,go.vertical||Uc,Za,24,zp);Yp&&Ph(Xp,Yp)}}else if(Co.type==="Polygon")for(var sp=0,Cd=xh(Co.geometry,0);sp<Cd.length;sp+=1){var up=Cd[sp],lp=zi(up,16);Ph(up[0],new yn(lp.x,lp.y,0))}else if(Co.type==="LineString")for(var hf=0,Sd=Co.geometry;hf<Sd.length;hf+=1){var wd=Sd[hf];Ph(wd,new yn(wd[0].x,wd[0].y,0))}else if(Co.type==="Point")for(var Ad=0,da=Co.geometry;Ad<da.length;Ad+=1)for(var ca=0,cp=da[Ad];ca<cp.length;ca+=1){var fp=cp[ca];Ph([fp],new yn(fp.x,fp.y,0))}}(n,$t,Zn,hs,d,W,Sn,yi,Nn,Au,A)},Rt=0,Jt=n.features;Rt<Jt.length;Rt+=1)Et();C&&n.generateCollisionDebugBuffers()},x.perspective=function(n,s,l,d,_){var C,A=1/Math.tan(s/2);return n[0]=A/l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=A,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,_!=null&&_!==1/0?(n[10]=(_+d)*(C=1/(d-_)),n[14]=2*_*d*C):(n[10]=-1,n[14]=-2*d),n},x.pick=function(n,s){for(var l={},d=0;d<s.length;d++){var _=s[d];_ in n&&(l[_]=n[_])}return l},x.plugin=Os,x.polygonIntersectsPolygon=Xl,x.postMapLoadEvent=Mr,x.postTurnstileEvent=Gt,x.potpack=Xr,x.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],x.register=tn,x.registerForPluginStateChange=function(n){return n({pluginStatus:Eu,pluginURL:zn}),ld.on("pluginStateChange",n),n},x.renderColorRamp=Rl,x.rotate=function(n,s,l){var d=s[0],_=s[1],C=s[2],A=s[3],L=Math.sin(l),z=Math.cos(l);return n[0]=d*z+C*L,n[1]=_*z+A*L,n[2]=d*-L+C*z,n[3]=_*-L+A*z,n},x.rotateX=function(n,s,l){var d=Math.sin(l),_=Math.cos(l),C=s[4],A=s[5],L=s[6],z=s[7],W=s[8],q=s[9],J=s[10],se=s[11];return s!==n&&(n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[3],n[12]=s[12],n[13]=s[13],n[14]=s[14],n[15]=s[15]),n[4]=C*_+W*d,n[5]=A*_+q*d,n[6]=L*_+J*d,n[7]=z*_+se*d,n[8]=W*_-C*d,n[9]=q*_-A*d,n[10]=J*_-L*d,n[11]=se*_-z*d,n},x.rotateZ=function(n,s,l){var d=Math.sin(l),_=Math.cos(l),C=s[0],A=s[1],L=s[2],z=s[3],W=s[4],q=s[5],J=s[6],se=s[7];return s!==n&&(n[8]=s[8],n[9]=s[9],n[10]=s[10],n[11]=s[11],n[12]=s[12],n[13]=s[13],n[14]=s[14],n[15]=s[15]),n[0]=C*_+W*d,n[1]=A*_+q*d,n[2]=L*_+J*d,n[3]=z*_+se*d,n[4]=W*_-C*d,n[5]=q*_-A*d,n[6]=J*_-L*d,n[7]=se*_-z*d,n},x.scale=function(n,s,l){var d=l[0],_=l[1],C=l[2];return n[0]=s[0]*d,n[1]=s[1]*d,n[2]=s[2]*d,n[3]=s[3]*d,n[4]=s[4]*_,n[5]=s[5]*_,n[6]=s[6]*_,n[7]=s[7]*_,n[8]=s[8]*C,n[9]=s[9]*C,n[10]=s[10]*C,n[11]=s[11]*C,n[12]=s[12],n[13]=s[13],n[14]=s[14],n[15]=s[15],n},x.scale$1=function(n,s,l){return n[0]=s[0]*l,n[1]=s[1]*l,n[2]=s[2]*l,n[3]=s[3]*l,n},x.scale$2=function(n,s,l){return n[0]=s[0]*l,n[1]=s[1]*l,n[2]=s[2]*l,n},x.setCacheLimits=function(n,s){Yn=n,Fi=s},x.setRTLTextPlugin=function(n,s,l){if(l===void 0&&(l=!1),Eu==="deferred"||Eu==="loading"||Eu==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");zn=Gi.resolveURL(n),Eu="deferred",wl=s,Qf(),l||nl()},x.sphericalToCartesian=function(n){var s=n[0],l=n[1],d=n[2];return l+=90,l*=Math.PI/180,d*=Math.PI/180,{x:s*Math.cos(l)*Math.sin(d),y:s*Math.sin(l)*Math.sin(d),z:s*Math.cos(d)}},x.sqrLen=function(n){var s=n[0],l=n[1];return s*s+l*l},x.styleSpec=_e,x.sub=function(n,s,l){return n[0]=s[0]-l[0],n[1]=s[1]-l[1],n[2]=s[2]-l[2],n},x.symbolSize=xa,x.transformMat3=function(n,s,l){var d=s[0],_=s[1],C=s[2];return n[0]=d*l[0]+_*l[3]+C*l[6],n[1]=d*l[1]+_*l[4]+C*l[7],n[2]=d*l[2]+_*l[5]+C*l[8],n},x.transformMat4=$h,x.translate=function(n,s,l){var d,_,C,A,L,z,W,q,J,se,de,Be,Ve=l[0],at=l[1],$e=l[2];return s===n?(n[12]=s[0]*Ve+s[4]*at+s[8]*$e+s[12],n[13]=s[1]*Ve+s[5]*at+s[9]*$e+s[13],n[14]=s[2]*Ve+s[6]*at+s[10]*$e+s[14],n[15]=s[3]*Ve+s[7]*at+s[11]*$e+s[15]):(_=s[1],C=s[2],A=s[3],L=s[4],z=s[5],W=s[6],q=s[7],J=s[8],se=s[9],de=s[10],Be=s[11],n[0]=d=s[0],n[1]=_,n[2]=C,n[3]=A,n[4]=L,n[5]=z,n[6]=W,n[7]=q,n[8]=J,n[9]=se,n[10]=de,n[11]=Be,n[12]=d*Ve+L*at+J*$e+s[12],n[13]=_*Ve+z*at+se*$e+s[13],n[14]=C*Ve+W*at+de*$e+s[14],n[15]=A*Ve+q*at+Be*$e+s[15]),n},x.triggerPluginCompletionEvent=Mp,x.uniqueId=On,x.validateCustomStyleLayer=function(n){var s=[],l=n.id;return l===void 0&&s.push({message:"layers."+l+': missing required property "id"'}),n.render===void 0&&s.push({message:"layers."+l+': missing required method "render"'}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&s.push({message:"layers."+l+': property "renderingMode" must be either "2d" or "3d"'}),s},x.validateLight=rl,x.validateStyle=Pc,x.values=function(n){var s=[];for(var l in n)s.push(n[l]);return s},x.vectorTile=Nu,x.version="1.13.2",x.warnOnce=st,x.webpSupported=Rn,x.window=Xe,x.wrap=ur}),Ft(["./shared"],function(x){"use strict";function Jr($){var ne=typeof $;if(ne==="number"||ne==="boolean"||ne==="string"||$==null)return JSON.stringify($);if(Array.isArray($)){for(var he="[",be=0,Ne=$;be<Ne.length;be+=1)he+=Jr(Ne[be])+",";return he+"]"}for(var Ye=Object.keys($).sort(),lt="{",_e=0;_e<Ye.length;_e++)lt+=JSON.stringify(Ye[_e])+":"+Jr($[Ye[_e]])+",";return lt+"}"}function tt($){for(var ne="",he=0,be=x.refProperties;he<be.length;he+=1)ne+="/"+Jr($[be[he]]);return ne}var Tr=function($){this.keyCache={},$&&this.replace($)};Tr.prototype.replace=function($){this._layerConfigs={},this._layers={},this.update($,[])},Tr.prototype.update=function($,ne){for(var he=this,be=0,Ne=$;be<Ne.length;be+=1){var Ye=Ne[be];this._layerConfigs[Ye.id]=Ye;var lt=this._layers[Ye.id]=x.createStyleLayer(Ye);lt._featureFilter=x.featureFilter(lt.filter),this.keyCache[Ye.id]&&delete this.keyCache[Ye.id]}for(var _e=0,je=ne;_e<je.length;_e+=1){var Mt=je[_e];delete this.keyCache[Mt],delete this._layerConfigs[Mt],delete this._layers[Mt]}this.familiesBySource={};for(var Sr=0,zt=function(on,cn){for(var $i={},Cn=0;Cn<on.length;Cn++){var xt=cn&&cn[on[Cn].id]||tt(on[Cn]);cn&&(cn[on[Cn].id]=xt);var St=$i[xt];St||(St=$i[xt]=[]),St.push(on[Cn])}var qi=[];for(var na in $i)qi.push($i[na]);return qi}(x.values(this._layerConfigs),this.keyCache);Sr<zt.length;Sr+=1){var Yt=zt[Sr].map(function(on){return he._layers[on.id]}),Lr=Yt[0];if(Lr.visibility!=="none"){var $n=Lr.source||"",vn=this.familiesBySource[$n];vn||(vn=this.familiesBySource[$n]={});var Nt=Lr.sourceLayer||"_geojsonTileLayer",pr=vn[Nt];pr||(pr=vn[Nt]=[]),pr.push(Yt)}}};var rt=function($){var ne={},he=[];for(var be in $){var Ne=$[be],Ye=ne[be]={};for(var lt in Ne){var _e=Ne[+lt];if(_e&&_e.bitmap.width!==0&&_e.bitmap.height!==0){var je={x:0,y:0,w:_e.bitmap.width+2,h:_e.bitmap.height+2};he.push(je),Ye[lt]={rect:je,metrics:_e.metrics}}}}var Mt=x.potpack(he),Sr=new x.AlphaImage({width:Mt.w||1,height:Mt.h||1});for(var zt in $){var Yt=$[zt];for(var Lr in Yt){var $n=Yt[+Lr];if($n&&$n.bitmap.width!==0&&$n.bitmap.height!==0){var vn=ne[zt][Lr].rect;x.AlphaImage.copy($n.bitmap,Sr,{x:0,y:0},{x:vn.x+1,y:vn.y+1},$n.bitmap)}}}this.image=Sr,this.positions=ne};x.register("GlyphAtlas",rt);var fr=function($){this.tileID=new x.OverscaledTileID($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.uid=$.uid,this.zoom=$.zoom,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=$.showCollisionBoxes,this.collectResourceTiming=!!$.collectResourceTiming,this.returnDependencies=!!$.returnDependencies,this.promoteId=$.promoteId};function Xe($,ne,he){for(var be=new x.EvaluationParameters(ne),Ne=0,Ye=$;Ne<Ye.length;Ne+=1)Ye[Ne].recalculate(be,he)}function Kt($,ne){var he=x.getArrayBuffer($.request,function(be,Ne,Ye,lt){be?ne(be):Ne&&ne(null,{vectorTile:new x.vectorTile.VectorTile(new x.pbf(Ne)),rawData:Ne,cacheControl:Ye,expires:lt})});return function(){he.cancel(),ne()}}fr.prototype.parse=function($,ne,he,be,Ne){var Ye=this;this.status="parsing",this.data=$,this.collisionBoxArray=new x.CollisionBoxArray;var lt=new x.DictionaryCoder(Object.keys($.layers).sort()),_e=new x.FeatureIndex(this.tileID,this.promoteId);_e.bucketLayerIDs=[];var je,Mt,Sr,zt,Yt={},Lr={featureIndex:_e,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:he},$n=ne.familiesBySource[this.source];for(var vn in $n){var Nt=$.layers[vn];if(Nt){Nt.version===1&&x.warnOnce('Vector tile source "'+this.source+'" layer "'+vn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var pr=lt.encode(vn),on=[],cn=0;cn<Nt.length;cn++){var $i=Nt.feature(cn),Cn=_e.getId($i,vn);on.push({feature:$i,id:Cn,index:cn,sourceLayerIndex:pr})}for(var xt=0,St=$n[vn];xt<St.length;xt+=1){var qi=St[xt],na=qi[0];na.minzoom&&this.zoom<Math.floor(na.minzoom)||na.maxzoom&&this.zoom>=na.maxzoom||na.visibility!=="none"&&(Xe(qi,this.zoom,he),(Yt[na.id]=na.createBucket({index:_e.bucketLayerIDs.length,layers:qi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:pr,sourceID:this.source})).populate(on,Lr,this.tileID.canonical),_e.bucketLayerIDs.push(qi.map(function(mr){return mr.id})))}}}var ea=x.mapObject(Lr.glyphDependencies,function(mr){return Object.keys(mr).map(Number)});Object.keys(ea).length?be.send("getGlyphs",{uid:this.uid,stacks:ea},function(mr,lr){je||(je=mr,Mt=lr,fo.call(Ye))}):Mt={};var oi=Object.keys(Lr.iconDependencies);oi.length?be.send("getImages",{icons:oi,source:this.source,tileID:this.tileID,type:"icons"},function(mr,lr){je||(je=mr,Sr=lr,fo.call(Ye))}):Sr={};var Zi=Object.keys(Lr.patternDependencies);function fo(){if(je)return Ne(je);if(Mt&&Sr&&zt){var mr=new rt(Mt),lr=new x.ImageAtlas(Sr,zt);for(var nt in Yt){var Ya=Yt[nt];Ya instanceof x.SymbolBucket?(Xe(Ya.layers,this.zoom,he),x.performSymbolLayout(Ya,Mt,mr.positions,Sr,lr.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Ya.hasPattern&&(Ya instanceof x.LineBucket||Ya instanceof x.FillBucket||Ya instanceof x.FillExtrusionBucket)&&(Xe(Ya.layers,this.zoom,he),Ya.addFeatures(Lr,this.tileID.canonical,lr.patternPositions))}this.status="done",Ne(null,{buckets:x.values(Yt).filter(function(dt){return!dt.isEmpty()}),featureIndex:_e,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:mr.image,imageAtlas:lr,glyphMap:this.returnDependencies?Mt:null,iconMap:this.returnDependencies?Sr:null,glyphPositions:this.returnDependencies?mr.positions:null})}}Zi.length?be.send("getImages",{icons:Zi,source:this.source,tileID:this.tileID,type:"patterns"},function(mr,lr){je||(je=mr,zt=lr,fo.call(Ye))}):zt={},fo.call(this)};var hr=function($,ne,he,be){this.actor=$,this.layerIndex=ne,this.availableImages=he,this.loadVectorData=be||Kt,this.loading={},this.loaded={}};hr.prototype.loadTile=function($,ne){var he=this,be=$.uid;this.loading||(this.loading={});var Ne=!!($&&$.request&&$.request.collectResourceTiming)&&new x.RequestPerformance($.request),Ye=this.loading[be]=new fr($);Ye.abort=this.loadVectorData($,function(lt,_e){if(delete he.loading[be],lt||!_e)return Ye.status="done",he.loaded[be]=Ye,ne(lt);var je=_e.rawData,Mt={};_e.expires&&(Mt.expires=_e.expires),_e.cacheControl&&(Mt.cacheControl=_e.cacheControl);var Sr={};if(Ne){var zt=Ne.finish();zt&&(Sr.resourceTiming=JSON.parse(JSON.stringify(zt)))}Ye.vectorTile=_e.vectorTile,Ye.parse(_e.vectorTile,he.layerIndex,he.availableImages,he.actor,function(Yt,Lr){if(Yt||!Lr)return ne(Yt);ne(null,x.extend({rawTileData:je.slice(0)},Lr,Mt,Sr))}),he.loaded=he.loaded||{},he.loaded[be]=Ye})},hr.prototype.reloadTile=function($,ne){var he=this,be=this.loaded,Ne=$.uid,Ye=this;if(be&&be[Ne]){var lt=be[Ne];lt.showCollisionBoxes=$.showCollisionBoxes;var _e=function(je,Mt){var Sr=lt.reloadCallback;Sr&&(delete lt.reloadCallback,lt.parse(lt.vectorTile,Ye.layerIndex,he.availableImages,Ye.actor,Sr)),ne(je,Mt)};lt.status==="parsing"?lt.reloadCallback=_e:lt.status==="done"&&(lt.vectorTile?lt.parse(lt.vectorTile,this.layerIndex,this.availableImages,this.actor,_e):_e())}},hr.prototype.abortTile=function($,ne){var he=this.loading,be=$.uid;he&&he[be]&&he[be].abort&&(he[be].abort(),delete he[be]),ne()},hr.prototype.removeTile=function($,ne){var he=this.loaded,be=$.uid;he&&he[be]&&delete he[be],ne()};var jt=x.window.ImageBitmap,ar=function(){this.loaded={}};function ur($,ne){if($.length!==0){Ir($[0],ne);for(var he=1;he<$.length;he++)Ir($[he],!ne)}}function Ir($,ne){for(var he=0,be=0,Ne=$.length,Ye=Ne-1;be<Ne;Ye=be++)he+=($[be][0]-$[Ye][0])*($[Ye][1]+$[be][1]);he>=0!=!!ne&&$.reverse()}ar.prototype.loadTile=function($,ne){var he=$.uid,be=$.encoding,Ne=$.rawImageData,Ye=jt&&Ne instanceof jt?this.getImageData(Ne):Ne,lt=new x.DEMData(he,Ye,be);this.loaded=this.loaded||{},this.loaded[he]=lt,ne(null,lt)},ar.prototype.getImageData=function($){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas($.width,$.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=$.width,this.offscreenCanvas.height=$.height,this.offscreenCanvasContext.drawImage($,0,0,$.width,$.height);var ne=this.offscreenCanvasContext.getImageData(-1,-1,$.width+2,$.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new x.RGBAImage({width:ne.width,height:ne.height},ne.data)},ar.prototype.removeTile=function($){var ne=this.loaded,he=$.uid;ne&&ne[he]&&delete ne[he]};var Kn=x.vectorTile.VectorTileFeature.prototype.toGeoJSON,On=function($){this._feature=$,this.extent=x.EXTENT,this.type=$.type,this.properties=$.tags,"id"in $&&!isNaN($.id)&&(this.id=parseInt($.id,10))};On.prototype.loadGeometry=function(){if(this._feature.type===1){for(var $=[],ne=0,he=this._feature.geometry;ne<he.length;ne+=1){var be=he[ne];$.push([new x.Point$1(be[0],be[1])])}return $}for(var Ne=[],Ye=0,lt=this._feature.geometry;Ye<lt.length;Ye+=1){for(var _e=[],je=0,Mt=lt[Ye];je<Mt.length;je+=1){var Sr=Mt[je];_e.push(new x.Point$1(Sr[0],Sr[1]))}Ne.push(_e)}return Ne},On.prototype.toGeoJSON=function($,ne,he){return Kn.call(this,$,ne,he)};var an=function($){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=x.EXTENT,this.length=$.length,this._features=$};an.prototype.feature=function($){return new On(this._features[$])};var Pi=x.vectorTile.VectorTileFeature,ri=me;function me($,ne){this.options=ne||{},this.features=$,this.length=$.length}function _i($,ne){this.id=typeof $.id=="number"?$.id:void 0,this.type=$.type,this.rawGeometry=$.type===1?[$.geometry]:$.geometry,this.properties=$.tags,this.extent=ne||4096}me.prototype.feature=function($){return new _i(this.features[$],this.options.extent)},_i.prototype.loadGeometry=function(){var $=this.rawGeometry;this.geometry=[];for(var ne=0;ne<$.length;ne++){for(var he=$[ne],be=[],Ne=0;Ne<he.length;Ne++)be.push(new x.Point$1(he[Ne][0],he[Ne][1]));this.geometry.push(be)}return this.geometry},_i.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var $=this.geometry,ne=1/0,he=-1/0,be=1/0,Ne=-1/0,Ye=0;Ye<$.length;Ye++)for(var lt=$[Ye],_e=0;_e<lt.length;_e++){var je=lt[_e];ne=Math.min(ne,je.x),he=Math.max(he,je.x),be=Math.min(be,je.y),Ne=Math.max(Ne,je.y)}return[ne,be,he,Ne]},_i.prototype.toGeoJSON=Pi.prototype.toGeoJSON;var Rr=zr,ir=ri;function zr($){var ne=new x.pbf;return function(he,be){for(var Ne in he.layers)be.writeMessage(3,st,he.layers[Ne])}($,ne),ne.finish()}function st($,ne){var he;ne.writeVarintField(15,$.version||1),ne.writeStringField(1,$.name||""),ne.writeVarintField(5,$.extent||4096);var be={keys:[],values:[],keycache:{},valuecache:{}};for(he=0;he<$.length;he++)be.feature=$.feature(he),ne.writeMessage(2,en,be);var Ne=be.keys;for(he=0;he<Ne.length;he++)ne.writeStringField(3,Ne[he]);var Ye=be.values;for(he=0;he<Ye.length;he++)ne.writeMessage(4,Ze,Ye[he])}function en($,ne){var he=$.feature;he.id!==void 0&&ne.writeVarintField(1,he.id),ne.writeMessage(2,Wn,$),ne.writeVarintField(3,he.type),ne.writeMessage(4,Z,he)}function Wn($,ne){var he=$.feature,be=$.keys,Ne=$.values,Ye=$.keycache,lt=$.valuecache;for(var _e in he.properties){var je=Ye[_e];je===void 0&&(be.push(_e),Ye[_e]=je=be.length-1),ne.writeVarint(je);var Mt=he.properties[_e],Sr=typeof Mt;Sr!=="string"&&Sr!=="boolean"&&Sr!=="number"&&(Mt=JSON.stringify(Mt));var zt=Sr+":"+Mt,Yt=lt[zt];Yt===void 0&&(Ne.push(Mt),lt[zt]=Yt=Ne.length-1),ne.writeVarint(Yt)}}function ce($,ne){return(ne<<3)+(7&$)}function Ee($){return $<<1^$>>31}function Z($,ne){for(var he=$.loadGeometry(),be=$.type,Ne=0,Ye=0,lt=he.length,_e=0;_e<lt;_e++){var je=he[_e],Mt=1;be===1&&(Mt=je.length),ne.writeVarint(ce(1,Mt));for(var Sr=be===3?je.length-1:je.length,zt=0;zt<Sr;zt++){zt===1&&be!==1&&ne.writeVarint(ce(2,Sr-1));var Yt=je[zt].x-Ne,Lr=je[zt].y-Ye;ne.writeVarint(Ee(Yt)),ne.writeVarint(Ee(Lr)),Ne+=Yt,Ye+=Lr}be===3&&ne.writeVarint(ce(7,1))}}function Ze($,ne){var he=typeof $;he==="string"?ne.writeStringField(1,$):he==="boolean"?ne.writeBooleanField(7,$):he==="number"&&($%1!=0?ne.writeDoubleField(3,$):$<0?ne.writeSVarintField(6,$):ne.writeVarintField(5,$))}function Pe($,ne,he,be){ft($,he,be),ft(ne,2*he,2*be),ft(ne,2*he+1,2*be+1)}function ft($,ne,he){var be=$[ne];$[ne]=$[he],$[he]=be}function It($,ne,he,be){var Ne=$-he,Ye=ne-be;return Ne*Ne+Ye*Ye}Rr.fromVectorTileJs=zr,Rr.fromGeojsonVt=function($,ne){ne=ne||{};var he={};for(var be in $)he[be]=new ri($[be].features,ne),he[be].name=be,he[be].version=ne.version,he[be].extent=ne.extent;return zr({layers:he})},Rr.GeoJSONWrapper=ir;var qt=function($){return $[0]},yt=function($){return $[1]},cr=function($,ne,he,be,Ne){ne===void 0&&(ne=qt),he===void 0&&(he=yt),be===void 0&&(be=64),Ne===void 0&&(Ne=Float64Array),this.nodeSize=be,this.points=$;for(var Ye=$.length<65536?Uint16Array:Uint32Array,lt=this.ids=new Ye($.length),_e=this.coords=new Ne(2*$.length),je=0;je<$.length;je++)lt[je]=je,_e[2*je]=ne($[je]),_e[2*je+1]=he($[je]);(function Mt(Sr,zt,Yt,Lr,$n,vn){if(!($n-Lr<=Yt)){var Nt=Lr+$n>>1;(function pr(on,cn,$i,Cn,xt,St){for(;xt>Cn;){if(xt-Cn>600){var qi=xt-Cn+1,na=$i-Cn+1,ea=Math.log(qi),oi=.5*Math.exp(2*ea/3),Zi=.5*Math.sqrt(ea*oi*(qi-oi)/qi)*(na-qi/2<0?-1:1);pr(on,cn,$i,Math.max(Cn,Math.floor($i-na*oi/qi+Zi)),Math.min(xt,Math.floor($i+(qi-na)*oi/qi+Zi)),St)}var fo=cn[2*$i+St],mr=Cn,lr=xt;for(Pe(on,cn,Cn,$i),cn[2*xt+St]>fo&&Pe(on,cn,Cn,xt);mr<lr;){for(Pe(on,cn,mr,lr),mr++,lr--;cn[2*mr+St]<fo;)mr++;for(;cn[2*lr+St]>fo;)lr--}cn[2*Cn+St]===fo?Pe(on,cn,Cn,lr):Pe(on,cn,++lr,xt),lr<=$i&&(Cn=lr+1),$i<=lr&&(xt=lr-1)}})(Sr,zt,Nt,Lr,$n,vn%2),Mt(Sr,zt,Yt,Lr,Nt-1,vn+1),Mt(Sr,zt,Yt,Nt+1,$n,vn+1)}})(lt,_e,be,0,lt.length-1,0)};cr.prototype.range=function($,ne,he,be){return function(Ne,Ye,lt,_e,je,Mt,Sr){for(var zt,Yt,Lr=[0,Ne.length-1,0],$n=[];Lr.length;){var vn=Lr.pop(),Nt=Lr.pop(),pr=Lr.pop();if(Nt-pr<=Sr)for(var on=pr;on<=Nt;on++)Yt=Ye[2*on+1],(zt=Ye[2*on])>=lt&&zt<=je&&Yt>=_e&&Yt<=Mt&&$n.push(Ne[on]);else{var cn=Math.floor((pr+Nt)/2);Yt=Ye[2*cn+1],(zt=Ye[2*cn])>=lt&&zt<=je&&Yt>=_e&&Yt<=Mt&&$n.push(Ne[cn]);var $i=(vn+1)%2;(vn===0?lt<=zt:_e<=Yt)&&(Lr.push(pr),Lr.push(cn-1),Lr.push($i)),(vn===0?je>=zt:Mt>=Yt)&&(Lr.push(cn+1),Lr.push(Nt),Lr.push($i))}}return $n}(this.ids,this.coords,$,ne,he,be,this.nodeSize)},cr.prototype.within=function($,ne,he){return function(be,Ne,Ye,lt,_e,je){for(var Mt=[0,be.length-1,0],Sr=[],zt=_e*_e;Mt.length;){var Yt=Mt.pop(),Lr=Mt.pop(),$n=Mt.pop();if(Lr-$n<=je)for(var vn=$n;vn<=Lr;vn++)It(Ne[2*vn],Ne[2*vn+1],Ye,lt)<=zt&&Sr.push(be[vn]);else{var Nt=Math.floor(($n+Lr)/2),pr=Ne[2*Nt],on=Ne[2*Nt+1];It(pr,on,Ye,lt)<=zt&&Sr.push(be[Nt]);var cn=(Yt+1)%2;(Yt===0?Ye-_e<=pr:lt-_e<=on)&&(Mt.push($n),Mt.push(Nt-1),Mt.push(cn)),(Yt===0?Ye+_e>=pr:lt+_e>=on)&&(Mt.push(Nt+1),Mt.push(Lr),Mt.push(cn))}}return Sr}(this.ids,this.coords,$,ne,he,this.nodeSize)};var Xn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function($){return $}},Vn=function($){this.options=Ca(Object.create(Xn),$),this.trees=new Array(this.options.maxZoom+1)};function Gi($,ne,he,be,Ne){return{x:$,y:ne,zoom:1/0,id:he,parentId:-1,numPoints:be,properties:Ne}}function ai($,ne){var he=$.geometry.coordinates,be=he[1];return{x:oa(he[0]),y:Ti(be),zoom:1/0,index:ne,parentId:-1}}function Rn($){return{type:"Feature",id:$.id,properties:Ba($),geometry:{type:"Point",coordinates:[(be=$.x,360*(be-.5)),(ne=$.y,he=(180-360*ne)*Math.PI/180,360*Math.atan(Math.exp(he))/Math.PI-90)]}};var ne,he,be}function Ba($){var ne=$.numPoints,he=ne>=1e4?Math.round(ne/1e3)+"k":ne>=1e3?Math.round(ne/100)/10+"k":ne;return Ca(Ca({},$.properties),{cluster:!0,cluster_id:$.id,point_count:ne,point_count_abbreviated:he})}function oa($){return $/360+.5}function Ti($){var ne=Math.sin($*Math.PI/180),he=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return he<0?0:he>1?1:he}function Ca($,ne){for(var he in ne)$[he]=ne[he];return $}function xi($){return $.x}function Hi($){return $.y}function vi($,ne,he,be,Ne,Ye){var lt=Ne-he,_e=Ye-be;if(lt!==0||_e!==0){var je=(($-he)*lt+(ne-be)*_e)/(lt*lt+_e*_e);je>1?(he=Ne,be=Ye):je>0&&(he+=lt*je,be+=_e*je)}return(lt=$-he)*lt+(_e=ne-be)*_e}function mi($,ne,he,be){var Ne={id:$===void 0?null:$,type:ne,geometry:he,tags:be,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ye){var lt=Ye.geometry,_e=Ye.type;if(_e==="Point"||_e==="MultiPoint"||_e==="LineString")ss(Ye,lt);else if(_e==="Polygon"||_e==="MultiLineString")for(var je=0;je<lt.length;je++)ss(Ye,lt[je]);else if(_e==="MultiPolygon")for(je=0;je<lt.length;je++)for(var Mt=0;Mt<lt[je].length;Mt++)ss(Ye,lt[je][Mt])}(Ne),Ne}function ss($,ne){for(var he=0;he<ne.length;he+=3)$.minX=Math.min($.minX,ne[he]),$.minY=Math.min($.minY,ne[he+1]),$.maxX=Math.max($.maxX,ne[he]),$.maxY=Math.max($.maxY,ne[he+1])}function Po($,ne,he,be){if(ne.geometry){var Ne=ne.geometry.coordinates,Ye=ne.geometry.type,lt=Math.pow(he.tolerance/((1<<he.maxZoom)*he.extent),2),_e=[],je=ne.id;if(he.promoteId?je=ne.properties[he.promoteId]:he.generateId&&(je=be||0),Ye==="Point")ao(Ne,_e);else if(Ye==="MultiPoint")for(var Mt=0;Mt<Ne.length;Mt++)ao(Ne[Mt],_e);else if(Ye==="LineString")bt(Ne,_e,lt,!1);else if(Ye==="MultiLineString"){if(he.lineMetrics){for(Mt=0;Mt<Ne.length;Mt++)bt(Ne[Mt],_e=[],lt,!1),$.push(mi(je,"LineString",_e,ne.properties));return}pe(Ne,_e,lt,!1)}else if(Ye==="Polygon")pe(Ne,_e,lt,!0);else{if(Ye!=="MultiPolygon"){if(Ye==="GeometryCollection"){for(Mt=0;Mt<ne.geometry.geometries.length;Mt++)Po($,{id:je,geometry:ne.geometry.geometries[Mt],properties:ne.properties},he,be);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Mt=0;Mt<Ne.length;Mt++){var Sr=[];pe(Ne[Mt],Sr,lt,!0),_e.push(Sr)}}$.push(mi(je,Ye,_e,ne.properties))}}function ao($,ne){ne.push(ie($[0])),ne.push(Ce($[1])),ne.push(0)}function bt($,ne,he,be){for(var Ne,Ye,lt=0,_e=0;_e<$.length;_e++){var je=ie($[_e][0]),Mt=Ce($[_e][1]);ne.push(je),ne.push(Mt),ne.push(0),_e>0&&(lt+=be?(Ne*Mt-je*Ye)/2:Math.sqrt(Math.pow(je-Ne,2)+Math.pow(Mt-Ye,2))),Ne=je,Ye=Mt}var Sr=ne.length-3;ne[2]=1,function zt(Yt,Lr,$n,vn){for(var Nt,pr=vn,on=$n-Lr>>1,cn=$n-Lr,$i=Yt[Lr],Cn=Yt[Lr+1],xt=Yt[$n],St=Yt[$n+1],qi=Lr+3;qi<$n;qi+=3){var na=vi(Yt[qi],Yt[qi+1],$i,Cn,xt,St);if(na>pr)Nt=qi,pr=na;else if(na===pr){var ea=Math.abs(qi-on);ea<cn&&(Nt=qi,cn=ea)}}pr>vn&&(Nt-Lr>3&&zt(Yt,Lr,Nt,vn),Yt[Nt+2]=pr,$n-Nt>3&&zt(Yt,Nt,$n,vn))}(ne,0,Sr,he),ne[Sr+2]=1,ne.size=Math.abs(lt),ne.start=0,ne.end=ne.size}function pe($,ne,he,be){for(var Ne=0;Ne<$.length;Ne++){var Ye=[];bt($[Ne],Ye,he,be),ne.push(Ye)}}function ie($){return $/360+.5}function Ce($){var ne=Math.sin($*Math.PI/180),he=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return he<0?0:he>1?1:he}function V($,ne,he,be,Ne,Ye,lt,_e){if(be/=ne,Ye>=(he/=ne)&&lt<be)return $;if(lt<he||Ye>=be)return null;for(var je=[],Mt=0;Mt<$.length;Mt++){var Sr=$[Mt],zt=Sr.geometry,Yt=Sr.type,Lr=Ne===0?Sr.minX:Sr.minY,$n=Ne===0?Sr.maxX:Sr.maxY;if(Lr>=he&&$n<be)je.push(Sr);else if(!($n<he||Lr>=be)){var vn=[];if(Yt==="Point"||Yt==="MultiPoint")We(zt,vn,he,be,Ne);else if(Yt==="LineString")Gt(zt,vn,he,be,Ne,!1,_e.lineMetrics);else if(Yt==="MultiLineString")Mr(zt,vn,he,be,Ne,!1);else if(Yt==="Polygon")Mr(zt,vn,he,be,Ne,!0);else if(Yt==="MultiPolygon")for(var Nt=0;Nt<zt.length;Nt++){var pr=[];Mr(zt[Nt],pr,he,be,Ne,!0),pr.length&&vn.push(pr)}if(vn.length){if(_e.lineMetrics&&Yt==="LineString"){for(Nt=0;Nt<vn.length;Nt++)je.push(mi(Sr.id,Yt,vn[Nt],Sr.tags));continue}Yt!=="LineString"&&Yt!=="MultiLineString"||(vn.length===1?(Yt="LineString",vn=vn[0]):Yt="MultiLineString"),Yt!=="Point"&&Yt!=="MultiPoint"||(Yt=vn.length===3?"Point":"MultiPoint"),je.push(mi(Sr.id,Yt,vn,Sr.tags))}}}return je.length?je:null}function We($,ne,he,be,Ne){for(var Ye=0;Ye<$.length;Ye+=3){var lt=$[Ye+Ne];lt>=he&&lt<=be&&(ne.push($[Ye]),ne.push($[Ye+1]),ne.push($[Ye+2]))}}function Gt($,ne,he,be,Ne,Ye,lt){for(var _e,je,Mt=Vr($),Sr=Ne===0?Fi:Qn,zt=$.start,Yt=0;Yt<$.length-3;Yt+=3){var Lr=$[Yt],$n=$[Yt+1],vn=$[Yt+2],Nt=$[Yt+3],pr=$[Yt+4],on=Ne===0?Lr:$n,cn=Ne===0?Nt:pr,$i=!1;lt&&(_e=Math.sqrt(Math.pow(Lr-Nt,2)+Math.pow($n-pr,2))),on<he?cn>he&&(je=Sr(Mt,Lr,$n,Nt,pr,he),lt&&(Mt.start=zt+_e*je)):on>be?cn<be&&(je=Sr(Mt,Lr,$n,Nt,pr,be),lt&&(Mt.start=zt+_e*je)):Yn(Mt,Lr,$n,vn),cn<he&&on>=he&&(je=Sr(Mt,Lr,$n,Nt,pr,he),$i=!0),cn>be&&on<=be&&(je=Sr(Mt,Lr,$n,Nt,pr,be),$i=!0),!Ye&&$i&&(lt&&(Mt.end=zt+_e*je),ne.push(Mt),Mt=Vr($)),lt&&(zt+=_e)}var Cn=$.length-3;Lr=$[Cn],$n=$[Cn+1],vn=$[Cn+2],(on=Ne===0?Lr:$n)>=he&&on<=be&&Yn(Mt,Lr,$n,vn),Cn=Mt.length-3,Ye&&Cn>=3&&(Mt[Cn]!==Mt[0]||Mt[Cn+1]!==Mt[1])&&Yn(Mt,Mt[0],Mt[1],Mt[2]),Mt.length&&ne.push(Mt)}function Vr($){var ne=[];return ne.size=$.size,ne.start=$.start,ne.end=$.end,ne}function Mr($,ne,he,be,Ne,Ye){for(var lt=0;lt<$.length;lt++)Gt($[lt],ne,he,be,Ne,Ye,!1)}function Yn($,ne,he,be){$.push(ne),$.push(he),$.push(be)}function Fi($,ne,he,be,Ne,Ye){var lt=(Ye-ne)/(be-ne);return $.push(Ye),$.push(he+(Ne-he)*lt),$.push(1),lt}function Qn($,ne,he,be,Ne,Ye){var lt=(Ye-he)/(Ne-he);return $.push(ne+(be-ne)*lt),$.push(Ye),$.push(1),lt}function Bn($,ne){for(var he=[],be=0;be<$.length;be++){var Ne,Ye=$[be],lt=Ye.type;if(lt==="Point"||lt==="MultiPoint"||lt==="LineString")Ne=Fn(Ye.geometry,ne);else if(lt==="MultiLineString"||lt==="Polygon"){Ne=[];for(var _e=0;_e<Ye.geometry.length;_e++)Ne.push(Fn(Ye.geometry[_e],ne))}else if(lt==="MultiPolygon")for(Ne=[],_e=0;_e<Ye.geometry.length;_e++){for(var je=[],Mt=0;Mt<Ye.geometry[_e].length;Mt++)je.push(Fn(Ye.geometry[_e][Mt],ne));Ne.push(je)}he.push(mi(Ye.id,lt,Ne,Ye.tags))}return he}function Fn($,ne){var he=[];he.size=$.size,$.start!==void 0&&(he.start=$.start,he.end=$.end);for(var be=0;be<$.length;be+=3)he.push($[be]+ne,$[be+1],$[be+2]);return he}function eo($,ne){if($.transformed)return $;var he,be,Ne,Ye=1<<$.z,lt=$.x,_e=$.y;for(he=0;he<$.features.length;he++){var je=$.features[he],Mt=je.geometry,Sr=je.type;if(je.geometry=[],Sr===1)for(be=0;be<Mt.length;be+=2)je.geometry.push(va(Mt[be],Mt[be+1],ne,Ye,lt,_e));else for(be=0;be<Mt.length;be++){var zt=[];for(Ne=0;Ne<Mt[be].length;Ne+=2)zt.push(va(Mt[be][Ne],Mt[be][Ne+1],ne,Ye,lt,_e));je.geometry.push(zt)}}return $.transformed=!0,$}function va($,ne,he,be,Ne,Ye){return[Math.round(he*($*be-Ne)),Math.round(he*(ne*be-Ye))]}function Yi($,ne,he,be,Ne){for(var Ye=ne===Ne.maxZoom?0:Ne.tolerance/((1<<ne)*Ne.extent),lt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:he,y:be,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},_e=0;_e<$.length;_e++){lt.numFeatures++,Lo(lt,$[_e],Ye,Ne);var je=$[_e].minX,Mt=$[_e].minY,Sr=$[_e].maxX,zt=$[_e].maxY;je<lt.minX&&(lt.minX=je),Mt<lt.minY&&(lt.minY=Mt),Sr>lt.maxX&&(lt.maxX=Sr),zt>lt.maxY&&(lt.maxY=zt)}return lt}function Lo($,ne,he,be){var Ne=ne.geometry,Ye=ne.type,lt=[];if(Ye==="Point"||Ye==="MultiPoint")for(var _e=0;_e<Ne.length;_e+=3)lt.push(Ne[_e]),lt.push(Ne[_e+1]),$.numPoints++,$.numSimplified++;else if(Ye==="LineString")to(lt,Ne,$,he,!1,!1);else if(Ye==="MultiLineString"||Ye==="Polygon")for(_e=0;_e<Ne.length;_e++)to(lt,Ne[_e],$,he,Ye==="Polygon",_e===0);else if(Ye==="MultiPolygon")for(var je=0;je<Ne.length;je++){var Mt=Ne[je];for(_e=0;_e<Mt.length;_e++)to(lt,Mt[_e],$,he,!0,_e===0)}if(lt.length){var Sr=ne.tags||null;if(Ye==="LineString"&&be.lineMetrics){for(var zt in Sr={},ne.tags)Sr[zt]=ne.tags[zt];Sr.mapbox_clip_start=Ne.start/Ne.size,Sr.mapbox_clip_end=Ne.end/Ne.size}var Yt={geometry:lt,type:Ye==="Polygon"||Ye==="MultiPolygon"?3:Ye==="LineString"||Ye==="MultiLineString"?2:1,tags:Sr};ne.id!==null&&(Yt.id=ne.id),$.features.push(Yt)}}function to($,ne,he,be,Ne,Ye){var lt=be*be;if(be>0&&ne.size<(Ne?lt:be))he.numPoints+=ne.length/3;else{for(var _e=[],je=0;je<ne.length;je+=3)(be===0||ne[je+2]>lt)&&(he.numSimplified++,_e.push(ne[je]),_e.push(ne[je+1])),he.numPoints++;Ne&&function(Mt,Sr){for(var zt=0,Yt=0,Lr=Mt.length,$n=Lr-2;Yt<Lr;$n=Yt,Yt+=2)zt+=(Mt[Yt]-Mt[$n])*(Mt[Yt+1]+Mt[$n+1]);if(zt>0===Sr)for(Yt=0,Lr=Mt.length;Yt<Lr/2;Yt+=2){var vn=Mt[Yt],Nt=Mt[Yt+1];Mt[Yt]=Mt[Lr-2-Yt],Mt[Yt+1]=Mt[Lr-1-Yt],Mt[Lr-2-Yt]=vn,Mt[Lr-1-Yt]=Nt}}(_e,Ye),$.push(_e)}}function So($,ne){var he=(ne=this.options=function(Ne,Ye){for(var lt in Ye)Ne[lt]=Ye[lt];return Ne}(Object.create(this.options),ne)).debug;if(he&&console.time("preprocess data"),ne.maxZoom<0||ne.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ne.promoteId&&ne.generateId)throw new Error("promoteId and generateId cannot be used together.");var be=function(Ne,Ye){var lt=[];if(Ne.type==="FeatureCollection")for(var _e=0;_e<Ne.features.length;_e++)Po(lt,Ne.features[_e],Ye,_e);else Po(lt,Ne.type==="Feature"?Ne:{geometry:Ne},Ye);return lt}($,ne);this.tiles={},this.tileCoords=[],he&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ne.indexMaxZoom,ne.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(be=function(Ne,Ye){var lt=Ye.buffer/Ye.extent,_e=Ne,je=V(Ne,1,-1-lt,lt,0,-1,2,Ye),Mt=V(Ne,1,1-lt,2+lt,0,-1,2,Ye);return(je||Mt)&&(_e=V(Ne,1,-lt,1+lt,0,-1,2,Ye)||[],je&&(_e=Bn(je,1).concat(_e)),Mt&&(_e=_e.concat(Bn(Mt,-1)))),_e}(be,ne)).length&&this.splitTile(be,0,0,0),he&&(be.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ji($,ne,he){return 32*((1<<$)*he+ne)+$}function ro($,ne){var he=$.tileID.canonical;if(!this._geoJSONIndex)return ne(null,null);var be=this._geoJSONIndex.getTile(he.z,he.x,he.y);if(!be)return ne(null,null);var Ne=new an(be.features),Ye=Rr(Ne);Ye.byteOffset===0&&Ye.byteLength===Ye.buffer.byteLength||(Ye=new Uint8Array(Ye)),ne(null,{vectorTile:Ne,rawData:Ye.buffer})}Vn.prototype.load=function($){var ne=this.options,he=ne.log,be=ne.minZoom,Ne=ne.maxZoom,Ye=ne.nodeSize;he&&console.time("total time");var lt="prepare "+$.length+" points";he&&console.time(lt),this.points=$;for(var _e=[],je=0;je<$.length;je++)$[je].geometry&&_e.push(ai($[je],je));this.trees[Ne+1]=new cr(_e,xi,Hi,Ye,Float32Array),he&&console.timeEnd(lt);for(var Mt=Ne;Mt>=be;Mt--){var Sr=+Date.now();_e=this._cluster(_e,Mt),this.trees[Mt]=new cr(_e,xi,Hi,Ye,Float32Array),he&&console.log("z%d: %d clusters in %dms",Mt,_e.length,+Date.now()-Sr)}return he&&console.timeEnd("total time"),this},Vn.prototype.getClusters=function($,ne){var he=(($[0]+180)%360+360)%360-180,be=Math.max(-90,Math.min(90,$[1])),Ne=$[2]===180?180:(($[2]+180)%360+360)%360-180,Ye=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)he=-180,Ne=180;else if(he>Ne){var lt=this.getClusters([he,be,180,Ye],ne),_e=this.getClusters([-180,be,Ne,Ye],ne);return lt.concat(_e)}for(var je=this.trees[this._limitZoom(ne)],Mt=[],Sr=0,zt=je.range(oa(he),Ti(Ye),oa(Ne),Ti(be));Sr<zt.length;Sr+=1){var Yt=je.points[zt[Sr]];Mt.push(Yt.numPoints?Rn(Yt):this.points[Yt.index])}return Mt},Vn.prototype.getChildren=function($){var ne=this._getOriginId($),he=this._getOriginZoom($),be="No cluster with the specified id.",Ne=this.trees[he];if(!Ne)throw new Error(be);var Ye=Ne.points[ne];if(!Ye)throw new Error(be);for(var lt=this.options.radius/(this.options.extent*Math.pow(2,he-1)),_e=[],je=0,Mt=Ne.within(Ye.x,Ye.y,lt);je<Mt.length;je+=1){var Sr=Ne.points[Mt[je]];Sr.parentId===$&&_e.push(Sr.numPoints?Rn(Sr):this.points[Sr.index])}if(_e.length===0)throw new Error(be);return _e},Vn.prototype.getLeaves=function($,ne,he){var be=[];return this._appendLeaves(be,$,ne=ne||10,he=he||0,0),be},Vn.prototype.getTile=function($,ne,he){var be=this.trees[this._limitZoom($)],Ne=Math.pow(2,$),Ye=this.options,lt=Ye.radius/Ye.extent,_e=(he-lt)/Ne,je=(he+1+lt)/Ne,Mt={features:[]};return this._addTileFeatures(be.range((ne-lt)/Ne,_e,(ne+1+lt)/Ne,je),be.points,ne,he,Ne,Mt),ne===0&&this._addTileFeatures(be.range(1-lt/Ne,_e,1,je),be.points,Ne,he,Ne,Mt),ne===Ne-1&&this._addTileFeatures(be.range(0,_e,lt/Ne,je),be.points,-1,he,Ne,Mt),Mt.features.length?Mt:null},Vn.prototype.getClusterExpansionZoom=function($){for(var ne=this._getOriginZoom($)-1;ne<=this.options.maxZoom;){var he=this.getChildren($);if(ne++,he.length!==1)break;$=he[0].properties.cluster_id}return ne},Vn.prototype._appendLeaves=function($,ne,he,be,Ne){for(var Ye=0,lt=this.getChildren(ne);Ye<lt.length;Ye+=1){var _e=lt[Ye],je=_e.properties;if(je&&je.cluster?Ne+je.point_count<=be?Ne+=je.point_count:Ne=this._appendLeaves($,je.cluster_id,he,be,Ne):Ne<be?Ne++:$.push(_e),$.length===he)break}return Ne},Vn.prototype._addTileFeatures=function($,ne,he,be,Ne,Ye){for(var lt=0,_e=$;lt<_e.length;lt+=1){var je=ne[_e[lt]],Mt=je.numPoints,Sr={type:1,geometry:[[Math.round(this.options.extent*(je.x*Ne-he)),Math.round(this.options.extent*(je.y*Ne-be))]],tags:Mt?Ba(je):this.points[je.index].properties},zt=void 0;Mt?zt=je.id:this.options.generateId?zt=je.index:this.points[je.index].id&&(zt=this.points[je.index].id),zt!==void 0&&(Sr.id=zt),Ye.features.push(Sr)}},Vn.prototype._limitZoom=function($){return Math.max(this.options.minZoom,Math.min(+$,this.options.maxZoom+1))},Vn.prototype._cluster=function($,ne){for(var he=[],be=this.options,Ne=be.reduce,Ye=be.minPoints,lt=be.radius/(be.extent*Math.pow(2,ne)),_e=0;_e<$.length;_e++){var je=$[_e];if(!(je.zoom<=ne)){je.zoom=ne;for(var Mt=this.trees[ne+1],Sr=Mt.within(je.x,je.y,lt),zt=je.numPoints||1,Yt=zt,Lr=0,$n=Sr;Lr<$n.length;Lr+=1){var vn=Mt.points[$n[Lr]];vn.zoom>ne&&(Yt+=vn.numPoints||1)}if(Yt>=Ye){for(var Nt=je.x*zt,pr=je.y*zt,on=Ne&&zt>1?this._map(je,!0):null,cn=(_e<<5)+(ne+1)+this.points.length,$i=0,Cn=Sr;$i<Cn.length;$i+=1){var xt=Mt.points[Cn[$i]];if(!(xt.zoom<=ne)){xt.zoom=ne;var St=xt.numPoints||1;Nt+=xt.x*St,pr+=xt.y*St,xt.parentId=cn,Ne&&(on||(on=this._map(je,!0)),Ne(on,this._map(xt)))}}je.parentId=cn,he.push(Gi(Nt/Yt,pr/Yt,cn,Yt,on))}else if(he.push(je),Yt>1)for(var qi=0,na=Sr;qi<na.length;qi+=1){var ea=Mt.points[na[qi]];ea.zoom<=ne||(ea.zoom=ne,he.push(ea))}}}return he},Vn.prototype._getOriginId=function($){return $-this.points.length>>5},Vn.prototype._getOriginZoom=function($){return($-this.points.length)%32},Vn.prototype._map=function($,ne){if($.numPoints)return ne?Ca({},$.properties):$.properties;var he=this.points[$.index].properties,be=this.options.map(he);return ne&&be===he?Ca({},be):be},So.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},So.prototype.splitTile=function($,ne,he,be,Ne,Ye,lt){for(var _e=[$,ne,he,be],je=this.options,Mt=je.debug;_e.length;){be=_e.pop(),he=_e.pop(),ne=_e.pop(),$=_e.pop();var Sr=1<<ne,zt=Ji(ne,he,be),Yt=this.tiles[zt];if(!Yt&&(Mt>1&&console.time("creation"),Yt=this.tiles[zt]=Yi($,ne,he,be,je),this.tileCoords.push({z:ne,x:he,y:be}),Mt)){Mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ne,he,be,Yt.numFeatures,Yt.numPoints,Yt.numSimplified),console.timeEnd("creation"));var Lr="z"+ne;this.stats[Lr]=(this.stats[Lr]||0)+1,this.total++}if(Yt.source=$,Ne){if(ne===je.maxZoom||ne===Ne)continue;var $n=1<<Ne-ne;if(he!==Math.floor(Ye/$n)||be!==Math.floor(lt/$n))continue}else if(ne===je.indexMaxZoom||Yt.numPoints<=je.indexMaxPoints)continue;if(Yt.source=null,$.length!==0){Mt>1&&console.time("clipping");var vn,Nt,pr,on,cn,$i,Cn=.5*je.buffer/je.extent,xt=.5-Cn,St=.5+Cn,qi=1+Cn;vn=Nt=pr=on=null,cn=V($,Sr,he-Cn,he+St,0,Yt.minX,Yt.maxX,je),$i=V($,Sr,he+xt,he+qi,0,Yt.minX,Yt.maxX,je),$=null,cn&&(vn=V(cn,Sr,be-Cn,be+St,1,Yt.minY,Yt.maxY,je),Nt=V(cn,Sr,be+xt,be+qi,1,Yt.minY,Yt.maxY,je),cn=null),$i&&(pr=V($i,Sr,be-Cn,be+St,1,Yt.minY,Yt.maxY,je),on=V($i,Sr,be+xt,be+qi,1,Yt.minY,Yt.maxY,je),$i=null),Mt>1&&console.timeEnd("clipping"),_e.push(vn||[],ne+1,2*he,2*be),_e.push(Nt||[],ne+1,2*he,2*be+1),_e.push(pr||[],ne+1,2*he+1,2*be),_e.push(on||[],ne+1,2*he+1,2*be+1)}}},So.prototype.getTile=function($,ne,he){var be=this.options,Ne=be.extent,Ye=be.debug;if($<0||$>24)return null;var lt=1<<$,_e=Ji($,ne=(ne%lt+lt)%lt,he);if(this.tiles[_e])return eo(this.tiles[_e],Ne);Ye>1&&console.log("drilling down to z%d-%d-%d",$,ne,he);for(var je,Mt=$,Sr=ne,zt=he;!je&&Mt>0;)Mt--,Sr=Math.floor(Sr/2),zt=Math.floor(zt/2),je=this.tiles[Ji(Mt,Sr,zt)];return je&&je.source?(Ye>1&&console.log("found parent tile z%d-%d-%d",Mt,Sr,zt),Ye>1&&console.time("drilling down"),this.splitTile(je.source,Mt,Sr,zt,$,ne,he),Ye>1&&console.timeEnd("drilling down"),this.tiles[_e]?eo(this.tiles[_e],Ne):null):null};var hi=function($){function ne(he,be,Ne,Ye){$.call(this,he,be,Ne,ro),Ye&&(this.loadGeoJSON=Ye)}return $&&(ne.__proto__=$),(ne.prototype=Object.create($&&$.prototype)).constructor=ne,ne.prototype.loadData=function(he,be){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=be,this._pendingLoadDataParams=he,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ne.prototype._loadData=function(){var he=this;if(this._pendingCallback&&this._pendingLoadDataParams){var be=this._pendingCallback,Ne=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ye=!!(Ne&&Ne.request&&Ne.request.collectResourceTiming)&&new x.RequestPerformance(Ne.request);this.loadGeoJSON(Ne,function(lt,_e){if(lt||!_e)return be(lt);if(typeof _e!="object")return be(new Error("Input data given to '"+Ne.source+"' is not a valid GeoJSON object."));(function Yt(Lr,$n){var vn,Nt=Lr&&Lr.type;if(Nt==="FeatureCollection")for(vn=0;vn<Lr.features.length;vn++)Yt(Lr.features[vn],$n);else if(Nt==="GeometryCollection")for(vn=0;vn<Lr.geometries.length;vn++)Yt(Lr.geometries[vn],$n);else if(Nt==="Feature")Yt(Lr.geometry,$n);else if(Nt==="Polygon")ur(Lr.coordinates,$n);else if(Nt==="MultiPolygon")for(vn=0;vn<Lr.coordinates.length;vn++)ur(Lr.coordinates[vn],$n);return Lr})(_e,!0);try{if(Ne.filter){var je=x.createExpression(Ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(je.result==="error")throw new Error(je.value.map(function(Yt){return Yt.key+": "+Yt.message}).join(", "));var Mt=_e.features.filter(function(Yt){return je.value.evaluate({zoom:0},Yt)});_e={type:"FeatureCollection",features:Mt}}he._geoJSONIndex=Ne.cluster?new Vn(function(Yt){var Lr=Yt.superclusterOptions,$n=Yt.clusterProperties;if(!$n||!Lr)return Lr;for(var vn={},Nt={},pr={accumulated:null,zoom:0},on={properties:null},cn=Object.keys($n),$i=0,Cn=cn;$i<Cn.length;$i+=1){var xt=Cn[$i],St=$n[xt],qi=St[0],na=x.createExpression(St[1]),ea=x.createExpression(typeof qi=="string"?[qi,["accumulated"],["get",xt]]:qi);vn[xt]=na.value,Nt[xt]=ea.value}return Lr.map=function(oi){on.properties=oi;for(var Zi={},fo=0,mr=cn;fo<mr.length;fo+=1){var lr=mr[fo];Zi[lr]=vn[lr].evaluate(pr,on)}return Zi},Lr.reduce=function(oi,Zi){on.properties=Zi;for(var fo=0,mr=cn;fo<mr.length;fo+=1){var lr=mr[fo];pr.accumulated=oi[lr],oi[lr]=Nt[lr].evaluate(pr,on)}},Lr}(Ne)).load(_e.features):function(Yt,Lr){return new So(Yt,Lr)}(_e,Ne.geojsonVtOptions)}catch(Yt){return be(Yt)}he.loaded={};var Sr={};if(Ye){var zt=Ye.finish();zt&&(Sr.resourceTiming={},Sr.resourceTiming[Ne.source]=JSON.parse(JSON.stringify(zt)))}be(null,Sr)})}},ne.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ne.prototype.reloadTile=function(he,be){var Ne=this.loaded;return Ne&&Ne[he.uid]?$.prototype.reloadTile.call(this,he,be):this.loadTile(he,be)},ne.prototype.loadGeoJSON=function(he,be){if(he.request)x.getJSON(he.request,be);else{if(typeof he.data!="string")return be(new Error("Input data given to '"+he.source+"' is not a valid GeoJSON object."));try{return be(null,JSON.parse(he.data))}catch{return be(new Error("Input data given to '"+he.source+"' is not a valid GeoJSON object."))}}},ne.prototype.removeSource=function(he,be){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),be()},ne.prototype.getClusterExpansionZoom=function(he,be){try{be(null,this._geoJSONIndex.getClusterExpansionZoom(he.clusterId))}catch(Ne){be(Ne)}},ne.prototype.getClusterChildren=function(he,be){try{be(null,this._geoJSONIndex.getChildren(he.clusterId))}catch(Ne){be(Ne)}},ne.prototype.getClusterLeaves=function(he,be){try{be(null,this._geoJSONIndex.getLeaves(he.clusterId,he.limit,he.offset))}catch(Ne){be(Ne)}},ne}(hr),fa=function($){var ne=this;this.self=$,this.actor=new x.Actor($,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:hr,geojson:hi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(he,be){if(ne.workerSourceTypes[he])throw new Error('Worker source with name "'+he+'" already registered.');ne.workerSourceTypes[he]=be},this.self.registerRTLTextPlugin=function(he){if(x.plugin.isParsed())throw new Error("RTL text plugin already registered.");x.plugin.applyArabicShaping=he.applyArabicShaping,x.plugin.processBidirectionalText=he.processBidirectionalText,x.plugin.processStyledBidirectionalText=he.processStyledBidirectionalText}};return fa.prototype.setReferrer=function($,ne){this.referrer=ne},fa.prototype.setImages=function($,ne,he){for(var be in this.availableImages[$]=ne,this.workerSources[$]){var Ne=this.workerSources[$][be];for(var Ye in Ne)Ne[Ye].availableImages=ne}he()},fa.prototype.setLayers=function($,ne,he){this.getLayerIndex($).replace(ne),he()},fa.prototype.updateLayers=function($,ne,he){this.getLayerIndex($).update(ne.layers,ne.removedIds),he()},fa.prototype.loadTile=function($,ne,he){this.getWorkerSource($,ne.type,ne.source).loadTile(ne,he)},fa.prototype.loadDEMTile=function($,ne,he){this.getDEMWorkerSource($,ne.source).loadTile(ne,he)},fa.prototype.reloadTile=function($,ne,he){this.getWorkerSource($,ne.type,ne.source).reloadTile(ne,he)},fa.prototype.abortTile=function($,ne,he){this.getWorkerSource($,ne.type,ne.source).abortTile(ne,he)},fa.prototype.removeTile=function($,ne,he){this.getWorkerSource($,ne.type,ne.source).removeTile(ne,he)},fa.prototype.removeDEMTile=function($,ne){this.getDEMWorkerSource($,ne.source).removeTile(ne)},fa.prototype.removeSource=function($,ne,he){if(this.workerSources[$]&&this.workerSources[$][ne.type]&&this.workerSources[$][ne.type][ne.source]){var be=this.workerSources[$][ne.type][ne.source];delete this.workerSources[$][ne.type][ne.source],be.removeSource!==void 0?be.removeSource(ne,he):he()}},fa.prototype.loadWorkerSource=function($,ne,he){try{this.self.importScripts(ne.url),he()}catch(be){he(be.toString())}},fa.prototype.syncRTLPluginState=function($,ne,he){try{x.plugin.setState(ne);var be=x.plugin.getPluginURL();if(x.plugin.isLoaded()&&!x.plugin.isParsed()&&be!=null){this.self.importScripts(be);var Ne=x.plugin.isParsed();he(Ne?void 0:new Error("RTL Text Plugin failed to import scripts from "+be),Ne)}}catch(Ye){he(Ye.toString())}},fa.prototype.getAvailableImages=function($){var ne=this.availableImages[$];return ne||(ne=[]),ne},fa.prototype.getLayerIndex=function($){var ne=this.layerIndexes[$];return ne||(ne=this.layerIndexes[$]=new Tr),ne},fa.prototype.getWorkerSource=function($,ne,he){var be=this;return this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][ne]||(this.workerSources[$][ne]={}),this.workerSources[$][ne][he]||(this.workerSources[$][ne][he]=new this.workerSourceTypes[ne]({send:function(Ne,Ye,lt){be.actor.send(Ne,Ye,lt,$)}},this.getLayerIndex($),this.getAvailableImages($))),this.workerSources[$][ne][he]},fa.prototype.getDEMWorkerSource=function($,ne){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][ne]||(this.demWorkerSources[$][ne]=new ar),this.demWorkerSources[$][ne]},fa.prototype.enforceCacheSizeLimit=function($,ne){x.enforceCacheSizeLimit(ne)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new fa(self)),fa}),Ft(["./shared"],function(x){"use strict";var Jr=x.createCommonjsModule(function(c){function h(S){return!f(S)}function f(S){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,N,Y=new Blob([""],{type:"text/javascript"}),te=URL.createObjectURL(Y);try{N=new Worker(te),P=!0}catch{P=!1}return N&&N.terminate(),URL.revokeObjectURL(te),P}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var P=document.createElement("canvas");P.width=P.height=1;var N=P.getContext("2d");if(!N)return!1;var Y=N.getImageData(0,0,1,1);return Y&&Y.width===P.width}()?(m[k=S&&S.failIfMajorPerformanceCaveat]===void 0&&(m[k]=function(P){var N=function(te){var ye=document.createElement("canvas"),le=Object.create(h.webGLContextAttributes);return le.failIfMajorPerformanceCaveat=te,ye.probablySupportsContext?ye.probablySupportsContext("webgl",le)||ye.probablySupportsContext("experimental-webgl",le):ye.supportsContext?ye.supportsContext("webgl",le)||ye.supportsContext("experimental-webgl",le):ye.getContext("webgl",le)||ye.getContext("experimental-webgl",le)}(P);if(!N)return!1;var Y=N.createShader(N.VERTEX_SHADER);return!(!Y||N.isContextLost())&&(N.shaderSource(Y,"void main() {}"),N.compileShader(Y),N.getShaderParameter(Y,N.COMPILE_STATUS)===!0)}(k)),m[k]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var k}c.exports?c.exports=h:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=h,window.mapboxgl.notSupportedReason=f);var m={};h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),tt={create:function(c,h,f){var m=x.window.document.createElement(c);return h!==void 0&&(m.className=h),f&&f.appendChild(m),m},createNS:function(c,h){return x.window.document.createElementNS(c,h)}},Tr=x.window.document&&x.window.document.documentElement.style;function rt(c){if(!Tr)return c[0];for(var h=0;h<c.length;h++)if(c[h]in Tr)return c[h];return c[0]}var fr,Xe=rt(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);tt.disableDrag=function(){Tr&&Xe&&(fr=Tr[Xe],Tr[Xe]="none")},tt.enableDrag=function(){Tr&&Xe&&(Tr[Xe]=fr)};var Kt=rt(["transform","WebkitTransform"]);tt.setTransform=function(c,h){c.style[Kt]=h};var hr=!1;try{var jt=Object.defineProperty({},"passive",{get:function(){hr=!0}});x.window.addEventListener("test",jt,jt),x.window.removeEventListener("test",jt,jt)}catch{hr=!1}tt.addEventListener=function(c,h,f,m){m===void 0&&(m={}),c.addEventListener(h,f,"passive"in m&&hr?m:m.capture)},tt.removeEventListener=function(c,h,f,m){m===void 0&&(m={}),c.removeEventListener(h,f,"passive"in m&&hr?m:m.capture)};var ar=function(c){c.preventDefault(),c.stopPropagation(),x.window.removeEventListener("click",ar,!0)};function ur(c){var h=c.userImage;return!!(h&&h.render&&h.render())&&(c.data.replace(new Uint8Array(h.data.buffer)),!0)}tt.suppressClick=function(){x.window.addEventListener("click",ar,!0),x.window.setTimeout(function(){x.window.removeEventListener("click",ar,!0)},0)},tt.mousePos=function(c,h){var f=c.getBoundingClientRect();return new x.Point(h.clientX-f.left-c.clientLeft,h.clientY-f.top-c.clientTop)},tt.touchPos=function(c,h){for(var f=c.getBoundingClientRect(),m=[],S=0;S<h.length;S++)m.push(new x.Point(h[S].clientX-f.left-c.clientLeft,h[S].clientY-f.top-c.clientTop));return m},tt.mouseButton=function(c){return x.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&x.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button},tt.remove=function(c){c.parentNode&&c.parentNode.removeChild(c)};var Ir=function(c){function h(){c.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new x.RGBAImage({width:1,height:1}),this.dirty=!0}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.isLoaded=function(){return this.loaded},h.prototype.setLoaded=function(f){if(this.loaded!==f&&(this.loaded=f,f)){for(var m=0,S=this.requestors;m<S.length;m+=1){var k=S[m];this._notify(k.ids,k.callback)}this.requestors=[]}},h.prototype.getImage=function(f){return this.images[f]},h.prototype.addImage=function(f,m){this._validate(f,m)&&(this.images[f]=m)},h.prototype._validate=function(f,m){var S=!0;return this._validateStretch(m.stretchX,m.data&&m.data.width)||(this.fire(new x.ErrorEvent(new Error('Image "'+f+'" has invalid "stretchX" value'))),S=!1),this._validateStretch(m.stretchY,m.data&&m.data.height)||(this.fire(new x.ErrorEvent(new Error('Image "'+f+'" has invalid "stretchY" value'))),S=!1),this._validateContent(m.content,m)||(this.fire(new x.ErrorEvent(new Error('Image "'+f+'" has invalid "content" value'))),S=!1),S},h.prototype._validateStretch=function(f,m){if(!f)return!0;for(var S=0,k=0,P=f;k<P.length;k+=1){var N=P[k];if(N[0]<S||N[1]<N[0]||m<N[1])return!1;S=N[1]}return!0},h.prototype._validateContent=function(f,m){return!(f&&(f.length!==4||f[0]<0||m.data.width<f[0]||f[1]<0||m.data.height<f[1]||f[2]<0||m.data.width<f[2]||f[3]<0||m.data.height<f[3]||f[2]<f[0]||f[3]<f[1]))},h.prototype.updateImage=function(f,m){m.version=this.images[f].version+1,this.images[f]=m,this.updatedImages[f]=!0},h.prototype.removeImage=function(f){var m=this.images[f];delete this.images[f],delete this.patterns[f],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()},h.prototype.listImages=function(){return Object.keys(this.images)},h.prototype.getImages=function(f,m){var S=!0;if(!this.isLoaded())for(var k=0,P=f;k<P.length;k+=1)this.images[P[k]]||(S=!1);this.isLoaded()||S?this._notify(f,m):this.requestors.push({ids:f,callback:m})},h.prototype._notify=function(f,m){for(var S={},k=0,P=f;k<P.length;k+=1){var N=P[k];this.images[N]||this.fire(new x.Event("styleimagemissing",{id:N}));var Y=this.images[N];Y?S[N]={data:Y.data.clone(),pixelRatio:Y.pixelRatio,sdf:Y.sdf,version:Y.version,stretchX:Y.stretchX,stretchY:Y.stretchY,content:Y.content,hasRenderCallback:Boolean(Y.userImage&&Y.userImage.render)}:x.warnOnce('Image "'+N+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}m(null,S)},h.prototype.getPixelSize=function(){var f=this.atlasImage;return{width:f.width,height:f.height}},h.prototype.getPattern=function(f){var m=this.patterns[f],S=this.getImage(f);if(!S)return null;if(m&&m.position.version===S.version)return m.position;if(m)m.position.version=S.version;else{var k={w:S.data.width+2,h:S.data.height+2,x:0,y:0},P=new x.ImagePosition(k,S);this.patterns[f]={bin:k,position:P}}return this._updatePatternAtlas(),this.patterns[f].position},h.prototype.bind=function(f){var m=f.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new x.Texture(f,this.atlasImage,m.RGBA),this.atlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE)},h.prototype._updatePatternAtlas=function(){var f=[];for(var m in this.patterns)f.push(this.patterns[m].bin);var S=x.potpack(f),k=S.w,P=S.h,N=this.atlasImage;for(var Y in N.resize({width:k||1,height:P||1}),this.patterns){var te=this.patterns[Y].bin,ye=te.x+1,le=te.y+1,xe=this.images[Y].data,ze=xe.width,Ue=xe.height;x.RGBAImage.copy(xe,N,{x:0,y:0},{x:ye,y:le},{width:ze,height:Ue}),x.RGBAImage.copy(xe,N,{x:0,y:Ue-1},{x:ye,y:le-1},{width:ze,height:1}),x.RGBAImage.copy(xe,N,{x:0,y:0},{x:ye,y:le+Ue},{width:ze,height:1}),x.RGBAImage.copy(xe,N,{x:ze-1,y:0},{x:ye-1,y:le},{width:1,height:Ue}),x.RGBAImage.copy(xe,N,{x:0,y:0},{x:ye+ze,y:le},{width:1,height:Ue})}this.dirty=!0},h.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},h.prototype.dispatchRenderCallbacks=function(f){for(var m=0,S=f;m<S.length;m+=1){var k=S[m];if(!this.callbackDispatchedThisFrame[k]){this.callbackDispatchedThisFrame[k]=!0;var P=this.images[k];ur(P)&&this.updateImage(k,P)}}},h}(x.Evented),Kn=Pi,On=Pi,an=1e20;function Pi(c,h,f,m,S,k){this.fontSize=c||24,this.buffer=h===void 0?3:h,this.cutoff=m||.25,this.fontFamily=S||"sans-serif",this.fontWeight=k||"normal",this.radius=f||8;var P=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=P,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.d=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Int16Array(P),this.middle=Math.round(P/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ri(c,h,f,m,S,k,P){for(var N=0;N<h;N++){for(var Y=0;Y<f;Y++)m[Y]=c[Y*h+N];for(me(m,S,k,P,f),Y=0;Y<f;Y++)c[Y*h+N]=S[Y]}for(Y=0;Y<f;Y++){for(N=0;N<h;N++)m[N]=c[Y*h+N];for(me(m,S,k,P,h),N=0;N<h;N++)c[Y*h+N]=Math.sqrt(S[N])}}function me(c,h,f,m,S){f[0]=0,m[0]=-an,m[1]=+an;for(var k=1,P=0;k<S;k++){for(var N=(c[k]+k*k-(c[f[P]]+f[P]*f[P]))/(2*k-2*f[P]);N<=m[P];)P--,N=(c[k]+k*k-(c[f[P]]+f[P]*f[P]))/(2*k-2*f[P]);f[++P]=k,m[P]=N,m[P+1]=+an}for(k=0,P=0;k<S;k++){for(;m[P+1]<k;)P++;h[k]=(k-f[P])*(k-f[P])+c[f[P]]}}Pi.prototype.draw=function(c){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(c,this.buffer,this.middle);for(var h=this.ctx.getImageData(0,0,this.size,this.size),f=new Uint8ClampedArray(this.size*this.size),m=0;m<this.size*this.size;m++){var S=h.data[4*m+3]/255;this.gridOuter[m]=S===1?0:S===0?an:Math.pow(Math.max(0,.5-S),2),this.gridInner[m]=S===1?an:S===0?0:Math.pow(Math.max(0,S-.5),2)}for(ri(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),ri(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),m=0;m<this.size*this.size;m++)f[m]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[m]-this.gridInner[m])/this.radius+this.cutoff))));return f},Kn.default=On;var _i=function(c,h){this.requestManager=c,this.localIdeographFontFamily=h,this.entries={}};_i.prototype.setURL=function(c){this.url=c},_i.prototype.getGlyphs=function(c,h){var f=this,m=[];for(var S in c)for(var k=0,P=c[S];k<P.length;k+=1)m.push({stack:S,id:P[k]});x.asyncAll(m,function(N,Y){var te=N.stack,ye=N.id,le=f.entries[te];le||(le=f.entries[te]={glyphs:{},requests:{},ranges:{}});var xe=le.glyphs[ye];if(xe===void 0){if(xe=f._tinySDF(le,te,ye))return le.glyphs[ye]=xe,void Y(null,{stack:te,id:ye,glyph:xe});var ze=Math.floor(ye/256);if(256*ze>65535)Y(new Error("glyphs > 65535 not supported"));else if(le.ranges[ze])Y(null,{stack:te,id:ye,glyph:xe});else{var Ue=le.requests[ze];Ue||(Ue=le.requests[ze]=[],_i.loadGlyphRange(te,ze,f.url,f.requestManager,function(Je,Fe){if(Fe){for(var et in Fe)f._doesCharSupportLocalGlyph(+et)||(le.glyphs[+et]=Fe[+et]);le.ranges[ze]=!0}for(var pt=0,kt=Ue;pt<kt.length;pt+=1)(0,kt[pt])(Je,Fe);delete le.requests[ze]})),Ue.push(function(Je,Fe){Je?Y(Je):Fe&&Y(null,{stack:te,id:ye,glyph:Fe[ye]||null})})}}else Y(null,{stack:te,id:ye,glyph:xe})},function(N,Y){if(N)h(N);else if(Y){for(var te={},ye=0,le=Y;ye<le.length;ye+=1){var xe=le[ye],ze=xe.stack,Ue=xe.id,Je=xe.glyph;(te[ze]||(te[ze]={}))[Ue]=Je&&{id:Je.id,bitmap:Je.bitmap.clone(),metrics:Je.metrics}}h(null,te)}})},_i.prototype._doesCharSupportLocalGlyph=function(c){return!!this.localIdeographFontFamily&&(x.isChar["CJK Unified Ideographs"](c)||x.isChar["Hangul Syllables"](c)||x.isChar.Hiragana(c)||x.isChar.Katakana(c))},_i.prototype._tinySDF=function(c,h,f){var m=this.localIdeographFontFamily;if(m&&this._doesCharSupportLocalGlyph(f)){var S=c.tinySDF;if(!S){var k="400";/bold/i.test(h)?k="900":/medium/i.test(h)?k="500":/light/i.test(h)&&(k="200"),S=c.tinySDF=new _i.TinySDF(24,3,8,.25,m,k)}return{id:f,bitmap:new x.AlphaImage({width:30,height:30},S.draw(String.fromCharCode(f))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},_i.loadGlyphRange=function(c,h,f,m,S){var k=256*h,P=k+255,N=m.transformRequest(m.normalizeGlyphsURL(f).replace("{fontstack}",c).replace("{range}",k+"-"+P),x.ResourceType.Glyphs);x.getArrayBuffer(N,function(Y,te){if(Y)S(Y);else if(te){for(var ye={},le=0,xe=x.parseGlyphPBF(te);le<xe.length;le+=1){var ze=xe[le];ye[ze.id]=ze}S(null,ye)}})},_i.TinySDF=Kn;var Rr=function(){this.specification=x.styleSpec.light.position};Rr.prototype.possiblyEvaluate=function(c,h){return x.sphericalToCartesian(c.expression.evaluate(h))},Rr.prototype.interpolate=function(c,h,f){return{x:x.number(c.x,h.x,f),y:x.number(c.y,h.y,f),z:x.number(c.z,h.z,f)}};var ir=new x.Properties({anchor:new x.DataConstantProperty(x.styleSpec.light.anchor),position:new Rr,color:new x.DataConstantProperty(x.styleSpec.light.color),intensity:new x.DataConstantProperty(x.styleSpec.light.intensity)}),zr=function(c){function h(f){c.call(this),this._transitionable=new x.Transitionable(ir),this.setLight(f),this._transitioning=this._transitionable.untransitioned()}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getLight=function(){return this._transitionable.serialize()},h.prototype.setLight=function(f,m){if(m===void 0&&(m={}),!this._validate(x.validateLight,f,m))for(var S in f){var k=f[S];x.endsWith(S,"-transition")?this._transitionable.setTransition(S.slice(0,-11),k):this._transitionable.setValue(S,k)}},h.prototype.updateTransitions=function(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)},h.prototype.hasTransition=function(){return this._transitioning.hasTransition()},h.prototype.recalculate=function(f){this.properties=this._transitioning.possiblyEvaluate(f)},h.prototype._validate=function(f,m,S){return(!S||S.validate!==!1)&&x.emitValidationErrors(this,f.call(x.validateStyle,x.extend({value:m,style:{glyphs:!0,sprite:!0},styleSpec:x.styleSpec})))},h}(x.Evented),st=function(c,h){this.width=c,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};st.prototype.getDash=function(c,h){var f=c.join(",")+String(h);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(c,h)),this.dashEntry[f]},st.prototype.getDashRanges=function(c,h,f){var m=[],S=c.length%2==1?-c[c.length-1]*f:0,k=c[0]*f,P=!0;m.push({left:S,right:k,isDash:P,zeroLength:c[0]===0});for(var N=c[0],Y=1;Y<c.length;Y++){var te=c[Y];m.push({left:S=N*f,right:k=(N+=te)*f,isDash:P=!P,zeroLength:te===0})}return m},st.prototype.addRoundDash=function(c,h,f){for(var m=h/2,S=-f;S<=f;S++)for(var k=this.width*(this.nextRow+f+S),P=0,N=c[P],Y=0;Y<this.width;Y++){Y/N.right>1&&(N=c[++P]);var te=Math.abs(Y-N.left),ye=Math.abs(Y-N.right),le=Math.min(te,ye),xe=void 0,ze=S/f*(m+1);if(N.isDash){var Ue=m-Math.abs(ze);xe=Math.sqrt(le*le+Ue*Ue)}else xe=m-Math.sqrt(le*le+ze*ze);this.data[k+Y]=Math.max(0,Math.min(255,xe+128))}},st.prototype.addRegularDash=function(c){for(var h=c.length-1;h>=0;--h){var f=c[h],m=c[h+1];f.zeroLength?c.splice(h,1):m&&m.isDash===f.isDash&&(m.left=f.left,c.splice(h,1))}var S=c[0],k=c[c.length-1];S.isDash===k.isDash&&(S.left=k.left-this.width,k.right=S.right+this.width);for(var P=this.width*this.nextRow,N=0,Y=c[N],te=0;te<this.width;te++){te/Y.right>1&&(Y=c[++N]);var ye=Math.abs(te-Y.left),le=Math.abs(te-Y.right),xe=Math.min(ye,le);this.data[P+te]=Math.max(0,Math.min(255,(Y.isDash?xe:-xe)+128))}},st.prototype.addDash=function(c,h){var f=h?7:0,m=2*f+1;if(this.nextRow+m>this.height)return x.warnOnce("LineAtlas out of space"),null;for(var S=0,k=0;k<c.length;k++)S+=c[k];if(S!==0){var P=this.width/S,N=this.getDashRanges(c,this.width,P);h?this.addRoundDash(N,P,f):this.addRegularDash(N)}var Y={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:S};return this.nextRow+=m,this.dirty=!0,Y},st.prototype.bind=function(c){var h=c.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))};var en=function c(h,f){this.workerPool=h,this.actors=[],this.currentActor=0,this.id=x.uniqueId();for(var m=this.workerPool.acquire(this.id),S=0;S<m.length;S++){var k=new c.Actor(m[S],f,this.id);k.name="Worker "+S,this.actors.push(k)}};function Wn(c,h,f){var m=function(S,k){if(S)return f(S);if(k){var P=x.pick(x.extend(k,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(P.vectorLayers=k.vector_layers,P.vectorLayerIds=P.vectorLayers.map(function(N){return N.id})),P.tiles=h.canonicalizeTileset(P,c.url),f(null,P)}};return c.url?x.getJSON(h.transformRequest(h.normalizeSourceURL(c.url),x.ResourceType.Source),m):x.browser.frame(function(){return m(null,c)})}en.prototype.broadcast=function(c,h,f){x.asyncAll(this.actors,function(m,S){m.send(c,h,S)},f=f||function(){})},en.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},en.prototype.remove=function(){this.actors.forEach(function(c){c.remove()}),this.actors=[],this.workerPool.release(this.id)},en.Actor=x.Actor;var ce=function(c,h,f){this.bounds=x.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=h||0,this.maxzoom=f||24};ce.prototype.validateBounds=function(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]},ce.prototype.contains=function(c){var h=Math.pow(2,c.z),f=Math.floor(x.mercatorXfromLng(this.bounds.getWest())*h),m=Math.floor(x.mercatorYfromLat(this.bounds.getNorth())*h),S=Math.ceil(x.mercatorXfromLng(this.bounds.getEast())*h),k=Math.ceil(x.mercatorYfromLat(this.bounds.getSouth())*h);return c.x>=f&&c.x<S&&c.y>=m&&c.y<k};var Ee=function(c){function h(f,m,S,k){if(c.call(this),this.id=f,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,x.extend(this,x.pick(m,["url","scheme","tileSize","promoteId"])),this._options=x.extend({type:"vector"},m),this._collectResourceTiming=m.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(k)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){var f=this;this._loaded=!1,this.fire(new x.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Wn(this._options,this.map._requestManager,function(m,S){f._tileJSONRequest=null,f._loaded=!0,m?f.fire(new x.ErrorEvent(m)):S&&(x.extend(f,S),S.bounds&&(f.tileBounds=new ce(S.bounds,f.minzoom,f.maxzoom)),x.postTurnstileEvent(S.tiles,f.map._requestManager._customAccessToken),x.postMapLoadEvent(S.tiles,f.map._getMapId(),f.map._requestManager._skuToken,f.map._requestManager._customAccessToken),f.fire(new x.Event("data",{dataType:"source",sourceDataType:"metadata"})),f.fire(new x.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.hasTile=function(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)},h.prototype.onAdd=function(f){this.map=f,this.load()},h.prototype.setSourceProperty=function(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},h.prototype.setTiles=function(f){var m=this;return this.setSourceProperty(function(){m._options.tiles=f}),this},h.prototype.setUrl=function(f){var m=this;return this.setSourceProperty(function(){m.url=f,m._options.url=f}),this},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return x.extend({},this._options)},h.prototype.loadTile=function(f,m){var S=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),k={request:this.map._requestManager.transformRequest(S,x.ResourceType.Tile),uid:f.uid,tileID:f.tileID,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:x.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function P(N,Y){return delete f.request,f.aborted?m(null):N&&N.status!==404?m(N):(Y&&Y.resourceTiming&&(f.resourceTiming=Y.resourceTiming),this.map._refreshExpiredTiles&&Y&&f.setExpiryData(Y),f.loadVectorData(Y,this.map.painter),x.cacheEntryPossiblyAdded(this.dispatcher),m(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}k.request.collectResourceTiming=this._collectResourceTiming,f.actor&&f.state!=="expired"?f.state==="loading"?f.reloadCallback=m:f.request=f.actor.send("reloadTile",k,P.bind(this)):(f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",k,P.bind(this)))},h.prototype.abortTile=function(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id},void 0)},h.prototype.unloadTile=function(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id},void 0)},h.prototype.hasTransition=function(){return!1},h}(x.Evented),Z=function(c){function h(f,m,S,k){c.call(this),this.id=f,this.dispatcher=S,this.setEventedParent(k),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=x.extend({type:"raster"},m),x.extend(this,x.pick(m,["url","scheme","tileSize"]))}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){var f=this;this._loaded=!1,this.fire(new x.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Wn(this._options,this.map._requestManager,function(m,S){f._tileJSONRequest=null,f._loaded=!0,m?f.fire(new x.ErrorEvent(m)):S&&(x.extend(f,S),S.bounds&&(f.tileBounds=new ce(S.bounds,f.minzoom,f.maxzoom)),x.postTurnstileEvent(S.tiles),x.postMapLoadEvent(S.tiles,f.map._getMapId(),f.map._requestManager._skuToken),f.fire(new x.Event("data",{dataType:"source",sourceDataType:"metadata"})),f.fire(new x.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.onAdd=function(f){this.map=f,this.load()},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return x.extend({},this._options)},h.prototype.hasTile=function(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)},h.prototype.loadTile=function(f,m){var S=this,k=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);f.request=x.getImage(this.map._requestManager.transformRequest(k,x.ResourceType.Tile),function(P,N){if(delete f.request,f.aborted)f.state="unloaded",m(null);else if(P)f.state="errored",m(P);else if(N){S.map._refreshExpiredTiles&&f.setExpiryData(N),delete N.cacheControl,delete N.expires;var Y=S.map.painter.context,te=Y.gl;f.texture=S.map.painter.getTileTexture(N.width),f.texture?f.texture.update(N,{useMipmap:!0}):(f.texture=new x.Texture(Y,N,te.RGBA,{useMipmap:!0}),f.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE,te.LINEAR_MIPMAP_NEAREST),Y.extTextureFilterAnisotropic&&te.texParameterf(te.TEXTURE_2D,Y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Y.extTextureFilterAnisotropicMax)),f.state="loaded",x.cacheEntryPossiblyAdded(S.dispatcher),m(null)}})},h.prototype.abortTile=function(f,m){f.request&&(f.request.cancel(),delete f.request),m()},h.prototype.unloadTile=function(f,m){f.texture&&this.map.painter.saveTileTexture(f.texture),m()},h.prototype.hasTransition=function(){return!1},h}(x.Evented),Ze=function(c){function h(f,m,S,k){c.call(this,f,m,S,k),this.type="raster-dem",this.maxzoom=22,this._options=x.extend({type:"raster-dem"},m),this.encoding=m.encoding||"mapbox"}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},h.prototype.loadTile=function(f,m){var S=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function k(P,N){P&&(f.state="errored",m(P)),N&&(f.dem=N,f.needsHillshadePrepare=!0,f.state="loaded",m(null))}f.request=x.getImage(this.map._requestManager.transformRequest(S,x.ResourceType.Tile),function(P,N){if(delete f.request,f.aborted)f.state="unloaded",m(null);else if(P)f.state="errored",m(P);else if(N){this.map._refreshExpiredTiles&&f.setExpiryData(N),delete N.cacheControl,delete N.expires;var Y=x.window.ImageBitmap&&N instanceof x.window.ImageBitmap&&x.offscreenCanvasSupported()?N:x.browser.getImageData(N,1),te={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:Y,encoding:this.encoding};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",te,k.bind(this)))}}.bind(this)),f.neighboringTiles=this._getNeighboringTiles(f.tileID)},h.prototype._getNeighboringTiles=function(f){var m=f.canonical,S=Math.pow(2,m.z),k=(m.x-1+S)%S,P=m.x===0?f.wrap-1:f.wrap,N=(m.x+1+S)%S,Y=m.x+1===S?f.wrap+1:f.wrap,te={};return te[new x.OverscaledTileID(f.overscaledZ,P,m.z,k,m.y).key]={backfilled:!1},te[new x.OverscaledTileID(f.overscaledZ,Y,m.z,N,m.y).key]={backfilled:!1},m.y>0&&(te[new x.OverscaledTileID(f.overscaledZ,P,m.z,k,m.y-1).key]={backfilled:!1},te[new x.OverscaledTileID(f.overscaledZ,f.wrap,m.z,m.x,m.y-1).key]={backfilled:!1},te[new x.OverscaledTileID(f.overscaledZ,Y,m.z,N,m.y-1).key]={backfilled:!1}),m.y+1<S&&(te[new x.OverscaledTileID(f.overscaledZ,P,m.z,k,m.y+1).key]={backfilled:!1},te[new x.OverscaledTileID(f.overscaledZ,f.wrap,m.z,m.x,m.y+1).key]={backfilled:!1},te[new x.OverscaledTileID(f.overscaledZ,Y,m.z,N,m.y+1).key]={backfilled:!1}),te},h.prototype.unloadTile=function(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded",f.actor&&f.actor.send("removeDEMTile",{uid:f.uid,source:this.id})},h}(Z),Pe=function(c){function h(f,m,S,k){c.call(this),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=S.getActor(),this.setEventedParent(k),this._data=m.data,this._options=x.extend({},m),this._collectResourceTiming=m.collectResourceTiming,this._resourceTiming=[],m.maxzoom!==void 0&&(this.maxzoom=m.maxzoom),m.type&&(this.type=m.type),m.attribution&&(this.attribution=m.attribution),this.promoteId=m.promoteId;var P=x.EXTENT/this.tileSize;this.workerOptions=x.extend({source:this.id,cluster:m.cluster||!1,geojsonVtOptions:{buffer:(m.buffer!==void 0?m.buffer:128)*P,tolerance:(m.tolerance!==void 0?m.tolerance:.375)*P,extent:x.EXTENT,maxZoom:this.maxzoom,lineMetrics:m.lineMetrics||!1,generateId:m.generateId||!1},superclusterOptions:{maxZoom:m.clusterMaxZoom!==void 0?Math.min(m.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,m.clusterMinPoints||2),extent:x.EXTENT,radius:(m.clusterRadius||50)*P,log:!1,generateId:m.generateId||!1},clusterProperties:m.clusterProperties,filter:m.filter},m.workerOptions)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){var f=this;this.fire(new x.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(m){if(m)f.fire(new x.ErrorEvent(m));else{var S={dataType:"source",sourceDataType:"metadata"};f._collectResourceTiming&&f._resourceTiming&&f._resourceTiming.length>0&&(S.resourceTiming=f._resourceTiming,f._resourceTiming=[]),f.fire(new x.Event("data",S))}})},h.prototype.onAdd=function(f){this.map=f,this.load()},h.prototype.setData=function(f){var m=this;return this._data=f,this.fire(new x.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(S){if(S)m.fire(new x.ErrorEvent(S));else{var k={dataType:"source",sourceDataType:"content"};m._collectResourceTiming&&m._resourceTiming&&m._resourceTiming.length>0&&(k.resourceTiming=m._resourceTiming,m._resourceTiming=[]),m.fire(new x.Event("data",k))}}),this},h.prototype.getClusterExpansionZoom=function(f,m){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},m),this},h.prototype.getClusterChildren=function(f,m){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},m),this},h.prototype.getClusterLeaves=function(f,m,S,k){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:m,offset:S},k),this},h.prototype._updateWorkerData=function(f){var m=this;this._loaded=!1;var S=x.extend({},this.workerOptions),k=this._data;typeof k=="string"?(S.request=this.map._requestManager.transformRequest(x.browser.resolveURL(k),x.ResourceType.Source),S.request.collectResourceTiming=this._collectResourceTiming):S.data=JSON.stringify(k),this.actor.send(this.type+".loadData",S,function(P,N){m._removed||N&&N.abandoned||(m._loaded=!0,N&&N.resourceTiming&&N.resourceTiming[m.id]&&(m._resourceTiming=N.resourceTiming[m.id].slice(0)),m.actor.send(m.type+".coalesce",{source:S.source},null),f(P))})},h.prototype.loaded=function(){return this._loaded},h.prototype.loadTile=function(f,m){var S=this,k=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(k,{type:this.type,uid:f.uid,tileID:f.tileID,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:x.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(P,N){return delete f.request,f.unloadVectorData(),f.aborted?m(null):P?m(P):(f.loadVectorData(N,S.map.painter,k==="reloadTile"),m(null))})},h.prototype.abortTile=function(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0},h.prototype.unloadTile=function(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})},h.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},h.prototype.serialize=function(){return x.extend({},this._options,{type:this.type,data:this._data})},h.prototype.hasTransition=function(){return!1},h}(x.Evented),ft=x.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),It=function(c){function h(f,m,S,k){c.call(this),this.id=f,this.dispatcher=S,this.coordinates=m.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(k),this.options=m}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(f,m){var S=this;this._loaded=!1,this.fire(new x.Event("dataloading",{dataType:"source"})),this.url=this.options.url,x.getImage(this.map._requestManager.transformRequest(this.url,x.ResourceType.Image),function(k,P){S._loaded=!0,k?S.fire(new x.ErrorEvent(k)):P&&(S.image=P,f&&(S.coordinates=f),m&&m(),S._finishLoading())})},h.prototype.loaded=function(){return this._loaded},h.prototype.updateImage=function(f){var m=this;return this.image&&f.url?(this.options.url=f.url,this.load(f.coordinates,function(){m.texture=null}),this):this},h.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new x.Event("data",{dataType:"source",sourceDataType:"metadata"})))},h.prototype.onAdd=function(f){this.map=f,this.load()},h.prototype.setCoordinates=function(f){var m=this;this.coordinates=f;var S=f.map(x.MercatorCoordinate.fromLngLat);this.tileID=function(P){for(var N=1/0,Y=1/0,te=-1/0,ye=-1/0,le=0,xe=P;le<xe.length;le+=1){var ze=xe[le];N=Math.min(N,ze.x),Y=Math.min(Y,ze.y),te=Math.max(te,ze.x),ye=Math.max(ye,ze.y)}var Ue=Math.max(te-N,ye-Y),Je=Math.max(0,Math.floor(-Math.log(Ue)/Math.LN2)),Fe=Math.pow(2,Je);return new x.CanonicalTileID(Je,Math.floor((N+te)/2*Fe),Math.floor((Y+ye)/2*Fe))}(S),this.minzoom=this.maxzoom=this.tileID.z;var k=S.map(function(P){return m.tileID.getTilePoint(P)._round()});return this._boundsArray=new x.StructArrayLayout4i8,this._boundsArray.emplaceBack(k[0].x,k[0].y,0,0),this._boundsArray.emplaceBack(k[1].x,k[1].y,x.EXTENT,0),this._boundsArray.emplaceBack(k[3].x,k[3].y,0,x.EXTENT),this._boundsArray.emplaceBack(k[2].x,k[2].y,x.EXTENT,x.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new x.Event("data",{dataType:"source",sourceDataType:"content"})),this},h.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var f=this.map.painter.context,m=f.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,ft.members)),this.boundsSegments||(this.boundsSegments=x.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new x.Texture(f,this.image,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this.tiles){var k=this.tiles[S];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture)}}},h.prototype.loadTile=function(f,m){this.tileID&&this.tileID.equals(f.tileID.canonical)?(this.tiles[String(f.tileID.wrap)]=f,f.buckets={},m(null)):(f.state="errored",m(null))},h.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return!1},h}(x.Evented),qt=function(c){function h(f,m,S,k){c.call(this,f,m,S,k),this.roundZoom=!0,this.type="video",this.options=m}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){var f=this;this._loaded=!1;var m=this.options;this.urls=[];for(var S=0,k=m.urls;S<k.length;S+=1)this.urls.push(this.map._requestManager.transformRequest(k[S],x.ResourceType.Source).url);x.getVideo(this.urls,function(P,N){f._loaded=!0,P?f.fire(new x.ErrorEvent(P)):N&&(f.video=N,f.video.loop=!0,f.video.addEventListener("playing",function(){f.map.triggerRepaint()}),f.map&&f.video.play(),f._finishLoading())})},h.prototype.pause=function(){this.video&&this.video.pause()},h.prototype.play=function(){this.video&&this.video.play()},h.prototype.seek=function(f){if(this.video){var m=this.video.seekable;f<m.start(0)||f>m.end(0)?this.fire(new x.ErrorEvent(new x.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+m.start(0)+" and "+m.end(0)+"-second mark."))):this.video.currentTime=f}},h.prototype.getVideo=function(){return this.video},h.prototype.onAdd=function(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},h.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var f=this.map.painter.context,m=f.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,ft.members)),this.boundsSegments||(this.boundsSegments=x.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE),m.texSubImage2D(m.TEXTURE_2D,0,0,0,m.RGBA,m.UNSIGNED_BYTE,this.video)):(this.texture=new x.Texture(f,this.video,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this.tiles){var k=this.tiles[S];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this.video&&!this.video.paused},h}(It),yt=function(c){function h(f,m,S,k){c.call(this,f,m,S,k),m.coordinates?Array.isArray(m.coordinates)&&m.coordinates.length===4&&!m.coordinates.some(function(P){return!Array.isArray(P)||P.length!==2||P.some(function(N){return typeof N!="number"})})||this.fire(new x.ErrorEvent(new x.ValidationError("sources."+f,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new x.ErrorEvent(new x.ValidationError("sources."+f,null,'missing required property "coordinates"'))),m.animate&&typeof m.animate!="boolean"&&this.fire(new x.ErrorEvent(new x.ValidationError("sources."+f,null,'optional "animate" property must be a boolean value'))),m.canvas?typeof m.canvas=="string"||m.canvas instanceof x.window.HTMLCanvasElement||this.fire(new x.ErrorEvent(new x.ValidationError("sources."+f,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new x.ErrorEvent(new x.ValidationError("sources."+f,null,'missing required property "canvas"'))),this.options=m,this.animate=m.animate===void 0||m.animate}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof x.window.HTMLCanvasElement?this.options.canvas:x.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new x.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},h.prototype.getCanvas=function(){return this.canvas},h.prototype.onAdd=function(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()},h.prototype.onRemove=function(){this.pause()},h.prototype.prepare=function(){var f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var m=this.map.painter.context,S=m.gl;for(var k in this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,ft.members)),this.boundsSegments||(this.boundsSegments=x.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new x.Texture(m,this.canvas,S.RGBA,{premultiply:!0}),this.tiles){var P=this.tiles[k];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this._playing},h.prototype._hasInvalidDimensions=function(){for(var f=0,m=[this.canvas.width,this.canvas.height];f<m.length;f+=1){var S=m[f];if(isNaN(S)||S<=0)return!0}return!1},h}(It),cr={vector:Ee,raster:Z,"raster-dem":Ze,geojson:Pe,video:qt,image:It,canvas:yt};function Xn(c,h){var f=x.identity([]);return x.translate(f,f,[1,1,0]),x.scale(f,f,[.5*c.width,.5*c.height,1]),x.multiply(f,f,c.calculatePosMatrix(h.toUnwrapped()))}function Vn(c,h,f,m,S,k){var P=function(Je,Fe,et){if(Je)for(var pt=0,kt=Je;pt<kt.length;pt+=1){var Qt=Fe[kt[pt]];if(Qt&&Qt.source===et&&Qt.type==="fill-extrusion")return!0}else for(var Bt in Fe){var nr=Fe[Bt];if(nr.source===et&&nr.type==="fill-extrusion")return!0}return!1}(S&&S.layers,h,c.id),N=k.maxPitchScaleFactor(),Y=c.tilesIn(m,N,P);Y.sort(Gi);for(var te=[],ye=0,le=Y;ye<le.length;ye+=1){var xe=le[ye];te.push({wrappedTileID:xe.tileID.wrapped().key,queryResults:xe.tile.queryRenderedFeatures(h,f,c._state,xe.queryGeometry,xe.cameraQueryGeometry,xe.scale,S,k,N,Xn(c.transform,xe.tileID))})}var ze=function(Je){for(var Fe={},et={},pt=0,kt=Je;pt<kt.length;pt+=1){var Qt=kt[pt],Bt=Qt.queryResults,nr=Qt.wrappedTileID,Or=et[nr]=et[nr]||{};for(var un in Bt)for(var rn=Bt[un],Pn=Or[un]=Or[un]||{},ui=Fe[un]=Fe[un]||[],gi=0,fi=rn;gi<fi.length;gi+=1){var _a=fi[gi];Pn[_a.featureIndex]||(Pn[_a.featureIndex]=!0,ui.push(_a))}}return Fe}(te);for(var Ue in ze)ze[Ue].forEach(function(Je){var Fe=Je.feature,et=c.getFeatureState(Fe.layer["source-layer"],Fe.id);Fe.source=Fe.layer.source,Fe.layer["source-layer"]&&(Fe.sourceLayer=Fe.layer["source-layer"]),Fe.state=et});return ze}function Gi(c,h){var f=c.tileID,m=h.tileID;return f.overscaledZ-m.overscaledZ||f.canonical.y-m.canonical.y||f.wrap-m.wrap||f.canonical.x-m.canonical.x}var ai=function(c,h){this.max=c,this.onRemove=h,this.reset()};ai.prototype.reset=function(){for(var c in this.data)for(var h=0,f=this.data[c];h<f.length;h+=1){var m=f[h];m.timeout&&clearTimeout(m.timeout),this.onRemove(m.value)}return this.data={},this.order=[],this},ai.prototype.add=function(c,h,f){var m=this,S=c.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);var k={value:h,timeout:void 0};if(f!==void 0&&(k.timeout=setTimeout(function(){m.remove(c,k)},f)),this.data[S].push(k),this.order.push(S),this.order.length>this.max){var P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this},ai.prototype.has=function(c){return c.wrapped().key in this.data},ai.prototype.getAndRemove=function(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null},ai.prototype._getAndRemoveByKey=function(c){var h=this.data[c].shift();return h.timeout&&clearTimeout(h.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),h.value},ai.prototype.getByKey=function(c){var h=this.data[c];return h?h[0].value:null},ai.prototype.get=function(c){return this.has(c)?this.data[c.wrapped().key][0].value:null},ai.prototype.remove=function(c,h){if(!this.has(c))return this;var f=c.wrapped().key,m=h===void 0?0:this.data[f].indexOf(h),S=this.data[f][m];return this.data[f].splice(m,1),S.timeout&&clearTimeout(S.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(S.value),this.order.splice(this.order.indexOf(f),1),this},ai.prototype.setMaxSize=function(c){for(this.max=c;this.order.length>this.max;){var h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this},ai.prototype.filter=function(c){var h=[];for(var f in this.data)for(var m=0,S=this.data[f];m<S.length;m+=1){var k=S[m];c(k.value)||h.push(k)}for(var P=0,N=h;P<N.length;P+=1){var Y=N[P];this.remove(Y.value.tileID,Y)}};var Rn=function(c,h,f){this.context=c;var m=c.gl;this.buffer=m.createBuffer(),this.dynamicDraw=Boolean(f),this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};Rn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Rn.prototype.updateData=function(c){var h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)},Rn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Ba={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},oa=function(c,h,f,m){this.length=h.length,this.attributes=f,this.itemSize=h.bytesPerElement,this.dynamicDraw=m,this.context=c;var S=c.gl;this.buffer=S.createBuffer(),c.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};oa.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},oa.prototype.updateData=function(c){var h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,c.arrayBuffer)},oa.prototype.enableAttributes=function(c,h){for(var f=0;f<this.attributes.length;f++){var m=h.attributes[this.attributes[f].name];m!==void 0&&c.enableVertexAttribArray(m)}},oa.prototype.setVertexAttribPointers=function(c,h,f){for(var m=0;m<this.attributes.length;m++){var S=this.attributes[m],k=h.attributes[S.name];k!==void 0&&c.vertexAttribPointer(k,S.components,c[Ba[S.type]],!1,this.itemSize,S.offset+this.itemSize*(f||0))}},oa.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Ti=function(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Ti.prototype.get=function(){return this.current},Ti.prototype.set=function(c){},Ti.prototype.getDefault=function(){return this.default},Ti.prototype.setDefault=function(){this.set(this.default)};var Ca=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return x.Color.transparent},h.prototype.set=function(f){var m=this.current;(f.r!==m.r||f.g!==m.g||f.b!==m.b||f.a!==m.a||this.dirty)&&(this.gl.clearColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)},h}(Ti),xi=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return 1},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.clearDepth(f),this.current=f,this.dirty=!1)},h}(Ti),Hi=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return 0},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.clearStencil(f),this.current=f,this.dirty=!1)},h}(Ti),vi=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return[!0,!0,!0,!0]},h.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||f[2]!==m[2]||f[3]!==m[3]||this.dirty)&&(this.gl.colorMask(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)},h}(Ti),mi=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!0},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.depthMask(f),this.current=f,this.dirty=!1)},h}(Ti),ss=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return 255},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.stencilMask(f),this.current=f,this.dirty=!1)},h}(Ti),Po=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},h.prototype.set=function(f){var m=this.current;(f.func!==m.func||f.ref!==m.ref||f.mask!==m.mask||this.dirty)&&(this.gl.stencilFunc(f.func,f.ref,f.mask),this.current=f,this.dirty=!1)},h}(Ti),ao=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){var f=this.gl;return[f.KEEP,f.KEEP,f.KEEP]},h.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||f[2]!==m[2]||this.dirty)&&(this.gl.stencilOp(f[0],f[1],f[2]),this.current=f,this.dirty=!1)},h}(Ti),bt=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.STENCIL_TEST):m.disable(m.STENCIL_TEST),this.current=f,this.dirty=!1}},h}(Ti),pe=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return[0,1]},h.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||this.dirty)&&(this.gl.depthRange(f[0],f[1]),this.current=f,this.dirty=!1)},h}(Ti),ie=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST),this.current=f,this.dirty=!1}},h}(Ti),Ce=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.LESS},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.depthFunc(f),this.current=f,this.dirty=!1)},h}(Ti),V=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.BLEND):m.disable(m.BLEND),this.current=f,this.dirty=!1}},h}(Ti),We=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){var f=this.gl;return[f.ONE,f.ZERO]},h.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||this.dirty)&&(this.gl.blendFunc(f[0],f[1]),this.current=f,this.dirty=!1)},h}(Ti),Gt=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return x.Color.transparent},h.prototype.set=function(f){var m=this.current;(f.r!==m.r||f.g!==m.g||f.b!==m.b||f.a!==m.a||this.dirty)&&(this.gl.blendColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)},h}(Ti),Vr=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.FUNC_ADD},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.blendEquation(f),this.current=f,this.dirty=!1)},h}(Ti),Mr=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.CULL_FACE):m.disable(m.CULL_FACE),this.current=f,this.dirty=!1}},h}(Ti),Yn=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.BACK},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.cullFace(f),this.current=f,this.dirty=!1)},h}(Ti),Fi=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.CCW},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.frontFace(f),this.current=f,this.dirty=!1)},h}(Ti),Qn=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)},h}(Ti),Bn=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.TEXTURE0},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.activeTexture(f),this.current=f,this.dirty=!1)},h}(Ti),Fn=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){var f=this.gl;return[0,0,f.drawingBufferWidth,f.drawingBufferHeight]},h.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||f[2]!==m[2]||f[3]!==m[3]||this.dirty)&&(this.gl.viewport(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)},h}(Ti),eo=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindFramebuffer(m.FRAMEBUFFER,f),this.current=f,this.dirty=!1}},h}(Ti),va=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindRenderbuffer(m.RENDERBUFFER,f),this.current=f,this.dirty=!1}},h}(Ti),Yi=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindTexture(m.TEXTURE_2D,f),this.current=f,this.dirty=!1}},h}(Ti),Lo=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindBuffer(m.ARRAY_BUFFER,f),this.current=f,this.dirty=!1}},h}(Ti),to=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){var m=this.gl;m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,f),this.current=f,this.dirty=!1},h}(Ti),So=function(c){function h(f){c.call(this,f),this.vao=f.extVertexArrayObject}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){this.vao&&(f!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(f),this.current=f,this.dirty=!1)},h}(Ti),Ji=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return 4},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_ALIGNMENT,f),this.current=f,this.dirty=!1}},h}(Ti),ro=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),this.current=f,this.dirty=!1}},h}(Ti),hi=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,f),this.current=f,this.dirty=!1}},h}(Ti),fa=function(c){function h(f,m){c.call(this,f),this.context=f,this.parent=m}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h}(Ti),$=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.setDirty=function(){this.dirty=!0},h.prototype.set=function(f){if(f!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var m=this.gl;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,f,0),this.current=f,this.dirty=!1}},h}(fa),ne=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.set=function(f){if(f!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var m=this.gl;m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,f),this.current=f,this.dirty=!1}},h}(fa),he=function(c,h,f,m){this.context=c,this.width=h,this.height=f;var S=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new $(c,S),m&&(this.depthAttachment=new ne(c,S))};he.prototype.destroy=function(){var c=this.context.gl,h=this.colorAttachment.get();if(h&&c.deleteTexture(h),this.depthAttachment){var f=this.depthAttachment.get();f&&c.deleteRenderbuffer(f)}c.deleteFramebuffer(this.framebuffer)};var be=function(c,h,f){this.func=c,this.mask=h,this.range=f};be.ReadOnly=!1,be.ReadWrite=!0,be.disabled=new be(519,be.ReadOnly,[0,1]);var Ne=function(c,h,f,m,S,k){this.test=c,this.ref=h,this.mask=f,this.fail=m,this.depthFail=S,this.pass=k};Ne.disabled=new Ne({func:519,mask:0},0,0,7680,7680,7680);var Ye=function(c,h,f){this.blendFunction=c,this.blendColor=h,this.mask=f};Ye.disabled=new Ye(Ye.Replace=[1,0],x.Color.transparent,[!1,!1,!1,!1]),Ye.unblended=new Ye(Ye.Replace,x.Color.transparent,[!0,!0,!0,!0]),Ye.alphaBlended=new Ye([1,771],x.Color.transparent,[!0,!0,!0,!0]);var lt=function(c,h,f){this.enable=c,this.mode=h,this.frontFace=f};lt.disabled=new lt(!1,1029,2305),lt.backCCW=new lt(!0,1029,2305);var _e=function(c){this.gl=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ca(this),this.clearDepth=new xi(this),this.clearStencil=new Hi(this),this.colorMask=new vi(this),this.depthMask=new mi(this),this.stencilMask=new ss(this),this.stencilFunc=new Po(this),this.stencilOp=new ao(this),this.stencilTest=new bt(this),this.depthRange=new pe(this),this.depthTest=new ie(this),this.depthFunc=new Ce(this),this.blend=new V(this),this.blendFunc=new We(this),this.blendColor=new Gt(this),this.blendEquation=new Vr(this),this.cullFace=new Mr(this),this.cullFaceSide=new Yn(this),this.frontFace=new Fi(this),this.program=new Qn(this),this.activeTexture=new Bn(this),this.viewport=new Fn(this),this.bindFramebuffer=new eo(this),this.bindRenderbuffer=new va(this),this.bindTexture=new Yi(this),this.bindVertexBuffer=new Lo(this),this.bindElementBuffer=new to(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new So(this),this.pixelStoreUnpack=new Ji(this),this.pixelStoreUnpackPremultiplyAlpha=new ro(this),this.pixelStoreUnpackFlipY=new hi(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=c.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(c.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)};_e.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},_e.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},_e.prototype.createIndexBuffer=function(c,h){return new Rn(this,c,h)},_e.prototype.createVertexBuffer=function(c,h,f){return new oa(this,c,h,f)},_e.prototype.createRenderbuffer=function(c,h,f){var m=this.gl,S=m.createRenderbuffer();return this.bindRenderbuffer.set(S),m.renderbufferStorage(m.RENDERBUFFER,c,h,f),this.bindRenderbuffer.set(null),S},_e.prototype.createFramebuffer=function(c,h,f){return new he(this,c,h,f)},_e.prototype.clear=function(c){var h=c.color,f=c.depth,m=this.gl,S=0;h&&(S|=m.COLOR_BUFFER_BIT,this.clearColor.set(h),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(S|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),m.clear(S)},_e.prototype.setCullFace=function(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))},_e.prototype.setDepthMode=function(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)},_e.prototype.setStencilMode=function(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)},_e.prototype.setColorMode=function(c){x.deepEqual(c.blendFunction,Ye.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)},_e.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var je=function(c){function h(f,m,S){var k=this;c.call(this),this.id=f,this.dispatcher=S,this.on("data",function(P){P.dataType==="source"&&P.sourceDataType==="metadata"&&(k._sourceLoaded=!0),k._sourceLoaded&&!k._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(k.reload(),k.transform&&k.update(k.transform))}),this.on("error",function(){k._sourceErrored=!0}),this._source=function(P,N,Y,te){var ye=new cr[N.type](P,N,Y,te);if(ye.id!==P)throw new Error("Expected Source id to be "+P+" instead of "+ye.id);return x.bindAll(["load","abort","unload","serialize","prepare"],ye),ye}(f,m,S,this),this._tiles={},this._cache=new ai(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new x.SourceFeatureState}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.onAdd=function(f){this.map=f,this._maxTileCacheSize=f?f._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(f)},h.prototype.onRemove=function(f){this._source&&this._source.onRemove&&this._source.onRemove(f)},h.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var f in this._tiles){var m=this._tiles[f];if(m.state!=="loaded"&&m.state!=="errored")return!1}return!0},h.prototype.getSource=function(){return this._source},h.prototype.pause=function(){this._paused=!0},h.prototype.resume=function(){if(this._paused){var f=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,f&&this.reload(),this.transform&&this.update(this.transform)}},h.prototype._loadTile=function(f,m){return this._source.loadTile(f,m)},h.prototype._unloadTile=function(f){if(this._source.unloadTile)return this._source.unloadTile(f,function(){})},h.prototype._abortTile=function(f){if(this._source.abortTile)return this._source.abortTile(f,function(){})},h.prototype.serialize=function(){return this._source.serialize()},h.prototype.prepare=function(f){for(var m in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var S=this._tiles[m];S.upload(f),S.prepare(this.map.style.imageManager)}},h.prototype.getIds=function(){return x.values(this._tiles).map(function(f){return f.tileID}).sort(Mt).map(function(f){return f.key})},h.prototype.getRenderableIds=function(f){var m=this,S=[];for(var k in this._tiles)this._isIdRenderable(k,f)&&S.push(this._tiles[k]);return f?S.sort(function(P,N){var Y=P.tileID,te=N.tileID,ye=new x.Point(Y.canonical.x,Y.canonical.y)._rotate(m.transform.angle),le=new x.Point(te.canonical.x,te.canonical.y)._rotate(m.transform.angle);return Y.overscaledZ-te.overscaledZ||le.y-ye.y||le.x-ye.x}).map(function(P){return P.tileID.key}):S.map(function(P){return P.tileID}).sort(Mt).map(function(P){return P.key})},h.prototype.hasRenderableParent=function(f){var m=this.findLoadedParent(f,0);return!!m&&this._isIdRenderable(m.tileID.key)},h.prototype._isIdRenderable=function(f,m){return this._tiles[f]&&this._tiles[f].hasData()&&!this._coveredTiles[f]&&(m||!this._tiles[f].holdingForFade())},h.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var f in this._cache.reset(),this._tiles)this._tiles[f].state!=="errored"&&this._reloadTile(f,"reloading")},h.prototype._reloadTile=function(f,m){var S=this._tiles[f];S&&(S.state!=="loading"&&(S.state=m),this._loadTile(S,this._tileLoaded.bind(this,S,f,m)))},h.prototype._tileLoaded=function(f,m,S,k){if(k)return f.state="errored",void(k.status!==404?this._source.fire(new x.ErrorEvent(k,{tile:f})):this.update(this.transform));f.timeAdded=x.browser.now(),S==="expired"&&(f.refreshedUponExpiration=!0),this._setTileReloadTimer(m,f),this.getSource().type==="raster-dem"&&f.dem&&this._backfillDEM(f),this._state.initializeTileState(f,this.map?this.map.painter:null),this._source.fire(new x.Event("data",{dataType:"source",tile:f,coord:f.tileID}))},h.prototype._backfillDEM=function(f){for(var m=this.getRenderableIds(),S=0;S<m.length;S++){var k=m[S];if(f.neighboringTiles&&f.neighboringTiles[k]){var P=this.getTileByID(k);N(f,P),N(P,f)}}function N(Y,te){Y.needsHillshadePrepare=!0;var ye=te.tileID.canonical.x-Y.tileID.canonical.x,le=te.tileID.canonical.y-Y.tileID.canonical.y,xe=Math.pow(2,Y.tileID.canonical.z),ze=te.tileID.key;ye===0&&le===0||Math.abs(le)>1||(Math.abs(ye)>1&&(Math.abs(ye+xe)===1?ye+=xe:Math.abs(ye-xe)===1&&(ye-=xe)),te.dem&&Y.dem&&(Y.dem.backfillBorder(te.dem,ye,le),Y.neighboringTiles&&Y.neighboringTiles[ze]&&(Y.neighboringTiles[ze].backfilled=!0)))}},h.prototype.getTile=function(f){return this.getTileByID(f.key)},h.prototype.getTileByID=function(f){return this._tiles[f]},h.prototype._retainLoadedChildren=function(f,m,S,k){for(var P in this._tiles){var N=this._tiles[P];if(!(k[P]||!N.hasData()||N.tileID.overscaledZ<=m||N.tileID.overscaledZ>S)){for(var Y=N.tileID;N&&N.tileID.overscaledZ>m+1;){var te=N.tileID.scaledTo(N.tileID.overscaledZ-1);(N=this._tiles[te.key])&&N.hasData()&&(Y=te)}for(var ye=Y;ye.overscaledZ>m;)if(f[(ye=ye.scaledTo(ye.overscaledZ-1)).key]){k[Y.key]=Y;break}}}},h.prototype.findLoadedParent=function(f,m){if(f.key in this._loadedParentTiles){var S=this._loadedParentTiles[f.key];return S&&S.tileID.overscaledZ>=m?S:null}for(var k=f.overscaledZ-1;k>=m;k--){var P=f.scaledTo(k),N=this._getLoadedTile(P);if(N)return N}},h.prototype._getLoadedTile=function(f){var m=this._tiles[f.key];return m&&m.hasData()?m:this._cache.getByKey(f.wrapped().key)},h.prototype.updateCacheSize=function(f){var m=Math.ceil(f.width/this._source.tileSize)+1,S=Math.ceil(f.height/this._source.tileSize)+1,k=Math.floor(m*S*5),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,k):k;this._cache.setMaxSize(P)},h.prototype.handleWrapJump=function(f){var m=Math.round((f-(this._prevLng===void 0?f:this._prevLng))/360);if(this._prevLng=f,m){var S={};for(var k in this._tiles){var P=this._tiles[k];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+m),S[P.tileID.key]=P}for(var N in this._tiles=S,this._timers)clearTimeout(this._timers[N]),delete this._timers[N];for(var Y in this._tiles)this._setTileReloadTimer(Y,this._tiles[Y])}},h.prototype.update=function(f){var m=this;if(this.transform=f,this._sourceLoaded&&!this._paused){var S;this.updateCacheSize(f),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?S=f.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Or){return new x.OverscaledTileID(Or.canonical.z,Or.wrap,Or.canonical.z,Or.canonical.x,Or.canonical.y)}):(S=f.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(S=S.filter(function(Or){return m._source.hasTile(Or)}))):S=[];var k=f.coveringZoomLevel(this._source),P=Math.max(k-h.maxOverzooming,this._source.minzoom),N=Math.max(k+h.maxUnderzooming,this._source.minzoom),Y=this._updateRetainedTiles(S,k);if(Sr(this._source.type)){for(var te={},ye={},le=0,xe=Object.keys(Y);le<xe.length;le+=1){var ze=xe[le],Ue=Y[ze],Je=this._tiles[ze];if(Je&&!(Je.fadeEndTime&&Je.fadeEndTime<=x.browser.now())){var Fe=this.findLoadedParent(Ue,P);Fe&&(this._addTile(Fe.tileID),te[Fe.tileID.key]=Fe.tileID),ye[ze]=Ue}}for(var et in this._retainLoadedChildren(ye,k,N,Y),te)Y[et]||(this._coveredTiles[et]=!0,Y[et]=te[et])}for(var pt in Y)this._tiles[pt].clearFadeHold();for(var kt=0,Qt=x.keysDifference(this._tiles,Y);kt<Qt.length;kt+=1){var Bt=Qt[kt],nr=this._tiles[Bt];nr.hasSymbolBuckets&&!nr.holdingForFade()?nr.setHoldDuration(this.map._fadeDuration):nr.hasSymbolBuckets&&!nr.symbolFadeFinished()||this._removeTile(Bt)}this._updateLoadedParentTileCache()}},h.prototype.releaseSymbolFadeTiles=function(){for(var f in this._tiles)this._tiles[f].holdingForFade()&&this._removeTile(f)},h.prototype._updateRetainedTiles=function(f,m){for(var S={},k={},P=Math.max(m-h.maxOverzooming,this._source.minzoom),N=Math.max(m+h.maxUnderzooming,this._source.minzoom),Y={},te=0,ye=f;te<ye.length;te+=1){var le=ye[te],xe=this._addTile(le);S[le.key]=le,xe.hasData()||m<this._source.maxzoom&&(Y[le.key]=le)}this._retainLoadedChildren(Y,m,N,S);for(var ze=0,Ue=f;ze<Ue.length;ze+=1){var Je=Ue[ze],Fe=this._tiles[Je.key];if(!Fe.hasData()){if(m+1>this._source.maxzoom){var et=Je.children(this._source.maxzoom)[0],pt=this.getTile(et);if(pt&&pt.hasData()){S[et.key]=et;continue}}else{var kt=Je.children(this._source.maxzoom);if(S[kt[0].key]&&S[kt[1].key]&&S[kt[2].key]&&S[kt[3].key])continue}for(var Qt=Fe.wasRequested(),Bt=Je.overscaledZ-1;Bt>=P;--Bt){var nr=Je.scaledTo(Bt);if(k[nr.key]||(k[nr.key]=!0,!(Fe=this.getTile(nr))&&Qt&&(Fe=this._addTile(nr)),Fe&&(S[nr.key]=nr,Qt=Fe.wasRequested(),Fe.hasData())))break}}}return S},h.prototype._updateLoadedParentTileCache=function(){for(var f in this._loadedParentTiles={},this._tiles){for(var m=[],S=void 0,k=this._tiles[f].tileID;k.overscaledZ>0;){if(k.key in this._loadedParentTiles){S=this._loadedParentTiles[k.key];break}m.push(k.key);var P=k.scaledTo(k.overscaledZ-1);if(S=this._getLoadedTile(P))break;k=P}for(var N=0,Y=m;N<Y.length;N+=1)this._loadedParentTiles[Y[N]]=S}},h.prototype._addTile=function(f){var m=this._tiles[f.key];if(m)return m;(m=this._cache.getAndRemove(f))&&(this._setTileReloadTimer(f.key,m),m.tileID=f,this._state.initializeTileState(m,this.map?this.map.painter:null),this._cacheTimers[f.key]&&(clearTimeout(this._cacheTimers[f.key]),delete this._cacheTimers[f.key],this._setTileReloadTimer(f.key,m)));var S=Boolean(m);return S||(m=new x.Tile(f,this._source.tileSize*f.overscaleFactor()),this._loadTile(m,this._tileLoaded.bind(this,m,f.key,m.state))),m?(m.uses++,this._tiles[f.key]=m,S||this._source.fire(new x.Event("dataloading",{tile:m,coord:m.tileID,dataType:"source"})),m):null},h.prototype._setTileReloadTimer=function(f,m){var S=this;f in this._timers&&(clearTimeout(this._timers[f]),delete this._timers[f]);var k=m.getExpiryTimeout();k&&(this._timers[f]=setTimeout(function(){S._reloadTile(f,"expired"),delete S._timers[f]},k))},h.prototype._removeTile=function(f){var m=this._tiles[f];m&&(m.uses--,delete this._tiles[f],this._timers[f]&&(clearTimeout(this._timers[f]),delete this._timers[f]),m.uses>0||(m.hasData()&&m.state!=="reloading"?this._cache.add(m.tileID,m,m.getExpiryTimeout()):(m.aborted=!0,this._abortTile(m),this._unloadTile(m))))},h.prototype.clearTiles=function(){for(var f in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(f);this._cache.reset()},h.prototype.tilesIn=function(f,m,S){var k=this,P=[],N=this.transform;if(!N)return P;for(var Y=S?N.getCameraQueryGeometry(f):f,te=f.map(function(Bt){return N.pointCoordinate(Bt)}),ye=Y.map(function(Bt){return N.pointCoordinate(Bt)}),le=this.getIds(),xe=1/0,ze=1/0,Ue=-1/0,Je=-1/0,Fe=0,et=ye;Fe<et.length;Fe+=1){var pt=et[Fe];xe=Math.min(xe,pt.x),ze=Math.min(ze,pt.y),Ue=Math.max(Ue,pt.x),Je=Math.max(Je,pt.y)}for(var kt=function(Bt){var nr=k._tiles[le[Bt]];if(!nr.holdingForFade()){var Or=nr.tileID,un=Math.pow(2,N.zoom-nr.tileID.overscaledZ),rn=m*nr.queryPadding*x.EXTENT/nr.tileSize/un,Pn=[Or.getTilePoint(new x.MercatorCoordinate(xe,ze)),Or.getTilePoint(new x.MercatorCoordinate(Ue,Je))];if(Pn[0].x-rn<x.EXTENT&&Pn[0].y-rn<x.EXTENT&&Pn[1].x+rn>=0&&Pn[1].y+rn>=0){var ui=te.map(function(fi){return Or.getTilePoint(fi)}),gi=ye.map(function(fi){return Or.getTilePoint(fi)});P.push({tile:nr,tileID:Or,queryGeometry:ui,cameraQueryGeometry:gi,scale:un})}}},Qt=0;Qt<le.length;Qt++)kt(Qt);return P},h.prototype.getVisibleCoordinates=function(f){for(var m=this,S=this.getRenderableIds(f).map(function(Y){return m._tiles[Y].tileID}),k=0,P=S;k<P.length;k+=1){var N=P[k];N.posMatrix=this.transform.calculatePosMatrix(N.toUnwrapped())}return S},h.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Sr(this._source.type))for(var f in this._tiles){var m=this._tiles[f];if(m.fadeEndTime!==void 0&&m.fadeEndTime>=x.browser.now())return!0}return!1},h.prototype.setFeatureState=function(f,m,S){this._state.updateState(f=f||"_geojsonTileLayer",m,S)},h.prototype.removeFeatureState=function(f,m,S){this._state.removeFeatureState(f=f||"_geojsonTileLayer",m,S)},h.prototype.getFeatureState=function(f,m){return this._state.getState(f=f||"_geojsonTileLayer",m)},h.prototype.setDependencies=function(f,m,S){var k=this._tiles[f];k&&k.setDependencies(m,S)},h.prototype.reloadTilesForDependencies=function(f,m){for(var S in this._tiles)this._tiles[S].hasDependency(f,m)&&this._reloadTile(S,"reloading");this._cache.filter(function(k){return!k.hasDependency(f,m)})},h}(x.Evented);function Mt(c,h){var f=Math.abs(2*c.wrap)-+(c.wrap<0),m=Math.abs(2*h.wrap)-+(h.wrap<0);return c.overscaledZ-h.overscaledZ||m-f||h.canonical.y-c.canonical.y||h.canonical.x-c.canonical.x}function Sr(c){return c==="raster"||c==="image"||c==="video"}function zt(){return new x.window.Worker(tf.workerUrl)}je.maxOverzooming=10,je.maxUnderzooming=3;var Yt="mapboxgl_preloaded_worker_pool",Lr=function(){this.active={}};Lr.prototype.acquire=function(c){if(!this.workers)for(this.workers=[];this.workers.length<Lr.workerCount;)this.workers.push(new zt);return this.active[c]=!0,this.workers.slice()},Lr.prototype.release=function(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(function(h){h.terminate()}),this.workers=null)},Lr.prototype.isPreloaded=function(){return!!this.active[Yt]},Lr.prototype.numActive=function(){return Object.keys(this.active).length};var $n,vn=Math.floor(x.browser.hardwareConcurrency/2);function Nt(){return $n||($n=new Lr),$n}function pr(c,h){var f={};for(var m in c)m!=="ref"&&(f[m]=c[m]);return x.refProperties.forEach(function(S){S in h&&(f[S]=h[S])}),f}function on(c){c=c.slice();for(var h=Object.create(null),f=0;f<c.length;f++)h[c[f].id]=c[f];for(var m=0;m<c.length;m++)"ref"in c[m]&&(c[m]=pr(c[m],h[c[m].ref]));return c}Lr.workerCount=Math.max(Math.min(vn,6),1);var cn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function $i(c,h,f){f.push({command:cn.addSource,args:[c,h[c]]})}function Cn(c,h,f){h.push({command:cn.removeSource,args:[c]}),f[c]=!0}function xt(c,h,f,m){Cn(c,f,m),$i(c,h,f)}function St(c,h,f){var m;for(m in c[f])if(c[f].hasOwnProperty(m)&&m!=="data"&&!x.deepEqual(c[f][m],h[f][m]))return!1;for(m in h[f])if(h[f].hasOwnProperty(m)&&m!=="data"&&!x.deepEqual(c[f][m],h[f][m]))return!1;return!0}function qi(c,h,f,m,S,k){var P;for(P in h=h||{},c=c||{})c.hasOwnProperty(P)&&(x.deepEqual(c[P],h[P])||f.push({command:k,args:[m,P,h[P],S]}));for(P in h)h.hasOwnProperty(P)&&!c.hasOwnProperty(P)&&(x.deepEqual(c[P],h[P])||f.push({command:k,args:[m,P,h[P],S]}))}function na(c){return c.id}function ea(c,h){return c[h.id]=h,c}var oi=function(c,h){this.reset(c,h)};oi.prototype.reset=function(c,h){this.points=c||[],this._distances=[0];for(var f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding},oi.prototype.lerp=function(c){if(this.points.length===1)return this.points[0];c=x.clamp(c,0,1);for(var h=1,f=this._distances[h],m=c*this.paddedLength+this.padding;f<m&&h<this._distances.length;)f=this._distances[++h];var S=h-1,k=this._distances[S],P=f-k,N=P>0?(m-k)/P:0;return this.points[S].mult(1-N).add(this.points[h].mult(N))};var Zi=function(c,h,f){var m=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(c/f),this.yCellCount=Math.ceil(h/f);for(var k=0;k<this.xCellCount*this.yCellCount;k++)m.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=h,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0};function fo(c,h,f,m,S){var k=x.create();return h?(x.scale(k,k,[1/S,1/S,1]),f||x.rotateZ(k,k,m.angle)):x.multiply(k,m.labelPlaneMatrix,c),k}function mr(c,h,f,m,S){if(h){var k=x.clone(c);return x.scale(k,k,[S,S,1]),f||x.rotateZ(k,k,-m.angle),k}return m.glCoordMatrix}function lr(c,h){var f=[c.x,c.y,0,1];Ao(f,f,h);var m=f[3];return{point:new x.Point(f[0]/m,f[1]/m),signedDistanceFromCamera:m}}function nt(c,h){return .5+c/h*.5}function Ya(c,h){var f=c[0]/c[3],m=c[1]/c[3];return f>=-h[0]&&f<=h[0]&&m>=-h[1]&&m<=h[1]}function dt(c,h,f,m,S,k,P,N){var Y=m?c.textSizeData:c.iconSizeData,te=x.evaluateSizeForZoom(Y,f.transform.zoom),ye=[256/f.width*2+1,256/f.height*2+1],le=m?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;le.clear();for(var xe=c.lineVertexArray,ze=m?c.text.placedSymbolArray:c.icon.placedSymbolArray,Ue=f.transform.width/f.transform.height,Je=!1,Fe=0;Fe<ze.length;Fe++){var et=ze.get(Fe);if(et.hidden||et.writingMode===x.WritingMode.vertical&&!Je)Aa(et.numGlyphs,le);else{Je=!1;var pt=[et.anchorX,et.anchorY,0,1];if(x.transformMat4(pt,pt,h),Ya(pt,ye)){var kt=nt(f.transform.cameraToCenterDistance,pt[3]),Qt=x.evaluateSizeForFeature(Y,te,et),Bt=P?Qt/kt:Qt*kt,nr=new x.Point(et.anchorX,et.anchorY),Or=lr(nr,S).point,un={},rn=lu(et,Bt,!1,N,h,S,k,c.glyphOffsetArray,xe,le,Or,nr,un,Ue);Je=rn.useVertical,(rn.notEnoughRoom||Je||rn.needsFlipping&&lu(et,Bt,!0,N,h,S,k,c.glyphOffsetArray,xe,le,Or,nr,un,Ue).notEnoughRoom)&&Aa(et.numGlyphs,le)}else Aa(et.numGlyphs,le)}}m?c.text.dynamicLayoutVertexBuffer.updateData(le):c.icon.dynamicLayoutVertexBuffer.updateData(le)}function wo(c,h,f,m,S,k,P,N,Y,te,ye){var le=N.glyphStartIndex+N.numGlyphs,xe=N.lineStartIndex,ze=N.lineStartIndex+N.lineLength,Ue=h.getoffsetX(N.glyphStartIndex),Je=h.getoffsetX(le-1),Fe=Li(c*Ue,f,m,S,k,P,N.segment,xe,ze,Y,te,ye);if(!Fe)return null;var et=Li(c*Je,f,m,S,k,P,N.segment,xe,ze,Y,te,ye);return et?{first:Fe,last:et}:null}function qa(c,h,f,m){return c===x.WritingMode.horizontal&&Math.abs(f.y-h.y)>Math.abs(f.x-h.x)*m?{useVertical:!0}:(c===x.WritingMode.vertical?h.y<f.y:h.x>f.x)?{needsFlipping:!0}:null}function lu(c,h,f,m,S,k,P,N,Y,te,ye,le,xe,ze){var Ue,Je=h/24,Fe=c.lineOffsetX*Je,et=c.lineOffsetY*Je;if(c.numGlyphs>1){var pt=c.glyphStartIndex+c.numGlyphs,kt=c.lineStartIndex,Qt=c.lineStartIndex+c.lineLength,Bt=wo(Je,N,Fe,et,f,ye,le,c,Y,k,xe);if(!Bt)return{notEnoughRoom:!0};var nr=lr(Bt.first.point,P).point,Or=lr(Bt.last.point,P).point;if(m&&!f){var un=qa(c.writingMode,nr,Or,ze);if(un)return un}Ue=[Bt.first];for(var rn=c.glyphStartIndex+1;rn<pt-1;rn++)Ue.push(Li(Je*N.getoffsetX(rn),Fe,et,f,ye,le,c.segment,kt,Qt,Y,k,xe));Ue.push(Bt.last)}else{if(m&&!f){var Pn=lr(le,S).point,ui=c.lineStartIndex+c.segment+1,gi=new x.Point(Y.getx(ui),Y.gety(ui)),fi=lr(gi,S),_a=fi.signedDistanceFromCamera>0?fi.point:No(le,gi,Pn,1,S),Dn=qa(c.writingMode,Pn,_a,ze);if(Dn)return Dn}var Ii=Li(Je*N.getoffsetX(c.glyphStartIndex),Fe,et,f,ye,le,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,Y,k,xe);if(!Ii)return{notEnoughRoom:!0};Ue=[Ii]}for(var Wi=0,Bi=Ue;Wi<Bi.length;Wi+=1){var wi=Bi[Wi];x.addDynamicAttributes(te,wi.point,wi.angle)}return{}}function No(c,h,f,m,S){var k=lr(c.add(c.sub(h)._unit()),S).point,P=f.sub(k);return f.add(P._mult(m/P.mag()))}function Li(c,h,f,m,S,k,P,N,Y,te,ye,le){var xe=m?c-h:c+h,ze=xe>0?1:-1,Ue=0;m&&(ze*=-1,Ue=Math.PI),ze<0&&(Ue+=Math.PI);for(var Je=ze>0?N+P:N+P+1,Fe=S,et=S,pt=0,kt=0,Qt=Math.abs(xe),Bt=[];pt+kt<=Qt;){if((Je+=ze)<N||Je>=Y)return null;if(et=Fe,Bt.push(Fe),(Fe=le[Je])===void 0){var nr=new x.Point(te.getx(Je),te.gety(Je)),Or=lr(nr,ye);if(Or.signedDistanceFromCamera>0)Fe=le[Je]=Or.point;else{var un=Je-ze;Fe=No(pt===0?k:new x.Point(te.getx(un),te.gety(un)),nr,et,Qt-pt+1,ye)}}pt+=kt,kt=et.dist(Fe)}var rn=(Qt-pt)/kt,Pn=Fe.sub(et),ui=Pn.mult(rn)._add(et);ui._add(Pn._unit()._perp()._mult(f*ze));var gi=Ue+Math.atan2(Fe.y-et.y,Fe.x-et.x);return Bt.push(ui),{point:ui,angle:gi,path:Bt}}Zi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Zi.prototype.insert=function(c,h,f,m,S){this._forEachCell(h,f,m,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(S)},Zi.prototype.insertCircle=function(c,h,f,m){this._forEachCell(h-m,f-m,h+m,f+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(h),this.circles.push(f),this.circles.push(m)},Zi.prototype._insertBoxCell=function(c,h,f,m,S,k){this.boxCells[S].push(k)},Zi.prototype._insertCircleCell=function(c,h,f,m,S,k){this.circleCells[S].push(k)},Zi.prototype._query=function(c,h,f,m,S,k){if(f<0||c>this.width||m<0||h>this.height)return!S&&[];var P=[];if(c<=0&&h<=0&&this.width<=f&&this.height<=m){if(S)return!0;for(var N=0;N<this.boxKeys.length;N++)P.push({key:this.boxKeys[N],x1:this.bboxes[4*N],y1:this.bboxes[4*N+1],x2:this.bboxes[4*N+2],y2:this.bboxes[4*N+3]});for(var Y=0;Y<this.circleKeys.length;Y++){var te=this.circles[3*Y],ye=this.circles[3*Y+1],le=this.circles[3*Y+2];P.push({key:this.circleKeys[Y],x1:te-le,y1:ye-le,x2:te+le,y2:ye+le})}return k?P.filter(k):P}return this._forEachCell(c,h,f,m,this._queryCell,P,{hitTest:S,seenUids:{box:{},circle:{}}},k),S?P.length>0:P},Zi.prototype._queryCircle=function(c,h,f,m,S){var k=c-f,P=c+f,N=h-f,Y=h+f;if(P<0||k>this.width||Y<0||N>this.height)return!m&&[];var te=[];return this._forEachCell(k,N,P,Y,this._queryCellCircle,te,{hitTest:m,circle:{x:c,y:h,radius:f},seenUids:{box:{},circle:{}}},S),m?te.length>0:te},Zi.prototype.query=function(c,h,f,m,S){return this._query(c,h,f,m,!1,S)},Zi.prototype.hitTest=function(c,h,f,m,S){return this._query(c,h,f,m,!0,S)},Zi.prototype.hitTestCircle=function(c,h,f,m){return this._queryCircle(c,h,f,!0,m)},Zi.prototype._queryCell=function(c,h,f,m,S,k,P,N){var Y=P.seenUids,te=this.boxCells[S];if(te!==null)for(var ye=this.bboxes,le=0,xe=te;le<xe.length;le+=1){var ze=xe[le];if(!Y.box[ze]){Y.box[ze]=!0;var Ue=4*ze;if(c<=ye[Ue+2]&&h<=ye[Ue+3]&&f>=ye[Ue+0]&&m>=ye[Ue+1]&&(!N||N(this.boxKeys[ze]))){if(P.hitTest)return k.push(!0),!0;k.push({key:this.boxKeys[ze],x1:ye[Ue],y1:ye[Ue+1],x2:ye[Ue+2],y2:ye[Ue+3]})}}}var Je=this.circleCells[S];if(Je!==null)for(var Fe=this.circles,et=0,pt=Je;et<pt.length;et+=1){var kt=pt[et];if(!Y.circle[kt]){Y.circle[kt]=!0;var Qt=3*kt;if(this._circleAndRectCollide(Fe[Qt],Fe[Qt+1],Fe[Qt+2],c,h,f,m)&&(!N||N(this.circleKeys[kt]))){if(P.hitTest)return k.push(!0),!0;var Bt=Fe[Qt],nr=Fe[Qt+1],Or=Fe[Qt+2];k.push({key:this.circleKeys[kt],x1:Bt-Or,y1:nr-Or,x2:Bt+Or,y2:nr+Or})}}}},Zi.prototype._queryCellCircle=function(c,h,f,m,S,k,P,N){var Y=P.circle,te=P.seenUids,ye=this.boxCells[S];if(ye!==null)for(var le=this.bboxes,xe=0,ze=ye;xe<ze.length;xe+=1){var Ue=ze[xe];if(!te.box[Ue]){te.box[Ue]=!0;var Je=4*Ue;if(this._circleAndRectCollide(Y.x,Y.y,Y.radius,le[Je+0],le[Je+1],le[Je+2],le[Je+3])&&(!N||N(this.boxKeys[Ue])))return k.push(!0),!0}}var Fe=this.circleCells[S];if(Fe!==null)for(var et=this.circles,pt=0,kt=Fe;pt<kt.length;pt+=1){var Qt=kt[pt];if(!te.circle[Qt]){te.circle[Qt]=!0;var Bt=3*Qt;if(this._circlesCollide(et[Bt],et[Bt+1],et[Bt+2],Y.x,Y.y,Y.radius)&&(!N||N(this.circleKeys[Qt])))return k.push(!0),!0}}},Zi.prototype._forEachCell=function(c,h,f,m,S,k,P,N){for(var Y=this._convertToXCellCoord(c),te=this._convertToYCellCoord(h),ye=this._convertToXCellCoord(f),le=this._convertToYCellCoord(m),xe=Y;xe<=ye;xe++)for(var ze=te;ze<=le;ze++)if(S.call(this,c,h,f,m,this.xCellCount*ze+xe,k,P,N))return},Zi.prototype._convertToXCellCoord=function(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))},Zi.prototype._convertToYCellCoord=function(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))},Zi.prototype._circlesCollide=function(c,h,f,m,S,k){var P=m-c,N=S-h,Y=f+k;return Y*Y>P*P+N*N},Zi.prototype._circleAndRectCollide=function(c,h,f,m,S,k,P){var N=(k-m)/2,Y=Math.abs(c-(m+N));if(Y>N+f)return!1;var te=(P-S)/2,ye=Math.abs(h-(S+te));if(ye>te+f)return!1;if(Y<=N||ye<=te)return!0;var le=Y-N,xe=ye-te;return le*le+xe*xe<=f*f};var ic=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Aa(c,h){for(var f=0;f<c;f++){var m=h.length;h.resize(m+4),h.float32.set(ic,3*m)}}function Ao(c,h,f){var m=h[0],S=h[1];return c[0]=f[0]*m+f[4]*S+f[12],c[1]=f[1]*m+f[5]*S+f[13],c[3]=f[3]*m+f[7]*S+f[15],c}var Ho=function(c,h,f){h===void 0&&(h=new Zi(c.width+200,c.height+200,25)),f===void 0&&(f=new Zi(c.width+200,c.height+200,25)),this.transform=c,this.grid=h,this.ignoredGrid=f,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+100,this.screenBottomBoundary=c.height+100,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200};function pa(c,h,f){return h*(x.EXTENT/(c.tileSize*Math.pow(2,f-c.tileID.overscaledZ)))}Ho.prototype.placeCollisionBox=function(c,h,f,m,S){var k=this.projectAndGetPerspectiveRatio(m,c.anchorPointX,c.anchorPointY),P=f*k.perspectiveRatio,N=c.x1*P+k.point.x,Y=c.y1*P+k.point.y,te=c.x2*P+k.point.x,ye=c.y2*P+k.point.y;return!this.isInsideGrid(N,Y,te,ye)||!h&&this.grid.hitTest(N,Y,te,ye,S)?{box:[],offscreen:!1}:{box:[N,Y,te,ye],offscreen:this.isOffscreen(N,Y,te,ye)}},Ho.prototype.placeCollisionCircles=function(c,h,f,m,S,k,P,N,Y,te,ye,le,xe){var ze=[],Ue=new x.Point(h.anchorX,h.anchorY),Je=lr(Ue,k),Fe=nt(this.transform.cameraToCenterDistance,Je.signedDistanceFromCamera),et=(te?S/Fe:S*Fe)/x.ONE_EM,pt=lr(Ue,P).point,kt=wo(et,m,h.lineOffsetX*et,h.lineOffsetY*et,!1,pt,Ue,h,f,P,{}),Qt=!1,Bt=!1,nr=!0;if(kt){for(var Or=.5*le*Fe+xe,un=new x.Point(-100,-100),rn=new x.Point(this.screenRightBoundary,this.screenBottomBoundary),Pn=new oi,ui=kt.first,gi=kt.last,fi=[],_a=ui.path.length-1;_a>=1;_a--)fi.push(ui.path[_a]);for(var Dn=1;Dn<gi.path.length;Dn++)fi.push(gi.path[Dn]);var Ii=2.5*Or;if(N){var Wi=fi.map(function(eu){return lr(eu,N)});fi=Wi.some(function(eu){return eu.signedDistanceFromCamera<=0})?[]:Wi.map(function(eu){return eu.point})}var Bi=[];if(fi.length>0){for(var wi=fi[0].clone(),Ki=fi[0].clone(),Ci=1;Ci<fi.length;Ci++)wi.x=Math.min(wi.x,fi[Ci].x),wi.y=Math.min(wi.y,fi[Ci].y),Ki.x=Math.max(Ki.x,fi[Ci].x),Ki.y=Math.max(Ki.y,fi[Ci].y);Bi=wi.x>=un.x&&Ki.x<=rn.x&&wi.y>=un.y&&Ki.y<=rn.y?[fi]:Ki.x<un.x||wi.x>rn.x||Ki.y<un.y||wi.y>rn.y?[]:x.clipLine([fi],un.x,un.y,rn.x,rn.y)}for(var Si=0,gs=Bi;Si<gs.length;Si+=1){var qo;Pn.reset(gs[Si],.25*Or),qo=Pn.length<=.5*Or?1:Math.ceil(Pn.paddedLength/Ii)+1;for(var Ds=0;Ds<qo;Ds++){var es=Ds/Math.max(qo-1,1),vo=Pn.lerp(es),lo=vo.x+100,pu=vo.y+100;ze.push(lo,pu,Or,0);var Js=lo-Or,Xl=pu-Or,du=lo+Or,Xu=pu+Or;if(nr=nr&&this.isOffscreen(Js,Xl,du,Xu),Bt=Bt||this.isInsideGrid(Js,Xl,du,Xu),!c&&this.grid.hitTestCircle(lo,pu,Or,ye)&&(Qt=!0,!Y))return{circles:[],offscreen:!1,collisionDetected:Qt}}}}return{circles:!Y&&Qt||!Bt?[]:ze,offscreen:nr,collisionDetected:Qt}},Ho.prototype.queryRenderedSymbols=function(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var h=[],f=1/0,m=1/0,S=-1/0,k=-1/0,P=0,N=c;P<N.length;P+=1){var Y=N[P],te=new x.Point(Y.x+100,Y.y+100);f=Math.min(f,te.x),m=Math.min(m,te.y),S=Math.max(S,te.x),k=Math.max(k,te.y),h.push(te)}for(var ye={},le={},xe=0,ze=this.grid.query(f,m,S,k).concat(this.ignoredGrid.query(f,m,S,k));xe<ze.length;xe+=1){var Ue=ze[xe],Je=Ue.key;if(ye[Je.bucketInstanceId]===void 0&&(ye[Je.bucketInstanceId]={}),!ye[Je.bucketInstanceId][Je.featureIndex]){var Fe=[new x.Point(Ue.x1,Ue.y1),new x.Point(Ue.x2,Ue.y1),new x.Point(Ue.x2,Ue.y2),new x.Point(Ue.x1,Ue.y2)];x.polygonIntersectsPolygon(h,Fe)&&(ye[Je.bucketInstanceId][Je.featureIndex]=!0,le[Je.bucketInstanceId]===void 0&&(le[Je.bucketInstanceId]=[]),le[Je.bucketInstanceId].push(Je.featureIndex))}}return le},Ho.prototype.insertCollisionBox=function(c,h,f,m,S){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:m,collisionGroupID:S},c[0],c[1],c[2],c[3])},Ho.prototype.insertCollisionCircles=function(c,h,f,m,S){for(var k=h?this.ignoredGrid:this.grid,P={bucketInstanceId:f,featureIndex:m,collisionGroupID:S},N=0;N<c.length;N+=4)k.insertCircle(P,c[N],c[N+1],c[N+2])},Ho.prototype.projectAndGetPerspectiveRatio=function(c,h,f){var m=[h,f,0,1];return Ao(m,m,c),{point:new x.Point((m[0]/m[3]+1)/2*this.transform.width+100,(-m[1]/m[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/m[3]*.5}},Ho.prototype.isOffscreen=function(c,h,f,m){return f<100||c>=this.screenRightBoundary||m<100||h>this.screenBottomBoundary},Ho.prototype.isInsideGrid=function(c,h,f,m){return f>=0&&c<this.gridRightBoundary&&m>=0&&h<this.gridBottomBoundary},Ho.prototype.getViewportMatrix=function(){var c=x.identity([]);return x.translate(c,c,[-100,-100,0]),c};var ws=function(c,h,f,m){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?h:-h))):m&&f?1:0,this.placed=f};ws.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Vs=function(c,h,f,m,S){this.text=new ws(c?c.text:null,h,f,S),this.icon=new ws(c?c.icon:null,h,m,S)};Vs.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var gl=function(c,h,f){this.text=c,this.icon=h,this.skipFade=f},oo=function(){this.invProjMatrix=x.create(),this.viewportMatrix=x.create(),this.circles=[]},ms=function(c,h,f,m,S){this.bucketInstanceId=c,this.featureIndex=h,this.sourceLayerIndex=f,this.bucketIndex=m,this.tileID=S},Oa=function(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}};function Ro(c,h,f,m,S){var k=x.getAnchorAlignment(c),P=-(k.horizontalAlign-.5)*h,N=-(k.verticalAlign-.5)*f,Y=x.evaluateVariableOffset(c,m);return new x.Point(P+Y[0]*S,N+Y[1]*S)}function Ps(c,h,f,m,S,k){var P=c.x1,N=c.x2,Y=c.y1,te=c.y2,ye=c.anchorPointX,le=c.anchorPointY,xe=new x.Point(h,f);return m&&xe._rotate(S?k:-k),{x1:P+xe.x,y1:Y+xe.y,x2:N+xe.x,y2:te+xe.y,anchorPointX:ye,anchorPointY:le}}Oa.prototype.get=function(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){var h=++this.maxGroupID;this.collisionGroups[c]={ID:h,predicate:function(f){return f.collisionGroupID===h}}}return this.collisionGroups[c]};var zo=function(c,h,f,m){this.transform=c.clone(),this.collisionIndex=new Ho(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Oa(f),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}};function yu(c,h,f,m,S){c.emplaceBack(h?1:0,f?1:0,m||0,S||0),c.emplaceBack(h?1:0,f?1:0,m||0,S||0),c.emplaceBack(h?1:0,f?1:0,m||0,S||0),c.emplaceBack(h?1:0,f?1:0,m||0,S||0)}zo.prototype.getBucketParts=function(c,h,f,m){var S=f.getBucket(h),k=f.latestFeatureIndex;if(S&&k&&h.id===S.layerIds[0]){var P=f.collisionBoxArray,N=S.layers[0].layout,Y=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),te=f.tileSize/x.EXTENT,ye=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),le=N.get("text-pitch-alignment")==="map",xe=N.get("text-rotation-alignment")==="map",ze=pa(f,1,this.transform.zoom),Ue=fo(ye,le,xe,this.transform,ze),Je=null;if(le){var Fe=mr(ye,le,xe,this.transform,ze);Je=x.multiply([],this.transform.labelPlaneMatrix,Fe)}this.retainedQueryData[S.bucketInstanceId]=new ms(S.bucketInstanceId,k,S.sourceLayerIndex,S.index,f.tileID);var et={bucket:S,layout:N,posMatrix:ye,textLabelPlaneMatrix:Ue,labelToScreenMatrix:Je,scale:Y,textPixelRatio:te,holdingForFade:f.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:x.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(m)for(var pt=0,kt=S.sortKeyRanges;pt<kt.length;pt+=1){var Qt=kt[pt];c.push({sortKey:Qt.sortKey,symbolInstanceStart:Qt.symbolInstanceStart,symbolInstanceEnd:Qt.symbolInstanceEnd,parameters:et})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:et})}},zo.prototype.attemptAnchorPlacement=function(c,h,f,m,S,k,P,N,Y,te,ye,le,xe,ze,Ue){var Je,Fe=[le.textOffset0,le.textOffset1],et=Ro(c,f,m,Fe,S),pt=this.collisionIndex.placeCollisionBox(Ps(h,et.x,et.y,k,P,this.transform.angle),ye,N,Y,te.predicate);if(!Ue||this.collisionIndex.placeCollisionBox(Ps(Ue,et.x,et.y,k,P,this.transform.angle),ye,N,Y,te.predicate).box.length!==0)return pt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[le.crossTileID]&&this.prevPlacement.placements[le.crossTileID]&&this.prevPlacement.placements[le.crossTileID].text&&(Je=this.prevPlacement.variableOffsets[le.crossTileID].anchor),this.variableOffsets[le.crossTileID]={textOffset:Fe,width:f,height:m,anchor:c,textBoxScale:S,prevAnchor:Je},this.markUsedJustification(xe,c,le,ze),xe.allowVerticalPlacement&&(this.markUsedOrientation(xe,ze,le),this.placedOrientations[le.crossTileID]=ze),{shift:et,placedGlyphBoxes:pt}):void 0},zo.prototype.placeLayerBucketPart=function(c,h,f){var m=this,S=c.parameters,k=S.bucket,P=S.layout,N=S.posMatrix,Y=S.textLabelPlaneMatrix,te=S.labelToScreenMatrix,ye=S.textPixelRatio,le=S.holdingForFade,xe=S.collisionBoxArray,ze=S.partiallyEvaluatedTextSize,Ue=S.collisionGroup,Je=P.get("text-optional"),Fe=P.get("icon-optional"),et=P.get("text-allow-overlap"),pt=P.get("icon-allow-overlap"),kt=P.get("text-rotation-alignment")==="map",Qt=P.get("text-pitch-alignment")==="map",Bt=P.get("icon-text-fit")!=="none",nr=P.get("symbol-z-order")==="viewport-y",Or=et&&(pt||!k.hasIconData()||Fe),un=pt&&(et||!k.hasTextData()||Je);!k.collisionArrays&&xe&&k.deserializeCollisionBoxes(xe);var rn=function(Dn,Ii){if(!h[Dn.crossTileID])if(le)m.placements[Dn.crossTileID]=new gl(!1,!1,!1);else{var Wi,Bi=!1,wi=!1,Ki=!0,Ci=null,Si={box:null,offscreen:null},gs={box:null,offscreen:null},qo=null,Ds=null,es=0,vo=0,lo=0;Ii.textFeatureIndex?es=Ii.textFeatureIndex:Dn.useRuntimeCollisionCircles&&(es=Dn.featureIndex),Ii.verticalTextFeatureIndex&&(vo=Ii.verticalTextFeatureIndex);var pu=Ii.textBox;if(pu){var Js=function(Pa){var Ou=x.WritingMode.horizontal;if(k.allowVerticalPlacement&&!Pa&&m.prevPlacement){var Bs=m.prevPlacement.placedOrientations[Dn.crossTileID];Bs&&(m.placedOrientations[Dn.crossTileID]=Bs,m.markUsedOrientation(k,Ou=Bs,Dn))}return Ou},Xl=function(Pa,Ou){if(k.allowVerticalPlacement&&Dn.numVerticalGlyphVertices>0&&Ii.verticalTextBox)for(var Bs=0,gc=k.writingModes;Bs<gc.length&&(gc[Bs]===x.WritingMode.vertical?(Si=Ou(),gs=Si):Si=Pa(),!(Si&&Si.box&&Si.box.length));Bs+=1);else Si=Pa()};if(P.get("text-variable-anchor")){var du=P.get("text-variable-anchor");if(m.prevPlacement&&m.prevPlacement.variableOffsets[Dn.crossTileID]){var Xu=m.prevPlacement.variableOffsets[Dn.crossTileID];du.indexOf(Xu.anchor)>0&&(du=du.filter(function(Pa){return Pa!==Xu.anchor})).unshift(Xu.anchor)}var eu=function(Pa,Ou,Bs){for(var gc=Pa.x2-Pa.x1,kf=Pa.y2-Pa.y1,$h=Dn.textBoxScale,Kh=Bt&&!pt?Ou:null,Yu={box:[],offscreen:!1},Oc=et?2*du.length:du.length,Fu=0;Fu<Oc;++Fu){var If=m.attemptAnchorPlacement(du[Fu%du.length],Pa,gc,kf,$h,kt,Qt,ye,N,Ue,Fu>=du.length,Dn,k,Bs,Kh);if(If&&(Yu=If.placedGlyphBoxes)&&Yu.box&&Yu.box.length){Bi=!0,Ci=If.shift;break}}return Yu};Xl(function(){return eu(pu,Ii.iconBox,x.WritingMode.horizontal)},function(){var Pa=Ii.verticalTextBox;return k.allowVerticalPlacement&&!(Si&&Si.box&&Si.box.length)&&Dn.numVerticalGlyphVertices>0&&Pa?eu(Pa,Ii.verticalIconBox,x.WritingMode.vertical):{box:null,offscreen:null}}),Si&&(Bi=Si.box,Ki=Si.offscreen);var Tf=Js(Si&&Si.box);if(!Bi&&m.prevPlacement){var rf=m.prevPlacement.variableOffsets[Dn.crossTileID];rf&&(m.variableOffsets[Dn.crossTileID]=rf,m.markUsedJustification(k,rf.anchor,Dn,Tf))}}else{var Yl=function(Pa,Ou){var Bs=m.collisionIndex.placeCollisionBox(Pa,et,ye,N,Ue.predicate);return Bs&&Bs.box&&Bs.box.length&&(m.markUsedOrientation(k,Ou,Dn),m.placedOrientations[Dn.crossTileID]=Ou),Bs};Xl(function(){return Yl(pu,x.WritingMode.horizontal)},function(){var Pa=Ii.verticalTextBox;return k.allowVerticalPlacement&&Dn.numVerticalGlyphVertices>0&&Pa?Yl(Pa,x.WritingMode.vertical):{box:null,offscreen:null}}),Js(Si&&Si.box&&Si.box.length)}}if(Bi=(Wi=Si)&&Wi.box&&Wi.box.length>0,Ki=Wi&&Wi.offscreen,Dn.useRuntimeCollisionCircles){var sl=k.text.placedSymbolArray.get(Dn.centerJustifiedTextSymbolIndex),Mf=x.evaluateSizeForFeature(k.textSizeData,ze,sl),ul=P.get("text-padding");qo=m.collisionIndex.placeCollisionCircles(et,sl,k.lineVertexArray,k.glyphOffsetArray,Mf,N,Y,te,f,Qt,Ue.predicate,Dn.collisionCircleDiameter,ul),Bi=et||qo.circles.length>0&&!qo.collisionDetected,Ki=Ki&&qo.offscreen}if(Ii.iconFeatureIndex&&(lo=Ii.iconFeatureIndex),Ii.iconBox){var mc=function(Pa){var Ou=Bt&&Ci?Ps(Pa,Ci.x,Ci.y,kt,Qt,m.transform.angle):Pa;return m.collisionIndex.placeCollisionBox(Ou,pt,ye,N,Ue.predicate)};wi=gs&&gs.box&&gs.box.length&&Ii.verticalIconBox?(Ds=mc(Ii.verticalIconBox)).box.length>0:(Ds=mc(Ii.iconBox)).box.length>0,Ki=Ki&&Ds.offscreen}var ql=Je||Dn.numHorizontalGlyphVertices===0&&Dn.numVerticalGlyphVertices===0,ls=Fe||Dn.numIconVertices===0;if(ql||ls?ls?ql||(wi=wi&&Bi):Bi=wi&&Bi:wi=Bi=wi&&Bi,Bi&&Wi&&Wi.box&&m.collisionIndex.insertCollisionBox(Wi.box,P.get("text-ignore-placement"),k.bucketInstanceId,gs&&gs.box&&vo?vo:es,Ue.ID),wi&&Ds&&m.collisionIndex.insertCollisionBox(Ds.box,P.get("icon-ignore-placement"),k.bucketInstanceId,lo,Ue.ID),qo&&(Bi&&m.collisionIndex.insertCollisionCircles(qo.circles,P.get("text-ignore-placement"),k.bucketInstanceId,es,Ue.ID),f)){var Pl=k.bucketInstanceId,Ll=m.collisionCircleArrays[Pl];Ll===void 0&&(Ll=m.collisionCircleArrays[Pl]=new oo);for(var tu=0;tu<qo.circles.length;tu+=4)Ll.circles.push(qo.circles[tu+0]),Ll.circles.push(qo.circles[tu+1]),Ll.circles.push(qo.circles[tu+2]),Ll.circles.push(qo.collisionDetected?1:0)}m.placements[Dn.crossTileID]=new gl(Bi||Or,wi||un,Ki||k.justReloaded),h[Dn.crossTileID]=!0}};if(nr)for(var Pn=k.getSortedSymbolIndexes(this.transform.angle),ui=Pn.length-1;ui>=0;--ui){var gi=Pn[ui];rn(k.symbolInstances.get(gi),k.collisionArrays[gi])}else for(var fi=c.symbolInstanceStart;fi<c.symbolInstanceEnd;fi++)rn(k.symbolInstances.get(fi),k.collisionArrays[fi]);if(f&&k.bucketInstanceId in this.collisionCircleArrays){var _a=this.collisionCircleArrays[k.bucketInstanceId];x.invert(_a.invProjMatrix,N),_a.viewportMatrix=this.collisionIndex.getViewportMatrix()}k.justReloaded=!1},zo.prototype.markUsedJustification=function(c,h,f,m){var S;S=m===x.WritingMode.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[x.getAnchorJustification(h)];for(var k=0,P=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];k<P.length;k+=1){var N=P[k];N>=0&&(c.text.placedSymbolArray.get(N).crossTileID=S>=0&&N!==S?0:f.crossTileID)}},zo.prototype.markUsedOrientation=function(c,h,f){for(var m=h===x.WritingMode.horizontal||h===x.WritingMode.horizontalOnly?h:0,S=h===x.WritingMode.vertical?h:0,k=0,P=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];k<P.length;k+=1)c.text.placedSymbolArray.get(P[k]).placedOrientation=m;f.verticalPlacedTextSymbolIndex&&(c.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=S)},zo.prototype.commit=function(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;var h=this.prevPlacement,f=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;var m=h?h.symbolFadeChange(c):1,S=h?h.opacities:{},k=h?h.variableOffsets:{},P=h?h.placedOrientations:{};for(var N in this.placements){var Y=this.placements[N],te=S[N];te?(this.opacities[N]=new Vs(te,m,Y.text,Y.icon),f=f||Y.text!==te.text.placed||Y.icon!==te.icon.placed):(this.opacities[N]=new Vs(null,m,Y.text,Y.icon,Y.skipFade),f=f||Y.text||Y.icon)}for(var ye in S){var le=S[ye];if(!this.opacities[ye]){var xe=new Vs(le,m,!1,!1);xe.isHidden()||(this.opacities[ye]=xe,f=f||le.text.placed||le.icon.placed)}}for(var ze in k)this.variableOffsets[ze]||!this.opacities[ze]||this.opacities[ze].isHidden()||(this.variableOffsets[ze]=k[ze]);for(var Ue in P)this.placedOrientations[Ue]||!this.opacities[Ue]||this.opacities[Ue].isHidden()||(this.placedOrientations[Ue]=P[Ue]);f?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:c)},zo.prototype.updateLayerOpacities=function(c,h){for(var f={},m=0,S=h;m<S.length;m+=1){var k=S[m],P=k.getBucket(c);P&&k.latestFeatureIndex&&c.id===P.layerIds[0]&&this.updateBucketOpacities(P,f,k.collisionBoxArray)}},zo.prototype.updateBucketOpacities=function(c,h,f){var m=this;c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();var S=c.layers[0].layout,k=new Vs(null,0,!1,!1,!0),P=S.get("text-allow-overlap"),N=S.get("icon-allow-overlap"),Y=S.get("text-variable-anchor"),te=S.get("text-rotation-alignment")==="map",ye=S.get("text-pitch-alignment")==="map",le=S.get("icon-text-fit")!=="none",xe=new Vs(null,0,P&&(N||!c.hasIconData()||S.get("icon-optional")),N&&(P||!c.hasTextData()||S.get("text-optional")),!0);!c.collisionArrays&&f&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(f);for(var ze=function(et,pt,kt){for(var Qt=0;Qt<pt/4;Qt++)et.opacityVertexArray.emplaceBack(kt)},Ue=function(et){var pt=c.symbolInstances.get(et),kt=pt.numHorizontalGlyphVertices,Qt=pt.numVerticalGlyphVertices,Bt=pt.crossTileID,nr=m.opacities[Bt];h[Bt]?nr=k:nr||(m.opacities[Bt]=nr=xe),h[Bt]=!0;var Or=pt.numIconVertices>0,un=m.placedOrientations[pt.crossTileID],rn=un===x.WritingMode.vertical,Pn=un===x.WritingMode.horizontal||un===x.WritingMode.horizontalOnly;if(kt>0||Qt>0){var ui=jn(nr.text);ze(c.text,kt,rn?ua:ui),ze(c.text,Qt,Pn?ua:ui);var gi=nr.text.isHidden();[pt.rightJustifiedTextSymbolIndex,pt.centerJustifiedTextSymbolIndex,pt.leftJustifiedTextSymbolIndex].forEach(function(Si){Si>=0&&(c.text.placedSymbolArray.get(Si).hidden=gi||rn?1:0)}),pt.verticalPlacedTextSymbolIndex>=0&&(c.text.placedSymbolArray.get(pt.verticalPlacedTextSymbolIndex).hidden=gi||Pn?1:0);var fi=m.variableOffsets[pt.crossTileID];fi&&m.markUsedJustification(c,fi.anchor,pt,un);var _a=m.placedOrientations[pt.crossTileID];_a&&(m.markUsedJustification(c,"left",pt,_a),m.markUsedOrientation(c,_a,pt))}if(Or){var Dn=jn(nr.icon),Ii=!(le&&pt.verticalPlacedIconSymbolIndex&&rn);pt.placedIconSymbolIndex>=0&&(ze(c.icon,pt.numIconVertices,Ii?Dn:ua),c.icon.placedSymbolArray.get(pt.placedIconSymbolIndex).hidden=nr.icon.isHidden()),pt.verticalPlacedIconSymbolIndex>=0&&(ze(c.icon,pt.numVerticalIconVertices,Ii?ua:Dn),c.icon.placedSymbolArray.get(pt.verticalPlacedIconSymbolIndex).hidden=nr.icon.isHidden())}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){var Wi=c.collisionArrays[et];if(Wi){var Bi=new x.Point(0,0);if(Wi.textBox||Wi.verticalTextBox){var wi=!0;if(Y){var Ki=m.variableOffsets[Bt];Ki?(Bi=Ro(Ki.anchor,Ki.width,Ki.height,Ki.textOffset,Ki.textBoxScale),te&&Bi._rotate(ye?m.transform.angle:-m.transform.angle)):wi=!1}Wi.textBox&&yu(c.textCollisionBox.collisionVertexArray,nr.text.placed,!wi||rn,Bi.x,Bi.y),Wi.verticalTextBox&&yu(c.textCollisionBox.collisionVertexArray,nr.text.placed,!wi||Pn,Bi.x,Bi.y)}var Ci=Boolean(!Pn&&Wi.verticalIconBox);Wi.iconBox&&yu(c.iconCollisionBox.collisionVertexArray,nr.icon.placed,Ci,le?Bi.x:0,le?Bi.y:0),Wi.verticalIconBox&&yu(c.iconCollisionBox.collisionVertexArray,nr.icon.placed,!Ci,le?Bi.x:0,le?Bi.y:0)}}},Je=0;Je<c.symbolInstances.length;Je++)Ue(Je);if(c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){var Fe=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=Fe.invProjMatrix,c.placementViewportMatrix=Fe.viewportMatrix,c.collisionCircleArray=Fe.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}},zo.prototype.symbolFadeChange=function(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},zo.prototype.zoomAdjustment=function(c){return Math.max(0,(this.transform.zoom-c)/1.5)},zo.prototype.hasTransitions=function(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration},zo.prototype.stillRecent=function(c,h){var f=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*f>c},zo.prototype.setStale=function(){this.stale=!0};var el=Math.pow(2,25),Wo=Math.pow(2,24),fe=Math.pow(2,17),Me=Math.pow(2,16),ut=Math.pow(2,9),Zt=Math.pow(2,8),sn=Math.pow(2,1);function jn(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;var h=c.placed?1:0,f=Math.floor(127*c.opacity);return f*el+h*Wo+f*fe+h*Me+f*ut+h*Zt+f*sn+h}var ua=0,Jo=function(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&c.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Jo.prototype.continuePlacement=function(c,h,f,m,S){for(var k=this._bucketParts;this._currentTileIndex<c.length;)if(h.getBucketParts(k,m,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,k.sort(function(P,N){return P.sortKey-N.sortKey}));this._currentPartIndex<k.length;)if(h.placeLayerBucketPart(k[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,S())return!0;return!1};var Ta=function(c,h,f,m,S,k,P){this.placement=new zo(c,S,k,P),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=m,this._done=!1};Ta.prototype.isDone=function(){return this._done},Ta.prototype.continuePlacement=function(c,h,f){for(var m=this,S=x.browser.now(),k=function(){var Y=x.browser.now()-S;return!m._forceFullPlacement&&Y>2};this._currentPlacementIndex>=0;){var P=h[c[this._currentPlacementIndex]],N=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=N)&&(!P.maxzoom||P.maxzoom>N)){if(this._inProgressLayer||(this._inProgressLayer=new Jo(P)),this._inProgressLayer.continuePlacement(f[P.source],this.placement,this._showCollisionBoxes,P,k))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Ta.prototype.commit=function(c){return this.placement.commit(c),this.placement};var so=512/x.EXTENT/2,xo=function(c,h,f){this.tileID=c,this.indexedSymbolInstances={},this.bucketInstanceId=f;for(var m=0;m<h.length;m++){var S=h.get(m),k=S.key;this.indexedSymbolInstances[k]||(this.indexedSymbolInstances[k]=[]),this.indexedSymbolInstances[k].push({crossTileID:S.crossTileID,coord:this.getScaledCoordinates(S,c)})}};xo.prototype.getScaledCoordinates=function(c,h){var f=so/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*x.EXTENT+c.anchorX)*f),y:Math.floor((h.canonical.y*x.EXTENT+c.anchorY)*f)}},xo.prototype.findMatches=function(c,h,f){for(var m=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),S=0;S<c.length;S++){var k=c.get(S);if(!k.crossTileID){var P=this.indexedSymbolInstances[k.key];if(P)for(var N=this.getScaledCoordinates(k,h),Y=0,te=P;Y<te.length;Y+=1){var ye=te[Y];if(Math.abs(ye.coord.x-N.x)<=m&&Math.abs(ye.coord.y-N.y)<=m&&!f[ye.crossTileID]){f[ye.crossTileID]=!0,k.crossTileID=ye.crossTileID;break}}}}};var To=function(){this.maxCrossTileID=0};To.prototype.generate=function(){return++this.maxCrossTileID};var Ls=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Ls.prototype.handleWrapJump=function(c){var h=Math.round((c-this.lng)/360);if(h!==0)for(var f in this.indexes){var m=this.indexes[f],S={};for(var k in m){var P=m[k];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+h),S[P.tileID.key]=P}this.indexes[f]=S}this.lng=c},Ls.prototype.addBucket=function(c,h,f){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(var m=0;m<h.symbolInstances.length;m++)h.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});var S=this.usedCrossTileIDs[c.overscaledZ];for(var k in this.indexes){var P=this.indexes[k];if(Number(k)>c.overscaledZ)for(var N in P){var Y=P[N];Y.tileID.isChildOf(c)&&Y.findMatches(h.symbolInstances,c,S)}else{var te=P[c.scaledTo(Number(k)).key];te&&te.findMatches(h.symbolInstances,c,S)}}for(var ye=0;ye<h.symbolInstances.length;ye++){var le=h.symbolInstances.get(ye);le.crossTileID||(le.crossTileID=f.generate(),S[le.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new xo(c,h.symbolInstances,h.bucketInstanceId),!0},Ls.prototype.removeBucketCrossTileIDs=function(c,h){for(var f in h.indexedSymbolInstances)for(var m=0,S=h.indexedSymbolInstances[f];m<S.length;m+=1)delete this.usedCrossTileIDs[c][S[m].crossTileID]},Ls.prototype.removeStaleBuckets=function(c){var h=!1;for(var f in this.indexes){var m=this.indexes[f];for(var S in m)c[m[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,m[S]),delete m[S],h=!0)}return h};var js=function(){this.layerIndexes={},this.crossTileIDs=new To,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};js.prototype.addLayer=function(c,h,f){var m=this.layerIndexes[c.id];m===void 0&&(m=this.layerIndexes[c.id]=new Ls);var S=!1,k={};m.handleWrapJump(f);for(var P=0,N=h;P<N.length;P+=1){var Y=N[P],te=Y.getBucket(c);te&&c.id===te.layerIds[0]&&(te.bucketInstanceId||(te.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(Y.tileID,te,this.crossTileIDs)&&(S=!0),k[te.bucketInstanceId]=!0)}return m.removeStaleBuckets(k)&&(S=!0),S},js.prototype.pruneUnusedLayers=function(c){var h={};for(var f in c.forEach(function(m){h[m]=!0}),this.layerIndexes)h[f]||delete this.layerIndexes[f]};var _u=function(c,h){return x.emitValidationErrors(c,h&&h.filter(function(f){return f.identifier!=="source.canvas"}))},xu=x.pick(cn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Mu=x.pick(cn,["setCenter","setZoom","setBearing","setPitch"]),Uo=function(){var c={},h=x.styleSpec.$version;for(var f in x.styleSpec.$root){var m,S=x.styleSpec.$root[f];S.required&&(m=f==="version"?h:S.type==="array"?[]:{})!=null&&(c[f]=m)}return c}(),Zo=function(c){function h(f,m){var S=this;m===void 0&&(m={}),c.call(this),this.map=f,this.dispatcher=new en(Nt(),this),this.imageManager=new Ir,this.imageManager.setEventedParent(this),this.glyphManager=new _i(f._requestManager,m.localIdeographFontFamily),this.lineAtlas=new st(256,512),this.crossTileSymbolIndex=new js,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new x.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",x.getReferrer());var k=this;this._rtlTextPluginCallback=h.registerForPluginStateChange(function(P){k.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:P.pluginStatus,pluginURL:P.pluginURL},function(N,Y){if(x.triggerPluginCompletionEvent(N),Y&&Y.every(function(ye){return ye}))for(var te in k.sourceCaches)k.sourceCaches[te].reload()})}),this.on("data",function(P){if(P.dataType==="source"&&P.sourceDataType==="metadata"){var N=S.sourceCaches[P.sourceId];if(N){var Y=N.getSource();if(Y&&Y.vectorLayerIds)for(var te in S._layers){var ye=S._layers[te];ye.source===Y.id&&S._validateLayer(ye)}}}})}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.loadURL=function(f,m){var S=this;m===void 0&&(m={}),this.fire(new x.Event("dataloading",{dataType:"style"}));var k=typeof m.validate=="boolean"?m.validate:!x.isMapboxURL(f);f=this.map._requestManager.normalizeStyleURL(f,m.accessToken);var P=this.map._requestManager.transformRequest(f,x.ResourceType.Style);this._request=x.getJSON(P,function(N,Y){S._request=null,N?S.fire(new x.ErrorEvent(N)):Y&&S._load(Y,k)})},h.prototype.loadJSON=function(f,m){var S=this;m===void 0&&(m={}),this.fire(new x.Event("dataloading",{dataType:"style"})),this._request=x.browser.frame(function(){S._request=null,S._load(f,m.validate!==!1)})},h.prototype.loadEmpty=function(){this.fire(new x.Event("dataloading",{dataType:"style"})),this._load(Uo,!1)},h.prototype._load=function(f,m){if(!m||!_u(this,x.validateStyle(f))){for(var S in this._loaded=!0,this.stylesheet=f,f.sources)this.addSource(S,f.sources[S],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs);var k=on(this.stylesheet.layers);this._order=k.map(function(te){return te.id}),this._layers={},this._serializedLayers={};for(var P=0,N=k;P<N.length;P+=1){var Y=N[P];(Y=x.createStyleLayer(Y)).setEventedParent(this,{layer:{id:Y.id}}),this._layers[Y.id]=Y,this._serializedLayers[Y.id]=Y.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new zr(this.stylesheet.light),this.fire(new x.Event("data",{dataType:"style"})),this.fire(new x.Event("style.load"))}},h.prototype._loadSprite=function(f){var m=this;this._spriteRequest=function(S,k,P){var N,Y,te,ye=x.browser.devicePixelRatio>1?"@2x":"",le=x.getJSON(k.transformRequest(k.normalizeSpriteURL(S,ye,".json"),x.ResourceType.SpriteJSON),function(Ue,Je){le=null,te||(te=Ue,N=Je,ze())}),xe=x.getImage(k.transformRequest(k.normalizeSpriteURL(S,ye,".png"),x.ResourceType.SpriteImage),function(Ue,Je){xe=null,te||(te=Ue,Y=Je,ze())});function ze(){if(te)P(te);else if(N&&Y){var Ue=x.browser.getImageData(Y),Je={};for(var Fe in N){var et=N[Fe],pt=et.width,kt=et.height,Qt=et.x,Bt=et.y,nr=et.sdf,Or=et.pixelRatio,un=et.stretchX,rn=et.stretchY,Pn=et.content,ui=new x.RGBAImage({width:pt,height:kt});x.RGBAImage.copy(Ue,ui,{x:Qt,y:Bt},{x:0,y:0},{width:pt,height:kt}),Je[Fe]={data:ui,pixelRatio:Or,sdf:nr,stretchX:un,stretchY:rn,content:Pn}}P(null,Je)}}return{cancel:function(){le&&(le.cancel(),le=null),xe&&(xe.cancel(),xe=null)}}}(f,this.map._requestManager,function(S,k){if(m._spriteRequest=null,S)m.fire(new x.ErrorEvent(S));else if(k)for(var P in k)m.imageManager.addImage(P,k[P]);m.imageManager.setLoaded(!0),m._availableImages=m.imageManager.listImages(),m.dispatcher.broadcast("setImages",m._availableImages),m.fire(new x.Event("data",{dataType:"style"}))})},h.prototype._validateLayer=function(f){var m=this.sourceCaches[f.source];if(m){var S=f.sourceLayer;if(S){var k=m.getSource();(k.type==="geojson"||k.vectorLayerIds&&k.vectorLayerIds.indexOf(S)===-1)&&this.fire(new x.ErrorEvent(new Error('Source layer "'+S+'" does not exist on source "'+k.id+'" as specified by style layer "'+f.id+'"')))}}},h.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var f in this.sourceCaches)if(!this.sourceCaches[f].loaded())return!1;return!!this.imageManager.isLoaded()},h.prototype._serializeLayers=function(f){for(var m=[],S=0,k=f;S<k.length;S+=1){var P=this._layers[k[S]];P.type!=="custom"&&m.push(P.serialize())}return m},h.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var f in this.sourceCaches)if(this.sourceCaches[f].hasTransition())return!0;for(var m in this._layers)if(this._layers[m].hasTransition())return!0;return!1},h.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},h.prototype.update=function(f){if(this._loaded){var m=this._changed;if(this._changed){var S=Object.keys(this._updatedLayers),k=Object.keys(this._removedLayers);for(var P in(S.length||k.length)&&this._updateWorkerLayers(S,k),this._updatedSources){var N=this._updatedSources[P];N==="reload"?this._reloadSource(P):N==="clear"&&this._clearSource(P)}for(var Y in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[Y].updateTransitions(f);this.light.updateTransitions(f),this._resetUpdates()}var te={};for(var ye in this.sourceCaches){var le=this.sourceCaches[ye];te[ye]=le.used,le.used=!1}for(var xe=0,ze=this._order;xe<ze.length;xe+=1){var Ue=this._layers[ze[xe]];Ue.recalculate(f,this._availableImages),!Ue.isHidden(f.zoom)&&Ue.source&&(this.sourceCaches[Ue.source].used=!0)}for(var Je in te){var Fe=this.sourceCaches[Je];te[Je]!==Fe.used&&Fe.fire(new x.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Je}))}this.light.recalculate(f),this.z=f.zoom,m&&this.fire(new x.Event("data",{dataType:"style"}))}},h.prototype._updateTilesForChangedImages=function(){var f=Object.keys(this._changedImages);if(f.length){for(var m in this.sourceCaches)this.sourceCaches[m].reloadTilesForDependencies(["icons","patterns"],f);this._changedImages={}}},h.prototype._updateWorkerLayers=function(f,m){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(f),removedIds:m})},h.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},h.prototype.setState=function(f){var m=this;if(this._checkLoaded(),_u(this,x.validateStyle(f)))return!1;(f=x.clone$1(f)).layers=on(f.layers);var S=function(P,N){if(!P)return[{command:cn.setStyle,args:[N]}];var Y=[];try{if(!x.deepEqual(P.version,N.version))return[{command:cn.setStyle,args:[N]}];x.deepEqual(P.center,N.center)||Y.push({command:cn.setCenter,args:[N.center]}),x.deepEqual(P.zoom,N.zoom)||Y.push({command:cn.setZoom,args:[N.zoom]}),x.deepEqual(P.bearing,N.bearing)||Y.push({command:cn.setBearing,args:[N.bearing]}),x.deepEqual(P.pitch,N.pitch)||Y.push({command:cn.setPitch,args:[N.pitch]}),x.deepEqual(P.sprite,N.sprite)||Y.push({command:cn.setSprite,args:[N.sprite]}),x.deepEqual(P.glyphs,N.glyphs)||Y.push({command:cn.setGlyphs,args:[N.glyphs]}),x.deepEqual(P.transition,N.transition)||Y.push({command:cn.setTransition,args:[N.transition]}),x.deepEqual(P.light,N.light)||Y.push({command:cn.setLight,args:[N.light]});var te={},ye=[];(function(xe,ze,Ue,Je){var Fe;for(Fe in ze=ze||{},xe=xe||{})xe.hasOwnProperty(Fe)&&(ze.hasOwnProperty(Fe)||Cn(Fe,Ue,Je));for(Fe in ze)ze.hasOwnProperty(Fe)&&(xe.hasOwnProperty(Fe)?x.deepEqual(xe[Fe],ze[Fe])||(xe[Fe].type==="geojson"&&ze[Fe].type==="geojson"&&St(xe,ze,Fe)?Ue.push({command:cn.setGeoJSONSourceData,args:[Fe,ze[Fe].data]}):xt(Fe,ze,Ue,Je)):$i(Fe,ze,Ue))})(P.sources,N.sources,ye,te);var le=[];P.layers&&P.layers.forEach(function(xe){te[xe.source]?Y.push({command:cn.removeLayer,args:[xe.id]}):le.push(xe)}),Y=Y.concat(ye),function(xe,ze,Ue){ze=ze||[];var Je,Fe,et,pt,kt,Qt,Bt,nr=(xe=xe||[]).map(na),Or=ze.map(na),un=xe.reduce(ea,{}),rn=ze.reduce(ea,{}),Pn=nr.slice(),ui=Object.create(null);for(Je=0,Fe=0;Je<nr.length;Je++)rn.hasOwnProperty(et=nr[Je])?Fe++:(Ue.push({command:cn.removeLayer,args:[et]}),Pn.splice(Pn.indexOf(et,Fe),1));for(Je=0,Fe=0;Je<Or.length;Je++)Pn[Pn.length-1-Je]!==(et=Or[Or.length-1-Je])&&(un.hasOwnProperty(et)?(Ue.push({command:cn.removeLayer,args:[et]}),Pn.splice(Pn.lastIndexOf(et,Pn.length-Fe),1)):Fe++,Ue.push({command:cn.addLayer,args:[rn[et],Qt=Pn[Pn.length-Je]]}),Pn.splice(Pn.length-Je,0,et),ui[et]=!0);for(Je=0;Je<Or.length;Je++)if(pt=un[et=Or[Je]],kt=rn[et],!ui[et]&&!x.deepEqual(pt,kt))if(x.deepEqual(pt.source,kt.source)&&x.deepEqual(pt["source-layer"],kt["source-layer"])&&x.deepEqual(pt.type,kt.type)){for(Bt in qi(pt.layout,kt.layout,Ue,et,null,cn.setLayoutProperty),qi(pt.paint,kt.paint,Ue,et,null,cn.setPaintProperty),x.deepEqual(pt.filter,kt.filter)||Ue.push({command:cn.setFilter,args:[et,kt.filter]}),x.deepEqual(pt.minzoom,kt.minzoom)&&x.deepEqual(pt.maxzoom,kt.maxzoom)||Ue.push({command:cn.setLayerZoomRange,args:[et,kt.minzoom,kt.maxzoom]}),pt)pt.hasOwnProperty(Bt)&&Bt!=="layout"&&Bt!=="paint"&&Bt!=="filter"&&Bt!=="metadata"&&Bt!=="minzoom"&&Bt!=="maxzoom"&&(Bt.indexOf("paint.")===0?qi(pt[Bt],kt[Bt],Ue,et,Bt.slice(6),cn.setPaintProperty):x.deepEqual(pt[Bt],kt[Bt])||Ue.push({command:cn.setLayerProperty,args:[et,Bt,kt[Bt]]}));for(Bt in kt)kt.hasOwnProperty(Bt)&&!pt.hasOwnProperty(Bt)&&Bt!=="layout"&&Bt!=="paint"&&Bt!=="filter"&&Bt!=="metadata"&&Bt!=="minzoom"&&Bt!=="maxzoom"&&(Bt.indexOf("paint.")===0?qi(pt[Bt],kt[Bt],Ue,et,Bt.slice(6),cn.setPaintProperty):x.deepEqual(pt[Bt],kt[Bt])||Ue.push({command:cn.setLayerProperty,args:[et,Bt,kt[Bt]]}))}else Ue.push({command:cn.removeLayer,args:[et]}),Qt=Pn[Pn.lastIndexOf(et)+1],Ue.push({command:cn.addLayer,args:[kt,Qt]})}(le,N.layers,Y)}catch(xe){console.warn("Unable to compute style diff:",xe),Y=[{command:cn.setStyle,args:[N]}]}return Y}(this.serialize(),f).filter(function(P){return!(P.command in Mu)});if(S.length===0)return!1;var k=S.filter(function(P){return!(P.command in xu)});if(k.length>0)throw new Error("Unimplemented: "+k.map(function(P){return P.command}).join(", ")+".");return S.forEach(function(P){P.command!=="setTransition"&&m[P.command].apply(m,P.args)}),this.stylesheet=f,!0},h.prototype.addImage=function(f,m){if(this.getImage(f))return this.fire(new x.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(f,m),this._afterImageUpdated(f)},h.prototype.updateImage=function(f,m){this.imageManager.updateImage(f,m)},h.prototype.getImage=function(f){return this.imageManager.getImage(f)},h.prototype.removeImage=function(f){if(!this.getImage(f))return this.fire(new x.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(f),this._afterImageUpdated(f)},h.prototype._afterImageUpdated=function(f){this._availableImages=this.imageManager.listImages(),this._changedImages[f]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new x.Event("data",{dataType:"style"}))},h.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},h.prototype.addSource=function(f,m,S){var k=this;if(S===void 0&&(S={}),this._checkLoaded(),this.sourceCaches[f]!==void 0)throw new Error("There is already a source with this ID");if(!m.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(m).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(m.type)>=0&&this._validate(x.validateStyle.source,"sources."+f,m,null,S))){this.map&&this.map._collectResourceTiming&&(m.collectResourceTiming=!0);var P=this.sourceCaches[f]=new je(f,m,this.dispatcher);P.style=this,P.setEventedParent(this,function(){return{isSourceLoaded:k.loaded(),source:P.serialize(),sourceId:f}}),P.onAdd(this.map),this._changed=!0}},h.prototype.removeSource=function(f){if(this._checkLoaded(),this.sourceCaches[f]===void 0)throw new Error("There is no source with this ID");for(var m in this._layers)if(this._layers[m].source===f)return this.fire(new x.ErrorEvent(new Error('Source "'+f+'" cannot be removed while layer "'+m+'" is using it.')));var S=this.sourceCaches[f];delete this.sourceCaches[f],delete this._updatedSources[f],S.fire(new x.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:f})),S.setEventedParent(null),S.clearTiles(),S.onRemove&&S.onRemove(this.map),this._changed=!0},h.prototype.setGeoJSONSourceData=function(f,m){this._checkLoaded(),this.sourceCaches[f].getSource().setData(m),this._changed=!0},h.prototype.getSource=function(f){return this.sourceCaches[f]&&this.sourceCaches[f].getSource()},h.prototype.addLayer=function(f,m,S){S===void 0&&(S={}),this._checkLoaded();var k=f.id;if(this.getLayer(k))this.fire(new x.ErrorEvent(new Error('Layer with id "'+k+'" already exists on this map')));else{var P;if(f.type==="custom"){if(_u(this,x.validateCustomStyleLayer(f)))return;P=x.createStyleLayer(f)}else{if(typeof f.source=="object"&&(this.addSource(k,f.source),f=x.clone$1(f),f=x.extend(f,{source:k})),this._validate(x.validateStyle.layer,"layers."+k,f,{arrayIndex:-1},S))return;P=x.createStyleLayer(f),this._validateLayer(P),P.setEventedParent(this,{layer:{id:k}}),this._serializedLayers[P.id]=P.serialize()}var N=m?this._order.indexOf(m):this._order.length;if(m&&N===-1)this.fire(new x.ErrorEvent(new Error('Layer with id "'+m+'" does not exist on this map.')));else{if(this._order.splice(N,0,k),this._layerOrderChanged=!0,this._layers[k]=P,this._removedLayers[k]&&P.source&&P.type!=="custom"){var Y=this._removedLayers[k];delete this._removedLayers[k],Y.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}},h.prototype.moveLayer=function(f,m){if(this._checkLoaded(),this._changed=!0,this._layers[f]){if(f!==m){var S=this._order.indexOf(f);this._order.splice(S,1);var k=m?this._order.indexOf(m):this._order.length;m&&k===-1?this.fire(new x.ErrorEvent(new Error('Layer with id "'+m+'" does not exist on this map.'))):(this._order.splice(k,0,f),this._layerOrderChanged=!0)}}else this.fire(new x.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be moved.")))},h.prototype.removeLayer=function(f){this._checkLoaded();var m=this._layers[f];if(m){m.setEventedParent(null);var S=this._order.indexOf(f);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[f]=m,delete this._layers[f],delete this._serializedLayers[f],delete this._updatedLayers[f],delete this._updatedPaintProps[f],m.onRemove&&m.onRemove(this.map)}else this.fire(new x.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be removed.")))},h.prototype.getLayer=function(f){return this._layers[f]},h.prototype.hasLayer=function(f){return f in this._layers},h.prototype.setLayerZoomRange=function(f,m,S){this._checkLoaded();var k=this.getLayer(f);k?k.minzoom===m&&k.maxzoom===S||(m!=null&&(k.minzoom=m),S!=null&&(k.maxzoom=S),this._updateLayer(k)):this.fire(new x.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot have zoom extent.")))},h.prototype.setFilter=function(f,m,S){S===void 0&&(S={}),this._checkLoaded();var k=this.getLayer(f);if(k){if(!x.deepEqual(k.filter,m))return m==null?(k.filter=void 0,void this._updateLayer(k)):void(this._validate(x.validateStyle.filter,"layers."+k.id+".filter",m,null,S)||(k.filter=x.clone$1(m),this._updateLayer(k)))}else this.fire(new x.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be filtered.")))},h.prototype.getFilter=function(f){return x.clone$1(this.getLayer(f).filter)},h.prototype.setLayoutProperty=function(f,m,S,k){k===void 0&&(k={}),this._checkLoaded();var P=this.getLayer(f);P?x.deepEqual(P.getLayoutProperty(m),S)||(P.setLayoutProperty(m,S,k),this._updateLayer(P)):this.fire(new x.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getLayoutProperty=function(f,m){var S=this.getLayer(f);if(S)return S.getLayoutProperty(m);this.fire(new x.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style.")))},h.prototype.setPaintProperty=function(f,m,S,k){k===void 0&&(k={}),this._checkLoaded();var P=this.getLayer(f);P?x.deepEqual(P.getPaintProperty(m),S)||(P.setPaintProperty(m,S,k)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[f]=!0):this.fire(new x.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getPaintProperty=function(f,m){return this.getLayer(f).getPaintProperty(m)},h.prototype.setFeatureState=function(f,m){this._checkLoaded();var S=f.source,k=f.sourceLayer,P=this.sourceCaches[S];if(P!==void 0){var N=P.getSource().type;N==="geojson"&&k?this.fire(new x.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):N!=="vector"||k?(f.id===void 0&&this.fire(new x.ErrorEvent(new Error("The feature id parameter must be provided."))),P.setFeatureState(k,f.id,m)):this.fire(new x.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new x.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},h.prototype.removeFeatureState=function(f,m){this._checkLoaded();var S=f.source,k=this.sourceCaches[S];if(k!==void 0){var P=k.getSource().type,N=P==="vector"?f.sourceLayer:void 0;P!=="vector"||N?m&&typeof f.id!="string"&&typeof f.id!="number"?this.fire(new x.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):k.removeFeatureState(N,f.id,m):this.fire(new x.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new x.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},h.prototype.getFeatureState=function(f){this._checkLoaded();var m=f.source,S=f.sourceLayer,k=this.sourceCaches[m];if(k!==void 0){if(k.getSource().type!=="vector"||S)return f.id===void 0&&this.fire(new x.ErrorEvent(new Error("The feature id parameter must be provided."))),k.getFeatureState(S,f.id);this.fire(new x.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new x.ErrorEvent(new Error("The source '"+m+"' does not exist in the map's style.")))},h.prototype.getTransition=function(){return x.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},h.prototype.serialize=function(){return x.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:x.mapObject(this.sourceCaches,function(f){return f.serialize()}),layers:this._serializeLayers(this._order)},function(f){return f!==void 0})},h.prototype._updateLayer=function(f){this._updatedLayers[f.id]=!0,f.source&&!this._updatedSources[f.source]&&this.sourceCaches[f.source].getSource().type!=="raster"&&(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause()),this._changed=!0},h.prototype._flattenAndSortRenderedFeatures=function(f){for(var m=this,S=function(un){return m._layers[un].type==="fill-extrusion"},k={},P=[],N=this._order.length-1;N>=0;N--){var Y=this._order[N];if(S(Y)){k[Y]=N;for(var te=0,ye=f;te<ye.length;te+=1){var le=ye[te][Y];if(le)for(var xe=0,ze=le;xe<ze.length;xe+=1)P.push(ze[xe])}}}P.sort(function(un,rn){return rn.intersectionZ-un.intersectionZ});for(var Ue=[],Je=this._order.length-1;Je>=0;Je--){var Fe=this._order[Je];if(S(Fe))for(var et=P.length-1;et>=0;et--){var pt=P[et].feature;if(k[pt.layer.id]<Je)break;Ue.push(pt),P.pop()}else for(var kt=0,Qt=f;kt<Qt.length;kt+=1){var Bt=Qt[kt][Fe];if(Bt)for(var nr=0,Or=Bt;nr<Or.length;nr+=1)Ue.push(Or[nr].feature)}}return Ue},h.prototype.queryRenderedFeatures=function(f,m,S){m&&m.filter&&this._validate(x.validateStyle.filter,"queryRenderedFeatures.filter",m.filter,null,m);var k={};if(m&&m.layers){if(!Array.isArray(m.layers))return this.fire(new x.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var P=0,N=m.layers;P<N.length;P+=1){var Y=N[P],te=this._layers[Y];if(!te)return this.fire(new x.ErrorEvent(new Error("The layer '"+Y+"' does not exist in the map's style and cannot be queried for features."))),[];k[te.source]=!0}}var ye=[];for(var le in m.availableImages=this._availableImages,this.sourceCaches)m.layers&&!k[le]||ye.push(Vn(this.sourceCaches[le],this._layers,this._serializedLayers,f,m,S));return this.placement&&ye.push(function(xe,ze,Ue,Je,Fe,et,pt){for(var kt={},Qt=et.queryRenderedSymbols(Je),Bt=[],nr=0,Or=Object.keys(Qt).map(Number);nr<Or.length;nr+=1)Bt.push(pt[Or[nr]]);Bt.sort(Gi);for(var un=function(){var fi=Pn[rn],_a=fi.featureIndex.lookupSymbolFeatures(Qt[fi.bucketInstanceId],ze,fi.bucketIndex,fi.sourceLayerIndex,Fe.filter,Fe.layers,Fe.availableImages,xe);for(var Dn in _a){var Ii=kt[Dn]=kt[Dn]||[],Wi=_a[Dn];Wi.sort(function(Ki,Ci){var Si=fi.featureSortOrder;if(Si){var gs=Si.indexOf(Ki.featureIndex);return Si.indexOf(Ci.featureIndex)-gs}return Ci.featureIndex-Ki.featureIndex});for(var Bi=0,wi=Wi;Bi<wi.length;Bi+=1)Ii.push(wi[Bi])}},rn=0,Pn=Bt;rn<Pn.length;rn+=1)un();var ui=function(fi){kt[fi].forEach(function(_a){var Dn=_a.feature,Ii=Ue[xe[fi].source].getFeatureState(Dn.layer["source-layer"],Dn.id);Dn.source=Dn.layer.source,Dn.layer["source-layer"]&&(Dn.sourceLayer=Dn.layer["source-layer"]),Dn.state=Ii})};for(var gi in kt)ui(gi);return kt}(this._layers,this._serializedLayers,this.sourceCaches,f,m,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ye)},h.prototype.querySourceFeatures=function(f,m){m&&m.filter&&this._validate(x.validateStyle.filter,"querySourceFeatures.filter",m.filter,null,m);var S=this.sourceCaches[f];return S?function(k,P){for(var N=k.getRenderableIds().map(function(ze){return k.getTileByID(ze)}),Y=[],te={},ye=0;ye<N.length;ye++){var le=N[ye],xe=le.tileID.canonical.key;te[xe]||(te[xe]=!0,le.querySourceFeatures(Y,P))}return Y}(S,m):[]},h.prototype.addSourceType=function(f,m,S){return h.getSourceType(f)?S(new Error('A source type called "'+f+'" already exists.')):(h.setSourceType(f,m),m.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:f,url:m.workerSourceURL},S):S(null,null))},h.prototype.getLight=function(){return this.light.getLight()},h.prototype.setLight=function(f,m){m===void 0&&(m={}),this._checkLoaded();var S=this.light.getLight(),k=!1;for(var P in f)if(!x.deepEqual(f[P],S[P])){k=!0;break}if(k){var N={now:x.browser.now(),transition:x.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(f,m),this.light.updateTransitions(N)}},h.prototype._validate=function(f,m,S,k,P){return P===void 0&&(P={}),(!P||P.validate!==!1)&&_u(this,f.call(x.validateStyle,x.extend({key:m,style:this.serialize(),value:S,styleSpec:x.styleSpec},k)))},h.prototype._remove=function(){for(var f in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),x.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[f].setEventedParent(null);for(var m in this.sourceCaches)this.sourceCaches[m].clearTiles(),this.sourceCaches[m].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},h.prototype._clearSource=function(f){this.sourceCaches[f].clearTiles()},h.prototype._reloadSource=function(f){this.sourceCaches[f].resume(),this.sourceCaches[f].reload()},h.prototype._updateSources=function(f){for(var m in this.sourceCaches)this.sourceCaches[m].update(f)},h.prototype._generateCollisionBoxes=function(){for(var f in this.sourceCaches)this._reloadSource(f)},h.prototype._updatePlacement=function(f,m,S,k,P){P===void 0&&(P=!1);for(var N=!1,Y=!1,te={},ye=0,le=this._order;ye<le.length;ye+=1){var xe=this._layers[le[ye]];if(xe.type==="symbol"){if(!te[xe.source]){var ze=this.sourceCaches[xe.source];te[xe.source]=ze.getRenderableIds(!0).map(function(pt){return ze.getTileByID(pt)}).sort(function(pt,kt){return kt.tileID.overscaledZ-pt.tileID.overscaledZ||(pt.tileID.isLessThan(kt.tileID)?-1:1)})}var Ue=this.crossTileSymbolIndex.addLayer(xe,te[xe.source],f.center.lng);N=N||Ue}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(x.browser.now(),f.zoom))&&(this.pauseablePlacement=new Ta(f,this._order,P,m,S,k,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,te),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(x.browser.now()),Y=!0),N&&this.pauseablePlacement.placement.setStale()),Y||N)for(var Je=0,Fe=this._order;Je<Fe.length;Je+=1){var et=this._layers[Fe[Je]];et.type==="symbol"&&this.placement.updateLayerOpacities(et,te[et.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(x.browser.now())},h.prototype._releaseSymbolFadeTiles=function(){for(var f in this.sourceCaches)this.sourceCaches[f].releaseSymbolFadeTiles()},h.prototype.getImages=function(f,m,S){this.imageManager.getImages(m.icons,S),this._updateTilesForChangedImages();var k=this.sourceCaches[m.source];k&&k.setDependencies(m.tileID.key,m.type,m.icons)},h.prototype.getGlyphs=function(f,m,S){this.glyphManager.getGlyphs(m.stacks,S)},h.prototype.getResource=function(f,m,S){return x.makeRequest(m,S)},h}(x.Evented);Zo.getSourceType=function(c){return cr[c]},Zo.setSourceType=function(c,h){cr[c]=h},Zo.registerForPluginStateChange=x.registerForPluginStateChange;var Fa=x.createLayout([{name:"a_pos",type:"Int16",components:2}]),As=ga(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Hu=ga(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Zh=ga(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Cc=ga(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Xf=ga("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),yl=ga(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Hc=ga(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),_l=ga("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),gf=ga("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),b=ga("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),I=ga(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),G=ga(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),D=ga(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),re=ga(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Te=ga(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),it=ga(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),ht=ga(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Tt=ga(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),_r=ga(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),br=ga(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),si=ga(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Ni=ga(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Di=ga(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),ia=ga(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Ga=ga(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),uo=ga(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function ga(c,h){var f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=h.match(/attribute ([\w]+) ([\w]+)/g),S=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),k=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=k?k.concat(S):S,N={};return{fragmentSource:c=c.replace(f,function(Y,te,ye,le,xe){return N[xe]=!0,te==="define"?`
#ifndef HAS_UNIFORM_u_`+xe+`
varying `+ye+" "+le+" "+xe+`;
#else
uniform `+ye+" "+le+" u_"+xe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+xe+`
    `+ye+" "+le+" "+xe+" = u_"+xe+`;
#endif
`}),vertexSource:h=h.replace(f,function(Y,te,ye,le,xe){var ze=le==="float"?"vec2":"vec4",Ue=xe.match(/color/)?"color":ze;return N[xe]?te==="define"?`
#ifndef HAS_UNIFORM_u_`+xe+`
uniform lowp float u_`+xe+`_t;
attribute `+ye+" "+ze+" a_"+xe+`;
varying `+ye+" "+le+" "+xe+`;
#else
uniform `+ye+" "+le+" u_"+xe+`;
#endif
`:Ue==="vec4"?`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+xe+" = a_"+xe+`;
#else
    `+ye+" "+le+" "+xe+" = u_"+xe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+xe+" = unpack_mix_"+Ue+"(a_"+xe+", u_"+xe+`_t);
#else
    `+ye+" "+le+" "+xe+" = u_"+xe+`;
#endif
`:te==="define"?`
#ifndef HAS_UNIFORM_u_`+xe+`
uniform lowp float u_`+xe+`_t;
attribute `+ye+" "+ze+" a_"+xe+`;
#else
uniform `+ye+" "+le+" u_"+xe+`;
#endif
`:Ue==="vec4"?`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+ye+" "+le+" "+xe+" = a_"+xe+`;
#else
    `+ye+" "+le+" "+xe+" = u_"+xe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+ye+" "+le+" "+xe+" = unpack_mix_"+Ue+"(a_"+xe+", u_"+xe+`_t);
#else
    `+ye+" "+le+" "+xe+" = u_"+xe+`;
#endif
`}),staticAttributes:m,staticUniforms:P}}var Ks=Object.freeze({__proto__:null,prelude:As,background:Hu,backgroundPattern:Zh,circle:Cc,clippingMask:Xf,heatmap:yl,heatmapTexture:Hc,collisionBox:_l,collisionCircle:gf,debug:b,fill:I,fillOutline:G,fillOutlinePattern:D,fillPattern:re,fillExtrusion:Te,fillExtrusionPattern:it,hillshadePrepare:ht,hillshade:Tt,line:_r,lineGradient:br,linePattern:si,lineSDF:Ni,raster:Di,symbolIcon:ia,symbolSDF:Ga,symbolTextAndIcon:uo}),Zl=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Wc(c){for(var h=[],f=0;f<c.length;f++)if(c[f]!==null){var m=c[f].split(" ");h.push(m.pop())}return h}Zl.prototype.bind=function(c,h,f,m,S,k,P,N){this.context=c;for(var Y=this.boundPaintVertexBuffers.length!==m.length,te=0;!Y&&te<m.length;te++)this.boundPaintVertexBuffers[te]!==m[te]&&(Y=!0);c.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===f&&!Y&&this.boundIndexBuffer===S&&this.boundVertexOffset===k&&this.boundDynamicVertexBuffer===P&&this.boundDynamicVertexBuffer2===N?(c.bindVertexArrayOES.set(this.vao),P&&P.bind(),S&&S.dynamicDraw&&S.bind(),N&&N.bind()):this.freshBind(h,f,m,S,k,P,N)},Zl.prototype.freshBind=function(c,h,f,m,S,k,P){var N,Y=c.numAttributes,te=this.context,ye=te.gl;if(te.extVertexArrayObject)this.vao&&this.destroy(),this.vao=te.extVertexArrayObject.createVertexArrayOES(),te.bindVertexArrayOES.set(this.vao),N=0,this.boundProgram=c,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=m,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=k,this.boundDynamicVertexBuffer2=P;else{N=te.currentNumAttributes||0;for(var le=Y;le<N;le++)ye.disableVertexAttribArray(le)}h.enableAttributes(ye,c);for(var xe=0,ze=f;xe<ze.length;xe+=1)ze[xe].enableAttributes(ye,c);k&&k.enableAttributes(ye,c),P&&P.enableAttributes(ye,c),h.bind(),h.setVertexAttribPointers(ye,c,S);for(var Ue=0,Je=f;Ue<Je.length;Ue+=1){var Fe=Je[Ue];Fe.bind(),Fe.setVertexAttribPointers(ye,c,S)}k&&(k.bind(),k.setVertexAttribPointers(ye,c,S)),m&&m.bind(),P&&(P.bind(),P.setVertexAttribPointers(ye,c,S)),te.currentNumAttributes=Y},Zl.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Xc=function(c,h,f,m,S,k){var P=c.gl;this.program=P.createProgram();for(var N=Wc(f.staticAttributes),Y=m?m.getBinderAttributes():[],te=N.concat(Y),ye=f.staticUniforms?Wc(f.staticUniforms):[],le=m?m.getBinderUniforms():[],xe=[],ze=0,Ue=ye.concat(le);ze<Ue.length;ze+=1){var Je=Ue[ze];xe.indexOf(Je)<0&&xe.push(Je)}var Fe=m?m.defines():[];k&&Fe.push("#define OVERDRAW_INSPECTOR;");var et=Fe.concat(As.fragmentSource,f.fragmentSource).join(`
`),pt=Fe.concat(As.vertexSource,f.vertexSource).join(`
`),kt=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(kt,et),P.compileShader(kt),P.attachShader(this.program,kt);var Qt=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(Qt,pt),P.compileShader(Qt),P.attachShader(this.program,Qt),this.attributes={};var Bt={};this.numAttributes=te.length;for(var nr=0;nr<this.numAttributes;nr++)te[nr]&&(P.bindAttribLocation(this.program,nr,te[nr]),this.attributes[te[nr]]=nr);P.linkProgram(this.program),P.deleteShader(Qt),P.deleteShader(kt);for(var Or=0;Or<xe.length;Or++){var un=xe[Or];if(un&&!Bt[un]){var rn=P.getUniformLocation(this.program,un);rn&&(Bt[un]=rn)}}this.fixedUniforms=S(c,Bt),this.binderUniforms=m?m.getUniforms(c,Bt):[]}}};function Sc(c,h,f){var m=1/pa(f,1,h.transform.tileZoom),S=Math.pow(2,f.tileID.overscaledZ),k=f.tileSize*Math.pow(2,h.transform.tileZoom)/S,P=k*(f.tileID.canonical.x+f.tileID.wrap*S),N=k*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[m,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[P>>16,N>>16],u_pixel_coord_lower:[65535&P,65535&N]}}Xc.prototype.draw=function(c,h,f,m,S,k,P,N,Y,te,ye,le,xe,ze,Ue,Je){var Fe,et=c.gl;if(!this.failedToCreate){for(var pt in c.program.set(this.program),c.setDepthMode(f),c.setStencilMode(m),c.setColorMode(S),c.setCullFace(k),this.fixedUniforms)this.fixedUniforms[pt].set(P[pt]);ze&&ze.setUniforms(c,this.binderUniforms,le,{zoom:xe});for(var kt=(Fe={},Fe[et.LINES]=2,Fe[et.TRIANGLES]=3,Fe[et.LINE_STRIP]=1,Fe)[h],Qt=0,Bt=ye.get();Qt<Bt.length;Qt+=1){var nr=Bt[Qt],Or=nr.vaos||(nr.vaos={});(Or[N]||(Or[N]=new Zl)).bind(c,this,Y,ze?ze.getPaintVertexBuffers():[],te,nr.vertexOffset,Ue,Je),et.drawElements(h,nr.primitiveLength*kt,et.UNSIGNED_SHORT,nr.primitiveOffset*kt*2)}}};var wc=function(c,h,f,m){var S=h.style.light,k=S.properties.get("position"),P=[k.x,k.y,k.z],N=x.create$1();S.properties.get("anchor")==="viewport"&&x.fromRotation(N,-h.transform.angle),x.transformMat3(P,P,N);var Y=S.properties.get("color");return{u_matrix:c,u_lightpos:P,u_lightintensity:S.properties.get("intensity"),u_lightcolor:[Y.r,Y.g,Y.b],u_vertical_gradient:+f,u_opacity:m}},ku=function(c,h,f,m,S,k,P){return x.extend(wc(c,h,f,m),Sc(k,h,P),{u_height_factor:-Math.pow(2,S.overscaledZ)/P.tileSize/8})},Vl=function(c){return{u_matrix:c}},xl=function(c,h,f,m){return x.extend(Vl(c),Sc(f,h,m))},Oo=function(c,h){return{u_matrix:c,u_world:h}},Vh=function(c,h,f,m,S){return x.extend(xl(c,h,f,m),{u_world:S})},jh=function(c,h,f,m){var S,k,P=c.transform;if(m.paint.get("circle-pitch-alignment")==="map"){var N=pa(f,1,P.zoom);S=!0,k=[N,N]}else S=!1,k=P.pixelsToGLUnits;return{u_camera_to_center_distance:P.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_matrix:c.translatePosMatrix(h.posMatrix,f,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:x.browser.devicePixelRatio,u_extrude_scale:k}},Iu=function(c,h,f){var m=pa(f,1,h.zoom),S=Math.pow(2,h.zoom-f.tileID.overscaledZ),k=f.tileID.overscaleFactor();return{u_matrix:c,u_camera_to_center_distance:h.cameraToCenterDistance,u_pixels_to_tile_units:m,u_extrude_scale:[h.pixelsToGLUnits[0]/(m*S),h.pixelsToGLUnits[1]/(m*S)],u_overscale_factor:k}},fh=function(c,h,f){return{u_matrix:c,u_inv_matrix:h,u_camera_to_center_distance:f.cameraToCenterDistance,u_viewport_size:[f.width,f.height]}},ac=function(c,h,f){return f===void 0&&(f=1),{u_matrix:c,u_color:h,u_overlay:0,u_overlay_scale:f}},Rs=function(c){return{u_matrix:c}},hh=function(c,h,f,m){return{u_matrix:c,u_extrude_scale:pa(h,1,f),u_intensity:m}},bl=function(c,h,f){var m=c.transform;return{u_matrix:od(c,h,f),u_ratio:1/pa(h,1,m.zoom),u_device_pixel_ratio:x.browser.devicePixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},no=function(c,h,f,m){return x.extend(bl(c,h,f),{u_image:0,u_image_height:m})},Pu=function(c,h,f,m){var S=c.transform,k=El(h,S);return{u_matrix:od(c,h,f),u_texsize:h.imageAtlasTexture.size,u_ratio:1/pa(h,1,S.zoom),u_device_pixel_ratio:x.browser.devicePixelRatio,u_image:0,u_scale:[k,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},Yf=function(c,h,f,m,S){var k=c.lineAtlas,P=El(h,c.transform),N=f.layout.get("line-cap")==="round",Y=k.getDash(m.from,N),te=k.getDash(m.to,N),ye=Y.width*S.fromScale,le=te.width*S.toScale;return x.extend(bl(c,h,f),{u_patternscale_a:[P/ye,-Y.height/2],u_patternscale_b:[P/le,-te.height/2],u_sdfgamma:k.width/(256*Math.min(ye,le)*x.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:Y.y,u_tex_y_b:te.y,u_mix:S.t})};function El(c,h){return 1/pa(c,1,h.tileZoom)}function od(c,h,f){return c.translatePosMatrix(h.tileID.posMatrix,h,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}var i0=function(c,h,f,m,S){return{u_matrix:c,u_tl_parent:h,u_scale_parent:f,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(P=S.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(k=S.paint.get("raster-contrast"),k>0?1/(1-k):1+k),u_spin_weights:sd(S.paint.get("raster-hue-rotate"))};var k,P};function sd(c){c*=Math.PI/180;var h=Math.sin(c),f=Math.cos(c);return[(2*f+1)/3,(-Math.sqrt(3)*h-f+1)/3,(Math.sqrt(3)*h-f+1)/3]}var ph,Yc=function(c,h,f,m,S,k,P,N,Y,te){var ye=S.transform;return{u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:h?h.uSizeT:0,u_size:h?h.uSize:0,u_camera_to_center_distance:ye.cameraToCenterDistance,u_pitch:ye.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:ye.width/ye.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:k,u_label_plane_matrix:P,u_coord_matrix:N,u_is_text:+Y,u_pitch_with_map:+m,u_texsize:te,u_texture:0}},yf=function(c,h,f,m,S,k,P,N,Y,te,ye){var le=S.transform;return x.extend(Yc(c,h,f,m,S,k,P,N,Y,te),{u_gamma_scale:m?Math.cos(le._pitch)*le.cameraToCenterDistance:1,u_device_pixel_ratio:x.browser.devicePixelRatio,u_is_halo:+ye})},Ac=function(c,h,f,m,S,k,P,N,Y,te){return x.extend(yf(c,h,f,m,S,k,P,N,!0,Y,!0),{u_texsize_icon:te,u_texture_icon:1})},qc=function(c,h,f){return{u_matrix:c,u_opacity:h,u_color:f}},Tc=function(c,h,f,m,S,k){return x.extend(function(P,N,Y,te){var ye=Y.imageManager.getPattern(P.from.toString()),le=Y.imageManager.getPattern(P.to.toString()),xe=Y.imageManager.getPixelSize(),ze=xe.width,Ue=xe.height,Je=Math.pow(2,te.tileID.overscaledZ),Fe=te.tileSize*Math.pow(2,Y.transform.tileZoom)/Je,et=Fe*(te.tileID.canonical.x+te.tileID.wrap*Je),pt=Fe*te.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ye.tl,u_pattern_br_a:ye.br,u_pattern_tl_b:le.tl,u_pattern_br_b:le.br,u_texsize:[ze,Ue],u_mix:N.t,u_pattern_size_a:ye.displaySize,u_pattern_size_b:le.displaySize,u_scale_a:N.fromScale,u_scale_b:N.toScale,u_tile_units_to_pixels:1/pa(te,1,Y.transform.tileZoom),u_pixel_coord_upper:[et>>16,pt>>16],u_pixel_coord_lower:[65535&et,65535&pt]}}(m,k,f,S),{u_matrix:c,u_opacity:h})},_f={fillExtrusion:function(c,h){return{u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_lightpos:new x.Uniform3f(c,h.u_lightpos),u_lightintensity:new x.Uniform1f(c,h.u_lightintensity),u_lightcolor:new x.Uniform3f(c,h.u_lightcolor),u_vertical_gradient:new x.Uniform1f(c,h.u_vertical_gradient),u_opacity:new x.Uniform1f(c,h.u_opacity)}},fillExtrusionPattern:function(c,h){return{u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_lightpos:new x.Uniform3f(c,h.u_lightpos),u_lightintensity:new x.Uniform1f(c,h.u_lightintensity),u_lightcolor:new x.Uniform3f(c,h.u_lightcolor),u_vertical_gradient:new x.Uniform1f(c,h.u_vertical_gradient),u_height_factor:new x.Uniform1f(c,h.u_height_factor),u_image:new x.Uniform1i(c,h.u_image),u_texsize:new x.Uniform2f(c,h.u_texsize),u_pixel_coord_upper:new x.Uniform2f(c,h.u_pixel_coord_upper),u_pixel_coord_lower:new x.Uniform2f(c,h.u_pixel_coord_lower),u_scale:new x.Uniform3f(c,h.u_scale),u_fade:new x.Uniform1f(c,h.u_fade),u_opacity:new x.Uniform1f(c,h.u_opacity)}},fill:function(c,h){return{u_matrix:new x.UniformMatrix4f(c,h.u_matrix)}},fillPattern:function(c,h){return{u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_image:new x.Uniform1i(c,h.u_image),u_texsize:new x.Uniform2f(c,h.u_texsize),u_pixel_coord_upper:new x.Uniform2f(c,h.u_pixel_coord_upper),u_pixel_coord_lower:new x.Uniform2f(c,h.u_pixel_coord_lower),u_scale:new x.Uniform3f(c,h.u_scale),u_fade:new x.Uniform1f(c,h.u_fade)}},fillOutline:function(c,h){return{u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_world:new x.Uniform2f(c,h.u_world)}},fillOutlinePattern:function(c,h){return{u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_world:new x.Uniform2f(c,h.u_world),u_image:new x.Uniform1i(c,h.u_image),u_texsize:new x.Uniform2f(c,h.u_texsize),u_pixel_coord_upper:new x.Uniform2f(c,h.u_pixel_coord_upper),u_pixel_coord_lower:new x.Uniform2f(c,h.u_pixel_coord_lower),u_scale:new x.Uniform3f(c,h.u_scale),u_fade:new x.Uniform1f(c,h.u_fade)}},circle:function(c,h){return{u_camera_to_center_distance:new x.Uniform1f(c,h.u_camera_to_center_distance),u_scale_with_map:new x.Uniform1i(c,h.u_scale_with_map),u_pitch_with_map:new x.Uniform1i(c,h.u_pitch_with_map),u_extrude_scale:new x.Uniform2f(c,h.u_extrude_scale),u_device_pixel_ratio:new x.Uniform1f(c,h.u_device_pixel_ratio),u_matrix:new x.UniformMatrix4f(c,h.u_matrix)}},collisionBox:function(c,h){return{u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_camera_to_center_distance:new x.Uniform1f(c,h.u_camera_to_center_distance),u_pixels_to_tile_units:new x.Uniform1f(c,h.u_pixels_to_tile_units),u_extrude_scale:new x.Uniform2f(c,h.u_extrude_scale),u_overscale_factor:new x.Uniform1f(c,h.u_overscale_factor)}},collisionCircle:function(c,h){return{u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_inv_matrix:new x.UniformMatrix4f(c,h.u_inv_matrix),u_camera_to_center_distance:new x.Uniform1f(c,h.u_camera_to_center_distance),u_viewport_size:new x.Uniform2f(c,h.u_viewport_size)}},debug:function(c,h){return{u_color:new x.UniformColor(c,h.u_color),u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_overlay:new x.Uniform1i(c,h.u_overlay),u_overlay_scale:new x.Uniform1f(c,h.u_overlay_scale)}},clippingMask:function(c,h){return{u_matrix:new x.UniformMatrix4f(c,h.u_matrix)}},heatmap:function(c,h){return{u_extrude_scale:new x.Uniform1f(c,h.u_extrude_scale),u_intensity:new x.Uniform1f(c,h.u_intensity),u_matrix:new x.UniformMatrix4f(c,h.u_matrix)}},heatmapTexture:function(c,h){return{u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_world:new x.Uniform2f(c,h.u_world),u_image:new x.Uniform1i(c,h.u_image),u_color_ramp:new x.Uniform1i(c,h.u_color_ramp),u_opacity:new x.Uniform1f(c,h.u_opacity)}},hillshade:function(c,h){return{u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_image:new x.Uniform1i(c,h.u_image),u_latrange:new x.Uniform2f(c,h.u_latrange),u_light:new x.Uniform2f(c,h.u_light),u_shadow:new x.UniformColor(c,h.u_shadow),u_highlight:new x.UniformColor(c,h.u_highlight),u_accent:new x.UniformColor(c,h.u_accent)}},hillshadePrepare:function(c,h){return{u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_image:new x.Uniform1i(c,h.u_image),u_dimension:new x.Uniform2f(c,h.u_dimension),u_zoom:new x.Uniform1f(c,h.u_zoom),u_unpack:new x.Uniform4f(c,h.u_unpack)}},line:function(c,h){return{u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_ratio:new x.Uniform1f(c,h.u_ratio),u_device_pixel_ratio:new x.Uniform1f(c,h.u_device_pixel_ratio),u_units_to_pixels:new x.Uniform2f(c,h.u_units_to_pixels)}},lineGradient:function(c,h){return{u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_ratio:new x.Uniform1f(c,h.u_ratio),u_device_pixel_ratio:new x.Uniform1f(c,h.u_device_pixel_ratio),u_units_to_pixels:new x.Uniform2f(c,h.u_units_to_pixels),u_image:new x.Uniform1i(c,h.u_image),u_image_height:new x.Uniform1f(c,h.u_image_height)}},linePattern:function(c,h){return{u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_texsize:new x.Uniform2f(c,h.u_texsize),u_ratio:new x.Uniform1f(c,h.u_ratio),u_device_pixel_ratio:new x.Uniform1f(c,h.u_device_pixel_ratio),u_image:new x.Uniform1i(c,h.u_image),u_units_to_pixels:new x.Uniform2f(c,h.u_units_to_pixels),u_scale:new x.Uniform3f(c,h.u_scale),u_fade:new x.Uniform1f(c,h.u_fade)}},lineSDF:function(c,h){return{u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_ratio:new x.Uniform1f(c,h.u_ratio),u_device_pixel_ratio:new x.Uniform1f(c,h.u_device_pixel_ratio),u_units_to_pixels:new x.Uniform2f(c,h.u_units_to_pixels),u_patternscale_a:new x.Uniform2f(c,h.u_patternscale_a),u_patternscale_b:new x.Uniform2f(c,h.u_patternscale_b),u_sdfgamma:new x.Uniform1f(c,h.u_sdfgamma),u_image:new x.Uniform1i(c,h.u_image),u_tex_y_a:new x.Uniform1f(c,h.u_tex_y_a),u_tex_y_b:new x.Uniform1f(c,h.u_tex_y_b),u_mix:new x.Uniform1f(c,h.u_mix)}},raster:function(c,h){return{u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_tl_parent:new x.Uniform2f(c,h.u_tl_parent),u_scale_parent:new x.Uniform1f(c,h.u_scale_parent),u_buffer_scale:new x.Uniform1f(c,h.u_buffer_scale),u_fade_t:new x.Uniform1f(c,h.u_fade_t),u_opacity:new x.Uniform1f(c,h.u_opacity),u_image0:new x.Uniform1i(c,h.u_image0),u_image1:new x.Uniform1i(c,h.u_image1),u_brightness_low:new x.Uniform1f(c,h.u_brightness_low),u_brightness_high:new x.Uniform1f(c,h.u_brightness_high),u_saturation_factor:new x.Uniform1f(c,h.u_saturation_factor),u_contrast_factor:new x.Uniform1f(c,h.u_contrast_factor),u_spin_weights:new x.Uniform3f(c,h.u_spin_weights)}},symbolIcon:function(c,h){return{u_is_size_zoom_constant:new x.Uniform1i(c,h.u_is_size_zoom_constant),u_is_size_feature_constant:new x.Uniform1i(c,h.u_is_size_feature_constant),u_size_t:new x.Uniform1f(c,h.u_size_t),u_size:new x.Uniform1f(c,h.u_size),u_camera_to_center_distance:new x.Uniform1f(c,h.u_camera_to_center_distance),u_pitch:new x.Uniform1f(c,h.u_pitch),u_rotate_symbol:new x.Uniform1i(c,h.u_rotate_symbol),u_aspect_ratio:new x.Uniform1f(c,h.u_aspect_ratio),u_fade_change:new x.Uniform1f(c,h.u_fade_change),u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_label_plane_matrix:new x.UniformMatrix4f(c,h.u_label_plane_matrix),u_coord_matrix:new x.UniformMatrix4f(c,h.u_coord_matrix),u_is_text:new x.Uniform1i(c,h.u_is_text),u_pitch_with_map:new x.Uniform1i(c,h.u_pitch_with_map),u_texsize:new x.Uniform2f(c,h.u_texsize),u_texture:new x.Uniform1i(c,h.u_texture)}},symbolSDF:function(c,h){return{u_is_size_zoom_constant:new x.Uniform1i(c,h.u_is_size_zoom_constant),u_is_size_feature_constant:new x.Uniform1i(c,h.u_is_size_feature_constant),u_size_t:new x.Uniform1f(c,h.u_size_t),u_size:new x.Uniform1f(c,h.u_size),u_camera_to_center_distance:new x.Uniform1f(c,h.u_camera_to_center_distance),u_pitch:new x.Uniform1f(c,h.u_pitch),u_rotate_symbol:new x.Uniform1i(c,h.u_rotate_symbol),u_aspect_ratio:new x.Uniform1f(c,h.u_aspect_ratio),u_fade_change:new x.Uniform1f(c,h.u_fade_change),u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_label_plane_matrix:new x.UniformMatrix4f(c,h.u_label_plane_matrix),u_coord_matrix:new x.UniformMatrix4f(c,h.u_coord_matrix),u_is_text:new x.Uniform1i(c,h.u_is_text),u_pitch_with_map:new x.Uniform1i(c,h.u_pitch_with_map),u_texsize:new x.Uniform2f(c,h.u_texsize),u_texture:new x.Uniform1i(c,h.u_texture),u_gamma_scale:new x.Uniform1f(c,h.u_gamma_scale),u_device_pixel_ratio:new x.Uniform1f(c,h.u_device_pixel_ratio),u_is_halo:new x.Uniform1i(c,h.u_is_halo)}},symbolTextAndIcon:function(c,h){return{u_is_size_zoom_constant:new x.Uniform1i(c,h.u_is_size_zoom_constant),u_is_size_feature_constant:new x.Uniform1i(c,h.u_is_size_feature_constant),u_size_t:new x.Uniform1f(c,h.u_size_t),u_size:new x.Uniform1f(c,h.u_size),u_camera_to_center_distance:new x.Uniform1f(c,h.u_camera_to_center_distance),u_pitch:new x.Uniform1f(c,h.u_pitch),u_rotate_symbol:new x.Uniform1i(c,h.u_rotate_symbol),u_aspect_ratio:new x.Uniform1f(c,h.u_aspect_ratio),u_fade_change:new x.Uniform1f(c,h.u_fade_change),u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_label_plane_matrix:new x.UniformMatrix4f(c,h.u_label_plane_matrix),u_coord_matrix:new x.UniformMatrix4f(c,h.u_coord_matrix),u_is_text:new x.Uniform1i(c,h.u_is_text),u_pitch_with_map:new x.Uniform1i(c,h.u_pitch_with_map),u_texsize:new x.Uniform2f(c,h.u_texsize),u_texsize_icon:new x.Uniform2f(c,h.u_texsize_icon),u_texture:new x.Uniform1i(c,h.u_texture),u_texture_icon:new x.Uniform1i(c,h.u_texture_icon),u_gamma_scale:new x.Uniform1f(c,h.u_gamma_scale),u_device_pixel_ratio:new x.Uniform1f(c,h.u_device_pixel_ratio),u_is_halo:new x.Uniform1i(c,h.u_is_halo)}},background:function(c,h){return{u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_opacity:new x.Uniform1f(c,h.u_opacity),u_color:new x.UniformColor(c,h.u_color)}},backgroundPattern:function(c,h){return{u_matrix:new x.UniformMatrix4f(c,h.u_matrix),u_opacity:new x.Uniform1f(c,h.u_opacity),u_image:new x.Uniform1i(c,h.u_image),u_pattern_tl_a:new x.Uniform2f(c,h.u_pattern_tl_a),u_pattern_br_a:new x.Uniform2f(c,h.u_pattern_br_a),u_pattern_tl_b:new x.Uniform2f(c,h.u_pattern_tl_b),u_pattern_br_b:new x.Uniform2f(c,h.u_pattern_br_b),u_texsize:new x.Uniform2f(c,h.u_texsize),u_mix:new x.Uniform1f(c,h.u_mix),u_pattern_size_a:new x.Uniform2f(c,h.u_pattern_size_a),u_pattern_size_b:new x.Uniform2f(c,h.u_pattern_size_b),u_scale_a:new x.Uniform1f(c,h.u_scale_a),u_scale_b:new x.Uniform1f(c,h.u_scale_b),u_pixel_coord_upper:new x.Uniform2f(c,h.u_pixel_coord_upper),u_pixel_coord_lower:new x.Uniform2f(c,h.u_pixel_coord_lower),u_tile_units_to_pixels:new x.Uniform1f(c,h.u_tile_units_to_pixels)}}};function oc(c,h,f,m,S,k,P){for(var N=c.context,Y=N.gl,te=c.useProgram("collisionBox"),ye=[],le=0,xe=0,ze=0;ze<m.length;ze++){var Ue=m[ze],Je=h.getTile(Ue),Fe=Je.getBucket(f);if(Fe){var et=Ue.posMatrix;S[0]===0&&S[1]===0||(et=c.translatePosMatrix(Ue.posMatrix,Je,S,k));var pt=P?Fe.textCollisionBox:Fe.iconCollisionBox,kt=Fe.collisionCircleArray;if(kt.length>0){var Qt=x.create(),Bt=et;x.mul(Qt,Fe.placementInvProjMatrix,c.transform.glCoordMatrix),x.mul(Qt,Qt,Fe.placementViewportMatrix),ye.push({circleArray:kt,circleOffset:xe,transform:Bt,invTransform:Qt}),xe=le+=kt.length/4}pt&&te.draw(N,Y.LINES,be.disabled,Ne.disabled,c.colorModeForRenderPass(),lt.disabled,Iu(et,c.transform,Je),f.id,pt.layoutVertexBuffer,pt.indexBuffer,pt.segments,null,c.transform.zoom,null,null,pt.collisionVertexBuffer)}}if(P&&ye.length){var nr=c.useProgram("collisionCircle"),Or=new x.StructArrayLayout2f1f2i16;Or.resize(4*le),Or._trim();for(var un=0,rn=0,Pn=ye;rn<Pn.length;rn+=1)for(var ui=Pn[rn],gi=0;gi<ui.circleArray.length/4;gi++){var fi=4*gi,_a=ui.circleArray[fi+0],Dn=ui.circleArray[fi+1],Ii=ui.circleArray[fi+2],Wi=ui.circleArray[fi+3];Or.emplace(un++,_a,Dn,Ii,Wi,0),Or.emplace(un++,_a,Dn,Ii,Wi,1),Or.emplace(un++,_a,Dn,Ii,Wi,2),Or.emplace(un++,_a,Dn,Ii,Wi,3)}(!ph||ph.length<2*le)&&(ph=function(qo){var Ds=2*qo,es=new x.StructArrayLayout3ui6;es.resize(Ds),es._trim();for(var vo=0;vo<Ds;vo++){var lo=6*vo;es.uint16[lo+0]=4*vo+0,es.uint16[lo+1]=4*vo+1,es.uint16[lo+2]=4*vo+2,es.uint16[lo+3]=4*vo+2,es.uint16[lo+4]=4*vo+3,es.uint16[lo+5]=4*vo+0}return es}(le));for(var Bi=N.createIndexBuffer(ph,!0),wi=N.createVertexBuffer(Or,x.collisionCircleLayout.members,!0),Ki=0,Ci=ye;Ki<Ci.length;Ki+=1){var Si=Ci[Ki],gs=fh(Si.transform,Si.invTransform,c.transform);nr.draw(N,Y.TRIANGLES,be.disabled,Ne.disabled,c.colorModeForRenderPass(),lt.disabled,gs,f.id,wi,Bi,x.SegmentVector.simpleSegment(0,2*Si.circleOffset,Si.circleArray.length,Si.circleArray.length/2),null,c.transform.zoom,null,null,null)}wi.destroy(),Bi.destroy()}}var cu=x.identity(new Float32Array(16));function sc(c,h,f,m,S,k){var P=x.getAnchorAlignment(c),N=-(P.horizontalAlign-.5)*h,Y=-(P.verticalAlign-.5)*f,te=x.evaluateVariableOffset(c,m);return new x.Point((N/S+te[0])*k,(Y/S+te[1])*k)}function qf(c,h,f,m,S,k,P,N,Y,te,ye){var le=c.text.placedSymbolArray,xe=c.text.dynamicLayoutVertexArray,ze=c.icon.dynamicLayoutVertexArray,Ue={};xe.clear();for(var Je=0;Je<le.length;Je++){var Fe=le.get(Je),et=Fe.hidden||!Fe.crossTileID||c.allowVerticalPlacement&&!Fe.placedOrientation?null:m[Fe.crossTileID];if(et){var pt=new x.Point(Fe.anchorX,Fe.anchorY),kt=lr(pt,f?N:P),Qt=nt(k.cameraToCenterDistance,kt.signedDistanceFromCamera),Bt=S.evaluateSizeForFeature(c.textSizeData,te,Fe)*Qt/x.ONE_EM;f&&(Bt*=c.tilePixelRatio/Y);for(var nr=sc(et.anchor,et.width,et.height,et.textOffset,et.textBoxScale,Bt),Or=f?lr(pt.add(nr),P).point:kt.point.add(h?nr.rotate(-k.angle):nr),un=c.allowVerticalPlacement&&Fe.placedOrientation===x.WritingMode.vertical?Math.PI/2:0,rn=0;rn<Fe.numGlyphs;rn++)x.addDynamicAttributes(xe,Or,un);ye&&Fe.associatedIconIndex>=0&&(Ue[Fe.associatedIconIndex]={shiftedAnchor:Or,angle:un})}else Aa(Fe.numGlyphs,xe)}if(ye){ze.clear();for(var Pn=c.icon.placedSymbolArray,ui=0;ui<Pn.length;ui++){var gi=Pn.get(ui);if(gi.hidden)Aa(gi.numGlyphs,ze);else{var fi=Ue[ui];if(fi)for(var _a=0;_a<gi.numGlyphs;_a++)x.addDynamicAttributes(ze,fi.shiftedAnchor,fi.angle);else Aa(gi.numGlyphs,ze)}}c.icon.dynamicLayoutVertexBuffer.updateData(ze)}c.text.dynamicLayoutVertexBuffer.updateData(xe)}function Gh(c,h,f){return f.iconsInText&&h?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function Mc(c,h,f,m,S,k,P,N,Y,te,ye,le){for(var xe=c.context,ze=xe.gl,Ue=c.transform,Je=N==="map",Fe=Y==="map",et=Je&&f.layout.get("symbol-placement")!=="point",pt=Je&&!Fe&&!et,kt=f.layout.get("symbol-sort-key").constantOr(1)!==void 0,Qt=!1,Bt=c.depthModeForSublayer(0,be.ReadOnly),nr=f.layout.get("text-variable-anchor"),Or=[],un=0,rn=m;un<rn.length;un+=1){var Pn=rn[un],ui=h.getTile(Pn),gi=ui.getBucket(f);if(gi){var fi=S?gi.text:gi.icon;if(fi&&fi.segments.get().length){var _a=fi.programConfigurations.get(f.id),Dn=S||gi.sdfIcons,Ii=S?gi.textSizeData:gi.iconSizeData,Wi=Fe||Ue.pitch!==0,Bi=c.useProgram(Gh(Dn,S,gi),_a),wi=x.evaluateSizeForZoom(Ii,Ue.zoom),Ki=void 0,Ci=[0,0],Si=void 0,gs=void 0,qo=null,Ds=void 0;if(S)Si=ui.glyphAtlasTexture,gs=ze.LINEAR,Ki=ui.glyphAtlasTexture.size,gi.iconsInText&&(Ci=ui.imageAtlasTexture.size,qo=ui.imageAtlasTexture,Ds=Wi||c.options.rotating||c.options.zooming||Ii.kind==="composite"||Ii.kind==="camera"?ze.LINEAR:ze.NEAREST);else{var es=f.layout.get("icon-size").constantOr(0)!==1||gi.iconsNeedLinear;Si=ui.imageAtlasTexture,gs=Dn||c.options.rotating||c.options.zooming||es||Wi?ze.LINEAR:ze.NEAREST,Ki=ui.imageAtlasTexture.size}var vo=pa(ui,1,c.transform.zoom),lo=fo(Pn.posMatrix,Fe,Je,c.transform,vo),pu=mr(Pn.posMatrix,Fe,Je,c.transform,vo),Js=nr&&gi.hasTextData(),Xl=f.layout.get("icon-text-fit")!=="none"&&Js&&gi.hasIconData();et&&dt(gi,Pn.posMatrix,c,S,lo,pu,Fe,te);var du=c.translatePosMatrix(Pn.posMatrix,ui,k,P),Xu=et||S&&nr||Xl?cu:lo,eu=c.translatePosMatrix(pu,ui,k,P,!0),Tf=Dn&&f.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0,rf={program:Bi,buffers:fi,uniformValues:Dn?gi.iconsInText?Ac(Ii.kind,wi,pt,Fe,c,du,Xu,eu,Ki,Ci):yf(Ii.kind,wi,pt,Fe,c,du,Xu,eu,S,Ki,!0):Yc(Ii.kind,wi,pt,Fe,c,du,Xu,eu,S,Ki),atlasTexture:Si,atlasTextureIcon:qo,atlasInterpolation:gs,atlasInterpolationIcon:Ds,isSDF:Dn,hasHalo:Tf};if(kt&&gi.canOverlap){Qt=!0;for(var Yl=0,sl=fi.segments.get();Yl<sl.length;Yl+=1){var Mf=sl[Yl];Or.push({segments:new x.SegmentVector([Mf]),sortKey:Mf.sortKey,state:rf})}}else Or.push({segments:fi.segments,sortKey:0,state:rf})}}}Qt&&Or.sort(function(Ll,tu){return Ll.sortKey-tu.sortKey});for(var ul=0,mc=Or;ul<mc.length;ul+=1){var ql=mc[ul],ls=ql.state;if(xe.activeTexture.set(ze.TEXTURE0),ls.atlasTexture.bind(ls.atlasInterpolation,ze.CLAMP_TO_EDGE),ls.atlasTextureIcon&&(xe.activeTexture.set(ze.TEXTURE1),ls.atlasTextureIcon&&ls.atlasTextureIcon.bind(ls.atlasInterpolationIcon,ze.CLAMP_TO_EDGE)),ls.isSDF){var Pl=ls.uniformValues;ls.hasHalo&&(Pl.u_is_halo=1,Cl(ls.buffers,ql.segments,f,c,ls.program,Bt,ye,le,Pl)),Pl.u_is_halo=0}Cl(ls.buffers,ql.segments,f,c,ls.program,Bt,ye,le,ls.uniformValues)}}function Cl(c,h,f,m,S,k,P,N,Y){var te=m.context;S.draw(te,te.gl.TRIANGLES,k,P,N,lt.disabled,Y,f.id,c.layoutVertexBuffer,c.indexBuffer,h,f.paint,m.transform.zoom,c.programConfigurations.get(f.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function uc(c,h,f,m,S,k,P){var N,Y,te,ye,le,xe=c.context.gl,ze=f.paint.get("fill-pattern"),Ue=ze&&ze.constantOr(1),Je=f.getCrossfadeParameters();P?(Y=Ue&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=xe.LINES):(Y=Ue?"fillPattern":"fill",N=xe.TRIANGLES);for(var Fe=0,et=m;Fe<et.length;Fe+=1){var pt=et[Fe],kt=h.getTile(pt);if(!Ue||kt.patternsLoaded()){var Qt=kt.getBucket(f);if(Qt){var Bt=Qt.programConfigurations.get(f.id),nr=c.useProgram(Y,Bt);Ue&&(c.context.activeTexture.set(xe.TEXTURE0),kt.imageAtlasTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),Bt.updatePaintBuffers(Je));var Or=ze.constantOr(null);if(Or&&kt.imageAtlas){var un=kt.imageAtlas,rn=un.patternPositions[Or.to.toString()],Pn=un.patternPositions[Or.from.toString()];rn&&Pn&&Bt.setConstantPatternPositions(rn,Pn)}var ui=c.translatePosMatrix(pt.posMatrix,kt,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(P){ye=Qt.indexBuffer2,le=Qt.segments2;var gi=[xe.drawingBufferWidth,xe.drawingBufferHeight];te=Y==="fillOutlinePattern"&&Ue?Vh(ui,c,Je,kt,gi):Oo(ui,gi)}else ye=Qt.indexBuffer,le=Qt.segments,te=Ue?xl(ui,c,Je,kt):Vl(ui);nr.draw(c.context,N,S,c.stencilModeForClipping(pt),k,lt.disabled,te,f.id,Qt.layoutVertexBuffer,ye,le,f.paint,c.transform.zoom,Bt)}}}}function xf(c,h,f,m,S,k,P){for(var N=c.context,Y=N.gl,te=f.paint.get("fill-extrusion-pattern"),ye=te.constantOr(1),le=f.getCrossfadeParameters(),xe=f.paint.get("fill-extrusion-opacity"),ze=0,Ue=m;ze<Ue.length;ze+=1){var Je=Ue[ze],Fe=h.getTile(Je),et=Fe.getBucket(f);if(et){var pt=et.programConfigurations.get(f.id),kt=c.useProgram(ye?"fillExtrusionPattern":"fillExtrusion",pt);ye&&(c.context.activeTexture.set(Y.TEXTURE0),Fe.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),pt.updatePaintBuffers(le));var Qt=te.constantOr(null);if(Qt&&Fe.imageAtlas){var Bt=Fe.imageAtlas,nr=Bt.patternPositions[Qt.to.toString()],Or=Bt.patternPositions[Qt.from.toString()];nr&&Or&&pt.setConstantPatternPositions(nr,Or)}var un=c.translatePosMatrix(Je.posMatrix,Fe,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),rn=f.paint.get("fill-extrusion-vertical-gradient"),Pn=ye?ku(un,c,rn,xe,Je,le,Fe):wc(un,c,rn,xe);kt.draw(N,N.gl.TRIANGLES,S,k,P,lt.backCCW,Pn,f.id,et.layoutVertexBuffer,et.indexBuffer,et.segments,f.paint,c.transform.zoom,pt)}}}function kc(c,h,f,m,S,k){var P=c.context,N=P.gl,Y=h.fbo;if(Y){var te=c.useProgram("hillshade");P.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,Y.colorAttachment.get());var ye=function(le,xe,ze){var Ue=ze.paint.get("hillshade-shadow-color"),Je=ze.paint.get("hillshade-highlight-color"),Fe=ze.paint.get("hillshade-accent-color"),et=ze.paint.get("hillshade-illumination-direction")*(Math.PI/180);ze.paint.get("hillshade-illumination-anchor")==="viewport"&&(et-=le.transform.angle);var pt,kt,Qt,Bt=!le.options.moving;return{u_matrix:le.transform.calculatePosMatrix(xe.tileID.toUnwrapped(),Bt),u_image:0,u_latrange:(pt=xe.tileID,kt=Math.pow(2,pt.canonical.z),Qt=pt.canonical.y,[new x.MercatorCoordinate(0,Qt/kt).toLngLat().lat,new x.MercatorCoordinate(0,(Qt+1)/kt).toLngLat().lat]),u_light:[ze.paint.get("hillshade-exaggeration"),et],u_shadow:Ue,u_highlight:Je,u_accent:Fe}}(c,h,f);te.draw(P,N.TRIANGLES,m,S,k,lt.disabled,ye,f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}}function Hh(c,h,f,m,S,k){var P=c.context,N=P.gl,Y=h.dem;if(Y&&Y.data){var te=Y.dim,ye=Y.stride,le=Y.getPixels();if(P.activeTexture.set(N.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),h.demTexture=h.demTexture||c.getTileTexture(ye),h.demTexture){var xe=h.demTexture;xe.update(le,{premultiply:!1}),xe.bind(N.NEAREST,N.CLAMP_TO_EDGE)}else h.demTexture=new x.Texture(P,le,N.RGBA,{premultiply:!1}),h.demTexture.bind(N.NEAREST,N.CLAMP_TO_EDGE);P.activeTexture.set(N.TEXTURE0);var ze=h.fbo;if(!ze){var Ue=new x.Texture(P,{width:te,height:te,data:null},N.RGBA);Ue.bind(N.LINEAR,N.CLAMP_TO_EDGE),(ze=h.fbo=P.createFramebuffer(te,te,!0)).colorAttachment.set(Ue.texture)}P.bindFramebuffer.set(ze.framebuffer),P.viewport.set([0,0,te,te]),c.useProgram("hillshadePrepare").draw(P,N.TRIANGLES,m,S,k,lt.disabled,function(Je,Fe){var et=Fe.stride,pt=x.create();return x.ortho(pt,0,x.EXTENT,-x.EXTENT,0,0,1),x.translate(pt,pt,[0,-x.EXTENT,0]),{u_matrix:pt,u_image:1,u_dimension:[et,et],u_zoom:Je.overscaledZ,u_unpack:Fe.getUnpackVector()}}(h.tileID,Y),f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments),h.needsHillshadePrepare=!1}}function bf(c,h,f,m,S){var k=m.paint.get("raster-fade-duration");if(k>0){var P=x.browser.now(),N=(P-c.timeAdded)/k,Y=h?(P-h.timeAdded)/k:-1,te=f.getSource(),ye=S.coveringZoomLevel({tileSize:te.tileSize,roundZoom:te.roundZoom}),le=!h||Math.abs(h.tileID.overscaledZ-ye)>Math.abs(c.tileID.overscaledZ-ye),xe=le&&c.refreshedUponExpiration?1:x.clamp(le?N:1-Y,0,1);return c.refreshedUponExpiration&&N>=1&&(c.refreshedUponExpiration=!1),h?{opacity:1,mix:1-xe}:{opacity:xe,mix:0}}return{opacity:1,mix:0}}var Ic=new x.Color(1,0,0,1),Ef=new x.Color(0,1,0,1),Wh=new x.Color(0,0,1,1),Cf=new x.Color(1,0,1,1),ud=new x.Color(0,1,1,1);function wp(c,h,f,m){Ts(c,0,h+f/2,c.transform.width,f,m)}function dh(c,h,f,m){Ts(c,h-f/2,0,f,c.transform.height,m)}function Ts(c,h,f,m,S,k){var P=c.context,N=P.gl;N.enable(N.SCISSOR_TEST),N.scissor(h*x.browser.devicePixelRatio,f*x.browser.devicePixelRatio,m*x.browser.devicePixelRatio,S*x.browser.devicePixelRatio),P.clear({color:k}),N.disable(N.SCISSOR_TEST)}function Ap(c,h,f){var m=c.context,S=m.gl,k=f.posMatrix,P=c.useProgram("debug"),N=be.disabled,Y=Ne.disabled,te=c.colorModeForRenderPass();m.activeTexture.set(S.TEXTURE0),c.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),P.draw(m,S.LINE_STRIP,N,Y,te,lt.disabled,ac(k,x.Color.red),"$debug",c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments);var ye=h.getTileByID(f.key).latestRawTileData,le=Math.floor((ye&&ye.byteLength||0)/1024),xe=h.getTile(f).tileSize,ze=512/Math.min(xe,512)*(f.overscaledZ/c.transform.zoom)*.5,Ue=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(Ue+=" => "+f.overscaledZ),function(Je,Fe){Je.initDebugOverlayCanvas();var et=Je.debugOverlayCanvas,pt=Je.context.gl,kt=Je.debugOverlayCanvas.getContext("2d");kt.clearRect(0,0,et.width,et.height),kt.shadowColor="white",kt.shadowBlur=2,kt.lineWidth=1.5,kt.strokeStyle="white",kt.textBaseline="top",kt.font="bold 36px Open Sans, sans-serif",kt.fillText(Fe,5,5),kt.strokeText(Fe,5,5),Je.debugOverlayTexture.update(et),Je.debugOverlayTexture.bind(pt.LINEAR,pt.CLAMP_TO_EDGE)}(c,Ue+" "+le+"kb"),P.draw(m,S.TRIANGLES,N,Y,Ye.alphaBlended,lt.disabled,ac(k,x.Color.transparent,ze),"$debug",c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments)}var Ia={symbol:function(c,h,f,m,S){if(c.renderPass==="translucent"){var k=Ne.disabled,P=c.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(N,Y,te,ye,le,xe,ze){for(var Ue=Y.transform,Je=le==="map",Fe=xe==="map",et=0,pt=N;et<pt.length;et+=1){var kt=pt[et],Qt=ye.getTile(kt),Bt=Qt.getBucket(te);if(Bt&&Bt.text&&Bt.text.segments.get().length){var nr=x.evaluateSizeForZoom(Bt.textSizeData,Ue.zoom),Or=pa(Qt,1,Y.transform.zoom),un=fo(kt.posMatrix,Fe,Je,Y.transform,Or),rn=te.layout.get("icon-text-fit")!=="none"&&Bt.hasIconData();if(nr){var Pn=Math.pow(2,Ue.zoom-Qt.tileID.overscaledZ);qf(Bt,Je,Fe,ze,x.symbolSize,Ue,un,kt.posMatrix,Pn,nr,rn)}}}}(m,c,f,h,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),S),f.paint.get("icon-opacity").constantOr(1)!==0&&Mc(c,h,f,m,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),k,P),f.paint.get("text-opacity").constantOr(1)!==0&&Mc(c,h,f,m,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),k,P),h.map.showCollisionBoxes&&(oc(c,h,f,m,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),oc(c,h,f,m,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))}},circle:function(c,h,f,m){if(c.renderPass==="translucent"){var S=f.paint.get("circle-opacity"),k=f.paint.get("circle-stroke-width"),P=f.paint.get("circle-stroke-opacity"),N=f.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)!==0||k.constantOr(1)!==0&&P.constantOr(1)!==0){for(var Y=c.context,te=Y.gl,ye=c.depthModeForSublayer(0,be.ReadOnly),le=Ne.disabled,xe=c.colorModeForRenderPass(),ze=[],Ue=0;Ue<m.length;Ue++){var Je=m[Ue],Fe=h.getTile(Je),et=Fe.getBucket(f);if(et){var pt=et.programConfigurations.get(f.id),kt={programConfiguration:pt,program:c.useProgram("circle",pt),layoutVertexBuffer:et.layoutVertexBuffer,indexBuffer:et.indexBuffer,uniformValues:jh(c,Je,Fe,f)};if(N)for(var Qt=0,Bt=et.segments.get();Qt<Bt.length;Qt+=1){var nr=Bt[Qt];ze.push({segments:new x.SegmentVector([nr]),sortKey:nr.sortKey,state:kt})}else ze.push({segments:et.segments,sortKey:0,state:kt})}}N&&ze.sort(function(ui,gi){return ui.sortKey-gi.sortKey});for(var Or=0,un=ze;Or<un.length;Or+=1){var rn=un[Or],Pn=rn.state;Pn.program.draw(Y,te.TRIANGLES,ye,le,xe,lt.disabled,Pn.uniformValues,f.id,Pn.layoutVertexBuffer,Pn.indexBuffer,rn.segments,f.paint,c.transform.zoom,Pn.programConfiguration)}}}},heatmap:function(c,h,f,m){if(f.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){var S=c.context,k=S.gl,P=Ne.disabled,N=new Ye([k.ONE,k.ONE],x.Color.transparent,[!0,!0,!0,!0]);(function(ze,Ue,Je){var Fe=ze.gl;ze.activeTexture.set(Fe.TEXTURE1),ze.viewport.set([0,0,Ue.width/4,Ue.height/4]);var et=Je.heatmapFbo;if(et)Fe.bindTexture(Fe.TEXTURE_2D,et.colorAttachment.get()),ze.bindFramebuffer.set(et.framebuffer);else{var pt=Fe.createTexture();Fe.bindTexture(Fe.TEXTURE_2D,pt),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_WRAP_S,Fe.CLAMP_TO_EDGE),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_WRAP_T,Fe.CLAMP_TO_EDGE),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_MIN_FILTER,Fe.LINEAR),Fe.texParameteri(Fe.TEXTURE_2D,Fe.TEXTURE_MAG_FILTER,Fe.LINEAR),et=Je.heatmapFbo=ze.createFramebuffer(Ue.width/4,Ue.height/4,!1),function(kt,Qt,Bt,nr){var Or=kt.gl;Or.texImage2D(Or.TEXTURE_2D,0,Or.RGBA,Qt.width/4,Qt.height/4,0,Or.RGBA,kt.extRenderToTextureHalfFloat?kt.extTextureHalfFloat.HALF_FLOAT_OES:Or.UNSIGNED_BYTE,null),nr.colorAttachment.set(Bt)}(ze,Ue,pt,et)}})(S,c,f),S.clear({color:x.Color.transparent});for(var Y=0;Y<m.length;Y++){var te=m[Y];if(!h.hasRenderableParent(te)){var ye=h.getTile(te),le=ye.getBucket(f);if(le){var xe=le.programConfigurations.get(f.id);c.useProgram("heatmap",xe).draw(S,k.TRIANGLES,be.disabled,P,N,lt.disabled,hh(te.posMatrix,ye,c.transform.zoom,f.paint.get("heatmap-intensity")),f.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,f.paint,c.transform.zoom,xe)}}}S.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(ze,Ue){var Je=ze.context,Fe=Je.gl,et=Ue.heatmapFbo;if(et){Je.activeTexture.set(Fe.TEXTURE0),Fe.bindTexture(Fe.TEXTURE_2D,et.colorAttachment.get()),Je.activeTexture.set(Fe.TEXTURE1);var pt=Ue.colorRampTexture;pt||(pt=Ue.colorRampTexture=new x.Texture(Je,Ue.colorRamp,Fe.RGBA)),pt.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE),ze.useProgram("heatmapTexture").draw(Je,Fe.TRIANGLES,be.disabled,Ne.disabled,ze.colorModeForRenderPass(),lt.disabled,function(kt,Qt,Bt,nr){var Or=x.create();x.ortho(Or,0,kt.width,kt.height,0,0,1);var un=kt.context.gl;return{u_matrix:Or,u_world:[un.drawingBufferWidth,un.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Qt.paint.get("heatmap-opacity")}}(ze,Ue),Ue.id,ze.viewportBuffer,ze.quadTriangleIndexBuffer,ze.viewportSegments,Ue.paint,ze.transform.zoom)}}(c,f))},line:function(c,h,f,m){if(c.renderPass==="translucent"){var S=f.paint.get("line-opacity"),k=f.paint.get("line-width");if(S.constantOr(1)!==0&&k.constantOr(1)!==0)for(var P=c.depthModeForSublayer(0,be.ReadOnly),N=c.colorModeForRenderPass(),Y=f.paint.get("line-dasharray"),te=f.paint.get("line-pattern"),ye=te.constantOr(1),le=f.paint.get("line-gradient"),xe=f.getCrossfadeParameters(),ze=ye?"linePattern":Y?"lineSDF":le?"lineGradient":"line",Ue=c.context,Je=Ue.gl,Fe=!0,et=0,pt=m;et<pt.length;et+=1){var kt=pt[et],Qt=h.getTile(kt);if(!ye||Qt.patternsLoaded()){var Bt=Qt.getBucket(f);if(Bt){var nr=Bt.programConfigurations.get(f.id),Or=c.context.program.get(),un=c.useProgram(ze,nr),rn=Fe||un.program!==Or,Pn=te.constantOr(null);if(Pn&&Qt.imageAtlas){var ui=Qt.imageAtlas,gi=ui.patternPositions[Pn.to.toString()],fi=ui.patternPositions[Pn.from.toString()];gi&&fi&&nr.setConstantPatternPositions(gi,fi)}var _a=ye?Pu(c,Qt,f,xe):Y?Yf(c,Qt,f,Y,xe):le?no(c,Qt,f,Bt.lineClipsArray.length):bl(c,Qt,f);if(ye)Ue.activeTexture.set(Je.TEXTURE0),Qt.imageAtlasTexture.bind(Je.LINEAR,Je.CLAMP_TO_EDGE),nr.updatePaintBuffers(xe);else if(Y&&(rn||c.lineAtlas.dirty))Ue.activeTexture.set(Je.TEXTURE0),c.lineAtlas.bind(Ue);else if(le){var Dn=Bt.gradients[f.id],Ii=Dn.texture;if(f.gradientVersion!==Dn.version){var Wi=256;if(f.stepInterpolant){var Bi=h.getSource().maxzoom,wi=kt.canonical.z===Bi?Math.ceil(1<<c.transform.maxZoom-kt.canonical.z):1;Wi=x.clamp(x.nextPowerOfTwo(Bt.maxLineLength/x.EXTENT*1024*wi),256,Ue.maxTextureSize)}Dn.gradient=x.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:Wi,image:Dn.gradient||void 0,clips:Bt.lineClipsArray}),Dn.texture?Dn.texture.update(Dn.gradient):Dn.texture=new x.Texture(Ue,Dn.gradient,Je.RGBA),Dn.version=f.gradientVersion,Ii=Dn.texture}Ue.activeTexture.set(Je.TEXTURE0),Ii.bind(f.stepInterpolant?Je.NEAREST:Je.LINEAR,Je.CLAMP_TO_EDGE)}un.draw(Ue,Je.TRIANGLES,P,c.stencilModeForClipping(kt),N,lt.disabled,_a,f.id,Bt.layoutVertexBuffer,Bt.indexBuffer,Bt.segments,f.paint,c.transform.zoom,nr,Bt.layoutVertexBuffer2),Fe=!1}}}}},fill:function(c,h,f,m){var S=f.paint.get("fill-color"),k=f.paint.get("fill-opacity");if(k.constantOr(1)!==0){var P=c.colorModeForRenderPass(),N=f.paint.get("fill-pattern"),Y=c.opaquePassEnabledForLayer()&&!N.constantOr(1)&&S.constantOr(x.Color.transparent).a===1&&k.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===Y){var te=c.depthModeForSublayer(1,c.renderPass==="opaque"?be.ReadWrite:be.ReadOnly);uc(c,h,f,m,te,P,!1)}if(c.renderPass==="translucent"&&f.paint.get("fill-antialias")){var ye=c.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,be.ReadOnly);uc(c,h,f,m,ye,P,!0)}}},"fill-extrusion":function(c,h,f,m){var S=f.paint.get("fill-extrusion-opacity");if(S!==0&&c.renderPass==="translucent"){var k=new be(c.context.gl.LEQUAL,be.ReadWrite,c.depthRangeFor3D);if(S!==1||f.paint.get("fill-extrusion-pattern").constantOr(1))xf(c,h,f,m,k,Ne.disabled,Ye.disabled),xf(c,h,f,m,k,c.stencilModeFor3D(),c.colorModeForRenderPass());else{var P=c.colorModeForRenderPass();xf(c,h,f,m,k,Ne.disabled,P)}}},hillshade:function(c,h,f,m){if(c.renderPass==="offscreen"||c.renderPass==="translucent"){for(var S=c.context,k=c.depthModeForSublayer(0,be.ReadOnly),P=c.colorModeForRenderPass(),N=c.renderPass==="translucent"?c.stencilConfigForOverlap(m):[{},m],Y=N[0],te=0,ye=N[1];te<ye.length;te+=1){var le=ye[te],xe=h.getTile(le);xe.needsHillshadePrepare&&c.renderPass==="offscreen"?Hh(c,xe,f,k,Ne.disabled,P):c.renderPass==="translucent"&&kc(c,xe,f,k,Y[le.overscaledZ],P)}S.viewport.set([0,0,c.width,c.height])}},raster:function(c,h,f,m){if(c.renderPass==="translucent"&&f.paint.get("raster-opacity")!==0&&m.length)for(var S=c.context,k=S.gl,P=h.getSource(),N=c.useProgram("raster"),Y=c.colorModeForRenderPass(),te=P instanceof It?[{},m]:c.stencilConfigForOverlap(m),ye=te[0],le=te[1],xe=le[le.length-1].overscaledZ,ze=!c.options.moving,Ue=0,Je=le;Ue<Je.length;Ue+=1){var Fe=Je[Ue],et=c.depthModeForSublayer(Fe.overscaledZ-xe,f.paint.get("raster-opacity")===1?be.ReadWrite:be.ReadOnly,k.LESS),pt=h.getTile(Fe),kt=c.transform.calculatePosMatrix(Fe.toUnwrapped(),ze);pt.registerFadeDuration(f.paint.get("raster-fade-duration"));var Qt=h.findLoadedParent(Fe,0),Bt=bf(pt,Qt,h,f,c.transform),nr=void 0,Or=void 0,un=f.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;S.activeTexture.set(k.TEXTURE0),pt.texture.bind(un,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),S.activeTexture.set(k.TEXTURE1),Qt?(Qt.texture.bind(un,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),nr=Math.pow(2,Qt.tileID.overscaledZ-pt.tileID.overscaledZ),Or=[pt.tileID.canonical.x*nr%1,pt.tileID.canonical.y*nr%1]):pt.texture.bind(un,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST);var rn=i0(kt,Or||[0,0],nr||1,Bt,f);P instanceof It?N.draw(S,k.TRIANGLES,et,Ne.disabled,Y,lt.disabled,rn,f.id,P.boundsBuffer,c.quadTriangleIndexBuffer,P.boundsSegments):N.draw(S,k.TRIANGLES,et,ye[Fe.overscaledZ],Y,lt.disabled,rn,f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}},background:function(c,h,f){var m=f.paint.get("background-color"),S=f.paint.get("background-opacity");if(S!==0){var k=c.context,P=k.gl,N=c.transform,Y=N.tileSize,te=f.paint.get("background-pattern");if(!c.isPatternMissing(te)){var ye=!te&&m.a===1&&S===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass===ye){var le=Ne.disabled,xe=c.depthModeForSublayer(0,ye==="opaque"?be.ReadWrite:be.ReadOnly),ze=c.colorModeForRenderPass(),Ue=c.useProgram(te?"backgroundPattern":"background"),Je=N.coveringTiles({tileSize:Y});te&&(k.activeTexture.set(P.TEXTURE0),c.imageManager.bind(c.context));for(var Fe=f.getCrossfadeParameters(),et=0,pt=Je;et<pt.length;et+=1){var kt=pt[et],Qt=c.transform.calculatePosMatrix(kt.toUnwrapped()),Bt=te?Tc(Qt,S,c,te,{tileID:kt,tileSize:Y},Fe):qc(Qt,S,m);Ue.draw(k,P.TRIANGLES,xe,le,ze,lt.disabled,Bt,f.id,c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}}}},debug:function(c,h,f){for(var m=0;m<f.length;m++)Ap(c,h,f[m])},custom:function(c,h,f){var m=c.context,S=f.implementation;if(c.renderPass==="offscreen"){var k=S.prerender;k&&(c.setCustomLayerDefaults(),m.setColorMode(c.colorModeForRenderPass()),k.call(S,m.gl,c.transform.customLayerMatrix()),m.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),m.setColorMode(c.colorModeForRenderPass()),m.setStencilMode(Ne.disabled);var P=S.renderingMode==="3d"?new be(c.context.gl.LEQUAL,be.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,be.ReadOnly);m.setDepthMode(P),S.render(m.gl,c.transform.customLayerMatrix()),m.setDirty(),c.setBaseState(),m.bindFramebuffer.set(null)}}},bo=function(c,h){this.context=new _e(c),this.transform=h,this._tileTextures={},this.setup(),this.numSublayers=je.maxUnderzooming+je.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new js,this.gpuTimers={}};bo.prototype.resize=function(c,h){if(this.width=c*x.browser.devicePixelRatio,this.height=h*x.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var f=0,m=this.style._order;f<m.length;f+=1)this.style._layers[m[f]].resize()},bo.prototype.setup=function(){var c=this.context,h=new x.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(x.EXTENT,0),h.emplaceBack(0,x.EXTENT),h.emplaceBack(x.EXTENT,x.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(h,Fa.members),this.tileExtentSegments=x.SegmentVector.simpleSegment(0,0,4,2);var f=new x.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(x.EXTENT,0),f.emplaceBack(0,x.EXTENT),f.emplaceBack(x.EXTENT,x.EXTENT),this.debugBuffer=c.createVertexBuffer(f,Fa.members),this.debugSegments=x.SegmentVector.simpleSegment(0,0,4,5);var m=new x.StructArrayLayout4i8;m.emplaceBack(0,0,0,0),m.emplaceBack(x.EXTENT,0,x.EXTENT,0),m.emplaceBack(0,x.EXTENT,0,x.EXTENT),m.emplaceBack(x.EXTENT,x.EXTENT,x.EXTENT,x.EXTENT),this.rasterBoundsBuffer=c.createVertexBuffer(m,ft.members),this.rasterBoundsSegments=x.SegmentVector.simpleSegment(0,0,4,2);var S=new x.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(S,Fa.members),this.viewportSegments=x.SegmentVector.simpleSegment(0,0,4,2);var k=new x.StructArrayLayout1ui2;k.emplaceBack(0),k.emplaceBack(1),k.emplaceBack(3),k.emplaceBack(2),k.emplaceBack(0),this.tileBorderIndexBuffer=c.createIndexBuffer(k);var P=new x.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(P),this.emptyTexture=new x.Texture(c,{width:1,height:1,data:new Uint8Array([0,0,0,0])},c.gl.RGBA);var N=this.context.gl;this.stencilClearMode=new Ne({func:N.ALWAYS,mask:0},0,255,N.ZERO,N.ZERO,N.ZERO)},bo.prototype.clearStencil=function(){var c=this.context,h=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var f=x.create();x.ortho(f,0,this.width,this.height,0,0,1),x.scale(f,f,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(c,h.TRIANGLES,be.disabled,this.stencilClearMode,Ye.disabled,lt.disabled,Rs(f),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},bo.prototype._renderTileClippingMasks=function(c,h){if(this.currentStencilSource!==c.source&&c.isTileClipped()&&h&&h.length){this.currentStencilSource=c.source;var f=this.context,m=f.gl;this.nextStencilID+h.length>256&&this.clearStencil(),f.setColorMode(Ye.disabled),f.setDepthMode(be.disabled);var S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var k=0,P=h;k<P.length;k+=1){var N=P[k],Y=this._tileClippingMaskIDs[N.key]=this.nextStencilID++;S.draw(f,m.TRIANGLES,be.disabled,new Ne({func:m.ALWAYS,mask:0},Y,255,m.KEEP,m.KEEP,m.REPLACE),Ye.disabled,lt.disabled,Rs(N.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},bo.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var c=this.nextStencilID++,h=this.context.gl;return new Ne({func:h.NOTEQUAL,mask:255},c,255,h.KEEP,h.KEEP,h.REPLACE)},bo.prototype.stencilModeForClipping=function(c){var h=this.context.gl;return new Ne({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,h.KEEP,h.KEEP,h.REPLACE)},bo.prototype.stencilConfigForOverlap=function(c){var h,f=this.context.gl,m=c.sort(function(Y,te){return te.overscaledZ-Y.overscaledZ}),S=m[m.length-1].overscaledZ,k=m[0].overscaledZ-S+1;if(k>1){this.currentStencilSource=void 0,this.nextStencilID+k>256&&this.clearStencil();for(var P={},N=0;N<k;N++)P[N+S]=new Ne({func:f.GEQUAL,mask:255},N+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=k,[P,m]}return[(h={},h[S]=Ne.disabled,h),m]},bo.prototype.colorModeForRenderPass=function(){var c=this.context.gl;return this._showOverdrawInspector?new Ye([c.CONSTANT_COLOR,c.ONE],new x.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ye.unblended:Ye.alphaBlended},bo.prototype.depthModeForSublayer=function(c,h,f){if(!this.opaquePassEnabledForLayer())return be.disabled;var m=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new be(f||this.context.gl.LEQUAL,h,[m,m])},bo.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},bo.prototype.render=function(c,h){var f=this;this.style=c,this.options=h,this.lineAtlas=c.lineAtlas,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(x.browser.now()),this.imageManager.beginFrame();var m=this.style._order,S=this.style.sourceCaches;for(var k in S){var P=S[k];P.used&&P.prepare(this.context)}var N,Y,te={},ye={},le={};for(var xe in S){var ze=S[xe];te[xe]=ze.getVisibleCoordinates(),ye[xe]=te[xe].slice().reverse(),le[xe]=ze.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ue=0;Ue<m.length;Ue++)if(this.style._layers[m[Ue]].is3D()){this.opaquePassCutoff=Ue;break}this.renderPass="offscreen";for(var Je=0,Fe=m;Je<Fe.length;Je+=1){var et=this.style._layers[Fe[Je]];if(et.hasOffscreenPass()&&!et.isHidden(this.transform.zoom)){var pt=ye[et.source];(et.type==="custom"||pt.length)&&this.renderLayer(this,S[et.source],et,pt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?x.Color.black:x.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(c._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){var kt=this.style._layers[m[this.currentLayer]],Qt=S[kt.source],Bt=te[kt.source];this._renderTileClippingMasks(kt,Bt),this.renderLayer(this,Qt,kt,Bt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){var nr=this.style._layers[m[this.currentLayer]],Or=S[nr.source],un=(nr.type==="symbol"?le:ye)[nr.source];this._renderTileClippingMasks(nr,te[nr.source]),this.renderLayer(this,Or,nr,un)}this.options.showTileBoundaries&&(x.values(this.style._layers).forEach(function(rn){rn.source&&!rn.isHidden(f.transform.zoom)&&(rn.source!==(Y&&Y.id)&&(Y=f.style.sourceCaches[rn.source]),(!N||N.getSource().maxzoom<Y.getSource().maxzoom)&&(N=Y))}),N&&Ia.debug(this,N,N.getVisibleCoordinates())),this.options.showPadding&&function(rn){var Pn=rn.transform.padding;wp(rn,rn.transform.height-(Pn.top||0),3,Ic),wp(rn,Pn.bottom||0,3,Ef),dh(rn,Pn.left||0,3,Wh),dh(rn,rn.transform.width-(Pn.right||0),3,Cf);var ui=rn.transform.centerPoint;(function(gi,fi,_a,Dn){Ts(gi,fi-1,_a-10,2,20,Dn),Ts(gi,fi-10,_a-1,20,2,Dn)})(rn,ui.x,rn.transform.height-ui.y,ud)}(this),this.context.setDefault()},bo.prototype.renderLayer=function(c,h,f,m){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||m.length)&&(this.id=f.id,this.gpuTimingStart(f),Ia[f.type](c,h,f,m,this.style.placement.variableOffsets),this.gpuTimingEnd())},bo.prototype.gpuTimingStart=function(c){if(this.options.gpuTiming){var h=this.context.extTimerQuery,f=this.gpuTimers[c.id];f||(f=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),f.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,f.query)}},bo.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}},bo.prototype.collectGpuTimers=function(){var c=this.gpuTimers;return this.gpuTimers={},c},bo.prototype.queryGpuTimers=function(c){var h={};for(var f in c){var m=c[f],S=this.context.extTimerQuery,k=S.getQueryObjectEXT(m.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(m.query),h[f]=k}return h},bo.prototype.translatePosMatrix=function(c,h,f,m,S){if(!f[0]&&!f[1])return c;var k=S?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(k){var P=Math.sin(k),N=Math.cos(k);f=[f[0]*N-f[1]*P,f[0]*P+f[1]*N]}var Y=[S?f[0]:pa(h,f[0],this.transform.zoom),S?f[1]:pa(h,f[1],this.transform.zoom),0],te=new Float32Array(16);return x.translate(te,c,Y),te},bo.prototype.saveTileTexture=function(c){var h=this._tileTextures[c.size[0]];h?h.push(c):this._tileTextures[c.size[0]]=[c]},bo.prototype.getTileTexture=function(c){var h=this._tileTextures[c];return h&&h.length>0?h.pop():null},bo.prototype.isPatternMissing=function(c){if(!c)return!1;if(!c.from||!c.to)return!0;var h=this.imageManager.getPattern(c.from.toString()),f=this.imageManager.getPattern(c.to.toString());return!h||!f},bo.prototype.useProgram=function(c,h){this.cache=this.cache||{};var f=""+c+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[f]||(this.cache[f]=new Xc(this.context,c,Ks[c],h,_f[c],this._showOverdrawInspector)),this.cache[f]},bo.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},bo.prototype.setBaseState=function(){var c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)},bo.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=x.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new x.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},bo.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var $f=function(c,h){this.points=c,this.planes=h};$f.fromInvProjectionMatrix=function(c,h,f){var m=Math.pow(2,f),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(P){return x.transformMat4([],P,c)}).map(function(P){return x.scale$1([],P,1/P[3]/h*m)}),k=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(P){var N=x.sub([],S[P[0]],S[P[1]]),Y=x.sub([],S[P[2]],S[P[1]]),te=x.normalize([],x.cross([],N,Y)),ye=-x.dot(te,S[P[1]]);return te.concat(ye)});return new $f(S,k)};var $c=function(c,h){this.min=c,this.max=h,this.center=x.scale$2([],x.add([],this.min,this.max),.5)};$c.prototype.quadrant=function(c){for(var h=[c%2==0,c<2],f=x.clone$2(this.min),m=x.clone$2(this.max),S=0;S<h.length;S++)f[S]=h[S]?this.min[S]:this.center[S],m[S]=h[S]?this.center[S]:this.max[S];return m[2]=this.max[2],new $c(f,m)},$c.prototype.distanceX=function(c){return Math.max(Math.min(this.max[0],c[0]),this.min[0])-c[0]},$c.prototype.distanceY=function(c){return Math.max(Math.min(this.max[1],c[1]),this.min[1])-c[1]},$c.prototype.intersects=function(c){for(var h=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],f=!0,m=0;m<c.planes.length;m++){for(var S=c.planes[m],k=0,P=0;P<h.length;P++)k+=x.dot$1(S,h[P])>=0;if(k===0)return 0;k!==h.length&&(f=!1)}if(f)return 2;for(var N=0;N<3;N++){for(var Y=Number.MAX_VALUE,te=-Number.MAX_VALUE,ye=0;ye<c.points.length;ye++){var le=c.points[ye][N]-this.min[N];Y=Math.min(Y,le),te=Math.max(te,le)}if(te<0||Y>this.max[N]-this.min[N])return 0}return 1};var tl=function(c,h,f,m){if(c===void 0&&(c=0),h===void 0&&(h=0),f===void 0&&(f=0),m===void 0&&(m=0),isNaN(c)||c<0||isNaN(h)||h<0||isNaN(f)||f<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=h,this.left=f,this.right=m};tl.prototype.interpolate=function(c,h,f){return h.top!=null&&c.top!=null&&(this.top=x.number(c.top,h.top,f)),h.bottom!=null&&c.bottom!=null&&(this.bottom=x.number(c.bottom,h.bottom,f)),h.left!=null&&c.left!=null&&(this.left=x.number(c.left,h.left,f)),h.right!=null&&c.right!=null&&(this.right=x.number(c.right,h.right,f)),this},tl.prototype.getCenter=function(c,h){var f=x.clamp((this.left+c-this.right)/2,0,c),m=x.clamp((this.top+h-this.bottom)/2,0,h);return new x.Point(f,m)},tl.prototype.equals=function(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right},tl.prototype.clone=function(){return new tl(this.top,this.bottom,this.left,this.right)},tl.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var ya=function(c,h,f,m,S){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=S===void 0||S,this._minZoom=c||0,this._maxZoom=h||22,this._minPitch=f??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new x.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new tl,this._posMatrixCache={},this._alignedPosMatrixCache={}},ho={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};ya.prototype.clone=function(){var c=new ya(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return c.tileSize=this.tileSize,c.latRange=this.latRange,c.width=this.width,c.height=this.height,c._center=this._center,c.zoom=this.zoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._calcMatrices(),c},ho.minZoom.get=function(){return this._minZoom},ho.minZoom.set=function(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))},ho.maxZoom.get=function(){return this._maxZoom},ho.maxZoom.set=function(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))},ho.minPitch.get=function(){return this._minPitch},ho.minPitch.set=function(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))},ho.maxPitch.get=function(){return this._maxPitch},ho.maxPitch.set=function(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))},ho.renderWorldCopies.get=function(){return this._renderWorldCopies},ho.renderWorldCopies.set=function(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c},ho.worldSize.get=function(){return this.tileSize*this.scale},ho.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},ho.size.get=function(){return new x.Point(this.width,this.height)},ho.bearing.get=function(){return-this.angle/Math.PI*180},ho.bearing.set=function(c){var h=-x.wrap(c,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=x.create$2(),x.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},ho.pitch.get=function(){return this._pitch/Math.PI*180},ho.pitch.set=function(c){var h=x.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())},ho.fov.get=function(){return this._fov/Math.PI*180},ho.fov.set=function(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=c/180*Math.PI,this._calcMatrices())},ho.zoom.get=function(){return this._zoom},ho.zoom.set=function(c){var h=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())},ho.center.get=function(){return this._center},ho.center.set=function(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._constrain(),this._calcMatrices())},ho.padding.get=function(){return this._edgeInsets.toJSON()},ho.padding.set=function(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())},ho.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},ya.prototype.isPaddingEqual=function(c){return this._edgeInsets.equals(c)},ya.prototype.interpolatePadding=function(c,h,f){this._unmodified=!1,this._edgeInsets.interpolate(c,h,f),this._constrain(),this._calcMatrices()},ya.prototype.coveringZoomLevel=function(c){var h=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,h)},ya.prototype.getVisibleUnwrappedCoordinates=function(c){var h=[new x.UnwrappedTileID(0,c)];if(this._renderWorldCopies)for(var f=this.pointCoordinate(new x.Point(0,0)),m=this.pointCoordinate(new x.Point(this.width,0)),S=this.pointCoordinate(new x.Point(this.width,this.height)),k=this.pointCoordinate(new x.Point(0,this.height)),P=Math.floor(Math.min(f.x,m.x,S.x,k.x)),N=Math.floor(Math.max(f.x,m.x,S.x,k.x)),Y=P-1;Y<=N+1;Y++)Y!==0&&h.push(new x.UnwrappedTileID(Y,c));return h},ya.prototype.coveringTiles=function(c){var h=this.coveringZoomLevel(c),f=h;if(c.minzoom!==void 0&&h<c.minzoom)return[];c.maxzoom!==void 0&&h>c.maxzoom&&(h=c.maxzoom);var m=x.MercatorCoordinate.fromLngLat(this.center),S=Math.pow(2,h),k=[S*m.x,S*m.y,0],P=$f.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h),N=c.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(N=h);var Y=function(rn){return{aabb:new $c([rn*S,0,0],[(rn+1)*S,S,0]),zoom:0,x:0,y:0,wrap:rn,fullyVisible:!1}},te=[],ye=[],le=h,xe=c.reparseOverscaled?f:h;if(this._renderWorldCopies)for(var ze=1;ze<=3;ze++)te.push(Y(-ze)),te.push(Y(ze));for(te.push(Y(0));te.length>0;){var Ue=te.pop(),Je=Ue.x,Fe=Ue.y,et=Ue.fullyVisible;if(!et){var pt=Ue.aabb.intersects(P);if(pt===0)continue;et=pt===2}var kt=Ue.aabb.distanceX(k),Qt=Ue.aabb.distanceY(k),Bt=Math.max(Math.abs(kt),Math.abs(Qt));if(Ue.zoom===le||Bt>3+(1<<le-Ue.zoom)-2&&Ue.zoom>=N)ye.push({tileID:new x.OverscaledTileID(Ue.zoom===le?xe:Ue.zoom,Ue.wrap,Ue.zoom,Je,Fe),distanceSq:x.sqrLen([k[0]-.5-Je,k[1]-.5-Fe])});else for(var nr=0;nr<4;nr++){var Or=(Je<<1)+nr%2,un=(Fe<<1)+(nr>>1);te.push({aabb:Ue.aabb.quadrant(nr),zoom:Ue.zoom+1,x:Or,y:un,wrap:Ue.wrap,fullyVisible:et})}}return ye.sort(function(rn,Pn){return rn.distanceSq-Pn.distanceSq}).map(function(rn){return rn.tileID})},ya.prototype.resize=function(c,h){this.width=c,this.height=h,this.pixelsToGLUnits=[2/c,-2/h],this._constrain(),this._calcMatrices()},ho.unmodified.get=function(){return this._unmodified},ya.prototype.zoomScale=function(c){return Math.pow(2,c)},ya.prototype.scaleZoom=function(c){return Math.log(c)/Math.LN2},ya.prototype.project=function(c){var h=x.clamp(c.lat,-this.maxValidLatitude,this.maxValidLatitude);return new x.Point(x.mercatorXfromLng(c.lng)*this.worldSize,x.mercatorYfromLat(h)*this.worldSize)},ya.prototype.unproject=function(c){return new x.MercatorCoordinate(c.x/this.worldSize,c.y/this.worldSize).toLngLat()},ho.point.get=function(){return this.project(this.center)},ya.prototype.setLocationAtPoint=function(c,h){var f=this.pointCoordinate(h),m=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(c),k=new x.MercatorCoordinate(S.x-(f.x-m.x),S.y-(f.y-m.y));this.center=this.coordinateLocation(k),this._renderWorldCopies&&(this.center=this.center.wrap())},ya.prototype.locationPoint=function(c){return this.coordinatePoint(this.locationCoordinate(c))},ya.prototype.pointLocation=function(c){return this.coordinateLocation(this.pointCoordinate(c))},ya.prototype.locationCoordinate=function(c){return x.MercatorCoordinate.fromLngLat(c)},ya.prototype.coordinateLocation=function(c){return c.toLngLat()},ya.prototype.pointCoordinate=function(c){var h=[c.x,c.y,0,1],f=[c.x,c.y,1,1];x.transformMat4(h,h,this.pixelMatrixInverse),x.transformMat4(f,f,this.pixelMatrixInverse);var m=h[3],S=f[3],k=h[1]/m,P=f[1]/S,N=h[2]/m,Y=f[2]/S,te=N===Y?0:(0-N)/(Y-N);return new x.MercatorCoordinate(x.number(h[0]/m,f[0]/S,te)/this.worldSize,x.number(k,P,te)/this.worldSize)},ya.prototype.coordinatePoint=function(c){var h=[c.x*this.worldSize,c.y*this.worldSize,0,1];return x.transformMat4(h,h,this.pixelMatrix),new x.Point(h[0]/h[3],h[1]/h[3])},ya.prototype.getBounds=function(){return new x.LngLatBounds().extend(this.pointLocation(new x.Point(0,0))).extend(this.pointLocation(new x.Point(this.width,0))).extend(this.pointLocation(new x.Point(this.width,this.height))).extend(this.pointLocation(new x.Point(0,this.height)))},ya.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new x.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},ya.prototype.setMaxBounds=function(c){c?(this.lngRange=[c.getWest(),c.getEast()],this.latRange=[c.getSouth(),c.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},ya.prototype.calculatePosMatrix=function(c,h){h===void 0&&(h=!1);var f=c.key,m=h?this._alignedPosMatrixCache:this._posMatrixCache;if(m[f])return m[f];var S=c.canonical,k=this.worldSize/this.zoomScale(S.z),P=S.x+Math.pow(2,S.z)*c.wrap,N=x.identity(new Float64Array(16));return x.translate(N,N,[P*k,S.y*k,0]),x.scale(N,N,[k/x.EXTENT,k/x.EXTENT,1]),x.multiply(N,h?this.alignedProjMatrix:this.projMatrix,N),m[f]=new Float32Array(N),m[f]},ya.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},ya.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var c,h,f,m,S=-90,k=90,P=-180,N=180,Y=this.size,te=this._unmodified;if(this.latRange){var ye=this.latRange;S=x.mercatorYfromLat(ye[1])*this.worldSize,c=(k=x.mercatorYfromLat(ye[0])*this.worldSize)-S<Y.y?Y.y/(k-S):0}if(this.lngRange){var le=this.lngRange;P=x.mercatorXfromLng(le[0])*this.worldSize,h=(N=x.mercatorXfromLng(le[1])*this.worldSize)-P<Y.x?Y.x/(N-P):0}var xe=this.point,ze=Math.max(h||0,c||0);if(ze)return this.center=this.unproject(new x.Point(h?(N+P)/2:xe.x,c?(k+S)/2:xe.y)),this.zoom+=this.scaleZoom(ze),this._unmodified=te,void(this._constraining=!1);if(this.latRange){var Ue=xe.y,Je=Y.y/2;Ue-Je<S&&(m=S+Je),Ue+Je>k&&(m=k-Je)}if(this.lngRange){var Fe=xe.x,et=Y.x/2;Fe-et<P&&(f=P+et),Fe+et>N&&(f=N-et)}f===void 0&&m===void 0||(this.center=this.unproject(new x.Point(f!==void 0?f:xe.x,m!==void 0?m:xe.y))),this._unmodified=te,this._constraining=!1}},ya.prototype._calcMatrices=function(){if(this.height){var c=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var h=Math.PI/2+this._pitch,f=this._fov*(.5+c.y/this.height),m=Math.sin(f)*this.cameraToCenterDistance/Math.sin(x.clamp(Math.PI-h-f,.01,Math.PI-.01)),S=this.point,k=S.x,P=S.y,N=1.01*(Math.cos(Math.PI/2-this._pitch)*m+this.cameraToCenterDistance),Y=this.height/50,te=new Float64Array(16);x.perspective(te,this._fov,this.width/this.height,Y,N),te[8]=2*-c.x/this.width,te[9]=2*c.y/this.height,x.scale(te,te,[1,-1,1]),x.translate(te,te,[0,0,-this.cameraToCenterDistance]),x.rotateX(te,te,this._pitch),x.rotateZ(te,te,this.angle),x.translate(te,te,[-k,-P,0]),this.mercatorMatrix=x.scale([],te,[this.worldSize,this.worldSize,this.worldSize]),x.scale(te,te,[1,1,x.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=te,this.invProjMatrix=x.invert([],this.projMatrix);var ye=this.width%2/2,le=this.height%2/2,xe=Math.cos(this.angle),ze=Math.sin(this.angle),Ue=k-Math.round(k)+xe*ye+ze*le,Je=P-Math.round(P)+xe*le+ze*ye,Fe=new Float64Array(te);if(x.translate(Fe,Fe,[Ue>.5?Ue-1:Ue,Je>.5?Je-1:Je,0]),this.alignedProjMatrix=Fe,te=x.create(),x.scale(te,te,[this.width/2,-this.height/2,1]),x.translate(te,te,[1,-1,0]),this.labelPlaneMatrix=te,te=x.create(),x.scale(te,te,[1,-1,1]),x.translate(te,te,[-1,-1,0]),x.scale(te,te,[2/this.width,2/this.height,1]),this.glCoordMatrix=te,this.pixelMatrix=x.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(te=x.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=te,this._posMatrixCache={},this._alignedPosMatrixCache={}}},ya.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var c=this.pointCoordinate(new x.Point(0,0)),h=[c.x*this.worldSize,c.y*this.worldSize,0,1];return x.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance},ya.prototype.getCameraPoint=function(){var c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new x.Point(0,c))},ya.prototype.getCameraQueryGeometry=function(c){var h=this.getCameraPoint();if(c.length===1)return[c[0],h];for(var f=h.x,m=h.y,S=h.x,k=h.y,P=0,N=c;P<N.length;P+=1){var Y=N[P];f=Math.min(f,Y.x),m=Math.min(m,Y.y),S=Math.max(S,Y.x),k=Math.max(k,Y.y)}return[new x.Point(f,m),new x.Point(S,m),new x.Point(S,k),new x.Point(f,k),new x.Point(f,m)]},Object.defineProperties(ya.prototype,ho);var ka=function(c){var h,f,m,S;this._hashName=c&&encodeURIComponent(c),x.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(h=this._updateHashUnthrottled.bind(this),f=!1,m=null,S=function(){m=null,f&&(h(),m=setTimeout(S,300),f=!1)},function(){return f=!0,m||S(),m})};ka.prototype.addTo=function(c){return this._map=c,x.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},ka.prototype.remove=function(){return x.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},ka.prototype.getHashString=function(c){var h=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,m=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,m),k=Math.round(h.lng*S)/S,P=Math.round(h.lat*S)/S,N=this._map.getBearing(),Y=this._map.getPitch(),te="";if(te+=c?"/"+k+"/"+P+"/"+f:f+"/"+P+"/"+k,(N||Y)&&(te+="/"+Math.round(10*N)/10),Y&&(te+="/"+Math.round(Y)),this._hashName){var ye=this._hashName,le=!1,xe=x.window.location.hash.slice(1).split("&").map(function(ze){var Ue=ze.split("=")[0];return Ue===ye?(le=!0,Ue+"="+te):ze}).filter(function(ze){return ze});return le||xe.push(ye+"="+te),"#"+xe.join("&")}return"#"+te},ka.prototype._getCurrentHash=function(){var c,h=this,f=x.window.location.hash.replace("#","");return this._hashName?(f.split("&").map(function(m){return m.split("=")}).forEach(function(m){m[0]===h._hashName&&(c=m)}),(c&&c[1]||"").split("/")):f.split("/")},ka.prototype._onHashChange=function(){var c=this._getCurrentHash();if(c.length>=3&&!c.some(function(f){return isNaN(f)})){var h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(c[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:h,pitch:+(c[4]||0)}),!0}return!1},ka.prototype._updateHashUnthrottled=function(){var c=x.window.location.href.replace(/(#.+)?$/,this.getHashString());try{x.window.history.replaceState(x.window.history.state,null,c)}catch{}};var jl={linearity:.3,easing:x.bezier(0,0,.3,1)},bu=x.extend({deceleration:2500,maxSpeed:1400},jl),Pc=x.extend({deceleration:20,maxSpeed:1400},jl),rl=x.extend({deceleration:1e3,maxSpeed:360},jl),Tp=x.extend({deceleration:1e3,maxSpeed:90},jl),Sf=function(c){this._map=c,this.clear()};function Kf(c,h){(!c.duration||c.duration<h.duration)&&(c.duration=h.duration,c.easing=h.easing)}function lc(c,h,f){var m=f.maxSpeed,S=f.linearity,k=f.deceleration,P=x.clamp(c*S/(h/1e3),-m,m),N=Math.abs(P)/(k*S);return{easing:f.easing,duration:1e3*N,amount:P*(N/2)}}Sf.prototype.clear=function(){this._inertiaBuffer=[]},Sf.prototype.record=function(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:x.browser.now(),settings:c})},Sf.prototype._drainInertiaBuffer=function(){for(var c=this._inertiaBuffer,h=x.browser.now();c.length>0&&h-c[0].time>160;)c.shift()},Sf.prototype._onMoveEnd=function(c){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var h={zoom:0,bearing:0,pitch:0,pan:new x.Point(0,0),pinchAround:void 0,around:void 0},f=0,m=this._inertiaBuffer;f<m.length;f+=1){var S=m[f].settings;h.zoom+=S.zoomDelta||0,h.bearing+=S.bearingDelta||0,h.pitch+=S.pitchDelta||0,S.panDelta&&h.pan._add(S.panDelta),S.around&&(h.around=S.around),S.pinchAround&&(h.pinchAround=S.pinchAround)}var k=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(h.pan.mag()){var N=lc(h.pan.mag(),k,x.extend({},bu,c||{}));P.offset=h.pan.mult(N.amount/h.pan.mag()),P.center=this._map.transform.center,Kf(P,N)}if(h.zoom){var Y=lc(h.zoom,k,Pc);P.zoom=this._map.transform.zoom+Y.amount,Kf(P,Y)}if(h.bearing){var te=lc(h.bearing,k,rl);P.bearing=this._map.transform.bearing+x.clamp(te.amount,-179,179),Kf(P,te)}if(h.pitch){var ye=lc(h.pitch,k,Tp);P.pitch=this._map.transform.pitch+ye.amount,Kf(P,ye)}if(P.zoom||P.bearing){var le=h.pinchAround===void 0?h.around:h.pinchAround;P.around=le?this._map.unproject(le):this._map.getCenter()}return this.clear(),x.extend(P,{noMoveStart:!0})}};var us=function(c){function h(m,S,k,P){P===void 0&&(P={});var N=tt.mousePos(S.getCanvasContainer(),k),Y=S.unproject(N);c.call(this,m,x.extend({point:N,lngLat:Y,originalEvent:k},P)),this._defaultPrevented=!1,this.target=S}c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h;var f={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,f),h}(x.Event),Sl=function(c){function h(m,S,k){var P=m==="touchend"?k.changedTouches:k.touches,N=tt.touchPos(S.getCanvasContainer(),P),Y=N.map(function(le){return S.unproject(le)}),te=N.reduce(function(le,xe,ze,Ue){return le.add(xe.div(Ue.length))},new x.Point(0,0)),ye=S.unproject(te);c.call(this,m,{points:N,point:te,lngLats:Y,lngLat:ye,originalEvent:k}),this._defaultPrevented=!1}c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h;var f={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,f),h}(x.Event),vh=function(c){function h(m,S,k){c.call(this,m,{originalEvent:k}),this._defaultPrevented=!1}c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h;var f={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,f),h}(x.Event),Vo=function(c,h){this._map=c,this._clickTolerance=h.clickTolerance};Vo.prototype.reset=function(){delete this._mousedownPos},Vo.prototype.wheel=function(c){return this._firePreventable(new vh(c.type,this._map,c))},Vo.prototype.mousedown=function(c,h){return this._mousedownPos=h,this._firePreventable(new us(c.type,this._map,c))},Vo.prototype.mouseup=function(c){this._map.fire(new us(c.type,this._map,c))},Vo.prototype.click=function(c,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new us(c.type,this._map,c))},Vo.prototype.dblclick=function(c){return this._firePreventable(new us(c.type,this._map,c))},Vo.prototype.mouseover=function(c){this._map.fire(new us(c.type,this._map,c))},Vo.prototype.mouseout=function(c){this._map.fire(new us(c.type,this._map,c))},Vo.prototype.touchstart=function(c){return this._firePreventable(new Sl(c.type,this._map,c))},Vo.prototype.touchmove=function(c){this._map.fire(new Sl(c.type,this._map,c))},Vo.prototype.touchend=function(c){this._map.fire(new Sl(c.type,this._map,c))},Vo.prototype.touchcancel=function(c){this._map.fire(new Sl(c.type,this._map,c))},Vo.prototype._firePreventable=function(c){if(this._map.fire(c),c.defaultPrevented)return{}},Vo.prototype.isEnabled=function(){return!0},Vo.prototype.isActive=function(){return!1},Vo.prototype.enable=function(){},Vo.prototype.disable=function(){};var tn=function(c){this._map=c};tn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},tn.prototype.mousemove=function(c){this._map.fire(new us(c.type,this._map,c))},tn.prototype.mousedown=function(){this._delayContextMenu=!0},tn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new us("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},tn.prototype.contextmenu=function(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new us(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()},tn.prototype.isEnabled=function(){return!0},tn.prototype.isActive=function(){return!1},tn.prototype.enable=function(){},tn.prototype.disable=function(){};var Xo=function(c,h){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=h.clickTolerance||1};function Lc(c,h){for(var f={},m=0;m<c.length;m++)f[c[m].identifier]=h[m];return f}Xo.prototype.isEnabled=function(){return!!this._enabled},Xo.prototype.isActive=function(){return!!this._active},Xo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Xo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Xo.prototype.mousedown=function(c,h){this.isEnabled()&&c.shiftKey&&c.button===0&&(tt.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)},Xo.prototype.mousemoveWindow=function(c,h){if(this._active){var f=h;if(!(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)){var m=this._startPos;this._lastPos=f,this._box||(this._box=tt.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));var S=Math.min(m.x,f.x),k=Math.max(m.x,f.x),P=Math.min(m.y,f.y),N=Math.max(m.y,f.y);tt.setTransform(this._box,"translate("+S+"px,"+P+"px)"),this._box.style.width=k-S+"px",this._box.style.height=N-P+"px"}}},Xo.prototype.mouseupWindow=function(c,h){var f=this;if(this._active&&c.button===0){var m=this._startPos,S=h;if(this.reset(),tt.suppressClick(),m.x!==S.x||m.y!==S.y)return this._map.fire(new x.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:function(k){return k.fitScreenCoordinates(m,S,f._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",c)}},Xo.prototype.keydown=function(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))},Xo.prototype.blur=function(){this.reset()},Xo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(tt.remove(this._box),this._box=null),tt.enableDrag(),delete this._startPos,delete this._lastPos},Xo.prototype._fireEvent=function(c,h){return this._map.fire(new x.Event(c,{originalEvent:h}))};var Kc=function(c){this.reset(),this.numTouches=c.numTouches};Kc.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Kc.prototype.touchstart=function(c,h,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=c.timeStamp),f.length===this.numTouches&&(this.centroid=function(m){for(var S=new x.Point(0,0),k=0,P=m;k<P.length;k+=1)S._add(P[k]);return S.div(m.length)}(h),this.touches=Lc(f,h)))},Kc.prototype.touchmove=function(c,h,f){if(!this.aborted&&this.centroid){var m=Lc(f,h);for(var S in this.touches){var k=m[S];(!k||k.dist(this.touches[S])>30)&&(this.aborted=!0)}}},Kc.prototype.touchend=function(c,h,f){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){var m=!this.aborted&&this.centroid;if(this.reset(),m)return m}};var Wu=function(c){this.singleTap=new Kc(c),this.numTaps=c.numTaps,this.reset()};Wu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Wu.prototype.touchstart=function(c,h,f){this.singleTap.touchstart(c,h,f)},Wu.prototype.touchmove=function(c,h,f){this.singleTap.touchmove(c,h,f)},Wu.prototype.touchend=function(c,h,f){var m=this.singleTap.touchend(c,h,f);if(m){var S=c.timeStamp-this.lastTime<500,k=!this.lastTap||this.lastTap.dist(m)<30;if(S&&k||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}};var Lu=function(){this._zoomIn=new Wu({numTouches:1,numTaps:2}),this._zoomOut=new Wu({numTouches:2,numTaps:1}),this.reset()};Lu.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Lu.prototype.touchstart=function(c,h,f){this._zoomIn.touchstart(c,h,f),this._zoomOut.touchstart(c,h,f)},Lu.prototype.touchmove=function(c,h,f){this._zoomIn.touchmove(c,h,f),this._zoomOut.touchmove(c,h,f)},Lu.prototype.touchend=function(c,h,f){var m=this,S=this._zoomIn.touchend(c,h,f),k=this._zoomOut.touchend(c,h,f);return S?(this._active=!0,c.preventDefault(),setTimeout(function(){return m.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(S)},{originalEvent:c})}}):k?(this._active=!0,c.preventDefault(),setTimeout(function(){return m.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(k)},{originalEvent:c})}}):void 0},Lu.prototype.touchcancel=function(){this.reset()},Lu.prototype.enable=function(){this._enabled=!0},Lu.prototype.disable=function(){this._enabled=!1,this.reset()},Lu.prototype.isEnabled=function(){return this._enabled},Lu.prototype.isActive=function(){return this._active};var Gl={0:1,2:2},mn=function(c){this.reset(),this._clickTolerance=c.clickTolerance||1};mn.prototype.blur=function(){this.reset()},mn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},mn.prototype._correctButton=function(c,h){return!1},mn.prototype._move=function(c,h){return{}},mn.prototype.mousedown=function(c,h){if(!this._lastPoint){var f=tt.mouseButton(c);this._correctButton(c,f)&&(this._lastPoint=h,this._eventButton=f)}},mn.prototype.mousemoveWindow=function(c,h){var f=this._lastPoint;if(f){if(c.preventDefault(),function(m,S){var k=Gl[S];return m.buttons===void 0||(m.buttons&k)!==k}(c,this._eventButton))this.reset();else if(this._moved||!(h.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(f,h)}},mn.prototype.mouseupWindow=function(c){this._lastPoint&&tt.mouseButton(c)===this._eventButton&&(this._moved&&tt.suppressClick(),this.reset())},mn.prototype.enable=function(){this._enabled=!0},mn.prototype.disable=function(){this._enabled=!1,this.reset()},mn.prototype.isEnabled=function(){return this._enabled},mn.prototype.isActive=function(){return this._active};var wf=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.mousedown=function(f,m){c.prototype.mousedown.call(this,f,m),this._lastPoint&&(this._active=!0)},h.prototype._correctButton=function(f,m){return m===0&&!f.ctrlKey},h.prototype._move=function(f,m){return{around:m,panDelta:m.sub(f)}},h}(mn),Sa=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype._correctButton=function(f,m){return m===0&&f.ctrlKey||m===2},h.prototype._move=function(f,m){var S=.8*(m.x-f.x);if(S)return this._active=!0,{bearingDelta:S}},h.prototype.contextmenu=function(f){f.preventDefault()},h}(mn),Hl=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype._correctButton=function(f,m){return m===0&&f.ctrlKey||m===2},h.prototype._move=function(f,m){var S=-.5*(m.y-f.y);if(S)return this._active=!0,{pitchDelta:S}},h.prototype.contextmenu=function(f){f.preventDefault()},h}(mn),po=function(c){this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset()};po.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new x.Point(0,0)},po.prototype.touchstart=function(c,h,f){return this._calculateTransform(c,h,f)},po.prototype.touchmove=function(c,h,f){if(this._active&&!(f.length<this._minTouches))return c.preventDefault(),this._calculateTransform(c,h,f)},po.prototype.touchend=function(c,h,f){this._calculateTransform(c,h,f),this._active&&f.length<this._minTouches&&this.reset()},po.prototype.touchcancel=function(){this.reset()},po.prototype._calculateTransform=function(c,h,f){f.length>0&&(this._active=!0);var m=Lc(f,h),S=new x.Point(0,0),k=new x.Point(0,0),P=0;for(var N in m){var Y=m[N],te=this._touches[N];te&&(S._add(Y),k._add(Y.sub(te)),P++,m[N]=Y)}if(this._touches=m,!(P<this._minTouches)&&k.mag()){var ye=k.div(P);if(this._sum._add(ye),!(this._sum.mag()<this._clickTolerance))return{around:S.div(P),panDelta:ye}}},po.prototype.enable=function(){this._enabled=!0},po.prototype.disable=function(){this._enabled=!1,this.reset()},po.prototype.isEnabled=function(){return this._enabled},po.prototype.isActive=function(){return this._active};var fu=function(){this.reset()};function Qc(c,h,f){for(var m=0;m<c.length;m++)if(c[m].identifier===f)return h[m]}function wl(c,h){return Math.log(c/h)/Math.LN2}fu.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},fu.prototype._start=function(c){},fu.prototype._move=function(c,h,f){return{}},fu.prototype.touchstart=function(c,h,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([h[0],h[1]]))},fu.prototype.touchmove=function(c,h,f){if(this._firstTwoTouches){c.preventDefault();var m=this._firstTwoTouches,S=m[1],k=Qc(f,h,m[0]),P=Qc(f,h,S);if(k&&P){var N=this._aroundCenter?null:k.add(P).div(2);return this._move([k,P],N,c)}}},fu.prototype.touchend=function(c,h,f){if(this._firstTwoTouches){var m=this._firstTwoTouches,S=m[1],k=Qc(f,h,m[0]),P=Qc(f,h,S);k&&P||(this._active&&tt.suppressClick(),this.reset())}},fu.prototype.touchcancel=function(){this.reset()},fu.prototype.enable=function(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"},fu.prototype.disable=function(){this._enabled=!1,this.reset()},fu.prototype.isEnabled=function(){return this._enabled},fu.prototype.isActive=function(){return this._active};var Eu=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.reset=function(){c.prototype.reset.call(this),delete this._distance,delete this._startDistance},h.prototype._start=function(f){this._startDistance=this._distance=f[0].dist(f[1])},h.prototype._move=function(f,m){var S=this._distance;if(this._distance=f[0].dist(f[1]),this._active||!(Math.abs(wl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:wl(this._distance,S),pinchAround:m}},h}(fu);function zn(c,h){return 180*c.angleWith(h)/Math.PI}var Mp=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.reset=function(){c.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},h.prototype._start=function(f){this._startVector=this._vector=f[0].sub(f[1]),this._minDiameter=f[0].dist(f[1])},h.prototype._move=function(f,m){var S=this._vector;if(this._vector=f[0].sub(f[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:zn(this._vector,S),pinchAround:m}},h.prototype._isBelowThreshold=function(f){this._minDiameter=Math.min(this._minDiameter,f.mag());var m=25/(Math.PI*this._minDiameter)*360,S=zn(f,this._startVector);return Math.abs(S)<m},h}(fu);function Qf(c){return Math.abs(c.y)>Math.abs(c.x)}var ld=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.reset=function(){c.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},h.prototype._start=function(f){this._lastPoints=f,Qf(f[0].sub(f[1]))&&(this._valid=!1)},h.prototype._move=function(f,m,S){var k=f[0].sub(this._lastPoints[0]),P=f[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(k,P,S.timeStamp),this._valid)return this._lastPoints=f,this._active=!0,{pitchDelta:(k.y+P.y)/2*-.5}},h.prototype.gestureBeginsVertically=function(f,m,S){if(this._valid!==void 0)return this._valid;var k=f.mag()>=2,P=m.mag()>=2;if(k||P){if(!k||!P)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;var N=f.y>0==m.y>0;return Qf(f)&&Qf(m)&&N}},h}(fu),Xh={panStep:100,bearingStep:15,pitchStep:10},nl=function(){var c=Xh;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1};function Os(c){return c*(2-c)}nl.prototype.blur=function(){this.reset()},nl.prototype.reset=function(){this._active=!1},nl.prototype.keydown=function(c){var h=this;if(!(c.altKey||c.ctrlKey||c.metaKey)){var f=0,m=0,S=0,k=0,P=0;switch(c.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:c.shiftKey?m=-1:(c.preventDefault(),k=-1);break;case 39:c.shiftKey?m=1:(c.preventDefault(),k=1);break;case 38:c.shiftKey?S=1:(c.preventDefault(),P=-1);break;case 40:c.shiftKey?S=-1:(c.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(m=0,S=0),{cameraAnimation:function(N){var Y=N.getZoom();N.easeTo({duration:300,easeId:"keyboardHandler",easing:Os,zoom:f?Math.round(Y)+f*(c.shiftKey?2:1):Y,bearing:N.getBearing()+m*h._bearingStep,pitch:N.getPitch()+S*h._pitchStep,offset:[-k*h._panStep,-P*h._panStep],center:N.getCenter()},{originalEvent:c})}}}},nl.prototype.enable=function(){this._enabled=!0},nl.prototype.disable=function(){this._enabled=!1,this.reset()},nl.prototype.isEnabled=function(){return this._enabled},nl.prototype.isActive=function(){return this._active},nl.prototype.disableRotation=function(){this._rotationDisabled=!0},nl.prototype.enableRotation=function(){this._rotationDisabled=!1};var aa=function(c,h){this._map=c,this._el=c.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,x.bindAll(["_onTimeout"],this)};aa.prototype.setZoomRate=function(c){this._defaultZoomRate=c},aa.prototype.setWheelZoomRate=function(c){this._wheelZoomRate=c},aa.prototype.isEnabled=function(){return!!this._enabled},aa.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},aa.prototype.isZooming=function(){return!!this._zooming},aa.prototype.enable=function(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=c&&c.around==="center")},aa.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},aa.prototype.wheel=function(c){if(this.isEnabled()){var h=c.deltaMode===x.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY,f=x.browser.now(),m=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,h!==0&&h%4.000244140625==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(m*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),c.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=c,this._delta-=h,this._active||this._start(c)),c.preventDefault()}},aa.prototype._onTimeout=function(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},aa.prototype._start=function(c){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var h=tt.mousePos(this._el,c);this._around=x.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},aa.prototype.renderFrame=function(){var c=this;if(this._frameId&&(this._frameId=null,this.isActive())){var h=this._map.transform;if(this._delta!==0){var f=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,m=2/(1+Math.exp(-Math.abs(this._delta*f)));this._delta<0&&m!==0&&(m=1/m);var S=typeof this._targetZoom=="number"?h.zoomScale(this._targetZoom):h.scale;this._targetZoom=Math.min(h.maxZoom,Math.max(h.minZoom,h.scaleZoom(S*m))),this._type==="wheel"&&(this._startZoom=h.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var k,P=typeof this._targetZoom=="number"?this._targetZoom:h.zoom,N=this._startZoom,Y=this._easing,te=!1;if(this._type==="wheel"&&N&&Y){var ye=Math.min((x.browser.now()-this._lastWheelEventTime)/200,1),le=Y(ye);k=x.number(N,P,le),ye<1?this._frameId||(this._frameId=!0):te=!0}else k=P,te=!0;return this._active=!0,te&&(this._active=!1,this._finishTimeout=setTimeout(function(){c._zooming=!1,c._handler._triggerRenderFrame(),delete c._targetZoom,delete c._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!te,zoomDelta:k-h.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},aa.prototype._smoothOutEasing=function(c){var h=x.ease;if(this._prevEase){var f=this._prevEase,m=(x.browser.now()-f.start)/f.duration,S=f.easing(m+.01)-f.easing(m),k=.27/Math.sqrt(S*S+1e-4)*.01,P=Math.sqrt(.0729-k*k);h=x.bezier(k,P,.25,1)}return this._prevEase={start:x.browser.now(),duration:c,easing:h},h},aa.prototype.blur=function(){this.reset()},aa.prototype.reset=function(){this._active=!1};var il=function(c,h){this._clickZoom=c,this._tapZoom=h};il.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},il.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},il.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},il.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Gs=function(){this.reset()};Gs.prototype.reset=function(){this._active=!1},Gs.prototype.blur=function(){this.reset()},Gs.prototype.dblclick=function(c,h){return c.preventDefault(),{cameraAnimation:function(f){f.easeTo({duration:300,zoom:f.getZoom()+(c.shiftKey?-1:1),around:f.unproject(h)},{originalEvent:c})}}},Gs.prototype.enable=function(){this._enabled=!0},Gs.prototype.disable=function(){this._enabled=!1,this.reset()},Gs.prototype.isEnabled=function(){return this._enabled},Gs.prototype.isActive=function(){return this._active};var Qs=function(){this._tap=new Wu({numTouches:1,numTaps:1}),this.reset()};Qs.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Qs.prototype.touchstart=function(c,h,f){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=h[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(c,h,f))},Qs.prototype.touchmove=function(c,h,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;var m=h[0],S=m.y-this._swipePoint.y;return this._swipePoint=m,c.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(c,h,f)},Qs.prototype.touchend=function(c,h,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(c,h,f)&&(this._tapTime=c.timeStamp)},Qs.prototype.touchcancel=function(){this.reset()},Qs.prototype.enable=function(){this._enabled=!0},Qs.prototype.disable=function(){this._enabled=!1,this.reset()},Qs.prototype.isEnabled=function(){return this._enabled},Qs.prototype.isActive=function(){return this._active};var cc=function(c,h,f){this._el=c,this._mousePan=h,this._touchPan=f};cc.prototype.enable=function(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},cc.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},cc.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},cc.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Jc=function(c,h,f){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=h,this._mousePitch=f};Jc.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Jc.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Jc.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Jc.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var al=function(c,h,f,m){this._el=c,this._touchZoom=h,this._touchRotate=f,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0};al.prototype.enable=function(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},al.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},al.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},al.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},al.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},al.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Hs=function(c){return c.zoom||c.drag||c.pitch||c.rotate},Al=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h}(x.Event);function ci(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}var ti=function(c,h){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Sf(c),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),x.bindAll(["handleEvent","handleWindowEvent"],this);var f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[x.window.document,"mousemove",{capture:!0}],[x.window.document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[x.window,"blur",void 0]];for(var m=0,S=this._listeners;m<S.length;m+=1){var k=S[m],P=k[0];tt.addEventListener(P,k[1],P===x.window.document?this.handleWindowEvent:this.handleEvent,k[2])}};ti.prototype.destroy=function(){for(var c=0,h=this._listeners;c<h.length;c+=1){var f=h[c],m=f[0];tt.removeEventListener(m,f[1],m===x.window.document?this.handleWindowEvent:this.handleEvent,f[2])}},ti.prototype._addDefaultHandlers=function(c){var h=this._map,f=h.getCanvasContainer();this._add("mapEvent",new Vo(h,c));var m=h.boxZoom=new Xo(h,c);this._add("boxZoom",m);var S=new Lu,k=new Gs;h.doubleClickZoom=new il(k,S),this._add("tapZoom",S),this._add("clickZoom",k);var P=new Qs;this._add("tapDragZoom",P);var N=h.touchPitch=new ld;this._add("touchPitch",N);var Y=new Sa(c),te=new Hl(c);h.dragRotate=new Jc(c,Y,te),this._add("mouseRotate",Y,["mousePitch"]),this._add("mousePitch",te,["mouseRotate"]);var ye=new wf(c),le=new po(c);h.dragPan=new cc(f,ye,le),this._add("mousePan",ye),this._add("touchPan",le,["touchZoom","touchRotate"]);var xe=new Mp,ze=new Eu;h.touchZoomRotate=new al(f,ze,xe,P),this._add("touchRotate",xe,["touchPan","touchZoom"]),this._add("touchZoom",ze,["touchPan","touchRotate"]);var Ue=h.scrollZoom=new aa(h,this);this._add("scrollZoom",Ue,["mousePan"]);var Je=h.keyboard=new nl;this._add("keyboard",Je),this._add("blockableMapEvent",new tn(h));for(var Fe=0,et=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Fe<et.length;Fe+=1){var pt=et[Fe];c.interactive&&c[pt]&&h[pt].enable(c[pt])}},ti.prototype._add=function(c,h,f){this._handlers.push({handlerName:c,handler:h,allowed:f}),this._handlersById[c]=h},ti.prototype.stop=function(c){if(!this._updatingCamera){for(var h=0,f=this._handlers;h<f.length;h+=1)f[h].handler.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}},ti.prototype.isActive=function(){for(var c=0,h=this._handlers;c<h.length;c+=1)if(h[c].handler.isActive())return!0;return!1},ti.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},ti.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},ti.prototype.isMoving=function(){return Boolean(Hs(this._eventsInProgress))||this.isZooming()},ti.prototype._blockedByActive=function(c,h,f){for(var m in c)if(m!==f&&(!h||h.indexOf(m)<0))return!0;return!1},ti.prototype.handleWindowEvent=function(c){this.handleEvent(c,c.type+"Window")},ti.prototype._getMapTouches=function(c){for(var h=[],f=0,m=c;f<m.length;f+=1){var S=m[f];this._el.contains(S.target)&&h.push(S)}return h},ti.prototype.handleEvent=function(c,h){this._updatingCamera=!0;for(var f=c.type==="renderFrame"?void 0:c,m={needsRenderFrame:!1},S={},k={},P=c.touches?this._getMapTouches(c.touches):void 0,N=P?tt.touchPos(this._el,P):tt.mousePos(this._el,c),Y=0,te=this._handlers;Y<te.length;Y+=1){var ye=te[Y],le=ye.handlerName,xe=ye.handler,ze=ye.allowed;if(xe.isEnabled()){var Ue=void 0;this._blockedByActive(k,ze,le)?xe.reset():xe[h||c.type]&&(Ue=xe[h||c.type](c,N,P),this.mergeHandlerResult(m,S,Ue,le,f),Ue&&Ue.needsRenderFrame&&this._triggerRenderFrame()),(Ue||xe.isActive())&&(k[le]=xe)}}var Je={};for(var Fe in this._previousActiveHandlers)k[Fe]||(Je[Fe]=f);this._previousActiveHandlers=k,(Object.keys(Je).length||ci(m))&&(this._changes.push([m,S,Je]),this._triggerRenderFrame()),(Object.keys(k).length||ci(m))&&this._map._stop(!0),this._updatingCamera=!1;var et=m.cameraAnimation;et&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],et(this._map))},ti.prototype.mergeHandlerResult=function(c,h,f,m,S){if(f){x.extend(c,f);var k={handlerName:m,originalEvent:f.originalEvent||S};f.zoomDelta!==void 0&&(h.zoom=k),f.panDelta!==void 0&&(h.drag=k),f.pitchDelta!==void 0&&(h.pitch=k),f.bearingDelta!==void 0&&(h.rotate=k)}},ti.prototype._applyChanges=function(){for(var c={},h={},f={},m=0,S=this._changes;m<S.length;m+=1){var k=S[m],P=k[0],N=k[1],Y=k[2];P.panDelta&&(c.panDelta=(c.panDelta||new x.Point(0,0))._add(P.panDelta)),P.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+P.pitchDelta),P.around!==void 0&&(c.around=P.around),P.pinchAround!==void 0&&(c.pinchAround=P.pinchAround),P.noInertia&&(c.noInertia=P.noInertia),x.extend(h,N),x.extend(f,Y)}this._updateMapTransform(c,h,f),this._changes=[]},ti.prototype._updateMapTransform=function(c,h,f){var m=this._map,S=m.transform;if(!ci(c))return this._fireEvents(h,f,!0);var k=c.panDelta,P=c.zoomDelta,N=c.bearingDelta,Y=c.pitchDelta,te=c.around,ye=c.pinchAround;ye!==void 0&&(te=ye),m._stop(!0),te=te||m.transform.centerPoint;var le=S.pointLocation(k?te.sub(k):te);N&&(S.bearing+=N),Y&&(S.pitch+=Y),P&&(S.zoom+=P),S.setLocationAtPoint(le,te),this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(h,f,!0)},ti.prototype._fireEvents=function(c,h,f){var m=this,S=Hs(this._eventsInProgress),k=Hs(c),P={};for(var N in c)this._eventsInProgress[N]||(P[N+"start"]=c[N].originalEvent),this._eventsInProgress[N]=c[N];for(var Y in!S&&k&&this._fireEvent("movestart",k.originalEvent),P)this._fireEvent(Y,P[Y]);for(var te in k&&this._fireEvent("move",k.originalEvent),c)this._fireEvent(te,c[te].originalEvent);var ye,le={};for(var xe in this._eventsInProgress){var ze=this._eventsInProgress[xe],Ue=ze.handlerName,Je=ze.originalEvent;this._handlersById[Ue].isActive()||(delete this._eventsInProgress[xe],le[xe+"end"]=ye=h[Ue]||Je)}for(var Fe in le)this._fireEvent(Fe,le[Fe]);var et=Hs(this._eventsInProgress);if(f&&(S||k)&&!et){this._updatingCamera=!0;var pt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),kt=function(Qt){return Qt!==0&&-m._bearingSnap<Qt&&Qt<m._bearingSnap};pt?(kt(pt.bearing||this._map.getBearing())&&(pt.bearing=0),this._map.easeTo(pt,{originalEvent:ye})):(this._map.fire(new x.Event("moveend",{originalEvent:ye})),kt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},ti.prototype._fireEvent=function(c,h){this._map.fire(new x.Event(c,h?{originalEvent:h}:{}))},ti.prototype._requestFrame=function(){var c=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(h){delete c._frameId,c.handleEvent(new Al("renderFrame",{timeStamp:h})),c._applyChanges()})},ti.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var mh=function(c){function h(f,m){c.call(this),this._moving=!1,this._zooming=!1,this.transform=f,this._bearingSnap=m.bearingSnap,x.bindAll(["_renderFrameCallback"],this)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getCenter=function(){return new x.LngLat(this.transform.center.lng,this.transform.center.lat)},h.prototype.setCenter=function(f,m){return this.jumpTo({center:f},m)},h.prototype.panBy=function(f,m,S){return f=x.Point.convert(f).mult(-1),this.panTo(this.transform.center,x.extend({offset:f},m),S)},h.prototype.panTo=function(f,m,S){return this.easeTo(x.extend({center:f},m),S)},h.prototype.getZoom=function(){return this.transform.zoom},h.prototype.setZoom=function(f,m){return this.jumpTo({zoom:f},m),this},h.prototype.zoomTo=function(f,m,S){return this.easeTo(x.extend({zoom:f},m),S)},h.prototype.zoomIn=function(f,m){return this.zoomTo(this.getZoom()+1,f,m),this},h.prototype.zoomOut=function(f,m){return this.zoomTo(this.getZoom()-1,f,m),this},h.prototype.getBearing=function(){return this.transform.bearing},h.prototype.setBearing=function(f,m){return this.jumpTo({bearing:f},m),this},h.prototype.getPadding=function(){return this.transform.padding},h.prototype.setPadding=function(f,m){return this.jumpTo({padding:f},m),this},h.prototype.rotateTo=function(f,m,S){return this.easeTo(x.extend({bearing:f},m),S)},h.prototype.resetNorth=function(f,m){return this.rotateTo(0,x.extend({duration:1e3},f),m),this},h.prototype.resetNorthPitch=function(f,m){return this.easeTo(x.extend({bearing:0,pitch:0,duration:1e3},f),m),this},h.prototype.snapToNorth=function(f,m){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(f,m):this},h.prototype.getPitch=function(){return this.transform.pitch},h.prototype.setPitch=function(f,m){return this.jumpTo({pitch:f},m),this},h.prototype.cameraForBounds=function(f,m){f=x.LngLatBounds.convert(f);var S=m&&m.bearing||0;return this._cameraForBoxAndBearing(f.getNorthWest(),f.getSouthEast(),S,m)},h.prototype._cameraForBoxAndBearing=function(f,m,S,k){var P={top:0,bottom:0,right:0,left:0};if(typeof(k=x.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},k)).padding=="number"){var N=k.padding;k.padding={top:N,bottom:N,right:N,left:N}}k.padding=x.extend(P,k.padding);var Y=this.transform,te=Y.padding,ye=Y.project(x.LngLat.convert(f)),le=Y.project(x.LngLat.convert(m)),xe=ye.rotate(-S*Math.PI/180),ze=le.rotate(-S*Math.PI/180),Ue=new x.Point(Math.max(xe.x,ze.x),Math.max(xe.y,ze.y)),Je=new x.Point(Math.min(xe.x,ze.x),Math.min(xe.y,ze.y)),Fe=Ue.sub(Je),et=(Y.width-(te.left+te.right+k.padding.left+k.padding.right))/Fe.x,pt=(Y.height-(te.top+te.bottom+k.padding.top+k.padding.bottom))/Fe.y;if(!(pt<0||et<0)){var kt=Math.min(Y.scaleZoom(Y.scale*Math.min(et,pt)),k.maxZoom),Qt=typeof k.offset.x=="number"?new x.Point(k.offset.x,k.offset.y):x.Point.convert(k.offset),Bt=new x.Point((k.padding.left-k.padding.right)/2,(k.padding.top-k.padding.bottom)/2).rotate(S*Math.PI/180),nr=Qt.add(Bt).mult(Y.scale/Y.zoomScale(kt));return{center:Y.unproject(ye.add(le).div(2).sub(nr)),zoom:kt,bearing:S}}x.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},h.prototype.fitBounds=function(f,m,S){return this._fitInternal(this.cameraForBounds(f,m),m,S)},h.prototype.fitScreenCoordinates=function(f,m,S,k,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(x.Point.convert(f)),this.transform.pointLocation(x.Point.convert(m)),S,k),k,P)},h.prototype._fitInternal=function(f,m,S){return f?(delete(m=x.extend(f,m)).padding,m.linear?this.easeTo(m,S):this.flyTo(m,S)):this},h.prototype.jumpTo=function(f,m){this.stop();var S=this.transform,k=!1,P=!1,N=!1;return"zoom"in f&&S.zoom!==+f.zoom&&(k=!0,S.zoom=+f.zoom),f.center!==void 0&&(S.center=x.LngLat.convert(f.center)),"bearing"in f&&S.bearing!==+f.bearing&&(P=!0,S.bearing=+f.bearing),"pitch"in f&&S.pitch!==+f.pitch&&(N=!0,S.pitch=+f.pitch),f.padding==null||S.isPaddingEqual(f.padding)||(S.padding=f.padding),this.fire(new x.Event("movestart",m)).fire(new x.Event("move",m)),k&&this.fire(new x.Event("zoomstart",m)).fire(new x.Event("zoom",m)).fire(new x.Event("zoomend",m)),P&&this.fire(new x.Event("rotatestart",m)).fire(new x.Event("rotate",m)).fire(new x.Event("rotateend",m)),N&&this.fire(new x.Event("pitchstart",m)).fire(new x.Event("pitch",m)).fire(new x.Event("pitchend",m)),this.fire(new x.Event("moveend",m))},h.prototype.easeTo=function(f,m){var S=this;this._stop(!1,f.easeId),((f=x.extend({offset:[0,0],duration:500,easing:x.ease},f)).animate===!1||!f.essential&&x.browser.prefersReducedMotion)&&(f.duration=0);var k=this.transform,P=this.getZoom(),N=this.getBearing(),Y=this.getPitch(),te=this.getPadding(),ye="zoom"in f?+f.zoom:P,le="bearing"in f?this._normalizeBearing(f.bearing,N):N,xe="pitch"in f?+f.pitch:Y,ze="padding"in f?f.padding:k.padding,Ue=x.Point.convert(f.offset),Je=k.centerPoint.add(Ue),Fe=k.pointLocation(Je),et=x.LngLat.convert(f.center||Fe);this._normalizeCenter(et);var pt,kt,Qt=k.project(Fe),Bt=k.project(et).sub(Qt),nr=k.zoomScale(ye-P);f.around&&(pt=x.LngLat.convert(f.around),kt=k.locationPoint(pt));var Or={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ye!==P,this._rotating=this._rotating||N!==le,this._pitching=this._pitching||xe!==Y,this._padding=!k.isPaddingEqual(ze),this._easeId=f.easeId,this._prepareEase(m,f.noMoveStart,Or),this._ease(function(un){if(S._zooming&&(k.zoom=x.number(P,ye,un)),S._rotating&&(k.bearing=x.number(N,le,un)),S._pitching&&(k.pitch=x.number(Y,xe,un)),S._padding&&(k.interpolatePadding(te,ze,un),Je=k.centerPoint.add(Ue)),pt)k.setLocationAtPoint(pt,kt);else{var rn=k.zoomScale(k.zoom-P),Pn=ye>P?Math.min(2,nr):Math.max(.5,nr),ui=Math.pow(Pn,1-un),gi=k.unproject(Qt.add(Bt.mult(un*ui)).mult(rn));k.setLocationAtPoint(k.renderWorldCopies?gi.wrap():gi,Je)}S._fireMoveEvents(m)},function(un){S._afterEase(m,un)},f),this},h.prototype._prepareEase=function(f,m,S){S===void 0&&(S={}),this._moving=!0,m||S.moving||this.fire(new x.Event("movestart",f)),this._zooming&&!S.zooming&&this.fire(new x.Event("zoomstart",f)),this._rotating&&!S.rotating&&this.fire(new x.Event("rotatestart",f)),this._pitching&&!S.pitching&&this.fire(new x.Event("pitchstart",f))},h.prototype._fireMoveEvents=function(f){this.fire(new x.Event("move",f)),this._zooming&&this.fire(new x.Event("zoom",f)),this._rotating&&this.fire(new x.Event("rotate",f)),this._pitching&&this.fire(new x.Event("pitch",f))},h.prototype._afterEase=function(f,m){if(!this._easeId||!m||this._easeId!==m){delete this._easeId;var S=this._zooming,k=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new x.Event("zoomend",f)),k&&this.fire(new x.Event("rotateend",f)),P&&this.fire(new x.Event("pitchend",f)),this.fire(new x.Event("moveend",f))}},h.prototype.flyTo=function(f,m){var S=this;if(!f.essential&&x.browser.prefersReducedMotion){var k=x.pick(f,["center","zoom","bearing","pitch","around"]);return this.jumpTo(k,m)}this.stop(),f=x.extend({offset:[0,0],speed:1.2,curve:1.42,easing:x.ease},f);var P=this.transform,N=this.getZoom(),Y=this.getBearing(),te=this.getPitch(),ye=this.getPadding(),le="zoom"in f?x.clamp(+f.zoom,P.minZoom,P.maxZoom):N,xe="bearing"in f?this._normalizeBearing(f.bearing,Y):Y,ze="pitch"in f?+f.pitch:te,Ue="padding"in f?f.padding:P.padding,Je=P.zoomScale(le-N),Fe=x.Point.convert(f.offset),et=P.centerPoint.add(Fe),pt=P.pointLocation(et),kt=x.LngLat.convert(f.center||pt);this._normalizeCenter(kt);var Qt=P.project(pt),Bt=P.project(kt).sub(Qt),nr=f.curve,Or=Math.max(P.width,P.height),un=Or/Je,rn=Bt.mag();if("minZoom"in f){var Pn=x.clamp(Math.min(f.minZoom,N,le),P.minZoom,P.maxZoom),ui=Or/P.zoomScale(Pn-N);nr=Math.sqrt(ui/rn*2)}var gi=nr*nr;function fi(Ci){var Si=(un*un-Or*Or+(Ci?-1:1)*gi*gi*rn*rn)/(2*(Ci?un:Or)*gi*rn);return Math.log(Math.sqrt(Si*Si+1)-Si)}function _a(Ci){return(Math.exp(Ci)-Math.exp(-Ci))/2}function Dn(Ci){return(Math.exp(Ci)+Math.exp(-Ci))/2}var Ii=fi(0),Wi=function(Ci){return Dn(Ii)/Dn(Ii+nr*Ci)},Bi=function(Ci){return Or*((Dn(Ii)*(_a(Si=Ii+nr*Ci)/Dn(Si))-_a(Ii))/gi)/rn;var Si},wi=(fi(1)-Ii)/nr;if(Math.abs(rn)<1e-6||!isFinite(wi)){if(Math.abs(Or-un)<1e-6)return this.easeTo(f,m);var Ki=un<Or?-1:1;wi=Math.abs(Math.log(un/Or))/nr,Bi=function(){return 0},Wi=function(Ci){return Math.exp(Ki*nr*Ci)}}return f.duration="duration"in f?+f.duration:1e3*wi/("screenSpeed"in f?+f.screenSpeed/nr:+f.speed),f.maxDuration&&f.duration>f.maxDuration&&(f.duration=0),this._zooming=!0,this._rotating=Y!==xe,this._pitching=ze!==te,this._padding=!P.isPaddingEqual(Ue),this._prepareEase(m,!1),this._ease(function(Ci){var Si=Ci*wi,gs=1/Wi(Si);P.zoom=Ci===1?le:N+P.scaleZoom(gs),S._rotating&&(P.bearing=x.number(Y,xe,Ci)),S._pitching&&(P.pitch=x.number(te,ze,Ci)),S._padding&&(P.interpolatePadding(ye,Ue,Ci),et=P.centerPoint.add(Fe));var qo=Ci===1?kt:P.unproject(Qt.add(Bt.mult(Bi(Si))).mult(gs));P.setLocationAtPoint(P.renderWorldCopies?qo.wrap():qo,et),S._fireMoveEvents(m)},function(){return S._afterEase(m)},f),this},h.prototype.isEasing=function(){return!!this._easeFrameId},h.prototype.stop=function(){return this._stop()},h.prototype._stop=function(f,m){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,m)}if(!f){var k=this.handlers;k&&k.stop(!1)}return this},h.prototype._ease=function(f,m,S){S.animate===!1||S.duration===0?(f(1),m()):(this._easeStart=x.browser.now(),this._easeOptions=S,this._onEaseFrame=f,this._onEaseEnd=m,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},h.prototype._renderFrameCallback=function(){var f=Math.min((x.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},h.prototype._normalizeBearing=function(f,m){f=x.wrap(f,-180,180);var S=Math.abs(f-m);return Math.abs(f-360-m)<S&&(f-=360),Math.abs(f+360-m)<S&&(f+=360),f},h.prototype._normalizeCenter=function(f){var m=this.transform;if(m.renderWorldCopies&&!m.lngRange){var S=f.lng-m.center.lng;f.lng+=S>180?-360:S<-180?360:0}},h}(x.Evented),Fs=function(c){c===void 0&&(c={}),this.options=c,x.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Fs.prototype.getDefaultPosition=function(){return"bottom-right"},Fs.prototype.onAdd=function(c){var h=this.options&&this.options.compact;return this._map=c,this._container=tt.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=tt.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=tt.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Fs.prototype.onRemove=function(){tt.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Fs.prototype._setElementTitle=function(c,h){var f=this._map._getUIString("AttributionControl."+h);c.title=f,c.setAttribute("aria-label",f)},Fs.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Fs.prototype._updateEditLink=function(){var c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));var h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||x.config.ACCESS_TOKEN}];if(c){var f=h.reduce(function(m,S,k){return S.value&&(m+=S.key+"="+S.value+(k<h.length-1?"&":"")),m},"?");c.href=x.config.FEEDBACK_URL+"/"+f+(this._map._hash?this._map._hash.getHashString(!0):""),c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}},Fs.prototype._updateData=function(c){!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Fs.prototype._updateAttributions=function(){if(this._map.style){var c=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=c.concat(this.options.customAttribution.map(function(N){return typeof N!="string"?"":N})):typeof this.options.customAttribution=="string"&&c.push(this.options.customAttribution)),this._map.style.stylesheet){var h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}var f=this._map.style.sourceCaches;for(var m in f){var S=f[m];if(S.used){var k=S.getSource();k.attribution&&c.indexOf(k.attribution)<0&&c.push(k.attribution)}}c.sort(function(N,Y){return N.length-Y.length});var P=(c=c.filter(function(N,Y){for(var te=Y+1;te<c.length;te++)if(c[te].indexOf(N)>=0)return!1;return!0})).join(" | ");P!==this._attribHTML&&(this._attribHTML=P,c.length?(this._innerContainer.innerHTML=P,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Fs.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Ru=function(){x.bindAll(["_updateLogo"],this),x.bindAll(["_updateCompact"],this)};Ru.prototype.onAdd=function(c){this._map=c,this._container=tt.create("div","mapboxgl-ctrl");var h=tt.create("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Ru.prototype.onRemove=function(){tt.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Ru.prototype.getDefaultPosition=function(){return"bottom-left"},Ru.prototype._updateLogo=function(c){c&&c.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Ru.prototype._logoRequired=function(){if(this._map.style){var c=this._map.style.sourceCaches;for(var h in c)if(c[h].getSource().mapbox_logo)return!0;return!1}},Ru.prototype._updateCompact=function(){var c=this._container.children;if(c.length){var h=c[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}};var Yo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Yo.prototype.add=function(c){var h=++this._id;return this._queue.push({callback:c,id:h,cancelled:!1}),h},Yo.prototype.remove=function(c){for(var h=this._currentlyRunning,f=0,m=h?this._queue.concat(h):this._queue;f<m.length;f+=1){var S=m[f];if(S.id===c)return void(S.cancelled=!0)}},Yo.prototype.run=function(c){c===void 0&&(c=0);var h=this._currentlyRunning=this._queue;this._queue=[];for(var f=0,m=h;f<m.length;f+=1){var S=m[f];if(!S.cancelled&&(S.callback(c),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Yo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Tl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Jf=x.window.HTMLImageElement,Yh=x.window.HTMLElement,Na=x.window.ImageBitmap,io={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},kp=function(c){function h(m){var S=this;if((m=x.extend({},io,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var k=new ya(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies);if(c.call(this,k,m),this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new Yo,this._controls=[],this._mapId=x.uniqueId(),this._locale=x.extend({},Tl,m.locale),this._clickTolerance=m.clickTolerance,this._requestManager=new x.RequestManager(m.transformRequest,m.accessToken),typeof m.container=="string"){if(this._container=x.window.document.getElementById(m.container),!this._container)throw new Error("Container '"+m.container+"' not found.")}else{if(!(m.container instanceof Yh))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),x.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return S._update(!1)}),this.on("moveend",function(){return S._update(!1)}),this.on("zoom",function(){return S._update(!0)}),x.window!==void 0&&(x.window.addEventListener("online",this._onWindowOnline,!1),x.window.addEventListener("resize",this._onWindowResize,!1),x.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new ti(this,m),this._hash=m.hash&&new ka(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,x.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new Fs({customAttribution:m.customAttribution})),this.addControl(new Ru,m.logoPosition),this.on("style.load",function(){S.transform.unmodified&&S.jumpTo(S.style.stylesheet)}),this.on("data",function(P){S._update(P.dataType==="style"),S.fire(new x.Event(P.dataType+"data",P))}),this.on("dataloading",function(P){S.fire(new x.Event(P.dataType+"dataloading",P))})}c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h;var f={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return h.prototype._getMapId=function(){return this._mapId},h.prototype.addControl=function(m,S){if(S===void 0&&(S=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new x.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var k=m.onAdd(this);this._controls.push(m);var P=this._controlPositions[S];return S.indexOf("bottom")!==-1?P.insertBefore(k,P.firstChild):P.appendChild(k),this},h.prototype.removeControl=function(m){if(!m||!m.onRemove)return this.fire(new x.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var S=this._controls.indexOf(m);return S>-1&&this._controls.splice(S,1),m.onRemove(this),this},h.prototype.hasControl=function(m){return this._controls.indexOf(m)>-1},h.prototype.resize=function(m){var S=this._containerDimensions(),k=S[0],P=S[1];if(k===this.transform.width&&P===this.transform.height)return this;this._resizeCanvas(k,P),this.transform.resize(k,P),this.painter.resize(k,P);var N=!this._moving;return N&&this.fire(new x.Event("movestart",m)).fire(new x.Event("move",m)),this.fire(new x.Event("resize",m)),N&&this.fire(new x.Event("moveend",m)),this},h.prototype.getBounds=function(){return this.transform.getBounds()},h.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},h.prototype.setMaxBounds=function(m){return this.transform.setMaxBounds(x.LngLatBounds.convert(m)),this._update()},h.prototype.setMinZoom=function(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},h.prototype.getMinZoom=function(){return this.transform.minZoom},h.prototype.setMaxZoom=function(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")},h.prototype.getMaxZoom=function(){return this.transform.maxZoom},h.prototype.setMinPitch=function(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},h.prototype.getMinPitch=function(){return this.transform.minPitch},h.prototype.setMaxPitch=function(m){if((m=m??60)>60)throw new Error("maxPitch must be less than or equal to 60");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")},h.prototype.getMaxPitch=function(){return this.transform.maxPitch},h.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},h.prototype.setRenderWorldCopies=function(m){return this.transform.renderWorldCopies=m,this._update()},h.prototype.project=function(m){return this.transform.locationPoint(x.LngLat.convert(m))},h.prototype.unproject=function(m){return this.transform.pointLocation(x.Point.convert(m))},h.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},h.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},h.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},h.prototype._createDelegatedListener=function(m,S,k){var P,N=this;if(m==="mouseenter"||m==="mouseover"){var Y=!1;return{layer:S,listener:k,delegates:{mousemove:function(ye){var le=N.getLayer(S)?N.queryRenderedFeatures(ye.point,{layers:[S]}):[];le.length?Y||(Y=!0,k.call(N,new us(m,N,ye.originalEvent,{features:le}))):Y=!1},mouseout:function(){Y=!1}}}}if(m==="mouseleave"||m==="mouseout"){var te=!1;return{layer:S,listener:k,delegates:{mousemove:function(ye){(N.getLayer(S)?N.queryRenderedFeatures(ye.point,{layers:[S]}):[]).length?te=!0:te&&(te=!1,k.call(N,new us(m,N,ye.originalEvent)))},mouseout:function(ye){te&&(te=!1,k.call(N,new us(m,N,ye.originalEvent)))}}}}return{layer:S,listener:k,delegates:(P={},P[m]=function(ye){var le=N.getLayer(S)?N.queryRenderedFeatures(ye.point,{layers:[S]}):[];le.length&&(ye.features=le,k.call(N,ye),delete ye.features)},P)}},h.prototype.on=function(m,S,k){if(k===void 0)return c.prototype.on.call(this,m,S);var P=this._createDelegatedListener(m,S,k);for(var N in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(P),P.delegates)this.on(N,P.delegates[N]);return this},h.prototype.once=function(m,S,k){if(k===void 0)return c.prototype.once.call(this,m,S);var P=this._createDelegatedListener(m,S,k);for(var N in P.delegates)this.once(N,P.delegates[N]);return this},h.prototype.off=function(m,S,k){var P=this;return k===void 0?c.prototype.off.call(this,m,S):(this._delegatedListeners&&this._delegatedListeners[m]&&function(N){for(var Y=N[m],te=0;te<Y.length;te++){var ye=Y[te];if(ye.layer===S&&ye.listener===k){for(var le in ye.delegates)P.off(le,ye.delegates[le]);return Y.splice(te,1),P}}}(this._delegatedListeners),this)},h.prototype.queryRenderedFeatures=function(m,S){if(!this.style)return[];var k;if(S!==void 0||m===void 0||m instanceof x.Point||Array.isArray(m)||(S=m,m=void 0),S=S||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof x.Point||typeof m[0]=="number")k=[x.Point.convert(m)];else{var P=x.Point.convert(m[0]),N=x.Point.convert(m[1]);k=[P,new x.Point(N.x,P.y),N,new x.Point(P.x,N.y),P]}return this.style.queryRenderedFeatures(k,S,this.transform)},h.prototype.querySourceFeatures=function(m,S){return this.style.querySourceFeatures(m,S)},h.prototype.setStyle=function(m,S){return(S=x.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},S)).diff!==!1&&S.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,S),this):(this._localIdeographFontFamily=S.localIdeographFontFamily,this._updateStyle(m,S))},h.prototype._getUIString=function(m){var S=this._locale[m];if(S==null)throw new Error("Missing UI string '"+m+"'");return S},h.prototype._updateStyle=function(m,S){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new Zo(this,S||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)},h.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Zo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},h.prototype._diffStyle=function(m,S){var k=this;if(typeof m=="string"){var P=this._requestManager.normalizeStyleURL(m),N=this._requestManager.transformRequest(P,x.ResourceType.Style);x.getJSON(N,function(Y,te){Y?k.fire(new x.ErrorEvent(Y)):te&&k._updateDiff(te,S)})}else typeof m=="object"&&this._updateDiff(m,S)},h.prototype._updateDiff=function(m,S){try{this.style.setState(m)&&this._update(!0)}catch(k){x.warnOnce("Unable to perform style diff: "+(k.message||k.error||k)+".  Rebuilding the style from scratch."),this._updateStyle(m,S)}},h.prototype.getStyle=function(){if(this.style)return this.style.serialize()},h.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():x.warnOnce("There is no style added to the map.")},h.prototype.addSource=function(m,S){return this._lazyInitEmptyStyle(),this.style.addSource(m,S),this._update(!0)},h.prototype.isSourceLoaded=function(m){var S=this.style&&this.style.sourceCaches[m];if(S!==void 0)return S.loaded();this.fire(new x.ErrorEvent(new Error("There is no source with ID '"+m+"'")))},h.prototype.areTilesLoaded=function(){var m=this.style&&this.style.sourceCaches;for(var S in m){var k=m[S]._tiles;for(var P in k){var N=k[P];if(N.state!=="loaded"&&N.state!=="errored")return!1}}return!0},h.prototype.addSourceType=function(m,S,k){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,S,k)},h.prototype.removeSource=function(m){return this.style.removeSource(m),this._update(!0)},h.prototype.getSource=function(m){return this.style.getSource(m)},h.prototype.addImage=function(m,S,k){k===void 0&&(k={});var P=k.pixelRatio;P===void 0&&(P=1);var N=k.sdf;N===void 0&&(N=!1);var Y=k.stretchX,te=k.stretchY,ye=k.content;if(this._lazyInitEmptyStyle(),S instanceof Jf||Na&&S instanceof Na){var le=x.browser.getImageData(S);this.style.addImage(m,{data:new x.RGBAImage({width:le.width,height:le.height},le.data),pixelRatio:P,stretchX:Y,stretchY:te,content:ye,sdf:N,version:0})}else{if(S.width===void 0||S.height===void 0)return this.fire(new x.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var xe=S;this.style.addImage(m,{data:new x.RGBAImage({width:S.width,height:S.height},new Uint8Array(S.data)),pixelRatio:P,stretchX:Y,stretchY:te,content:ye,sdf:N,version:0,userImage:xe}),xe.onAdd&&xe.onAdd(this,m)}},h.prototype.updateImage=function(m,S){var k=this.style.getImage(m);if(!k)return this.fire(new x.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var P=S instanceof Jf||Na&&S instanceof Na?x.browser.getImageData(S):S,N=P.width,Y=P.height,te=P.data;return N===void 0||Y===void 0?this.fire(new x.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):N!==k.data.width||Y!==k.data.height?this.fire(new x.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(k.data.replace(te,!(S instanceof Jf||Na&&S instanceof Na)),void this.style.updateImage(m,k))},h.prototype.hasImage=function(m){return m?!!this.style.getImage(m):(this.fire(new x.ErrorEvent(new Error("Missing required image id"))),!1)},h.prototype.removeImage=function(m){this.style.removeImage(m)},h.prototype.loadImage=function(m,S){x.getImage(this._requestManager.transformRequest(m,x.ResourceType.Image),S)},h.prototype.listImages=function(){return this.style.listImages()},h.prototype.addLayer=function(m,S){return this._lazyInitEmptyStyle(),this.style.addLayer(m,S),this._update(!0)},h.prototype.moveLayer=function(m,S){return this.style.moveLayer(m,S),this._update(!0)},h.prototype.removeLayer=function(m){return this.style.removeLayer(m),this._update(!0)},h.prototype.getLayer=function(m){return this.style.getLayer(m)},h.prototype.setLayerZoomRange=function(m,S,k){return this.style.setLayerZoomRange(m,S,k),this._update(!0)},h.prototype.setFilter=function(m,S,k){return k===void 0&&(k={}),this.style.setFilter(m,S,k),this._update(!0)},h.prototype.getFilter=function(m){return this.style.getFilter(m)},h.prototype.setPaintProperty=function(m,S,k,P){return P===void 0&&(P={}),this.style.setPaintProperty(m,S,k,P),this._update(!0)},h.prototype.getPaintProperty=function(m,S){return this.style.getPaintProperty(m,S)},h.prototype.setLayoutProperty=function(m,S,k,P){return P===void 0&&(P={}),this.style.setLayoutProperty(m,S,k,P),this._update(!0)},h.prototype.getLayoutProperty=function(m,S){return this.style.getLayoutProperty(m,S)},h.prototype.setLight=function(m,S){return S===void 0&&(S={}),this._lazyInitEmptyStyle(),this.style.setLight(m,S),this._update(!0)},h.prototype.getLight=function(){return this.style.getLight()},h.prototype.setFeatureState=function(m,S){return this.style.setFeatureState(m,S),this._update()},h.prototype.removeFeatureState=function(m,S){return this.style.removeFeatureState(m,S),this._update()},h.prototype.getFeatureState=function(m){return this.style.getFeatureState(m)},h.prototype.getContainer=function(){return this._container},h.prototype.getCanvasContainer=function(){return this._canvasContainer},h.prototype.getCanvas=function(){return this._canvas},h.prototype._containerDimensions=function(){var m=0,S=0;return this._container&&(m=this._container.clientWidth||400,S=this._container.clientHeight||300),[m,S]},h.prototype._detectMissingCSS=function(){x.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&x.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},h.prototype._setupContainer=function(){var m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=tt.create("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();var S=this._canvasContainer=tt.create("div","mapboxgl-canvas-container",m);this._interactive&&S.classList.add("mapboxgl-interactive"),this._canvas=tt.create("canvas","mapboxgl-canvas",S),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var k=this._containerDimensions();this._resizeCanvas(k[0],k[1]);var P=this._controlContainer=tt.create("div","mapboxgl-control-container",m),N=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(Y){N[Y]=tt.create("div","mapboxgl-ctrl-"+Y,P)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},h.prototype._resizeCanvas=function(m,S){var k=x.browser.devicePixelRatio||1;this._canvas.width=k*m,this._canvas.height=k*S,this._canvas.style.width=m+"px",this._canvas.style.height=S+"px"},h.prototype._setupPainter=function(){var m=x.extend({},Jr.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),S=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);S?(this.painter=new bo(S,this.transform),x.webpSupported.testSupport(S)):this.fire(new x.ErrorEvent(new Error("Failed to initialize WebGL")))},h.prototype._contextLost=function(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new x.Event("webglcontextlost",{originalEvent:m}))},h.prototype._contextRestored=function(m){this._setupPainter(),this.resize(),this._update(),this.fire(new x.Event("webglcontextrestored",{originalEvent:m}))},h.prototype._onMapScroll=function(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},h.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},h.prototype._update=function(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this},h.prototype._requestRenderFrame=function(m){return this._update(),this._renderTaskQueue.add(m)},h.prototype._cancelRenderFrame=function(m){this._renderTaskQueue.remove(m)},h.prototype._render=function(m){var S,k=this,P=0,N=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(S=N.createQueryEXT(),N.beginQueryEXT(N.TIME_ELAPSED_EXT,S),P=x.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),!this._removed){var Y=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var te=this.transform.zoom,ye=x.browser.now();this.style.zoomHistory.update(te,ye);var le=new x.EvaluationParameters(te,{now:ye,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),xe=le.crossFadingFactor();xe===1&&xe===this._crossFadingFactor||(Y=!0,this._crossFadingFactor=xe),this.style.update(le)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new x.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new x.Event("load"))),this.style&&(this.style.hasTransitions()||Y)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var ze=x.browser.now()-P;N.endQueryEXT(N.TIME_ELAPSED_EXT,S),setTimeout(function(){var Fe=N.getQueryObjectEXT(S,N.QUERY_RESULT_EXT)/1e6;N.deleteQueryEXT(S),k.fire(new x.Event("gpu-timing-frame",{cpuTime:ze,gpuTime:Fe}))},50)}if(this.listens("gpu-timing-layer")){var Ue=this.painter.collectGpuTimers();setTimeout(function(){var Fe=k.painter.queryGpuTimers(Ue);k.fire(new x.Event("gpu-timing-layer",{layerTimes:Fe}))},50)}var Je=this._sourcesDirty||this._styleDirty||this._placementDirty;return Je||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new x.Event("idle")),!this._loaded||this._fullyLoaded||Je||(this._fullyLoaded=!0),this}},h.prototype.remove=function(){this._hash&&this._hash.remove();for(var m=0,S=this._controls;m<S.length;m+=1)S[m].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),x.window!==void 0&&(x.window.removeEventListener("resize",this._onWindowResize,!1),x.window.removeEventListener("orientationchange",this._onWindowResize,!1),x.window.removeEventListener("online",this._onWindowOnline,!1));var k=this.painter.context.gl.getExtension("WEBGL_lose_context");k&&k.loseContext(),Af(this._canvasContainer),Af(this._controlContainer),Af(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new x.Event("remove"))},h.prototype.triggerRepaint=function(){var m=this;this.style&&!this._frame&&(this._frame=x.browser.frame(function(S){m._frame=null,m._render(S)}))},h.prototype._onWindowOnline=function(){this._update()},h.prototype._onWindowResize=function(m){this._trackResize&&this.resize({originalEvent:m})._update()},f.showTileBoundaries.get=function(){return!!this._showTileBoundaries},f.showTileBoundaries.set=function(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())},f.showPadding.get=function(){return!!this._showPadding},f.showPadding.set=function(m){this._showPadding!==m&&(this._showPadding=m,this._update())},f.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},f.showCollisionBoxes.set=function(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())},f.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},f.showOverdrawInspector.set=function(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())},f.repaint.get=function(){return!!this._repaint},f.repaint.set=function(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())},f.vertices.get=function(){return!!this._vertices},f.vertices.set=function(m){this._vertices=m,this._update()},h.prototype._setCacheLimits=function(m,S){x.setCacheLimits(m,S)},f.version.get=function(){return x.version},Object.defineProperties(h.prototype,f),h}(mh);function Af(c){c.parentNode&&c.parentNode.removeChild(c)}var Ml={showCompass:!0,showZoom:!0,visualizePitch:!1},kl=function(c){var h=this;this.options=x.extend({},Ml,c),this._container=tt.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(f){return f.preventDefault()}),this.options.showZoom&&(x.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(f){return h._map.zoomIn({},{originalEvent:f})}),tt.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(f){return h._map.zoomOut({},{originalEvent:f})}),tt.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(x.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(f){h.options.visualizePitch?h._map.resetNorthPitch({},{originalEvent:f}):h._map.resetNorth({},{originalEvent:f})}),this._compassIcon=tt.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};kl.prototype._updateZoomButtons=function(){var c=this._map.getZoom(),h=c===this._map.getMaxZoom(),f=c===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},kl.prototype._rotateCompassArrow=function(){var c=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=c},kl.prototype.onAdd=function(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new za(this._map,this._compass,this.options.visualizePitch)),this._container},kl.prototype.onRemove=function(){tt.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},kl.prototype._createButton=function(c,h){var f=tt.create("button",c,this._container);return f.type="button",f.addEventListener("click",h),f},kl.prototype._setButtonTitle=function(c,h){var f=this._map._getUIString("NavigationControl."+h);c.title=f,c.setAttribute("aria-label",f)};var za=function(c,h,f){f===void 0&&(f=!1),this._clickTolerance=10,this.element=h,this.mouseRotate=new Sa({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,f&&(this.mousePitch=new Hl({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),x.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),tt.addEventListener(h,"mousedown",this.mousedown),tt.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),tt.addEventListener(h,"touchmove",this.touchmove),tt.addEventListener(h,"touchend",this.touchend),tt.addEventListener(h,"touchcancel",this.reset)};function Il(c,h,f){if(c=new x.LngLat(c.lng,c.lat),h){var m=new x.LngLat(c.lng-360,c.lat),S=new x.LngLat(c.lng+360,c.lat),k=f.locationPoint(c).distSqr(h);f.locationPoint(m).distSqr(h)<k?c=m:f.locationPoint(S).distSqr(h)<k&&(c=S)}for(;Math.abs(c.lng-f.center.lng)>180;){var P=f.locationPoint(c);if(P.x>=0&&P.y>=0&&P.x<=f.width&&P.y<=f.height)break;c.lng>f.center.lng?c.lng-=360:c.lng+=360}return c}za.prototype.down=function(c,h){this.mouseRotate.mousedown(c,h),this.mousePitch&&this.mousePitch.mousedown(c,h),tt.disableDrag()},za.prototype.move=function(c,h){var f=this.map,m=this.mouseRotate.mousemoveWindow(c,h);if(m&&m.bearingDelta&&f.setBearing(f.getBearing()+m.bearingDelta),this.mousePitch){var S=this.mousePitch.mousemoveWindow(c,h);S&&S.pitchDelta&&f.setPitch(f.getPitch()+S.pitchDelta)}},za.prototype.off=function(){var c=this.element;tt.removeEventListener(c,"mousedown",this.mousedown),tt.removeEventListener(c,"touchstart",this.touchstart,{passive:!1}),tt.removeEventListener(c,"touchmove",this.touchmove),tt.removeEventListener(c,"touchend",this.touchend),tt.removeEventListener(c,"touchcancel",this.reset),this.offTemp()},za.prototype.offTemp=function(){tt.enableDrag(),tt.removeEventListener(x.window,"mousemove",this.mousemove),tt.removeEventListener(x.window,"mouseup",this.mouseup)},za.prototype.mousedown=function(c){this.down(x.extend({},c,{ctrlKey:!0,preventDefault:function(){return c.preventDefault()}}),tt.mousePos(this.element,c)),tt.addEventListener(x.window,"mousemove",this.mousemove),tt.addEventListener(x.window,"mouseup",this.mouseup)},za.prototype.mousemove=function(c){this.move(c,tt.mousePos(this.element,c))},za.prototype.mouseup=function(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()},za.prototype.touchstart=function(c){c.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=tt.touchPos(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return c.preventDefault()}},this._startPos))},za.prototype.touchmove=function(c){c.targetTouches.length!==1?this.reset():(this._lastPos=tt.touchPos(this.element,c.targetTouches)[0],this.move({preventDefault:function(){return c.preventDefault()}},this._lastPos))},za.prototype.touchend=function(c){c.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},za.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var fc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function qh(c,h,f){var m=c.classList;for(var S in fc)m.remove("mapboxgl-"+f+"-anchor-"+S);m.add("mapboxgl-"+f+"-anchor-"+h)}var Rc,gh=function(c){function h(f,m){if(c.call(this),(f instanceof x.window.HTMLElement||m)&&(f=x.extend({element:f},m)),x.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=f&&f.anchor||"center",this._color=f&&f.color||"#3FB1CE",this._scale=f&&f.scale||1,this._draggable=f&&f.draggable||!1,this._clickTolerance=f&&f.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=f&&f.rotation||0,this._rotationAlignment=f&&f.rotationAlignment||"auto",this._pitchAlignment=f&&f.pitchAlignment&&f.pitchAlignment!=="auto"?f.pitchAlignment:this._rotationAlignment,f&&f.element)this._element=f.element,this._offset=x.Point.convert(f&&f.offset||[0,0]);else{this._defaultMarker=!0,this._element=tt.create("div"),this._element.setAttribute("aria-label","Map marker");var S=tt.createNS("http://www.w3.org/2000/svg","svg");S.setAttributeNS(null,"display","block"),S.setAttributeNS(null,"height","41px"),S.setAttributeNS(null,"width","27px"),S.setAttributeNS(null,"viewBox","0 0 27 41");var k=tt.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"stroke","none"),k.setAttributeNS(null,"stroke-width","1"),k.setAttributeNS(null,"fill","none"),k.setAttributeNS(null,"fill-rule","evenodd");var P=tt.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");var N=tt.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(3.0, 29.0)"),N.setAttributeNS(null,"fill","#000000");for(var Y=0,te=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];Y<te.length;Y+=1){var ye=te[Y],le=tt.createNS("http://www.w3.org/2000/svg","ellipse");le.setAttributeNS(null,"opacity","0.04"),le.setAttributeNS(null,"cx","10.5"),le.setAttributeNS(null,"cy","5.80029008"),le.setAttributeNS(null,"rx",ye.rx),le.setAttributeNS(null,"ry",ye.ry),N.appendChild(le)}var xe=tt.createNS("http://www.w3.org/2000/svg","g");xe.setAttributeNS(null,"fill",this._color);var ze=tt.createNS("http://www.w3.org/2000/svg","path");ze.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),xe.appendChild(ze);var Ue=tt.createNS("http://www.w3.org/2000/svg","g");Ue.setAttributeNS(null,"opacity","0.25"),Ue.setAttributeNS(null,"fill","#000000");var Je=tt.createNS("http://www.w3.org/2000/svg","path");Je.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ue.appendChild(Je);var Fe=tt.createNS("http://www.w3.org/2000/svg","g");Fe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Fe.setAttributeNS(null,"fill","#FFFFFF");var et=tt.createNS("http://www.w3.org/2000/svg","g");et.setAttributeNS(null,"transform","translate(8.0, 8.0)");var pt=tt.createNS("http://www.w3.org/2000/svg","circle");pt.setAttributeNS(null,"fill","#000000"),pt.setAttributeNS(null,"opacity","0.25"),pt.setAttributeNS(null,"cx","5.5"),pt.setAttributeNS(null,"cy","5.5"),pt.setAttributeNS(null,"r","5.4999962");var kt=tt.createNS("http://www.w3.org/2000/svg","circle");kt.setAttributeNS(null,"fill","#FFFFFF"),kt.setAttributeNS(null,"cx","5.5"),kt.setAttributeNS(null,"cy","5.5"),kt.setAttributeNS(null,"r","5.4999962"),et.appendChild(pt),et.appendChild(kt),P.appendChild(N),P.appendChild(xe),P.appendChild(Ue),P.appendChild(Fe),P.appendChild(et),S.appendChild(P),S.setAttributeNS(null,"height",41*this._scale+"px"),S.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(S),this._offset=x.Point.convert(f&&f.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Qt){Qt.preventDefault()}),this._element.addEventListener("mousedown",function(Qt){Qt.preventDefault()}),qh(this._element,this._anchor,"marker"),this._popup=null}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.addTo=function(f){return this.remove(),this._map=f,f.getCanvasContainer().appendChild(this._element),f.on("move",this._update),f.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},h.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),tt.remove(this._element),this._popup&&this._popup.remove(),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(f){return this._lngLat=x.LngLat.convert(f),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},h.prototype.getElement=function(){return this._element},h.prototype.setPopup=function(f){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),f){if(!("offset"in f.options)){var m=Math.sqrt(Math.pow(13.5,2)/2);f.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(24.6+m)],"bottom-right":[-m,-1*(24.6+m)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=f,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},h.prototype._onKeyPress=function(f){var m=f.code,S=f.charCode||f.keyCode;m!=="Space"&&m!=="Enter"&&S!==32&&S!==13||this.togglePopup()},h.prototype._onMapClick=function(f){var m=f.originalEvent.target,S=this._element;this._popup&&(m===S||S.contains(m))&&this.togglePopup()},h.prototype.getPopup=function(){return this._popup},h.prototype.togglePopup=function(){var f=this._popup;return f?(f.isOpen()?f.remove():f.addTo(this._map),this):this},h.prototype._update=function(f){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Il(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(m="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S="rotateX("+this._map.getPitch()+"deg)"),f&&f.type!=="moveend"||(this._pos=this._pos.round()),tt.setTransform(this._element,fc[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+S+" "+m)}},h.prototype.getOffset=function(){return this._offset},h.prototype.setOffset=function(f){return this._offset=x.Point.convert(f),this._update(),this},h.prototype._onMove=function(f){if(!this._isDragging){var m=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new x.Event("dragstart"))),this.fire(new x.Event("drag")))},h.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new x.Event("dragend")),this._state="inactive"},h.prototype._addDragHandler=function(f){this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},h.prototype.setDraggable=function(f){return this._draggable=!!f,this._map&&(f?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},h.prototype.isDraggable=function(){return this._draggable},h.prototype.setRotation=function(f){return this._rotation=f||0,this._update(),this},h.prototype.getRotation=function(){return this._rotation},h.prototype.setRotationAlignment=function(f){return this._rotationAlignment=f||"auto",this._update(),this},h.prototype.getRotationAlignment=function(){return this._rotationAlignment},h.prototype.setPitchAlignment=function(f){return this._pitchAlignment=f&&f!=="auto"?f:this._rotationAlignment,this._update(),this},h.prototype.getPitchAlignment=function(){return this._pitchAlignment},h}(x.Evented),hc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},pc=0,Wl=!1,eh=function(c){function h(f){c.call(this),this.options=x.extend({},hc,f),x.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.onAdd=function(f){var m;return this._map=f,this._container=tt.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),m=this._setupUI,Rc!==void 0?m(Rc):x.window.navigator.permissions!==void 0?x.window.navigator.permissions.query({name:"geolocation"}).then(function(S){m(Rc=S.state!=="denied")}):m(Rc=!!x.window.navigator.geolocation),this._container},h.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(x.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),tt.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,pc=0,Wl=!1},h.prototype._isOutOfMapMaxBounds=function(f){var m=this._map.getMaxBounds(),S=f.coords;return m&&(S.longitude<m.getWest()||S.longitude>m.getEast()||S.latitude<m.getSouth()||S.latitude>m.getNorth())},h.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},h.prototype._onSuccess=function(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new x.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new x.Event("geolocate",f)),this._finish()}},h.prototype._updateCamera=function(f){var m=new x.LngLat(f.coords.longitude,f.coords.latitude),S=f.coords.accuracy,k=this._map.getBearing(),P=x.extend({bearing:k},this.options.fitBoundsOptions);this._map.fitBounds(m.toBounds(S),P,{geolocateSource:!0})},h.prototype._updateMarker=function(f){if(f){var m=new x.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(m).addTo(this._map),this._userLocationDotMarker.setLngLat(m).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},h.prototype._updateCircleRadius=function(){var f=this._map._container.clientHeight/2,m=this._map.unproject([0,f]),S=this._map.unproject([1,f]),k=m.distanceTo(S),P=Math.ceil(2*this._accuracy/k);this._circleElement.style.width=P+"px",this._circleElement.style.height=P+"px"},h.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},h.prototype._onError=function(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var m=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&Wl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new x.Event("error",f)),this._finish()}},h.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},h.prototype._setupUI=function(f){var m=this;if(this._container.addEventListener("contextmenu",function(P){return P.preventDefault()}),this._geolocateButton=tt.create("button","mapboxgl-ctrl-geolocate",this._container),tt.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",f===!1){x.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var S=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}else{var k=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=k,this._geolocateButton.setAttribute("aria-label",k)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=tt.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new gh(this._dotElement),this._circleElement=tt.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new gh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(P){P.geolocateSource||m._watchState!=="ACTIVE_LOCK"||P.originalEvent&&P.originalEvent.type==="resize"||(m._watchState="BACKGROUND",m._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),m._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),m.fire(new x.Event("trackuserlocationend")))})},h.prototype.trigger=function(){if(!this._setup)return x.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new x.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":pc--,Wl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new x.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new x.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++pc>1?(f={maximumAge:6e5,timeout:0},Wl=!0):(f=this.options.positionOptions,Wl=!1),this._geolocationWatchID=x.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else x.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},h.prototype._clearWatch=function(){x.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},h}(x.Evented),dc={maxWidth:100,unit:"metric"},vc=function(c){this.options=x.extend({},dc,c),x.bindAll(["_onMove","setUnit"],this)};function th(c,h,f){var m=f&&f.maxWidth||100,S=c._container.clientHeight/2,k=c.unproject([0,S]),P=c.unproject([m,S]),N=k.distanceTo(P);if(f&&f.unit==="imperial"){var Y=3.2808*N;Y>5280?ef(h,m,Y/5280,c._getUIString("ScaleControl.Miles")):ef(h,m,Y,c._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?ef(h,m,N/1852,c._getUIString("ScaleControl.NauticalMiles")):N>=1e3?ef(h,m,N/1e3,c._getUIString("ScaleControl.Kilometers")):ef(h,m,N,c._getUIString("ScaleControl.Meters"))}function ef(c,h,f,m){var S,k,P,N=(S=f,(k=Math.pow(10,(""+Math.floor(S)).length-1))*(P=(P=S/k)>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(Y){var te=Math.pow(10,Math.ceil(-Math.log(Y)/Math.LN10));return Math.round(Y*te)/te}(P)));c.style.width=h*(N/f)+"px",c.innerHTML=N+"&nbsp;"+m}vc.prototype.getDefaultPosition=function(){return"bottom-left"},vc.prototype._onMove=function(){th(this._map,this._container,this.options)},vc.prototype.onAdd=function(c){return this._map=c,this._container=tt.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},vc.prototype.onRemove=function(){tt.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},vc.prototype.setUnit=function(c){this.options.unit=c,th(this._map,this._container,this.options)};var ol=function(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof x.window.HTMLElement?this._container=c.container:x.warnOnce("Full screen control 'container' must be a DOM element.")),x.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in x.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in x.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in x.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in x.window.document&&(this._fullscreenchange="MSFullscreenChange")};ol.prototype.onAdd=function(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=tt.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",x.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},ol.prototype.onRemove=function(){tt.remove(this._controlContainer),this._map=null,x.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},ol.prototype._checkFullscreenSupport=function(){return!!(x.window.document.fullscreenEnabled||x.window.document.mozFullScreenEnabled||x.window.document.msFullscreenEnabled||x.window.document.webkitFullscreenEnabled)},ol.prototype._setupUI=function(){var c=this._fullscreenButton=tt.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);tt.create("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden",!0),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),x.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},ol.prototype._updateTitle=function(){var c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.title=c},ol.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},ol.prototype._isFullscreen=function(){return this._fullscreen},ol.prototype._changeIcon=function(){(x.window.document.fullscreenElement||x.window.document.mozFullScreenElement||x.window.document.webkitFullscreenElement||x.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},ol.prototype._onClickFullscreen=function(){this._isFullscreen()?x.window.document.exitFullscreen?x.window.document.exitFullscreen():x.window.document.mozCancelFullScreen?x.window.document.mozCancelFullScreen():x.window.document.msExitFullscreen?x.window.document.msExitFullscreen():x.window.document.webkitCancelFullScreen&&x.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var rh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},hu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Ip=function(c){function h(f){c.call(this),this.options=x.extend(Object.create(rh),f),x.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.addTo=function(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new x.Event("open")),this},h.prototype.isOpen=function(){return!!this._map},h.prototype.remove=function(){return this._content&&tt.remove(this._content),this._container&&(tt.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new x.Event("close")),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(f){return this._lngLat=x.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},h.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},h.prototype.getElement=function(){return this._container},h.prototype.setText=function(f){return this.setDOMContent(x.window.document.createTextNode(f))},h.prototype.setHTML=function(f){var m,S=x.window.document.createDocumentFragment(),k=x.window.document.createElement("body");for(k.innerHTML=f;m=k.firstChild;)S.appendChild(m);return this.setDOMContent(S)},h.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},h.prototype.setMaxWidth=function(f){return this.options.maxWidth=f,this._update(),this},h.prototype.setDOMContent=function(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=tt.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this},h.prototype.addClassName=function(f){this._container&&this._container.classList.add(f)},h.prototype.removeClassName=function(f){this._container&&this._container.classList.remove(f)},h.prototype.setOffset=function(f){return this.options.offset=f,this._update(),this},h.prototype.toggleClassName=function(f){if(this._container)return this._container.classList.toggle(f)},h.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=tt.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},h.prototype._onMouseUp=function(f){this._update(f.point)},h.prototype._onMouseMove=function(f){this._update(f.point)},h.prototype._onDrag=function(f){this._update(f.point)},h.prototype._update=function(f){var m=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=tt.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=tt.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(le){return m._container.classList.add(le)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Il(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||f)){var S=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),k=this.options.anchor,P=function le(xe){if(xe){if(typeof xe=="number"){var ze=Math.round(Math.sqrt(.5*Math.pow(xe,2)));return{center:new x.Point(0,0),top:new x.Point(0,xe),"top-left":new x.Point(ze,ze),"top-right":new x.Point(-ze,ze),bottom:new x.Point(0,-xe),"bottom-left":new x.Point(ze,-ze),"bottom-right":new x.Point(-ze,-ze),left:new x.Point(xe,0),right:new x.Point(-xe,0)}}if(xe instanceof x.Point||Array.isArray(xe)){var Ue=x.Point.convert(xe);return{center:Ue,top:Ue,"top-left":Ue,"top-right":Ue,bottom:Ue,"bottom-left":Ue,"bottom-right":Ue,left:Ue,right:Ue}}return{center:x.Point.convert(xe.center||[0,0]),top:x.Point.convert(xe.top||[0,0]),"top-left":x.Point.convert(xe["top-left"]||[0,0]),"top-right":x.Point.convert(xe["top-right"]||[0,0]),bottom:x.Point.convert(xe.bottom||[0,0]),"bottom-left":x.Point.convert(xe["bottom-left"]||[0,0]),"bottom-right":x.Point.convert(xe["bottom-right"]||[0,0]),left:x.Point.convert(xe.left||[0,0]),right:x.Point.convert(xe.right||[0,0])}}return le(new x.Point(0,0))}(this.options.offset);if(!k){var N,Y=this._container.offsetWidth,te=this._container.offsetHeight;N=S.y+P.bottom.y<te?["top"]:S.y>this._map.transform.height-te?["bottom"]:[],S.x<Y/2?N.push("left"):S.x>this._map.transform.width-Y/2&&N.push("right"),k=N.length===0?"bottom":N.join("-")}var ye=S.add(P[k]).round();tt.setTransform(this._container,fc[k]+" translate("+ye.x+"px,"+ye.y+"px)"),qh(this._container,k,"popup")}},h.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var f=this._container.querySelector(hu);f&&f.focus()}},h.prototype._onClose=function(){this.remove()},h}(x.Evented),tf={version:x.version,supported:Jr,setRTLTextPlugin:x.setRTLTextPlugin,getRTLTextPluginStatus:x.getRTLTextPluginStatus,Map:kp,NavigationControl:kl,GeolocateControl:eh,AttributionControl:Fs,ScaleControl:vc,FullscreenControl:ol,Popup:Ip,Marker:gh,Style:Zo,LngLat:x.LngLat,LngLatBounds:x.LngLatBounds,Point:x.Point,MercatorCoordinate:x.MercatorCoordinate,Evented:x.Evented,config:x.config,prewarm:function(){Nt().acquire(Yt)},clearPrewarmedResources:function(){var c=$n;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(Yt),$n=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return x.config.ACCESS_TOKEN},set accessToken(c){x.config.ACCESS_TOKEN=c},get baseApiUrl(){return x.config.API_URL},set baseApiUrl(c){x.config.API_URL=c},get workerCount(){return Lr.workerCount},set workerCount(c){Lr.workerCount=c},get maxParallelImageRequests(){return x.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){x.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage:function(c){x.clearTileCache(c)},workerUrl:""};return tf}),rr})},3614:function(Ja,ji,vt){"use strict";Ja.exports=Ft;var rr=vt(80645);function Ft(ce){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ce)?ce:new Uint8Array(ce||0),this.pos=0,this.type=0,this.length=this.buf.length}Ft.Varint=0,Ft.Fixed64=1,Ft.Bytes=2,Ft.Fixed32=5;var x=(1<<16)*(1<<16),Jr=1/x,tt=12,Tr=typeof TextDecoder>"u"?null:new TextDecoder("utf8");Ft.prototype={destroy:function(){this.buf=null},readFields:function(ce,Ee,Z){for(Z=Z||this.length;this.pos<Z;){var Ze=this.readVarint(),Pe=Ze>>3,ft=this.pos;this.type=Ze&7,ce(Pe,Ee,this),this.pos===ft&&this.skip(Ze)}return Ee},readMessage:function(ce,Ee){return this.readFields(ce,Ee,this.readVarint()+this.pos)},readFixed32:function(){var ce=Rr(this.buf,this.pos);return this.pos+=4,ce},readSFixed32:function(){var ce=zr(this.buf,this.pos);return this.pos+=4,ce},readFixed64:function(){var ce=Rr(this.buf,this.pos)+Rr(this.buf,this.pos+4)*x;return this.pos+=8,ce},readSFixed64:function(){var ce=Rr(this.buf,this.pos)+zr(this.buf,this.pos+4)*x;return this.pos+=8,ce},readFloat:function(){var ce=rr.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ce},readDouble:function(){var ce=rr.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ce},readVarint:function(ce){var Ee=this.buf,Z,Ze;return Ze=Ee[this.pos++],Z=Ze&127,Ze<128||(Ze=Ee[this.pos++],Z|=(Ze&127)<<7,Ze<128)||(Ze=Ee[this.pos++],Z|=(Ze&127)<<14,Ze<128)||(Ze=Ee[this.pos++],Z|=(Ze&127)<<21,Ze<128)?Z:(Ze=Ee[this.pos],Z|=(Ze&15)<<28,rt(Z,ce,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ce=this.readVarint();return ce%2===1?(ce+1)/-2:ce/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var ce=this.readVarint()+this.pos,Ee=this.pos;return this.pos=ce,ce-Ee>=tt&&Tr?en(this.buf,Ee,ce):st(this.buf,Ee,ce)},readBytes:function(){var ce=this.readVarint()+this.pos,Ee=this.buf.subarray(this.pos,ce);return this.pos=ce,Ee},readPackedVarint:function(ce,Ee){if(this.type!==Ft.Bytes)return ce.push(this.readVarint(Ee));var Z=fr(this);for(ce=ce||[];this.pos<Z;)ce.push(this.readVarint(Ee));return ce},readPackedSVarint:function(ce){if(this.type!==Ft.Bytes)return ce.push(this.readSVarint());var Ee=fr(this);for(ce=ce||[];this.pos<Ee;)ce.push(this.readSVarint());return ce},readPackedBoolean:function(ce){if(this.type!==Ft.Bytes)return ce.push(this.readBoolean());var Ee=fr(this);for(ce=ce||[];this.pos<Ee;)ce.push(this.readBoolean());return ce},readPackedFloat:function(ce){if(this.type!==Ft.Bytes)return ce.push(this.readFloat());var Ee=fr(this);for(ce=ce||[];this.pos<Ee;)ce.push(this.readFloat());return ce},readPackedDouble:function(ce){if(this.type!==Ft.Bytes)return ce.push(this.readDouble());var Ee=fr(this);for(ce=ce||[];this.pos<Ee;)ce.push(this.readDouble());return ce},readPackedFixed32:function(ce){if(this.type!==Ft.Bytes)return ce.push(this.readFixed32());var Ee=fr(this);for(ce=ce||[];this.pos<Ee;)ce.push(this.readFixed32());return ce},readPackedSFixed32:function(ce){if(this.type!==Ft.Bytes)return ce.push(this.readSFixed32());var Ee=fr(this);for(ce=ce||[];this.pos<Ee;)ce.push(this.readSFixed32());return ce},readPackedFixed64:function(ce){if(this.type!==Ft.Bytes)return ce.push(this.readFixed64());var Ee=fr(this);for(ce=ce||[];this.pos<Ee;)ce.push(this.readFixed64());return ce},readPackedSFixed64:function(ce){if(this.type!==Ft.Bytes)return ce.push(this.readSFixed64());var Ee=fr(this);for(ce=ce||[];this.pos<Ee;)ce.push(this.readSFixed64());return ce},skip:function(ce){var Ee=ce&7;if(Ee===Ft.Varint)for(;this.buf[this.pos++]>127;);else if(Ee===Ft.Bytes)this.pos=this.readVarint()+this.pos;else if(Ee===Ft.Fixed32)this.pos+=4;else if(Ee===Ft.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+Ee)},writeTag:function(ce,Ee){this.writeVarint(ce<<3|Ee)},realloc:function(ce){for(var Ee=this.length||16;Ee<this.pos+ce;)Ee*=2;if(Ee!==this.length){var Z=new Uint8Array(Ee);Z.set(this.buf),this.buf=Z,this.length=Ee}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ce){this.realloc(4),ir(this.buf,ce,this.pos),this.pos+=4},writeSFixed32:function(ce){this.realloc(4),ir(this.buf,ce,this.pos),this.pos+=4},writeFixed64:function(ce){this.realloc(8),ir(this.buf,ce&-1,this.pos),ir(this.buf,Math.floor(ce*Jr),this.pos+4),this.pos+=8},writeSFixed64:function(ce){this.realloc(8),ir(this.buf,ce&-1,this.pos),ir(this.buf,Math.floor(ce*Jr),this.pos+4),this.pos+=8},writeVarint:function(ce){if(ce=+ce||0,ce>268435455||ce<0){Kt(ce,this);return}this.realloc(4),this.buf[this.pos++]=ce&127|(ce>127?128:0),!(ce<=127)&&(this.buf[this.pos++]=(ce>>>=7)&127|(ce>127?128:0),!(ce<=127)&&(this.buf[this.pos++]=(ce>>>=7)&127|(ce>127?128:0),!(ce<=127)&&(this.buf[this.pos++]=ce>>>7&127)))},writeSVarint:function(ce){this.writeVarint(ce<0?-ce*2-1:ce*2)},writeBoolean:function(ce){this.writeVarint(Boolean(ce))},writeString:function(ce){ce=String(ce),this.realloc(ce.length*4),this.pos++;var Ee=this.pos;this.pos=Wn(this.buf,ce,this.pos);var Z=this.pos-Ee;Z>=128&&ar(Ee,Z,this),this.pos=Ee-1,this.writeVarint(Z),this.pos+=Z},writeFloat:function(ce){this.realloc(4),rr.write(this.buf,ce,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ce){this.realloc(8),rr.write(this.buf,ce,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ce){var Ee=ce.length;this.writeVarint(Ee),this.realloc(Ee);for(var Z=0;Z<Ee;Z++)this.buf[this.pos++]=ce[Z]},writeRawMessage:function(ce,Ee){this.pos++;var Z=this.pos;ce(Ee,this);var Ze=this.pos-Z;Ze>=128&&ar(Z,Ze,this),this.pos=Z-1,this.writeVarint(Ze),this.pos+=Ze},writeMessage:function(ce,Ee,Z){this.writeTag(ce,Ft.Bytes),this.writeRawMessage(Ee,Z)},writePackedVarint:function(ce,Ee){Ee.length&&this.writeMessage(ce,ur,Ee)},writePackedSVarint:function(ce,Ee){Ee.length&&this.writeMessage(ce,Ir,Ee)},writePackedBoolean:function(ce,Ee){Ee.length&&this.writeMessage(ce,an,Ee)},writePackedFloat:function(ce,Ee){Ee.length&&this.writeMessage(ce,Kn,Ee)},writePackedDouble:function(ce,Ee){Ee.length&&this.writeMessage(ce,On,Ee)},writePackedFixed32:function(ce,Ee){Ee.length&&this.writeMessage(ce,Pi,Ee)},writePackedSFixed32:function(ce,Ee){Ee.length&&this.writeMessage(ce,ri,Ee)},writePackedFixed64:function(ce,Ee){Ee.length&&this.writeMessage(ce,me,Ee)},writePackedSFixed64:function(ce,Ee){Ee.length&&this.writeMessage(ce,_i,Ee)},writeBytesField:function(ce,Ee){this.writeTag(ce,Ft.Bytes),this.writeBytes(Ee)},writeFixed32Field:function(ce,Ee){this.writeTag(ce,Ft.Fixed32),this.writeFixed32(Ee)},writeSFixed32Field:function(ce,Ee){this.writeTag(ce,Ft.Fixed32),this.writeSFixed32(Ee)},writeFixed64Field:function(ce,Ee){this.writeTag(ce,Ft.Fixed64),this.writeFixed64(Ee)},writeSFixed64Field:function(ce,Ee){this.writeTag(ce,Ft.Fixed64),this.writeSFixed64(Ee)},writeVarintField:function(ce,Ee){this.writeTag(ce,Ft.Varint),this.writeVarint(Ee)},writeSVarintField:function(ce,Ee){this.writeTag(ce,Ft.Varint),this.writeSVarint(Ee)},writeStringField:function(ce,Ee){this.writeTag(ce,Ft.Bytes),this.writeString(Ee)},writeFloatField:function(ce,Ee){this.writeTag(ce,Ft.Fixed32),this.writeFloat(Ee)},writeDoubleField:function(ce,Ee){this.writeTag(ce,Ft.Fixed64),this.writeDouble(Ee)},writeBooleanField:function(ce,Ee){this.writeVarintField(ce,Boolean(Ee))}};function rt(ce,Ee,Z){var Ze=Z.buf,Pe,ft;if(ft=Ze[Z.pos++],Pe=(ft&112)>>4,ft<128||(ft=Ze[Z.pos++],Pe|=(ft&127)<<3,ft<128)||(ft=Ze[Z.pos++],Pe|=(ft&127)<<10,ft<128)||(ft=Ze[Z.pos++],Pe|=(ft&127)<<17,ft<128)||(ft=Ze[Z.pos++],Pe|=(ft&127)<<24,ft<128)||(ft=Ze[Z.pos++],Pe|=(ft&1)<<31,ft<128))return Xe(ce,Pe,Ee);throw new Error("Expected varint not more than 10 bytes")}function fr(ce){return ce.type===Ft.Bytes?ce.readVarint()+ce.pos:ce.pos+1}function Xe(ce,Ee,Z){return Z?Ee*4294967296+(ce>>>0):(Ee>>>0)*4294967296+(ce>>>0)}function Kt(ce,Ee){var Z,Ze;if(ce>=0?(Z=ce%4294967296|0,Ze=ce/4294967296|0):(Z=~(-ce%4294967296),Ze=~(-ce/4294967296),Z^4294967295?Z=Z+1|0:(Z=0,Ze=Ze+1|0)),ce>=18446744073709552e3||ce<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Ee.realloc(10),hr(Z,Ze,Ee),jt(Ze,Ee)}function hr(ce,Ee,Z){Z.buf[Z.pos++]=ce&127|128,ce>>>=7,Z.buf[Z.pos++]=ce&127|128,ce>>>=7,Z.buf[Z.pos++]=ce&127|128,ce>>>=7,Z.buf[Z.pos++]=ce&127|128,ce>>>=7,Z.buf[Z.pos]=ce&127}function jt(ce,Ee){var Z=(ce&7)<<4;Ee.buf[Ee.pos++]|=Z|((ce>>>=3)?128:0),ce&&(Ee.buf[Ee.pos++]=ce&127|((ce>>>=7)?128:0),ce&&(Ee.buf[Ee.pos++]=ce&127|((ce>>>=7)?128:0),ce&&(Ee.buf[Ee.pos++]=ce&127|((ce>>>=7)?128:0),ce&&(Ee.buf[Ee.pos++]=ce&127|((ce>>>=7)?128:0),ce&&(Ee.buf[Ee.pos++]=ce&127)))))}function ar(ce,Ee,Z){var Ze=Ee<=16383?1:Ee<=2097151?2:Ee<=268435455?3:Math.floor(Math.log(Ee)/(Math.LN2*7));Z.realloc(Ze);for(var Pe=Z.pos-1;Pe>=ce;Pe--)Z.buf[Pe+Ze]=Z.buf[Pe]}function ur(ce,Ee){for(var Z=0;Z<ce.length;Z++)Ee.writeVarint(ce[Z])}function Ir(ce,Ee){for(var Z=0;Z<ce.length;Z++)Ee.writeSVarint(ce[Z])}function Kn(ce,Ee){for(var Z=0;Z<ce.length;Z++)Ee.writeFloat(ce[Z])}function On(ce,Ee){for(var Z=0;Z<ce.length;Z++)Ee.writeDouble(ce[Z])}function an(ce,Ee){for(var Z=0;Z<ce.length;Z++)Ee.writeBoolean(ce[Z])}function Pi(ce,Ee){for(var Z=0;Z<ce.length;Z++)Ee.writeFixed32(ce[Z])}function ri(ce,Ee){for(var Z=0;Z<ce.length;Z++)Ee.writeSFixed32(ce[Z])}function me(ce,Ee){for(var Z=0;Z<ce.length;Z++)Ee.writeFixed64(ce[Z])}function _i(ce,Ee){for(var Z=0;Z<ce.length;Z++)Ee.writeSFixed64(ce[Z])}function Rr(ce,Ee){return(ce[Ee]|ce[Ee+1]<<8|ce[Ee+2]<<16)+ce[Ee+3]*16777216}function ir(ce,Ee,Z){ce[Z]=Ee,ce[Z+1]=Ee>>>8,ce[Z+2]=Ee>>>16,ce[Z+3]=Ee>>>24}function zr(ce,Ee){return(ce[Ee]|ce[Ee+1]<<8|ce[Ee+2]<<16)+(ce[Ee+3]<<24)}function st(ce,Ee,Z){for(var Ze="",Pe=Ee;Pe<Z;){var ft=ce[Pe],It=null,qt=ft>239?4:ft>223?3:ft>191?2:1;if(Pe+qt>Z)break;var yt,cr,Xn;qt===1?ft<128&&(It=ft):qt===2?(yt=ce[Pe+1],(yt&192)===128&&(It=(ft&31)<<6|yt&63,It<=127&&(It=null))):qt===3?(yt=ce[Pe+1],cr=ce[Pe+2],(yt&192)===128&&(cr&192)===128&&(It=(ft&15)<<12|(yt&63)<<6|cr&63,(It<=2047||It>=55296&&It<=57343)&&(It=null))):qt===4&&(yt=ce[Pe+1],cr=ce[Pe+2],Xn=ce[Pe+3],(yt&192)===128&&(cr&192)===128&&(Xn&192)===128&&(It=(ft&15)<<18|(yt&63)<<12|(cr&63)<<6|Xn&63,(It<=65535||It>=1114112)&&(It=null))),It===null?(It=65533,qt=1):It>65535&&(It-=65536,Ze+=String.fromCharCode(It>>>10&1023|55296),It=56320|It&1023),Ze+=String.fromCharCode(It),Pe+=qt}return Ze}function en(ce,Ee,Z){return Tr.decode(ce.subarray(Ee,Z))}function Wn(ce,Ee,Z){for(var Ze=0,Pe,ft;Ze<Ee.length;Ze++){if(Pe=Ee.charCodeAt(Ze),Pe>55295&&Pe<57344)if(ft)if(Pe<56320){ce[Z++]=239,ce[Z++]=191,ce[Z++]=189,ft=Pe;continue}else Pe=ft-55296<<10|Pe-56320|65536,ft=null;else{Pe>56319||Ze+1===Ee.length?(ce[Z++]=239,ce[Z++]=191,ce[Z++]=189):ft=Pe;continue}else ft&&(ce[Z++]=239,ce[Z++]=191,ce[Z++]=189,ft=null);Pe<128?ce[Z++]=Pe:(Pe<2048?ce[Z++]=Pe>>6|192:(Pe<65536?ce[Z++]=Pe>>12|224:(ce[Z++]=Pe>>18|240,ce[Z++]=Pe>>12&63|128),ce[Z++]=Pe>>6&63|128),ce[Z++]=Pe&63|128)}return Z}},32676:function(Ja,ji,vt){var rr=vt(34155);(function(Ft,x){Ja.exports=x()})(this,function(){"use strict";function Ft(bt,pe){if(!(bt instanceof pe))throw new TypeError("Cannot call a class as a function")}function x(bt,pe){for(var ie=0;ie<pe.length;ie++){var Ce=pe[ie];Ce.enumerable=Ce.enumerable||!1,Ce.configurable=!0,"value"in Ce&&(Ce.writable=!0),Object.defineProperty(bt,Ce.key,Ce)}}function Jr(bt,pe,ie){return pe&&x(bt.prototype,pe),ie&&x(bt,ie),bt}var tt=function(){function bt(pe,ie){this.next=null,this.key=pe,this.data=ie,this.left=null,this.right=null}return bt}();function Tr(bt,pe){return bt>pe?1:bt<pe?-1:0}function rt(bt,pe,ie){for(var Ce=new tt(null,null),V=Ce,We=Ce;;){var Gt=ie(bt,pe.key);if(Gt<0){if(pe.left===null)break;if(ie(bt,pe.left.key)<0){var Vr=pe.left;if(pe.left=Vr.right,Vr.right=pe,pe=Vr,pe.left===null)break}We.left=pe,We=pe,pe=pe.left}else if(Gt>0){if(pe.right===null)break;if(ie(bt,pe.right.key)>0){var Vr=pe.right;if(pe.right=Vr.left,Vr.left=pe,pe=Vr,pe.right===null)break}V.right=pe,V=pe,pe=pe.right}else break}return V.right=pe.left,We.left=pe.right,pe.left=Ce.right,pe.right=Ce.left,pe}function fr(bt,pe,ie,Ce){var V=new tt(bt,pe);if(ie===null)return V.left=V.right=null,V;ie=rt(bt,ie,Ce);var We=Ce(bt,ie.key);return We<0?(V.left=ie.left,V.right=ie,ie.left=null):We>=0&&(V.right=ie.right,V.left=ie,ie.right=null),V}function Xe(bt,pe,ie){var Ce=null,V=null;if(pe){pe=rt(bt,pe,ie);var We=ie(pe.key,bt);We===0?(Ce=pe.left,V=pe.right):We<0?(V=pe.right,pe.right=null,Ce=pe):(Ce=pe.left,pe.left=null,V=pe)}return{left:Ce,right:V}}function Kt(bt,pe,ie){return pe===null?bt:(bt===null||(pe=rt(bt.key,pe,ie),pe.left=bt),pe)}function hr(bt,pe,ie,Ce,V){if(bt){Ce(""+pe+(ie?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+V(bt)+`
`);var We=pe+(ie?"    ":"\u2502   ");bt.left&&hr(bt.left,We,!1,Ce,V),bt.right&&hr(bt.right,We,!0,Ce,V)}}var jt=function(){function bt(pe){pe===void 0&&(pe=Tr),this._root=null,this._size=0,this._comparator=pe}return bt.prototype.insert=function(pe,ie){return this._size++,this._root=fr(pe,ie,this._root,this._comparator)},bt.prototype.add=function(pe,ie){var Ce=new tt(pe,ie);this._root===null&&(Ce.left=Ce.right=null,this._size++,this._root=Ce);var V=this._comparator,We=rt(pe,this._root,V),Gt=V(pe,We.key);return Gt===0?this._root=We:(Gt<0?(Ce.left=We.left,Ce.right=We,We.left=null):Gt>0&&(Ce.right=We.right,Ce.left=We,We.right=null),this._size++,this._root=Ce),this._root},bt.prototype.remove=function(pe){this._root=this._remove(pe,this._root,this._comparator)},bt.prototype._remove=function(pe,ie,Ce){var V;if(ie===null)return null;ie=rt(pe,ie,Ce);var We=Ce(pe,ie.key);return We===0?(ie.left===null?V=ie.right:(V=rt(pe,ie.left,Ce),V.right=ie.right),this._size--,V):ie},bt.prototype.pop=function(){var pe=this._root;if(pe){for(;pe.left;)pe=pe.left;return this._root=rt(pe.key,this._root,this._comparator),this._root=this._remove(pe.key,this._root,this._comparator),{key:pe.key,data:pe.data}}return null},bt.prototype.findStatic=function(pe){for(var ie=this._root,Ce=this._comparator;ie;){var V=Ce(pe,ie.key);if(V===0)return ie;V<0?ie=ie.left:ie=ie.right}return null},bt.prototype.find=function(pe){return this._root&&(this._root=rt(pe,this._root,this._comparator),this._comparator(pe,this._root.key)!==0)?null:this._root},bt.prototype.contains=function(pe){for(var ie=this._root,Ce=this._comparator;ie;){var V=Ce(pe,ie.key);if(V===0)return!0;V<0?ie=ie.left:ie=ie.right}return!1},bt.prototype.forEach=function(pe,ie){for(var Ce=this._root,V=[],We=!1;!We;)Ce!==null?(V.push(Ce),Ce=Ce.left):V.length!==0?(Ce=V.pop(),pe.call(ie,Ce),Ce=Ce.right):We=!0;return this},bt.prototype.range=function(pe,ie,Ce,V){for(var We=[],Gt=this._comparator,Vr=this._root,Mr;We.length!==0||Vr;)if(Vr)We.push(Vr),Vr=Vr.left;else{if(Vr=We.pop(),Mr=Gt(Vr.key,ie),Mr>0)break;if(Gt(Vr.key,pe)>=0&&Ce.call(V,Vr))return this;Vr=Vr.right}return this},bt.prototype.keys=function(){var pe=[];return this.forEach(function(ie){var Ce=ie.key;return pe.push(Ce)}),pe},bt.prototype.values=function(){var pe=[];return this.forEach(function(ie){var Ce=ie.data;return pe.push(Ce)}),pe},bt.prototype.min=function(){return this._root?this.minNode(this._root).key:null},bt.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},bt.prototype.minNode=function(pe){if(pe===void 0&&(pe=this._root),pe)for(;pe.left;)pe=pe.left;return pe},bt.prototype.maxNode=function(pe){if(pe===void 0&&(pe=this._root),pe)for(;pe.right;)pe=pe.right;return pe},bt.prototype.at=function(pe){for(var ie=this._root,Ce=!1,V=0,We=[];!Ce;)if(ie)We.push(ie),ie=ie.left;else if(We.length>0){if(ie=We.pop(),V===pe)return ie;V++,ie=ie.right}else Ce=!0;return null},bt.prototype.next=function(pe){var ie=this._root,Ce=null;if(pe.right){for(Ce=pe.right;Ce.left;)Ce=Ce.left;return Ce}for(var V=this._comparator;ie;){var We=V(pe.key,ie.key);if(We===0)break;We<0?(Ce=ie,ie=ie.left):ie=ie.right}return Ce},bt.prototype.prev=function(pe){var ie=this._root,Ce=null;if(pe.left!==null){for(Ce=pe.left;Ce.right;)Ce=Ce.right;return Ce}for(var V=this._comparator;ie;){var We=V(pe.key,ie.key);if(We===0)break;We<0?ie=ie.left:(Ce=ie,ie=ie.right)}return Ce},bt.prototype.clear=function(){return this._root=null,this._size=0,this},bt.prototype.toList=function(){return Ir(this._root)},bt.prototype.load=function(pe,ie,Ce){ie===void 0&&(ie=[]),Ce===void 0&&(Ce=!1);var V=pe.length,We=this._comparator;if(Ce&&an(pe,ie,0,V-1,We),this._root===null)this._root=ar(pe,ie,0,V),this._size=V;else{var Gt=On(this.toList(),ur(pe,ie),We);V=this._size+V,this._root=Kn({head:Gt},0,V)}return this},bt.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(bt.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(bt.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),bt.prototype.toString=function(pe){pe===void 0&&(pe=function(V){return String(V.key)});var ie=[];return hr(this._root,"",!0,function(Ce){return ie.push(Ce)},pe),ie.join("")},bt.prototype.update=function(pe,ie,Ce){var V=this._comparator,We=Xe(pe,this._root,V),Gt=We.left,Vr=We.right;V(pe,ie)<0?Vr=fr(ie,Ce,Vr,V):Gt=fr(ie,Ce,Gt,V),this._root=Kt(Gt,Vr,V)},bt.prototype.split=function(pe){return Xe(pe,this._root,this._comparator)},bt}();function ar(bt,pe,ie,Ce){var V=Ce-ie;if(V>0){var We=ie+Math.floor(V/2),Gt=bt[We],Vr=pe[We],Mr=new tt(Gt,Vr);return Mr.left=ar(bt,pe,ie,We),Mr.right=ar(bt,pe,We+1,Ce),Mr}return null}function ur(bt,pe){for(var ie=new tt(null,null),Ce=ie,V=0;V<bt.length;V++)Ce=Ce.next=new tt(bt[V],pe[V]);return Ce.next=null,ie.next}function Ir(bt){for(var pe=bt,ie=[],Ce=!1,V=new tt(null,null),We=V;!Ce;)pe?(ie.push(pe),pe=pe.left):ie.length>0?(pe=We=We.next=ie.pop(),pe=pe.right):Ce=!0;return We.next=null,V.next}function Kn(bt,pe,ie){var Ce=ie-pe;if(Ce>0){var V=pe+Math.floor(Ce/2),We=Kn(bt,pe,V),Gt=bt.head;return Gt.left=We,bt.head=bt.head.next,Gt.right=Kn(bt,V+1,ie),Gt}return null}function On(bt,pe,ie){for(var Ce=new tt(null,null),V=Ce,We=bt,Gt=pe;We!==null&&Gt!==null;)ie(We.key,Gt.key)<0?(V.next=We,We=We.next):(V.next=Gt,Gt=Gt.next),V=V.next;return We!==null?V.next=We:Gt!==null&&(V.next=Gt),Ce.next}function an(bt,pe,ie,Ce,V){if(!(ie>=Ce)){for(var We=bt[ie+Ce>>1],Gt=ie-1,Vr=Ce+1;;){do Gt++;while(V(bt[Gt],We)<0);do Vr--;while(V(bt[Vr],We)>0);if(Gt>=Vr)break;var Mr=bt[Gt];bt[Gt]=bt[Vr],bt[Vr]=Mr,Mr=pe[Gt],pe[Gt]=pe[Vr],pe[Vr]=Mr}an(bt,pe,ie,Vr,V),an(bt,pe,Vr+1,Ce,V)}}var Pi=function(pe,ie){return pe.ll.x<=ie.x&&ie.x<=pe.ur.x&&pe.ll.y<=ie.y&&ie.y<=pe.ur.y},ri=function(pe,ie){if(ie.ur.x<pe.ll.x||pe.ur.x<ie.ll.x||ie.ur.y<pe.ll.y||pe.ur.y<ie.ll.y)return null;var Ce=pe.ll.x<ie.ll.x?ie.ll.x:pe.ll.x,V=pe.ur.x<ie.ur.x?pe.ur.x:ie.ur.x,We=pe.ll.y<ie.ll.y?ie.ll.y:pe.ll.y,Gt=pe.ur.y<ie.ur.y?pe.ur.y:ie.ur.y;return{ll:{x:Ce,y:We},ur:{x:V,y:Gt}}},me=Number.EPSILON;me===void 0&&(me=Math.pow(2,-52));var _i=me*me,Rr=function(pe,ie){if(-me<pe&&pe<me&&-me<ie&&ie<me)return 0;var Ce=pe-ie;return Ce*Ce<_i*pe*ie?0:pe<ie?-1:1},ir=function(){function bt(){Ft(this,bt),this.reset()}return Jr(bt,[{key:"reset",value:function(){this.xRounder=new zr,this.yRounder=new zr}},{key:"round",value:function(ie,Ce){return{x:this.xRounder.round(ie),y:this.yRounder.round(Ce)}}}]),bt}(),zr=function(){function bt(){Ft(this,bt),this.tree=new jt,this.round(0)}return Jr(bt,[{key:"round",value:function(ie){var Ce=this.tree.add(ie),V=this.tree.prev(Ce);if(V!==null&&Rr(Ce.key,V.key)===0)return this.tree.remove(ie),V.key;var We=this.tree.next(Ce);return We!==null&&Rr(Ce.key,We.key)===0?(this.tree.remove(ie),We.key):ie}}]),bt}(),st=new ir,en=function(pe,ie){return pe.x*ie.y-pe.y*ie.x},Wn=function(pe,ie){return pe.x*ie.x+pe.y*ie.y},ce=function(pe,ie,Ce){var V={x:ie.x-pe.x,y:ie.y-pe.y},We={x:Ce.x-pe.x,y:Ce.y-pe.y},Gt=en(V,We);return Rr(Gt,0)},Ee=function(pe){return Math.sqrt(Wn(pe,pe))},Z=function(pe,ie,Ce){var V={x:ie.x-pe.x,y:ie.y-pe.y},We={x:Ce.x-pe.x,y:Ce.y-pe.y};return en(We,V)/Ee(We)/Ee(V)},Ze=function(pe,ie,Ce){var V={x:ie.x-pe.x,y:ie.y-pe.y},We={x:Ce.x-pe.x,y:Ce.y-pe.y};return Wn(We,V)/Ee(We)/Ee(V)},Pe=function(pe,ie,Ce){return ie.y===0?null:{x:pe.x+ie.x/ie.y*(Ce-pe.y),y:Ce}},ft=function(pe,ie,Ce){return ie.x===0?null:{x:Ce,y:pe.y+ie.y/ie.x*(Ce-pe.x)}},It=function(pe,ie,Ce,V){if(ie.x===0)return ft(Ce,V,pe.x);if(V.x===0)return ft(pe,ie,Ce.x);if(ie.y===0)return Pe(Ce,V,pe.y);if(V.y===0)return Pe(pe,ie,Ce.y);var We=en(ie,V);if(We==0)return null;var Gt={x:Ce.x-pe.x,y:Ce.y-pe.y},Vr=en(Gt,ie)/We,Mr=en(Gt,V)/We,Yn=pe.x+Mr*ie.x,Fi=Ce.x+Vr*V.x,Qn=pe.y+Mr*ie.y,Bn=Ce.y+Vr*V.y,Fn=(Yn+Fi)/2,eo=(Qn+Bn)/2;return{x:Fn,y:eo}},qt=function(){Jr(bt,null,[{key:"compare",value:function(ie,Ce){var V=bt.comparePoints(ie.point,Ce.point);return V!==0?V:(ie.point!==Ce.point&&ie.link(Ce),ie.isLeft!==Ce.isLeft?ie.isLeft?1:-1:cr.compare(ie.segment,Ce.segment))}},{key:"comparePoints",value:function(ie,Ce){return ie.x<Ce.x?-1:ie.x>Ce.x?1:ie.y<Ce.y?-1:ie.y>Ce.y?1:0}}]);function bt(pe,ie){Ft(this,bt),pe.events===void 0?pe.events=[this]:pe.events.push(this),this.point=pe,this.isLeft=ie}return Jr(bt,[{key:"link",value:function(ie){if(ie.point===this.point)throw new Error("Tried to link already linked events");for(var Ce=ie.point.events,V=0,We=Ce.length;V<We;V++){var Gt=Ce[V];this.point.events.push(Gt),Gt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var ie=this.point.events.length,Ce=0;Ce<ie;Ce++){var V=this.point.events[Ce];if(V.segment.consumedBy===void 0)for(var We=Ce+1;We<ie;We++){var Gt=this.point.events[We];Gt.consumedBy===void 0&&V.otherSE.point.events===Gt.otherSE.point.events&&V.segment.consume(Gt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var ie=[],Ce=0,V=this.point.events.length;Ce<V;Ce++){var We=this.point.events[Ce];We!==this&&!We.segment.ringOut&&We.segment.isInResult()&&ie.push(We)}return ie}},{key:"getLeftmostComparator",value:function(ie){var Ce=this,V=new Map,We=function(Vr){var Mr=Vr.otherSE;V.set(Vr,{sine:Z(Ce.point,ie.point,Mr.point),cosine:Ze(Ce.point,ie.point,Mr.point)})};return function(Gt,Vr){V.has(Gt)||We(Gt),V.has(Vr)||We(Vr);var Mr=V.get(Gt),Yn=Mr.sine,Fi=Mr.cosine,Qn=V.get(Vr),Bn=Qn.sine,Fn=Qn.cosine;return Yn>=0&&Bn>=0?Fi<Fn?1:Fi>Fn?-1:0:Yn<0&&Bn<0?Fi<Fn?-1:Fi>Fn?1:0:Bn<Yn?-1:Bn>Yn?1:0}}}]),bt}(),yt=0,cr=function(){Jr(bt,null,[{key:"compare",value:function(ie,Ce){var V=ie.leftSE.point.x,We=Ce.leftSE.point.x,Gt=ie.rightSE.point.x,Vr=Ce.rightSE.point.x;if(Vr<V)return 1;if(Gt<We)return-1;var Mr=ie.leftSE.point.y,Yn=Ce.leftSE.point.y,Fi=ie.rightSE.point.y,Qn=Ce.rightSE.point.y;if(V<We){if(Yn<Mr&&Yn<Fi)return 1;if(Yn>Mr&&Yn>Fi)return-1;var Bn=ie.comparePoint(Ce.leftSE.point);if(Bn<0)return 1;if(Bn>0)return-1;var Fn=Ce.comparePoint(ie.rightSE.point);return Fn!==0?Fn:-1}if(V>We){if(Mr<Yn&&Mr<Qn)return-1;if(Mr>Yn&&Mr>Qn)return 1;var eo=Ce.comparePoint(ie.leftSE.point);if(eo!==0)return eo;var va=ie.comparePoint(Ce.rightSE.point);return va<0?1:va>0?-1:1}if(Mr<Yn)return-1;if(Mr>Yn)return 1;if(Gt<Vr){var Yi=Ce.comparePoint(ie.rightSE.point);if(Yi!==0)return Yi}if(Gt>Vr){var Lo=ie.comparePoint(Ce.rightSE.point);if(Lo<0)return 1;if(Lo>0)return-1}if(Gt!==Vr){var to=Fi-Mr,So=Gt-V,Ji=Qn-Yn,ro=Vr-We;if(to>So&&Ji<ro)return 1;if(to<So&&Ji>ro)return-1}return Gt>Vr?1:Gt<Vr||Fi<Qn?-1:Fi>Qn?1:ie.id<Ce.id?-1:ie.id>Ce.id?1:0}}]);function bt(pe,ie,Ce,V){Ft(this,bt),this.id=++yt,this.leftSE=pe,pe.segment=this,pe.otherSE=ie,this.rightSE=ie,ie.segment=this,ie.otherSE=pe,this.rings=Ce,this.windings=V}return Jr(bt,[{key:"replaceRightSE",value:function(ie){this.rightSE=ie,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var ie=this.leftSE.point.y,Ce=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:ie<Ce?ie:Ce},ur:{x:this.rightSE.point.x,y:ie>Ce?ie:Ce}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(ie){return ie.x===this.leftSE.point.x&&ie.y===this.leftSE.point.y||ie.x===this.rightSE.point.x&&ie.y===this.rightSE.point.y}},{key:"comparePoint",value:function(ie){if(this.isAnEndpoint(ie))return 0;var Ce=this.leftSE.point,V=this.rightSE.point,We=this.vector();if(Ce.x===V.x)return ie.x===Ce.x?0:ie.x<Ce.x?1:-1;var Gt=(ie.y-Ce.y)/We.y,Vr=Ce.x+Gt*We.x;if(ie.x===Vr)return 0;var Mr=(ie.x-Ce.x)/We.x,Yn=Ce.y+Mr*We.y;return ie.y===Yn?0:ie.y<Yn?-1:1}},{key:"getIntersection",value:function(ie){var Ce=this.bbox(),V=ie.bbox(),We=ri(Ce,V);if(We===null)return null;var Gt=this.leftSE.point,Vr=this.rightSE.point,Mr=ie.leftSE.point,Yn=ie.rightSE.point,Fi=Pi(Ce,Mr)&&this.comparePoint(Mr)===0,Qn=Pi(V,Gt)&&ie.comparePoint(Gt)===0,Bn=Pi(Ce,Yn)&&this.comparePoint(Yn)===0,Fn=Pi(V,Vr)&&ie.comparePoint(Vr)===0;if(Qn&&Fi)return Fn&&!Bn?Vr:!Fn&&Bn?Yn:null;if(Qn)return Bn&&Gt.x===Yn.x&&Gt.y===Yn.y?null:Gt;if(Fi)return Fn&&Vr.x===Mr.x&&Vr.y===Mr.y?null:Mr;if(Fn&&Bn)return null;if(Fn)return Vr;if(Bn)return Yn;var eo=It(Gt,this.vector(),Mr,ie.vector());return eo===null||!Pi(We,eo)?null:st.round(eo.x,eo.y)}},{key:"split",value:function(ie){var Ce=[],V=ie.events!==void 0,We=new qt(ie,!0),Gt=new qt(ie,!1),Vr=this.rightSE;this.replaceRightSE(Gt),Ce.push(Gt),Ce.push(We);var Mr=new bt(We,Vr,this.rings.slice(),this.windings.slice());return qt.comparePoints(Mr.leftSE.point,Mr.rightSE.point)>0&&Mr.swapEvents(),qt.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),V&&(We.checkForConsuming(),Gt.checkForConsuming()),Ce}},{key:"swapEvents",value:function(){var ie=this.rightSE;this.rightSE=this.leftSE,this.leftSE=ie,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var Ce=0,V=this.windings.length;Ce<V;Ce++)this.windings[Ce]*=-1}},{key:"consume",value:function(ie){for(var Ce=this,V=ie;Ce.consumedBy;)Ce=Ce.consumedBy;for(;V.consumedBy;)V=V.consumedBy;var We=bt.compare(Ce,V);if(We!==0){if(We>0){var Gt=Ce;Ce=V,V=Gt}if(Ce.prev===V){var Vr=Ce;Ce=V,V=Vr}for(var Mr=0,Yn=V.rings.length;Mr<Yn;Mr++){var Fi=V.rings[Mr],Qn=V.windings[Mr],Bn=Ce.rings.indexOf(Fi);Bn===-1?(Ce.rings.push(Fi),Ce.windings.push(Qn)):Ce.windings[Bn]+=Qn}V.rings=null,V.windings=null,V.consumedBy=Ce,V.leftSE.consumedBy=Ce.leftSE,V.rightSE.consumedBy=Ce.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var ie=this.prev.consumedBy||this.prev;this._beforeState=ie.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var ie=this.beforeState();this._afterState={rings:ie.rings.slice(0),windings:ie.windings.slice(0),multiPolys:[]};for(var Ce=this._afterState.rings,V=this._afterState.windings,We=this._afterState.multiPolys,Gt=0,Vr=this.rings.length;Gt<Vr;Gt++){var Mr=this.rings[Gt],Yn=this.windings[Gt],Fi=Ce.indexOf(Mr);Fi===-1?(Ce.push(Mr),V.push(Yn)):V[Fi]+=Yn}for(var Qn=[],Bn=[],Fn=0,eo=Ce.length;Fn<eo;Fn++)if(V[Fn]!==0){var va=Ce[Fn],Yi=va.poly;if(Bn.indexOf(Yi)===-1)if(va.isExterior)Qn.push(Yi);else{Bn.indexOf(Yi)===-1&&Bn.push(Yi);var Lo=Qn.indexOf(va.poly);Lo!==-1&&Qn.splice(Lo,1)}}for(var to=0,So=Qn.length;to<So;to++){var Ji=Qn[to].multiPoly;We.indexOf(Ji)===-1&&We.push(Ji)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var ie=this.beforeState().multiPolys,Ce=this.afterState().multiPolys;switch(Hi.type){case"union":{var V=ie.length===0,We=Ce.length===0;this._isInResult=V!==We;break}case"intersection":{var Gt,Vr;ie.length<Ce.length?(Gt=ie.length,Vr=Ce.length):(Gt=Ce.length,Vr=ie.length),this._isInResult=Vr===Hi.numMultiPolys&&Gt<Vr;break}case"xor":{var Mr=Math.abs(ie.length-Ce.length);this._isInResult=Mr%2===1;break}case"difference":{var Yn=function(Qn){return Qn.length===1&&Qn[0].isSubject};this._isInResult=Yn(ie)!==Yn(Ce);break}default:throw new Error("Unrecognized operation type found ".concat(Hi.type))}return this._isInResult}}],[{key:"fromRing",value:function(ie,Ce,V){var We,Gt,Vr,Mr=qt.comparePoints(ie,Ce);if(Mr<0)We=ie,Gt=Ce,Vr=1;else if(Mr>0)We=Ce,Gt=ie,Vr=-1;else throw new Error("Tried to create degenerate segment at [".concat(ie.x,", ").concat(ie.y,"]"));var Yn=new qt(We,!0),Fi=new qt(Gt,!1);return new bt(Yn,Fi,[V],[Vr])}}]),bt}(),Xn=function(){function bt(pe,ie,Ce){if(Ft(this,bt),!Array.isArray(pe)||pe.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=ie,this.isExterior=Ce,this.segments=[],typeof pe[0][0]!="number"||typeof pe[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var V=st.round(pe[0][0],pe[0][1]);this.bbox={ll:{x:V.x,y:V.y},ur:{x:V.x,y:V.y}};for(var We=V,Gt=1,Vr=pe.length;Gt<Vr;Gt++){if(typeof pe[Gt][0]!="number"||typeof pe[Gt][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Mr=st.round(pe[Gt][0],pe[Gt][1]);Mr.x===We.x&&Mr.y===We.y||(this.segments.push(cr.fromRing(We,Mr,this)),Mr.x<this.bbox.ll.x&&(this.bbox.ll.x=Mr.x),Mr.y<this.bbox.ll.y&&(this.bbox.ll.y=Mr.y),Mr.x>this.bbox.ur.x&&(this.bbox.ur.x=Mr.x),Mr.y>this.bbox.ur.y&&(this.bbox.ur.y=Mr.y),We=Mr)}(V.x!==We.x||V.y!==We.y)&&this.segments.push(cr.fromRing(We,V,this))}return Jr(bt,[{key:"getSweepEvents",value:function(){for(var ie=[],Ce=0,V=this.segments.length;Ce<V;Ce++){var We=this.segments[Ce];ie.push(We.leftSE),ie.push(We.rightSE)}return ie}}]),bt}(),Vn=function(){function bt(pe,ie){if(Ft(this,bt),!Array.isArray(pe))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Xn(pe[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var Ce=1,V=pe.length;Ce<V;Ce++){var We=new Xn(pe[Ce],this,!1);We.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=We.bbox.ll.x),We.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=We.bbox.ll.y),We.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=We.bbox.ur.x),We.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=We.bbox.ur.y),this.interiorRings.push(We)}this.multiPoly=ie}return Jr(bt,[{key:"getSweepEvents",value:function(){for(var ie=this.exteriorRing.getSweepEvents(),Ce=0,V=this.interiorRings.length;Ce<V;Ce++)for(var We=this.interiorRings[Ce].getSweepEvents(),Gt=0,Vr=We.length;Gt<Vr;Gt++)ie.push(We[Gt]);return ie}}]),bt}(),Gi=function(){function bt(pe,ie){if(Ft(this,bt),!Array.isArray(pe))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof pe[0][0][0]=="number"&&(pe=[pe])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var Ce=0,V=pe.length;Ce<V;Ce++){var We=new Vn(pe[Ce],this);We.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=We.bbox.ll.x),We.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=We.bbox.ll.y),We.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=We.bbox.ur.x),We.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=We.bbox.ur.y),this.polys.push(We)}this.isSubject=ie}return Jr(bt,[{key:"getSweepEvents",value:function(){for(var ie=[],Ce=0,V=this.polys.length;Ce<V;Ce++)for(var We=this.polys[Ce].getSweepEvents(),Gt=0,Vr=We.length;Gt<Vr;Gt++)ie.push(We[Gt]);return ie}}]),bt}(),ai=function(){Jr(bt,null,[{key:"factory",value:function(ie){for(var Ce=[],V=0,We=ie.length;V<We;V++){var Gt=ie[V];if(!(!Gt.isInResult()||Gt.ringOut)){for(var Vr=null,Mr=Gt.leftSE,Yn=Gt.rightSE,Fi=[Mr],Qn=Mr.point,Bn=[];Vr=Mr,Mr=Yn,Fi.push(Mr),Mr.point!==Qn;)for(;;){var Fn=Mr.getAvailableLinkedEvents();if(Fn.length===0){var eo=Fi[0].point,va=Fi[Fi.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(eo.x,",")+" ".concat(eo.y,"]. Last matching segment found ends at")+" [".concat(va.x,", ").concat(va.y,"]."))}if(Fn.length===1){Yn=Fn[0].otherSE;break}for(var Yi=null,Lo=0,to=Bn.length;Lo<to;Lo++)if(Bn[Lo].point===Mr.point){Yi=Lo;break}if(Yi!==null){var So=Bn.splice(Yi)[0],Ji=Fi.splice(So.index);Ji.unshift(Ji[0].otherSE),Ce.push(new bt(Ji.reverse()));continue}Bn.push({index:Fi.length,point:Mr.point});var ro=Mr.getLeftmostComparator(Vr);Yn=Fn.sort(ro)[0].otherSE;break}Ce.push(new bt(Fi))}}return Ce}}]);function bt(pe){Ft(this,bt),this.events=pe;for(var ie=0,Ce=pe.length;ie<Ce;ie++)pe[ie].segment.ringOut=this;this.poly=null}return Jr(bt,[{key:"getGeom",value:function(){for(var ie=this.events[0].point,Ce=[ie],V=1,We=this.events.length-1;V<We;V++){var Gt=this.events[V].point,Vr=this.events[V+1].point;ce(Gt,ie,Vr)!==0&&(Ce.push(Gt),ie=Gt)}if(Ce.length===1)return null;var Mr=Ce[0],Yn=Ce[1];ce(Mr,ie,Yn)===0&&Ce.shift(),Ce.push(Ce[0]);for(var Fi=this.isExteriorRing()?1:-1,Qn=this.isExteriorRing()?0:Ce.length-1,Bn=this.isExteriorRing()?Ce.length:-1,Fn=[],eo=Qn;eo!=Bn;eo+=Fi)Fn.push([Ce[eo].x,Ce[eo].y]);return Fn}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var ie=this.enclosingRing();this._isExteriorRing=ie?!ie.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var ie=this.events[0],Ce=1,V=this.events.length;Ce<V;Ce++){var We=this.events[Ce];qt.compare(ie,We)>0&&(ie=We)}for(var Gt=ie.segment.prevInResult(),Vr=Gt?Gt.prevInResult():null;;){if(!Gt)return null;if(!Vr)return Gt.ringOut;if(Vr.ringOut!==Gt.ringOut)return Vr.ringOut.enclosingRing()!==Gt.ringOut?Gt.ringOut:Gt.ringOut.enclosingRing();Gt=Vr.prevInResult(),Vr=Gt?Gt.prevInResult():null}}}]),bt}(),Rn=function(){function bt(pe){Ft(this,bt),this.exteriorRing=pe,pe.poly=this,this.interiorRings=[]}return Jr(bt,[{key:"addInterior",value:function(ie){this.interiorRings.push(ie),ie.poly=this}},{key:"getGeom",value:function(){var ie=[this.exteriorRing.getGeom()];if(ie[0]===null)return null;for(var Ce=0,V=this.interiorRings.length;Ce<V;Ce++){var We=this.interiorRings[Ce].getGeom();We!==null&&ie.push(We)}return ie}}]),bt}(),Ba=function(){function bt(pe){Ft(this,bt),this.rings=pe,this.polys=this._composePolys(pe)}return Jr(bt,[{key:"getGeom",value:function(){for(var ie=[],Ce=0,V=this.polys.length;Ce<V;Ce++){var We=this.polys[Ce].getGeom();We!==null&&ie.push(We)}return ie}},{key:"_composePolys",value:function(ie){for(var Ce=[],V=0,We=ie.length;V<We;V++){var Gt=ie[V];if(!Gt.poly)if(Gt.isExteriorRing())Ce.push(new Rn(Gt));else{var Vr=Gt.enclosingRing();Vr.poly||Ce.push(new Rn(Vr)),Vr.poly.addInterior(Gt)}}return Ce}}]),bt}(),oa=function(){function bt(pe){var ie=arguments.length>1&&arguments[1]!==void 0?arguments[1]:cr.compare;Ft(this,bt),this.queue=pe,this.tree=new jt(ie),this.segments=[]}return Jr(bt,[{key:"process",value:function(ie){var Ce=ie.segment,V=[];if(ie.consumedBy)return ie.isLeft?this.queue.remove(ie.otherSE):this.tree.remove(Ce),V;var We=ie.isLeft?this.tree.insert(Ce):this.tree.find(Ce);if(!We)throw new Error("Unable to find segment #".concat(Ce.id," ")+"[".concat(Ce.leftSE.point.x,", ").concat(Ce.leftSE.point.y,"] -> ")+"[".concat(Ce.rightSE.point.x,", ").concat(Ce.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var Gt=We,Vr=We,Mr=void 0,Yn=void 0;Mr===void 0;)Gt=this.tree.prev(Gt),Gt===null?Mr=null:Gt.key.consumedBy===void 0&&(Mr=Gt.key);for(;Yn===void 0;)Vr=this.tree.next(Vr),Vr===null?Yn=null:Vr.key.consumedBy===void 0&&(Yn=Vr.key);if(ie.isLeft){var Fi=null;if(Mr){var Qn=Mr.getIntersection(Ce);if(Qn!==null&&(Ce.isAnEndpoint(Qn)||(Fi=Qn),!Mr.isAnEndpoint(Qn)))for(var Bn=this._splitSafely(Mr,Qn),Fn=0,eo=Bn.length;Fn<eo;Fn++)V.push(Bn[Fn])}var va=null;if(Yn){var Yi=Yn.getIntersection(Ce);if(Yi!==null&&(Ce.isAnEndpoint(Yi)||(va=Yi),!Yn.isAnEndpoint(Yi)))for(var Lo=this._splitSafely(Yn,Yi),to=0,So=Lo.length;to<So;to++)V.push(Lo[to])}if(Fi!==null||va!==null){var Ji=null;if(Fi===null)Ji=va;else if(va===null)Ji=Fi;else{var ro=qt.comparePoints(Fi,va);Ji=ro<=0?Fi:va}this.queue.remove(Ce.rightSE),V.push(Ce.rightSE);for(var hi=Ce.split(Ji),fa=0,$=hi.length;fa<$;fa++)V.push(hi[fa])}V.length>0?(this.tree.remove(Ce),V.push(ie)):(this.segments.push(Ce),Ce.prev=Mr)}else{if(Mr&&Yn){var ne=Mr.getIntersection(Yn);if(ne!==null){if(!Mr.isAnEndpoint(ne))for(var he=this._splitSafely(Mr,ne),be=0,Ne=he.length;be<Ne;be++)V.push(he[be]);if(!Yn.isAnEndpoint(ne))for(var Ye=this._splitSafely(Yn,ne),lt=0,_e=Ye.length;lt<_e;lt++)V.push(Ye[lt])}}this.tree.remove(Ce)}return V}},{key:"_splitSafely",value:function(ie,Ce){this.tree.remove(ie);var V=ie.rightSE;this.queue.remove(V);var We=ie.split(Ce);return We.push(V),ie.consumedBy===void 0&&this.tree.insert(ie),We}}]),bt}(),Ti=typeof rr<"u"&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Ca=typeof rr<"u"&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,xi=function(){function bt(){Ft(this,bt)}return Jr(bt,[{key:"run",value:function(ie,Ce,V){Hi.type=ie,st.reset();for(var We=[new Gi(Ce,!0)],Gt=0,Vr=V.length;Gt<Vr;Gt++)We.push(new Gi(V[Gt],!1));if(Hi.numMultiPolys=We.length,Hi.type==="difference")for(var Mr=We[0],Yn=1;Yn<We.length;)ri(We[Yn].bbox,Mr.bbox)!==null?Yn++:We.splice(Yn,1);if(Hi.type==="intersection"){for(var Fi=0,Qn=We.length;Fi<Qn;Fi++)for(var Bn=We[Fi],Fn=Fi+1,eo=We.length;Fn<eo;Fn++)if(ri(Bn.bbox,We[Fn].bbox)===null)return[]}for(var va=new jt(qt.compare),Yi=0,Lo=We.length;Yi<Lo;Yi++)for(var to=We[Yi].getSweepEvents(),So=0,Ji=to.length;So<Ji;So++)if(va.insert(to[So]),va.size>Ti)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var ro=new oa(va),hi=va.size,fa=va.pop();fa;){var $=fa.key;if(va.size===hi){var ne=$.segment;throw new Error("Unable to pop() ".concat($.isLeft?"left":"right"," SweepEvent ")+"[".concat($.point.x,", ").concat($.point.y,"] from segment #").concat(ne.id," ")+"[".concat(ne.leftSE.point.x,", ").concat(ne.leftSE.point.y,"] -> ")+"[".concat(ne.rightSE.point.x,", ").concat(ne.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(va.size>Ti)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(ro.segments.length>Ca)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var he=ro.process($),be=0,Ne=he.length;be<Ne;be++){var Ye=he[be];Ye.consumedBy===void 0&&va.insert(Ye)}hi=va.size,fa=va.pop()}st.reset();var lt=ai.factory(ro.segments),_e=new Ba(lt);return _e.getGeom()}}]),bt}(),Hi=new xi,vi=function(pe){for(var ie=arguments.length,Ce=new Array(ie>1?ie-1:0),V=1;V<ie;V++)Ce[V-1]=arguments[V];return Hi.run("union",pe,Ce)},mi=function(pe){for(var ie=arguments.length,Ce=new Array(ie>1?ie-1:0),V=1;V<ie;V++)Ce[V-1]=arguments[V];return Hi.run("intersection",pe,Ce)},ss=function(pe){for(var ie=arguments.length,Ce=new Array(ie>1?ie-1:0),V=1;V<ie;V++)Ce[V-1]=arguments[V];return Hi.run("xor",pe,Ce)},Po=function(pe){for(var ie=arguments.length,Ce=new Array(ie>1?ie-1:0),V=1;V<ie;V++)Ce[V-1]=arguments[V];return Hi.run("difference",pe,Ce)},ao={union:vi,intersection:mi,xor:ss,difference:Po};return ao})},69848:function(Ja){(function(ji,vt){Ja.exports=vt()})(this,function(){"use strict";function ji(Rr,ir,zr,st,en,Wn){if(!(en-st<=zr)){var ce=st+en>>1;vt(Rr,ir,ce,st,en,Wn%2),ji(Rr,ir,zr,st,ce-1,Wn+1),ji(Rr,ir,zr,ce+1,en,Wn+1)}}function vt(Rr,ir,zr,st,en,Wn){for(;en>st;){if(en-st>600){var ce=en-st+1,Ee=zr-st+1,Z=Math.log(ce),Ze=.5*Math.exp(2*Z/3),Pe=.5*Math.sqrt(Z*Ze*(ce-Ze)/ce)*(Ee-ce/2<0?-1:1),ft=Math.max(st,Math.floor(zr-Ee*Ze/ce+Pe)),It=Math.min(en,Math.floor(zr+(ce-Ee)*Ze/ce+Pe));vt(Rr,ir,zr,ft,It,Wn)}var qt=ir[2*zr+Wn],yt=st,cr=en;for(rr(Rr,ir,st,zr),ir[2*en+Wn]>qt&&rr(Rr,ir,st,en);yt<cr;){for(rr(Rr,ir,yt,cr),yt++,cr--;ir[2*yt+Wn]<qt;)yt++;for(;ir[2*cr+Wn]>qt;)cr--}ir[2*st+Wn]===qt?rr(Rr,ir,st,cr):(cr++,rr(Rr,ir,cr,en)),cr<=zr&&(st=cr+1),zr<=cr&&(en=cr-1)}}function rr(Rr,ir,zr,st){Ft(Rr,zr,st),Ft(ir,2*zr,2*st),Ft(ir,2*zr+1,2*st+1)}function Ft(Rr,ir,zr){var st=Rr[ir];Rr[ir]=Rr[zr],Rr[zr]=st}function x(Rr,ir,zr,st,en,Wn,ce){for(var Ee=[0,Rr.length-1,0],Z=[],Ze,Pe;Ee.length;){var ft=Ee.pop(),It=Ee.pop(),qt=Ee.pop();if(It-qt<=ce){for(var yt=qt;yt<=It;yt++)Ze=ir[2*yt],Pe=ir[2*yt+1],Ze>=zr&&Ze<=en&&Pe>=st&&Pe<=Wn&&Z.push(Rr[yt]);continue}var cr=Math.floor((qt+It)/2);Ze=ir[2*cr],Pe=ir[2*cr+1],Ze>=zr&&Ze<=en&&Pe>=st&&Pe<=Wn&&Z.push(Rr[cr]);var Xn=(ft+1)%2;(ft===0?zr<=Ze:st<=Pe)&&(Ee.push(qt),Ee.push(cr-1),Ee.push(Xn)),(ft===0?en>=Ze:Wn>=Pe)&&(Ee.push(cr+1),Ee.push(It),Ee.push(Xn))}return Z}function Jr(Rr,ir,zr,st,en,Wn){for(var ce=[0,Rr.length-1,0],Ee=[],Z=en*en;ce.length;){var Ze=ce.pop(),Pe=ce.pop(),ft=ce.pop();if(Pe-ft<=Wn){for(var It=ft;It<=Pe;It++)tt(ir[2*It],ir[2*It+1],zr,st)<=Z&&Ee.push(Rr[It]);continue}var qt=Math.floor((ft+Pe)/2),yt=ir[2*qt],cr=ir[2*qt+1];tt(yt,cr,zr,st)<=Z&&Ee.push(Rr[qt]);var Xn=(Ze+1)%2;(Ze===0?zr-en<=yt:st-en<=cr)&&(ce.push(ft),ce.push(qt-1),ce.push(Xn)),(Ze===0?zr+en>=yt:st+en>=cr)&&(ce.push(qt+1),ce.push(Pe),ce.push(Xn))}return Ee}function tt(Rr,ir,zr,st){var en=Rr-zr,Wn=ir-st;return en*en+Wn*Wn}var Tr=function(Rr){return Rr[0]},rt=function(Rr){return Rr[1]},fr=function(ir,zr,st,en,Wn){zr===void 0&&(zr=Tr),st===void 0&&(st=rt),en===void 0&&(en=64),Wn===void 0&&(Wn=Float64Array),this.nodeSize=en,this.points=ir;for(var ce=ir.length<65536?Uint16Array:Uint32Array,Ee=this.ids=new ce(ir.length),Z=this.coords=new Wn(ir.length*2),Ze=0;Ze<ir.length;Ze++)Ee[Ze]=Ze,Z[2*Ze]=zr(ir[Ze]),Z[2*Ze+1]=st(ir[Ze]);ji(Ee,Z,en,0,Ee.length-1,0)};fr.prototype.range=function(ir,zr,st,en){return x(this.ids,this.coords,ir,zr,st,en,this.nodeSize)},fr.prototype.within=function(ir,zr,st){return Jr(this.ids,this.coords,ir,zr,st,this.nodeSize)};var Xe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Rr){return Rr}},Kt=Math.fround||function(Rr){return function(ir){return Rr[0]=+ir,Rr[0]}}(new Float32Array(1)),hr=function(ir){this.options=ri(Object.create(Xe),ir),this.trees=new Array(this.options.maxZoom+1)};hr.prototype.load=function(ir){var zr=this.options,st=zr.log,en=zr.minZoom,Wn=zr.maxZoom,ce=zr.nodeSize;st&&console.time("total time");var Ee="prepare "+ir.length+" points";st&&console.time(Ee),this.points=ir;for(var Z=[],Ze=0;Ze<ir.length;Ze++)!ir[Ze].geometry||Z.push(ar(ir[Ze],Ze));this.trees[Wn+1]=new fr(Z,me,_i,ce,Float32Array),st&&console.timeEnd(Ee);for(var Pe=Wn;Pe>=en;Pe--){var ft=+Date.now();Z=this._cluster(Z,Pe),this.trees[Pe]=new fr(Z,me,_i,ce,Float32Array),st&&console.log("z%d: %d clusters in %dms",Pe,Z.length,+Date.now()-ft)}return st&&console.timeEnd("total time"),this},hr.prototype.getClusters=function(ir,zr){var st=((ir[0]+180)%360+360)%360-180,en=Math.max(-90,Math.min(90,ir[1])),Wn=ir[2]===180?180:((ir[2]+180)%360+360)%360-180,ce=Math.max(-90,Math.min(90,ir[3]));if(ir[2]-ir[0]>=360)st=-180,Wn=180;else if(st>Wn){var Ee=this.getClusters([st,en,180,ce],zr),Z=this.getClusters([-180,en,Wn,ce],zr);return Ee.concat(Z)}for(var Ze=this.trees[this._limitZoom(zr)],Pe=Ze.range(Kn(st),On(ce),Kn(Wn),On(en)),ft=[],It=0,qt=Pe;It<qt.length;It+=1){var yt=qt[It],cr=Ze.points[yt];ft.push(cr.numPoints?ur(cr):this.points[cr.index])}return ft},hr.prototype.getChildren=function(ir){var zr=this._getOriginId(ir),st=this._getOriginZoom(ir),en="No cluster with the specified id.",Wn=this.trees[st];if(!Wn)throw new Error(en);var ce=Wn.points[zr];if(!ce)throw new Error(en);for(var Ee=this.options.radius/(this.options.extent*Math.pow(2,st-1)),Z=Wn.within(ce.x,ce.y,Ee),Ze=[],Pe=0,ft=Z;Pe<ft.length;Pe+=1){var It=ft[Pe],qt=Wn.points[It];qt.parentId===ir&&Ze.push(qt.numPoints?ur(qt):this.points[qt.index])}if(Ze.length===0)throw new Error(en);return Ze},hr.prototype.getLeaves=function(ir,zr,st){zr=zr||10,st=st||0;var en=[];return this._appendLeaves(en,ir,zr,st,0),en},hr.prototype.getTile=function(ir,zr,st){var en=this.trees[this._limitZoom(ir)],Wn=Math.pow(2,ir),ce=this.options,Ee=ce.extent,Z=ce.radius,Ze=Z/Ee,Pe=(st-Ze)/Wn,ft=(st+1+Ze)/Wn,It={features:[]};return this._addTileFeatures(en.range((zr-Ze)/Wn,Pe,(zr+1+Ze)/Wn,ft),en.points,zr,st,Wn,It),zr===0&&this._addTileFeatures(en.range(1-Ze/Wn,Pe,1,ft),en.points,Wn,st,Wn,It),zr===Wn-1&&this._addTileFeatures(en.range(0,Pe,Ze/Wn,ft),en.points,-1,st,Wn,It),It.features.length?It:null},hr.prototype.getClusterExpansionZoom=function(ir){for(var zr=this._getOriginZoom(ir)-1;zr<=this.options.maxZoom;){var st=this.getChildren(ir);if(zr++,st.length!==1)break;ir=st[0].properties.cluster_id}return zr},hr.prototype._appendLeaves=function(ir,zr,st,en,Wn){for(var ce=this.getChildren(zr),Ee=0,Z=ce;Ee<Z.length;Ee+=1){var Ze=Z[Ee],Pe=Ze.properties;if(Pe&&Pe.cluster?Wn+Pe.point_count<=en?Wn+=Pe.point_count:Wn=this._appendLeaves(ir,Pe.cluster_id,st,en,Wn):Wn<en?Wn++:ir.push(Ze),ir.length===st)break}return Wn},hr.prototype._addTileFeatures=function(ir,zr,st,en,Wn,ce){for(var Ee=0,Z=ir;Ee<Z.length;Ee+=1){var Ze=Z[Ee],Pe=zr[Ze],ft=Pe.numPoints,It=void 0,qt=void 0,yt=void 0;if(ft)It=Ir(Pe),qt=Pe.x,yt=Pe.y;else{var cr=this.points[Pe.index];It=cr.properties,qt=Kn(cr.geometry.coordinates[0]),yt=On(cr.geometry.coordinates[1])}var Xn={type:1,geometry:[[Math.round(this.options.extent*(qt*Wn-st)),Math.round(this.options.extent*(yt*Wn-en))]],tags:It},Vn=void 0;ft?Vn=Pe.id:this.options.generateId?Vn=Pe.index:this.points[Pe.index].id&&(Vn=this.points[Pe.index].id),Vn!==void 0&&(Xn.id=Vn),ce.features.push(Xn)}},hr.prototype._limitZoom=function(ir){return Math.max(this.options.minZoom,Math.min(Math.floor(+ir),this.options.maxZoom+1))},hr.prototype._cluster=function(ir,zr){for(var st=[],en=this.options,Wn=en.radius,ce=en.extent,Ee=en.reduce,Z=en.minPoints,Ze=Wn/(ce*Math.pow(2,zr)),Pe=0;Pe<ir.length;Pe++){var ft=ir[Pe];if(!(ft.zoom<=zr)){ft.zoom=zr;for(var It=this.trees[zr+1],qt=It.within(ft.x,ft.y,Ze),yt=ft.numPoints||1,cr=yt,Xn=0,Vn=qt;Xn<Vn.length;Xn+=1){var Gi=Vn[Xn],ai=It.points[Gi];ai.zoom>zr&&(cr+=ai.numPoints||1)}if(cr>yt&&cr>=Z){for(var Rn=ft.x*yt,Ba=ft.y*yt,oa=Ee&&yt>1?this._map(ft,!0):null,Ti=(Pe<<5)+(zr+1)+this.points.length,Ca=0,xi=qt;Ca<xi.length;Ca+=1){var Hi=xi[Ca],vi=It.points[Hi];if(!(vi.zoom<=zr)){vi.zoom=zr;var mi=vi.numPoints||1;Rn+=vi.x*mi,Ba+=vi.y*mi,vi.parentId=Ti,Ee&&(oa||(oa=this._map(ft,!0)),Ee(oa,this._map(vi)))}}ft.parentId=Ti,st.push(jt(Rn/cr,Ba/cr,Ti,cr,oa))}else if(st.push(ft),cr>1)for(var ss=0,Po=qt;ss<Po.length;ss+=1){var ao=Po[ss],bt=It.points[ao];bt.zoom<=zr||(bt.zoom=zr,st.push(bt))}}}return st},hr.prototype._getOriginId=function(ir){return ir-this.points.length>>5},hr.prototype._getOriginZoom=function(ir){return(ir-this.points.length)%32},hr.prototype._map=function(ir,zr){if(ir.numPoints)return zr?ri({},ir.properties):ir.properties;var st=this.points[ir.index].properties,en=this.options.map(st);return zr&&en===st?ri({},en):en};function jt(Rr,ir,zr,st,en){return{x:Kt(Rr),y:Kt(ir),zoom:1/0,id:zr,parentId:-1,numPoints:st,properties:en}}function ar(Rr,ir){var zr=Rr.geometry.coordinates,st=zr[0],en=zr[1];return{x:Kt(Kn(st)),y:Kt(On(en)),zoom:1/0,index:ir,parentId:-1}}function ur(Rr){return{type:"Feature",id:Rr.id,properties:Ir(Rr),geometry:{type:"Point",coordinates:[an(Rr.x),Pi(Rr.y)]}}}function Ir(Rr){var ir=Rr.numPoints,zr=ir>=1e4?Math.round(ir/1e3)+"k":ir>=1e3?Math.round(ir/100)/10+"k":ir;return ri(ri({},Rr.properties),{cluster:!0,cluster_id:Rr.id,point_count:ir,point_count_abbreviated:zr})}function Kn(Rr){return Rr/360+.5}function On(Rr){var ir=Math.sin(Rr*Math.PI/180),zr=.5-.25*Math.log((1+ir)/(1-ir))/Math.PI;return zr<0?0:zr>1?1:zr}function an(Rr){return(Rr-.5)*360}function Pi(Rr){var ir=(180-Rr*360)*Math.PI/180;return 360*Math.atan(Math.exp(ir))/Math.PI-90}function ri(Rr,ir){for(var zr in ir)Rr[zr]=ir[zr];return Rr}function me(Rr){return Rr.x}function _i(Rr){return Rr.y}return hr})}}]);
